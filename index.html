<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´í…Œê³ ë¦¬ë³„ RSS í‚¤ì›Œë“œ & ì œëª© ë„ìš°ë¯¸</title>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
        }
        .container {
            max-width: 950px;
            margin: auto;
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #1a73e8;
            margin-bottom: 30px;
            font-size: 2em;
        }
        .controls {
            margin-bottom: 25px;
            padding: 20px;
            background-color: #e9ecef;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        .controls label {
            font-weight: bold;
            margin-right: 8px;
        }
        .controls input[type="url"] {
            width: 320px;
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.95em;
        }
        .controls button {
            display: inline-block;
            padding: 10px 18px;
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 0.95em;
            transition: background-color 0.2s ease;
        }
        .controls button:hover {
            background-color: #1558b0;
        }
        .controls button#manualOpenTitleBuilderButton {
            background-color: #ffc107;
            color: #212529;
        }
         .controls button#manualOpenTitleBuilderButton:hover {
            background-color: #e0a800;
        }

        #results {
            margin-top: 25px;
        }
        .category-section {
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 6px;
        }
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            border-bottom: 2px solid #1a73e8;
            padding-bottom: 8px;
        }
        .category-title {
            font-size: 1.6em;
            font-weight: bold;
            color: #1a73e8;
        }
        .rss-url { display: none; }
        .back-to-main-keywords { 
            font-size: 0.9em;
            padding: 4px 8px;
            cursor: pointer;
            background-color: #6c757d;
            color: white;
            border-radius: 4px;
            display: none; 
        }
        .back-to-main-keywords:hover {
            background-color: #5a6268;
        }

        .section-content {
            display: flex;
            gap: 20px;
        }
        .titles-area, .keywords-area {
            flex: 1;
            padding: 10px;
            border: 1px dashed #ced4da;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .titles-area h4, .keywords-area h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.2em;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .rss-data-container {
            max-height: 220px;
            overflow-y: auto;
            min-height: 30px;
        }
        .rss-data-container ul, .keywords-list ul {
            list-style-type: none;
            padding: 0; margin: 0;
        }
        .rss-data-container li {
            padding: 7px 4px;
            border-bottom: 1px dotted #e0e0e0;
        }
        .rss-data-container li:last-child { border-bottom: none; }
        .rss-data-container li a {
            text-decoration: none;
            color: #212529;
            font-size: 0.9em;
        }
        .rss-data-container li a:hover {
            text-decoration: underline;
            color: #007bff;
        }

        .keywords-list {
             max-height: 220px;
             overflow-y: auto;
        }
        .keywords-list li { 
            background-color: #e9f5ff;
            padding: 8px 14px;
            margin-bottom: 8px;
            font-size: 0.95em;
            border-radius: 18px;
            color: #0056b3;
            cursor: pointer;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
            display: inline-block;
            margin-right: 8px;
            border: 1px solid transparent;
        }
        .keywords-list li:hover {
            background-color: #cce7ff;
        }
        .keywords-list li.selected-keyword {
            background-color: #ffc107;
            color: #212529;
            font-weight: bold;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            border: 1px solid #e0a800;
        }
        .keywords-list li.primary-keyword {} 
        .keywords-list li.specific-keyword { 
            background-color: #d1e7dd; 
            color: #146c43;
        }
        .keywords-list li.specific-keyword:hover {
            background-color: #b6d7c3;
        }
         .keywords-list li.specific-keyword.selected-keyword {
            background-color: #ffc107;
            color: #212529;
            font-weight: bold;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            border: 1px solid #e0a800;
        }

        .keywords-list .keyword-count {
            font-size: 0.9em;
            color: #555;
            margin-left: 2px;
        }
        .keyword-rationale {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 10px;
            text-align: right;
        }
        .loading-message, .error-message, .no-data-message {
            padding: 12px;
            text-align: center;
            color: #6c757d;
            font-style: italic;
        }

        /* ì•ˆë‚´ ë¬¸êµ¬ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .guidance-message {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
            font-size: 1.1em;
            font-weight: bold;
            text-align: center;
            display: none;
        }
        .guidance-message.show {
            display: block;
        }

        #keywordFocusSection {
            display: none; 
            margin-top: 30px;
            padding: 25px;
            border: 2px solid #1a73e8;
            border-radius: 8px;
            background-color: #e9f5ff; 
        }
        #keywordFocusSection h2 {
            text-align: center;
            color: #1a73e8;
            margin-bottom: 20px;
        }
        #keywordFocusSection .input-group {
            margin-bottom: 20px;
        }
        #keywordFocusSection .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 6px;
        }
        #keywordFocusSection .input-group input[type="text"],
        #keywordFocusSection .input-group textarea {
            width: calc(100% - 22px); 
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1em;
        }
         #keywordFocusSection .input-group textarea {
            min-height: 60px;
        }
        #keywordFocusSection .button-group {
            text-align: right;
            margin-top: 20px;
        }
        #keywordFocusSection .button-group button { 
            padding: 10px 18px;
            font-size: 0.95em;
            margin-left: 10px;
            background-color: #28a745; 
            color:white;
            border:none;
            border-radius:4px;
            cursor:pointer;
        }
        #keywordFocusSection .button-group button#closeFocusSectionButton {
            background-color: #6c757d; 
        }
        #keywordFocusSection #suggestedTitleOutput {
            background-color: #e9ecef; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ì¹´í…Œê³ ë¦¬ë³„ ìµœì‹  ì •ë³´ & í‚¤ì›Œë“œ ë„ìš°ë¯¸</h1>

        <div class="controls">
            <label for="corsProxyInput">CORS í”„ë¡ì‹œ URL:</label>
            <input type="url" id="corsProxyInput" value="https://api.allorigins.win/raw?url=">
            <button id="fetchAllButton">ëª¨ë“  ì •ë³´ ì—…ë°ì´íŠ¸</button>
            <button id="manualOpenTitleBuilderButton" style="display: none;">ì„ íƒ í‚¤ì›Œë“œë¡œ ì œëª© ë§Œë“¤ê¸°</button> 
        </div>

        <div id="results" class="results">
            <div id="travelSection" class="category-section">
                <div class="category-header">
                    <div class="category-title">ğŸ–ï¸ ì—¬í–‰ ì˜ˆì•½</div>
                    <button class="back-to-main-keywords" data-sectionid="travelSection"> &laquo; ì „ì²´ í‚¤ì›Œë“œë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
                <div class="rss-url">https://www.google.com/alerts/feeds/17606266067575828344/4177095888204012688</div>
                <div class="guidance-message" id="travelGuidance">
                    ğŸ‘ˆ ì™¼ìª½ ê¸°ì‚¬ë¥¼ ë³´ê³  ë§Œë“¤ê³  ì‹¶ì€ ì œëª©ì„ ë³µì‚¬í•´ì„œ "ì œëª© ë§Œë“¤ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!
                </div>
                <div class="section-content">
                    <div class="titles-area">
                        <h4>ìµœì‹  ì†Œì‹ ì œëª©</h4>
                        <div id="travelData" class="rss-data-container"><div class="loading-message">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì„¸ìš”.</div></div>
                    </div>
                    <div class="keywords-area">
                        <h4>ì£¼ìš” í‚¤ì›Œë“œ</h4>
                        <div id="travelKeywords" class="keywords-list"></div>
                         <div class="keyword-rationale">ì œëª© ë¹ˆë„ìˆ˜ ê¸°ë°˜ ì¶”ì¶œ</div>
                    </div>
                </div>
            </div>
             <div id="festivalSection" class="category-section">
                <div class="category-header">
                     <div class="category-title">ğŸª ì¶•ì œ</div>
                     <button class="back-to-main-keywords" data-sectionid="festivalSection"> &laquo; ì „ì²´ í‚¤ì›Œë“œë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
                <div class="rss-url">https://www.google.co.kr/alerts/feeds/17606266067575828344/2724755524646139218</div>
                <div class="guidance-message" id="festivalGuidance">
                    ğŸ‘ˆ ì™¼ìª½ ê¸°ì‚¬ë¥¼ ë³´ê³  ë§Œë“¤ê³  ì‹¶ì€ ì œëª©ì„ ë³µì‚¬í•´ì„œ "ì œëª© ë§Œë“¤ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!
                </div>
                <div class="section-content">
                    <div class="titles-area"><h4>ìµœì‹  ì†Œì‹ ì œëª©</h4><div id="festivalData" class="rss-data-container"><div class="loading-message">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì„¸ìš”.</div></div></div>
                    <div class="keywords-area"><h4>ì£¼ìš” í‚¤ì›Œë“œ</h4><div id="festivalKeywords" class="keywords-list"></div><div class="keyword-rationale">ì œëª© ë¹ˆë„ìˆ˜ ê¸°ë°˜ ì¶”ì¶œ</div></div>
                </div>
            </div>
            <div id="ticketSection" class="category-section">
                 <div class="category-header">
                    <div class="category-title">ğŸ« ì˜ˆë§¤</div>
                    <button class="back-to-main-keywords" data-sectionid="ticketSection"> &laquo; ì „ì²´ í‚¤ì›Œë“œë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
                <div class="rss-url">https://www.google.co.kr/alerts/feeds/17606266067575828344/5566450803298381407</div>
                <div class="guidance-message" id="ticketGuidance">
                    ğŸ‘ˆ ì™¼ìª½ ê¸°ì‚¬ë¥¼ ë³´ê³  ë§Œë“¤ê³  ì‹¶ì€ ì œëª©ì„ ë³µì‚¬í•´ì„œ "ì œëª© ë§Œë“¤ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!
                </div>
                <div class="section-content">
                    <div class="titles-area"><h4>ìµœì‹  ì†Œì‹ ì œëª©</h4><div id="ticketData" class="rss-data-container"><div class="loading-message">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì„¸ìš”.</div></div></div>
                    <div class="keywords-area"><h4>ì£¼ìš” í‚¤ì›Œë“œ</h4><div id="ticketKeywords" class="keywords-list"></div><div class="keyword-rationale">ì œëª© ë¹ˆë„ìˆ˜ ê¸°ë°˜ ì¶”ì¶œ</div></div>
                </div>
            </div>
            <div id="restaurantSection" class="category-section">
                <div class="category-header">
                    <div class="category-title">ğŸ½ï¸ ë§›ì§‘ ì¶”ì²œ</div>
                    <button class="back-to-main-keywords" data-sectionid="restaurantSection"> &laquo; ì „ì²´ í‚¤ì›Œë“œë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
                <div class="rss-url">https://www.google.com/alerts/feeds/17606266067575828344/17230442263613006018</div>
                <div class="guidance-message" id="restaurantGuidance">
                    ğŸ‘ˆ ì™¼ìª½ ê¸°ì‚¬ë¥¼ ë³´ê³  ë§Œë“¤ê³  ì‹¶ì€ ì œëª©ì„ ë³µì‚¬í•´ì„œ "ì œëª© ë§Œë“¤ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!
                </div>
                <div class="section-content">
                    <div class="titles-area"><h4>ìµœì‹  ì†Œì‹ ì œëª©</h4><div id="restaurantData" class="rss-data-container"><div class="loading-message">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì„¸ìš”.</div></div></div>
                    <div class="keywords-area"><h4>ì£¼ìš” í‚¤ì›Œë“œ</h4><div id="restaurantKeywords" class="keywords-list"></div><div class="keyword-rationale">ì œëª© ë¹ˆë„ìˆ˜ ê¸°ë°˜ ì¶”ì¶œ</div></div>
                </div>
            </div>
            <div id="welfareSection" class="category-section">
                 <div class="category-header">
                    <div class="category-title">ğŸ’° ì§€ì›ê¸ˆ ì‹ ì²­</div>
                    <button class="back-to-main-keywords" data-sectionid="welfareSection"> &laquo; ì „ì²´ í‚¤ì›Œë“œë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
                <div class="rss-url">https://www.google.com/alerts/feeds/17606266067575828344/4177095888204010041</div>
                <div class="guidance-message" id="welfareGuidance">
                    ğŸ‘ˆ ì™¼ìª½ ê¸°ì‚¬ë¥¼ ë³´ê³  ë§Œë“¤ê³  ì‹¶ì€ ì œëª©ì„ ë³µì‚¬í•´ì„œ "ì œëª© ë§Œë“¤ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!
                </div>
                 <div class="section-content">
                    <div class="titles-area"><h4>ìµœì‹  ì†Œì‹ ì œëª©</h4><div id="welfareData" class="rss-data-container"><div class="loading-message">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì„¸ìš”.</div></div></div>
                    <div class="keywords-area"><h4>ì£¼ìš” í‚¤ì›Œë“œ</h4><div id="welfareKeywords" class="keywords-list"></div><div class="keyword-rationale">ì œëª© ë¹ˆë„ìˆ˜ ê¸°ë°˜ ì¶”ì¶œ</div></div>
                </div>
            </div>
        </div>

        <div id="keywordFocusSection">
            <h2>í‚¤ì›Œë“œ í™œìš© ë° ì œëª© ë§Œë“¤ê¸°</h2>
            <div class="input-group">
                <p><strong>ì„ íƒëœ êµ¬ì²´ì  í‚¤ì›Œë“œ:</strong> <span id="selectedFocusKeyword" style="color: #d9534f; font-weight:bold;"></span></p>
            </div>
            <div class="input-group">
                <label for="pastedContentInput"><b>1. ì°¸ê³ í•œ ì œëª©/ë¬¸êµ¬ ë¶™ì—¬ë„£ê¸° (ì„ íƒ ì‚¬í•­):</b></label>
                <textarea id="pastedContentInput" rows="2" placeholder="ë‹¤ë¥¸ ê¸°ì‚¬ì—ì„œ ì°¸ê³ í•œ ì œëª©ì´ë‚˜ ì£¼ìš” ë¬¸êµ¬ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
            </div>
            <div class="input-group">
                <label for="secondaryKeywordsInput"><b>2. ë³´ì¡° í‚¤ì›Œë“œ ì¶”ê°€:</b> (ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ ê°œ ì…ë ¥)</label>
                <input type="text" id="secondaryKeywordsInput" placeholder="ì˜ˆ: í›„ê¸°, ì¶”ì²œ, 2025ë…„, ê°€ëŠ” ë²•">
            </div>
            <div class="input-group">
                <label for="suggestedTitleOutput"><b>3. ì¶”ì²œ ì œëª© ì¡°í•©:</b></label>
                <input type="text" id="suggestedTitleOutput" readonly placeholder="ë²„íŠ¼ì„ ëˆŒëŸ¬ ì œëª© ì¡°í•©ì„ í™•ì¸í•˜ì„¸ìš”...">
                <button id="generateTitleButton" style="margin-top:5px;">ì œëª© ì¡°í•©í•´ë³´ê¸°</button>
            </div>
            <div class="button-group">
                <button id="closeFocusSectionButton">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        const corsProxyInput = document.getElementById('corsProxyInput');
        const fetchAllButton = document.getElementById('fetchAllButton');
        const resultsDiv = document.getElementById('results');
        const manualOpenTitleBuilderButton = document.getElementById('manualOpenTitleBuilderButton');
        
        const keywordFocusSection = document.getElementById('keywordFocusSection');
        const selectedFocusKeywordSpan = document.getElementById('selectedFocusKeyword');
        const pastedContentInput = document.getElementById('pastedContentInput');
        const secondaryKeywordsInput = document.getElementById('secondaryKeywordsInput');
        const suggestedTitleOutput = document.getElementById('suggestedTitleOutput');
        const generateTitleButton = document.getElementById('generateTitleButton');
        const closeFocusSectionButton = document.getElementById('closeFocusSectionButton');

        let categoryDataStore = {}; 
        let activeSpecificKeywordForTitle = null;

        fetchAllButton.addEventListener('click', () => {
            keywordFocusSection.style.display = 'none';
            manualOpenTitleBuilderButton.style.display = 'none';
            activeSpecificKeywordForTitle = null;
            
            // ëª¨ë“  ì•ˆë‚´ ë¬¸êµ¬ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.guidance-message').forEach(guide => {
                guide.classList.remove('show');
            });
            
            const sections = document.querySelectorAll('.category-section');
            const corsProxy = corsProxyInput.value.trim();

            if (!corsProxy.includes('?url=')) {
                alert('CORS í”„ë¡ì‹œ URL í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            sections.forEach(section => {
                const sectionId = section.id;
                const rssUrlDiv = section.querySelector('.rss-url');
                const titlesElement = section.querySelector('.rss-data-container'); 
                const keywordsElement = section.querySelector('.keywords-list'); 
                const backButton = section.querySelector('.back-to-main-keywords');
                
                if (rssUrlDiv && titlesElement && keywordsElement) {
                    const rssUrl = rssUrlDiv.textContent.trim();
                    if (!rssUrl) {
                        titlesElement.innerHTML = '<div class="no-data-message">RSS ì£¼ì†Œ ì—†ìŒ</div>';
                        keywordsElement.innerHTML = '';
                        if(backButton) backButton.style.display = 'none';
                        return;
                    }
                    fetchAndDisplayInitial(rssUrl, titlesElement, keywordsElement, corsProxy, sectionId, backButton);
                }
            });
        });

        async function fetchAndDisplayInitial(rssUrl, titlesElement, keywordsElement, corsProxy, sectionId, backButton) {
            titlesElement.innerHTML = '<div class="loading-message">ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>';
            keywordsElement.innerHTML = ''; 
            if(backButton) backButton.style.display = 'none';

            categoryDataStore[sectionId] = { articles: [], allTitlesText: "" }; 

            try {
                const response = await fetch(corsProxy + encodeURIComponent(rssUrl));
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status} (URL: ${rssUrl})`);
                
                const str = await response.text();
                const data = new window.DOMParser().parseFromString(str, "text/xml");
                let items = data.querySelectorAll("item");
                if (items.length === 0 && data.querySelectorAll("entry").length > 0) items = data.querySelectorAll("entry");

                if (items.length === 0) {
                    titlesElement.innerHTML = '<div class="no-data-message">ë‚´ìš© ì—†ìŒ</div>';
                    keywordsElement.innerHTML = '<div class="no-data-message">-</div>';
                    return;
                }

                let titlesHtml = '<ul>';
                items.forEach(item => {
                    const titleElement = item.querySelector("title");
                    const linkElement = item.querySelector("link");
                    const linkHref = linkElement ? (linkElement.getAttribute('href') || linkElement.textContent) : '#';

                    if (titleElement) {
                        const title = titleElement.textContent;
                        titlesHtml += `<li><a href="${linkHref}" target="_blank" rel="noopener noreferrer">${title}</a></li>`;
                        categoryDataStore[sectionId].articles.push({ title: title, link: linkHref }); 
                        categoryDataStore[sectionId].allTitlesText += title + " "; 
                    }
                });
                titlesHtml += '</ul>';
                titlesElement.innerHTML = titlesHtml;
                displayKeywords(categoryDataStore[sectionId].allTitlesText, keywordsElement, sectionId, 'primary-keyword', 7);
            } catch (error) {
                console.error(`Error for ${sectionId} (${rssUrl}):`, error);
                titlesElement.innerHTML = `<div class="error-message">ì˜¤ë¥˜: ${error.message}</div>`;
                keywordsElement.innerHTML = `<div class="error-message">ì˜¤ë¥˜</div>`;
            }
        }
        
        function displayKeywords(textToAnalyze, keywordsElement, sectionId, keywordClass, topN) {
            document.querySelectorAll('.keywords-list li.selected-keyword').forEach(el => el.classList.remove('selected-keyword'));

            if (textToAnalyze && textToAnalyze.trim()) {
                const keywords = extractKeywordsFromText(textToAnalyze, topN);
                if (keywords.length > 0) {
                    let keywordsHtmlList = '<ul>';
                    keywords.forEach(kw => {
                        keywordsHtmlList += `<li class="${keywordClass}" data-sectionid="${sectionId}" data-keyword="${kw.keyword.replace(/"/g, '&quot;')}">${kw.keyword} <span class="keyword-count">(${kw.count})</span></li>`;
                    });
                    keywordsHtmlList += '</ul>';
                    keywordsElement.innerHTML = keywordsHtmlList;
                } else {
                    keywordsElement.innerHTML = '<div class="no-data-message">í‚¤ì›Œë“œ ì—†ìŒ</div>';
                }
            } else {
                 keywordsElement.innerHTML = '<div class="no-data-message">ë¶„ì„í•  ì œëª© ì—†ìŒ</div>';
            }
        }

        resultsDiv.addEventListener('click', function(event) {
            const target = event.target.closest('li');
            
            if (target && target.parentElement.parentElement.classList.contains('keywords-list')) {
                const currentlySelected = document.querySelector('.keywords-list li.selected-keyword');
                if (currentlySelected) {
                    currentlySelected.classList.remove('selected-keyword');
                }
                target.classList.add('selected-keyword');

                const clickedKeyword = target.dataset.keyword;
                const sectionId = target.dataset.sectionid;

                if (target.classList.contains('primary-keyword')) {
                    handlePrimaryKeywordClick(clickedKeyword, sectionId);
                    manualOpenTitleBuilderButton.style.display = 'none';
                    activeSpecificKeywordForTitle = null;
                } else if (target.classList.contains('specific-keyword')) {
                    // 2ì°¨ í‚¤ì›Œë“œ í´ë¦­ ì‹œ: ì„ íƒëœ í‚¤ì›Œë“œë§Œ ë‚¨ê¸°ê³  ë‹¤ë¥¸ í‚¤ì›Œë“œë“¤ ìˆ¨ê¸°ê¸°
                    hideOtherKeywords(target, sectionId);
                    activeSpecificKeywordForTitle = clickedKeyword;
                    manualOpenTitleBuilderButton.style.display = 'inline-block';
                    showGuidanceMessage(sectionId);
                    keywordFocusSection.style.display = 'none';
                }
            } else if (event.target.matches('.back-to-main-keywords')) {
                const sectionId = event.target.dataset.sectionid;
                handleBackToMainKeywords(sectionId);
            }
        });

        function hideOtherKeywords(selectedKeyword, sectionId) {
            const section = document.getElementById(sectionId);
            const keywordsList = section.querySelector('.keywords-list ul');
            
            if (keywordsList) {
                // ëª¨ë“  í‚¤ì›Œë“œ ìˆ¨ê¸°ê¸°
                const allKeywords = keywordsList.querySelectorAll('li');
                allKeywords.forEach(keyword => {
                    if (keyword !== selectedKeyword) {
                        keyword.style.display = 'none';
                    }
                });
            }
        }

        function showGuidanceMessage(sectionId) {
            // ëª¨ë“  ì•ˆë‚´ ë¬¸êµ¬ ë¨¼ì € ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.guidance-message').forEach(guide => {
                guide.classList.remove('show');
            });
            
            // í•´ë‹¹ ì„¹ì…˜ì˜ ì•ˆë‚´ ë¬¸êµ¬ë§Œ ë³´ì´ê¸°
            const guidanceId = sectionId.replace('Section', 'Guidance');
            const guidanceElement = document.getElementById(guidanceId);
            if (guidanceElement) {
                guidanceElement.classList.add('show');
            }
        }
        
        manualOpenTitleBuilderButton.addEventListener('click', () => {
            if (activeSpecificKeywordForTitle) {
                selectedFocusKeywordSpan.textContent = activeSpecificKeywordForTitle;
                pastedContentInput.value = '';
                secondaryKeywordsInput.value = ''; 
                suggestedTitleOutput.value = ''; 
                keywordFocusSection.style.display = 'block'; 
                keywordFocusSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                alert('ë¨¼ì € ì˜¤ë¥¸ìª½ ëª©ë¡ì—ì„œ êµ¬ì²´ì ì¸ í‚¤ì›Œë“œë¥¼ í•˜ë‚˜ ì„ íƒí•´ì£¼ì„¸ìš”.');
            }
        });

        function handlePrimaryKeywordClick(primaryKeyword, sectionId) {
            const section = document.getElementById(sectionId);
            const titlesElement = section.querySelector('.rss-data-container');
            const keywordsElement = section.querySelector('.keywords-list');
            const backButton = section.querySelector('.back-to-main-keywords');

            // ì•ˆë‚´ ë¬¸êµ¬ ìˆ¨ê¸°ê¸°
            const guidanceId = sectionId.replace('Section', 'Guidance');
            const guidanceElement = document.getElementById(guidanceId);
            if (guidanceElement) {
                guidanceElement.classList.remove('show');
            }

            const allArticlesInSection = categoryDataStore[sectionId] ? categoryDataStore[sectionId].articles : [];
            if (allArticlesInSection.length === 0) return;

            const filteredArticles = allArticlesInSection.filter(article => 
                article.title.toLowerCase().includes(primaryKeyword.toLowerCase())
            );

            if (filteredArticles.length > 0) {
                let filteredTitlesHtml = '<ul>';
                let filteredTitlesText = "";
                filteredArticles.forEach(article => {
                    filteredTitlesHtml += `<li><a href="${article.link}" target="_blank" rel="noopener noreferrer">${article.title}</a></li>`;
                    filteredTitlesText += article.title + " ";
                });
                filteredTitlesHtml += '</ul>';
                titlesElement.innerHTML = filteredTitlesHtml;
                displayKeywords(filteredTitlesText, keywordsElement, sectionId, 'specific-keyword', 10);
                if(backButton) backButton.style.display = 'inline-block';
            } else {
                titlesElement.innerHTML = `<div class="no-data-message">'${primaryKeyword}' í¬í•¨ ê¸°ì‚¬ ì—†ìŒ.</div>`;
                keywordsElement.innerHTML = '<div class="no-data-message">í‚¤ì›Œë“œ ì—†ìŒ</div>';
                if(backButton) backButton.style.display = 'inline-block';
            }
            keywordFocusSection.style.display = 'none';
        }

        function handleBackToMainKeywords(sectionId) {
            const section = document.getElementById(sectionId);
            const titlesElement = section.querySelector('.rss-data-container');
            const keywordsElement = section.querySelector('.keywords-list');
            const backButton = section.querySelector('.back-to-main-keywords');

            // ì•ˆë‚´ ë¬¸êµ¬ ìˆ¨ê¸°ê¸°
            const guidanceId = sectionId.replace('Section', 'Guidance');
            const guidanceElement = document.getElementById(guidanceId);
            if (guidanceElement) {
                guidanceElement.classList.remove('show');
            }

            const allArticlesInSection = categoryDataStore[sectionId] ? categoryDataStore[sectionId].articles : [];
            if (allArticlesInSection.length > 0) {
                let originalTitlesHtml = '<ul>';
                allArticlesInSection.forEach(article => {
                    originalTitlesHtml += `<li><a href="${article.link}" target="_blank" rel="noopener noreferrer">${article.title}</a></li>`;
                });
                originalTitlesHtml += '</ul>';
                titlesElement.innerHTML = originalTitlesHtml;
            } else {
                titlesElement.innerHTML = '<div class="no-data-message">í‘œì‹œí•  ë‚´ìš© ì—†ìŒ.</div>';
            }

            const allTitlesTextForSection = categoryDataStore[sectionId] ? categoryDataStore[sectionId].allTitlesText : "";
            displayKeywords(allTitlesTextForSection, keywordsElement, sectionId, 'primary-keyword', 7);
            
            if(backButton) backButton.style.display = 'none';
            keywordFocusSection.style.display = 'none';
            manualOpenTitleBuilderButton.style.display = 'none';
            activeSpecificKeywordForTitle = null;
        }
        
        generateTitleButton.addEventListener('click', () => {
            const mainFocusKeyword = selectedFocusKeywordSpan.textContent.trim();
            const pastedContent = pastedContentInput.value.trim();
            const secondaryKwsArray = secondaryKeywordsInput.value.split(',')
                                        .map(sk => sk.trim())
                                        .filter(sk => sk.length > 0);

            if (!mainFocusKeyword && !pastedContent) {
                suggestedTitleOutput.value = "ì£¼ìš” í‚¤ì›Œë“œê°€ ì—†ê±°ë‚˜, ë¶™ì—¬ë„£ì€ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.";
                return;
            }

            let suggestions = [];
            let baseForTitle = pastedContent ? pastedContent : mainFocusKeyword;

            let title1 = baseForTitle;
            if (pastedContent && mainFocusKeyword && !pastedContent.toLowerCase().includes(mainFocusKeyword.toLowerCase())) {
                title1 = `${pastedContent} (${mainFocusKeyword})`;
            } else if (!pastedContent && mainFocusKeyword) {
                title1 = mainFocusKeyword;
            }

            if (secondaryKwsArray.length > 0) {
                title1 += ` - ${secondaryKwsArray.join('/')} ì´ì •ë¦¬`;
            } else if (mainFocusKeyword && !pastedContent) {
                title1 += ` í•µì‹¬ ì •ë³´ A to Z`;
            } else if (pastedContent && !mainFocusKeyword && secondaryKwsArray.length === 0) {
                title1 += ` (ë†“ì¹˜ì§€ ë§ˆì„¸ìš”!)`;
            }
            suggestions.push(title1);

            if (mainFocusKeyword) {
                let title2 = `${mainFocusKeyword}`;
                if (secondaryKwsArray.length > 0) {
                    title2 += ` ${secondaryKwsArray.join(' & ')}`;
                }
                title2 += ` ì œëŒ€ë¡œ í•˜ëŠ” ë²•`;
                if (pastedContent) {
                    let shortPasted = pastedContent;
                    if (pastedContent.length > 12) {
                        shortPasted = pastedContent.split(' ').slice(0, 2).join(' ') + "...";
                    }
                    title2 += ` (ê¿€íŒ: ${shortPasted})`;
                }
                suggestions.push(title2);
            }
            
            let title3 = "";
            if (pastedContent) {
                title3 = pastedContent.split(' ')[0];
                if (title3.length > 10 && pastedContent.includes(' ')) {
                     title3 = pastedContent.substring(0, Math.min(pastedContent.indexOf(' '), 10));
                } else if (title3.length > 10) {
                     title3 = title3.substring(0,10) + "...";
                }
            } else if (mainFocusKeyword) {
                title3 = mainFocusKeyword;
            }

            if (title3) {
                if (mainFocusKeyword && !title3.toLowerCase().includes(mainFocusKeyword.toLowerCase()) && pastedContent) {
                     title3 += ` ${mainFocusKeyword}`;
                }
                if (secondaryKwsArray.length > 0) {
                    title3 += ` ${secondaryKwsArray[0]} í•µì‹¬!`;
                } else if (mainFocusKeyword && !pastedContent) {
                    title3 += ` ì§€ê¸ˆ ë°”ë¡œ í™•ì¸`;
                } else if (pastedContent && !mainFocusKeyword && secondaryKwsArray.length == 0) {
                    title3 += ` ì£¼ëª©!`;
                }
                if (title3.length > 30) title3 = title3.substring(0, 27) + "...";
                suggestions.push(title3);
            }

            if (suggestions.length > 0) {
                suggestedTitleOutput.value = suggestions[0]; 
            } else {
                suggestedTitleOutput.value = "ì œëª©ì„ ìƒì„±í•˜ê¸° ìœ„í•œ ì •ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.";
            }
        });

        closeFocusSectionButton.addEventListener('click', () => {
            keywordFocusSection.style.display = 'none';
            manualOpenTitleBuilderButton.style.display = 'none';
            activeSpecificKeywordForTitle = null;
            
            // ëª¨ë“  ì•ˆë‚´ ë¬¸êµ¬ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.guidance-message').forEach(guide => {
                guide.classList.remove('show');
            });
            
            // ìˆ¨ê²¨ì§„ í‚¤ì›Œë“œë“¤ ë‹¤ì‹œ ë³´ì´ê¸°
            document.querySelectorAll('.keywords-list li').forEach(keyword => {
                keyword.style.display = 'inline-block';
            });
            
            const currentlySelected = document.querySelector('.keywords-list li.selected-keyword');
            if (currentlySelected) {
                currentlySelected.classList.remove('selected-keyword');
            }
        });

        function extractKeywordsFromText(text, topN = 10) {
            const cleanedText = text.toLowerCase()
                .replace(/[!"#$%&'()*+,-./:;<=>?@[\\\]^_`{|}~]/g, ' ') 
                .replace(/\s+/g, ' ') 
                .trim();
            let words = cleanedText.split(/\s+/);
            const stopwords = [ 
                'ì´', 'ê°€', 'ì„', 'ë¥¼', 'ì€', 'ëŠ”', 'ì—', 'ì—ì„œ', 'ì—ê²Œ', 'ì˜', 'ê³¼', 'ì™€', 'ë„', 'ìœ¼ë¡œ', 'í•˜ë‹¤', 'ì´ë‹¤', 'ë˜ë‹¤', 'ê·¸', 'ì €', 'ê²ƒ', 'ìˆ˜', 'ë“±', 'ë°', 'ì œ', 'ë”',
                'ì…ë‹ˆë‹¤', 'ìŠµë‹ˆë‹¤', 'í•©ë‹ˆë‹¤', 'í•˜ëŠ”', 'í•˜ê³ ', 'í•œ', 'ìš”', 'ê·¸ë¦¬ê³ ', 'ê·¸ëŸ¬ë‚˜', 'í•˜ì§€ë§Œ', 'ê·¸ë˜ì„œ', 'ê·¸ëŸ¬ë¯€ë¡œ', 'ë˜ëŠ”', 'ë‹¤ë¥¸', 'ìœ„í•´', 'ìœ„í•œ', 'ì†', 'ì•', 'ë’¤',
                'ê·¸ê²ƒ', 'ì´ê²ƒ', 'ì €ê²ƒ', 'ì—¬ê¸°', 'ì €ê¸°', 'ê±°ê¸°', 'ë•Œë¬¸', 'ì •ë„', 'ê´€ë ¨', 'í†µí•´', 'ë°”ë¡œ', 'ì§€ê¸ˆ', 'ì˜¤ëŠ˜', 'ë‚´ì¼', 'ì–´ì œ', 'ì˜¤ì „', 'ì˜¤í›„', 'ë§Œì—',
                'ë…„', 'ì‹œ', 'ë¶„', 'ì´ˆ', 'í•­ìƒ', 'ë³´í†µ', 'ìì£¼', 'ê°€ë”', 'ê±°ì˜', 'ë”', 'ëœ', 'ê°€ì¥', 'ì¢€', 'ì˜', 'ëª»', 'ê¼­', 'ìˆ˜ë„',
                'ìš°ë¦¬', 'ë„ˆí¬', 'ê·¸ë“¤', 'ë‚˜', 'ë„ˆ', 'ê·¸ë…€', 'ë‰´ìŠ¤', 'ì†ë³´', 'í—¤ë“œë¼ì¸', 'ì¢…í•©', 'ì‚¬ì§„', 'ë‹¨ë…', 'íŠ¹ì§•', 'ê¸°ì', 'ì˜ìƒ', 'ì˜¤ëŠ˜ì˜', 'ë‚´ì¼ì˜', 'ë°œí‘œ', 'ê³µê°œ', 'ê²°ì •', 'ê³µì‹', 'ì´ì •ë¦¬',
                'a', 'an', 'the', 'is', 'are', 'be', 'and', 'of', 'to', 'in', 'it', 'for', 'on', 'with', 'as', 'by', 'new', 'news', 'update', ' KOR', 'kr', 'co', 'com', 'vs',
                /^\d+$/, 
                /^[a-zA-Z]{1,2}$/, 
                /^[ã„±-ã…ã…-ã…£ê°€-í£]{1}$/ 
            ];
            const wordFrequencies = {};
            words.forEach(word => {
                if (word.length < 2) return; 
                let isStopword = false;
                for (const stop of stopwords) {
                    if (typeof stop === 'string' && word === stop) { isStopword = true; break; }
                    if (stop instanceof RegExp && stop.test(word)) { isStopword = true; break; }
                }
                if (!isStopword) { wordFrequencies[word] = (wordFrequencies[word] || 0) + 1; }
            });
            const sortedKeywords = Object.entries(wordFrequencies)
                .map(([keyword, count]) => ({ keyword, count }))
                .sort((a, b) => b.count - a.count);
            return sortedKeywords.slice(0, topN);
        }
    </script>
</body>
</html>