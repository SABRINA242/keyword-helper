(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var bn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Qf={exports:{}},Hs={},eh={exports:{}},je={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var di=Symbol.for("react.element"),wg=Symbol.for("react.portal"),Ng=Symbol.for("react.fragment"),Cg=Symbol.for("react.strict_mode"),Ig=Symbol.for("react.profiler"),bg=Symbol.for("react.provider"),Ag=Symbol.for("react.context"),_g=Symbol.for("react.forward_ref"),Rg=Symbol.for("react.suspense"),kg=Symbol.for("react.memo"),Pg=Symbol.for("react.lazy"),ac=Symbol.iterator;function Og(t){return t===null||typeof t!="object"?null:(t=ac&&t[ac]||t["@@iterator"],typeof t=="function"?t:null)}var th={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},nh=Object.assign,rh={};function po(t,e,n){this.props=t,this.context=e,this.refs=rh,this.updater=n||th}po.prototype.isReactComponent={};po.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};po.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function oh(){}oh.prototype=po.prototype;function ql(t,e,n){this.props=t,this.context=e,this.refs=rh,this.updater=n||th}var Kl=ql.prototype=new oh;Kl.constructor=ql;nh(Kl,po.prototype);Kl.isPureReactComponent=!0;var lc=Array.isArray,ih=Object.prototype.hasOwnProperty,Jl={current:null},sh={key:!0,ref:!0,__self:!0,__source:!0};function ah(t,e,n){var r,o={},i=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(i=""+e.key),e)ih.call(e,r)&&!sh.hasOwnProperty(r)&&(o[r]=e[r]);var a=arguments.length-2;if(a===1)o.children=n;else if(1<a){for(var c=Array(a),d=0;d<a;d++)c[d]=arguments[d+2];o.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)o[r]===void 0&&(o[r]=a[r]);return{$$typeof:di,type:t,key:i,ref:s,props:o,_owner:Jl.current}}function Mg(t,e){return{$$typeof:di,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Xl(t){return typeof t=="object"&&t!==null&&t.$$typeof===di}function Lg(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var uc=/\/+/g;function ca(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Lg(""+t.key):e.toString(36)}function qi(t,e,n,r,o){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case di:case wg:s=!0}}if(s)return s=t,o=o(s),t=r===""?"."+ca(s,0):r,lc(o)?(n="",t!=null&&(n=t.replace(uc,"$&/")+"/"),qi(o,e,n,"",function(d){return d})):o!=null&&(Xl(o)&&(o=Mg(o,n+(!o.key||s&&s.key===o.key?"":(""+o.key).replace(uc,"$&/")+"/")+t)),e.push(o)),1;if(s=0,r=r===""?".":r+":",lc(t))for(var a=0;a<t.length;a++){i=t[a];var c=r+ca(i,a);s+=qi(i,e,n,c,o)}else if(c=Og(t),typeof c=="function")for(t=c.call(t),a=0;!(i=t.next()).done;)i=i.value,c=r+ca(i,a++),s+=qi(i,e,n,c,o);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function wi(t,e,n){if(t==null)return t;var r=[],o=0;return qi(t,r,"","",function(i){return e.call(n,i,o++)}),r}function Dg(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ut={current:null},Ki={transition:null},Ug={ReactCurrentDispatcher:Ut,ReactCurrentBatchConfig:Ki,ReactCurrentOwner:Jl};function lh(){throw Error("act(...) is not supported in production builds of React.")}je.Children={map:wi,forEach:function(t,e,n){wi(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return wi(t,function(){e++}),e},toArray:function(t){return wi(t,function(e){return e})||[]},only:function(t){if(!Xl(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};je.Component=po;je.Fragment=Ng;je.Profiler=Ig;je.PureComponent=ql;je.StrictMode=Cg;je.Suspense=Rg;je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ug;je.act=lh;je.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=nh({},t.props),o=t.key,i=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,s=Jl.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)ih.call(e,c)&&!sh.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var d=0;d<c;d++)a[d]=arguments[d+2];r.children=a}return{$$typeof:di,type:t.type,key:o,ref:i,props:r,_owner:s}};je.createContext=function(t){return t={$$typeof:Ag,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:bg,_context:t},t.Consumer=t};je.createElement=ah;je.createFactory=function(t){var e=ah.bind(null,t);return e.type=t,e};je.createRef=function(){return{current:null}};je.forwardRef=function(t){return{$$typeof:_g,render:t}};je.isValidElement=Xl;je.lazy=function(t){return{$$typeof:Pg,_payload:{_status:-1,_result:t},_init:Dg}};je.memo=function(t,e){return{$$typeof:kg,type:t,compare:e===void 0?null:e}};je.startTransition=function(t){var e=Ki.transition;Ki.transition={};try{t()}finally{Ki.transition=e}};je.unstable_act=lh;je.useCallback=function(t,e){return Ut.current.useCallback(t,e)};je.useContext=function(t){return Ut.current.useContext(t)};je.useDebugValue=function(){};je.useDeferredValue=function(t){return Ut.current.useDeferredValue(t)};je.useEffect=function(t,e){return Ut.current.useEffect(t,e)};je.useId=function(){return Ut.current.useId()};je.useImperativeHandle=function(t,e,n){return Ut.current.useImperativeHandle(t,e,n)};je.useInsertionEffect=function(t,e){return Ut.current.useInsertionEffect(t,e)};je.useLayoutEffect=function(t,e){return Ut.current.useLayoutEffect(t,e)};je.useMemo=function(t,e){return Ut.current.useMemo(t,e)};je.useReducer=function(t,e,n){return Ut.current.useReducer(t,e,n)};je.useRef=function(t){return Ut.current.useRef(t)};je.useState=function(t){return Ut.current.useState(t)};je.useSyncExternalStore=function(t,e,n){return Ut.current.useSyncExternalStore(t,e,n)};je.useTransition=function(){return Ut.current.useTransition()};je.version="18.3.1";eh.exports=je;var ue=eh.exports;const uh=Zf(ue);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fg=ue,Gg=Symbol.for("react.element"),Hg=Symbol.for("react.fragment"),Bg=Object.prototype.hasOwnProperty,jg=Fg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Vg={key:!0,ref:!0,__self:!0,__source:!0};function ch(t,e,n){var r,o={},i=null,s=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)Bg.call(e,r)&&!Vg.hasOwnProperty(r)&&(o[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)o[r]===void 0&&(o[r]=e[r]);return{$$typeof:Gg,type:t,key:i,ref:s,props:o,_owner:jg.current}}Hs.Fragment=Hg;Hs.jsx=ch;Hs.jsxs=ch;Qf.exports=Hs;var u=Qf.exports,Ha={},dh={exports:{}},Jt={},fh={exports:{}},hh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(K,M){var ce=K.length;K.push(M);e:for(;0<ce;){var W=ce-1>>>1,$=K[W];if(0<o($,M))K[W]=M,K[ce]=$,ce=W;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var M=K[0],ce=K.pop();if(ce!==M){K[0]=ce;e:for(var W=0,$=K.length,Te=$>>>1;W<Te;){var q=2*(W+1)-1,Q=K[q],Me=q+1,Be=K[Me];if(0>o(Q,ce))Me<$&&0>o(Be,Q)?(K[W]=Be,K[Me]=ce,W=Me):(K[W]=Q,K[q]=ce,W=q);else if(Me<$&&0>o(Be,ce))K[W]=Be,K[Me]=ce,W=Me;else break e}}return M}function o(K,M){var ce=K.sortIndex-M.sortIndex;return ce!==0?ce:K.id-M.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,a=s.now();t.unstable_now=function(){return s.now()-a}}var c=[],d=[],h=1,m=null,p=3,g=!1,E=!1,x=!1,w=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(K){for(var M=n(d);M!==null;){if(M.callback===null)r(d);else if(M.startTime<=K)r(d),M.sortIndex=M.expirationTime,e(c,M);else break;M=n(d)}}function I(K){if(x=!1,T(K),!E)if(n(c)!==null)E=!0,ge(A);else{var M=n(d);M!==null&&J(I,M.startTime-K)}}function A(K,M){E=!1,x&&(x=!1,y(j),j=-1),g=!0;var ce=p;try{for(T(M),m=n(c);m!==null&&(!(m.expirationTime>M)||K&&!X());){var W=m.callback;if(typeof W=="function"){m.callback=null,p=m.priorityLevel;var $=W(m.expirationTime<=M);M=t.unstable_now(),typeof $=="function"?m.callback=$:m===n(c)&&r(c),T(M)}else r(c);m=n(c)}if(m!==null)var Te=!0;else{var q=n(d);q!==null&&J(I,q.startTime-M),Te=!1}return Te}finally{m=null,p=ce,g=!1}}var O=!1,k=null,j=-1,D=5,V=-1;function X(){return!(t.unstable_now()-V<D)}function _(){if(k!==null){var K=t.unstable_now();V=K;var M=!0;try{M=k(!0,K)}finally{M?z():(O=!1,k=null)}}else O=!1}var z;if(typeof v=="function")z=function(){v(_)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,te=N.port2;N.port1.onmessage=_,z=function(){te.postMessage(null)}}else z=function(){w(_,0)};function ge(K){k=K,O||(O=!0,z())}function J(K,M){j=w(function(){K(t.unstable_now())},M)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_continueExecution=function(){E||g||(E=!0,ge(A))},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(K){switch(p){case 1:case 2:case 3:var M=3;break;default:M=p}var ce=p;p=M;try{return K()}finally{p=ce}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(K,M){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var ce=p;p=K;try{return M()}finally{p=ce}},t.unstable_scheduleCallback=function(K,M,ce){var W=t.unstable_now();switch(typeof ce=="object"&&ce!==null?(ce=ce.delay,ce=typeof ce=="number"&&0<ce?W+ce:W):ce=W,K){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=ce+$,K={id:h++,callback:M,priorityLevel:K,startTime:ce,expirationTime:$,sortIndex:-1},ce>W?(K.sortIndex=ce,e(d,K),n(c)===null&&K===n(d)&&(x?(y(j),j=-1):x=!0,J(I,ce-W))):(K.sortIndex=$,e(c,K),E||g||(E=!0,ge(A))),K},t.unstable_shouldYield=X,t.unstable_wrapCallback=function(K){var M=p;return function(){var ce=p;p=M;try{return K.apply(this,arguments)}finally{p=ce}}}})(hh);fh.exports=hh;var $g=fh.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zg=ue,Kt=$g;function me(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ph=new Set,qo={};function Ar(t,e){so(t,e),so(t+"Capture",e)}function so(t,e){for(qo[t]=e,t=0;t<e.length;t++)ph.add(e[t])}var kn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ba=Object.prototype.hasOwnProperty,Wg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,cc={},dc={};function Yg(t){return Ba.call(dc,t)?!0:Ba.call(cc,t)?!1:Wg.test(t)?dc[t]=!0:(cc[t]=!0,!1)}function qg(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Kg(t,e,n,r){if(e===null||typeof e>"u"||qg(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ft(t,e,n,r,o,i,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=s}var It={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){It[t]=new Ft(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];It[e]=new Ft(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){It[t]=new Ft(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){It[t]=new Ft(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){It[t]=new Ft(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){It[t]=new Ft(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){It[t]=new Ft(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){It[t]=new Ft(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){It[t]=new Ft(t,5,!1,t.toLowerCase(),null,!1,!1)});var Zl=/[\-:]([a-z])/g;function Ql(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Zl,Ql);It[e]=new Ft(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Zl,Ql);It[e]=new Ft(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Zl,Ql);It[e]=new Ft(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){It[t]=new Ft(t,1,!1,t.toLowerCase(),null,!1,!1)});It.xlinkHref=new Ft("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){It[t]=new Ft(t,1,!1,t.toLowerCase(),null,!0,!0)});function eu(t,e,n,r){var o=It.hasOwnProperty(e)?It[e]:null;(o!==null?o.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Kg(e,n,o,r)&&(n=null),r||o===null?Yg(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):o.mustUseProperty?t[o.propertyName]=n===null?o.type===3?!1:"":n:(e=o.attributeName,r=o.attributeNamespace,n===null?t.removeAttribute(e):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Dn=zg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ni=Symbol.for("react.element"),Dr=Symbol.for("react.portal"),Ur=Symbol.for("react.fragment"),tu=Symbol.for("react.strict_mode"),ja=Symbol.for("react.profiler"),mh=Symbol.for("react.provider"),gh=Symbol.for("react.context"),nu=Symbol.for("react.forward_ref"),Va=Symbol.for("react.suspense"),$a=Symbol.for("react.suspense_list"),ru=Symbol.for("react.memo"),Vn=Symbol.for("react.lazy"),yh=Symbol.for("react.offscreen"),fc=Symbol.iterator;function No(t){return t===null||typeof t!="object"?null:(t=fc&&t[fc]||t["@@iterator"],typeof t=="function"?t:null)}var ut=Object.assign,da;function Mo(t){if(da===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);da=e&&e[1]||""}return`
`+da+t}var fa=!1;function ha(t,e){if(!t||fa)return"";fa=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var o=d.stack.split(`
`),i=r.stack.split(`
`),s=o.length-1,a=i.length-1;1<=s&&0<=a&&o[s]!==i[a];)a--;for(;1<=s&&0<=a;s--,a--)if(o[s]!==i[a]){if(s!==1||a!==1)do if(s--,a--,0>a||o[s]!==i[a]){var c=`
`+o[s].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=s&&0<=a);break}}}finally{fa=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Mo(t):""}function Jg(t){switch(t.tag){case 5:return Mo(t.type);case 16:return Mo("Lazy");case 13:return Mo("Suspense");case 19:return Mo("SuspenseList");case 0:case 2:case 15:return t=ha(t.type,!1),t;case 11:return t=ha(t.type.render,!1),t;case 1:return t=ha(t.type,!0),t;default:return""}}function za(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ur:return"Fragment";case Dr:return"Portal";case ja:return"Profiler";case tu:return"StrictMode";case Va:return"Suspense";case $a:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case gh:return(t.displayName||"Context")+".Consumer";case mh:return(t._context.displayName||"Context")+".Provider";case nu:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case ru:return e=t.displayName||null,e!==null?e:za(t.type)||"Memo";case Vn:e=t._payload,t=t._init;try{return za(t(e))}catch{}}return null}function Xg(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return za(e);case 8:return e===tu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function or(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function vh(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Zg(t){var e=vh(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(s){r=""+s,i.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ci(t){t._valueTracker||(t._valueTracker=Zg(t))}function xh(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=vh(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function us(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Wa(t,e){var n=e.checked;return ut({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function hc(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=or(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Eh(t,e){e=e.checked,e!=null&&eu(t,"checked",e,!1)}function Ya(t,e){Eh(t,e);var n=or(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?qa(t,e.type,n):e.hasOwnProperty("defaultValue")&&qa(t,e.type,or(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function pc(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function qa(t,e,n){(e!=="number"||us(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Lo=Array.isArray;function Zr(t,e,n,r){if(t=t.options,e){e={};for(var o=0;o<n.length;o++)e["$"+n[o]]=!0;for(n=0;n<t.length;n++)o=e.hasOwnProperty("$"+t[n].value),t[n].selected!==o&&(t[n].selected=o),o&&r&&(t[n].defaultSelected=!0)}else{for(n=""+or(n),e=null,o=0;o<t.length;o++){if(t[o].value===n){t[o].selected=!0,r&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function Ka(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(me(91));return ut({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function mc(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(me(92));if(Lo(n)){if(1<n.length)throw Error(me(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:or(n)}}function Th(t,e){var n=or(e.value),r=or(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function gc(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Sh(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ja(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Sh(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ii,wh=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,o){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ii=Ii||document.createElement("div"),Ii.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ii.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ko(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Go={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Qg=["Webkit","ms","Moz","O"];Object.keys(Go).forEach(function(t){Qg.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Go[e]=Go[t]})});function Nh(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Go.hasOwnProperty(t)&&Go[t]?(""+e).trim():e+"px"}function Ch(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,o=Nh(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,o):t[n]=o}}var e0=ut({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xa(t,e){if(e){if(e0[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(me(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(me(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(me(61))}if(e.style!=null&&typeof e.style!="object")throw Error(me(62))}}function Za(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qa=null;function ou(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var el=null,Qr=null,eo=null;function yc(t){if(t=pi(t)){if(typeof el!="function")throw Error(me(280));var e=t.stateNode;e&&(e=zs(e),el(t.stateNode,t.type,e))}}function Ih(t){Qr?eo?eo.push(t):eo=[t]:Qr=t}function bh(){if(Qr){var t=Qr,e=eo;if(eo=Qr=null,yc(t),e)for(t=0;t<e.length;t++)yc(e[t])}}function Ah(t,e){return t(e)}function _h(){}var pa=!1;function Rh(t,e,n){if(pa)return t(e,n);pa=!0;try{return Ah(t,e,n)}finally{pa=!1,(Qr!==null||eo!==null)&&(_h(),bh())}}function Jo(t,e){var n=t.stateNode;if(n===null)return null;var r=zs(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(me(231,e,typeof n));return n}var tl=!1;if(kn)try{var Co={};Object.defineProperty(Co,"passive",{get:function(){tl=!0}}),window.addEventListener("test",Co,Co),window.removeEventListener("test",Co,Co)}catch{tl=!1}function t0(t,e,n,r,o,i,s,a,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(h){this.onError(h)}}var Ho=!1,cs=null,ds=!1,nl=null,n0={onError:function(t){Ho=!0,cs=t}};function r0(t,e,n,r,o,i,s,a,c){Ho=!1,cs=null,t0.apply(n0,arguments)}function o0(t,e,n,r,o,i,s,a,c){if(r0.apply(this,arguments),Ho){if(Ho){var d=cs;Ho=!1,cs=null}else throw Error(me(198));ds||(ds=!0,nl=d)}}function _r(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function kh(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function vc(t){if(_r(t)!==t)throw Error(me(188))}function i0(t){var e=t.alternate;if(!e){if(e=_r(t),e===null)throw Error(me(188));return e!==t?null:t}for(var n=t,r=e;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(r=o.return,r!==null){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return vc(o),t;if(i===r)return vc(o),e;i=i.sibling}throw Error(me(188))}if(n.return!==r.return)n=o,r=i;else{for(var s=!1,a=o.child;a;){if(a===n){s=!0,n=o,r=i;break}if(a===r){s=!0,r=o,n=i;break}a=a.sibling}if(!s){for(a=i.child;a;){if(a===n){s=!0,n=i,r=o;break}if(a===r){s=!0,r=i,n=o;break}a=a.sibling}if(!s)throw Error(me(189))}}if(n.alternate!==r)throw Error(me(190))}if(n.tag!==3)throw Error(me(188));return n.stateNode.current===n?t:e}function Ph(t){return t=i0(t),t!==null?Oh(t):null}function Oh(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Oh(t);if(e!==null)return e;t=t.sibling}return null}var Mh=Kt.unstable_scheduleCallback,xc=Kt.unstable_cancelCallback,s0=Kt.unstable_shouldYield,a0=Kt.unstable_requestPaint,ft=Kt.unstable_now,l0=Kt.unstable_getCurrentPriorityLevel,iu=Kt.unstable_ImmediatePriority,Lh=Kt.unstable_UserBlockingPriority,fs=Kt.unstable_NormalPriority,u0=Kt.unstable_LowPriority,Dh=Kt.unstable_IdlePriority,Bs=null,wn=null;function c0(t){if(wn&&typeof wn.onCommitFiberRoot=="function")try{wn.onCommitFiberRoot(Bs,t,void 0,(t.current.flags&128)===128)}catch{}}var fn=Math.clz32?Math.clz32:h0,d0=Math.log,f0=Math.LN2;function h0(t){return t>>>=0,t===0?32:31-(d0(t)/f0|0)|0}var bi=64,Ai=4194304;function Do(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function hs(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,o=t.suspendedLanes,i=t.pingedLanes,s=n&268435455;if(s!==0){var a=s&~o;a!==0?r=Do(a):(i&=s,i!==0&&(r=Do(i)))}else s=n&~o,s!==0?r=Do(s):i!==0&&(r=Do(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&o)&&(o=r&-r,i=e&-e,o>=i||o===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-fn(e),o=1<<n,r|=t[n],e&=~o;return r}function p0(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function m0(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,o=t.expirationTimes,i=t.pendingLanes;0<i;){var s=31-fn(i),a=1<<s,c=o[s];c===-1?(!(a&n)||a&r)&&(o[s]=p0(a,e)):c<=e&&(t.expiredLanes|=a),i&=~a}}function rl(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Uh(){var t=bi;return bi<<=1,!(bi&4194240)&&(bi=64),t}function ma(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function fi(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-fn(e),t[e]=n}function g0(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var o=31-fn(n),i=1<<o;e[o]=0,r[o]=-1,t[o]=-1,n&=~i}}function su(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-fn(n),o=1<<r;o&e|t[r]&e&&(t[r]|=e),n&=~o}}var Xe=0;function Fh(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Gh,au,Hh,Bh,jh,ol=!1,_i=[],Jn=null,Xn=null,Zn=null,Xo=new Map,Zo=new Map,zn=[],y0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ec(t,e){switch(t){case"focusin":case"focusout":Jn=null;break;case"dragenter":case"dragleave":Xn=null;break;case"mouseover":case"mouseout":Zn=null;break;case"pointerover":case"pointerout":Xo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zo.delete(e.pointerId)}}function Io(t,e,n,r,o,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[o]},e!==null&&(e=pi(e),e!==null&&au(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function v0(t,e,n,r,o){switch(e){case"focusin":return Jn=Io(Jn,t,e,n,r,o),!0;case"dragenter":return Xn=Io(Xn,t,e,n,r,o),!0;case"mouseover":return Zn=Io(Zn,t,e,n,r,o),!0;case"pointerover":var i=o.pointerId;return Xo.set(i,Io(Xo.get(i)||null,t,e,n,r,o)),!0;case"gotpointercapture":return i=o.pointerId,Zo.set(i,Io(Zo.get(i)||null,t,e,n,r,o)),!0}return!1}function Vh(t){var e=gr(t.target);if(e!==null){var n=_r(e);if(n!==null){if(e=n.tag,e===13){if(e=kh(n),e!==null){t.blockedOn=e,jh(t.priority,function(){Hh(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ji(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=il(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Qa=r,n.target.dispatchEvent(r),Qa=null}else return e=pi(n),e!==null&&au(e),t.blockedOn=n,!1;e.shift()}return!0}function Tc(t,e,n){Ji(t)&&n.delete(e)}function x0(){ol=!1,Jn!==null&&Ji(Jn)&&(Jn=null),Xn!==null&&Ji(Xn)&&(Xn=null),Zn!==null&&Ji(Zn)&&(Zn=null),Xo.forEach(Tc),Zo.forEach(Tc)}function bo(t,e){t.blockedOn===e&&(t.blockedOn=null,ol||(ol=!0,Kt.unstable_scheduleCallback(Kt.unstable_NormalPriority,x0)))}function Qo(t){function e(o){return bo(o,t)}if(0<_i.length){bo(_i[0],t);for(var n=1;n<_i.length;n++){var r=_i[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Jn!==null&&bo(Jn,t),Xn!==null&&bo(Xn,t),Zn!==null&&bo(Zn,t),Xo.forEach(e),Zo.forEach(e),n=0;n<zn.length;n++)r=zn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<zn.length&&(n=zn[0],n.blockedOn===null);)Vh(n),n.blockedOn===null&&zn.shift()}var to=Dn.ReactCurrentBatchConfig,ps=!0;function E0(t,e,n,r){var o=Xe,i=to.transition;to.transition=null;try{Xe=1,lu(t,e,n,r)}finally{Xe=o,to.transition=i}}function T0(t,e,n,r){var o=Xe,i=to.transition;to.transition=null;try{Xe=4,lu(t,e,n,r)}finally{Xe=o,to.transition=i}}function lu(t,e,n,r){if(ps){var o=il(t,e,n,r);if(o===null)Ca(t,e,r,ms,n),Ec(t,r);else if(v0(o,t,e,n,r))r.stopPropagation();else if(Ec(t,r),e&4&&-1<y0.indexOf(t)){for(;o!==null;){var i=pi(o);if(i!==null&&Gh(i),i=il(t,e,n,r),i===null&&Ca(t,e,r,ms,n),i===o)break;o=i}o!==null&&r.stopPropagation()}else Ca(t,e,r,null,n)}}var ms=null;function il(t,e,n,r){if(ms=null,t=ou(r),t=gr(t),t!==null)if(e=_r(t),e===null)t=null;else if(n=e.tag,n===13){if(t=kh(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ms=t,null}function $h(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(l0()){case iu:return 1;case Lh:return 4;case fs:case u0:return 16;case Dh:return 536870912;default:return 16}default:return 16}}var Yn=null,uu=null,Xi=null;function zh(){if(Xi)return Xi;var t,e=uu,n=e.length,r,o="value"in Yn?Yn.value:Yn.textContent,i=o.length;for(t=0;t<n&&e[t]===o[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===o[i-r];r++);return Xi=o.slice(t,1<r?1-r:void 0)}function Zi(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ri(){return!0}function Sc(){return!1}function Xt(t){function e(n,r,o,i,s){this._reactName=n,this._targetInst=o,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ri:Sc,this.isPropagationStopped=Sc,this}return ut(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ri)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ri)},persist:function(){},isPersistent:Ri}),e}var mo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cu=Xt(mo),hi=ut({},mo,{view:0,detail:0}),S0=Xt(hi),ga,ya,Ao,js=ut({},hi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:du,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ao&&(Ao&&t.type==="mousemove"?(ga=t.screenX-Ao.screenX,ya=t.screenY-Ao.screenY):ya=ga=0,Ao=t),ga)},movementY:function(t){return"movementY"in t?t.movementY:ya}}),wc=Xt(js),w0=ut({},js,{dataTransfer:0}),N0=Xt(w0),C0=ut({},hi,{relatedTarget:0}),va=Xt(C0),I0=ut({},mo,{animationName:0,elapsedTime:0,pseudoElement:0}),b0=Xt(I0),A0=ut({},mo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),_0=Xt(A0),R0=ut({},mo,{data:0}),Nc=Xt(R0),k0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},P0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},O0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function M0(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=O0[t])?!!e[t]:!1}function du(){return M0}var L0=ut({},hi,{key:function(t){if(t.key){var e=k0[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Zi(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?P0[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:du,charCode:function(t){return t.type==="keypress"?Zi(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Zi(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),D0=Xt(L0),U0=ut({},js,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Cc=Xt(U0),F0=ut({},hi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:du}),G0=Xt(F0),H0=ut({},mo,{propertyName:0,elapsedTime:0,pseudoElement:0}),B0=Xt(H0),j0=ut({},js,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),V0=Xt(j0),$0=[9,13,27,32],fu=kn&&"CompositionEvent"in window,Bo=null;kn&&"documentMode"in document&&(Bo=document.documentMode);var z0=kn&&"TextEvent"in window&&!Bo,Wh=kn&&(!fu||Bo&&8<Bo&&11>=Bo),Ic=" ",bc=!1;function Yh(t,e){switch(t){case"keyup":return $0.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qh(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Fr=!1;function W0(t,e){switch(t){case"compositionend":return qh(e);case"keypress":return e.which!==32?null:(bc=!0,Ic);case"textInput":return t=e.data,t===Ic&&bc?null:t;default:return null}}function Y0(t,e){if(Fr)return t==="compositionend"||!fu&&Yh(t,e)?(t=zh(),Xi=uu=Yn=null,Fr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Wh&&e.locale!=="ko"?null:e.data;default:return null}}var q0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ac(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!q0[t.type]:e==="textarea"}function Kh(t,e,n,r){Ih(r),e=gs(e,"onChange"),0<e.length&&(n=new cu("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var jo=null,ei=null;function K0(t){sp(t,0)}function Vs(t){var e=Br(t);if(xh(e))return t}function J0(t,e){if(t==="change")return e}var Jh=!1;if(kn){var xa;if(kn){var Ea="oninput"in document;if(!Ea){var _c=document.createElement("div");_c.setAttribute("oninput","return;"),Ea=typeof _c.oninput=="function"}xa=Ea}else xa=!1;Jh=xa&&(!document.documentMode||9<document.documentMode)}function Rc(){jo&&(jo.detachEvent("onpropertychange",Xh),ei=jo=null)}function Xh(t){if(t.propertyName==="value"&&Vs(ei)){var e=[];Kh(e,ei,t,ou(t)),Rh(K0,e)}}function X0(t,e,n){t==="focusin"?(Rc(),jo=e,ei=n,jo.attachEvent("onpropertychange",Xh)):t==="focusout"&&Rc()}function Z0(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Vs(ei)}function Q0(t,e){if(t==="click")return Vs(e)}function ey(t,e){if(t==="input"||t==="change")return Vs(e)}function ty(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var gn=typeof Object.is=="function"?Object.is:ty;function ti(t,e){if(gn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!Ba.call(e,o)||!gn(t[o],e[o]))return!1}return!0}function kc(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Pc(t,e){var n=kc(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=kc(n)}}function Zh(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Zh(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Qh(){for(var t=window,e=us();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=us(t.document)}return e}function hu(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function ny(t){var e=Qh(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Zh(n.ownerDocument.documentElement,n)){if(r!==null&&hu(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=n.textContent.length,i=Math.min(r.start,o);r=r.end===void 0?i:Math.min(r.end,o),!t.extend&&i>r&&(o=r,r=i,i=o),o=Pc(n,i);var s=Pc(n,r);o&&s&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var ry=kn&&"documentMode"in document&&11>=document.documentMode,Gr=null,sl=null,Vo=null,al=!1;function Oc(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;al||Gr==null||Gr!==us(r)||(r=Gr,"selectionStart"in r&&hu(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Vo&&ti(Vo,r)||(Vo=r,r=gs(sl,"onSelect"),0<r.length&&(e=new cu("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Gr)))}function ki(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Hr={animationend:ki("Animation","AnimationEnd"),animationiteration:ki("Animation","AnimationIteration"),animationstart:ki("Animation","AnimationStart"),transitionend:ki("Transition","TransitionEnd")},Ta={},ep={};kn&&(ep=document.createElement("div").style,"AnimationEvent"in window||(delete Hr.animationend.animation,delete Hr.animationiteration.animation,delete Hr.animationstart.animation),"TransitionEvent"in window||delete Hr.transitionend.transition);function $s(t){if(Ta[t])return Ta[t];if(!Hr[t])return t;var e=Hr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in ep)return Ta[t]=e[n];return t}var tp=$s("animationend"),np=$s("animationiteration"),rp=$s("animationstart"),op=$s("transitionend"),ip=new Map,Mc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ar(t,e){ip.set(t,e),Ar(e,[t])}for(var Sa=0;Sa<Mc.length;Sa++){var wa=Mc[Sa],oy=wa.toLowerCase(),iy=wa[0].toUpperCase()+wa.slice(1);ar(oy,"on"+iy)}ar(tp,"onAnimationEnd");ar(np,"onAnimationIteration");ar(rp,"onAnimationStart");ar("dblclick","onDoubleClick");ar("focusin","onFocus");ar("focusout","onBlur");ar(op,"onTransitionEnd");so("onMouseEnter",["mouseout","mouseover"]);so("onMouseLeave",["mouseout","mouseover"]);so("onPointerEnter",["pointerout","pointerover"]);so("onPointerLeave",["pointerout","pointerover"]);Ar("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ar("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ar("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ar("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ar("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ar("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Uo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sy=new Set("cancel close invalid load scroll toggle".split(" ").concat(Uo));function Lc(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,o0(r,e,void 0,t),t.currentTarget=null}function sp(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],o=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],c=a.instance,d=a.currentTarget;if(a=a.listener,c!==i&&o.isPropagationStopped())break e;Lc(o,a,d),i=c}else for(s=0;s<r.length;s++){if(a=r[s],c=a.instance,d=a.currentTarget,a=a.listener,c!==i&&o.isPropagationStopped())break e;Lc(o,a,d),i=c}}}if(ds)throw t=nl,ds=!1,nl=null,t}function tt(t,e){var n=e[fl];n===void 0&&(n=e[fl]=new Set);var r=t+"__bubble";n.has(r)||(ap(e,t,2,!1),n.add(r))}function Na(t,e,n){var r=0;e&&(r|=4),ap(n,t,r,e)}var Pi="_reactListening"+Math.random().toString(36).slice(2);function ni(t){if(!t[Pi]){t[Pi]=!0,ph.forEach(function(n){n!=="selectionchange"&&(sy.has(n)||Na(n,!1,t),Na(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Pi]||(e[Pi]=!0,Na("selectionchange",!1,e))}}function ap(t,e,n,r){switch($h(e)){case 1:var o=E0;break;case 4:o=T0;break;default:o=lu}n=o.bind(null,e,n,t),o=void 0,!tl||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),r?o!==void 0?t.addEventListener(e,n,{capture:!0,passive:o}):t.addEventListener(e,n,!0):o!==void 0?t.addEventListener(e,n,{passive:o}):t.addEventListener(e,n,!1)}function Ca(t,e,n,r,o){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===o||a.nodeType===8&&a.parentNode===o)break;if(s===4)for(s=r.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===o||c.nodeType===8&&c.parentNode===o))return;s=s.return}for(;a!==null;){if(s=gr(a),s===null)return;if(c=s.tag,c===5||c===6){r=i=s;continue e}a=a.parentNode}}r=r.return}Rh(function(){var d=i,h=ou(n),m=[];e:{var p=ip.get(t);if(p!==void 0){var g=cu,E=t;switch(t){case"keypress":if(Zi(n)===0)break e;case"keydown":case"keyup":g=D0;break;case"focusin":E="focus",g=va;break;case"focusout":E="blur",g=va;break;case"beforeblur":case"afterblur":g=va;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=wc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=N0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=G0;break;case tp:case np:case rp:g=b0;break;case op:g=B0;break;case"scroll":g=S0;break;case"wheel":g=V0;break;case"copy":case"cut":case"paste":g=_0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=Cc}var x=(e&4)!==0,w=!x&&t==="scroll",y=x?p!==null?p+"Capture":null:p;x=[];for(var v=d,T;v!==null;){T=v;var I=T.stateNode;if(T.tag===5&&I!==null&&(T=I,y!==null&&(I=Jo(v,y),I!=null&&x.push(ri(v,I,T)))),w)break;v=v.return}0<x.length&&(p=new g(p,E,null,n,h),m.push({event:p,listeners:x}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",g=t==="mouseout"||t==="pointerout",p&&n!==Qa&&(E=n.relatedTarget||n.fromElement)&&(gr(E)||E[Pn]))break e;if((g||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,g?(E=n.relatedTarget||n.toElement,g=d,E=E?gr(E):null,E!==null&&(w=_r(E),E!==w||E.tag!==5&&E.tag!==6)&&(E=null)):(g=null,E=d),g!==E)){if(x=wc,I="onMouseLeave",y="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(x=Cc,I="onPointerLeave",y="onPointerEnter",v="pointer"),w=g==null?p:Br(g),T=E==null?p:Br(E),p=new x(I,v+"leave",g,n,h),p.target=w,p.relatedTarget=T,I=null,gr(h)===d&&(x=new x(y,v+"enter",E,n,h),x.target=T,x.relatedTarget=w,I=x),w=I,g&&E)t:{for(x=g,y=E,v=0,T=x;T;T=Or(T))v++;for(T=0,I=y;I;I=Or(I))T++;for(;0<v-T;)x=Or(x),v--;for(;0<T-v;)y=Or(y),T--;for(;v--;){if(x===y||y!==null&&x===y.alternate)break t;x=Or(x),y=Or(y)}x=null}else x=null;g!==null&&Dc(m,p,g,x,!1),E!==null&&w!==null&&Dc(m,w,E,x,!0)}}e:{if(p=d?Br(d):window,g=p.nodeName&&p.nodeName.toLowerCase(),g==="select"||g==="input"&&p.type==="file")var A=J0;else if(Ac(p))if(Jh)A=ey;else{A=Z0;var O=X0}else(g=p.nodeName)&&g.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(A=Q0);if(A&&(A=A(t,d))){Kh(m,A,n,h);break e}O&&O(t,p,d),t==="focusout"&&(O=p._wrapperState)&&O.controlled&&p.type==="number"&&qa(p,"number",p.value)}switch(O=d?Br(d):window,t){case"focusin":(Ac(O)||O.contentEditable==="true")&&(Gr=O,sl=d,Vo=null);break;case"focusout":Vo=sl=Gr=null;break;case"mousedown":al=!0;break;case"contextmenu":case"mouseup":case"dragend":al=!1,Oc(m,n,h);break;case"selectionchange":if(ry)break;case"keydown":case"keyup":Oc(m,n,h)}var k;if(fu)e:{switch(t){case"compositionstart":var j="onCompositionStart";break e;case"compositionend":j="onCompositionEnd";break e;case"compositionupdate":j="onCompositionUpdate";break e}j=void 0}else Fr?Yh(t,n)&&(j="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(j="onCompositionStart");j&&(Wh&&n.locale!=="ko"&&(Fr||j!=="onCompositionStart"?j==="onCompositionEnd"&&Fr&&(k=zh()):(Yn=h,uu="value"in Yn?Yn.value:Yn.textContent,Fr=!0)),O=gs(d,j),0<O.length&&(j=new Nc(j,t,null,n,h),m.push({event:j,listeners:O}),k?j.data=k:(k=qh(n),k!==null&&(j.data=k)))),(k=z0?W0(t,n):Y0(t,n))&&(d=gs(d,"onBeforeInput"),0<d.length&&(h=new Nc("onBeforeInput","beforeinput",null,n,h),m.push({event:h,listeners:d}),h.data=k))}sp(m,e)})}function ri(t,e,n){return{instance:t,listener:e,currentTarget:n}}function gs(t,e){for(var n=e+"Capture",r=[];t!==null;){var o=t,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=Jo(t,n),i!=null&&r.unshift(ri(t,i,o)),i=Jo(t,e),i!=null&&r.push(ri(t,i,o))),t=t.return}return r}function Or(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Dc(t,e,n,r,o){for(var i=e._reactName,s=[];n!==null&&n!==r;){var a=n,c=a.alternate,d=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&d!==null&&(a=d,o?(c=Jo(n,i),c!=null&&s.unshift(ri(n,c,a))):o||(c=Jo(n,i),c!=null&&s.push(ri(n,c,a)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var ay=/\r\n?/g,ly=/\u0000|\uFFFD/g;function Uc(t){return(typeof t=="string"?t:""+t).replace(ay,`
`).replace(ly,"")}function Oi(t,e,n){if(e=Uc(e),Uc(t)!==e&&n)throw Error(me(425))}function ys(){}var ll=null,ul=null;function cl(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var dl=typeof setTimeout=="function"?setTimeout:void 0,uy=typeof clearTimeout=="function"?clearTimeout:void 0,Fc=typeof Promise=="function"?Promise:void 0,cy=typeof queueMicrotask=="function"?queueMicrotask:typeof Fc<"u"?function(t){return Fc.resolve(null).then(t).catch(dy)}:dl;function dy(t){setTimeout(function(){throw t})}function Ia(t,e){var n=e,r=0;do{var o=n.nextSibling;if(t.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(r===0){t.removeChild(o),Qo(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=o}while(n);Qo(e)}function Qn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Gc(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var go=Math.random().toString(36).slice(2),Sn="__reactFiber$"+go,oi="__reactProps$"+go,Pn="__reactContainer$"+go,fl="__reactEvents$"+go,fy="__reactListeners$"+go,hy="__reactHandles$"+go;function gr(t){var e=t[Sn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Pn]||n[Sn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Gc(t);t!==null;){if(n=t[Sn])return n;t=Gc(t)}return e}t=n,n=t.parentNode}return null}function pi(t){return t=t[Sn]||t[Pn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Br(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(me(33))}function zs(t){return t[oi]||null}var hl=[],jr=-1;function lr(t){return{current:t}}function nt(t){0>jr||(t.current=hl[jr],hl[jr]=null,jr--)}function et(t,e){jr++,hl[jr]=t.current,t.current=e}var ir={},Pt=lr(ir),jt=lr(!1),wr=ir;function ao(t,e){var n=t.type.contextTypes;if(!n)return ir;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function Vt(t){return t=t.childContextTypes,t!=null}function vs(){nt(jt),nt(Pt)}function Hc(t,e,n){if(Pt.current!==ir)throw Error(me(168));et(Pt,e),et(jt,n)}function lp(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var o in r)if(!(o in e))throw Error(me(108,Xg(t)||"Unknown",o));return ut({},n,r)}function xs(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ir,wr=Pt.current,et(Pt,t),et(jt,jt.current),!0}function Bc(t,e,n){var r=t.stateNode;if(!r)throw Error(me(169));n?(t=lp(t,e,wr),r.__reactInternalMemoizedMergedChildContext=t,nt(jt),nt(Pt),et(Pt,t)):nt(jt),et(jt,n)}var In=null,Ws=!1,ba=!1;function up(t){In===null?In=[t]:In.push(t)}function py(t){Ws=!0,up(t)}function ur(){if(!ba&&In!==null){ba=!0;var t=0,e=Xe;try{var n=In;for(Xe=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}In=null,Ws=!1}catch(o){throw In!==null&&(In=In.slice(t+1)),Mh(iu,ur),o}finally{Xe=e,ba=!1}}return null}var Vr=[],$r=0,Es=null,Ts=0,Zt=[],Qt=0,Nr=null,An=1,_n="";function dr(t,e){Vr[$r++]=Ts,Vr[$r++]=Es,Es=t,Ts=e}function cp(t,e,n){Zt[Qt++]=An,Zt[Qt++]=_n,Zt[Qt++]=Nr,Nr=t;var r=An;t=_n;var o=32-fn(r)-1;r&=~(1<<o),n+=1;var i=32-fn(e)+o;if(30<i){var s=o-o%5;i=(r&(1<<s)-1).toString(32),r>>=s,o-=s,An=1<<32-fn(e)+o|n<<o|r,_n=i+t}else An=1<<i|n<<o|r,_n=t}function pu(t){t.return!==null&&(dr(t,1),cp(t,1,0))}function mu(t){for(;t===Es;)Es=Vr[--$r],Vr[$r]=null,Ts=Vr[--$r],Vr[$r]=null;for(;t===Nr;)Nr=Zt[--Qt],Zt[Qt]=null,_n=Zt[--Qt],Zt[Qt]=null,An=Zt[--Qt],Zt[Qt]=null}var qt=null,Yt=null,ot=!1,dn=null;function dp(t,e){var n=en(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function jc(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,qt=t,Yt=Qn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,qt=t,Yt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Nr!==null?{id:An,overflow:_n}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=en(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,qt=t,Yt=null,!0):!1;default:return!1}}function pl(t){return(t.mode&1)!==0&&(t.flags&128)===0}function ml(t){if(ot){var e=Yt;if(e){var n=e;if(!jc(t,e)){if(pl(t))throw Error(me(418));e=Qn(n.nextSibling);var r=qt;e&&jc(t,e)?dp(r,n):(t.flags=t.flags&-4097|2,ot=!1,qt=t)}}else{if(pl(t))throw Error(me(418));t.flags=t.flags&-4097|2,ot=!1,qt=t}}}function Vc(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;qt=t}function Mi(t){if(t!==qt)return!1;if(!ot)return Vc(t),ot=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!cl(t.type,t.memoizedProps)),e&&(e=Yt)){if(pl(t))throw fp(),Error(me(418));for(;e;)dp(t,e),e=Qn(e.nextSibling)}if(Vc(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(me(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Yt=Qn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Yt=null}}else Yt=qt?Qn(t.stateNode.nextSibling):null;return!0}function fp(){for(var t=Yt;t;)t=Qn(t.nextSibling)}function lo(){Yt=qt=null,ot=!1}function gu(t){dn===null?dn=[t]:dn.push(t)}var my=Dn.ReactCurrentBatchConfig;function _o(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(me(309));var r=n.stateNode}if(!r)throw Error(me(147,t));var o=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(s){var a=o.refs;s===null?delete a[i]:a[i]=s},e._stringRef=i,e)}if(typeof t!="string")throw Error(me(284));if(!n._owner)throw Error(me(290,t))}return t}function Li(t,e){throw t=Object.prototype.toString.call(e),Error(me(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function $c(t){var e=t._init;return e(t._payload)}function hp(t){function e(y,v){if(t){var T=y.deletions;T===null?(y.deletions=[v],y.flags|=16):T.push(v)}}function n(y,v){if(!t)return null;for(;v!==null;)e(y,v),v=v.sibling;return null}function r(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function o(y,v){return y=rr(y,v),y.index=0,y.sibling=null,y}function i(y,v,T){return y.index=T,t?(T=y.alternate,T!==null?(T=T.index,T<v?(y.flags|=2,v):T):(y.flags|=2,v)):(y.flags|=1048576,v)}function s(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,v,T,I){return v===null||v.tag!==6?(v=Ma(T,y.mode,I),v.return=y,v):(v=o(v,T),v.return=y,v)}function c(y,v,T,I){var A=T.type;return A===Ur?h(y,v,T.props.children,I,T.key):v!==null&&(v.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Vn&&$c(A)===v.type)?(I=o(v,T.props),I.ref=_o(y,v,T),I.return=y,I):(I=is(T.type,T.key,T.props,null,y.mode,I),I.ref=_o(y,v,T),I.return=y,I)}function d(y,v,T,I){return v===null||v.tag!==4||v.stateNode.containerInfo!==T.containerInfo||v.stateNode.implementation!==T.implementation?(v=La(T,y.mode,I),v.return=y,v):(v=o(v,T.children||[]),v.return=y,v)}function h(y,v,T,I,A){return v===null||v.tag!==7?(v=Er(T,y.mode,I,A),v.return=y,v):(v=o(v,T),v.return=y,v)}function m(y,v,T){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Ma(""+v,y.mode,T),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ni:return T=is(v.type,v.key,v.props,null,y.mode,T),T.ref=_o(y,null,v),T.return=y,T;case Dr:return v=La(v,y.mode,T),v.return=y,v;case Vn:var I=v._init;return m(y,I(v._payload),T)}if(Lo(v)||No(v))return v=Er(v,y.mode,T,null),v.return=y,v;Li(y,v)}return null}function p(y,v,T,I){var A=v!==null?v.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return A!==null?null:a(y,v,""+T,I);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Ni:return T.key===A?c(y,v,T,I):null;case Dr:return T.key===A?d(y,v,T,I):null;case Vn:return A=T._init,p(y,v,A(T._payload),I)}if(Lo(T)||No(T))return A!==null?null:h(y,v,T,I,null);Li(y,T)}return null}function g(y,v,T,I,A){if(typeof I=="string"&&I!==""||typeof I=="number")return y=y.get(T)||null,a(v,y,""+I,A);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Ni:return y=y.get(I.key===null?T:I.key)||null,c(v,y,I,A);case Dr:return y=y.get(I.key===null?T:I.key)||null,d(v,y,I,A);case Vn:var O=I._init;return g(y,v,T,O(I._payload),A)}if(Lo(I)||No(I))return y=y.get(T)||null,h(v,y,I,A,null);Li(v,I)}return null}function E(y,v,T,I){for(var A=null,O=null,k=v,j=v=0,D=null;k!==null&&j<T.length;j++){k.index>j?(D=k,k=null):D=k.sibling;var V=p(y,k,T[j],I);if(V===null){k===null&&(k=D);break}t&&k&&V.alternate===null&&e(y,k),v=i(V,v,j),O===null?A=V:O.sibling=V,O=V,k=D}if(j===T.length)return n(y,k),ot&&dr(y,j),A;if(k===null){for(;j<T.length;j++)k=m(y,T[j],I),k!==null&&(v=i(k,v,j),O===null?A=k:O.sibling=k,O=k);return ot&&dr(y,j),A}for(k=r(y,k);j<T.length;j++)D=g(k,y,j,T[j],I),D!==null&&(t&&D.alternate!==null&&k.delete(D.key===null?j:D.key),v=i(D,v,j),O===null?A=D:O.sibling=D,O=D);return t&&k.forEach(function(X){return e(y,X)}),ot&&dr(y,j),A}function x(y,v,T,I){var A=No(T);if(typeof A!="function")throw Error(me(150));if(T=A.call(T),T==null)throw Error(me(151));for(var O=A=null,k=v,j=v=0,D=null,V=T.next();k!==null&&!V.done;j++,V=T.next()){k.index>j?(D=k,k=null):D=k.sibling;var X=p(y,k,V.value,I);if(X===null){k===null&&(k=D);break}t&&k&&X.alternate===null&&e(y,k),v=i(X,v,j),O===null?A=X:O.sibling=X,O=X,k=D}if(V.done)return n(y,k),ot&&dr(y,j),A;if(k===null){for(;!V.done;j++,V=T.next())V=m(y,V.value,I),V!==null&&(v=i(V,v,j),O===null?A=V:O.sibling=V,O=V);return ot&&dr(y,j),A}for(k=r(y,k);!V.done;j++,V=T.next())V=g(k,y,j,V.value,I),V!==null&&(t&&V.alternate!==null&&k.delete(V.key===null?j:V.key),v=i(V,v,j),O===null?A=V:O.sibling=V,O=V);return t&&k.forEach(function(_){return e(y,_)}),ot&&dr(y,j),A}function w(y,v,T,I){if(typeof T=="object"&&T!==null&&T.type===Ur&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case Ni:e:{for(var A=T.key,O=v;O!==null;){if(O.key===A){if(A=T.type,A===Ur){if(O.tag===7){n(y,O.sibling),v=o(O,T.props.children),v.return=y,y=v;break e}}else if(O.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Vn&&$c(A)===O.type){n(y,O.sibling),v=o(O,T.props),v.ref=_o(y,O,T),v.return=y,y=v;break e}n(y,O);break}else e(y,O);O=O.sibling}T.type===Ur?(v=Er(T.props.children,y.mode,I,T.key),v.return=y,y=v):(I=is(T.type,T.key,T.props,null,y.mode,I),I.ref=_o(y,v,T),I.return=y,y=I)}return s(y);case Dr:e:{for(O=T.key;v!==null;){if(v.key===O)if(v.tag===4&&v.stateNode.containerInfo===T.containerInfo&&v.stateNode.implementation===T.implementation){n(y,v.sibling),v=o(v,T.children||[]),v.return=y,y=v;break e}else{n(y,v);break}else e(y,v);v=v.sibling}v=La(T,y.mode,I),v.return=y,y=v}return s(y);case Vn:return O=T._init,w(y,v,O(T._payload),I)}if(Lo(T))return E(y,v,T,I);if(No(T))return x(y,v,T,I);Li(y,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,v!==null&&v.tag===6?(n(y,v.sibling),v=o(v,T),v.return=y,y=v):(n(y,v),v=Ma(T,y.mode,I),v.return=y,y=v),s(y)):n(y,v)}return w}var uo=hp(!0),pp=hp(!1),Ss=lr(null),ws=null,zr=null,yu=null;function vu(){yu=zr=ws=null}function xu(t){var e=Ss.current;nt(Ss),t._currentValue=e}function gl(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function no(t,e){ws=t,yu=zr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Bt=!0),t.firstContext=null)}function rn(t){var e=t._currentValue;if(yu!==t)if(t={context:t,memoizedValue:e,next:null},zr===null){if(ws===null)throw Error(me(308));zr=t,ws.dependencies={lanes:0,firstContext:t}}else zr=zr.next=t;return e}var yr=null;function Eu(t){yr===null?yr=[t]:yr.push(t)}function mp(t,e,n,r){var o=e.interleaved;return o===null?(n.next=n,Eu(e)):(n.next=o.next,o.next=n),e.interleaved=n,On(t,r)}function On(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var $n=!1;function Tu(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function gp(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Rn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function er(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,We&2){var o=r.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),r.pending=e,On(t,n)}return o=r.interleaved,o===null?(e.next=e,Eu(r)):(e.next=o.next,o.next=e),r.interleaved=e,On(t,n)}function Qi(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,su(t,n)}}function zc(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=s:i=i.next=s,n=n.next}while(n!==null);i===null?o=i=e:i=i.next=e}else o=i=e;n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ns(t,e,n,r){var o=t.updateQueue;$n=!1;var i=o.firstBaseUpdate,s=o.lastBaseUpdate,a=o.shared.pending;if(a!==null){o.shared.pending=null;var c=a,d=c.next;c.next=null,s===null?i=d:s.next=d,s=c;var h=t.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==s&&(a===null?h.firstBaseUpdate=d:a.next=d,h.lastBaseUpdate=c))}if(i!==null){var m=o.baseState;s=0,h=d=c=null,a=i;do{var p=a.lane,g=a.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:g,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var E=t,x=a;switch(p=e,g=n,x.tag){case 1:if(E=x.payload,typeof E=="function"){m=E.call(g,m,p);break e}m=E;break e;case 3:E.flags=E.flags&-65537|128;case 0:if(E=x.payload,p=typeof E=="function"?E.call(g,m,p):E,p==null)break e;m=ut({},m,p);break e;case 2:$n=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,p=o.effects,p===null?o.effects=[a]:p.push(a))}else g={eventTime:g,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(d=h=g,c=m):h=h.next=g,s|=p;if(a=a.next,a===null){if(a=o.shared.pending,a===null)break;p=a,a=p.next,p.next=null,o.lastBaseUpdate=p,o.shared.pending=null}}while(!0);if(h===null&&(c=m),o.baseState=c,o.firstBaseUpdate=d,o.lastBaseUpdate=h,e=o.shared.interleaved,e!==null){o=e;do s|=o.lane,o=o.next;while(o!==e)}else i===null&&(o.shared.lanes=0);Ir|=s,t.lanes=s,t.memoizedState=m}}function Wc(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],o=r.callback;if(o!==null){if(r.callback=null,r=n,typeof o!="function")throw Error(me(191,o));o.call(r)}}}var mi={},Nn=lr(mi),ii=lr(mi),si=lr(mi);function vr(t){if(t===mi)throw Error(me(174));return t}function Su(t,e){switch(et(si,e),et(ii,t),et(Nn,mi),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ja(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ja(e,t)}nt(Nn),et(Nn,e)}function co(){nt(Nn),nt(ii),nt(si)}function yp(t){vr(si.current);var e=vr(Nn.current),n=Ja(e,t.type);e!==n&&(et(ii,t),et(Nn,n))}function wu(t){ii.current===t&&(nt(Nn),nt(ii))}var at=lr(0);function Cs(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Aa=[];function Nu(){for(var t=0;t<Aa.length;t++)Aa[t]._workInProgressVersionPrimary=null;Aa.length=0}var es=Dn.ReactCurrentDispatcher,_a=Dn.ReactCurrentBatchConfig,Cr=0,lt=null,gt=null,Et=null,Is=!1,$o=!1,ai=0,gy=0;function At(){throw Error(me(321))}function Cu(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!gn(t[n],e[n]))return!1;return!0}function Iu(t,e,n,r,o,i){if(Cr=i,lt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,es.current=t===null||t.memoizedState===null?Ey:Ty,t=n(r,o),$o){i=0;do{if($o=!1,ai=0,25<=i)throw Error(me(301));i+=1,Et=gt=null,e.updateQueue=null,es.current=Sy,t=n(r,o)}while($o)}if(es.current=bs,e=gt!==null&&gt.next!==null,Cr=0,Et=gt=lt=null,Is=!1,e)throw Error(me(300));return t}function bu(){var t=ai!==0;return ai=0,t}function Tn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Et===null?lt.memoizedState=Et=t:Et=Et.next=t,Et}function on(){if(gt===null){var t=lt.alternate;t=t!==null?t.memoizedState:null}else t=gt.next;var e=Et===null?lt.memoizedState:Et.next;if(e!==null)Et=e,gt=t;else{if(t===null)throw Error(me(310));gt=t,t={memoizedState:gt.memoizedState,baseState:gt.baseState,baseQueue:gt.baseQueue,queue:gt.queue,next:null},Et===null?lt.memoizedState=Et=t:Et=Et.next=t}return Et}function li(t,e){return typeof e=="function"?e(t):e}function Ra(t){var e=on(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var r=gt,o=r.baseQueue,i=n.pending;if(i!==null){if(o!==null){var s=o.next;o.next=i.next,i.next=s}r.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,r=r.baseState;var a=s=null,c=null,d=i;do{var h=d.lane;if((Cr&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var m={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(a=c=m,s=r):c=c.next=m,lt.lanes|=h,Ir|=h}d=d.next}while(d!==null&&d!==i);c===null?s=r:c.next=a,gn(r,e.memoizedState)||(Bt=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){o=t;do i=o.lane,lt.lanes|=i,Ir|=i,o=o.next;while(o!==t)}else o===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function ka(t){var e=on(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var r=n.dispatch,o=n.pending,i=e.memoizedState;if(o!==null){n.pending=null;var s=o=o.next;do i=t(i,s.action),s=s.next;while(s!==o);gn(i,e.memoizedState)||(Bt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function vp(){}function xp(t,e){var n=lt,r=on(),o=e(),i=!gn(r.memoizedState,o);if(i&&(r.memoizedState=o,Bt=!0),r=r.queue,Au(Sp.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Et!==null&&Et.memoizedState.tag&1){if(n.flags|=2048,ui(9,Tp.bind(null,n,r,o,e),void 0,null),Tt===null)throw Error(me(349));Cr&30||Ep(n,e,o)}return o}function Ep(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=lt.updateQueue,e===null?(e={lastEffect:null,stores:null},lt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Tp(t,e,n,r){e.value=n,e.getSnapshot=r,wp(e)&&Np(t)}function Sp(t,e,n){return n(function(){wp(e)&&Np(t)})}function wp(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!gn(t,n)}catch{return!0}}function Np(t){var e=On(t,1);e!==null&&hn(e,t,1,-1)}function Yc(t){var e=Tn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:li,lastRenderedState:t},e.queue=t,t=t.dispatch=xy.bind(null,lt,t),[e.memoizedState,t]}function ui(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=lt.updateQueue,e===null?(e={lastEffect:null,stores:null},lt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Cp(){return on().memoizedState}function ts(t,e,n,r){var o=Tn();lt.flags|=t,o.memoizedState=ui(1|e,n,void 0,r===void 0?null:r)}function Ys(t,e,n,r){var o=on();r=r===void 0?null:r;var i=void 0;if(gt!==null){var s=gt.memoizedState;if(i=s.destroy,r!==null&&Cu(r,s.deps)){o.memoizedState=ui(e,n,i,r);return}}lt.flags|=t,o.memoizedState=ui(1|e,n,i,r)}function qc(t,e){return ts(8390656,8,t,e)}function Au(t,e){return Ys(2048,8,t,e)}function Ip(t,e){return Ys(4,2,t,e)}function bp(t,e){return Ys(4,4,t,e)}function Ap(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function _p(t,e,n){return n=n!=null?n.concat([t]):null,Ys(4,4,Ap.bind(null,e,t),n)}function _u(){}function Rp(t,e){var n=on();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Cu(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function kp(t,e){var n=on();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Cu(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Pp(t,e,n){return Cr&21?(gn(n,e)||(n=Uh(),lt.lanes|=n,Ir|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Bt=!0),t.memoizedState=n)}function yy(t,e){var n=Xe;Xe=n!==0&&4>n?n:4,t(!0);var r=_a.transition;_a.transition={};try{t(!1),e()}finally{Xe=n,_a.transition=r}}function Op(){return on().memoizedState}function vy(t,e,n){var r=nr(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Mp(t))Lp(e,n);else if(n=mp(t,e,n,r),n!==null){var o=Lt();hn(n,t,r,o),Dp(n,e,r)}}function xy(t,e,n){var r=nr(t),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Mp(t))Lp(e,o);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var s=e.lastRenderedState,a=i(s,n);if(o.hasEagerState=!0,o.eagerState=a,gn(a,s)){var c=e.interleaved;c===null?(o.next=o,Eu(e)):(o.next=c.next,c.next=o),e.interleaved=o;return}}catch{}finally{}n=mp(t,e,o,r),n!==null&&(o=Lt(),hn(n,t,r,o),Dp(n,e,r))}}function Mp(t){var e=t.alternate;return t===lt||e!==null&&e===lt}function Lp(t,e){$o=Is=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Dp(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,su(t,n)}}var bs={readContext:rn,useCallback:At,useContext:At,useEffect:At,useImperativeHandle:At,useInsertionEffect:At,useLayoutEffect:At,useMemo:At,useReducer:At,useRef:At,useState:At,useDebugValue:At,useDeferredValue:At,useTransition:At,useMutableSource:At,useSyncExternalStore:At,useId:At,unstable_isNewReconciler:!1},Ey={readContext:rn,useCallback:function(t,e){return Tn().memoizedState=[t,e===void 0?null:e],t},useContext:rn,useEffect:qc,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ts(4194308,4,Ap.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ts(4194308,4,t,e)},useInsertionEffect:function(t,e){return ts(4,2,t,e)},useMemo:function(t,e){var n=Tn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Tn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=vy.bind(null,lt,t),[r.memoizedState,t]},useRef:function(t){var e=Tn();return t={current:t},e.memoizedState=t},useState:Yc,useDebugValue:_u,useDeferredValue:function(t){return Tn().memoizedState=t},useTransition:function(){var t=Yc(!1),e=t[0];return t=yy.bind(null,t[1]),Tn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=lt,o=Tn();if(ot){if(n===void 0)throw Error(me(407));n=n()}else{if(n=e(),Tt===null)throw Error(me(349));Cr&30||Ep(r,e,n)}o.memoizedState=n;var i={value:n,getSnapshot:e};return o.queue=i,qc(Sp.bind(null,r,i,t),[t]),r.flags|=2048,ui(9,Tp.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Tn(),e=Tt.identifierPrefix;if(ot){var n=_n,r=An;n=(r&~(1<<32-fn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ai++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=gy++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Ty={readContext:rn,useCallback:Rp,useContext:rn,useEffect:Au,useImperativeHandle:_p,useInsertionEffect:Ip,useLayoutEffect:bp,useMemo:kp,useReducer:Ra,useRef:Cp,useState:function(){return Ra(li)},useDebugValue:_u,useDeferredValue:function(t){var e=on();return Pp(e,gt.memoizedState,t)},useTransition:function(){var t=Ra(li)[0],e=on().memoizedState;return[t,e]},useMutableSource:vp,useSyncExternalStore:xp,useId:Op,unstable_isNewReconciler:!1},Sy={readContext:rn,useCallback:Rp,useContext:rn,useEffect:Au,useImperativeHandle:_p,useInsertionEffect:Ip,useLayoutEffect:bp,useMemo:kp,useReducer:ka,useRef:Cp,useState:function(){return ka(li)},useDebugValue:_u,useDeferredValue:function(t){var e=on();return gt===null?e.memoizedState=t:Pp(e,gt.memoizedState,t)},useTransition:function(){var t=ka(li)[0],e=on().memoizedState;return[t,e]},useMutableSource:vp,useSyncExternalStore:xp,useId:Op,unstable_isNewReconciler:!1};function un(t,e){if(t&&t.defaultProps){e=ut({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function yl(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ut({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var qs={isMounted:function(t){return(t=t._reactInternals)?_r(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Lt(),o=nr(t),i=Rn(r,o);i.payload=e,n!=null&&(i.callback=n),e=er(t,i,o),e!==null&&(hn(e,t,o,r),Qi(e,t,o))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Lt(),o=nr(t),i=Rn(r,o);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=er(t,i,o),e!==null&&(hn(e,t,o,r),Qi(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Lt(),r=nr(t),o=Rn(n,r);o.tag=2,e!=null&&(o.callback=e),e=er(t,o,r),e!==null&&(hn(e,t,r,n),Qi(e,t,r))}};function Kc(t,e,n,r,o,i,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,s):e.prototype&&e.prototype.isPureReactComponent?!ti(n,r)||!ti(o,i):!0}function Up(t,e,n){var r=!1,o=ir,i=e.contextType;return typeof i=="object"&&i!==null?i=rn(i):(o=Vt(e)?wr:Pt.current,r=e.contextTypes,i=(r=r!=null)?ao(t,o):ir),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=qs,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=i),e}function Jc(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&qs.enqueueReplaceState(e,e.state,null)}function vl(t,e,n,r){var o=t.stateNode;o.props=n,o.state=t.memoizedState,o.refs={},Tu(t);var i=e.contextType;typeof i=="object"&&i!==null?o.context=rn(i):(i=Vt(e)?wr:Pt.current,o.context=ao(t,i)),o.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(yl(t,e,i,n),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&qs.enqueueReplaceState(o,o.state,null),Ns(t,n,o,r),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function fo(t,e){try{var n="",r=e;do n+=Jg(r),r=r.return;while(r);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:o,digest:null}}function Pa(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function xl(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var wy=typeof WeakMap=="function"?WeakMap:Map;function Fp(t,e,n){n=Rn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){_s||(_s=!0,_l=r),xl(t,e)},n}function Gp(t,e,n){n=Rn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var o=e.value;n.payload=function(){return r(o)},n.callback=function(){xl(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){xl(t,e),typeof r!="function"&&(tr===null?tr=new Set([this]):tr.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}function Xc(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new wy;var o=new Set;r.set(e,o)}else o=r.get(e),o===void 0&&(o=new Set,r.set(e,o));o.has(n)||(o.add(n),t=Uy.bind(null,t,e,n),e.then(t,t))}function Zc(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Qc(t,e,n,r,o){return t.mode&1?(t.flags|=65536,t.lanes=o,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Rn(-1,1),e.tag=2,er(n,e,1))),n.lanes|=1),t)}var Ny=Dn.ReactCurrentOwner,Bt=!1;function Mt(t,e,n,r){e.child=t===null?pp(e,null,n,r):uo(e,t.child,n,r)}function ed(t,e,n,r,o){n=n.render;var i=e.ref;return no(e,o),r=Iu(t,e,n,r,i,o),n=bu(),t!==null&&!Bt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Mn(t,e,o)):(ot&&n&&pu(e),e.flags|=1,Mt(t,e,r,o),e.child)}function td(t,e,n,r,o){if(t===null){var i=n.type;return typeof i=="function"&&!Uu(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,Hp(t,e,i,r,o)):(t=is(n.type,null,r,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&o)){var s=i.memoizedProps;if(n=n.compare,n=n!==null?n:ti,n(s,r)&&t.ref===e.ref)return Mn(t,e,o)}return e.flags|=1,t=rr(i,r),t.ref=e.ref,t.return=e,e.child=t}function Hp(t,e,n,r,o){if(t!==null){var i=t.memoizedProps;if(ti(i,r)&&t.ref===e.ref)if(Bt=!1,e.pendingProps=r=i,(t.lanes&o)!==0)t.flags&131072&&(Bt=!0);else return e.lanes=t.lanes,Mn(t,e,o)}return El(t,e,n,r,o)}function Bp(t,e,n){var r=e.pendingProps,o=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},et(Yr,Wt),Wt|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,et(Yr,Wt),Wt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,et(Yr,Wt),Wt|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,et(Yr,Wt),Wt|=r;return Mt(t,e,o,n),e.child}function jp(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function El(t,e,n,r,o){var i=Vt(n)?wr:Pt.current;return i=ao(e,i),no(e,o),n=Iu(t,e,n,r,i,o),r=bu(),t!==null&&!Bt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Mn(t,e,o)):(ot&&r&&pu(e),e.flags|=1,Mt(t,e,n,o),e.child)}function nd(t,e,n,r,o){if(Vt(n)){var i=!0;xs(e)}else i=!1;if(no(e,o),e.stateNode===null)ns(t,e),Up(e,n,r),vl(e,n,r,o),r=!0;else if(t===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var c=s.context,d=n.contextType;typeof d=="object"&&d!==null?d=rn(d):(d=Vt(n)?wr:Pt.current,d=ao(e,d));var h=n.getDerivedStateFromProps,m=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function";m||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||c!==d)&&Jc(e,s,r,d),$n=!1;var p=e.memoizedState;s.state=p,Ns(e,r,s,o),c=e.memoizedState,a!==r||p!==c||jt.current||$n?(typeof h=="function"&&(yl(e,n,h,r),c=e.memoizedState),(a=$n||Kc(e,n,a,r,p,c,d))?(m||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),s.props=r,s.state=c,s.context=d,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,gp(t,e),a=e.memoizedProps,d=e.type===e.elementType?a:un(e.type,a),s.props=d,m=e.pendingProps,p=s.context,c=n.contextType,typeof c=="object"&&c!==null?c=rn(c):(c=Vt(n)?wr:Pt.current,c=ao(e,c));var g=n.getDerivedStateFromProps;(h=typeof g=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==m||p!==c)&&Jc(e,s,r,c),$n=!1,p=e.memoizedState,s.state=p,Ns(e,r,s,o);var E=e.memoizedState;a!==m||p!==E||jt.current||$n?(typeof g=="function"&&(yl(e,n,g,r),E=e.memoizedState),(d=$n||Kc(e,n,d,r,p,E,c)||!1)?(h||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,E,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,E,c)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=E),s.props=r,s.state=E,s.context=c,r=d):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),r=!1)}return Tl(t,e,n,r,i,o)}function Tl(t,e,n,r,o,i){jp(t,e);var s=(e.flags&128)!==0;if(!r&&!s)return o&&Bc(e,n,!1),Mn(t,e,i);r=e.stateNode,Ny.current=e;var a=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&s?(e.child=uo(e,t.child,null,i),e.child=uo(e,null,a,i)):Mt(t,e,a,i),e.memoizedState=r.state,o&&Bc(e,n,!0),e.child}function Vp(t){var e=t.stateNode;e.pendingContext?Hc(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Hc(t,e.context,!1),Su(t,e.containerInfo)}function rd(t,e,n,r,o){return lo(),gu(o),e.flags|=256,Mt(t,e,n,r),e.child}var Sl={dehydrated:null,treeContext:null,retryLane:0};function wl(t){return{baseLanes:t,cachePool:null,transitions:null}}function $p(t,e,n){var r=e.pendingProps,o=at.current,i=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=t!==null&&t.memoizedState===null?!1:(o&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),et(at,o&1),t===null)return ml(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,t=r.fallback,i?(r=e.mode,i=e.child,s={mode:"hidden",children:s},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=s):i=Xs(s,r,0,null),t=Er(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=wl(n),e.memoizedState=Sl,t):Ru(e,s));if(o=t.memoizedState,o!==null&&(a=o.dehydrated,a!==null))return Cy(t,e,s,r,a,o,n);if(i){i=r.fallback,s=e.mode,o=t.child,a=o.sibling;var c={mode:"hidden",children:r.children};return!(s&1)&&e.child!==o?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=rr(o,c),r.subtreeFlags=o.subtreeFlags&14680064),a!==null?i=rr(a,i):(i=Er(i,s,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,s=t.child.memoizedState,s=s===null?wl(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},i.memoizedState=s,i.childLanes=t.childLanes&~n,e.memoizedState=Sl,r}return i=t.child,t=i.sibling,r=rr(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Ru(t,e){return e=Xs({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Di(t,e,n,r){return r!==null&&gu(r),uo(e,t.child,null,n),t=Ru(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Cy(t,e,n,r,o,i,s){if(n)return e.flags&256?(e.flags&=-257,r=Pa(Error(me(422))),Di(t,e,s,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,o=e.mode,r=Xs({mode:"visible",children:r.children},o,0,null),i=Er(i,o,s,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&uo(e,t.child,null,s),e.child.memoizedState=wl(s),e.memoizedState=Sl,i);if(!(e.mode&1))return Di(t,e,s,null);if(o.data==="$!"){if(r=o.nextSibling&&o.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(me(419)),r=Pa(i,r,void 0),Di(t,e,s,r)}if(a=(s&t.childLanes)!==0,Bt||a){if(r=Tt,r!==null){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(r.suspendedLanes|s)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,On(t,o),hn(r,t,o,-1))}return Du(),r=Pa(Error(me(421))),Di(t,e,s,r)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=Fy.bind(null,t),o._reactRetry=e,null):(t=i.treeContext,Yt=Qn(o.nextSibling),qt=e,ot=!0,dn=null,t!==null&&(Zt[Qt++]=An,Zt[Qt++]=_n,Zt[Qt++]=Nr,An=t.id,_n=t.overflow,Nr=e),e=Ru(e,r.children),e.flags|=4096,e)}function od(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),gl(t.return,e,n)}function Oa(t,e,n,r,o){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o)}function zp(t,e,n){var r=e.pendingProps,o=r.revealOrder,i=r.tail;if(Mt(t,e,r.children,n),r=at.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&od(t,n,e);else if(t.tag===19)od(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(et(at,r),!(e.mode&1))e.memoizedState=null;else switch(o){case"forwards":for(n=e.child,o=null;n!==null;)t=n.alternate,t!==null&&Cs(t)===null&&(o=n),n=n.sibling;n=o,n===null?(o=e.child,e.child=null):(o=n.sibling,n.sibling=null),Oa(e,!1,o,n,i);break;case"backwards":for(n=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&Cs(t)===null){e.child=o;break}t=o.sibling,o.sibling=n,n=o,o=t}Oa(e,!0,n,null,i);break;case"together":Oa(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ns(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Mn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ir|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(me(153));if(e.child!==null){for(t=e.child,n=rr(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=rr(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Iy(t,e,n){switch(e.tag){case 3:Vp(e),lo();break;case 5:yp(e);break;case 1:Vt(e.type)&&xs(e);break;case 4:Su(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,o=e.memoizedProps.value;et(Ss,r._currentValue),r._currentValue=o;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(et(at,at.current&1),e.flags|=128,null):n&e.child.childLanes?$p(t,e,n):(et(at,at.current&1),t=Mn(t,e,n),t!==null?t.sibling:null);et(at,at.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return zp(t,e,n);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),et(at,at.current),r)break;return null;case 22:case 23:return e.lanes=0,Bp(t,e,n)}return Mn(t,e,n)}var Wp,Nl,Yp,qp;Wp=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Nl=function(){};Yp=function(t,e,n,r){var o=t.memoizedProps;if(o!==r){t=e.stateNode,vr(Nn.current);var i=null;switch(n){case"input":o=Wa(t,o),r=Wa(t,r),i=[];break;case"select":o=ut({},o,{value:void 0}),r=ut({},r,{value:void 0}),i=[];break;case"textarea":o=Ka(t,o),r=Ka(t,r),i=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=ys)}Xa(n,r);var s;n=null;for(d in o)if(!r.hasOwnProperty(d)&&o.hasOwnProperty(d)&&o[d]!=null)if(d==="style"){var a=o[d];for(s in a)a.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(qo.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(a=o!=null?o[d]:void 0,r.hasOwnProperty(d)&&c!==a&&(c!=null||a!=null))if(d==="style")if(a){for(s in a)!a.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&a[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(qo.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&tt("scroll",t),i||a===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};qp=function(t,e,n,r){n!==r&&(e.flags|=4)};function Ro(t,e){if(!ot)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function _t(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var o=t.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags&14680064,r|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function by(t,e,n){var r=e.pendingProps;switch(mu(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _t(e),null;case 1:return Vt(e.type)&&vs(),_t(e),null;case 3:return r=e.stateNode,co(),nt(jt),nt(Pt),Nu(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Mi(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,dn!==null&&(Pl(dn),dn=null))),Nl(t,e),_t(e),null;case 5:wu(e);var o=vr(si.current);if(n=e.type,t!==null&&e.stateNode!=null)Yp(t,e,n,r,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(me(166));return _t(e),null}if(t=vr(Nn.current),Mi(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Sn]=e,r[oi]=i,t=(e.mode&1)!==0,n){case"dialog":tt("cancel",r),tt("close",r);break;case"iframe":case"object":case"embed":tt("load",r);break;case"video":case"audio":for(o=0;o<Uo.length;o++)tt(Uo[o],r);break;case"source":tt("error",r);break;case"img":case"image":case"link":tt("error",r),tt("load",r);break;case"details":tt("toggle",r);break;case"input":hc(r,i),tt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},tt("invalid",r);break;case"textarea":mc(r,i),tt("invalid",r)}Xa(n,i),o=null;for(var s in i)if(i.hasOwnProperty(s)){var a=i[s];s==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Oi(r.textContent,a,t),o=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Oi(r.textContent,a,t),o=["children",""+a]):qo.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&tt("scroll",r)}switch(n){case"input":Ci(r),pc(r,i,!0);break;case"textarea":Ci(r),gc(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=ys)}r=o,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Sh(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=s.createElement(n,{is:r.is}):(t=s.createElement(n),n==="select"&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,n),t[Sn]=e,t[oi]=r,Wp(t,e,!1,!1),e.stateNode=t;e:{switch(s=Za(n,r),n){case"dialog":tt("cancel",t),tt("close",t),o=r;break;case"iframe":case"object":case"embed":tt("load",t),o=r;break;case"video":case"audio":for(o=0;o<Uo.length;o++)tt(Uo[o],t);o=r;break;case"source":tt("error",t),o=r;break;case"img":case"image":case"link":tt("error",t),tt("load",t),o=r;break;case"details":tt("toggle",t),o=r;break;case"input":hc(t,r),o=Wa(t,r),tt("invalid",t);break;case"option":o=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},o=ut({},r,{value:void 0}),tt("invalid",t);break;case"textarea":mc(t,r),o=Ka(t,r),tt("invalid",t);break;default:o=r}Xa(n,o),a=o;for(i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="style"?Ch(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&wh(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Ko(t,c):typeof c=="number"&&Ko(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(qo.hasOwnProperty(i)?c!=null&&i==="onScroll"&&tt("scroll",t):c!=null&&eu(t,i,c,s))}switch(n){case"input":Ci(t),pc(t,r,!1);break;case"textarea":Ci(t),gc(t);break;case"option":r.value!=null&&t.setAttribute("value",""+or(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Zr(t,!!r.multiple,i,!1):r.defaultValue!=null&&Zr(t,!!r.multiple,r.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=ys)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return _t(e),null;case 6:if(t&&e.stateNode!=null)qp(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(me(166));if(n=vr(si.current),vr(Nn.current),Mi(e)){if(r=e.stateNode,n=e.memoizedProps,r[Sn]=e,(i=r.nodeValue!==n)&&(t=qt,t!==null))switch(t.tag){case 3:Oi(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Oi(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Sn]=e,e.stateNode=r}return _t(e),null;case 13:if(nt(at),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ot&&Yt!==null&&e.mode&1&&!(e.flags&128))fp(),lo(),e.flags|=98560,i=!1;else if(i=Mi(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(me(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(me(317));i[Sn]=e}else lo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;_t(e),i=!1}else dn!==null&&(Pl(dn),dn=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||at.current&1?yt===0&&(yt=3):Du())),e.updateQueue!==null&&(e.flags|=4),_t(e),null);case 4:return co(),Nl(t,e),t===null&&ni(e.stateNode.containerInfo),_t(e),null;case 10:return xu(e.type._context),_t(e),null;case 17:return Vt(e.type)&&vs(),_t(e),null;case 19:if(nt(at),i=e.memoizedState,i===null)return _t(e),null;if(r=(e.flags&128)!==0,s=i.rendering,s===null)if(r)Ro(i,!1);else{if(yt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=Cs(t),s!==null){for(e.flags|=128,Ro(i,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,s=i.alternate,s===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,i.type=s.type,t=s.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return et(at,at.current&1|2),e.child}t=t.sibling}i.tail!==null&&ft()>ho&&(e.flags|=128,r=!0,Ro(i,!1),e.lanes=4194304)}else{if(!r)if(t=Cs(s),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ro(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!ot)return _t(e),null}else 2*ft()-i.renderingStartTime>ho&&n!==1073741824&&(e.flags|=128,r=!0,Ro(i,!1),e.lanes=4194304);i.isBackwards?(s.sibling=e.child,e.child=s):(n=i.last,n!==null?n.sibling=s:e.child=s,i.last=s)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=ft(),e.sibling=null,n=at.current,et(at,r?n&1|2:n&1),e):(_t(e),null);case 22:case 23:return Lu(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Wt&1073741824&&(_t(e),e.subtreeFlags&6&&(e.flags|=8192)):_t(e),null;case 24:return null;case 25:return null}throw Error(me(156,e.tag))}function Ay(t,e){switch(mu(e),e.tag){case 1:return Vt(e.type)&&vs(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return co(),nt(jt),nt(Pt),Nu(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return wu(e),null;case 13:if(nt(at),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(me(340));lo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return nt(at),null;case 4:return co(),null;case 10:return xu(e.type._context),null;case 22:case 23:return Lu(),null;case 24:return null;default:return null}}var Ui=!1,Rt=!1,_y=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function Wr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){dt(t,e,r)}else n.current=null}function Cl(t,e,n){try{n()}catch(r){dt(t,e,r)}}var id=!1;function Ry(t,e){if(ll=ps,t=Qh(),hu(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var s=0,a=-1,c=-1,d=0,h=0,m=t,p=null;t:for(;;){for(var g;m!==n||o!==0&&m.nodeType!==3||(a=s+o),m!==i||r!==0&&m.nodeType!==3||(c=s+r),m.nodeType===3&&(s+=m.nodeValue.length),(g=m.firstChild)!==null;)p=m,m=g;for(;;){if(m===t)break t;if(p===n&&++d===o&&(a=s),p===i&&++h===r&&(c=s),(g=m.nextSibling)!==null)break;m=p,p=m.parentNode}m=g}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ul={focusedElem:t,selectionRange:n},ps=!1,Ie=e;Ie!==null;)if(e=Ie,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ie=t;else for(;Ie!==null;){e=Ie;try{var E=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(E!==null){var x=E.memoizedProps,w=E.memoizedState,y=e.stateNode,v=y.getSnapshotBeforeUpdate(e.elementType===e.type?x:un(e.type,x),w);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(me(163))}}catch(I){dt(e,e.return,I)}if(t=e.sibling,t!==null){t.return=e.return,Ie=t;break}Ie=e.return}return E=id,id=!1,E}function zo(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&t)===t){var i=o.destroy;o.destroy=void 0,i!==void 0&&Cl(e,n,i)}o=o.next}while(o!==r)}}function Ks(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Il(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Kp(t){var e=t.alternate;e!==null&&(t.alternate=null,Kp(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Sn],delete e[oi],delete e[fl],delete e[fy],delete e[hy])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Jp(t){return t.tag===5||t.tag===3||t.tag===4}function sd(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Jp(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function bl(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ys));else if(r!==4&&(t=t.child,t!==null))for(bl(t,e,n),t=t.sibling;t!==null;)bl(t,e,n),t=t.sibling}function Al(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Al(t,e,n),t=t.sibling;t!==null;)Al(t,e,n),t=t.sibling}var Nt=null,cn=!1;function jn(t,e,n){for(n=n.child;n!==null;)Xp(t,e,n),n=n.sibling}function Xp(t,e,n){if(wn&&typeof wn.onCommitFiberUnmount=="function")try{wn.onCommitFiberUnmount(Bs,n)}catch{}switch(n.tag){case 5:Rt||Wr(n,e);case 6:var r=Nt,o=cn;Nt=null,jn(t,e,n),Nt=r,cn=o,Nt!==null&&(cn?(t=Nt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Nt.removeChild(n.stateNode));break;case 18:Nt!==null&&(cn?(t=Nt,n=n.stateNode,t.nodeType===8?Ia(t.parentNode,n):t.nodeType===1&&Ia(t,n),Qo(t)):Ia(Nt,n.stateNode));break;case 4:r=Nt,o=cn,Nt=n.stateNode.containerInfo,cn=!0,jn(t,e,n),Nt=r,cn=o;break;case 0:case 11:case 14:case 15:if(!Rt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){o=r=r.next;do{var i=o,s=i.destroy;i=i.tag,s!==void 0&&(i&2||i&4)&&Cl(n,e,s),o=o.next}while(o!==r)}jn(t,e,n);break;case 1:if(!Rt&&(Wr(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){dt(n,e,a)}jn(t,e,n);break;case 21:jn(t,e,n);break;case 22:n.mode&1?(Rt=(r=Rt)||n.memoizedState!==null,jn(t,e,n),Rt=r):jn(t,e,n);break;default:jn(t,e,n)}}function ad(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new _y),e.forEach(function(r){var o=Gy.bind(null,t,r);n.has(r)||(n.add(r),r.then(o,o))})}}function ln(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var o=n[r];try{var i=t,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:Nt=a.stateNode,cn=!1;break e;case 3:Nt=a.stateNode.containerInfo,cn=!0;break e;case 4:Nt=a.stateNode.containerInfo,cn=!0;break e}a=a.return}if(Nt===null)throw Error(me(160));Xp(i,s,o),Nt=null,cn=!1;var c=o.alternate;c!==null&&(c.return=null),o.return=null}catch(d){dt(o,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Zp(e,t),e=e.sibling}function Zp(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ln(e,t),En(t),r&4){try{zo(3,t,t.return),Ks(3,t)}catch(x){dt(t,t.return,x)}try{zo(5,t,t.return)}catch(x){dt(t,t.return,x)}}break;case 1:ln(e,t),En(t),r&512&&n!==null&&Wr(n,n.return);break;case 5:if(ln(e,t),En(t),r&512&&n!==null&&Wr(n,n.return),t.flags&32){var o=t.stateNode;try{Ko(o,"")}catch(x){dt(t,t.return,x)}}if(r&4&&(o=t.stateNode,o!=null)){var i=t.memoizedProps,s=n!==null?n.memoizedProps:i,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Eh(o,i),Za(a,s);var d=Za(a,i);for(s=0;s<c.length;s+=2){var h=c[s],m=c[s+1];h==="style"?Ch(o,m):h==="dangerouslySetInnerHTML"?wh(o,m):h==="children"?Ko(o,m):eu(o,h,m,d)}switch(a){case"input":Ya(o,i);break;case"textarea":Th(o,i);break;case"select":var p=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var g=i.value;g!=null?Zr(o,!!i.multiple,g,!1):p!==!!i.multiple&&(i.defaultValue!=null?Zr(o,!!i.multiple,i.defaultValue,!0):Zr(o,!!i.multiple,i.multiple?[]:"",!1))}o[oi]=i}catch(x){dt(t,t.return,x)}}break;case 6:if(ln(e,t),En(t),r&4){if(t.stateNode===null)throw Error(me(162));o=t.stateNode,i=t.memoizedProps;try{o.nodeValue=i}catch(x){dt(t,t.return,x)}}break;case 3:if(ln(e,t),En(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Qo(e.containerInfo)}catch(x){dt(t,t.return,x)}break;case 4:ln(e,t),En(t);break;case 13:ln(e,t),En(t),o=t.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(Ou=ft())),r&4&&ad(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(Rt=(d=Rt)||h,ln(e,t),Rt=d):ln(e,t),En(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!h&&t.mode&1)for(Ie=t,h=t.child;h!==null;){for(m=Ie=h;Ie!==null;){switch(p=Ie,g=p.child,p.tag){case 0:case 11:case 14:case 15:zo(4,p,p.return);break;case 1:Wr(p,p.return);var E=p.stateNode;if(typeof E.componentWillUnmount=="function"){r=p,n=p.return;try{e=r,E.props=e.memoizedProps,E.state=e.memoizedState,E.componentWillUnmount()}catch(x){dt(r,n,x)}}break;case 5:Wr(p,p.return);break;case 22:if(p.memoizedState!==null){ud(m);continue}}g!==null?(g.return=p,Ie=g):ud(m)}h=h.sibling}e:for(h=null,m=t;;){if(m.tag===5){if(h===null){h=m;try{o=m.stateNode,d?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=m.stateNode,c=m.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=Nh("display",s))}catch(x){dt(t,t.return,x)}}}else if(m.tag===6){if(h===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(x){dt(t,t.return,x)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;h===m&&(h=null),m=m.return}h===m&&(h=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:ln(e,t),En(t),r&4&&ad(t);break;case 21:break;default:ln(e,t),En(t)}}function En(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Jp(n)){var r=n;break e}n=n.return}throw Error(me(160))}switch(r.tag){case 5:var o=r.stateNode;r.flags&32&&(Ko(o,""),r.flags&=-33);var i=sd(t);Al(t,i,o);break;case 3:case 4:var s=r.stateNode.containerInfo,a=sd(t);bl(t,a,s);break;default:throw Error(me(161))}}catch(c){dt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function ky(t,e,n){Ie=t,Qp(t)}function Qp(t,e,n){for(var r=(t.mode&1)!==0;Ie!==null;){var o=Ie,i=o.child;if(o.tag===22&&r){var s=o.memoizedState!==null||Ui;if(!s){var a=o.alternate,c=a!==null&&a.memoizedState!==null||Rt;a=Ui;var d=Rt;if(Ui=s,(Rt=c)&&!d)for(Ie=o;Ie!==null;)s=Ie,c=s.child,s.tag===22&&s.memoizedState!==null?cd(o):c!==null?(c.return=s,Ie=c):cd(o);for(;i!==null;)Ie=i,Qp(i),i=i.sibling;Ie=o,Ui=a,Rt=d}ld(t)}else o.subtreeFlags&8772&&i!==null?(i.return=o,Ie=i):ld(t)}}function ld(t){for(;Ie!==null;){var e=Ie;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Rt||Ks(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Rt)if(n===null)r.componentDidMount();else{var o=e.elementType===e.type?n.memoizedProps:un(e.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Wc(e,i,r);break;case 3:var s=e.updateQueue;if(s!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Wc(e,s,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var m=h.dehydrated;m!==null&&Qo(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(me(163))}Rt||e.flags&512&&Il(e)}catch(p){dt(e,e.return,p)}}if(e===t){Ie=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ie=n;break}Ie=e.return}}function ud(t){for(;Ie!==null;){var e=Ie;if(e===t){Ie=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ie=n;break}Ie=e.return}}function cd(t){for(;Ie!==null;){var e=Ie;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ks(4,e)}catch(c){dt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var o=e.return;try{r.componentDidMount()}catch(c){dt(e,o,c)}}var i=e.return;try{Il(e)}catch(c){dt(e,i,c)}break;case 5:var s=e.return;try{Il(e)}catch(c){dt(e,s,c)}}}catch(c){dt(e,e.return,c)}if(e===t){Ie=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ie=a;break}Ie=e.return}}var Py=Math.ceil,As=Dn.ReactCurrentDispatcher,ku=Dn.ReactCurrentOwner,tn=Dn.ReactCurrentBatchConfig,We=0,Tt=null,pt=null,Ct=0,Wt=0,Yr=lr(0),yt=0,ci=null,Ir=0,Js=0,Pu=0,Wo=null,Ht=null,Ou=0,ho=1/0,Cn=null,_s=!1,_l=null,tr=null,Fi=!1,qn=null,Rs=0,Yo=0,Rl=null,rs=-1,os=0;function Lt(){return We&6?ft():rs!==-1?rs:rs=ft()}function nr(t){return t.mode&1?We&2&&Ct!==0?Ct&-Ct:my.transition!==null?(os===0&&(os=Uh()),os):(t=Xe,t!==0||(t=window.event,t=t===void 0?16:$h(t.type)),t):1}function hn(t,e,n,r){if(50<Yo)throw Yo=0,Rl=null,Error(me(185));fi(t,n,r),(!(We&2)||t!==Tt)&&(t===Tt&&(!(We&2)&&(Js|=n),yt===4&&Wn(t,Ct)),$t(t,r),n===1&&We===0&&!(e.mode&1)&&(ho=ft()+500,Ws&&ur()))}function $t(t,e){var n=t.callbackNode;m0(t,e);var r=hs(t,t===Tt?Ct:0);if(r===0)n!==null&&xc(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&xc(n),e===1)t.tag===0?py(dd.bind(null,t)):up(dd.bind(null,t)),cy(function(){!(We&6)&&ur()}),n=null;else{switch(Fh(r)){case 1:n=iu;break;case 4:n=Lh;break;case 16:n=fs;break;case 536870912:n=Dh;break;default:n=fs}n=am(n,em.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function em(t,e){if(rs=-1,os=0,We&6)throw Error(me(327));var n=t.callbackNode;if(ro()&&t.callbackNode!==n)return null;var r=hs(t,t===Tt?Ct:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=ks(t,r);else{e=r;var o=We;We|=2;var i=nm();(Tt!==t||Ct!==e)&&(Cn=null,ho=ft()+500,xr(t,e));do try{Ly();break}catch(a){tm(t,a)}while(!0);vu(),As.current=i,We=o,pt!==null?e=0:(Tt=null,Ct=0,e=yt)}if(e!==0){if(e===2&&(o=rl(t),o!==0&&(r=o,e=kl(t,o))),e===1)throw n=ci,xr(t,0),Wn(t,r),$t(t,ft()),n;if(e===6)Wn(t,r);else{if(o=t.current.alternate,!(r&30)&&!Oy(o)&&(e=ks(t,r),e===2&&(i=rl(t),i!==0&&(r=i,e=kl(t,i))),e===1))throw n=ci,xr(t,0),Wn(t,r),$t(t,ft()),n;switch(t.finishedWork=o,t.finishedLanes=r,e){case 0:case 1:throw Error(me(345));case 2:fr(t,Ht,Cn);break;case 3:if(Wn(t,r),(r&130023424)===r&&(e=Ou+500-ft(),10<e)){if(hs(t,0)!==0)break;if(o=t.suspendedLanes,(o&r)!==r){Lt(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=dl(fr.bind(null,t,Ht,Cn),e);break}fr(t,Ht,Cn);break;case 4:if(Wn(t,r),(r&4194240)===r)break;for(e=t.eventTimes,o=-1;0<r;){var s=31-fn(r);i=1<<s,s=e[s],s>o&&(o=s),r&=~i}if(r=o,r=ft()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Py(r/1960))-r,10<r){t.timeoutHandle=dl(fr.bind(null,t,Ht,Cn),r);break}fr(t,Ht,Cn);break;case 5:fr(t,Ht,Cn);break;default:throw Error(me(329))}}}return $t(t,ft()),t.callbackNode===n?em.bind(null,t):null}function kl(t,e){var n=Wo;return t.current.memoizedState.isDehydrated&&(xr(t,e).flags|=256),t=ks(t,e),t!==2&&(e=Ht,Ht=n,e!==null&&Pl(e)),t}function Pl(t){Ht===null?Ht=t:Ht.push.apply(Ht,t)}function Oy(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var o=n[r],i=o.getSnapshot;o=o.value;try{if(!gn(i(),o))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Wn(t,e){for(e&=~Pu,e&=~Js,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-fn(e),r=1<<n;t[n]=-1,e&=~r}}function dd(t){if(We&6)throw Error(me(327));ro();var e=hs(t,0);if(!(e&1))return $t(t,ft()),null;var n=ks(t,e);if(t.tag!==0&&n===2){var r=rl(t);r!==0&&(e=r,n=kl(t,r))}if(n===1)throw n=ci,xr(t,0),Wn(t,e),$t(t,ft()),n;if(n===6)throw Error(me(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,fr(t,Ht,Cn),$t(t,ft()),null}function Mu(t,e){var n=We;We|=1;try{return t(e)}finally{We=n,We===0&&(ho=ft()+500,Ws&&ur())}}function br(t){qn!==null&&qn.tag===0&&!(We&6)&&ro();var e=We;We|=1;var n=tn.transition,r=Xe;try{if(tn.transition=null,Xe=1,t)return t()}finally{Xe=r,tn.transition=n,We=e,!(We&6)&&ur()}}function Lu(){Wt=Yr.current,nt(Yr)}function xr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,uy(n)),pt!==null)for(n=pt.return;n!==null;){var r=n;switch(mu(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&vs();break;case 3:co(),nt(jt),nt(Pt),Nu();break;case 5:wu(r);break;case 4:co();break;case 13:nt(at);break;case 19:nt(at);break;case 10:xu(r.type._context);break;case 22:case 23:Lu()}n=n.return}if(Tt=t,pt=t=rr(t.current,null),Ct=Wt=e,yt=0,ci=null,Pu=Js=Ir=0,Ht=Wo=null,yr!==null){for(e=0;e<yr.length;e++)if(n=yr[e],r=n.interleaved,r!==null){n.interleaved=null;var o=r.next,i=n.pending;if(i!==null){var s=i.next;i.next=o,r.next=s}n.pending=r}yr=null}return t}function tm(t,e){do{var n=pt;try{if(vu(),es.current=bs,Is){for(var r=lt.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}Is=!1}if(Cr=0,Et=gt=lt=null,$o=!1,ai=0,ku.current=null,n===null||n.return===null){yt=1,ci=e,pt=null;break}e:{var i=t,s=n.return,a=n,c=e;if(e=Ct,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=a,m=h.tag;if(!(h.mode&1)&&(m===0||m===11||m===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var g=Zc(s);if(g!==null){g.flags&=-257,Qc(g,s,a,i,e),g.mode&1&&Xc(i,d,e),e=g,c=d;var E=e.updateQueue;if(E===null){var x=new Set;x.add(c),e.updateQueue=x}else E.add(c);break e}else{if(!(e&1)){Xc(i,d,e),Du();break e}c=Error(me(426))}}else if(ot&&a.mode&1){var w=Zc(s);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Qc(w,s,a,i,e),gu(fo(c,a));break e}}i=c=fo(c,a),yt!==4&&(yt=2),Wo===null?Wo=[i]:Wo.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=Fp(i,c,e);zc(i,y);break e;case 1:a=c;var v=i.type,T=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(tr===null||!tr.has(T)))){i.flags|=65536,e&=-e,i.lanes|=e;var I=Gp(i,a,e);zc(i,I);break e}}i=i.return}while(i!==null)}om(n)}catch(A){e=A,pt===n&&n!==null&&(pt=n=n.return);continue}break}while(!0)}function nm(){var t=As.current;return As.current=bs,t===null?bs:t}function Du(){(yt===0||yt===3||yt===2)&&(yt=4),Tt===null||!(Ir&268435455)&&!(Js&268435455)||Wn(Tt,Ct)}function ks(t,e){var n=We;We|=2;var r=nm();(Tt!==t||Ct!==e)&&(Cn=null,xr(t,e));do try{My();break}catch(o){tm(t,o)}while(!0);if(vu(),We=n,As.current=r,pt!==null)throw Error(me(261));return Tt=null,Ct=0,yt}function My(){for(;pt!==null;)rm(pt)}function Ly(){for(;pt!==null&&!s0();)rm(pt)}function rm(t){var e=sm(t.alternate,t,Wt);t.memoizedProps=t.pendingProps,e===null?om(t):pt=e,ku.current=null}function om(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Ay(n,e),n!==null){n.flags&=32767,pt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{yt=6,pt=null;return}}else if(n=by(n,e,Wt),n!==null){pt=n;return}if(e=e.sibling,e!==null){pt=e;return}pt=e=t}while(e!==null);yt===0&&(yt=5)}function fr(t,e,n){var r=Xe,o=tn.transition;try{tn.transition=null,Xe=1,Dy(t,e,n,r)}finally{tn.transition=o,Xe=r}return null}function Dy(t,e,n,r){do ro();while(qn!==null);if(We&6)throw Error(me(327));n=t.finishedWork;var o=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(me(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(g0(t,i),t===Tt&&(pt=Tt=null,Ct=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Fi||(Fi=!0,am(fs,function(){return ro(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=tn.transition,tn.transition=null;var s=Xe;Xe=1;var a=We;We|=4,ku.current=null,Ry(t,n),Zp(n,t),ny(ul),ps=!!ll,ul=ll=null,t.current=n,ky(n),a0(),We=a,Xe=s,tn.transition=i}else t.current=n;if(Fi&&(Fi=!1,qn=t,Rs=o),i=t.pendingLanes,i===0&&(tr=null),c0(n.stateNode),$t(t,ft()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)o=e[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(_s)throw _s=!1,t=_l,_l=null,t;return Rs&1&&t.tag!==0&&ro(),i=t.pendingLanes,i&1?t===Rl?Yo++:(Yo=0,Rl=t):Yo=0,ur(),null}function ro(){if(qn!==null){var t=Fh(Rs),e=tn.transition,n=Xe;try{if(tn.transition=null,Xe=16>t?16:t,qn===null)var r=!1;else{if(t=qn,qn=null,Rs=0,We&6)throw Error(me(331));var o=We;for(We|=4,Ie=t.current;Ie!==null;){var i=Ie,s=i.child;if(Ie.flags&16){var a=i.deletions;if(a!==null){for(var c=0;c<a.length;c++){var d=a[c];for(Ie=d;Ie!==null;){var h=Ie;switch(h.tag){case 0:case 11:case 15:zo(8,h,i)}var m=h.child;if(m!==null)m.return=h,Ie=m;else for(;Ie!==null;){h=Ie;var p=h.sibling,g=h.return;if(Kp(h),h===d){Ie=null;break}if(p!==null){p.return=g,Ie=p;break}Ie=g}}}var E=i.alternate;if(E!==null){var x=E.child;if(x!==null){E.child=null;do{var w=x.sibling;x.sibling=null,x=w}while(x!==null)}}Ie=i}}if(i.subtreeFlags&2064&&s!==null)s.return=i,Ie=s;else e:for(;Ie!==null;){if(i=Ie,i.flags&2048)switch(i.tag){case 0:case 11:case 15:zo(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,Ie=y;break e}Ie=i.return}}var v=t.current;for(Ie=v;Ie!==null;){s=Ie;var T=s.child;if(s.subtreeFlags&2064&&T!==null)T.return=s,Ie=T;else e:for(s=v;Ie!==null;){if(a=Ie,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ks(9,a)}}catch(A){dt(a,a.return,A)}if(a===s){Ie=null;break e}var I=a.sibling;if(I!==null){I.return=a.return,Ie=I;break e}Ie=a.return}}if(We=o,ur(),wn&&typeof wn.onPostCommitFiberRoot=="function")try{wn.onPostCommitFiberRoot(Bs,t)}catch{}r=!0}return r}finally{Xe=n,tn.transition=e}}return!1}function fd(t,e,n){e=fo(n,e),e=Fp(t,e,1),t=er(t,e,1),e=Lt(),t!==null&&(fi(t,1,e),$t(t,e))}function dt(t,e,n){if(t.tag===3)fd(t,t,n);else for(;e!==null;){if(e.tag===3){fd(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(tr===null||!tr.has(r))){t=fo(n,t),t=Gp(e,t,1),e=er(e,t,1),t=Lt(),e!==null&&(fi(e,1,t),$t(e,t));break}}e=e.return}}function Uy(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Lt(),t.pingedLanes|=t.suspendedLanes&n,Tt===t&&(Ct&n)===n&&(yt===4||yt===3&&(Ct&130023424)===Ct&&500>ft()-Ou?xr(t,0):Pu|=n),$t(t,e)}function im(t,e){e===0&&(t.mode&1?(e=Ai,Ai<<=1,!(Ai&130023424)&&(Ai=4194304)):e=1);var n=Lt();t=On(t,e),t!==null&&(fi(t,e,n),$t(t,n))}function Fy(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),im(t,n)}function Gy(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,o=t.memoizedState;o!==null&&(n=o.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(me(314))}r!==null&&r.delete(e),im(t,n)}var sm;sm=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||jt.current)Bt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Bt=!1,Iy(t,e,n);Bt=!!(t.flags&131072)}else Bt=!1,ot&&e.flags&1048576&&cp(e,Ts,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ns(t,e),t=e.pendingProps;var o=ao(e,Pt.current);no(e,n),o=Iu(null,e,r,t,o,n);var i=bu();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Vt(r)?(i=!0,xs(e)):i=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Tu(e),o.updater=qs,e.stateNode=o,o._reactInternals=e,vl(e,r,t,n),e=Tl(null,e,r,!0,i,n)):(e.tag=0,ot&&i&&pu(e),Mt(null,e,o,n),e=e.child),e;case 16:r=e.elementType;e:{switch(ns(t,e),t=e.pendingProps,o=r._init,r=o(r._payload),e.type=r,o=e.tag=By(r),t=un(r,t),o){case 0:e=El(null,e,r,t,n);break e;case 1:e=nd(null,e,r,t,n);break e;case 11:e=ed(null,e,r,t,n);break e;case 14:e=td(null,e,r,un(r.type,t),n);break e}throw Error(me(306,r,""))}return e;case 0:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:un(r,o),El(t,e,r,o,n);case 1:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:un(r,o),nd(t,e,r,o,n);case 3:e:{if(Vp(e),t===null)throw Error(me(387));r=e.pendingProps,i=e.memoizedState,o=i.element,gp(t,e),Ns(e,r,null,n);var s=e.memoizedState;if(r=s.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){o=fo(Error(me(423)),e),e=rd(t,e,r,n,o);break e}else if(r!==o){o=fo(Error(me(424)),e),e=rd(t,e,r,n,o);break e}else for(Yt=Qn(e.stateNode.containerInfo.firstChild),qt=e,ot=!0,dn=null,n=pp(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(lo(),r===o){e=Mn(t,e,n);break e}Mt(t,e,r,n)}e=e.child}return e;case 5:return yp(e),t===null&&ml(e),r=e.type,o=e.pendingProps,i=t!==null?t.memoizedProps:null,s=o.children,cl(r,o)?s=null:i!==null&&cl(r,i)&&(e.flags|=32),jp(t,e),Mt(t,e,s,n),e.child;case 6:return t===null&&ml(e),null;case 13:return $p(t,e,n);case 4:return Su(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=uo(e,null,r,n):Mt(t,e,r,n),e.child;case 11:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:un(r,o),ed(t,e,r,o,n);case 7:return Mt(t,e,e.pendingProps,n),e.child;case 8:return Mt(t,e,e.pendingProps.children,n),e.child;case 12:return Mt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,o=e.pendingProps,i=e.memoizedProps,s=o.value,et(Ss,r._currentValue),r._currentValue=s,i!==null)if(gn(i.value,s)){if(i.children===o.children&&!jt.current){e=Mn(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){s=i.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Rn(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),gl(i.return,n,e),a.lanes|=n;break}c=c.next}}else if(i.tag===10)s=i.type===e.type?null:i.child;else if(i.tag===18){if(s=i.return,s===null)throw Error(me(341));s.lanes|=n,a=s.alternate,a!==null&&(a.lanes|=n),gl(s,n,e),s=i.sibling}else s=i.child;if(s!==null)s.return=i;else for(s=i;s!==null;){if(s===e){s=null;break}if(i=s.sibling,i!==null){i.return=s.return,s=i;break}s=s.return}i=s}Mt(t,e,o.children,n),e=e.child}return e;case 9:return o=e.type,r=e.pendingProps.children,no(e,n),o=rn(o),r=r(o),e.flags|=1,Mt(t,e,r,n),e.child;case 14:return r=e.type,o=un(r,e.pendingProps),o=un(r.type,o),td(t,e,r,o,n);case 15:return Hp(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:un(r,o),ns(t,e),e.tag=1,Vt(r)?(t=!0,xs(e)):t=!1,no(e,n),Up(e,r,o),vl(e,r,o,n),Tl(null,e,r,!0,t,n);case 19:return zp(t,e,n);case 22:return Bp(t,e,n)}throw Error(me(156,e.tag))};function am(t,e){return Mh(t,e)}function Hy(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function en(t,e,n,r){return new Hy(t,e,n,r)}function Uu(t){return t=t.prototype,!(!t||!t.isReactComponent)}function By(t){if(typeof t=="function")return Uu(t)?1:0;if(t!=null){if(t=t.$$typeof,t===nu)return 11;if(t===ru)return 14}return 2}function rr(t,e){var n=t.alternate;return n===null?(n=en(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function is(t,e,n,r,o,i){var s=2;if(r=t,typeof t=="function")Uu(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case Ur:return Er(n.children,o,i,e);case tu:s=8,o|=8;break;case ja:return t=en(12,n,e,o|2),t.elementType=ja,t.lanes=i,t;case Va:return t=en(13,n,e,o),t.elementType=Va,t.lanes=i,t;case $a:return t=en(19,n,e,o),t.elementType=$a,t.lanes=i,t;case yh:return Xs(n,o,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case mh:s=10;break e;case gh:s=9;break e;case nu:s=11;break e;case ru:s=14;break e;case Vn:s=16,r=null;break e}throw Error(me(130,t==null?t:typeof t,""))}return e=en(s,n,e,o),e.elementType=t,e.type=r,e.lanes=i,e}function Er(t,e,n,r){return t=en(7,t,r,e),t.lanes=n,t}function Xs(t,e,n,r){return t=en(22,t,r,e),t.elementType=yh,t.lanes=n,t.stateNode={isHidden:!1},t}function Ma(t,e,n){return t=en(6,t,null,e),t.lanes=n,t}function La(t,e,n){return e=en(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function jy(t,e,n,r,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ma(0),this.expirationTimes=ma(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ma(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Fu(t,e,n,r,o,i,s,a,c){return t=new jy(t,e,n,a,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=en(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Tu(i),t}function Vy(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Dr,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function lm(t){if(!t)return ir;t=t._reactInternals;e:{if(_r(t)!==t||t.tag!==1)throw Error(me(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Vt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(me(171))}if(t.tag===1){var n=t.type;if(Vt(n))return lp(t,n,e)}return e}function um(t,e,n,r,o,i,s,a,c){return t=Fu(n,r,!0,t,o,i,s,a,c),t.context=lm(null),n=t.current,r=Lt(),o=nr(n),i=Rn(r,o),i.callback=e??null,er(n,i,o),t.current.lanes=o,fi(t,o,r),$t(t,r),t}function Zs(t,e,n,r){var o=e.current,i=Lt(),s=nr(o);return n=lm(n),e.context===null?e.context=n:e.pendingContext=n,e=Rn(i,s),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=er(o,e,s),t!==null&&(hn(t,o,s,i),Qi(t,o,s)),s}function Ps(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function hd(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Gu(t,e){hd(t,e),(t=t.alternate)&&hd(t,e)}function $y(){return null}var cm=typeof reportError=="function"?reportError:function(t){console.error(t)};function Hu(t){this._internalRoot=t}Qs.prototype.render=Hu.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(me(409));Zs(t,e,null,null)};Qs.prototype.unmount=Hu.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;br(function(){Zs(null,t,null,null)}),e[Pn]=null}};function Qs(t){this._internalRoot=t}Qs.prototype.unstable_scheduleHydration=function(t){if(t){var e=Bh();t={blockedOn:null,target:t,priority:e};for(var n=0;n<zn.length&&e!==0&&e<zn[n].priority;n++);zn.splice(n,0,t),n===0&&Vh(t)}};function Bu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ea(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function pd(){}function zy(t,e,n,r,o){if(o){if(typeof r=="function"){var i=r;r=function(){var d=Ps(s);i.call(d)}}var s=um(e,r,t,0,null,!1,!1,"",pd);return t._reactRootContainer=s,t[Pn]=s.current,ni(t.nodeType===8?t.parentNode:t),br(),s}for(;o=t.lastChild;)t.removeChild(o);if(typeof r=="function"){var a=r;r=function(){var d=Ps(c);a.call(d)}}var c=Fu(t,0,!1,null,null,!1,!1,"",pd);return t._reactRootContainer=c,t[Pn]=c.current,ni(t.nodeType===8?t.parentNode:t),br(function(){Zs(e,c,n,r)}),c}function ta(t,e,n,r,o){var i=n._reactRootContainer;if(i){var s=i;if(typeof o=="function"){var a=o;o=function(){var c=Ps(s);a.call(c)}}Zs(e,s,t,o)}else s=zy(n,e,t,o,r);return Ps(s)}Gh=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Do(e.pendingLanes);n!==0&&(su(e,n|1),$t(e,ft()),!(We&6)&&(ho=ft()+500,ur()))}break;case 13:br(function(){var r=On(t,1);if(r!==null){var o=Lt();hn(r,t,1,o)}}),Gu(t,1)}};au=function(t){if(t.tag===13){var e=On(t,134217728);if(e!==null){var n=Lt();hn(e,t,134217728,n)}Gu(t,134217728)}};Hh=function(t){if(t.tag===13){var e=nr(t),n=On(t,e);if(n!==null){var r=Lt();hn(n,t,e,r)}Gu(t,e)}};Bh=function(){return Xe};jh=function(t,e){var n=Xe;try{return Xe=t,e()}finally{Xe=n}};el=function(t,e,n){switch(e){case"input":if(Ya(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var o=zs(r);if(!o)throw Error(me(90));xh(r),Ya(r,o)}}}break;case"textarea":Th(t,n);break;case"select":e=n.value,e!=null&&Zr(t,!!n.multiple,e,!1)}};Ah=Mu;_h=br;var Wy={usingClientEntryPoint:!1,Events:[pi,Br,zs,Ih,bh,Mu]},ko={findFiberByHostInstance:gr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Yy={bundleType:ko.bundleType,version:ko.version,rendererPackageName:ko.rendererPackageName,rendererConfig:ko.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Dn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Ph(t),t===null?null:t.stateNode},findFiberByHostInstance:ko.findFiberByHostInstance||$y,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gi.isDisabled&&Gi.supportsFiber)try{Bs=Gi.inject(Yy),wn=Gi}catch{}}Jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wy;Jt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bu(e))throw Error(me(200));return Vy(t,e,null,n)};Jt.createRoot=function(t,e){if(!Bu(t))throw Error(me(299));var n=!1,r="",o=cm;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=Fu(t,1,!1,null,null,n,!1,r,o),t[Pn]=e.current,ni(t.nodeType===8?t.parentNode:t),new Hu(e)};Jt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(me(188)):(t=Object.keys(t).join(","),Error(me(268,t)));return t=Ph(e),t=t===null?null:t.stateNode,t};Jt.flushSync=function(t){return br(t)};Jt.hydrate=function(t,e,n){if(!ea(e))throw Error(me(200));return ta(null,t,e,!0,n)};Jt.hydrateRoot=function(t,e,n){if(!Bu(t))throw Error(me(405));var r=n!=null&&n.hydratedSources||null,o=!1,i="",s=cm;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),e=um(e,null,t,1,n??null,o,!1,i,s),t[Pn]=e.current,ni(t),r)for(t=0;t<r.length;t++)n=r[t],o=n._getVersion,o=o(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,o]:e.mutableSourceEagerHydrationData.push(n,o);return new Qs(e)};Jt.render=function(t,e,n){if(!ea(e))throw Error(me(200));return ta(null,t,e,!1,n)};Jt.unmountComponentAtNode=function(t){if(!ea(t))throw Error(me(40));return t._reactRootContainer?(br(function(){ta(null,null,t,!1,function(){t._reactRootContainer=null,t[Pn]=null})}),!0):!1};Jt.unstable_batchedUpdates=Mu;Jt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!ea(n))throw Error(me(200));if(t==null||t._reactInternals===void 0)throw Error(me(38));return ta(t,e,n,!1,r)};Jt.version="18.3.1-next-f1338f8080-20240426";function dm(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(dm)}catch(t){console.error(t)}}dm(),dh.exports=Jt;var qy=dh.exports,md=qy;Ha.createRoot=md.createRoot,Ha.hydrateRoot=md.hydrateRoot;let Hi;const Ky=new Uint8Array(16);function Jy(){if(!Hi&&(Hi=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Hi))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Hi(Ky)}const wt=[];for(let t=0;t<256;++t)wt.push((t+256).toString(16).slice(1));function Xy(t,e=0){return wt[t[e+0]]+wt[t[e+1]]+wt[t[e+2]]+wt[t[e+3]]+"-"+wt[t[e+4]]+wt[t[e+5]]+"-"+wt[t[e+6]]+wt[t[e+7]]+"-"+wt[t[e+8]]+wt[t[e+9]]+"-"+wt[t[e+10]]+wt[t[e+11]]+wt[t[e+12]]+wt[t[e+13]]+wt[t[e+14]]+wt[t[e+15]]}const Zy=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),gd={randomUUID:Zy};function Da(t,e,n){if(gd.randomUUID&&!t)return gd.randomUUID();t=t||{};const r=t.random||(t.rng||Jy)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Xy(r)}const Qy="SintongBangtongDB_v2",sr="projects_v2",ju=()=>new Promise((t,e)=>{if(typeof window>"u"||!window.indexedDB){e(new Error("IndexedDB is not supported"));return}const n=indexedDB.open(Qy,2);n.onupgradeneeded=r=>{const o=r.target.result;o.objectStoreNames.contains(sr)||o.createObjectStore(sr)},n.onsuccess=()=>t(n.result),n.onerror=()=>e(n.error)}),hr=async(t,e)=>{try{const n=await ju();return new Promise((r,o)=>{const a=n.transaction(sr,"readwrite").objectStore(sr).put(e,t);a.onsuccess=()=>r(),a.onerror=()=>o(a.error)})}catch(n){console.error("IndexedDB Save Error:",n)}},Mr=async t=>{try{const e=await ju();return new Promise((n,r)=>{const s=e.transaction(sr,"readonly").objectStore(sr).get(t);s.onsuccess=()=>n(s.result),s.onerror=()=>r(s.error)})}catch(e){return console.error("IndexedDB Load Error:",e),null}},pr=async t=>{try{const e=await ju();return new Promise((n,r)=>{const s=e.transaction(sr,"readwrite").objectStore(sr).delete(t);s.onsuccess=()=>n(),s.onerror=()=>r(s.error)})}catch(e){console.error("IndexedDB Delete Error:",e)}},fm=ue.createContext(void 0),yd=`[  ]
1. :    . (  ,      )
2.   ():
   -   **()  ** . (     ).
   -       .
   -  :  ** **. (   ).
   -  : , ,   .
3.   ():
   -    .   .
   -  :  (),   /, , ,  .
   -   .`,ev=({children:t})=>{const[e,n]=ue.useState(""),[r,o]=ue.useState(""),[i,s]=ue.useState([]),[a,c]=ue.useState("webtoon"),[d,h]=ue.useState("16:9"),[m,p]=ue.useState([]),[g,E]=ue.useState([]),[x,w]=ue.useState([]),[y,v]=ue.useState([]),[T,I]=ue.useState(!0),[A,O]=ue.useState(yd),[k,j]=ue.useState({}),[D,V]=ue.useState(!1),[X,_]=ue.useState(null),[z,N]=ue.useState(null);ue.useEffect(()=>{if(i.length>0){const he=i.map(xe=>`[${xe.title}]
${xe.content}`).join(`

`);o(he)}},[i]),ue.useEffect(()=>{(async()=>{const xe=localStorage.getItem("sb_api_key_v2");xe&&n(xe);try{let be=await Mr("currentProject_v2");if(!be){const Le=localStorage.getItem("sb_project_data_v2");if(Le)try{be=JSON.parse(Le)}catch(it){console.error("Failed to parse LocalStorage data",it)}}be&&(o(be.script||""),be.scriptSegments&&be.scriptSegments.length>0?s(be.scriptSegments):be.script&&!be.scriptSegments&&s([{id:Da(),title:" ",content:be.script}]),c(be.selectedStyle||"webtoon"),p(be.scenes||[]),E(be.characters||[]),w(be.referenceImages||[]),v(be.props||[]),be.globalAspectRatio&&h(be.globalAspectRatio),be.globalScenePrompt&&O(be.globalScenePrompt))}catch(be){console.error("Load failed",be)}finally{V(!0)}})()},[]);const te=he=>{o(he),i.length===0&&s([{id:Da(),title:" ",content:he}])},ge=(he,xe)=>{const be={id:Da(),title:he,content:xe};s(Le=>[...Le,be])},J=he=>{s(xe=>xe.filter(be=>be.id!==he))},K=(he,xe)=>{s(be=>be.map(Le=>Le.id===he?{...Le,content:xe}:Le))},M=()=>{s([]),o("")},ce=()=>{hr("currentProject_v2",{script:r,scriptSegments:i,selectedStyle:a,scenes:m,characters:g,referenceImages:x,props:y,globalAspectRatio:d,globalScenePrompt:A,userOptions:k}).catch(xe=>{console.warn("Failed to save to IndexedDB",xe),$("   (   )","error")})};ue.useEffect(()=>{if(!D)return;const he=setTimeout(ce,2e3);return()=>clearTimeout(he)},[r,i,a,m,g,x,y,d,A,k,D]),ue.useEffect(()=>{e&&localStorage.setItem("sb_api_key_v2",e)},[e]);const W=async()=>{o(""),s([]),p([]),E([]),w([]),v([]),O(yd),j({}),localStorage.removeItem("sb_project_data_v2"),await pr("currentProject_v2"),$(" . (  )","success")},$=(he,xe="success")=>{_({message:he,type:xe})},Te=()=>_(null),q=he=>N(he),Q=()=>N(null),Me=(he,xe)=>{j(be=>({...be,[he]:[...be[he]||[],xe]})),$(`  '${xe.label}'() .`,"success")},Be=(he,xe)=>{j(be=>({...be,[he]:(be[he]||[]).filter(Le=>Le.label!==xe)})),$(` '${xe}'() .`,"success")};return u.jsx(fm.Provider,{value:{apiKey:e,setApiKey:n,script:r,setScript:te,scriptSegments:i,addScriptSegment:ge,removeScriptSegment:J,updateScriptSegment:K,clearScriptSegments:M,selectedStyle:a,setSelectedStyle:c,globalAspectRatio:d,setGlobalAspectRatio:h,scenes:m,setScenes:p,characters:g,setCharacters:E,referenceImages:x,setReferenceImages:w,props:y,setProps:v,isContinuityMode:T,setIsContinuityMode:I,globalScenePrompt:A,setGlobalScenePrompt:O,userOptions:k,addUserOption:Me,removeUserOption:Be,saveProject:ce,resetProject:W,toast:X,showToast:$,closeToast:Te,modalConfig:z,openModal:q,closeModal:Q},children:t})},yn=()=>{const t=ue.useContext(fm);if(!t)throw new Error("useProject must be used within a ProjectProvider");return t};var tv={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let nv,rv;function ov(){return{geminiUrl:nv,vertexUrl:rv}}function iv(t,e,n,r){var o,i;if(!(t!=null&&t.baseUrl)){const s=ov();return e?(o=s.vertexUrl)!==null&&o!==void 0?o:n:(i=s.geminiUrl)!==null&&i!==void 0?i:r}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Un{}function Ne(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(r,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){const i=e[o];return i!=null?String(i):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function f(t,e,n){for(let i=0;i<e.length-1;i++){const s=e[i];if(s.endsWith("[]")){const a=s.slice(0,-2);if(!(a in t))if(Array.isArray(n))t[a]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(t[a])){const c=t[a];if(Array.isArray(n))for(let d=0;d<c.length;d++){const h=c[d];f(h,e.slice(i+1),n[d])}else for(const d of c)f(d,e.slice(i+1),n)}return}else if(s.endsWith("[0]")){const a=s.slice(0,-3);a in t||(t[a]=[{}]);const c=t[a];f(c[0],e.slice(i+1),n);return}(!t[s]||typeof t[s]!="object")&&(t[s]={}),t=t[s]}const r=e[e.length-1],o=t[r];if(o!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===o)return;if(typeof o=="object"&&typeof n=="object"&&o!==null&&n!==null)Object.assign(o,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function l(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return n;const o=e[r];if(o.endsWith("[]")){const i=o.slice(0,-2);if(i in t){const s=t[i];return Array.isArray(s)?s.map(a=>l(a,e.slice(r+1),n)):n}else return n}else t=t[o]}return t}catch(r){if(r instanceof TypeError)return n;throw r}}function sv(t,e){for(const[n,r]of Object.entries(e)){const o=n.split("."),i=r.split("."),s=new Set;let a=-1;for(let c=0;c<o.length;c++)if(o[c]==="*"){a=c;break}if(a!==-1&&i.length>a)for(let c=a;c<i.length;c++){const d=i[c];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&s.add(d)}Ol(t,o,i,0,s)}}function Ol(t,e,n,r,o){if(r>=e.length||typeof t!="object"||t===null)return;const i=e[r];if(i.endsWith("[]")){const s=i.slice(0,-2),a=t;if(s in a&&Array.isArray(a[s]))for(const c of a[s])Ol(c,e,n,r+1,o)}else if(i==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const s=t,a=Object.keys(s).filter(d=>!d.startsWith("_")&&!o.has(d)),c={};for(const d of a)c[d]=s[d];for(const[d,h]of Object.entries(c)){const m=[];for(const p of n.slice(r))p==="*"?m.push(d):m.push(p);f(s,m,h)}for(const d of a)delete s[d]}}else{const s=t;i in s&&Ol(s[i],e,n,r+1,o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Vu(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function av(t){const e={},n=l(t,["operationName"]);n!=null&&f(e,["operationName"],n);const r=l(t,["resourceName"]);return r!=null&&f(e,["_url","resourceName"],r),e}function lv(t){const e={},n=l(t,["name"]);n!=null&&f(e,["name"],n);const r=l(t,["metadata"]);r!=null&&f(e,["metadata"],r);const o=l(t,["done"]);o!=null&&f(e,["done"],o);const i=l(t,["error"]);i!=null&&f(e,["error"],i);const s=l(t,["response","generateVideoResponse"]);return s!=null&&f(e,["response"],cv(s)),e}function uv(t){const e={},n=l(t,["name"]);n!=null&&f(e,["name"],n);const r=l(t,["metadata"]);r!=null&&f(e,["metadata"],r);const o=l(t,["done"]);o!=null&&f(e,["done"],o);const i=l(t,["error"]);i!=null&&f(e,["error"],i);const s=l(t,["response"]);return s!=null&&f(e,["response"],dv(s)),e}function cv(t){const e={},n=l(t,["generatedSamples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>fv(s))),f(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&f(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&f(e,["raiMediaFilteredReasons"],o),e}function dv(t){const e={},n=l(t,["videos"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>hv(s))),f(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&f(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&f(e,["raiMediaFilteredReasons"],o),e}function fv(t){const e={},n=l(t,["video"]);return n!=null&&f(e,["video"],xv(n)),e}function hv(t){const e={},n=l(t,["_self"]);return n!=null&&f(e,["video"],Ev(n)),e}function pv(t){const e={},n=l(t,["operationName"]);return n!=null&&f(e,["_url","operationName"],n),e}function mv(t){const e={},n=l(t,["operationName"]);return n!=null&&f(e,["_url","operationName"],n),e}function gv(t){const e={},n=l(t,["name"]);n!=null&&f(e,["name"],n);const r=l(t,["metadata"]);r!=null&&f(e,["metadata"],r);const o=l(t,["done"]);o!=null&&f(e,["done"],o);const i=l(t,["error"]);i!=null&&f(e,["error"],i);const s=l(t,["response"]);return s!=null&&f(e,["response"],yv(s)),e}function yv(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["parent"]);r!=null&&f(e,["parent"],r);const o=l(t,["documentName"]);return o!=null&&f(e,["documentName"],o),e}function hm(t){const e={},n=l(t,["name"]);n!=null&&f(e,["name"],n);const r=l(t,["metadata"]);r!=null&&f(e,["metadata"],r);const o=l(t,["done"]);o!=null&&f(e,["done"],o);const i=l(t,["error"]);i!=null&&f(e,["error"],i);const s=l(t,["response"]);return s!=null&&f(e,["response"],vv(s)),e}function vv(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["parent"]);r!=null&&f(e,["parent"],r);const o=l(t,["documentName"]);return o!=null&&f(e,["documentName"],o),e}function xv(t){const e={},n=l(t,["uri"]);n!=null&&f(e,["uri"],n);const r=l(t,["encodedVideo"]);r!=null&&f(e,["videoBytes"],Vu(r));const o=l(t,["encoding"]);return o!=null&&f(e,["mimeType"],o),e}function Ev(t){const e={},n=l(t,["gcsUri"]);n!=null&&f(e,["uri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&f(e,["videoBytes"],Vu(r));const o=l(t,["mimeType"]);return o!=null&&f(e,["mimeType"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var vd;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(vd||(vd={}));var xd;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(xd||(xd={}));var Ed;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(Ed||(Ed={}));var Kn;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(Kn||(Kn={}));var Td;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Td||(Td={}));var Sd;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Sd||(Sd={}));var wd;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(wd||(wd={}));var Nd;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(Nd||(Nd={}));var Cd;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Cd||(Cd={}));var Id;(function(t){t.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH",t.MINIMAL="MINIMAL"})(Id||(Id={}));var qr;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(qr||(qr={}));var bd;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(bd||(bd={}));var Kr;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(Kr||(Kr={}));var Ad;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE",t.IMAGE_RECITATION="IMAGE_RECITATION",t.IMAGE_OTHER="IMAGE_OTHER"})(Ad||(Ad={}));var _d;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(_d||(_d={}));var Rd;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Rd||(Rd={}));var kd;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(kd||(kd={}));var Pd;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(Pd||(Pd={}));var Od;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Od||(Od={}));var Os;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Os||(Os={}));var Md;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Md||(Md={}));var Ld;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Ld||(Ld={}));var Dd;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Dd||(Dd={}));var Ml;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Ml||(Ml={}));var Ud;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Ud||(Ud={}));var Fd;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",t.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(Fd||(Fd={}));var Gd;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Gd||(Gd={}));var Hd;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(Hd||(Hd={}));var Bd;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Bd||(Bd={}));var jd;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(jd||(jd={}));var Vd;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(Vd||(Vd={}));var $d;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})($d||($d={}));var zd;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(zd||(zd={}));var Wd;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(Wd||(Wd={}));var Yd;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Yd||(Yd={}));var qd;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(qd||(qd={}));var Kd;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Kd||(Kd={}));var Jd;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Jd||(Jd={}));var Xd;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(Xd||(Xd={}));var Zd;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(Zd||(Zd={}));var Qd;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(Qd||(Qd={}));var ef;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(ef||(ef={}));var tf;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(tf||(tf={}));var nf;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(nf||(nf={}));var rf;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(rf||(rf={}));var of;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(of||(of={}));var sf;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(sf||(sf={}));var af;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(af||(af={}));var lf;(function(t){t.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",t.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",t.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(lf||(lf={}));var uf;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(uf||(uf={}));var cf;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(cf||(cf={}));var df;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(df||(df={}));var ff;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(ff||(ff={}));var hf;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(hf||(hf={}));var pf;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(pf||(pf={}));var Jr;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(Jr||(Jr={}));class Ll{constructor(e){const n={};for(const r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class Po{get text(){var e,n,r,o,i,s,a,c;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1;const m=[];for(const p of(c=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)!==null&&c!==void 0?c:[]){for(const[g,E]of Object.entries(p))g!=="text"&&g!=="thought"&&g!=="thoughtSignature"&&(E!==null||E!==void 0)&&m.push(g);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;h=!0,d+=p.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var e,n,r,o,i,s,a,c;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const h=[];for(const m of(c=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)!==null&&c!==void 0?c:[]){for(const[p,g]of Object.entries(m))p!=="inlineData"&&(g!==null||g!==void 0)&&h.push(p);m.inlineData&&typeof m.inlineData.data=="string"&&(d+=atob(m.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,n,r,o,i,s,a,c;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,n,r,o,i,s,a,c,d;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(c=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,n,r,o,i,s,a,c,d;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(c=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.output}}class mf{}class gf{}class Tv{}class Sv{}class wv{}class Nv{}class yf{}class vf{}class xf{}class Cv{}class Ms{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new Ms;let o;const i=e;return n?o=uv(i):o=lv(i),Object.assign(r,o),r}}class Ef{}class Tf{}class Sf{}class wf{}class Iv{}class bv{}class Av{}class $u{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new $u,i=gv(e);return Object.assign(r,i),r}}class _v{}class Rv{}class kv{}class Nf{}class Pv{get text(){var e,n,r;let o="",i=!1;const s=[];for(const a of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[c,d]of Object.entries(a))c!=="text"&&c!=="thought"&&d!==null&&s.push(c);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;i=!0,o+=a.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?o:void 0}get data(){var e,n,r;let o="";const i=[];for(const s of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[a,c]of Object.entries(s))a!=="inlineData"&&c!==null&&i.push(a);s.inlineData&&typeof s.inlineData.data=="string"&&(o+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}}class Ov{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class zu{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new zu,i=hm(e);return Object.assign(r,i),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ye(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function pm(t,e){const n=Ye(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function mm(t){return Array.isArray(t)?t.map(e=>Ls(e)):[Ls(t)]}function Ls(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function gm(t){const e=Ls(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function ym(t){const e=Ls(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Cf(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function vm(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Cf(e)):[Cf(t)]}function Dl(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function If(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function bf(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function kt(t){if(t==null)throw new Error("ContentUnion is required");return Dl(t)?t:{role:"user",parts:vm(t)}}function Wu(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const r=kt(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){const n=kt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>kt(n)):[kt(e)]}function nn(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(If(t)||bf(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[kt(t)]}const e=[],n=[],r=Dl(t[0]);for(const o of t){const i=Dl(o);if(i!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(i)e.push(o);else{if(If(o)||bf(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(o)}}return r||e.push({role:"user",parts:vm(n)}),e}function Mv(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(Kn).includes(n[0].toUpperCase())?n[0].toUpperCase():Kn.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of n)e.anyOf.push({type:Object.values(Kn).includes(r.toUpperCase())?r.toUpperCase():Kn.TYPE_UNSPECIFIED})}}function oo(t){const e={},n=["items"],r=["anyOf"],o=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const i=t.anyOf;i!=null&&i.length==2&&(i[0].type==="null"?(e.nullable=!0,t=i[1]):i[1].type==="null"&&(e.nullable=!0,t=i[0])),t.type instanceof Array&&Mv(t.type,e);for(const[s,a]of Object.entries(t))if(a!=null)if(s=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(Kn).includes(a.toUpperCase())?a.toUpperCase():Kn.TYPE_UNSPECIFIED}else if(n.includes(s))e[s]=oo(a);else if(r.includes(s)){const c=[];for(const d of a){if(d.type=="null"){e.nullable=!0;continue}c.push(oo(d))}e[s]=c}else if(o.includes(s)){const c={};for(const[d,h]of Object.entries(a))c[d]=oo(h);e[s]=c}else{if(s==="additionalProperties")continue;e[s]=a}return e}function Yu(t){return oo(t)}function qu(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Ku(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function yo(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=oo(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=oo(e.response));return t}function vo(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function Lv(t,e,n,r=1){const o=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:o?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:o?`${n}/${e}`:e}function Fn(t,e){if(typeof e!="string")throw new Error("name must be a string");return Lv(t,e,"cachedContents")}function xm(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function cr(t){return Vu(t)}function Dv(t){return t!=null&&typeof t=="object"&&"name"in t}function Uv(t){return t!=null&&typeof t=="object"&&"video"in t}function Fv(t){return t!=null&&typeof t=="object"&&"uri"in t}function Em(t){var e;let n;if(Dv(t)&&(n=t.name),!(Fv(t)&&(n=t.uri,n===void 0))&&!(Uv(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const o=n.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${n}`);n=o[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Tm(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function Sm(t){for(const e of["models","tunedModels","publisherModels"])if(Gv(t,e))return t[e];return[]}function Gv(t,e){return t!==null&&typeof t=="object"&&e in t}function Hv(t,e={}){const n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function Bv(t,e={}){const n=[],r=new Set;for(const o of t){const i=o.name;if(r.has(i))throw new Error(`Duplicate function name ${i} found in MCP tools. Please ensure function names are unique.`);r.add(i);const s=Hv(o,e);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}function wm(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,o=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(o>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function jv(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Nm(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const o=n.inlinedResponses;if(!Array.isArray(o)||o.length===0)return t;let i=!1;for(const s of o){if(typeof s!="object"||s===null)continue;const c=s.response;if(typeof c!="object"||c===null)continue;if(c.embedding!==void 0){i=!0;break}}return i&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function xo(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function Cm(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Vv(t){const e={},n=l(t,["responsesFile"]);n!=null&&f(e,["fileName"],n);const r=l(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>wx(s))),f(e,["inlinedResponses"],i)}const o=l(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),f(e,["inlinedEmbedContentResponses"],i)}return e}function $v(t){const e={},n=l(t,["predictionsFormat"]);n!=null&&f(e,["format"],n);const r=l(t,["gcsDestination","outputUriPrefix"]);r!=null&&f(e,["gcsUri"],r);const o=l(t,["bigqueryDestination","outputUri"]);return o!=null&&f(e,["bigqueryUri"],o),e}function zv(t){const e={},n=l(t,["format"]);n!=null&&f(e,["predictionsFormat"],n);const r=l(t,["gcsUri"]);r!=null&&f(e,["gcsDestination","outputUriPrefix"],r);const o=l(t,["bigqueryUri"]);if(o!=null&&f(e,["bigqueryDestination","outputUri"],o),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(l(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function ss(t){const e={},n=l(t,["name"]);n!=null&&f(e,["name"],n);const r=l(t,["metadata","displayName"]);r!=null&&f(e,["displayName"],r);const o=l(t,["metadata","state"]);o!=null&&f(e,["state"],Cm(o));const i=l(t,["metadata","createTime"]);i!=null&&f(e,["createTime"],i);const s=l(t,["metadata","endTime"]);s!=null&&f(e,["endTime"],s);const a=l(t,["metadata","updateTime"]);a!=null&&f(e,["updateTime"],a);const c=l(t,["metadata","model"]);c!=null&&f(e,["model"],c);const d=l(t,["metadata","output"]);return d!=null&&f(e,["dest"],Vv(Nm(d))),e}function Ul(t){const e={},n=l(t,["name"]);n!=null&&f(e,["name"],n);const r=l(t,["displayName"]);r!=null&&f(e,["displayName"],r);const o=l(t,["state"]);o!=null&&f(e,["state"],Cm(o));const i=l(t,["error"]);i!=null&&f(e,["error"],i);const s=l(t,["createTime"]);s!=null&&f(e,["createTime"],s);const a=l(t,["startTime"]);a!=null&&f(e,["startTime"],a);const c=l(t,["endTime"]);c!=null&&f(e,["endTime"],c);const d=l(t,["updateTime"]);d!=null&&f(e,["updateTime"],d);const h=l(t,["model"]);h!=null&&f(e,["model"],h);const m=l(t,["inputConfig"]);m!=null&&f(e,["src"],Wv(m));const p=l(t,["outputConfig"]);p!=null&&f(e,["dest"],$v(Nm(p)));const g=l(t,["completionStats"]);return g!=null&&f(e,["completionStats"],g),e}function Wv(t){const e={},n=l(t,["instancesFormat"]);n!=null&&f(e,["format"],n);const r=l(t,["gcsSource","uris"]);r!=null&&f(e,["gcsUri"],r);const o=l(t,["bigquerySource","inputUri"]);return o!=null&&f(e,["bigqueryUri"],o),e}function Yv(t,e){const n={};if(l(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(l(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=l(e,["fileName"]);r!=null&&f(n,["fileName"],r);const o=l(e,["inlinedRequests"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>Sx(t,s))),f(n,["requests","requests"],i)}return n}function qv(t){const e={},n=l(t,["format"]);n!=null&&f(e,["instancesFormat"],n);const r=l(t,["gcsUri"]);r!=null&&f(e,["gcsSource","uris"],r);const o=l(t,["bigqueryUri"]);if(o!=null&&f(e,["bigquerySource","inputUri"],o),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function Kv(t){const e={},n=l(t,["data"]);if(n!=null&&f(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function Jv(t,e){const n={},r=l(e,["name"]);return r!=null&&f(n,["_url","name"],xo(t,r)),n}function Xv(t,e){const n={},r=l(e,["name"]);return r!=null&&f(n,["_url","name"],xo(t,r)),n}function Zv(t){const e={},n=l(t,["content"]);n!=null&&f(e,["content"],n);const r=l(t,["citationMetadata"]);r!=null&&f(e,["citationMetadata"],Qv(r));const o=l(t,["tokenCount"]);o!=null&&f(e,["tokenCount"],o);const i=l(t,["finishReason"]);i!=null&&f(e,["finishReason"],i);const s=l(t,["avgLogprobs"]);s!=null&&f(e,["avgLogprobs"],s);const a=l(t,["groundingMetadata"]);a!=null&&f(e,["groundingMetadata"],a);const c=l(t,["index"]);c!=null&&f(e,["index"],c);const d=l(t,["logprobsResult"]);d!=null&&f(e,["logprobsResult"],d);const h=l(t,["safetyRatings"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(g=>g)),f(e,["safetyRatings"],p)}const m=l(t,["urlContextMetadata"]);return m!=null&&f(e,["urlContextMetadata"],m),e}function Qv(t){const e={},n=l(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),f(e,["citations"],r)}return e}function Im(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>Rx(i))),f(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&f(e,["role"],r),e}function ex(t,e){const n={},r=l(t,["displayName"]);if(e!==void 0&&r!=null&&f(e,["batch","displayName"],r),l(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function tx(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&f(e,["displayName"],r);const o=l(t,["dest"]);return e!==void 0&&o!=null&&f(e,["outputConfig"],zv(jv(o))),n}function Af(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["src"]);o!=null&&f(n,["batch","inputConfig"],Yv(t,wm(t,o)));const i=l(e,["config"]);return i!=null&&ex(i,n),n}function nx(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["model"],Ye(t,r));const o=l(e,["src"]);o!=null&&f(n,["inputConfig"],qv(wm(t,o)));const i=l(e,["config"]);return i!=null&&tx(i,n),n}function rx(t,e){const n={},r=l(t,["displayName"]);return e!==void 0&&r!=null&&f(e,["batch","displayName"],r),n}function ox(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["src"]);o!=null&&f(n,["batch","inputConfig"],dx(t,o));const i=l(e,["config"]);return i!=null&&rx(i,n),n}function ix(t,e){const n={},r=l(e,["name"]);return r!=null&&f(n,["_url","name"],xo(t,r)),n}function sx(t,e){const n={},r=l(e,["name"]);return r!=null&&f(n,["_url","name"],xo(t,r)),n}function ax(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["name"]);r!=null&&f(e,["name"],r);const o=l(t,["done"]);o!=null&&f(e,["done"],o);const i=l(t,["error"]);return i!=null&&f(e,["error"],i),e}function lx(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["name"]);r!=null&&f(e,["name"],r);const o=l(t,["done"]);o!=null&&f(e,["done"],o);const i=l(t,["error"]);return i!=null&&f(e,["error"],i),e}function ux(t,e){const n={},r=l(e,["contents"]);if(r!=null){let i=Wu(t,r);Array.isArray(i)&&(i=i.map(s=>s)),f(n,["requests[]","request","content"],i)}const o=l(e,["config"]);return o!=null&&(f(n,["_self"],cx(o,n)),sv(n,{"requests[].*":"requests[].request.*"})),n}function cx(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&f(e,["requests[]","taskType"],r);const o=l(t,["title"]);e!==void 0&&o!=null&&f(e,["requests[]","title"],o);const i=l(t,["outputDimensionality"]);if(e!==void 0&&i!=null&&f(e,["requests[]","outputDimensionality"],i),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function dx(t,e){const n={},r=l(e,["fileName"]);r!=null&&f(n,["file_name"],r);const o=l(e,["inlinedRequests"]);return o!=null&&f(n,["requests"],ux(t,o)),n}function fx(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&f(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function hx(t){const e={},n=l(t,["id"]);n!=null&&f(e,["id"],n);const r=l(t,["args"]);r!=null&&f(e,["args"],r);const o=l(t,["name"]);if(o!=null&&f(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function px(t){const e={},n=l(t,["mode"]);n!=null&&f(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);if(r!=null&&f(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function mx(t,e,n){const r={},o=l(e,["systemInstruction"]);n!==void 0&&o!=null&&f(n,["systemInstruction"],Im(kt(o)));const i=l(e,["temperature"]);i!=null&&f(r,["temperature"],i);const s=l(e,["topP"]);s!=null&&f(r,["topP"],s);const a=l(e,["topK"]);a!=null&&f(r,["topK"],a);const c=l(e,["candidateCount"]);c!=null&&f(r,["candidateCount"],c);const d=l(e,["maxOutputTokens"]);d!=null&&f(r,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&f(r,["stopSequences"],h);const m=l(e,["responseLogprobs"]);m!=null&&f(r,["responseLogprobs"],m);const p=l(e,["logprobs"]);p!=null&&f(r,["logprobs"],p);const g=l(e,["presencePenalty"]);g!=null&&f(r,["presencePenalty"],g);const E=l(e,["frequencyPenalty"]);E!=null&&f(r,["frequencyPenalty"],E);const x=l(e,["seed"]);x!=null&&f(r,["seed"],x);const w=l(e,["responseMimeType"]);w!=null&&f(r,["responseMimeType"],w);const y=l(e,["responseSchema"]);y!=null&&f(r,["responseSchema"],Yu(y));const v=l(e,["responseJsonSchema"]);if(v!=null&&f(r,["responseJsonSchema"],v),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const T=l(e,["safetySettings"]);if(n!==void 0&&T!=null){let z=T;Array.isArray(z)&&(z=z.map(N=>kx(N))),f(n,["safetySettings"],z)}const I=l(e,["tools"]);if(n!==void 0&&I!=null){let z=vo(I);Array.isArray(z)&&(z=z.map(N=>Ox(yo(N)))),f(n,["tools"],z)}const A=l(e,["toolConfig"]);if(n!==void 0&&A!=null&&f(n,["toolConfig"],Px(A)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const O=l(e,["cachedContent"]);n!==void 0&&O!=null&&f(n,["cachedContent"],Fn(t,O));const k=l(e,["responseModalities"]);k!=null&&f(r,["responseModalities"],k);const j=l(e,["mediaResolution"]);j!=null&&f(r,["mediaResolution"],j);const D=l(e,["speechConfig"]);if(D!=null&&f(r,["speechConfig"],qu(D)),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const V=l(e,["thinkingConfig"]);V!=null&&f(r,["thinkingConfig"],V);const X=l(e,["imageConfig"]);X!=null&&f(r,["imageConfig"],Tx(X));const _=l(e,["enableEnhancedCivicAnswers"]);return _!=null&&f(r,["enableEnhancedCivicAnswers"],_),r}function gx(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>Zv(d))),f(e,["candidates"],c)}const o=l(t,["modelVersion"]);o!=null&&f(e,["modelVersion"],o);const i=l(t,["promptFeedback"]);i!=null&&f(e,["promptFeedback"],i);const s=l(t,["responseId"]);s!=null&&f(e,["responseId"],s);const a=l(t,["usageMetadata"]);return a!=null&&f(e,["usageMetadata"],a),e}function yx(t,e){const n={},r=l(e,["name"]);return r!=null&&f(n,["_url","name"],xo(t,r)),n}function vx(t,e){const n={},r=l(e,["name"]);return r!=null&&f(n,["_url","name"],xo(t,r)),n}function xx(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&f(e,["enableWidget"],n),e}function Ex(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&f(e,["timeRangeFilter"],n),e}function Tx(t){const e={},n=l(t,["aspectRatio"]);n!=null&&f(e,["aspectRatio"],n);const r=l(t,["imageSize"]);if(r!=null&&f(e,["imageSize"],r),l(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(l(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Sx(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["request","model"],Ye(t,r));const o=l(e,["contents"]);if(o!=null){let a=nn(o);Array.isArray(a)&&(a=a.map(c=>Im(c))),f(n,["request","contents"],a)}const i=l(e,["metadata"]);i!=null&&f(n,["metadata"],i);const s=l(e,["config"]);return s!=null&&f(n,["request","generationConfig"],mx(t,s,l(n,["request"],{}))),n}function wx(t){const e={},n=l(t,["response"]);n!=null&&f(e,["response"],gx(n));const r=l(t,["error"]);return r!=null&&f(e,["error"],r),e}function Nx(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&f(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);if(e!==void 0&&o!=null&&f(e,["_query","pageToken"],o),l(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function Cx(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&f(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);e!==void 0&&o!=null&&f(e,["_query","pageToken"],o);const i=l(t,["filter"]);return e!==void 0&&i!=null&&f(e,["_query","filter"],i),n}function Ix(t){const e={},n=l(t,["config"]);return n!=null&&Nx(n,e),e}function bx(t){const e={},n=l(t,["config"]);return n!=null&&Cx(n,e),e}function Ax(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&f(e,["nextPageToken"],r);const o=l(t,["operations"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>ss(s))),f(e,["batchJobs"],i)}return e}function _x(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&f(e,["nextPageToken"],r);const o=l(t,["batchPredictionJobs"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>Ul(s))),f(e,["batchJobs"],i)}return e}function Rx(t){const e={},n=l(t,["mediaResolution"]);n!=null&&f(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&f(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&f(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&f(e,["fileData"],fx(i));const s=l(t,["functionCall"]);s!=null&&f(e,["functionCall"],hx(s));const a=l(t,["functionResponse"]);a!=null&&f(e,["functionResponse"],a);const c=l(t,["inlineData"]);c!=null&&f(e,["inlineData"],Kv(c));const d=l(t,["text"]);d!=null&&f(e,["text"],d);const h=l(t,["thought"]);h!=null&&f(e,["thought"],h);const m=l(t,["thoughtSignature"]);m!=null&&f(e,["thoughtSignature"],m);const p=l(t,["videoMetadata"]);return p!=null&&f(e,["videoMetadata"],p),e}function kx(t){const e={},n=l(t,["category"]);if(n!=null&&f(e,["category"],n),l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=l(t,["threshold"]);return r!=null&&f(e,["threshold"],r),e}function Px(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&f(e,["functionCallingConfig"],px(n));const r=l(t,["retrievalConfig"]);return r!=null&&f(e,["retrievalConfig"],r),e}function Ox(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(m=>m)),f(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&f(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&f(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&f(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&f(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&f(e,["googleMaps"],xx(a));const c=l(t,["googleSearch"]);c!=null&&f(e,["googleSearch"],Ex(c));const d=l(t,["urlContext"]);return d!=null&&f(e,["urlContext"],d),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ln;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(Ln||(Ln={}));class Rr{constructor(e,n,r,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,o)}init(e,n,r){var o,i;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=n.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(i=(o=s.config)===null||o===void 0?void 0:o.pageSize)!==null&&i!==void 0?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Mx extends Un{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Rr(Ln.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)}}createInlinedGenerateContentRequest(e){const n=Af(this.apiClient,e),r=n._url,o=Ne("{model}:batchGenerateContent",r),a=n.batch.inputConfig.requests,c=a.requests,d=[];for(const h of c){const m=Object.assign({},h);if(m.systemInstruction){const p=m.systemInstruction;delete m.systemInstruction;const g=m.request;g.systemInstruction=p,m.request=g}d.push(m)}return a.requests=d,delete n.config,delete n._url,delete n._query,{path:o,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const r=n?Object.assign({},n):{},o=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${o}`),r.dest===void 0){const i=this.getGcsUri(e),s=this.getBigqueryUri(e);if(i)i.endsWith(".jsonl")?r.dest=`${i.slice(0,-6)}/dest`:r.dest=`${i}_dest_${o}`;else if(s)r.dest=`${s}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=nx(this.apiClient,e);return a=Ne("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Ul(h))}else{const d=Af(this.apiClient,e);return a=Ne("{model}:batchGenerateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>ss(h))}}async createEmbeddingsInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=ox(this.apiClient,e);return i=Ne("{model}:asyncBatchEmbedContent",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>ss(c))}}async get(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=vx(this.apiClient,e);return a=Ne("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Ul(h))}else{const d=yx(this.apiClient,e);return a=Ne("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>ss(h))}}async cancel(e){var n,r,o,i;let s="",a={};if(this.apiClient.isVertexAI()){const c=Xv(this.apiClient,e);s=Ne("batchPredictionJobs/{name}:cancel",c._url),a=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const c=Jv(this.apiClient,e);s=Ne("batches/{name}:cancel",c._url),a=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=bx(e);return a=Ne("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=_x(h),p=new Nf;return Object.assign(p,m),p})}else{const d=Ix(e);return a=Ne("batches",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=Ax(h),p=new Nf;return Object.assign(p,m),p})}}async delete(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=sx(this.apiClient,e);return a=Ne("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>lx(h))}else{const d=ix(this.apiClient,e);return a=Ne("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>ax(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Lx(t){const e={},n=l(t,["data"]);if(n!=null&&f(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function _f(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>oE(i))),f(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&f(e,["role"],r),e}function Dx(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&f(e,["ttl"],r);const o=l(t,["expireTime"]);e!==void 0&&o!=null&&f(e,["expireTime"],o);const i=l(t,["displayName"]);e!==void 0&&i!=null&&f(e,["displayName"],i);const s=l(t,["contents"]);if(e!==void 0&&s!=null){let h=nn(s);Array.isArray(h)&&(h=h.map(m=>_f(m))),f(e,["contents"],h)}const a=l(t,["systemInstruction"]);e!==void 0&&a!=null&&f(e,["systemInstruction"],_f(kt(a)));const c=l(t,["tools"]);if(e!==void 0&&c!=null){let h=c;Array.isArray(h)&&(h=h.map(m=>sE(m))),f(e,["tools"],h)}const d=l(t,["toolConfig"]);if(e!==void 0&&d!=null&&f(e,["toolConfig"],iE(d)),l(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function Ux(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&f(e,["ttl"],r);const o=l(t,["expireTime"]);e!==void 0&&o!=null&&f(e,["expireTime"],o);const i=l(t,["displayName"]);e!==void 0&&i!=null&&f(e,["displayName"],i);const s=l(t,["contents"]);if(e!==void 0&&s!=null){let m=nn(s);Array.isArray(m)&&(m=m.map(p=>p)),f(e,["contents"],m)}const a=l(t,["systemInstruction"]);e!==void 0&&a!=null&&f(e,["systemInstruction"],kt(a));const c=l(t,["tools"]);if(e!==void 0&&c!=null){let m=c;Array.isArray(m)&&(m=m.map(p=>aE(p))),f(e,["tools"],m)}const d=l(t,["toolConfig"]);e!==void 0&&d!=null&&f(e,["toolConfig"],d);const h=l(t,["kmsKeyName"]);return e!==void 0&&h!=null&&f(e,["encryption_spec","kmsKeyName"],h),n}function Fx(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["model"],pm(t,r));const o=l(e,["config"]);return o!=null&&Dx(o,n),n}function Gx(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["model"],pm(t,r));const o=l(e,["config"]);return o!=null&&Ux(o,n),n}function Hx(t,e){const n={},r=l(e,["name"]);return r!=null&&f(n,["_url","name"],Fn(t,r)),n}function Bx(t,e){const n={},r=l(e,["name"]);return r!=null&&f(n,["_url","name"],Fn(t,r)),n}function jx(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&f(e,["sdkHttpResponse"],n),e}function Vx(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&f(e,["sdkHttpResponse"],n),e}function $x(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&f(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function zx(t){const e={},n=l(t,["id"]);n!=null&&f(e,["id"],n);const r=l(t,["args"]);r!=null&&f(e,["args"],r);const o=l(t,["name"]);if(o!=null&&f(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Wx(t){const e={},n=l(t,["mode"]);n!=null&&f(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);if(r!=null&&f(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Yx(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&f(e,["description"],n);const r=l(t,["name"]);r!=null&&f(e,["name"],r);const o=l(t,["parameters"]);o!=null&&f(e,["parameters"],o);const i=l(t,["parametersJsonSchema"]);i!=null&&f(e,["parametersJsonSchema"],i);const s=l(t,["response"]);s!=null&&f(e,["response"],s);const a=l(t,["responseJsonSchema"]);return a!=null&&f(e,["responseJsonSchema"],a),e}function qx(t,e){const n={},r=l(e,["name"]);return r!=null&&f(n,["_url","name"],Fn(t,r)),n}function Kx(t,e){const n={},r=l(e,["name"]);return r!=null&&f(n,["_url","name"],Fn(t,r)),n}function Jx(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&f(e,["enableWidget"],n),e}function Xx(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&f(e,["timeRangeFilter"],n),e}function Zx(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&f(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&f(e,["_query","pageToken"],o),n}function Qx(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&f(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&f(e,["_query","pageToken"],o),n}function eE(t){const e={},n=l(t,["config"]);return n!=null&&Zx(n,e),e}function tE(t){const e={},n=l(t,["config"]);return n!=null&&Qx(n,e),e}function nE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&f(e,["nextPageToken"],r);const o=l(t,["cachedContents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),f(e,["cachedContents"],i)}return e}function rE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&f(e,["nextPageToken"],r);const o=l(t,["cachedContents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),f(e,["cachedContents"],i)}return e}function oE(t){const e={},n=l(t,["mediaResolution"]);n!=null&&f(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&f(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&f(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&f(e,["fileData"],$x(i));const s=l(t,["functionCall"]);s!=null&&f(e,["functionCall"],zx(s));const a=l(t,["functionResponse"]);a!=null&&f(e,["functionResponse"],a);const c=l(t,["inlineData"]);c!=null&&f(e,["inlineData"],Lx(c));const d=l(t,["text"]);d!=null&&f(e,["text"],d);const h=l(t,["thought"]);h!=null&&f(e,["thought"],h);const m=l(t,["thoughtSignature"]);m!=null&&f(e,["thoughtSignature"],m);const p=l(t,["videoMetadata"]);return p!=null&&f(e,["videoMetadata"],p),e}function iE(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&f(e,["functionCallingConfig"],Wx(n));const r=l(t,["retrievalConfig"]);return r!=null&&f(e,["retrievalConfig"],r),e}function sE(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(m=>m)),f(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&f(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&f(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&f(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&f(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&f(e,["googleMaps"],Jx(a));const c=l(t,["googleSearch"]);c!=null&&f(e,["googleSearch"],Xx(c));const d=l(t,["urlContext"]);return d!=null&&f(e,["urlContext"],d),e}function aE(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let m=n;Array.isArray(m)&&(m=m.map(p=>Yx(p))),f(e,["functionDeclarations"],m)}const r=l(t,["retrieval"]);r!=null&&f(e,["retrieval"],r);const o=l(t,["googleSearchRetrieval"]);o!=null&&f(e,["googleSearchRetrieval"],o);const i=l(t,["computerUse"]);if(i!=null&&f(e,["computerUse"],i),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=l(t,["codeExecution"]);s!=null&&f(e,["codeExecution"],s);const a=l(t,["enterpriseWebSearch"]);a!=null&&f(e,["enterpriseWebSearch"],a);const c=l(t,["googleMaps"]);c!=null&&f(e,["googleMaps"],c);const d=l(t,["googleSearch"]);d!=null&&f(e,["googleSearch"],d);const h=l(t,["urlContext"]);return h!=null&&f(e,["urlContext"],h),e}function lE(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&f(e,["ttl"],r);const o=l(t,["expireTime"]);return e!==void 0&&o!=null&&f(e,["expireTime"],o),n}function uE(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&f(e,["ttl"],r);const o=l(t,["expireTime"]);return e!==void 0&&o!=null&&f(e,["expireTime"],o),n}function cE(t,e){const n={},r=l(e,["name"]);r!=null&&f(n,["_url","name"],Fn(t,r));const o=l(e,["config"]);return o!=null&&lE(o,n),n}function dE(t,e){const n={},r=l(e,["name"]);r!=null&&f(n,["_url","name"],Fn(t,r));const o=l(e,["config"]);return o!=null&&uE(o,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fE extends Un{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Rr(Ln.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=Gx(this.apiClient,e);return a=Ne("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=Fx(this.apiClient,e);return a=Ne("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async get(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=Kx(this.apiClient,e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=qx(this.apiClient,e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async delete(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=Bx(this.apiClient,e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=Vx(h),p=new Sf;return Object.assign(p,m),p})}else{const d=Hx(this.apiClient,e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=jx(h),p=new Sf;return Object.assign(p,m),p})}}async update(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=dE(this.apiClient,e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=cE(this.apiClient,e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async listInternal(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=tE(e);return a=Ne("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=rE(h),p=new wf;return Object.assign(p,m),p})}else{const d=eE(e);return a=Ne("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=nE(h),p=new wf;return Object.assign(p,m),p})}}}function Ds(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function Rf(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fe(t){return this instanceof Fe?(this.v=t,this):new Fe(t)}function pn(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(g){return function(E){return Promise.resolve(E).then(g,m)}}function a(g,E){r[g]&&(o[g]=function(x){return new Promise(function(w,y){i.push([g,x,w,y])>1||c(g,x)})},E&&(o[g]=E(o[g])))}function c(g,E){try{d(r[g](E))}catch(x){p(i[0][3],x)}}function d(g){g.value instanceof Fe?Promise.resolve(g.value.v).then(h,m):p(i[0][2],g)}function h(g){c("next",g)}function m(g){c("throw",g)}function p(g,E){g(E),i.shift(),i.length&&c(i[0][0],i[0][1])}}function mn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Rf=="function"?Rf(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=t[i]&&function(s){return new Promise(function(a,c){s=t[i](s),o(a,c,s.done,s.value)})}}function o(i,s,a,c){Promise.resolve(c).then(function(d){i({value:d,done:a})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hE(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:bm(n)}function bm(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function pE(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function kf(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{const o=[];let i=!0;for(;r<n&&t[r].role==="model";)o.push(t[r]),i&&!bm(t[r])&&(i=!1),r++;i?e.push(...o):e.pop()}return e}class mE{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new gE(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class gE{constructor(e,n,r,o={},i=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=o,this.history=i,this.sendPromise=Promise.resolve(),pE(i)}async sendMessage(e){var n;await this.sendPromise;const r=kt(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var i,s,a;const c=await o,d=(s=(i=c.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content,h=c.automaticFunctionCallingHistory,m=this.getHistory(!0).length;let p=[];h!=null&&(p=(a=h.slice(m))!==null&&a!==void 0?a:[]);const g=d?[d]:[];this.recordHistory(r,g,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var n;await this.sendPromise;const r=kt(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});const i=await o;return this.processStreamResponse(i,r)}getHistory(e=!1){const n=e?kf(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){return pn(this,arguments,function*(){var o,i,s,a,c,d;const h=[];try{for(var m=!0,p=mn(e),g;g=yield Fe(p.next()),o=g.done,!o;m=!0){a=g.value,m=!1;const E=a;if(hE(E)){const x=(d=(c=E.candidates)===null||c===void 0?void 0:c[0])===null||d===void 0?void 0:d.content;x!==void 0&&h.push(x)}yield yield Fe(E)}}catch(E){i={error:E}}finally{try{!m&&!o&&(s=p.return)&&(yield Fe(s.call(p)))}finally{if(i)throw i.error}}this.recordHistory(n,h)})}recordHistory(e,n,r){let o=[];n.length>0&&n.every(i=>i.role!==void 0)?o=n:o.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...kf(r)):this.history.push(e),this.history.push(...o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class na extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,na.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function yE(t){const e={},n=l(t,["file"]);return n!=null&&f(e,["file"],n),e}function vE(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&f(e,["sdkHttpResponse"],n),e}function xE(t){const e={},n=l(t,["name"]);return n!=null&&f(e,["_url","file"],Em(n)),e}function EE(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&f(e,["sdkHttpResponse"],n),e}function TE(t){const e={},n=l(t,["name"]);return n!=null&&f(e,["_url","file"],Em(n)),e}function SE(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&f(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&f(e,["_query","pageToken"],o),n}function wE(t){const e={},n=l(t,["config"]);return n!=null&&SE(n,e),e}function NE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&f(e,["nextPageToken"],r);const o=l(t,["files"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),f(e,["files"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class CE extends Un{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Rr(Ln.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=wE(e);return i=Ne("files",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),o.then(c=>{const d=NE(c),h=new _v;return Object.assign(h,d),h})}}async createInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=yE(e);return i=Ne("upload/v1beta/files",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>{const d=vE(c),h=new Rv;return Object.assign(h,d),h})}}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=TE(e);return i=Ne("files/{file}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>c)}}async delete(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=xE(e);return i=Ne("files/{file}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),o.then(c=>{const d=EE(c),h=new kv;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function as(t){const e={},n=l(t,["data"]);if(n!=null&&f(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function IE(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>jE(i))),f(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&f(e,["role"],r),e}function bE(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&f(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function AE(t){const e={},n=l(t,["id"]);n!=null&&f(e,["id"],n);const r=l(t,["args"]);r!=null&&f(e,["args"],r);const o=l(t,["name"]);if(o!=null&&f(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function _E(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&f(e,["description"],n);const r=l(t,["name"]);r!=null&&f(e,["name"],r);const o=l(t,["parameters"]);o!=null&&f(e,["parameters"],o);const i=l(t,["parametersJsonSchema"]);i!=null&&f(e,["parametersJsonSchema"],i);const s=l(t,["response"]);s!=null&&f(e,["response"],s);const a=l(t,["responseJsonSchema"]);return a!=null&&f(e,["responseJsonSchema"],a),e}function RE(t){const e={},n=l(t,["modelSelectionConfig"]);n!=null&&f(e,["modelConfig"],n);const r=l(t,["responseJsonSchema"]);r!=null&&f(e,["responseJsonSchema"],r);const o=l(t,["audioTimestamp"]);o!=null&&f(e,["audioTimestamp"],o);const i=l(t,["candidateCount"]);i!=null&&f(e,["candidateCount"],i);const s=l(t,["enableAffectiveDialog"]);s!=null&&f(e,["enableAffectiveDialog"],s);const a=l(t,["frequencyPenalty"]);a!=null&&f(e,["frequencyPenalty"],a);const c=l(t,["logprobs"]);c!=null&&f(e,["logprobs"],c);const d=l(t,["maxOutputTokens"]);d!=null&&f(e,["maxOutputTokens"],d);const h=l(t,["mediaResolution"]);h!=null&&f(e,["mediaResolution"],h);const m=l(t,["presencePenalty"]);m!=null&&f(e,["presencePenalty"],m);const p=l(t,["responseLogprobs"]);p!=null&&f(e,["responseLogprobs"],p);const g=l(t,["responseMimeType"]);g!=null&&f(e,["responseMimeType"],g);const E=l(t,["responseModalities"]);E!=null&&f(e,["responseModalities"],E);const x=l(t,["responseSchema"]);x!=null&&f(e,["responseSchema"],x);const w=l(t,["routingConfig"]);w!=null&&f(e,["routingConfig"],w);const y=l(t,["seed"]);y!=null&&f(e,["seed"],y);const v=l(t,["speechConfig"]);v!=null&&f(e,["speechConfig"],v);const T=l(t,["stopSequences"]);T!=null&&f(e,["stopSequences"],T);const I=l(t,["temperature"]);I!=null&&f(e,["temperature"],I);const A=l(t,["thinkingConfig"]);A!=null&&f(e,["thinkingConfig"],A);const O=l(t,["topK"]);O!=null&&f(e,["topK"],O);const k=l(t,["topP"]);if(k!=null&&f(e,["topP"],k),l(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function kE(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&f(e,["enableWidget"],n),e}function PE(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&f(e,["timeRangeFilter"],n),e}function OE(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&f(e,["setup","generationConfig"],r);const o=l(t,["responseModalities"]);e!==void 0&&o!=null&&f(e,["setup","generationConfig","responseModalities"],o);const i=l(t,["temperature"]);e!==void 0&&i!=null&&f(e,["setup","generationConfig","temperature"],i);const s=l(t,["topP"]);e!==void 0&&s!=null&&f(e,["setup","generationConfig","topP"],s);const a=l(t,["topK"]);e!==void 0&&a!=null&&f(e,["setup","generationConfig","topK"],a);const c=l(t,["maxOutputTokens"]);e!==void 0&&c!=null&&f(e,["setup","generationConfig","maxOutputTokens"],c);const d=l(t,["mediaResolution"]);e!==void 0&&d!=null&&f(e,["setup","generationConfig","mediaResolution"],d);const h=l(t,["seed"]);e!==void 0&&h!=null&&f(e,["setup","generationConfig","seed"],h);const m=l(t,["speechConfig"]);e!==void 0&&m!=null&&f(e,["setup","generationConfig","speechConfig"],Ku(m));const p=l(t,["thinkingConfig"]);e!==void 0&&p!=null&&f(e,["setup","generationConfig","thinkingConfig"],p);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&f(e,["setup","generationConfig","enableAffectiveDialog"],g);const E=l(t,["systemInstruction"]);e!==void 0&&E!=null&&f(e,["setup","systemInstruction"],IE(kt(E)));const x=l(t,["tools"]);if(e!==void 0&&x!=null){let O=vo(x);Array.isArray(O)&&(O=O.map(k=>$E(yo(k)))),f(e,["setup","tools"],O)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&f(e,["setup","sessionResumption"],VE(w));const y=l(t,["inputAudioTranscription"]);e!==void 0&&y!=null&&f(e,["setup","inputAudioTranscription"],y);const v=l(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&f(e,["setup","outputAudioTranscription"],v);const T=l(t,["realtimeInputConfig"]);e!==void 0&&T!=null&&f(e,["setup","realtimeInputConfig"],T);const I=l(t,["contextWindowCompression"]);e!==void 0&&I!=null&&f(e,["setup","contextWindowCompression"],I);const A=l(t,["proactivity"]);if(e!==void 0&&A!=null&&f(e,["setup","proactivity"],A),l(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function ME(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&f(e,["setup","generationConfig"],RE(r));const o=l(t,["responseModalities"]);e!==void 0&&o!=null&&f(e,["setup","generationConfig","responseModalities"],o);const i=l(t,["temperature"]);e!==void 0&&i!=null&&f(e,["setup","generationConfig","temperature"],i);const s=l(t,["topP"]);e!==void 0&&s!=null&&f(e,["setup","generationConfig","topP"],s);const a=l(t,["topK"]);e!==void 0&&a!=null&&f(e,["setup","generationConfig","topK"],a);const c=l(t,["maxOutputTokens"]);e!==void 0&&c!=null&&f(e,["setup","generationConfig","maxOutputTokens"],c);const d=l(t,["mediaResolution"]);e!==void 0&&d!=null&&f(e,["setup","generationConfig","mediaResolution"],d);const h=l(t,["seed"]);e!==void 0&&h!=null&&f(e,["setup","generationConfig","seed"],h);const m=l(t,["speechConfig"]);e!==void 0&&m!=null&&f(e,["setup","generationConfig","speechConfig"],Ku(m));const p=l(t,["thinkingConfig"]);e!==void 0&&p!=null&&f(e,["setup","generationConfig","thinkingConfig"],p);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&f(e,["setup","generationConfig","enableAffectiveDialog"],g);const E=l(t,["systemInstruction"]);e!==void 0&&E!=null&&f(e,["setup","systemInstruction"],kt(E));const x=l(t,["tools"]);if(e!==void 0&&x!=null){let k=vo(x);Array.isArray(k)&&(k=k.map(j=>zE(yo(j)))),f(e,["setup","tools"],k)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&f(e,["setup","sessionResumption"],w);const y=l(t,["inputAudioTranscription"]);e!==void 0&&y!=null&&f(e,["setup","inputAudioTranscription"],y);const v=l(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&f(e,["setup","outputAudioTranscription"],v);const T=l(t,["realtimeInputConfig"]);e!==void 0&&T!=null&&f(e,["setup","realtimeInputConfig"],T);const I=l(t,["contextWindowCompression"]);e!==void 0&&I!=null&&f(e,["setup","contextWindowCompression"],I);const A=l(t,["proactivity"]);e!==void 0&&A!=null&&f(e,["setup","proactivity"],A);const O=l(t,["explicitVadSignal"]);return e!==void 0&&O!=null&&f(e,["setup","explicitVadSignal"],O),n}function LE(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["setup","model"],Ye(t,r));const o=l(e,["config"]);return o!=null&&f(n,["config"],OE(o,n)),n}function DE(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["setup","model"],Ye(t,r));const o=l(e,["config"]);return o!=null&&f(n,["config"],ME(o,n)),n}function UE(t){const e={},n=l(t,["musicGenerationConfig"]);return n!=null&&f(e,["musicGenerationConfig"],n),e}function FE(t){const e={},n=l(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),f(e,["weightedPrompts"],r)}return e}function GE(t){const e={},n=l(t,["media"]);if(n!=null){let d=mm(n);Array.isArray(d)&&(d=d.map(h=>as(h))),f(e,["mediaChunks"],d)}const r=l(t,["audio"]);r!=null&&f(e,["audio"],as(ym(r)));const o=l(t,["audioStreamEnd"]);o!=null&&f(e,["audioStreamEnd"],o);const i=l(t,["video"]);i!=null&&f(e,["video"],as(gm(i)));const s=l(t,["text"]);s!=null&&f(e,["text"],s);const a=l(t,["activityStart"]);a!=null&&f(e,["activityStart"],a);const c=l(t,["activityEnd"]);return c!=null&&f(e,["activityEnd"],c),e}function HE(t){const e={},n=l(t,["media"]);if(n!=null){let d=mm(n);Array.isArray(d)&&(d=d.map(h=>h)),f(e,["mediaChunks"],d)}const r=l(t,["audio"]);r!=null&&f(e,["audio"],ym(r));const o=l(t,["audioStreamEnd"]);o!=null&&f(e,["audioStreamEnd"],o);const i=l(t,["video"]);i!=null&&f(e,["video"],gm(i));const s=l(t,["text"]);s!=null&&f(e,["text"],s);const a=l(t,["activityStart"]);a!=null&&f(e,["activityStart"],a);const c=l(t,["activityEnd"]);return c!=null&&f(e,["activityEnd"],c),e}function BE(t){const e={},n=l(t,["setupComplete"]);n!=null&&f(e,["setupComplete"],n);const r=l(t,["serverContent"]);r!=null&&f(e,["serverContent"],r);const o=l(t,["toolCall"]);o!=null&&f(e,["toolCall"],o);const i=l(t,["toolCallCancellation"]);i!=null&&f(e,["toolCallCancellation"],i);const s=l(t,["usageMetadata"]);s!=null&&f(e,["usageMetadata"],WE(s));const a=l(t,["goAway"]);a!=null&&f(e,["goAway"],a);const c=l(t,["sessionResumptionUpdate"]);c!=null&&f(e,["sessionResumptionUpdate"],c);const d=l(t,["voiceActivityDetectionSignal"]);return d!=null&&f(e,["voiceActivityDetectionSignal"],d),e}function jE(t){const e={},n=l(t,["mediaResolution"]);n!=null&&f(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&f(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&f(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&f(e,["fileData"],bE(i));const s=l(t,["functionCall"]);s!=null&&f(e,["functionCall"],AE(s));const a=l(t,["functionResponse"]);a!=null&&f(e,["functionResponse"],a);const c=l(t,["inlineData"]);c!=null&&f(e,["inlineData"],as(c));const d=l(t,["text"]);d!=null&&f(e,["text"],d);const h=l(t,["thought"]);h!=null&&f(e,["thought"],h);const m=l(t,["thoughtSignature"]);m!=null&&f(e,["thoughtSignature"],m);const p=l(t,["videoMetadata"]);return p!=null&&f(e,["videoMetadata"],p),e}function VE(t){const e={},n=l(t,["handle"]);if(n!=null&&f(e,["handle"],n),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function $E(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(m=>m)),f(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&f(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&f(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&f(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&f(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&f(e,["googleMaps"],kE(a));const c=l(t,["googleSearch"]);c!=null&&f(e,["googleSearch"],PE(c));const d=l(t,["urlContext"]);return d!=null&&f(e,["urlContext"],d),e}function zE(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let m=n;Array.isArray(m)&&(m=m.map(p=>_E(p))),f(e,["functionDeclarations"],m)}const r=l(t,["retrieval"]);r!=null&&f(e,["retrieval"],r);const o=l(t,["googleSearchRetrieval"]);o!=null&&f(e,["googleSearchRetrieval"],o);const i=l(t,["computerUse"]);if(i!=null&&f(e,["computerUse"],i),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=l(t,["codeExecution"]);s!=null&&f(e,["codeExecution"],s);const a=l(t,["enterpriseWebSearch"]);a!=null&&f(e,["enterpriseWebSearch"],a);const c=l(t,["googleMaps"]);c!=null&&f(e,["googleMaps"],c);const d=l(t,["googleSearch"]);d!=null&&f(e,["googleSearch"],d);const h=l(t,["urlContext"]);return h!=null&&f(e,["urlContext"],h),e}function WE(t){const e={},n=l(t,["promptTokenCount"]);n!=null&&f(e,["promptTokenCount"],n);const r=l(t,["cachedContentTokenCount"]);r!=null&&f(e,["cachedContentTokenCount"],r);const o=l(t,["candidatesTokenCount"]);o!=null&&f(e,["responseTokenCount"],o);const i=l(t,["toolUsePromptTokenCount"]);i!=null&&f(e,["toolUsePromptTokenCount"],i);const s=l(t,["thoughtsTokenCount"]);s!=null&&f(e,["thoughtsTokenCount"],s);const a=l(t,["totalTokenCount"]);a!=null&&f(e,["totalTokenCount"],a);const c=l(t,["promptTokensDetails"]);if(c!=null){let g=c;Array.isArray(g)&&(g=g.map(E=>E)),f(e,["promptTokensDetails"],g)}const d=l(t,["cacheTokensDetails"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(E=>E)),f(e,["cacheTokensDetails"],g)}const h=l(t,["candidatesTokensDetails"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(E=>E)),f(e,["responseTokensDetails"],g)}const m=l(t,["toolUsePromptTokensDetails"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(E=>E)),f(e,["toolUsePromptTokensDetails"],g)}const p=l(t,["trafficType"]);return p!=null&&f(e,["trafficType"],p),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function YE(t){const e={},n=l(t,["data"]);if(n!=null&&f(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function qE(t){const e={},n=l(t,["content"]);n!=null&&f(e,["content"],n);const r=l(t,["citationMetadata"]);r!=null&&f(e,["citationMetadata"],KE(r));const o=l(t,["tokenCount"]);o!=null&&f(e,["tokenCount"],o);const i=l(t,["finishReason"]);i!=null&&f(e,["finishReason"],i);const s=l(t,["avgLogprobs"]);s!=null&&f(e,["avgLogprobs"],s);const a=l(t,["groundingMetadata"]);a!=null&&f(e,["groundingMetadata"],a);const c=l(t,["index"]);c!=null&&f(e,["index"],c);const d=l(t,["logprobsResult"]);d!=null&&f(e,["logprobsResult"],d);const h=l(t,["safetyRatings"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(g=>g)),f(e,["safetyRatings"],p)}const m=l(t,["urlContextMetadata"]);return m!=null&&f(e,["urlContextMetadata"],m),e}function KE(t){const e={},n=l(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),f(e,["citations"],r)}return e}function JE(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["contents"]);if(o!=null){let i=nn(o);Array.isArray(i)&&(i=i.map(s=>s)),f(n,["contents"],i)}return n}function XE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["tokensInfo"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),f(e,["tokensInfo"],o)}return e}function ZE(t){const e={},n=l(t,["values"]);n!=null&&f(e,["values"],n);const r=l(t,["statistics"]);return r!=null&&f(e,["statistics"],QE(r)),e}function QE(t){const e={},n=l(t,["truncated"]);n!=null&&f(e,["truncated"],n);const r=l(t,["token_count"]);return r!=null&&f(e,["tokenCount"],r),e}function ra(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>lS(i))),f(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&f(e,["role"],r),e}function eT(t){const e={},n=l(t,["controlType"]);n!=null&&f(e,["controlType"],n);const r=l(t,["enableControlImageComputation"]);return r!=null&&f(e,["computeControl"],r),e}function tT(t){const e={};if(l(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(l(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(l(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function nT(t,e){const n={},r=l(t,["systemInstruction"]);e!==void 0&&r!=null&&f(e,["systemInstruction"],kt(r));const o=l(t,["tools"]);if(e!==void 0&&o!=null){let s=o;Array.isArray(s)&&(s=s.map(a=>km(a))),f(e,["tools"],s)}const i=l(t,["generationConfig"]);return e!==void 0&&i!=null&&f(e,["generationConfig"],YT(i)),n}function rT(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["contents"]);if(o!=null){let s=nn(o);Array.isArray(s)&&(s=s.map(a=>ra(a))),f(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&tT(i),n}function oT(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["contents"]);if(o!=null){let s=nn(o);Array.isArray(s)&&(s=s.map(a=>a)),f(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&nT(i,n),n}function iT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["totalTokens"]);r!=null&&f(e,["totalTokens"],r);const o=l(t,["cachedContentTokenCount"]);return o!=null&&f(e,["cachedContentTokenCount"],o),e}function sT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["totalTokens"]);return r!=null&&f(e,["totalTokens"],r),e}function aT(t,e){const n={},r=l(e,["model"]);return r!=null&&f(n,["_url","name"],Ye(t,r)),n}function lT(t,e){const n={},r=l(e,["model"]);return r!=null&&f(n,["_url","name"],Ye(t,r)),n}function uT(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&f(e,["sdkHttpResponse"],n),e}function cT(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&f(e,["sdkHttpResponse"],n),e}function dT(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&f(e,["parameters","storageUri"],r);const o=l(t,["negativePrompt"]);e!==void 0&&o!=null&&f(e,["parameters","negativePrompt"],o);const i=l(t,["numberOfImages"]);e!==void 0&&i!=null&&f(e,["parameters","sampleCount"],i);const s=l(t,["aspectRatio"]);e!==void 0&&s!=null&&f(e,["parameters","aspectRatio"],s);const a=l(t,["guidanceScale"]);e!==void 0&&a!=null&&f(e,["parameters","guidanceScale"],a);const c=l(t,["seed"]);e!==void 0&&c!=null&&f(e,["parameters","seed"],c);const d=l(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&f(e,["parameters","safetySetting"],d);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&f(e,["parameters","personGeneration"],h);const m=l(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&f(e,["parameters","includeSafetyAttributes"],m);const p=l(t,["includeRaiReason"]);e!==void 0&&p!=null&&f(e,["parameters","includeRaiReason"],p);const g=l(t,["language"]);e!==void 0&&g!=null&&f(e,["parameters","language"],g);const E=l(t,["outputMimeType"]);e!==void 0&&E!=null&&f(e,["parameters","outputOptions","mimeType"],E);const x=l(t,["outputCompressionQuality"]);e!==void 0&&x!=null&&f(e,["parameters","outputOptions","compressionQuality"],x);const w=l(t,["addWatermark"]);e!==void 0&&w!=null&&f(e,["parameters","addWatermark"],w);const y=l(t,["labels"]);e!==void 0&&y!=null&&f(e,["labels"],y);const v=l(t,["editMode"]);e!==void 0&&v!=null&&f(e,["parameters","editMode"],v);const T=l(t,["baseSteps"]);return e!==void 0&&T!=null&&f(e,["parameters","editConfig","baseSteps"],T),n}function fT(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["prompt"]);o!=null&&f(n,["instances[0]","prompt"],o);const i=l(e,["referenceImages"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(c=>pS(c))),f(n,["instances[0]","referenceImages"],a)}const s=l(e,["config"]);return s!=null&&dT(s,n),n}function hT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>oa(i))),f(e,["generatedImages"],o)}return e}function pT(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&f(e,["requests[]","taskType"],r);const o=l(t,["title"]);e!==void 0&&o!=null&&f(e,["requests[]","title"],o);const i=l(t,["outputDimensionality"]);if(e!==void 0&&i!=null&&f(e,["requests[]","outputDimensionality"],i),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function mT(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&f(e,["instances[]","task_type"],r);const o=l(t,["title"]);e!==void 0&&o!=null&&f(e,["instances[]","title"],o);const i=l(t,["outputDimensionality"]);e!==void 0&&i!=null&&f(e,["parameters","outputDimensionality"],i);const s=l(t,["mimeType"]);e!==void 0&&s!=null&&f(e,["instances[]","mimeType"],s);const a=l(t,["autoTruncate"]);return e!==void 0&&a!=null&&f(e,["parameters","autoTruncate"],a),n}function gT(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["contents"]);if(o!=null){let a=Wu(t,o);Array.isArray(a)&&(a=a.map(c=>c)),f(n,["requests[]","content"],a)}const i=l(e,["config"]);i!=null&&pT(i,n);const s=l(e,["model"]);return s!==void 0&&f(n,["requests[]","model"],Ye(t,s)),n}function yT(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["contents"]);if(o!=null){let s=Wu(t,o);Array.isArray(s)&&(s=s.map(a=>a)),f(n,["instances[]","content"],s)}const i=l(e,["config"]);return i!=null&&mT(i,n),n}function vT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),f(e,["embeddings"],i)}const o=l(t,["metadata"]);return o!=null&&f(e,["metadata"],o),e}function xT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["predictions[]","embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>ZE(s))),f(e,["embeddings"],i)}const o=l(t,["metadata"]);return o!=null&&f(e,["metadata"],o),e}function ET(t){const e={},n=l(t,["endpoint"]);n!=null&&f(e,["name"],n);const r=l(t,["deployedModelId"]);return r!=null&&f(e,["deployedModelId"],r),e}function TT(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&f(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function ST(t){const e={},n=l(t,["id"]);n!=null&&f(e,["id"],n);const r=l(t,["args"]);r!=null&&f(e,["args"],r);const o=l(t,["name"]);if(o!=null&&f(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function wT(t){const e={},n=l(t,["mode"]);n!=null&&f(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);if(r!=null&&f(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function NT(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&f(e,["description"],n);const r=l(t,["name"]);r!=null&&f(e,["name"],r);const o=l(t,["parameters"]);o!=null&&f(e,["parameters"],o);const i=l(t,["parametersJsonSchema"]);i!=null&&f(e,["parametersJsonSchema"],i);const s=l(t,["response"]);s!=null&&f(e,["response"],s);const a=l(t,["responseJsonSchema"]);return a!=null&&f(e,["responseJsonSchema"],a),e}function CT(t,e,n){const r={},o=l(e,["systemInstruction"]);n!==void 0&&o!=null&&f(n,["systemInstruction"],ra(kt(o)));const i=l(e,["temperature"]);i!=null&&f(r,["temperature"],i);const s=l(e,["topP"]);s!=null&&f(r,["topP"],s);const a=l(e,["topK"]);a!=null&&f(r,["topK"],a);const c=l(e,["candidateCount"]);c!=null&&f(r,["candidateCount"],c);const d=l(e,["maxOutputTokens"]);d!=null&&f(r,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&f(r,["stopSequences"],h);const m=l(e,["responseLogprobs"]);m!=null&&f(r,["responseLogprobs"],m);const p=l(e,["logprobs"]);p!=null&&f(r,["logprobs"],p);const g=l(e,["presencePenalty"]);g!=null&&f(r,["presencePenalty"],g);const E=l(e,["frequencyPenalty"]);E!=null&&f(r,["frequencyPenalty"],E);const x=l(e,["seed"]);x!=null&&f(r,["seed"],x);const w=l(e,["responseMimeType"]);w!=null&&f(r,["responseMimeType"],w);const y=l(e,["responseSchema"]);y!=null&&f(r,["responseSchema"],Yu(y));const v=l(e,["responseJsonSchema"]);if(v!=null&&f(r,["responseJsonSchema"],v),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const T=l(e,["safetySettings"]);if(n!==void 0&&T!=null){let z=T;Array.isArray(z)&&(z=z.map(N=>mS(N))),f(n,["safetySettings"],z)}const I=l(e,["tools"]);if(n!==void 0&&I!=null){let z=vo(I);Array.isArray(z)&&(z=z.map(N=>SS(yo(N)))),f(n,["tools"],z)}const A=l(e,["toolConfig"]);if(n!==void 0&&A!=null&&f(n,["toolConfig"],TS(A)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const O=l(e,["cachedContent"]);n!==void 0&&O!=null&&f(n,["cachedContent"],Fn(t,O));const k=l(e,["responseModalities"]);k!=null&&f(r,["responseModalities"],k);const j=l(e,["mediaResolution"]);j!=null&&f(r,["mediaResolution"],j);const D=l(e,["speechConfig"]);if(D!=null&&f(r,["speechConfig"],qu(D)),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const V=l(e,["thinkingConfig"]);V!=null&&f(r,["thinkingConfig"],V);const X=l(e,["imageConfig"]);X!=null&&f(r,["imageConfig"],ZT(X));const _=l(e,["enableEnhancedCivicAnswers"]);return _!=null&&f(r,["enableEnhancedCivicAnswers"],_),r}function IT(t,e,n){const r={},o=l(e,["systemInstruction"]);n!==void 0&&o!=null&&f(n,["systemInstruction"],kt(o));const i=l(e,["temperature"]);i!=null&&f(r,["temperature"],i);const s=l(e,["topP"]);s!=null&&f(r,["topP"],s);const a=l(e,["topK"]);a!=null&&f(r,["topK"],a);const c=l(e,["candidateCount"]);c!=null&&f(r,["candidateCount"],c);const d=l(e,["maxOutputTokens"]);d!=null&&f(r,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&f(r,["stopSequences"],h);const m=l(e,["responseLogprobs"]);m!=null&&f(r,["responseLogprobs"],m);const p=l(e,["logprobs"]);p!=null&&f(r,["logprobs"],p);const g=l(e,["presencePenalty"]);g!=null&&f(r,["presencePenalty"],g);const E=l(e,["frequencyPenalty"]);E!=null&&f(r,["frequencyPenalty"],E);const x=l(e,["seed"]);x!=null&&f(r,["seed"],x);const w=l(e,["responseMimeType"]);w!=null&&f(r,["responseMimeType"],w);const y=l(e,["responseSchema"]);y!=null&&f(r,["responseSchema"],Yu(y));const v=l(e,["responseJsonSchema"]);v!=null&&f(r,["responseJsonSchema"],v);const T=l(e,["routingConfig"]);T!=null&&f(r,["routingConfig"],T);const I=l(e,["modelSelectionConfig"]);I!=null&&f(r,["modelConfig"],I);const A=l(e,["safetySettings"]);if(n!==void 0&&A!=null){let ge=A;Array.isArray(ge)&&(ge=ge.map(J=>J)),f(n,["safetySettings"],ge)}const O=l(e,["tools"]);if(n!==void 0&&O!=null){let ge=vo(O);Array.isArray(ge)&&(ge=ge.map(J=>km(yo(J)))),f(n,["tools"],ge)}const k=l(e,["toolConfig"]);n!==void 0&&k!=null&&f(n,["toolConfig"],k);const j=l(e,["labels"]);n!==void 0&&j!=null&&f(n,["labels"],j);const D=l(e,["cachedContent"]);n!==void 0&&D!=null&&f(n,["cachedContent"],Fn(t,D));const V=l(e,["responseModalities"]);V!=null&&f(r,["responseModalities"],V);const X=l(e,["mediaResolution"]);X!=null&&f(r,["mediaResolution"],X);const _=l(e,["speechConfig"]);_!=null&&f(r,["speechConfig"],qu(_));const z=l(e,["audioTimestamp"]);z!=null&&f(r,["audioTimestamp"],z);const N=l(e,["thinkingConfig"]);N!=null&&f(r,["thinkingConfig"],N);const te=l(e,["imageConfig"]);if(te!=null&&f(r,["imageConfig"],QT(te)),l(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return r}function Pf(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["contents"]);if(o!=null){let s=nn(o);Array.isArray(s)&&(s=s.map(a=>ra(a))),f(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&f(n,["generationConfig"],CT(t,i,n)),n}function Of(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["contents"]);if(o!=null){let s=nn(o);Array.isArray(s)&&(s=s.map(a=>a)),f(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&f(n,["generationConfig"],IT(t,i,n)),n}function Mf(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>qE(d))),f(e,["candidates"],c)}const o=l(t,["modelVersion"]);o!=null&&f(e,["modelVersion"],o);const i=l(t,["promptFeedback"]);i!=null&&f(e,["promptFeedback"],i);const s=l(t,["responseId"]);s!=null&&f(e,["responseId"],s);const a=l(t,["usageMetadata"]);return a!=null&&f(e,["usageMetadata"],a),e}function Lf(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(h=>h)),f(e,["candidates"],d)}const o=l(t,["createTime"]);o!=null&&f(e,["createTime"],o);const i=l(t,["modelVersion"]);i!=null&&f(e,["modelVersion"],i);const s=l(t,["promptFeedback"]);s!=null&&f(e,["promptFeedback"],s);const a=l(t,["responseId"]);a!=null&&f(e,["responseId"],a);const c=l(t,["usageMetadata"]);return c!=null&&f(e,["usageMetadata"],c),e}function bT(t,e){const n={};if(l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&f(e,["parameters","sampleCount"],r);const o=l(t,["aspectRatio"]);e!==void 0&&o!=null&&f(e,["parameters","aspectRatio"],o);const i=l(t,["guidanceScale"]);if(e!==void 0&&i!=null&&f(e,["parameters","guidanceScale"],i),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=l(t,["safetyFilterLevel"]);e!==void 0&&s!=null&&f(e,["parameters","safetySetting"],s);const a=l(t,["personGeneration"]);e!==void 0&&a!=null&&f(e,["parameters","personGeneration"],a);const c=l(t,["includeSafetyAttributes"]);e!==void 0&&c!=null&&f(e,["parameters","includeSafetyAttributes"],c);const d=l(t,["includeRaiReason"]);e!==void 0&&d!=null&&f(e,["parameters","includeRaiReason"],d);const h=l(t,["language"]);e!==void 0&&h!=null&&f(e,["parameters","language"],h);const m=l(t,["outputMimeType"]);e!==void 0&&m!=null&&f(e,["parameters","outputOptions","mimeType"],m);const p=l(t,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&f(e,["parameters","outputOptions","compressionQuality"],p),l(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(l(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const g=l(t,["imageSize"]);if(e!==void 0&&g!=null&&f(e,["parameters","sampleImageSize"],g),l(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function AT(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&f(e,["parameters","storageUri"],r);const o=l(t,["negativePrompt"]);e!==void 0&&o!=null&&f(e,["parameters","negativePrompt"],o);const i=l(t,["numberOfImages"]);e!==void 0&&i!=null&&f(e,["parameters","sampleCount"],i);const s=l(t,["aspectRatio"]);e!==void 0&&s!=null&&f(e,["parameters","aspectRatio"],s);const a=l(t,["guidanceScale"]);e!==void 0&&a!=null&&f(e,["parameters","guidanceScale"],a);const c=l(t,["seed"]);e!==void 0&&c!=null&&f(e,["parameters","seed"],c);const d=l(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&f(e,["parameters","safetySetting"],d);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&f(e,["parameters","personGeneration"],h);const m=l(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&f(e,["parameters","includeSafetyAttributes"],m);const p=l(t,["includeRaiReason"]);e!==void 0&&p!=null&&f(e,["parameters","includeRaiReason"],p);const g=l(t,["language"]);e!==void 0&&g!=null&&f(e,["parameters","language"],g);const E=l(t,["outputMimeType"]);e!==void 0&&E!=null&&f(e,["parameters","outputOptions","mimeType"],E);const x=l(t,["outputCompressionQuality"]);e!==void 0&&x!=null&&f(e,["parameters","outputOptions","compressionQuality"],x);const w=l(t,["addWatermark"]);e!==void 0&&w!=null&&f(e,["parameters","addWatermark"],w);const y=l(t,["labels"]);e!==void 0&&y!=null&&f(e,["labels"],y);const v=l(t,["imageSize"]);e!==void 0&&v!=null&&f(e,["parameters","sampleImageSize"],v);const T=l(t,["enhancePrompt"]);return e!==void 0&&T!=null&&f(e,["parameters","enhancePrompt"],T),n}function _T(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["prompt"]);o!=null&&f(n,["instances[0]","prompt"],o);const i=l(e,["config"]);return i!=null&&bT(i,n),n}function RT(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["prompt"]);o!=null&&f(n,["instances[0]","prompt"],o);const i=l(e,["config"]);return i!=null&&AT(i,n),n}function kT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>VT(s))),f(e,["generatedImages"],i)}const o=l(t,["positivePromptSafetyAttributes"]);return o!=null&&f(e,["positivePromptSafetyAttributes"],_m(o)),e}function PT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>oa(s))),f(e,["generatedImages"],i)}const o=l(t,["positivePromptSafetyAttributes"]);return o!=null&&f(e,["positivePromptSafetyAttributes"],Rm(o)),e}function OT(t,e){const n={},r=l(t,["numberOfVideos"]);if(e!==void 0&&r!=null&&f(e,["parameters","sampleCount"],r),l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=l(t,["durationSeconds"]);if(e!==void 0&&o!=null&&f(e,["parameters","durationSeconds"],o),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const i=l(t,["aspectRatio"]);e!==void 0&&i!=null&&f(e,["parameters","aspectRatio"],i);const s=l(t,["resolution"]);e!==void 0&&s!=null&&f(e,["parameters","resolution"],s);const a=l(t,["personGeneration"]);if(e!==void 0&&a!=null&&f(e,["parameters","personGeneration"],a),l(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=l(t,["negativePrompt"]);e!==void 0&&c!=null&&f(e,["parameters","negativePrompt"],c);const d=l(t,["enhancePrompt"]);if(e!==void 0&&d!=null&&f(e,["parameters","enhancePrompt"],d),l(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const h=l(t,["lastFrame"]);e!==void 0&&h!=null&&f(e,["instances[0]","lastFrame"],ia(h));const m=l(t,["referenceImages"]);if(e!==void 0&&m!=null){let p=m;Array.isArray(p)&&(p=p.map(g=>LS(g))),f(e,["instances[0]","referenceImages"],p)}if(l(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(l(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function MT(t,e){const n={},r=l(t,["numberOfVideos"]);e!==void 0&&r!=null&&f(e,["parameters","sampleCount"],r);const o=l(t,["outputGcsUri"]);e!==void 0&&o!=null&&f(e,["parameters","storageUri"],o);const i=l(t,["fps"]);e!==void 0&&i!=null&&f(e,["parameters","fps"],i);const s=l(t,["durationSeconds"]);e!==void 0&&s!=null&&f(e,["parameters","durationSeconds"],s);const a=l(t,["seed"]);e!==void 0&&a!=null&&f(e,["parameters","seed"],a);const c=l(t,["aspectRatio"]);e!==void 0&&c!=null&&f(e,["parameters","aspectRatio"],c);const d=l(t,["resolution"]);e!==void 0&&d!=null&&f(e,["parameters","resolution"],d);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&f(e,["parameters","personGeneration"],h);const m=l(t,["pubsubTopic"]);e!==void 0&&m!=null&&f(e,["parameters","pubsubTopic"],m);const p=l(t,["negativePrompt"]);e!==void 0&&p!=null&&f(e,["parameters","negativePrompt"],p);const g=l(t,["enhancePrompt"]);e!==void 0&&g!=null&&f(e,["parameters","enhancePrompt"],g);const E=l(t,["generateAudio"]);e!==void 0&&E!=null&&f(e,["parameters","generateAudio"],E);const x=l(t,["lastFrame"]);e!==void 0&&x!=null&&f(e,["instances[0]","lastFrame"],vn(x));const w=l(t,["referenceImages"]);if(e!==void 0&&w!=null){let T=w;Array.isArray(T)&&(T=T.map(I=>DS(I))),f(e,["instances[0]","referenceImages"],T)}const y=l(t,["mask"]);e!==void 0&&y!=null&&f(e,["instances[0]","mask"],MS(y));const v=l(t,["compressionQuality"]);return e!==void 0&&v!=null&&f(e,["parameters","compressionQuality"],v),n}function LT(t){const e={},n=l(t,["name"]);n!=null&&f(e,["name"],n);const r=l(t,["metadata"]);r!=null&&f(e,["metadata"],r);const o=l(t,["done"]);o!=null&&f(e,["done"],o);const i=l(t,["error"]);i!=null&&f(e,["error"],i);const s=l(t,["response","generateVideoResponse"]);return s!=null&&f(e,["response"],GT(s)),e}function DT(t){const e={},n=l(t,["name"]);n!=null&&f(e,["name"],n);const r=l(t,["metadata"]);r!=null&&f(e,["metadata"],r);const o=l(t,["done"]);o!=null&&f(e,["done"],o);const i=l(t,["error"]);i!=null&&f(e,["error"],i);const s=l(t,["response"]);return s!=null&&f(e,["response"],HT(s)),e}function UT(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["prompt"]);o!=null&&f(n,["instances[0]","prompt"],o);const i=l(e,["image"]);i!=null&&f(n,["instances[0]","image"],ia(i));const s=l(e,["video"]);s!=null&&f(n,["instances[0]","video"],Pm(s));const a=l(e,["source"]);a!=null&&BT(a,n);const c=l(e,["config"]);return c!=null&&OT(c,n),n}function FT(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["prompt"]);o!=null&&f(n,["instances[0]","prompt"],o);const i=l(e,["image"]);i!=null&&f(n,["instances[0]","image"],vn(i));const s=l(e,["video"]);s!=null&&f(n,["instances[0]","video"],Om(s));const a=l(e,["source"]);a!=null&&jT(a,n);const c=l(e,["config"]);return c!=null&&MT(c,n),n}function GT(t){const e={},n=l(t,["generatedSamples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>zT(s))),f(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&f(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&f(e,["raiMediaFilteredReasons"],o),e}function HT(t){const e={},n=l(t,["videos"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>WT(s))),f(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&f(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&f(e,["raiMediaFilteredReasons"],o),e}function BT(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&f(e,["instances[0]","prompt"],r);const o=l(t,["image"]);e!==void 0&&o!=null&&f(e,["instances[0]","image"],ia(o));const i=l(t,["video"]);return e!==void 0&&i!=null&&f(e,["instances[0]","video"],Pm(i)),n}function jT(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&f(e,["instances[0]","prompt"],r);const o=l(t,["image"]);e!==void 0&&o!=null&&f(e,["instances[0]","image"],vn(o));const i=l(t,["video"]);return e!==void 0&&i!=null&&f(e,["instances[0]","video"],Om(i)),n}function VT(t){const e={},n=l(t,["_self"]);n!=null&&f(e,["image"],eS(n));const r=l(t,["raiFilteredReason"]);r!=null&&f(e,["raiFilteredReason"],r);const o=l(t,["_self"]);return o!=null&&f(e,["safetyAttributes"],_m(o)),e}function oa(t){const e={},n=l(t,["_self"]);n!=null&&f(e,["image"],Am(n));const r=l(t,["raiFilteredReason"]);r!=null&&f(e,["raiFilteredReason"],r);const o=l(t,["_self"]);o!=null&&f(e,["safetyAttributes"],Rm(o));const i=l(t,["prompt"]);return i!=null&&f(e,["enhancedPrompt"],i),e}function $T(t){const e={},n=l(t,["_self"]);n!=null&&f(e,["mask"],Am(n));const r=l(t,["labels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),f(e,["labels"],o)}return e}function zT(t){const e={},n=l(t,["video"]);return n!=null&&f(e,["video"],PS(n)),e}function WT(t){const e={},n=l(t,["_self"]);return n!=null&&f(e,["video"],OS(n)),e}function YT(t){const e={},n=l(t,["modelSelectionConfig"]);n!=null&&f(e,["modelConfig"],n);const r=l(t,["responseJsonSchema"]);r!=null&&f(e,["responseJsonSchema"],r);const o=l(t,["audioTimestamp"]);o!=null&&f(e,["audioTimestamp"],o);const i=l(t,["candidateCount"]);i!=null&&f(e,["candidateCount"],i);const s=l(t,["enableAffectiveDialog"]);s!=null&&f(e,["enableAffectiveDialog"],s);const a=l(t,["frequencyPenalty"]);a!=null&&f(e,["frequencyPenalty"],a);const c=l(t,["logprobs"]);c!=null&&f(e,["logprobs"],c);const d=l(t,["maxOutputTokens"]);d!=null&&f(e,["maxOutputTokens"],d);const h=l(t,["mediaResolution"]);h!=null&&f(e,["mediaResolution"],h);const m=l(t,["presencePenalty"]);m!=null&&f(e,["presencePenalty"],m);const p=l(t,["responseLogprobs"]);p!=null&&f(e,["responseLogprobs"],p);const g=l(t,["responseMimeType"]);g!=null&&f(e,["responseMimeType"],g);const E=l(t,["responseModalities"]);E!=null&&f(e,["responseModalities"],E);const x=l(t,["responseSchema"]);x!=null&&f(e,["responseSchema"],x);const w=l(t,["routingConfig"]);w!=null&&f(e,["routingConfig"],w);const y=l(t,["seed"]);y!=null&&f(e,["seed"],y);const v=l(t,["speechConfig"]);v!=null&&f(e,["speechConfig"],v);const T=l(t,["stopSequences"]);T!=null&&f(e,["stopSequences"],T);const I=l(t,["temperature"]);I!=null&&f(e,["temperature"],I);const A=l(t,["thinkingConfig"]);A!=null&&f(e,["thinkingConfig"],A);const O=l(t,["topK"]);O!=null&&f(e,["topK"],O);const k=l(t,["topP"]);if(k!=null&&f(e,["topP"],k),l(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function qT(t,e){const n={},r=l(e,["model"]);return r!=null&&f(n,["_url","name"],Ye(t,r)),n}function KT(t,e){const n={},r=l(e,["model"]);return r!=null&&f(n,["_url","name"],Ye(t,r)),n}function JT(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&f(e,["enableWidget"],n),e}function XT(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&f(e,["timeRangeFilter"],n),e}function ZT(t){const e={},n=l(t,["aspectRatio"]);n!=null&&f(e,["aspectRatio"],n);const r=l(t,["imageSize"]);if(r!=null&&f(e,["imageSize"],r),l(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(l(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function QT(t){const e={},n=l(t,["aspectRatio"]);n!=null&&f(e,["aspectRatio"],n);const r=l(t,["imageSize"]);r!=null&&f(e,["imageSize"],r);const o=l(t,["outputMimeType"]);o!=null&&f(e,["imageOutputOptions","mimeType"],o);const i=l(t,["outputCompressionQuality"]);return i!=null&&f(e,["imageOutputOptions","compressionQuality"],i),e}function eS(t){const e={},n=l(t,["bytesBase64Encoded"]);n!=null&&f(e,["imageBytes"],cr(n));const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function Am(t){const e={},n=l(t,["gcsUri"]);n!=null&&f(e,["gcsUri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&f(e,["imageBytes"],cr(r));const o=l(t,["mimeType"]);return o!=null&&f(e,["mimeType"],o),e}function ia(t){const e={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=l(t,["imageBytes"]);n!=null&&f(e,["bytesBase64Encoded"],cr(n));const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function vn(t){const e={},n=l(t,["gcsUri"]);n!=null&&f(e,["gcsUri"],n);const r=l(t,["imageBytes"]);r!=null&&f(e,["bytesBase64Encoded"],cr(r));const o=l(t,["mimeType"]);return o!=null&&f(e,["mimeType"],o),e}function tS(t,e,n){const r={},o=l(e,["pageSize"]);n!==void 0&&o!=null&&f(n,["_query","pageSize"],o);const i=l(e,["pageToken"]);n!==void 0&&i!=null&&f(n,["_query","pageToken"],i);const s=l(e,["filter"]);n!==void 0&&s!=null&&f(n,["_query","filter"],s);const a=l(e,["queryBase"]);return n!==void 0&&a!=null&&f(n,["_url","models_url"],Tm(t,a)),r}function nS(t,e,n){const r={},o=l(e,["pageSize"]);n!==void 0&&o!=null&&f(n,["_query","pageSize"],o);const i=l(e,["pageToken"]);n!==void 0&&i!=null&&f(n,["_query","pageToken"],i);const s=l(e,["filter"]);n!==void 0&&s!=null&&f(n,["_query","filter"],s);const a=l(e,["queryBase"]);return n!==void 0&&a!=null&&f(n,["_url","models_url"],Tm(t,a)),r}function rS(t,e){const n={},r=l(e,["config"]);return r!=null&&tS(t,r,n),n}function oS(t,e){const n={},r=l(e,["config"]);return r!=null&&nS(t,r,n),n}function iS(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&f(e,["nextPageToken"],r);const o=l(t,["_self"]);if(o!=null){let i=Sm(o);Array.isArray(i)&&(i=i.map(s=>Fl(s))),f(e,["models"],i)}return e}function sS(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&f(e,["nextPageToken"],r);const o=l(t,["_self"]);if(o!=null){let i=Sm(o);Array.isArray(i)&&(i=i.map(s=>Gl(s))),f(e,["models"],i)}return e}function aS(t){const e={},n=l(t,["maskMode"]);n!=null&&f(e,["maskMode"],n);const r=l(t,["segmentationClasses"]);r!=null&&f(e,["maskClasses"],r);const o=l(t,["maskDilation"]);return o!=null&&f(e,["dilation"],o),e}function Fl(t){const e={},n=l(t,["name"]);n!=null&&f(e,["name"],n);const r=l(t,["displayName"]);r!=null&&f(e,["displayName"],r);const o=l(t,["description"]);o!=null&&f(e,["description"],o);const i=l(t,["version"]);i!=null&&f(e,["version"],i);const s=l(t,["_self"]);s!=null&&f(e,["tunedModelInfo"],wS(s));const a=l(t,["inputTokenLimit"]);a!=null&&f(e,["inputTokenLimit"],a);const c=l(t,["outputTokenLimit"]);c!=null&&f(e,["outputTokenLimit"],c);const d=l(t,["supportedGenerationMethods"]);d!=null&&f(e,["supportedActions"],d);const h=l(t,["temperature"]);h!=null&&f(e,["temperature"],h);const m=l(t,["maxTemperature"]);m!=null&&f(e,["maxTemperature"],m);const p=l(t,["topP"]);p!=null&&f(e,["topP"],p);const g=l(t,["topK"]);g!=null&&f(e,["topK"],g);const E=l(t,["thinking"]);return E!=null&&f(e,["thinking"],E),e}function Gl(t){const e={},n=l(t,["name"]);n!=null&&f(e,["name"],n);const r=l(t,["displayName"]);r!=null&&f(e,["displayName"],r);const o=l(t,["description"]);o!=null&&f(e,["description"],o);const i=l(t,["versionId"]);i!=null&&f(e,["version"],i);const s=l(t,["deployedModels"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(p=>ET(p))),f(e,["endpoints"],m)}const a=l(t,["labels"]);a!=null&&f(e,["labels"],a);const c=l(t,["_self"]);c!=null&&f(e,["tunedModelInfo"],NS(c));const d=l(t,["defaultCheckpointId"]);d!=null&&f(e,["defaultCheckpointId"],d);const h=l(t,["checkpoints"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(p=>p)),f(e,["checkpoints"],m)}return e}function lS(t){const e={},n=l(t,["mediaResolution"]);n!=null&&f(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&f(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&f(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&f(e,["fileData"],TT(i));const s=l(t,["functionCall"]);s!=null&&f(e,["functionCall"],ST(s));const a=l(t,["functionResponse"]);a!=null&&f(e,["functionResponse"],a);const c=l(t,["inlineData"]);c!=null&&f(e,["inlineData"],YE(c));const d=l(t,["text"]);d!=null&&f(e,["text"],d);const h=l(t,["thought"]);h!=null&&f(e,["thought"],h);const m=l(t,["thoughtSignature"]);m!=null&&f(e,["thoughtSignature"],m);const p=l(t,["videoMetadata"]);return p!=null&&f(e,["videoMetadata"],p),e}function uS(t){const e={},n=l(t,["productImage"]);return n!=null&&f(e,["image"],vn(n)),e}function cS(t,e){const n={},r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&f(e,["parameters","sampleCount"],r);const o=l(t,["baseSteps"]);e!==void 0&&o!=null&&f(e,["parameters","baseSteps"],o);const i=l(t,["outputGcsUri"]);e!==void 0&&i!=null&&f(e,["parameters","storageUri"],i);const s=l(t,["seed"]);e!==void 0&&s!=null&&f(e,["parameters","seed"],s);const a=l(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&f(e,["parameters","safetySetting"],a);const c=l(t,["personGeneration"]);e!==void 0&&c!=null&&f(e,["parameters","personGeneration"],c);const d=l(t,["addWatermark"]);e!==void 0&&d!=null&&f(e,["parameters","addWatermark"],d);const h=l(t,["outputMimeType"]);e!==void 0&&h!=null&&f(e,["parameters","outputOptions","mimeType"],h);const m=l(t,["outputCompressionQuality"]);e!==void 0&&m!=null&&f(e,["parameters","outputOptions","compressionQuality"],m);const p=l(t,["enhancePrompt"]);e!==void 0&&p!=null&&f(e,["parameters","enhancePrompt"],p);const g=l(t,["labels"]);return e!==void 0&&g!=null&&f(e,["labels"],g),n}function dS(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["source"]);o!=null&&hS(o,n);const i=l(e,["config"]);return i!=null&&cS(i,n),n}function fS(t){const e={},n=l(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>oa(o))),f(e,["generatedImages"],r)}return e}function hS(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&f(e,["instances[0]","prompt"],r);const o=l(t,["personImage"]);e!==void 0&&o!=null&&f(e,["instances[0]","personImage","image"],vn(o));const i=l(t,["productImages"]);if(e!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>uS(a))),f(e,["instances[0]","productImages"],s)}return n}function pS(t){const e={},n=l(t,["referenceImage"]);n!=null&&f(e,["referenceImage"],vn(n));const r=l(t,["referenceId"]);r!=null&&f(e,["referenceId"],r);const o=l(t,["referenceType"]);o!=null&&f(e,["referenceType"],o);const i=l(t,["maskImageConfig"]);i!=null&&f(e,["maskImageConfig"],aS(i));const s=l(t,["controlImageConfig"]);s!=null&&f(e,["controlImageConfig"],eT(s));const a=l(t,["styleImageConfig"]);a!=null&&f(e,["styleImageConfig"],a);const c=l(t,["subjectImageConfig"]);return c!=null&&f(e,["subjectImageConfig"],c),e}function _m(t){const e={},n=l(t,["safetyAttributes","categories"]);n!=null&&f(e,["categories"],n);const r=l(t,["safetyAttributes","scores"]);r!=null&&f(e,["scores"],r);const o=l(t,["contentType"]);return o!=null&&f(e,["contentType"],o),e}function Rm(t){const e={},n=l(t,["safetyAttributes","categories"]);n!=null&&f(e,["categories"],n);const r=l(t,["safetyAttributes","scores"]);r!=null&&f(e,["scores"],r);const o=l(t,["contentType"]);return o!=null&&f(e,["contentType"],o),e}function mS(t){const e={},n=l(t,["category"]);if(n!=null&&f(e,["category"],n),l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=l(t,["threshold"]);return r!=null&&f(e,["threshold"],r),e}function gS(t){const e={},n=l(t,["image"]);return n!=null&&f(e,["image"],vn(n)),e}function yS(t,e){const n={},r=l(t,["mode"]);e!==void 0&&r!=null&&f(e,["parameters","mode"],r);const o=l(t,["maxPredictions"]);e!==void 0&&o!=null&&f(e,["parameters","maxPredictions"],o);const i=l(t,["confidenceThreshold"]);e!==void 0&&i!=null&&f(e,["parameters","confidenceThreshold"],i);const s=l(t,["maskDilation"]);e!==void 0&&s!=null&&f(e,["parameters","maskDilation"],s);const a=l(t,["binaryColorThreshold"]);e!==void 0&&a!=null&&f(e,["parameters","binaryColorThreshold"],a);const c=l(t,["labels"]);return e!==void 0&&c!=null&&f(e,["labels"],c),n}function vS(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["source"]);o!=null&&ES(o,n);const i=l(e,["config"]);return i!=null&&yS(i,n),n}function xS(t){const e={},n=l(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>$T(o))),f(e,["generatedMasks"],r)}return e}function ES(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&f(e,["instances[0]","prompt"],r);const o=l(t,["image"]);e!==void 0&&o!=null&&f(e,["instances[0]","image"],vn(o));const i=l(t,["scribbleImage"]);return e!==void 0&&i!=null&&f(e,["instances[0]","scribble"],gS(i)),n}function TS(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&f(e,["functionCallingConfig"],wT(n));const r=l(t,["retrievalConfig"]);return r!=null&&f(e,["retrievalConfig"],r),e}function SS(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(m=>m)),f(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&f(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&f(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&f(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&f(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&f(e,["googleMaps"],JT(a));const c=l(t,["googleSearch"]);c!=null&&f(e,["googleSearch"],XT(c));const d=l(t,["urlContext"]);return d!=null&&f(e,["urlContext"],d),e}function km(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let m=n;Array.isArray(m)&&(m=m.map(p=>NT(p))),f(e,["functionDeclarations"],m)}const r=l(t,["retrieval"]);r!=null&&f(e,["retrieval"],r);const o=l(t,["googleSearchRetrieval"]);o!=null&&f(e,["googleSearchRetrieval"],o);const i=l(t,["computerUse"]);if(i!=null&&f(e,["computerUse"],i),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=l(t,["codeExecution"]);s!=null&&f(e,["codeExecution"],s);const a=l(t,["enterpriseWebSearch"]);a!=null&&f(e,["enterpriseWebSearch"],a);const c=l(t,["googleMaps"]);c!=null&&f(e,["googleMaps"],c);const d=l(t,["googleSearch"]);d!=null&&f(e,["googleSearch"],d);const h=l(t,["urlContext"]);return h!=null&&f(e,["urlContext"],h),e}function wS(t){const e={},n=l(t,["baseModel"]);n!=null&&f(e,["baseModel"],n);const r=l(t,["createTime"]);r!=null&&f(e,["createTime"],r);const o=l(t,["updateTime"]);return o!=null&&f(e,["updateTime"],o),e}function NS(t){const e={},n=l(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&f(e,["baseModel"],n);const r=l(t,["createTime"]);r!=null&&f(e,["createTime"],r);const o=l(t,["updateTime"]);return o!=null&&f(e,["updateTime"],o),e}function CS(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&f(e,["displayName"],r);const o=l(t,["description"]);e!==void 0&&o!=null&&f(e,["description"],o);const i=l(t,["defaultCheckpointId"]);return e!==void 0&&i!=null&&f(e,["defaultCheckpointId"],i),n}function IS(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&f(e,["displayName"],r);const o=l(t,["description"]);e!==void 0&&o!=null&&f(e,["description"],o);const i=l(t,["defaultCheckpointId"]);return e!==void 0&&i!=null&&f(e,["defaultCheckpointId"],i),n}function bS(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","name"],Ye(t,r));const o=l(e,["config"]);return o!=null&&CS(o,n),n}function AS(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["config"]);return o!=null&&IS(o,n),n}function _S(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&f(e,["parameters","storageUri"],r);const o=l(t,["safetyFilterLevel"]);e!==void 0&&o!=null&&f(e,["parameters","safetySetting"],o);const i=l(t,["personGeneration"]);e!==void 0&&i!=null&&f(e,["parameters","personGeneration"],i);const s=l(t,["includeRaiReason"]);e!==void 0&&s!=null&&f(e,["parameters","includeRaiReason"],s);const a=l(t,["outputMimeType"]);e!==void 0&&a!=null&&f(e,["parameters","outputOptions","mimeType"],a);const c=l(t,["outputCompressionQuality"]);e!==void 0&&c!=null&&f(e,["parameters","outputOptions","compressionQuality"],c);const d=l(t,["enhanceInputImage"]);e!==void 0&&d!=null&&f(e,["parameters","upscaleConfig","enhanceInputImage"],d);const h=l(t,["imagePreservationFactor"]);e!==void 0&&h!=null&&f(e,["parameters","upscaleConfig","imagePreservationFactor"],h);const m=l(t,["labels"]);e!==void 0&&m!=null&&f(e,["labels"],m);const p=l(t,["numberOfImages"]);e!==void 0&&p!=null&&f(e,["parameters","sampleCount"],p);const g=l(t,["mode"]);return e!==void 0&&g!=null&&f(e,["parameters","mode"],g),n}function RS(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["_url","model"],Ye(t,r));const o=l(e,["image"]);o!=null&&f(n,["instances[0]","image"],vn(o));const i=l(e,["upscaleFactor"]);i!=null&&f(n,["parameters","upscaleConfig","upscaleFactor"],i);const s=l(e,["config"]);return s!=null&&_S(s,n),n}function kS(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>oa(i))),f(e,["generatedImages"],o)}return e}function PS(t){const e={},n=l(t,["uri"]);n!=null&&f(e,["uri"],n);const r=l(t,["encodedVideo"]);r!=null&&f(e,["videoBytes"],cr(r));const o=l(t,["encoding"]);return o!=null&&f(e,["mimeType"],o),e}function OS(t){const e={},n=l(t,["gcsUri"]);n!=null&&f(e,["uri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&f(e,["videoBytes"],cr(r));const o=l(t,["mimeType"]);return o!=null&&f(e,["mimeType"],o),e}function MS(t){const e={},n=l(t,["image"]);n!=null&&f(e,["_self"],vn(n));const r=l(t,["maskMode"]);return r!=null&&f(e,["maskMode"],r),e}function LS(t){const e={},n=l(t,["image"]);n!=null&&f(e,["image"],ia(n));const r=l(t,["referenceType"]);return r!=null&&f(e,["referenceType"],r),e}function DS(t){const e={},n=l(t,["image"]);n!=null&&f(e,["image"],vn(n));const r=l(t,["referenceType"]);return r!=null&&f(e,["referenceType"],r),e}function Pm(t){const e={},n=l(t,["uri"]);n!=null&&f(e,["uri"],n);const r=l(t,["videoBytes"]);r!=null&&f(e,["encodedVideo"],cr(r));const o=l(t,["mimeType"]);return o!=null&&f(e,["encoding"],o),e}function Om(t){const e={},n=l(t,["uri"]);n!=null&&f(e,["gcsUri"],n);const r=l(t,["videoBytes"]);r!=null&&f(e,["bytesBase64Encoded"],cr(r));const o=l(t,["mimeType"]);return o!=null&&f(e,["mimeType"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function US(t,e){const n={},r=l(t,["displayName"]);return e!==void 0&&r!=null&&f(e,["displayName"],r),n}function FS(t){const e={},n=l(t,["config"]);return n!=null&&US(n,e),e}function GS(t,e){const n={},r=l(t,["force"]);return e!==void 0&&r!=null&&f(e,["_query","force"],r),n}function HS(t){const e={},n=l(t,["name"]);n!=null&&f(e,["_url","name"],n);const r=l(t,["config"]);return r!=null&&GS(r,e),e}function BS(t){const e={},n=l(t,["name"]);return n!=null&&f(e,["_url","name"],n),e}function jS(t,e){const n={},r=l(t,["customMetadata"]);if(e!==void 0&&r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),f(e,["customMetadata"],i)}const o=l(t,["chunkingConfig"]);return e!==void 0&&o!=null&&f(e,["chunkingConfig"],o),n}function VS(t){const e={},n=l(t,["name"]);n!=null&&f(e,["name"],n);const r=l(t,["metadata"]);r!=null&&f(e,["metadata"],r);const o=l(t,["done"]);o!=null&&f(e,["done"],o);const i=l(t,["error"]);i!=null&&f(e,["error"],i);const s=l(t,["response"]);return s!=null&&f(e,["response"],zS(s)),e}function $S(t){const e={},n=l(t,["fileSearchStoreName"]);n!=null&&f(e,["_url","file_search_store_name"],n);const r=l(t,["fileName"]);r!=null&&f(e,["fileName"],r);const o=l(t,["config"]);return o!=null&&jS(o,e),e}function zS(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["parent"]);r!=null&&f(e,["parent"],r);const o=l(t,["documentName"]);return o!=null&&f(e,["documentName"],o),e}function WS(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&f(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&f(e,["_query","pageToken"],o),n}function YS(t){const e={},n=l(t,["config"]);return n!=null&&WS(n,e),e}function qS(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&f(e,["nextPageToken"],r);const o=l(t,["fileSearchStores"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),f(e,["fileSearchStores"],i)}return e}function Mm(t,e){const n={},r=l(t,["mimeType"]);e!==void 0&&r!=null&&f(e,["mimeType"],r);const o=l(t,["displayName"]);e!==void 0&&o!=null&&f(e,["displayName"],o);const i=l(t,["customMetadata"]);if(e!==void 0&&i!=null){let a=i;Array.isArray(a)&&(a=a.map(c=>c)),f(e,["customMetadata"],a)}const s=l(t,["chunkingConfig"]);return e!==void 0&&s!=null&&f(e,["chunkingConfig"],s),n}function KS(t){const e={},n=l(t,["fileSearchStoreName"]);n!=null&&f(e,["_url","file_search_store_name"],n);const r=l(t,["config"]);return r!=null&&Mm(r,e),e}function JS(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&f(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const XS="Content-Type",ZS="X-Server-Timeout",QS="User-Agent",Hl="x-goog-api-client",ew="1.34.0",tw=`google-genai-sdk/${ew}`,nw="v1beta1",rw="v1beta";class ow{constructor(e){var n,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const o={};this.clientOptions.vertexai?(o.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:nw,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:rw,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){const o=[this.getRequestUrlInternal(n)];return r&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,r);if(e.queryParams)for(const[s,a]of Object.entries(e.queryParams))o.searchParams.append(s,String(a));let i={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,n,o.toString(),e.abortSignal),this.unaryApiCall(o,i,e.httpMethod)}patchHttpOptions(e,n){const r=JSON.parse(JSON.stringify(e));for(const[o,i]of Object.entries(n))typeof i=="object"?r[o]=Object.assign(Object.assign({},r[o]),i):i!==void 0&&(r[o]=i);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,r);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,n,o.toString(),e.abortSignal),this.streamApiCall(o,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r,o){if(n&&n.timeout||o){const i=new AbortController,s=i.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const a=setTimeout(()=>i.abort(),n.timeout);a&&typeof a.unref=="function"&&a.unref()}o&&o.addEventListener("abort",()=>{i.abort()}),e.signal=s}return n&&n.extraBody!==null&&iw(e,n.extraBody),e.headers=await this.getHeadersInternal(n,r),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async o=>(await Df(o),new Ll(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async o=>(await Df(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){return pn(this,arguments,function*(){var r;const o=(r=e==null?void 0:e.body)===null||r===void 0?void 0:r.getReader(),i=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let s="";const a="data:",c=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:d,value:h}=yield Fe(o.read());if(d){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const m=i.decode(h,{stream:!0});try{const E=JSON.parse(m);if("error"in E){const x=JSON.parse(JSON.stringify(E.error)),w=x.status,y=x.code,v=`got status: ${w}. ${JSON.stringify(E)}`;if(y>=400&&y<600)throw new na({message:v,status:y})}}catch(E){if(E.name==="ApiError")throw E}s+=m;let p=-1,g=0;for(;;){p=-1,g=0;for(const w of c){const y=s.indexOf(w);y!==-1&&(p===-1||y<p)&&(p=y,g=w.length)}if(p===-1)break;const E=s.substring(0,p);s=s.substring(p+g);const x=E.trim();if(x.startsWith(a)){const w=x.substring(a.length).trim();try{const y=new Response(w,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Fe(new Ll(y))}catch(y){throw new Error(`exception parsing stream chunk ${w}. ${y}`)}}}}}finally{o.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const e={},n=tw+" "+this.clientOptions.userAgentExtra;return e[QS]=n,e[Hl]=n,e[XS]="application/json",e}async getHeadersInternal(e,n){const r=new Headers;if(e&&e.headers){for(const[o,i]of Object.entries(e.headers))r.append(o,i);e.timeout&&e.timeout>0&&r.append(ZS,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(e){var n;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(e,n){var r;const o={};n!=null&&(o.mimeType=n.mimeType,o.name=n.name,o.displayName=n.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);const i=this.clientOptions.uploader,s=await i.stat(e);o.sizeBytes=String(s.size);const a=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:s.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=a;const c={file:o},d=this.getFileName(e),h=Ne("upload/v1beta/files",c._url),m=await this.fetchUploadUrl(h,o.sizeBytes,o.mimeType,d,c,n==null?void 0:n.httpOptions);return i.upload(e,m,this)}async uploadFileToFileSearchStore(e,n,r){var o;const i=this.clientOptions.uploader,s=await i.stat(n),a=String(s.size),c=(o=r==null?void 0:r.mimeType)!==null&&o!==void 0?o:s.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const d=`upload/v1beta/${e}:uploadToFileSearchStore`,h=this.getFileName(n),m={};r!=null&&Mm(r,m);const p=await this.fetchUploadUrl(d,a,c,h,m,r==null?void 0:r.httpOptions);return i.uploadToFileSearchStore(n,p,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,r,o,i,s){var a;let c={};s?c=s:c={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},o?{"X-Goog-Upload-File-Name":o}:{})};const d=await this.request({path:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:c});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const h=(a=d==null?void 0:d.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}}async function Df(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};const o=JSON.stringify(r);throw n>=400&&n<600?new na({message:o,status:n}):new Error(o)}}function iw(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const i=JSON.parse(t.body);if(typeof i=="object"&&i!==null&&!Array.isArray(i))n=i;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(i,s){const a=Object.assign({},i);for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const d=s[c],h=a[c];d&&typeof d=="object"&&!Array.isArray(d)&&h&&typeof h=="object"&&!Array.isArray(h)?a[c]=r(h,d):(h&&d&&typeof h!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof h}, New type: ${typeof d}. Overwriting.`),a[c]=d)}return a}const o=r(n,e);t.body=JSON.stringify(o)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const sw="mcp_used/unknown";let aw=!1;function Lm(t){for(const e of t)if(lw(e)||typeof e=="object"&&"inputSchema"in e)return!0;return aw}function Dm(t){var e;const n=(e=t[Hl])!==null&&e!==void 0?e:"";t[Hl]=(n+` ${sw}`).trimStart()}function lw(t){return t!==null&&typeof t=="object"&&t instanceof Ju}function uw(t){return pn(this,arguments,function*(n,r=100){let o,i=0;for(;i<r;){const s=yield Fe(n.listTools({cursor:o}));for(const a of s.tools)yield yield Fe(a),i++;if(!s.nextCursor)break;o=s.nextCursor}})}class Ju{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new Ju(e,n)}async initialize(){var e,n,r,o;if(this.mcpTools.length>0)return;const i={},s=[];for(const h of this.mcpClients)try{for(var a=!0,c=(n=void 0,mn(uw(h))),d;d=await c.next(),e=d.done,!e;a=!0){o=d.value,a=!1;const m=o;s.push(m);const p=m.name;if(i[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);i[p]=h}}catch(m){n={error:m}}finally{try{!a&&!e&&(r=c.return)&&await r.call(c)}finally{if(n)throw n.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),Bv(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const o=this.functionNameToMcpClient[r.name];let i;this.config.timeout&&(i={timeout:this.config.timeout});const s=await o.callTool({name:r.name,arguments:r.args},void 0,i);n.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function cw(t,e,n){const r=new Ov;let o;n.data instanceof Blob?o=JSON.parse(await n.data.text()):o=JSON.parse(n.data),Object.assign(r,o),e(r)}class dw{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const o=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),s=pw(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),c=`${o}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${a}`;let d=()=>{};const h=new Promise(T=>{d=T}),m=e.callbacks,p=function(){d({})},g=this.apiClient,E={onopen:p,onmessage:T=>{cw(g,m.onmessage,T)},onerror:(n=m==null?void 0:m.onerror)!==null&&n!==void 0?n:function(T){},onclose:(r=m==null?void 0:m.onclose)!==null&&r!==void 0?r:function(T){}},x=this.webSocketFactory.create(c,hw(s),E);x.connect(),await h;const v={setup:{model:Ye(this.apiClient,e.model)}};return x.send(JSON.stringify(v)),new fw(x,this.apiClient)}}class fw{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=FE(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=UE(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(Jr.PLAY)}pause(){this.sendPlaybackControl(Jr.PAUSE)}stop(){this.sendPlaybackControl(Jr.STOP)}resetContext(){this.sendPlaybackControl(Jr.RESET_CONTEXT)}close(){this.conn.close()}}function hw(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function pw(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mw="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function gw(t,e,n){const r=new Pv;let o;n.data instanceof Blob?o=await n.data.text():n.data instanceof ArrayBuffer?o=new TextDecoder().decode(n.data):o=n.data;const i=JSON.parse(o);if(t.isVertexAI()){const s=BE(i);Object.assign(r,s)}else Object.assign(r,i);e(r)}class yw{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new dw(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,o,i,s,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let h;const m=this.apiClient.getHeaders();e.config&&e.config.tools&&Lm(e.config.tools)&&Dm(m);const p=Tw(m);if(this.apiClient.isVertexAI())h=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p,h);else{const D=this.apiClient.getApiKey();let V="BidiGenerateContent",X="key";D!=null&&D.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),V="BidiGenerateContentConstrained",X="access_token"),h=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.${V}?${X}=${D}`}let g=()=>{};const E=new Promise(D=>{g=D}),x=e.callbacks,w=function(){var D;(D=x==null?void 0:x.onopen)===null||D===void 0||D.call(x),g({})},y=this.apiClient,v={onopen:w,onmessage:D=>{gw(y,x.onmessage,D)},onerror:(n=x==null?void 0:x.onerror)!==null&&n!==void 0?n:function(D){},onclose:(r=x==null?void 0:x.onclose)!==null&&r!==void 0?r:function(D){}},T=this.webSocketFactory.create(h,Ew(p),v);T.connect(),await E;let I=Ye(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&I.startsWith("publishers/")){const D=this.apiClient.getProject(),V=this.apiClient.getLocation();I=`projects/${D}/locations/${V}/`+I}let A={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Os.AUDIO]}:e.config.responseModalities=[Os.AUDIO]),!((i=e.config)===null||i===void 0)&&i.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const O=(a=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&a!==void 0?a:[],k=[];for(const D of O)if(this.isCallableTool(D)){const V=D;k.push(await V.tool())}else k.push(D);k.length>0&&(e.config.tools=k);const j={model:I,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?A=DE(this.apiClient,j):A=LE(this.apiClient,j),delete A.config,T.send(JSON.stringify(A)),new xw(T,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const vw={turnComplete:!0};class xw{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=nn(n.turns),e.isVertexAI()||(r=r.map(o=>ra(o)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const i of r){if(typeof i!="object"||i===null||!("name"in i)||!("response"in i))throw new Error(`Could not parse function response, type '${typeof i}'.`);if(!e.isVertexAI()&&!("id"in i))throw new Error(mw)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},vw),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:HE(e)}:n={realtimeInput:GE(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function Ew(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function Tw(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Uf=10;function Ff(t){var e,n,r;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(const s of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(io(s)){o=!0;break}if(!o)return!0;const i=(r=t==null?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return i&&(i<0||!Number.isInteger(i))||i==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",i),!0):!1}function io(t){return"callTool"in t&&typeof t.callTool=="function"}function Sw(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(o=>io(o)))!==null&&r!==void 0?r:!1}function Gf(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((r,o)=>{if(io(r))return;const i=r;i.functionDeclarations&&i.functionDeclarations.length>0&&n.push(o)}),n}function Hf(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ww extends Un{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var r,o,i,s,a;const c=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!Sw(n)||Ff(n.config))return await this.generateContentInternal(c);const d=Gf(n);if(d.length>0){const x=d.map(w=>`tools[${w}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${x}.`)}let h,m;const p=nn(c.contents),g=(i=(o=(r=c.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&i!==void 0?i:Uf;let E=0;for(;E<g&&(h=await this.generateContentInternal(c),!(!h.functionCalls||h.functionCalls.length===0));){const x=h.candidates[0].content,w=[];for(const y of(a=(s=n.config)===null||s===void 0?void 0:s.tools)!==null&&a!==void 0?a:[])if(io(y)){const T=await y.callTool(h.functionCalls);w.push(...T)}E++,m={role:"user",parts:w},c.contents=nn(c.contents),c.contents.push(x),c.contents.push(m),Hf(c.config)&&(p.push(x),p.push(m))}return Hf(c.config)&&(h.automaticFunctionCallingHistory=p),h},this.generateContentStream=async n=>{var r,o,i,s,a;if(this.maybeMoveToResponseJsonSchem(n),Ff(n.config)){const m=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(m)}const c=Gf(n);if(c.length>0){const m=c.map(p=>`tools[${p}]`).join(", ");throw new Error(`Incompatible tools found at ${m}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const d=(i=(o=(r=n==null?void 0:n.config)===null||r===void 0?void 0:r.toolConfig)===null||o===void 0?void 0:o.functionCallingConfig)===null||i===void 0?void 0:i.streamFunctionCallArguments,h=(a=(s=n==null?void 0:n.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(d&&!h)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var o;let i;const s=[];if(r!=null&&r.generatedImages)for(const c of r.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((o=c==null?void 0:c.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?i=c==null?void 0:c.safetyAttributes:s.push(c);let a;return i?a={generatedImages:s,positivePromptSafetyAttributes:i,sdkHttpResponse:r.sdkHttpResponse}:a={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},a}),this.list=async n=>{var r;const s={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new Rr(Ln.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(s),s)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const o={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(o)},this.generateVideos=async n=>{var r,o,i,s,a,c;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((o=n.video)===null||o===void 0)&&o.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((s=(i=n.source)===null||i===void 0?void 0:i.video)===null||s===void 0)&&s.uri&&(!((c=(a=n.source)===null||a===void 0?void 0:a.video)===null||c===void 0)&&c.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,o;const i=(n=e.config)===null||n===void 0?void 0:n.tools;if(!i)return e;const s=await Promise.all(i.map(async c=>io(c)?await c.tool():c)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(a.config.tools=s,e.config&&e.config.tools&&Lm(e.config.tools)){const c=(o=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&o!==void 0?o:{};let d=Object.assign({},c);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),Dm(d),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return a}async initAfcToolsMap(e){var n,r,o;const i=new Map;for(const s of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(io(s)){const a=s,c=await a.tool();for(const d of(o=c.functionDeclarations)!==null&&o!==void 0?o:[]){if(!d.name)throw new Error("Function declaration name is required.");if(i.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);i.set(d.name,a)}}return i}async processAfcStream(e){var n,r,o;const i=(o=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&o!==void 0?o:Uf;let s=!1,a=0;const c=await this.initAfcToolsMap(e);return function(d,h,m){return pn(this,arguments,function*(){for(var p,g,E,x,w,y;a<i;){s&&(a++,s=!1);const A=yield Fe(d.processParamsMaybeAddMcpUsage(m)),O=yield Fe(d.generateContentStreamInternal(A)),k=[],j=[];try{for(var v=!0,T=(g=void 0,mn(O)),I;I=yield Fe(T.next()),p=I.done,!p;v=!0){x=I.value,v=!1;const D=x;if(yield yield Fe(D),D.candidates&&(!((w=D.candidates[0])===null||w===void 0)&&w.content)){j.push(D.candidates[0].content);for(const V of(y=D.candidates[0].content.parts)!==null&&y!==void 0?y:[])if(a<i&&V.functionCall){if(!V.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(V.functionCall.name)){const X=yield Fe(h.get(V.functionCall.name).callTool([V.functionCall]));k.push(...X)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${V.functionCall.name}`)}}}}catch(D){g={error:D}}finally{try{!v&&!p&&(E=T.return)&&(yield Fe(E.call(T)))}finally{if(g)throw g.error}}if(k.length>0){s=!0;const D=new Po;D.candidates=[{content:{role:"user",parts:k}}],yield yield Fe(D);const V=[];V.push(...j),V.push({role:"user",parts:k});const X=nn(m.contents).concat(V);m.contents=X}else break}})}(this,c,e)}async generateContentInternal(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=Of(this.apiClient,e);return a=Ne("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=Lf(h),p=new Po;return Object.assign(p,m),p})}else{const d=Pf(this.apiClient,e);return a=Ne("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=Mf(h),p=new Po;return Object.assign(p,m),p})}}async generateContentStreamInternal(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=Of(this.apiClient,e);return a=Ne("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(m){return pn(this,arguments,function*(){var p,g,E,x;try{for(var w=!0,y=mn(m),v;v=yield Fe(y.next()),p=v.done,!p;w=!0){x=v.value,w=!1;const T=x,I=Lf(yield Fe(T.json()));I.sdkHttpResponse={headers:T.headers};const A=new Po;Object.assign(A,I),yield yield Fe(A)}}catch(T){g={error:T}}finally{try{!w&&!p&&(E=y.return)&&(yield Fe(E.call(y)))}finally{if(g)throw g.error}}})})}else{const d=Pf(this.apiClient,e);return a=Ne("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(m){return pn(this,arguments,function*(){var p,g,E,x;try{for(var w=!0,y=mn(m),v;v=yield Fe(y.next()),p=v.done,!p;w=!0){x=v.value,w=!1;const T=x,I=Mf(yield Fe(T.json()));I.sdkHttpResponse={headers:T.headers};const A=new Po;Object.assign(A,I),yield yield Fe(A)}}catch(T){g={error:T}}finally{try{!w&&!p&&(E=y.return)&&(yield Fe(E.call(y)))}finally{if(g)throw g.error}}})})}}async embedContent(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=yT(this.apiClient,e);return a=Ne("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=xT(h),p=new mf;return Object.assign(p,m),p})}else{const d=gT(this.apiClient,e);return a=Ne("{model}:batchEmbedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=vT(h),p=new mf;return Object.assign(p,m),p})}}async generateImagesInternal(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=RT(this.apiClient,e);return a=Ne("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=PT(h),p=new gf;return Object.assign(p,m),p})}else{const d=_T(this.apiClient,e);return a=Ne("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=kT(h),p=new gf;return Object.assign(p,m),p})}}async editImageInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=fT(this.apiClient,e);return i=Ne("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),o.then(c=>{const d=hT(c),h=new Tv;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=RS(this.apiClient,e);return i=Ne("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),o.then(c=>{const d=kS(c),h=new Sv;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=dS(this.apiClient,e);return i=Ne("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>{const d=fS(c),h=new wv;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=vS(this.apiClient,e);return i=Ne("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>{const d=xS(c),h=new Nv;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=KT(this.apiClient,e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Gl(h))}else{const d=qT(this.apiClient,e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Fl(h))}}async listInternal(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=oS(this.apiClient,e);return a=Ne("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=sS(h),p=new yf;return Object.assign(p,m),p})}else{const d=rS(this.apiClient,e);return a=Ne("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=iS(h),p=new yf;return Object.assign(p,m),p})}}async update(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=AS(this.apiClient,e);return a=Ne("{model}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Gl(h))}else{const d=bS(this.apiClient,e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Fl(h))}}async delete(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=lT(this.apiClient,e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=cT(h),p=new vf;return Object.assign(p,m),p})}else{const d=aT(this.apiClient,e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=uT(h),p=new vf;return Object.assign(p,m),p})}}async countTokens(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=oT(this.apiClient,e);return a=Ne("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=sT(h),p=new xf;return Object.assign(p,m),p})}else{const d=rT(this.apiClient,e);return a=Ne("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=iT(h),p=new xf;return Object.assign(p,m),p})}}async computeTokens(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=JE(this.apiClient,e);return i=Ne("{model}:computeTokens",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),o.then(c=>{const d=XE(c),h=new Cv;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=FT(this.apiClient,e);return a=Ne("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>{const m=DT(h),p=new Ms;return Object.assign(p,m),p})}else{const d=UT(this.apiClient,e);return a=Ne("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const m=LT(h),p=new Ms;return Object.assign(p,m),p})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Nw extends Un{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=n.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async get(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=n.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=mv(e);return a=Ne("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s}else{const d=pv(e);return a=Ne("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s}}async fetchPredictVideosOperationInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=av(e);return i=Ne("{resourceName}:fetchPredictOperation",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Cw(t){const e={},n=l(t,["data"]);if(n!=null&&f(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function Iw(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>Lw(i))),f(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&f(e,["role"],r),e}function bw(t,e,n){const r={},o=l(e,["expireTime"]);n!==void 0&&o!=null&&f(n,["expireTime"],o);const i=l(e,["newSessionExpireTime"]);n!==void 0&&i!=null&&f(n,["newSessionExpireTime"],i);const s=l(e,["uses"]);n!==void 0&&s!=null&&f(n,["uses"],s);const a=l(e,["liveConnectConstraints"]);n!==void 0&&a!=null&&f(n,["bidiGenerateContentSetup"],Mw(t,a));const c=l(e,["lockAdditionalFields"]);return n!==void 0&&c!=null&&f(n,["fieldMask"],c),r}function Aw(t,e){const n={},r=l(e,["config"]);return r!=null&&f(n,["config"],bw(t,r,n)),n}function _w(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&f(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&f(e,["mimeType"],r),e}function Rw(t){const e={},n=l(t,["id"]);n!=null&&f(e,["id"],n);const r=l(t,["args"]);r!=null&&f(e,["args"],r);const o=l(t,["name"]);if(o!=null&&f(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function kw(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&f(e,["enableWidget"],n),e}function Pw(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&f(e,["timeRangeFilter"],n),e}function Ow(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&f(e,["setup","generationConfig"],r);const o=l(t,["responseModalities"]);e!==void 0&&o!=null&&f(e,["setup","generationConfig","responseModalities"],o);const i=l(t,["temperature"]);e!==void 0&&i!=null&&f(e,["setup","generationConfig","temperature"],i);const s=l(t,["topP"]);e!==void 0&&s!=null&&f(e,["setup","generationConfig","topP"],s);const a=l(t,["topK"]);e!==void 0&&a!=null&&f(e,["setup","generationConfig","topK"],a);const c=l(t,["maxOutputTokens"]);e!==void 0&&c!=null&&f(e,["setup","generationConfig","maxOutputTokens"],c);const d=l(t,["mediaResolution"]);e!==void 0&&d!=null&&f(e,["setup","generationConfig","mediaResolution"],d);const h=l(t,["seed"]);e!==void 0&&h!=null&&f(e,["setup","generationConfig","seed"],h);const m=l(t,["speechConfig"]);e!==void 0&&m!=null&&f(e,["setup","generationConfig","speechConfig"],Ku(m));const p=l(t,["thinkingConfig"]);e!==void 0&&p!=null&&f(e,["setup","generationConfig","thinkingConfig"],p);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&f(e,["setup","generationConfig","enableAffectiveDialog"],g);const E=l(t,["systemInstruction"]);e!==void 0&&E!=null&&f(e,["setup","systemInstruction"],Iw(kt(E)));const x=l(t,["tools"]);if(e!==void 0&&x!=null){let O=vo(x);Array.isArray(O)&&(O=O.map(k=>Uw(yo(k)))),f(e,["setup","tools"],O)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&f(e,["setup","sessionResumption"],Dw(w));const y=l(t,["inputAudioTranscription"]);e!==void 0&&y!=null&&f(e,["setup","inputAudioTranscription"],y);const v=l(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&f(e,["setup","outputAudioTranscription"],v);const T=l(t,["realtimeInputConfig"]);e!==void 0&&T!=null&&f(e,["setup","realtimeInputConfig"],T);const I=l(t,["contextWindowCompression"]);e!==void 0&&I!=null&&f(e,["setup","contextWindowCompression"],I);const A=l(t,["proactivity"]);if(e!==void 0&&A!=null&&f(e,["setup","proactivity"],A),l(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function Mw(t,e){const n={},r=l(e,["model"]);r!=null&&f(n,["setup","model"],Ye(t,r));const o=l(e,["config"]);return o!=null&&f(n,["config"],Ow(o,n)),n}function Lw(t){const e={},n=l(t,["mediaResolution"]);n!=null&&f(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&f(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&f(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&f(e,["fileData"],_w(i));const s=l(t,["functionCall"]);s!=null&&f(e,["functionCall"],Rw(s));const a=l(t,["functionResponse"]);a!=null&&f(e,["functionResponse"],a);const c=l(t,["inlineData"]);c!=null&&f(e,["inlineData"],Cw(c));const d=l(t,["text"]);d!=null&&f(e,["text"],d);const h=l(t,["thought"]);h!=null&&f(e,["thought"],h);const m=l(t,["thoughtSignature"]);m!=null&&f(e,["thoughtSignature"],m);const p=l(t,["videoMetadata"]);return p!=null&&f(e,["videoMetadata"],p),e}function Dw(t){const e={},n=l(t,["handle"]);if(n!=null&&f(e,["handle"],n),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Uw(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(m=>m)),f(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&f(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&f(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&f(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&f(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&f(e,["googleMaps"],kw(a));const c=l(t,["googleSearch"]);c!=null&&f(e,["googleSearch"],Pw(c));const d=l(t,["urlContext"]);return d!=null&&f(e,["urlContext"],d),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Fw(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const o=Object.keys(r).map(i=>`${n}.${i}`);e.push(...o)}else e.push(n)}return e.join(",")}function Gw(t,e){let n=null;const r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const i=r.setup;typeof i=="object"&&i!==null?(t.bidiGenerateContentSetup=i,n=i):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;const o=t.fieldMask;if(n){const i=Fw(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)i?t.fieldMask=i:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let a=[];o.length>0&&(a=o.map(d=>s.includes(d)?`generationConfig.${d}`:d));const c=[];i&&c.push(i),a.length>0&&c.push(...a),c.length>0?t.fieldMask=c.join(","):delete t.fieldMask}else delete t.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?t.fieldMask=o.join(","):delete t.fieldMask;return t}class Hw extends Un{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const a=Aw(this.apiClient,e);i=Ne("auth_tokens",a._url),s=a._query,delete a.config,delete a._url,delete a._query;const c=Gw(a,e.config);return o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bw(t,e){const n={},r=l(t,["force"]);return e!==void 0&&r!=null&&f(e,["_query","force"],r),n}function jw(t){const e={},n=l(t,["name"]);n!=null&&f(e,["_url","name"],n);const r=l(t,["config"]);return r!=null&&Bw(r,e),e}function Vw(t){const e={},n=l(t,["name"]);return n!=null&&f(e,["_url","name"],n),e}function $w(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&f(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&f(e,["_query","pageToken"],o),n}function zw(t){const e={},n=l(t,["parent"]);n!=null&&f(e,["_url","parent"],n);const r=l(t,["config"]);return r!=null&&$w(r,e),e}function Ww(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&f(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&f(e,["nextPageToken"],r);const o=l(t,["documents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),f(e,["documents"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Yw extends Un{constructor(e){super(),this.apiClient=e,this.list=async n=>new Rr(Ln.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Vw(e);return i=Ne("{name}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>c)}}async delete(e){var n,r;let o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=jw(e);o=Ne("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=zw(e);return i=Ne("{parent}/documents",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>{const d=Ww(c),h=new Iv;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class qw extends Un{constructor(e,n=new Yw(e)){super(),this.apiClient=e,this.documents=n,this.list=async(r={})=>new Rr(Ln.PAGED_ITEM_FILE_SEARCH_STORES,o=>this.listInternal(o),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=FS(e);return i=Ne("fileSearchStores",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>c)}}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=BS(e);return i=Ne("{name}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>c)}}async delete(e){var n,r;let o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=HS(e);o=Ne("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=YS(e);return i=Ne("fileSearchStores",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>{const d=qS(c),h=new bv;return Object.assign(h,d),h})}}async uploadToFileSearchStoreInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=KS(e);return i=Ne("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>{const d=JS(c),h=new Av;return Object.assign(h,d),h})}}async importFile(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=$S(e);return i=Ne("{file_search_store_name}:importFile",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>{const d=VS(c),h=new $u;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Um=function(){const{crypto:t}=globalThis;if(t!=null&&t.randomUUID)return Um=t.randomUUID.bind(t),t.randomUUID();const e=new Uint8Array(1),n=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))};const Kw=()=>Um();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bl(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}const jl=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){const e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class sn extends Error{}class Dt extends sn{constructor(e,n,r,o){super(`${Dt.makeMessage(e,n,r)}`),this.status=e,this.headers=o,this.error=n}static makeMessage(e,n,r){const o=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,n,r,o){if(!e||!o)return new sa({message:r,cause:jl(n)});const i=n;return e===400?new Gm(e,i,r,o):e===401?new Hm(e,i,r,o):e===403?new Bm(e,i,r,o):e===404?new jm(e,i,r,o):e===409?new Vm(e,i,r,o):e===422?new $m(e,i,r,o):e===429?new zm(e,i,r,o):e>=500?new Wm(e,i,r,o):new Dt(e,i,r,o)}}class Vl extends Dt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class sa extends Dt{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class Fm extends sa{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Gm extends Dt{}class Hm extends Dt{}class Bm extends Dt{}class jm extends Dt{}class Vm extends Dt{}class $m extends Dt{}class zm extends Dt{}class Wm extends Dt{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Jw=/^[a-z][a-z0-9+.-]*:/i,Xw=t=>Jw.test(t);let $l=t=>($l=Array.isArray,$l(t));const Zw=$l;let Qw=Zw;const Bf=Qw;function eN(t){if(!t)return!0;for(const e in t)return!1;return!0}function tN(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const nN=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new sn(`${t} must be an integer`);if(e<0)throw new sn(`${t} must be a positive integer`);return e},rN=t=>{try{return JSON.parse(t)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const oN=t=>new Promise(e=>setTimeout(e,t));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Lr="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function iN(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const sN=()=>{var t,e,n,r,o;const i=iN();if(i==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lr,"X-Stainless-OS":Vf(Deno.build.os),"X-Stainless-Arch":jf(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(t=Deno.version)===null||t===void 0?void 0:t.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(i==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lr,"X-Stainless-OS":Vf((n=globalThis.process.platform)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Arch":jf((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(o=globalThis.process.version)!==null&&o!==void 0?o:"unknown"};const s=aN();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Lr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function aN(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const o=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:e,version:`${o}.${i}.${s}`}}}return null}const jf=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",Vf=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let Bi;const lN=()=>Bi??(Bi=sN());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function uN(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Ym(...t){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function cN(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return Ym({start(){},async pull(n){const{done:r,value:o}=await e.next();r?n.close():n.enqueue(o)},async cancel(){var n;await((n=e.return)===null||n===void 0?void 0:n.call(e))}})}function qm(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function dN(t){var e,n;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((n=(e=t[Symbol.asyncIterator]()).return)===null||n===void 0?void 0:n.call(e));return}const r=t.getReader(),o=r.cancel();r.releaseLock(),await o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fN=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Km=()=>{var t;if(typeof File>"u"){const{process:e}=globalThis,n=typeof((t=e==null?void 0:e.versions)===null||t===void 0?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Ua(t,e,n){return Km(),new File(t,e??"unknown_file",n)}function hN(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}const pN=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Jm=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",mN=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Jm(t),gN=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function yN(t,e,n){if(Km(),t=await t,mN(t))return t instanceof File?t:Ua([await t.arrayBuffer()],t.name);if(gN(t)){const o=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),Ua(await zl(o),e,n)}const r=await zl(t);if(e||(e=hN(t)),!(n!=null&&n.type)){const o=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof o=="string"&&(n=Object.assign(Object.assign({},n),{type:o}))}return Ua(r,e,n)}async function zl(t){var e,n,r,o,i;let s=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)s.push(t);else if(Jm(t))s.push(t instanceof Blob?t:await t.arrayBuffer());else if(pN(t))try{for(var a=!0,c=mn(t),d;d=await c.next(),e=d.done,!e;a=!0){o=d.value,a=!1;const h=o;s.push(...await zl(h))}}catch(h){n={error:h}}finally{try{!a&&!e&&(r=c.return)&&await r.call(c)}finally{if(n)throw n.error}}else{const h=(i=t==null?void 0:t.constructor)===null||i===void 0?void 0:i.name;throw new Error(`Unexpected data type: ${typeof t}${h?`; constructor: ${h}`:""}${vN(t)}`)}return s}function vN(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Xm{constructor(e){this._client=e}}Xm._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Zm(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const $f=Object.freeze(Object.create(null)),xN=(t=Zm)=>function(n,...r){if(n.length===1)return n[0];let o=!1;const i=[],s=n.reduce((h,m,p)=>{var g,E,x;/[?#]/.test(m)&&(o=!0);const w=r[p];let y=(o?encodeURIComponent:t)(""+w);return p!==r.length&&(w==null||typeof w=="object"&&w.toString===((x=Object.getPrototypeOf((E=Object.getPrototypeOf((g=w.hasOwnProperty)!==null&&g!==void 0?g:$f))!==null&&E!==void 0?E:$f))===null||x===void 0?void 0:x.toString))&&(y=w+"",i.push({start:h.length+m.length,length:y.length,error:`Value of type ${Object.prototype.toString.call(w).slice(8,-1)} is not a valid path parameter`})),h+m+(p===r.length?"":y)},""),a=s.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let d;for(;(d=c.exec(a))!==null;)i.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(i.sort((h,m)=>h.start-m.start),i.length>0){let h=0;const m=i.reduce((p,g)=>{const E=" ".repeat(g.start-h),x="^".repeat(g.length);return h=g.start+g.length,p+E+x},"");throw new sn(`Path parameters result in path with invalid segments:
${i.map(p=>p.error).join(`
`)}
${s}
${m}`)}return s},ji=xN(Zm);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Qm extends Xm{create(e,n){var r;const{api_version:o=this._client.apiVersion}=e,i=Ds(e,["api_version"]);if("model"in i&&"agent_config"in i)throw new sn("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new sn("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(ji`/${o}/interactions`,Object.assign(Object.assign({body:i},n),{stream:(r=e.stream)!==null&&r!==void 0?r:!1}))}delete(e,n={},r){const{api_version:o=this._client.apiVersion}=n??{};return this._client.delete(ji`/${o}/interactions/${e}`,r)}cancel(e,n={},r){const{api_version:o=this._client.apiVersion}=n??{};return this._client.post(ji`/${o}/interactions/${e}/cancel`,r)}get(e,n={},r){var o;const i=n??{},{api_version:s=this._client.apiVersion}=i,a=Ds(i,["api_version"]);return this._client.get(ji`/${s}/interactions/${e}`,Object.assign(Object.assign({query:a},r),{stream:(o=n==null?void 0:n.stream)!==null&&o!==void 0?o:!1}))}}Qm._key=Object.freeze(["interactions"]);class eg extends Qm{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function EN(t){let e=0;for(const o of t)e+=o.length;const n=new Uint8Array(e);let r=0;for(const o of t)n.set(o,r),r+=o.length;return n}let Vi;function Xu(t){let e;return(Vi??(e=new globalThis.TextEncoder,Vi=e.encode.bind(e)))(t)}let $i;function zf(t){let e;return($i??(e=new globalThis.TextDecoder,$i=e.decode.bind(e)))(t)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class aa{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Xu(e):e;this.buffer=EN([this.buffer,n]);const r=[];let o;for(;(o=TN(this.buffer,this.carriageReturnIndex))!=null;){if(o.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=o.index;continue}if(this.carriageReturnIndex!=null&&(o.index!==this.carriageReturnIndex+1||o.carriage)){r.push(zf(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const i=this.carriageReturnIndex!==null?o.preceding-1:o.preceding,s=zf(this.buffer.subarray(0,i));r.push(s),this.buffer=this.buffer.subarray(o.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}}aa.NEWLINE_CHARS=new Set([`
`,"\r"]);aa.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function TN(t,e){for(let o=e??0;o<t.length;o++){if(t[o]===10)return{preceding:o,index:o+1,carriage:!1};if(t[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function SN(t){for(let r=0;r<t.length-1;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Us={off:0,error:200,warn:300,info:400,debug:500},Wf=(t,e,n)=>{if(t){if(tN(Us,t))return t;Ot(n).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(Us))}`)}};function Fo(){}function zi(t,e,n){return!e||Us[t]>Us[n]?Fo:e[t].bind(e)}const wN={error:Fo,warn:Fo,info:Fo,debug:Fo};let Yf=new WeakMap;function Ot(t){var e;const n=t.logger,r=(e=t.logLevel)!==null&&e!==void 0?e:"off";if(!n)return wN;const o=Yf.get(n);if(o&&o[0]===r)return o[1];const i={error:zi("error",n,r),warn:zi("warn",n,r),info:zi("info",n,r),debug:zi("debug",n,r)};return Yf.set(n,[r,i]),i}const mr=t=>(t.options&&(t.options=Object.assign({},t.options),delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,n])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Xr{constructor(e,n,r){this.iterator=e,this.controller=n,this.client=r}static fromSSEResponse(e,n,r){let o=!1;const i=r?Ot(r):console;function s(){return pn(this,arguments,function*(){var c,d,h,m;if(o)throw new sn("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let p=!1;try{try{for(var g=!0,E=mn(NN(e,n)),x;x=yield Fe(E.next()),c=x.done,!c;g=!0){m=x.value,g=!1;const w=m;if(!p)if(w.data.startsWith("[DONE]")){p=!0;continue}else try{yield yield Fe(JSON.parse(w.data))}catch(y){throw i.error("Could not parse message into JSON:",w.data),i.error("From chunk:",w.raw),y}}}catch(w){d={error:w}}finally{try{!g&&!c&&(h=E.return)&&(yield Fe(h.call(E)))}finally{if(d)throw d.error}}p=!0}catch(w){if(Bl(w))return yield Fe(void 0);throw w}finally{p||n.abort()}})}return new Xr(s,n,r)}static fromReadableStream(e,n,r){let o=!1;function i(){return pn(this,arguments,function*(){var c,d,h,m;const p=new aa,g=qm(e);try{for(var E=!0,x=mn(g),w;w=yield Fe(x.next()),c=w.done,!c;E=!0){m=w.value,E=!1;const y=m;for(const v of p.decode(y))yield yield Fe(v)}}catch(y){d={error:y}}finally{try{!E&&!c&&(h=x.return)&&(yield Fe(h.call(x)))}finally{if(d)throw d.error}}for(const y of p.flush())yield yield Fe(y)})}function s(){return pn(this,arguments,function*(){var c,d,h,m;if(o)throw new sn("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let p=!1;try{try{for(var g=!0,E=mn(i()),x;x=yield Fe(E.next()),c=x.done,!c;g=!0){m=x.value,g=!1;const w=m;p||w&&(yield yield Fe(JSON.parse(w)))}}catch(w){d={error:w}}finally{try{!g&&!c&&(h=E.return)&&(yield Fe(h.call(E)))}finally{if(d)throw d.error}}p=!0}catch(w){if(Bl(w))return yield Fe(void 0);throw w}finally{p||n.abort()}})}return new Xr(s,n,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),o=i=>({next:()=>{if(i.length===0){const s=r.next();e.push(s),n.push(s)}return i.shift()}});return[new Xr(()=>o(e),this.controller,this.client),new Xr(()=>o(n),this.controller,this.client)]}toReadableStream(){const e=this;let n;return Ym({async start(){n=e[Symbol.asyncIterator]()},async pull(r){try{const{value:o,done:i}=await n.next();if(i)return r.close();const s=Xu(JSON.stringify(o)+`
`);r.enqueue(s)}catch(o){r.error(o)}},async cancel(){var r;await((r=n.return)===null||r===void 0?void 0:r.call(n))}})}}function NN(t,e){return pn(this,arguments,function*(){var r,o,i,s;if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new sn("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new sn("Attempted to iterate over a response with no body");const a=new IN,c=new aa,d=qm(t.body);try{for(var h=!0,m=mn(CN(d)),p;p=yield Fe(m.next()),r=p.done,!r;h=!0){s=p.value,h=!1;const g=s;for(const E of c.decode(g)){const x=a.decode(E);x&&(yield yield Fe(x))}}}catch(g){o={error:g}}finally{try{!h&&!r&&(i=m.return)&&(yield Fe(i.call(m)))}finally{if(o)throw o.error}}for(const g of c.flush()){const E=a.decode(g);E&&(yield yield Fe(E))}})}function CN(t){return pn(this,arguments,function*(){var n,r,o,i;let s=new Uint8Array;try{for(var a=!0,c=mn(t),d;d=yield Fe(c.next()),n=d.done,!n;a=!0){i=d.value,a=!1;const h=i;if(h==null)continue;const m=h instanceof ArrayBuffer?new Uint8Array(h):typeof h=="string"?Xu(h):h;let p=new Uint8Array(s.length+m.length);p.set(s),p.set(m,s.length),s=p;let g;for(;(g=SN(s))!==-1;)yield yield Fe(s.slice(0,g)),s=s.slice(g)}}catch(h){r={error:h}}finally{try{!a&&!n&&(o=c.return)&&(yield Fe(o.call(c)))}finally{if(r)throw r.error}}s.length>0&&(yield yield Fe(s))})}class IN{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,o]=bN(e,":");return o.startsWith(" ")&&(o=o.substring(1)),n==="event"?this.event=o:n==="data"&&this.data.push(o),null}}function bN(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function AN(t,e){const{response:n,requestLogID:r,retryOfRequestLogID:o,startTime:i}=e,s=await(async()=>{var a;if(e.options.stream)return Ot(t).debug("response",n.status,n.url,n.headers,n.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(n,e.controller,t):Xr.fromSSEResponse(n,e.controller,t);if(n.status===204)return null;if(e.options.__binaryResponse)return n;const c=n.headers.get("content-type"),d=(a=c==null?void 0:c.split(";")[0])===null||a===void 0?void 0:a.trim();return(d==null?void 0:d.includes("application/json"))||(d==null?void 0:d.endsWith("+json"))?await n.json():await n.text()})();return Ot(t).debug(`[${r}] response parsed`,mr({retryOfRequestLogID:o,url:n.url,status:n.status,body:s,durationMs:Date.now()-i})),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Zu extends Promise{constructor(e,n,r=AN){super(o=>{o(null)}),this.responsePromise=n,this.parseResponse=r,this.client=e}_thenUnwrap(e){return new Zu(this.client,this.responsePromise,async(n,r)=>e(await this.parseResponse(n,r),r))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const tg=Symbol("brand.privateNullableHeaders");function*_N(t){if(!t)return;if(tg in t){const{values:r,nulls:o}=t;yield*r.entries();for(const i of o)yield[i,null];return}let e=!1,n;t instanceof Headers?n=t.entries():Bf(t)?n=t:(e=!0,n=Object.entries(t??{}));for(let r of n){const o=r[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");const i=Bf(r[1])?r[1]:[r[1]];let s=!1;for(const a of i)a!==void 0&&(e&&!s&&(s=!0,yield[o,null]),yield[o,a])}}const Oo=t=>{const e=new Headers,n=new Set;for(const r of t){const o=new Set;for(const[i,s]of _N(r)){const a=i.toLowerCase();o.has(a)||(e.delete(i),o.add(a)),s===null?(e.delete(i),n.add(a)):(e.append(i,s),n.delete(a))}}return{[tg]:!0,values:e,nulls:n}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Fa=t=>{var e,n,r,o,i,s;if(typeof globalThis.process<"u")return(r=(n=(e=tv)===null||e===void 0?void 0:e[t])===null||n===void 0?void 0:n.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(s=(i=(o=globalThis.Deno.env)===null||o===void 0?void 0:o.get)===null||i===void 0?void 0:i.call(o,t))===null||s===void 0?void 0:s.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ng;class la{constructor(e){var n,r,o,i,s,a,c,{baseURL:d=Fa("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:h=(n=Fa("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:m="v1beta"}=e,p=Ds(e,["baseURL","apiKey","apiVersion"]);const g=Object.assign(Object.assign({apiKey:h,apiVersion:m},p),{baseURL:d||"https://generativelanguage.googleapis.com"});this.baseURL=g.baseURL,this.timeout=(r=g.timeout)!==null&&r!==void 0?r:la.DEFAULT_TIMEOUT,this.logger=(o=g.logger)!==null&&o!==void 0?o:console;const E="warn";this.logLevel=E,this.logLevel=(s=(i=Wf(g.logLevel,"ClientOptions.logLevel",this))!==null&&i!==void 0?i:Wf(Fa("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&s!==void 0?s:E,this.fetchOptions=g.fetchOptions,this.maxRetries=(a=g.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(c=g.fetch)!==null&&c!==void 0?c:uN(),this.encoder=fN,this._options=g,this.apiKey=h,this.apiVersion=m,this.clientAdapter=g.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:n}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const n=Oo([e.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return Oo([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Oo([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new sn(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Lr}`}defaultIdempotencyKey(){return`stainless-node-retry-${Kw()}`}makeStatusError(e,n,r,o){return Dt.generate(e,n,r,o)}buildURL(e,n,r){const o=!this.baseURLOverridden()&&r||this.baseURL,i=Xw(e)?new URL(e):new URL(o+(o.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return eN(s)||(n=Object.assign(Object.assign({},s),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(i.search=this.stringifyQuery(n)),i.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const n=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(e,{url:n,options:r}){}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(o=>Object.assign({method:e,path:n},o)))}request(e,n=null){return new Zu(this,this.makeRequest(e,n,void 0))}async makeRequest(e,n,r){var o,i,s;const a=await e,c=(o=a.maxRetries)!==null&&o!==void 0?o:this.maxRetries;n==null&&(n=c),await this.prepareOptions(a);const{req:d,url:h,timeout:m}=await this.buildRequest(a,{retryCount:c-n});await this.prepareRequest(d,{url:h,options:a});const p="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),g=r===void 0?"":`, retryOf: ${r}`,E=Date.now();if(Ot(this).debug(`[${p}] sending request`,mr({retryOfRequestLogID:r,method:a.method,url:h,options:a,headers:d.headers})),!((i=a.signal)===null||i===void 0)&&i.aborted)throw new Vl;const x=new AbortController,w=await this.fetchWithTimeout(h,d,m,x).catch(jl),y=Date.now();if(w instanceof globalThis.Error){const T=`retrying, ${n} attempts remaining`;if(!((s=a.signal)===null||s===void 0)&&s.aborted)throw new Vl;const I=Bl(w)||/timed? ?out/i.test(String(w)+("cause"in w?String(w.cause):""));if(n)return Ot(this).info(`[${p}] connection ${I?"timed out":"failed"} - ${T}`),Ot(this).debug(`[${p}] connection ${I?"timed out":"failed"} (${T})`,mr({retryOfRequestLogID:r,url:h,durationMs:y-E,message:w.message})),this.retryRequest(a,n,r??p);throw Ot(this).info(`[${p}] connection ${I?"timed out":"failed"} - error; no more retries left`),Ot(this).debug(`[${p}] connection ${I?"timed out":"failed"} (error; no more retries left)`,mr({retryOfRequestLogID:r,url:h,durationMs:y-E,message:w.message})),I?new Fm:new sa({cause:w})}const v=`[${p}${g}] ${d.method} ${h} ${w.ok?"succeeded":"failed"} with status ${w.status} in ${y-E}ms`;if(!w.ok){const T=await this.shouldRetry(w);if(n&&T){const D=`retrying, ${n} attempts remaining`;return await dN(w.body),Ot(this).info(`${v} - ${D}`),Ot(this).debug(`[${p}] response error (${D})`,mr({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:y-E})),this.retryRequest(a,n,r??p,w.headers)}const I=T?"error; no more retries left":"error; not retryable";Ot(this).info(`${v} - ${I}`);const A=await w.text().catch(D=>jl(D).message),O=rN(A),k=O?void 0:A;throw Ot(this).debug(`[${p}] response error (${I})`,mr({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,message:k,durationMs:Date.now()-E})),this.makeStatusError(w.status,O,k,w.headers)}return Ot(this).info(v),Ot(this).debug(`[${p}] response start`,mr({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:y-E})),{response:w,options:a,controller:x,requestLogID:p,retryOfRequestLogID:r,startTime:E}}async fetchWithTimeout(e,n,r,o){const i=n||{},{signal:s,method:a}=i,c=Ds(i,["signal","method"]);s&&s.addEventListener("abort",()=>o.abort());const d=setTimeout(()=>o.abort(),r),h=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,m=Object.assign(Object.assign(Object.assign({signal:o.signal},h?{duplex:"half"}:{}),{method:"GET"}),c);a&&(m.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,m)}finally{clearTimeout(d)}}async shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r,o){var i;let s;const a=o==null?void 0:o.get("retry-after-ms");if(a){const d=parseFloat(a);Number.isNaN(d)||(s=d)}const c=o==null?void 0:o.get("retry-after");if(c&&!s){const d=parseFloat(c);Number.isNaN(d)?s=Date.parse(c)-Date.now():s=d*1e3}if(!(s&&0<=s&&s<60*1e3)){const d=(i=e.maxRetries)!==null&&i!==void 0?i:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,d)}return await oN(s),this.makeRequest(e,n-1,r)}calculateDefaultRetryTimeoutMillis(e,n){const i=n-e,s=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return s*a*1e3}async buildRequest(e,{retryCount:n=0}={}){var r,o,i;const s=Object.assign({},e),{method:a,path:c,query:d,defaultBaseURL:h}=s,m=this.buildURL(c,d,h);"timeout"in s&&nN("timeout",s.timeout),s.timeout=(r=s.timeout)!==null&&r!==void 0?r:this.timeout;const{bodyHeaders:p,body:g}=this.buildBody({options:s}),E=await this.buildHeaders({options:e,method:a,bodyHeaders:p,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:E},s.signal&&{signal:s.signal}),globalThis.ReadableStream&&g instanceof globalThis.ReadableStream&&{duplex:"half"}),g&&{body:g}),(o=this.fetchOptions)!==null&&o!==void 0?o:{}),(i=s.fetchOptions)!==null&&i!==void 0?i:{}),url:m,timeout:s.timeout}}async buildHeaders({options:e,method:n,bodyHeaders:r,retryCount:o}){let i={};this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const s=await this.authHeaders(e);let a=Oo([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(o)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),lN()),this._options.defaultHeaders,r,e.headers,s]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:n}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=Oo([n]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:cN(e)}:this.encoder({body:e,headers:r})}}la.DEFAULT_TIMEOUT=6e4;class St extends la{constructor(){super(...arguments),this.interactions=new eg(this)}}ng=St;St.GeminiNextGenAPIClient=ng;St.GeminiNextGenAPIClientError=sn;St.APIError=Dt;St.APIConnectionError=sa;St.APIConnectionTimeoutError=Fm;St.APIUserAbortError=Vl;St.NotFoundError=jm;St.ConflictError=Vm;St.RateLimitError=zm;St.BadRequestError=Gm;St.AuthenticationError=Hm;St.InternalServerError=Wm;St.PermissionDeniedError=Bm;St.UnprocessableEntityError=$m;St.toFile=yN;St.Interactions=eg;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function RN(t,e){const n={},r=l(t,["name"]);return r!=null&&f(n,["_url","name"],r),n}function kN(t,e){const n={},r=l(t,["name"]);return r!=null&&f(n,["_url","name"],r),n}function PN(t,e){const n={},r=l(t,["sdkHttpResponse"]);return r!=null&&f(n,["sdkHttpResponse"],r),n}function ON(t,e){const n={},r=l(t,["sdkHttpResponse"]);return r!=null&&f(n,["sdkHttpResponse"],r),n}function MN(t,e,n){const r={};if(l(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const o=l(t,["tunedModelDisplayName"]);if(e!==void 0&&o!=null&&f(e,["displayName"],o),l(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=l(t,["epochCount"]);e!==void 0&&i!=null&&f(e,["tuningTask","hyperparameters","epochCount"],i);const s=l(t,["learningRateMultiplier"]);if(s!=null&&f(r,["tuningTask","hyperparameters","learningRateMultiplier"],s),l(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(l(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(l(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const a=l(t,["batchSize"]);e!==void 0&&a!=null&&f(e,["tuningTask","hyperparameters","batchSize"],a);const c=l(t,["learningRate"]);if(e!==void 0&&c!=null&&f(e,["tuningTask","hyperparameters","learningRate"],c),l(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(l(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function LN(t,e,n){const r={};let o=l(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const g=l(t,["validationDataset"]);e!==void 0&&g!=null&&f(e,["supervisedTuningSpec"],qf(g))}else if(o==="PREFERENCE_TUNING"){const g=l(t,["validationDataset"]);e!==void 0&&g!=null&&f(e,["preferenceOptimizationSpec"],qf(g))}const i=l(t,["tunedModelDisplayName"]);e!==void 0&&i!=null&&f(e,["tunedModelDisplayName"],i);const s=l(t,["description"]);e!==void 0&&s!=null&&f(e,["description"],s);let a=l(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const g=l(t,["epochCount"]);e!==void 0&&g!=null&&f(e,["supervisedTuningSpec","hyperParameters","epochCount"],g)}else if(a==="PREFERENCE_TUNING"){const g=l(t,["epochCount"]);e!==void 0&&g!=null&&f(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],g)}let c=l(n,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const g=l(t,["learningRateMultiplier"]);e!==void 0&&g!=null&&f(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],g)}else if(c==="PREFERENCE_TUNING"){const g=l(t,["learningRateMultiplier"]);e!==void 0&&g!=null&&f(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],g)}let d=l(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const g=l(t,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&f(e,["supervisedTuningSpec","exportLastCheckpointOnly"],g)}else if(d==="PREFERENCE_TUNING"){const g=l(t,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&f(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],g)}let h=l(n,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const g=l(t,["adapterSize"]);e!==void 0&&g!=null&&f(e,["supervisedTuningSpec","hyperParameters","adapterSize"],g)}else if(h==="PREFERENCE_TUNING"){const g=l(t,["adapterSize"]);e!==void 0&&g!=null&&f(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],g)}if(l(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(l(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const m=l(t,["labels"]);e!==void 0&&m!=null&&f(e,["labels"],m);const p=l(t,["beta"]);return e!==void 0&&p!=null&&f(e,["preferenceOptimizationSpec","hyperParameters","beta"],p),r}function DN(t,e){const n={},r=l(t,["baseModel"]);r!=null&&f(n,["baseModel"],r);const o=l(t,["preTunedModel"]);o!=null&&f(n,["preTunedModel"],o);const i=l(t,["trainingDataset"]);i!=null&&YN(i);const s=l(t,["config"]);return s!=null&&MN(s,n),n}function UN(t,e){const n={},r=l(t,["baseModel"]);r!=null&&f(n,["baseModel"],r);const o=l(t,["preTunedModel"]);o!=null&&f(n,["preTunedModel"],o);const i=l(t,["trainingDataset"]);i!=null&&qN(i,n,e);const s=l(t,["config"]);return s!=null&&LN(s,n,e),n}function FN(t,e){const n={},r=l(t,["name"]);return r!=null&&f(n,["_url","name"],r),n}function GN(t,e){const n={},r=l(t,["name"]);return r!=null&&f(n,["_url","name"],r),n}function HN(t,e,n){const r={},o=l(t,["pageSize"]);e!==void 0&&o!=null&&f(e,["_query","pageSize"],o);const i=l(t,["pageToken"]);e!==void 0&&i!=null&&f(e,["_query","pageToken"],i);const s=l(t,["filter"]);return e!==void 0&&s!=null&&f(e,["_query","filter"],s),r}function BN(t,e,n){const r={},o=l(t,["pageSize"]);e!==void 0&&o!=null&&f(e,["_query","pageSize"],o);const i=l(t,["pageToken"]);e!==void 0&&i!=null&&f(e,["_query","pageToken"],i);const s=l(t,["filter"]);return e!==void 0&&s!=null&&f(e,["_query","filter"],s),r}function jN(t,e){const n={},r=l(t,["config"]);return r!=null&&HN(r,n),n}function VN(t,e){const n={},r=l(t,["config"]);return r!=null&&BN(r,n),n}function $N(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&f(n,["sdkHttpResponse"],r);const o=l(t,["nextPageToken"]);o!=null&&f(n,["nextPageToken"],o);const i=l(t,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>rg(a))),f(n,["tuningJobs"],s)}return n}function zN(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&f(n,["sdkHttpResponse"],r);const o=l(t,["nextPageToken"]);o!=null&&f(n,["nextPageToken"],o);const i=l(t,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>Wl(a))),f(n,["tuningJobs"],s)}return n}function WN(t,e){const n={},r=l(t,["name"]);r!=null&&f(n,["model"],r);const o=l(t,["name"]);return o!=null&&f(n,["endpoint"],o),n}function YN(t,e){const n={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=l(t,["examples"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),f(n,["examples","examples"],o)}return n}function qN(t,e,n){const r={};let o=l(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const s=l(t,["gcsUri"]);e!==void 0&&s!=null&&f(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(o==="PREFERENCE_TUNING"){const s=l(t,["gcsUri"]);e!==void 0&&s!=null&&f(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}let i=l(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const s=l(t,["vertexDatasetResource"]);e!==void 0&&s!=null&&f(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(i==="PREFERENCE_TUNING"){const s=l(t,["vertexDatasetResource"]);e!==void 0&&s!=null&&f(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}if(l(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function rg(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&f(n,["sdkHttpResponse"],r);const o=l(t,["name"]);o!=null&&f(n,["name"],o);const i=l(t,["state"]);i!=null&&f(n,["state"],xm(i));const s=l(t,["createTime"]);s!=null&&f(n,["createTime"],s);const a=l(t,["tuningTask","startTime"]);a!=null&&f(n,["startTime"],a);const c=l(t,["tuningTask","completeTime"]);c!=null&&f(n,["endTime"],c);const d=l(t,["updateTime"]);d!=null&&f(n,["updateTime"],d);const h=l(t,["description"]);h!=null&&f(n,["description"],h);const m=l(t,["baseModel"]);m!=null&&f(n,["baseModel"],m);const p=l(t,["_self"]);return p!=null&&f(n,["tunedModel"],WN(p)),n}function Wl(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&f(n,["sdkHttpResponse"],r);const o=l(t,["name"]);o!=null&&f(n,["name"],o);const i=l(t,["state"]);i!=null&&f(n,["state"],xm(i));const s=l(t,["createTime"]);s!=null&&f(n,["createTime"],s);const a=l(t,["startTime"]);a!=null&&f(n,["startTime"],a);const c=l(t,["endTime"]);c!=null&&f(n,["endTime"],c);const d=l(t,["updateTime"]);d!=null&&f(n,["updateTime"],d);const h=l(t,["error"]);h!=null&&f(n,["error"],h);const m=l(t,["description"]);m!=null&&f(n,["description"],m);const p=l(t,["baseModel"]);p!=null&&f(n,["baseModel"],p);const g=l(t,["tunedModel"]);g!=null&&f(n,["tunedModel"],g);const E=l(t,["preTunedModel"]);E!=null&&f(n,["preTunedModel"],E);const x=l(t,["supervisedTuningSpec"]);x!=null&&f(n,["supervisedTuningSpec"],x);const w=l(t,["preferenceOptimizationSpec"]);w!=null&&f(n,["preferenceOptimizationSpec"],w);const y=l(t,["tuningDataStats"]);y!=null&&f(n,["tuningDataStats"],y);const v=l(t,["encryptionSpec"]);v!=null&&f(n,["encryptionSpec"],v);const T=l(t,["partnerModelTuningSpec"]);T!=null&&f(n,["partnerModelTuningSpec"],T);const I=l(t,["customBaseModel"]);I!=null&&f(n,["customBaseModel"],I);const A=l(t,["experiment"]);A!=null&&f(n,["experiment"],A);const O=l(t,["labels"]);O!=null&&f(n,["labels"],O);const k=l(t,["outputUri"]);k!=null&&f(n,["outputUri"],k);const j=l(t,["pipelineJob"]);j!=null&&f(n,["pipelineJob"],j);const D=l(t,["serviceAccount"]);D!=null&&f(n,["serviceAccount"],D);const V=l(t,["tunedModelDisplayName"]);V!=null&&f(n,["tunedModelDisplayName"],V);const X=l(t,["veoTuningSpec"]);return X!=null&&f(n,["veoTuningSpec"],X),n}function KN(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&f(n,["sdkHttpResponse"],r);const o=l(t,["name"]);o!=null&&f(n,["name"],o);const i=l(t,["metadata"]);i!=null&&f(n,["metadata"],i);const s=l(t,["done"]);s!=null&&f(n,["done"],s);const a=l(t,["error"]);return a!=null&&f(n,["error"],a),n}function qf(t,e){const n={},r=l(t,["gcsUri"]);r!=null&&f(n,["validationDatasetUri"],r);const o=l(t,["vertexDatasetResource"]);return o!=null&&f(n,["validationDatasetUri"],o),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class JN extends Un{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Rr(Ln.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.get=async n=>await this.getInternal(n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const o={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(o.checkpointId=n.config.preTunedModelCheckpointId);const i=Object.assign(Object.assign({},n),{preTunedModel:o});return i.baseModel=void 0,await this.tuneInternal(i)}else{const o=Object.assign({},n);return await this.tuneInternal(o)}else{const o=Object.assign({},n),i=await this.tuneMldevInternal(o);let s="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?s=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(s=i.name.split("/operations/")[0]),{name:s,state:Ml.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=GN(e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>Wl(h))}else{const d=FN(e);return a=Ne("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>rg(h))}}async listInternal(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=VN(e);return a=Ne("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=zN(h),p=new Ef;return Object.assign(p,m),p})}else{const d=jN(e);return a=Ne("tunedModels",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=$N(h),p=new Ef;return Object.assign(p,m),p})}}async cancel(e){var n,r,o,i;let s,a="",c={};if(this.apiClient.isVertexAI()){const d=kN(e);return a=Ne("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=ON(h),p=new Tf;return Object.assign(p,m),p})}else{const d=RN(e);return a=Ne("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=PN(h),p=new Tf;return Object.assign(p,m),p})}}async tuneInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=UN(e,e);return i=Ne("tuningJobs",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),o.then(c=>Wl(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=DN(e);return i=Ne("tunedModels",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),o.then(c=>KN(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class XN{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const ZN=1024*1024*8,QN=3,eC=1e3,tC=2,Fs="x-goog-upload-status";async function nC(t,e,n){var r;const o=await og(t,e,n),i=await(o==null?void 0:o.json());if(((r=o==null?void 0:o.headers)===null||r===void 0?void 0:r[Fs])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return i.file}async function rC(t,e,n){var r;const o=await og(t,e,n),i=await(o==null?void 0:o.json());if(((r=o==null?void 0:o.headers)===null||r===void 0?void 0:r[Fs])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const s=hm(i),a=new zu;return Object.assign(a,s),a}async function og(t,e,n){var r,o;let i=0,s=0,a=new Ll(new Response),c="upload";for(i=t.size;s<i;){const d=Math.min(ZN,i-s),h=t.slice(s,s+d);s+d>=i&&(c+=", finalize");let m=0,p=eC;for(;m<QN&&(a=await n.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(s),"Content-Length":String(d)}}}),!(!((r=a==null?void 0:a.headers)===null||r===void 0)&&r[Fs]));)m++,await iC(p),p=p*tC;if(s+=d,((o=a==null?void 0:a.headers)===null||o===void 0?void 0:o[Fs])!=="active")break;if(i<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function oC(t){return{size:t.size,type:t.type}}function iC(t){return new Promise(e=>setTimeout(e,t))}class sC{async upload(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await nC(e,n,r)}async uploadToFileSearchStore(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await rC(e,n,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await oC(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class aC{create(e,n,r){return new lC(e,n,r)}}class lC{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Kf="x-goog-api-key";class uC{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(Kf)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Kf,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const cC="gl-node/";class dC{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const n=new St({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=n.interactions,this._interactions}constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const r=iv(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const o=new uC(this.apiKey);this.apiClient=new ow({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:cC+"web",uploader:new sC,downloader:new XN}),this.models=new ww(this.apiClient),this.live=new yw(this.apiClient,o,new aC),this.batches=new Mx(this.apiClient),this.chats=new mE(this.models,this.apiClient),this.caches=new fE(this.apiClient),this.files=new CE(this.apiClient),this.operations=new Nw(this.apiClient),this.authTokens=new Hw(this.apiClient),this.tunings=new JN(this.apiClient),this.fileSearchStores=new qw(this.apiClient)}}const Tr={webtoon:{name:"  ",desc:"   +    ( )",prompt:"Premium Korean Historical Webtoon Style, High Quality 2D Digital Art, Crisp Line Art (Outlines), Cel Shading, Smooth Coloring, Beautiful Characters (Sparkling eyes, delicate features, pale skin, soft blush), Fusion Hanbok, Vibrant and Pastel tones, Webtoon Cover Art aesthetic, Sharp focus. [NEGATIVE PROMPT]: Photorealistic, Real Photo, Live Action, 3D Render, Hyper-realism, Skin Pores, Camera Noise, Movie Screenshot, Realistic Hair Strands."},animation:{name:"  ",desc:" ,  ",prompt:"2D Cell Animation Style, Korean Folklore Atmosphere, Flat Shading, Clean Lines, Studio Ghibli inspired but Korean Joseon Aesthetics, Hand-drawn animation frame. [NEGATIVE PROMPT]: Photorealistic, Real Photo, Live Action, 3D Render, Unreal Engine, Hyper-realism, Detailed Texture, Skin Pores."},inkwash:{name:"  (Modern)",desc:"   +   ",prompt:"Modern Korean emotional watercolor illustration, beautiful and handsome characters with modern aesthetic faces (sharp jawline, large expressive eyes, delicate features), soft transparent watercolor texture, ink spreading effect, dreamy and romantic atmosphere, detailed character design, pastel tones, artistic masterpiece. [NEGATIVE PROMPT]: Old traditional folk art style, round ugly faces, Photorealistic, Real Photo, Live Action, 3D Render."},fantasy:{name:"  ()",desc:"    ",prompt:"Korean web novel illustration style (Semi-Realistic). clean black outline clearly separating character from background, controlled and consistent lineart, outline-focused linework with minimal interior lines, soft painterly coloring inside the lines, smooth brush blending, no rough strokes, semi-realistic character illustration, facial volume defined by soft shading, not heavy lines, gentle facial expression with restrained emotion, slightly idealized proportions, natural anatomy, smooth skin rendering with subtle blush, balanced warm lighting, high quality character-focused artwork. [NEGATIVE PROMPT]: anime exaggerated eyes, thick manga lineart, sketchy or rough lines, cell shading, hyper realistic texture, photorealistic face, oil painting style, western comic style, text, watermark, signature, speech bubble, dialogue, sound effect, onomatopoeia, alphabet, korean text, words, logo"}},gi=[{category:qr.HARM_CATEGORY_HARASSMENT,threshold:Kr.BLOCK_NONE},{category:qr.HARM_CATEGORY_HATE_SPEECH,threshold:Kr.BLOCK_NONE},{category:qr.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:Kr.BLOCK_NONE},{category:qr.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:Kr.BLOCK_NONE}],ht=t=>{if(!t)throw new Error("API   .   'API  '    .");return new dC({apiKey:t})},Gn=t=>{try{let e=t.replace(/```json\s*/g,"").replace(/```\s*/g,"");return e=e.trim(),JSON.parse(e)}catch(e){console.warn("Standard JSON Parse Failed. Attempting Partial Recovery...",e);try{let n=t.replace(/```json\s*/g,"").replace(/```\s*/g,"").trim();const r=n.lastIndexOf("}");if(r>0){let o=n.substring(0,r+1);return o.startsWith("[")&&!o.endsWith("]")&&(o+="]"),console.log("Attempting to parse recovered JSON:",o),JSON.parse(o)}}catch(n){console.error("JSON Recovery Failed:",n)}throw console.error("JSON Parse Error:",e,"Raw Text:",t),new Error("AI    . (JSON  )")}},fC=`
  [HISTORICAL VERIFICATION STANDARDS - PASSIVE CONSTRAINTS]
  * USE THIS ONLY TO VALIDATE EXISTING ELEMENTS.
  * DO NOT GENERATE THESE ITEMS UNLESS EXPLICITLY REQUESTED IN THE SCRIPT.

  1. ONDOL STRUCTURE (CRITICAL): 
     - Kitchen (Bu-eok) MUST be attached to the Main Room (An-bang). NO OUTDOOR ISLAND KITCHENS.
     - Kitchen floor is LOWER (dirt). Room floor is RAISED (wood/stone).
  2. DOORS & WINDOWS:
     - ROOM DOORS: White rice paper (Changhoji) on wooden lattice.
     - KITCHEN DOORS: Rough solid wood planks. NO PAPER.
  3. ROOF & WALLS:
     - Commoner: Mud walls + Rounded Straw Roof (Choga).
     - Noble: Plaster walls + Black Tile Roof (Giwa).
`,ig=`
  [HISTORICAL COSTUME VERIFICATION - DEFAULT STANDARDS]
  * These are general Joseon Dynasty standards. 
  * Use them to VALIDATE logic, but DO NOT OVERRIDE specific character designs in the script.
  * IF THE SCRIPT IS SILENT, assume these defaults.
  * IF THE SCRIPT SPECIFIES OTHERWISE (e.g. "Short hair"), FOLLOW THE SCRIPT.

  1. SHOES:
     - Jipsin (Straw shoes): COVERS TOES. No flip-flops.
     - Indoors: NO SHOES. White socks (Beoseon) only.
  2. CLOTHING:
     - Hanbok Skirt (Chima): **MUST BE FLOOR LENGTH (DRAGGING ON FLOOR)**. 
     - **[CRITICAL] SKIRT LENGTH**: The skirt MUST be long enough to **COVER THE FEET COMPLETELY**. It should drag on the floor.
     - **STRICT PROHIBITION**: ABSOLUTELY NO ANKLES VISIBLE. NO CALVES VISIBLE. NO SKIN VISIBLE BELOW WAIST.
     - **NEGATIVE PROMPT**: Short skirt, ankle length, exposed legs, calves visible, shin visible, mini skirt, western dress length, feet visible (unless walking).
     - Sleeves: Curved (Baerae).
  3. HAIR (DEFAULT STYLES):
     - Men (Married): Sangtu (Topknot) + Headband (Manggeon).
     - Men (Unmarried): Long braided hair (Daenggi).
     - Women (Married): Low Bun (Jjok-jin) with Binyeo (Hairpin).
     - Women (Unmarried): Long braided hair.
     - **NOTE**: Modern hairstyles (Bob, Perm) are RARE but allowed if script demands.
  
  4. **[CRITICAL] UNDRESSED STATE (SEE-THROUGH RAMIE)**:
     - When prompt says "Remove Jeogori", "Undressed", "Sleeping", "Transparent":
       - **ITEM**: **"Moshi-Jeoksam" (White Ramie Summer Shirt)**.
       - **TRANSPARENCY**: The fabric is **EXTREMELY SHEER / SEE-THROUGH**.
       - **VISUAL EFFECT**:
         1. **SKIN TONE**: The **flesh tone** of Shoulders, Arms, and **Upper Chest (Cleavage)** MUST be clearly visible through the white fabric.
         2. **UNDER-LAYER**: The **White Chest Band (Mal-gi)** wrapping the breasts is visible **BENEATH** the sheer shirt.
         3. **RIBBON (Goreum)**: Even the chest ribbon is **TRANSPARENT WHITE RAMIE**.
       - **SILHOUETTE**: A white misty veil over the skin. Not opaque.
`,hC=`
  [HISTORICAL SITTING ETIQUETTE & POSTURE RULES]
  * STRICTLY FOLLOW Social Hierarchy and Situation.
  
  1. **DEFAULT POSTURE (FLOOR SITTING)**:
     - **Yangban (Nobles/Elders)**: Sit **CROSS-LEGGED** (Yangban-dari / Agura). 
       - NEVER kneel unless in front of the King or in deep apology.
     - **Commoners/Subordinates/Children**: 
       - If informal/relaxed: Cross-legged.
       - If formal/polite (e.g., in front of Father/Master): **KNEELING** (Mureup-kkul-gi).
  
  2. **HIERARCHICAL CONTEXT (CRITICAL)**:
     - **Father vs Son**: 
       - **FATHER**: Sits **CROSS-LEGGED** (Comfortable authority).
       - **SON**: Sits **KNEELING** (Respectful attention).
       - **NEVER**: Father kneeling before Son. (Unless Father is begging for forgiveness).
     - **Master vs Servant**:
       - Master: Cross-legged.
       - Servant: Standing (head bowed) OR Kneeling on floor.
  
  3. **GENDER SPECIFICS**:
     - **Women (Noble/Commoner)**: Generally sit with knees bent to side (comfortable) or Kneeling (formal). Avoid wide cross-legged spread (considered masculine/rude in formal settings, but okay for Grandma/Ajumma in market).
`,sg=`
  NEGATIVE PROMPT: **STANDING SIDE BY SIDE**, **LINEUP**, **GROUP PHOTO**, **FACING CAMERA**, **EYE CONTACT**, posing for photo, selfie, modern items, electricity, cars, concrete, western clothes, beds, chairs, glass windows, paved roads, Japanese style shoes (Geta/Zori), Chinese queues, text, watermark, speech bubble, dirty face (unless specified), messy hair (unless specified), short skirt, showing legs, modernized hanbok, 3d render, plastic skin, western lingerie, nipples, genitals, modern bra, thick clothes, winter clothes, **flat composition**, **symmetrical arrangement**.
`,Qu=`
  CONTEXT: Korea, Joseon Dynasty (19th Century).
  ${fC}
  ${ig}
  ${hC}
  ${sg}
`,ag=async(t,e)=>{const n=ht(t),r=e.match(/^data:(.+);base64,(.+)$/);if(!r)return"Imported image";const o=`
    Analyze this character image for a CONTINUITY SHEET.
    
    [CRITICAL INSTRUCTION: NO HELD ITEMS]
    Describe specific visual traits that MUST be preserved in future drawings.
    **DO NOT DESCRIBE PROPS or ITEMS IN HANDS.** (e.g., No sword, No book, No cup, No bag).
    Focus ONLY on the person's invariant appearance.

    1. **HEADWEAR**: Exact type (Gat, Nambawi, None) and color.
    2. **HAIR**: Exact style (Topknot, Braid, Bun) and hairline.
    3. **CLOTHING**: 
       - Top (Jeogori) Color & Pattern.
       - Bottom (Baji/Chima) Color.
       - Outer (Dopo/Jangot) Color.
    4. **FACE**: Eye shape, facial hair (beard/mustache), distinct features.
    5. **BODY**: Physique, height, build (e.g., muscular, slender, sturdy).
    
    Output a single paragraph. Be extremely precise about COLORS.
  `;try{return(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:r[1],data:r[2]}},{text:o}]}})).text||"Imported Character Reference"}catch(i){return console.error("Vision Analysis Failed",i),"Imported Character Reference (Analysis Failed)"}},pC=async(t,e,n)=>{var s;const r=ht(t),o=e.match(/^data:(.+);base64,(.+)$/);if(!o)return"";const i=`
    Analyze this image to create a Visual Description for a Character Design Option.
    
    [TARGET CATEGORY]: ${n}
    (e.g., if category is 'hair', focus ONLY on the hair. If 'headwear', focus on the hat.)
    
    [CONTEXT]
    The user wants to add this specific style to their character builder.
    The description will be used as a prompt for Image Generation AI (Stable Diffusion/Midjourney style).
    
    [INSTRUCTIONS]
    1. **FOCUS**: Ignore the background, ignore the face (unless category is 'face'). Look ONLY at the ${n}.
    2. **DETAIL**: Describe the shape, material, color, and texture.
    3. **TERMINOLOGY**: Use precise English terms. If it's a traditional Korean item (Joseon Dynasty), try to describe its look (e.g., "Black horsehair hat with wide brim" for Gat).
    4. **FORMAT**: Return a concise, comma-separated descriptive string.
    
    [EXAMPLE OUTPUTS]
    - (Category: Hair): "Traditional Korean Gache, large braided wig, ornate gold hairpins, heavy volume"
    - (Category: Clothing): "Red royal robe, gold dragon embroidery on chest and shoulders, wide sleeves"
  `;try{return((s=(await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:o[1],data:o[2]}},{text:i}]}})).text)==null?void 0:s.trim())||""}catch(a){throw console.error("Option Analysis Failed",a),new Error("  .")}},mC=async(t,e,n)=>{const r=ht(t),o=`
      You are a storyboard director. SPLIT this scene into ${n} sequential cuts.
      ORIGINAL: "${e.scriptSegment}" (${e.location})
      
      RULES:
      1. Break the action/dialogue logically.
      2. Keep the same Location/Time.
      3. Create specific visual descriptions for each cut.
      
      OUTPUT JSON:
      [ { "location": "Location (Keep Korean)", "timeOfDay": "Time (Keep Korean)", "scriptSegment": "Script Content (Keep Korean)", "description": "Visual Description (English)" }, ... ]

      [LANGUAGE RULES]
      1. **scriptSegment**: MUST BE KOREAN. Copy the exact lines from the original script. DO NOT TRANSLATE.
      2. **location** & **timeOfDay**: MUST BE KOREAN (e.g., "", "").
      3. **description**: MUST BE KOREAN (Detailed visual instructions for User Editing).
      
      [CRITICAL INSTRUCTION - NO CHARACTER APPEARANCE]
      - **ABSOLUTELY NO PHYSICAL DESCRIPTIONS**: Do NOT describe hair (style, color, length, accessories like Binyeo), clothes, or face.
      - **HISTORICAL RULE**: Do NOT apply \`JOSEON_COSTUME_RULES\` (like mandatory Binyeo) to this description. It creates conflicts with Character Reference Images.
      - **FILTERING RULE**: If the script describes appearance (e.g., "She fixed her binyeo"), IGNORE the object details. Just describe the action ("She touches her head").
      - **REASON**: Describing appearance here causes CONFLICTS with the Reference Image (e.g., generating "Short hair with Binyeo" which is impossible).
      - **BAD**: "     ."
      - **GOOD**: "  ."
    `;try{const i=await r.models.generateContent({model:"gemini-2.5-flash",contents:o,config:{responseMimeType:"application/json"}});if(i.text){const s=Gn(i.text);if(Array.isArray(s))return s.map((a,c)=>({id:`${e.id}-split-${Date.now()}-${c}`,sceneNumber:0,location:a.location||e.location,timeOfDay:a.timeOfDay||e.timeOfDay,scriptSegment:a.scriptSegment,description:a.description,aspectRatio:e.aspectRatio,casting:e.casting}))}return[e]}catch(i){throw console.error(i),new Error("  ")}},gC=async(t,e,n,r,o,i,s,a,c,d,h)=>{const m=ht(t),p=s.length>0?`[KNOWN CHARACTERS (MANDATORY TO USE)]
${s.map(w=>`- ${w.name}: ${w.visualGuide||w.description}`).join(`
`)}

[CHARACTER MATCHING RULE]
- If any of these characters appear in the script, you MUST use their EXACT NAME in the 'characterNames' list.
- Even if they are minor/supporting roles (), do NOT ignore them.
- Do NOT rename them (e.g., don't call 'Village Head' just 'Old Man' if his name is 'Village Head').`:"",g=c?`4. **PRESERVE OPENING SCENERY (CRITICAL - DO NOT SKIP)**:
       - **ESTABLISHING SHOT**: The FIRST scene (#1) MUST be a wide "Establishing Shot" that clearly shows WHERE the story takes place.
       - **VISUAL CLARITY**: Even if the script starts with dialogue, SHOW the location first.
       - **ALIVE WORLD RULE**: If the opening is a "Market", "Tavern", or "Village", **DO NOT DRAW AN EMPTY STREET**.
         - **MUST DESCRIBE A CROWD**: "Busy market with peddlers and shoppers", "Villagers walking by".
         - **BAD**: "An empty market street."
         - **GOOD**: "A bustling market filled with merchants, customers, and steam rising from food stalls."`:"",E=d?`- **ENDING SHOT (CRITICAL - CLEAR CONCLUSION)**: 
       - The LAST scene MUST visually conclude the current segment.
       - If the script ends with a specific action or look, CAPTURE IT EXACTLY.
       - **NO ABRUPT CUTS**: Ensure the final image feels like a proper ending (or cliffhanger if intended).
       - **VISUAL CONSISTENCY CHECK**: Ensure ALL characters in the final scene maintain their specific visual traits. Do not degrade quality.`:"",x=`
    Act as a **MASTER CINEMATIC DIRECTOR** for a high-budget Movie/Webtoon.
    Analyze the script and create a detailed **STORYBOARD** for a specific part of the story.
    
    ${Qu}
    ${a}
    ${p}
    
    [BATCH GENERATION MODE]
    ${o}
    ${i}

    [CRITICAL RULE: NO SUMMARIZATION - RAW TEXT SLICING]
    - You are a **TEXT SLICER**, not a summarizer.
    - **INPUT**: The full script text.
    - **OUTPUT**: You must slice the script into ${n} contiguous segments.
    - **CONSTRAINT**: The 'scriptSegment' field MUST be an **EXACT SUBSTRING** of the original script.
    - **PROHIBITED**: Do NOT summarize, paraphrase, or rewrite the script text.
    - **PROHIBITED**: Do NOT skip any sentences between scenes. The end of Scene N must match the start of Scene N+1.
    - **VERIFICATION**: If I concatenate all 'scriptSegment' values, I must get the EXACT original script part.

    [PACING GUIDE: MATHEMATICAL BREAKDOWN]
    - Total Script Length: ${e.length} chars.
    - **TARGET LENGTH PER SCENE**: Approx **${h} characters**.
    
    [BATCH GOAL]
    - You are generating **${n} scenes**.
    - **METHOD**:
      1. Look at the next ~${h} characters of the script.
      2. Find the nearest logical break point (Period, Newline, Dialogue end).
      3. CUT exactly there. That is Scene X.
      4. Repeat for the next chunk.
    - **ADJUSTMENT**: 
      - Adhere strictly to the ~${h} character count.
      - Only deviate slightly (10%) to avoid cutting in the middle of a word or sentence.
      - Do NOT merge scenes just because they seem short.
    
    [CRITICAL MISSION: DYNAMIC STORYTELLING (BANGTONG STYLE)]
    - **GOAL**: Transform text into a **VISUAL EXPERIENCE**. 
    - **STYLE**: Dynamic, Action-Oriented, Cinematic.
    - **TARGET**: Generate EXACTLY ${n} scenes starting from Scene #${r}.
    - **QUALITY ASSURANCE**: Maintain HIGH FIDELITY character details until the very last scene.

    [VISUAL RULES - THE "BANGTONG" STANDARD]
    
    1. **DYNAMIC CAMERA MOVEMENT (MANDATORY)**:
       - **GOLDEN RULE: WAIST SHOT IS KING (ABSOLUTE LAW)**:
         - **MANDATORY ANGLE**: Use **Waist Shot (Upper Body)** for 90% of scenes.
         - **PROHIBITED**: **Close-up (Face Only)** is FORBIDDEN.
           - *Reason*: We will zoom/crop in video editing later. Source image MUST contain body movement.
         - **PROHIBITED**: **Full Shot (Whole Body)** is FORBIDDEN unless absolutely necessary for location establishing.
           - *Reason*: Characters become too small.
         - **CROWD RULE**: Even if 5 people are present, **IGNORE** the ones on the edge. **CROP** the frame to show the main 1-2 characters from the **WAIST UP**.
         - **FRAME**: Top of head to Belt line. HANDS MUST BE VISIBLE if they are acting.
       - **CAMERA MOVES**:
         - **Waist Shot**: THE DEFAULT.
         - **Knee Shot**: Allowed for walking/fighting.
         - **Low/High Angle**: Use freely for dramatic effect.
       - **Instructions**: Start every description with the camera angle.
    
    2. **METHOD ACTING (INTENSE EMOTION & ACTION)**:
       - **NO "PASSPORT PHOTO" (ABSOLUTELY PROHIBITED)**:
         - **NEVER** generate an image of a character just standing/sitting in front of a blank/blurred background staring at the camera.
         - **NEVER** make the character look directly at the camera lens (No breaking the 4th wall).
         - **NEVER** omit the background. "Background" is NOT "Empty Space" -> It is "Story Space".
       - **ACTING INSTRUCTION**: The character must be **DOING** something or showing **INTENSE** emotion.
         - **BAD**: "He stands there." / "He looks sad." / "Character facing front."
         - **GOOD**: "He collapses on the ground, gripping the dirt in frustration, screaming at the sky."
         - **GOOD**: "She bites her lip until it bleeds, holding back tears, glaring at the traitor."
         - **GOOD (BOREDOM KILLER)**: Even if they are just listening, show them "nervously tapping their finger" or "pouring tea with a trembling hand".
       - **INVISIBLE CAMERA**: Characters must NEVER look at the camera. Eyes fixed on the object of their emotion.

    3. **AUTO-POPULATE EXTRAS (WORLD BUILDING)**:
       - If Location is "Market" -> AUTOMATICALLY ADD "Peddlers, Shoppers, Children running".
       - If Location is "Palace" -> AUTOMATICALLY ADD "Eunuchs, Court Ladies walking in line".
       - The world must feel ALIVE.

    4. **NO TEXT / SPEECH BUBBLES (CLEAN IMAGE POLICY)**:
       - **ABSOLUTELY FORBIDDEN**: Do NOT describe any sound effects (e.g., "Kung!", "Crash!", "Swish!").
       - **ABSOLUTELY FORBIDDEN**: Do NOT describe speech bubbles or dialogue text in the visual description.
       - **REASON**: We are making a MOVIE, not a comic book. Text should NEVER appear on the screen.
       - **BAD**: "A speech bubble saying 'Hello'." / "Sound effect: BAM!"
       - **GOOD**: "He shouts with his mouth wide open." (Show the ACTION, not the text).

    5. **NO CROWDED GROUP SHOTS (FOCUS IS KING)**:
       - **PROBLEM**: When a script segment is long, do NOT try to squeeze everyone into one Full Shot.
       - **SOLUTION**: Pick the **KEY CHARACTER** or the **KEY ACTION** and focus on them.
       - **ABSOLUTELY FORBIDDEN**: "Full shot of 5 people standing in a line" (Characters become too small -> Ugly faces).
       - **RULE**: If multiple characters are present, **CROP** to the main speaker or the main reactor.
       - **COMPOSITION**: Use "Over-the-Shoulder" or "Two-Shot" instead of "Wide Group Shot".
       - **REASON**: We need high-quality facial expressions for video. Small faces = Bad Video.

    ${g}
    ${E}

    6. **CONTINUITY & FLOW**:
       - Use transitions in descriptions: "Continuing from previous shot...", "Reaction to...", "The camera follows...".
       - Ensure logical flow of movement between cuts.

    [OUTPUT JSON STRUCTURE]
    Return an ARRAY of objects.
    [{ 
      "sceneNumber": ${r}, 
      "location": "Location (KOREAN)", 
      "timeOfDay": "Day/Night (KOREAN)", 
      "scriptSegment": "Original Script Text (KOREAN - DO NOT TRANSLATE)", 
      "description": "Visual Prompt (KOREAN)", 
      "characterNames": ["Name1", "Name2"] 
    }]

    [FIELD RULES]
    1. **scriptSegment**: COPY & PASTE EXACTLY from the source script. NO SUMMARIZATION.
       - **VERIFICATION**: I will check if this string exists in the original text. If you change even one word, you FAIL.
    2. **location/timeOfDay**: Keep in Korean.
    3. **characterNames**: List ONLY characters **VISUALLY VISIBLE** in the shot.
       - **CRITICAL EXCLUSION RULE**: NEVER include characters who are merely **mentioned** in dialogue but are not physically present.
       - **EXAMPLE**: 
         - Script: "Cheolsu: I hate Yeonghee." (Yeonghee is NOT in the room)
         - Output: ["Cheolsu"] (DO NOT include Yeonghee).
       - Include **EXTRAS** if you added them (e.g., ["Villagers", "Merchant"]).
    4. **description**: **THE MOST IMPORTANT FIELD**.
       - Format: "[: Angle] [: Names] [: detailed movement] [: Extras/Atmosphere] [: Mood]"
       - **THE "KICK" (HIGHLIGHT TECHNIQUE)**:
         - Since the script is sliced mechanically, some parts might seem boring (e.g., just walking or talking).
         - **YOUR JOB**: Find the "Visual Peak" even in boring segments.
         - **IF DIALOGUE**: Focus on the **REACTION** (facial muscle twitch, clenched fist) or **ATMOSPHERE** (candle flickering, shadow looming).
         - **IF TRANSITION**: Focus on the **ENVIRONMENT** (wind blowing dust, sun setting over the roof).
         - **NEVER** just say "They are talking." -> **ALWAYS** visualize the *emotion* behind the talk.
       - **Example**: "[:  ] [: ] [:     .   .] [:      ,  .] [:     ]"
       - **NO** physical descriptions of known characters (Hair/Clothes) -> Use their Names.
       - **NO** text, speech bubbles, sound effects, onomatopoeia, or dialogue inside the image.
       - **YES** physical descriptions of Extras.
       - **HISTORICAL RULE**: Apply Joseon Architecture/Sitting rules.

    SCRIPT:
    ${e.substring(0,5e4)}
  `;try{const w=await m.models.generateContent({model:"gemini-2.5-flash",contents:x,config:{responseMimeType:"application/json",maxOutputTokens:15e3}});if(w.text){const y=Gn(w.text);if(Array.isArray(y))return y.map((v,T)=>({id:`scene-${Date.now()}-${T}`,...v}))}return[]}catch(w){throw console.error(w),new Error("   (   ).")}},yC=async(t,e,n=[],r=25,o=[],i=!1)=>{let a=[],c=r,d=1;!i&&n.length>0&&(d=n[n.length-1].sceneNumber+1);const h=Math.ceil(r/5),m=e.length,p=Math.max(50,Math.round(m/r)),g=n.length>0?`EXISTING LOCATIONS: ${n.map(E=>`${E.location} (${E.description})`).join("; ")}`:"";for(let E=0;E<h;E++){const x=Math.min(5,c),w=E===0&&n.length===0,y=E===h-1,v=[...n,...a],T=v.length>0?v[v.length-1]:null,I=T?`[PREVIOUS SCENE CONTEXT]
- Last Scene #${T.sceneNumber}: ${T.scriptSegment}
- Location: ${T.location}
- Action: ${T.description}

[INSTRUCTION]
- CONTINUE directly from this point. Do NOT repeat the last scene.`:`[INSTRUCTION]
- Start from the VERY BEGINNING of the script.`,A=y?`[PACING: FINAL STRETCH - DO NOT RUSH]
- This is the LAST batch. Analyze the remaining script carefully.
- **SCENE COUNT**: Generate UP TO ${x} scenes, but if the story needs more or fewer to be properly told, prioritized STORYTELLING over exact count.
- **DO NOT COMPRESS**: Do NOT skip details just to finish.`:`[PACING: PART ${E+1} of ${h}]
- This is an intermediate batch. Do NOT finish the story yet. Just generate the NEXT ${x} scenes naturally.`;try{const O=await gC(t,e,x,d,I,A,o,g,w,y,p);if(O.length===0){console.warn("Batch generation returned empty. Stopping.");break}a=[...a,...O],c-=O.length,d+=O.length}catch(O){console.error("Batch failed",O);break}}return a},vC=async(t,e,n,r=[])=>{const o=ht(t),i=`
    You are a Casting Director. Extract characters from the script.
    OUTPUT JSON:
    [{ "name": "Name (KOREAN)", "visualGuide": "Korean Desc", "age": "20", "gender": "Male", "description": "English visual prompt", "isGroup": false }]

    [LANGUAGE RULES]
    1. **name**: Keep in KOREAN (e.g., "").
    2. **visualGuide**: Korean description for the user.
    3. **description**: English visual description for AI.
    4. **EXTRAS/GROUPS HANDLING**: 
       - **DO NOT EXTRACT** generic, nameless groups as Characters (e.g., "Villagers", "Passersby", "Audience", "Soldiers", "Maids").
       - **REASON**: These are BACKGROUND elements, not cast members. They should be in the Scene Description, not the Character Board.
       - **EXCEPTION**: Only extract a group if they have a **SPECIFIC** role crucial to the plot (e.g., "The 3 Assassins" who fight the hero).
       - **EXAMPLE**:
         - "Villagers are walking." -> DO NOT EXTRACT.
         - "The Royal Guards block the way." -> EXTRACT (if they interact significantly).
         - "Choi Gaekju's Henchmen surround him." -> EXTRACT "Henchmen" (as a group).

    5. **isGroup**: Set to true if the name implies multiple people.

    [CRITICAL EXCLUSION RULE - NO MENTIONED ABSENTEE]
    - **PHYSICALLY PRESENT ONLY**: Extract characters ONLY if they are physically present in the scene.
    - **IGNORE MENTIONS**: Do NOT extract names that appear only in dialogue or narration referring to someone else.
      - *Example*: "Choi Gaekju's henchmen" -> Extract "Henchmen". Do NOT extract "Choi Gaekju".
      - *Example*: "I hate Yeonghee!" (Yeonghee not there) -> Do NOT extract "Yeonghee".
    - **POSSESSIVE NOUNS RULE**: If a name is used only as a possessive modifier (e.g., "Choi Gaekju's house", "Choi Gaekju's servant"), DO NOT EXTRACT THE OWNER ("Choi Gaekju").
    - **ROLE vs NAME**: If the script says "Choi Gaekju's henchmen", "Henchmen" is the character. "Choi Gaekju" is just an adjective here.

    [CRITICAL EXCLUSION RULE - NO GENERIC BACKGROUND EXTRAS]
    - **STRICTLY EXCLUDE** purely background roles from the Character List.
    - **FORBIDDEN LIST**: "Villagers", "People", "Crowd", "Passersby", "Guests", "Customers", "Maids" (unless named), "Servants" (unless named).
    - **WHY**: We only want MAIN or SUPPORTING actors in the list. Background people will be generated by the scene prompt automatically.


    [CRITICAL RULE: NO PROPS/OBJECTS IN DESCRIPTION]
    - **ABSOLUTELY FORBIDDEN**: Do NOT include specific items held in hands (e.g., "holding a hammer", "carrying a radish", "holding a sword", "smoking a pipe").
    - **REASON**: If you write "holding a hammer", the character will hold a hammer in EVERY SINGLE SCENE (even when sleeping or eating).
    - **FOCUS ON PHYSIQUE**: Describe the **Physical Body** and **Face** instead.
      - BAD: "Blacksmith holding a heavy hammer."
      - GOOD: "Blacksmith with muscular arms, thick neck, sweaty skin, soot on face, wearing a leather apron."
      - BAD: "Market woman holding a basket of radishes."
      - GOOD: "Market woman with a sturdy build, sun-tanned skin, wearing a worn-out cotton hanbok, friendly round face."
    - **CLOTHING ONLY**: Describe the clothes, hair, and body type. NO HELD ITEMS.

    SCRIPT:
    ${e.substring(0,5e4)}
  `;try{const s=await o.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json",maxOutputTokens:15e3}});if(s.text){const a=Gn(s.text);if(Array.isArray(a))return a.map((c,d)=>{var g;let h=c.description;(/|||||||/.test(c.name)||/police|constable|soldier|guard|officer/.test(((g=c.visualGuide)==null?void 0:g.toLowerCase())||""))&&(h="This character wears a traditional black *gat* hat with a subtle sheen, featuring a black braided band, a thinner reddish-brown braided band, and a gold-colored finial on top. On the right side, vibrant multi-colored ribbons in dark blue, emerald green, bright yellow, rich red, and a lighter blue/purple, along with bright yellow tassels, are attached. His dark hair is neatly styled, likely in a topknot under the hat as traditional, with a clean hairline. The visible clothing includes a pure white *jeogori* (top), covered by a deep charcoal grey or black long outer robe and an inner vest-like garment of the same color, both featuring a very subtle, fine, dark grey patterned texture. A striking, vibrant red sash is tied at the waist with long ends hanging down. The bottom garment consists of pure white, loose-fitting *baji* (trousers)");const p=c.isGroup||/$|$|$|$||||||/.test(c.name);return{id:`char-${Date.now()}-${d}`,...c,description:h,isGroup:p,hasDialogue:!0,chromaKeyColor:"green",actions:[]}})}return[]}catch(s){return console.error(s),[]}},xC=async(t,e,n="auto")=>{const r=ht(t),o=`
    Act as a Viral Content Writer.
    Your task is to Analyze the full script and write a **"Short Hooking Narration Script"** (Text Only, approx 200 characters).
    
    [STRICT FORMATTING RULES]
    1. **Dialogue MUST be actual spoken lines** enclosed in double quotes (" ").
       - BAD: "     !"
       - GOOD: ", .     !"
    2. **Tone & Style**: Use polite/narrative Korean endings like "~", "~", "~".
    3. **Step 1 (Reaction Dialogue)**: MUST start with a strong spoken line from a character.

    [STRICT STRUCTURE - 4 STEPS]
    You must follow this narrative arc exactly.

    1. **Point Dialogue (10-30 chars)**: A shocking, cruel, or decisive line that drives the conflict.
       (e.g., ", .  !")
    2. **Despair & Misery (30-50 chars)**: Describe the tragic situation and the protagonist's emotion vividly. Use "~/".
       (e.g., "   .       .")
    3. **Glimmer of Hope / Twist (40-60 chars)**: A mysterious twist found at the rock bottom. Describe the unexpected comfort or strange atmosphere.
       (e.g., "    .   ,   .      .")
    4. **Core Mystery (30-40 chars)**: Emphasize "Shock" -> "Desperation". Start immediately with the object (e.g., "The letter on the table...").
       (e.g., "  ,     .           ?")

    [EXAMPLE OUTPUT]
    ", .     ."
    
       . 
             .
    
        . 
      ,   .      .
    
      ,     .
        ,      ?

    [CONSTRAINT]
    - LANGUAGE: KOREAN (Polite narrative style: ~, ~).
    - **Identify the CORE CONFLICT** of the source script.
    
    SOURCE SCRIPT:
    ${e.substring(0,3e4)}
  `;try{return(await r.models.generateContent({model:"gemini-2.5-flash",contents:o})).text||"  "}catch(i){throw console.error(i),new Error("   ")}},EC=async(t,e,n,r,o,i="auto",s)=>{const a=ht(t),c=n.map(g=>`[CHARACTER: ${g.name}] (ID: ${g.id}) Gender: ${g.gender}, Age: ${g.age}, Desc: ${g.description}`).join(`
`),d=r?r.map(g=>`[PROP: ${g.name}] (ID: ${g.id}) ${g.description}`).join(`
`):"",h=o?`[GLOBAL RULES] ${o}`:"",p=`
    Act as a **VISUAL STORYBOARD DIRECTOR** for a Viral Mystery YouTube Channel.
    Your task is to convert the provided **HOOKING SCRIPT** into a strictly structured **10-Shot Visual Storyboard**.

    [INPUT SCRIPT]
    (This is the SHORT HOOKING SCRIPT for the 10-shot sequence)
    ${e}

    [FULL SCRIPT CONTEXT - FOR BACKGROUND & CROWD LOGIC]
    (This is the FULL STORY. Use this to understand who else is in the room.)
    ${(s||e).substring(0,3e4)} 
    * INSTRUCTION: Even if the Hooking Script only mentions "Mother and Daughter-in-law", you MUST check the context.
    * If this is an "Expulsion Scene" in a Noble House, there must be **SERVANTS, MAIDS, and FAMILY MEMBERS** watching.
    * **CROWD RULE**: If the situation implies a public or family event, **INCLUDE BACKGROUND CHARACTERS** (Blurred) to show the social pressure.
    * **DO NOT** isolate the main characters in a void unless it's a dream.

    [CRITICAL MISSION: CAPTURE ALL EXILED CHARACTERS]
    - **CHECK WHO IS LEAVING**: If the script says "Yoon-ssi, her servant (Haengnang-eomeom), and the servant's husband (Haengnang-beom) were kicked out together", you MUST draw ALL OF THEM.
    - **DO NOT DRAW ONLY ONE PERSON**: Even if Yoon-ssi is the main character, the shot must show the **GROUP** being expelled if the script says so.
    - **GROUP SHOT RULE**: If multiple people are kicked out, use a **WIDE SHOT** or **FULL SHOT** to show the group walking away or standing outside the gate.
    - **BAD**: "Yoon-ssi walking alone in the snow." (When 3 people were kicked out).
    - **GOOD**: "Yoon-ssi walking in front, supported by Haengnang-eomeom, with Haengnang-beom carrying a bundle behind them."

    [VISUAL CONSISTENCY BIBLE]
    ${c}
    ${d}
    ${h}
    ${Qu}

    [CRITICAL MISSION: STRICT SCRIPT-TO-SHOT MAPPING]
    - **DO NOT INVENT PLOT**: You must visualize EXACTLY what is written in the script.
    - **1:1 VISUALIZATION**: 
      - If script says "Mother, get out!", Shot MUST show the confrontation.
      - If script says "Kicked out barefoot", Shot MUST show the bare feet or the gate slamming.
      - If script says "Found a letter", Shot MUST show the letter.
      - If script says "Sobbing", Shot MUST show the emotional reaction.
    - **NO RANDOM FILLERS**: Every shot must correspond to a specific line or action in the script.

    [VISUAL PROMPT GENERATION RULES - NO CLOTHING DESCRIPTIONS]
    - **ABSOLUTE PROHIBITION**: The 'visualPrompt' MUST NOT contain ANY description of clothing, hair, or physical appearance.
    - **FORBIDDEN WORDS**: Do not use words like "wearing", "dressed in", "hanbok", "clothes", "costume", "silk", "cotton", "ragged", "fancy", "blue", "red", "white", "attire", "garment".
    - **FOCUS ONLY ON**: Action, Emotion, Lighting, Camera Angle, Environment.
    - **REASON**: We inject exact character prompts (including clothes) automatically. If you describe clothes, it creates a "Double Description" error.
    - **EXAMPLE**:
      - WRONG: "A woman wearing a white hanbok is crying." (Contains 'wearing', 'white hanbok')
      - CORRECT: "The woman is crying." (Action only)
      - WRONG: "A fancy nobleman in blue silk robes enters."
      - CORRECT: "The nobleman enters with an arrogant stride."

    [RELATIONSHIP & CONTEXT ACCURACY]
    - **STRICTLY FOLLOW SCRIPT ROLES**:
      - **CRITICAL**: Do NOT change the characters' roles.
      - **Mother-in-law vs Daughter-in-law**: If the script is about a "Si-eomoni" and "Myeoneuri", they are FAMILY. Do NOT turn them into a "Concubine" (Cheop) or "Gisaeng".
      - **VERIFY**: Before generating, check if the script explicitly says "Concubine". If not, do NOT invent one.
      - **CONTEXT**: If the scene is a family dispute, depict it as a domestic family matter, not a brothel scene.
      - **NO SOAP OPERA CLICHES**: Do not assume every conflict involves a mistress. If the script is a family feud, draw family members.

    [STRICT 4-SHOT STRUCTURE - KEY FRAMES ONLY]
    You must generate EXACTLY 4 SHOTS. One for each step of the Hooking Script.
    - **Shot 1 (The Conflict)**: Visualize Step 1 (Reaction/Conflict).
    - **Shot 2 (The Misery)**: Visualize Step 2 (Despair/Expulsion).
    - **Shot 3 (The Twist)**: Visualize Step 3 (Discovery/Hut).
    - **Shot 4 (The Mystery)**: Visualize Step 4 (Climax/Object).
    
    *USER INSTRUCTION*: The user will manually extend the scenes from these 4 anchor points. Do NOT generate intermediate shots. Just the 4 key starts.

    [VIDEO PROMPT GENERATION RULES - GROK AUTOMATION COMPLIANT]
    - **TARGET AI**: Grok (Video Generation).
    - **GOLDEN RULE: WAIST SHOT IS KING**:
      - **MANDATORY**: Use **Waist Shot (Upper Body)** for 90% of scenes to ensure stability.
      - **PROHIBITED**: **Full Shot (Whole Body)** is FORBIDDEN (causes bad anatomy).
      - **EXCEPTION**: Close-up is allowed ONLY for intense emotional moments (Tears, Shock).
      - **CROWD RULE**: Even if 5 people are present, **IGNORE** the ones on the edge. **CROP** the frame to show the main 1-2 characters from the **WAIST UP**.

    [SPEAKER IDENTIFICATION RULES (CRITICAL FOR VOICE)]
    - In the 'prompt' field, you MUST explicitly describe the SPEAKER to ensure correct voice generation.
    - **MANDATORY DETAILS**: Age, Gender, Clothing, Position.
    - **EXAMPLE**: "A 50-year-old Korean woman in worn white hanbok sitting on the floor..." instead of just "A woman".

    [AUDIO & MUSIC SEPARATION RULES]
    - **VIDEO PROMPT**: MUST contain VISUAL descriptions ONLY. **ABSOLUTELY NO AUDIO/MUSIC/SFX** instructions in the 'videoPrompt' object.
    - **MUSIC PROMPT**: Place ALL Audio and SFX instructions in the separate 'musicPrompt' field.
    - **SFX ONLY (NO BGM)**: The user wants **Realistic Sound Effects (SFX)** and **Ambience** ONLY.
      - **ALLOWED**: Footsteps, Crying, Wind, Door slam, Birds chirping, Crowd noise.
      - **PROHIBITED**: Background Music, BGM, Score, Melodies, Instruments.
      - **REASON**: Grok (Video) and Suno (Audio) are separate systems. Mixing them causes errors. And user explicitly BANNED music.

    [EMOTIONAL FRAGMENTS ONLY - FOR VIDEO PROMPT]
    - **CRITICAL**: The user wants the **Video Prompt Dialogue** to be different from the Narration Script.
    - **TASK**: Even if the Hooking Script has long sentences, **TRANSLATE THEM INTO SHORT EMOTIONAL BURSTS** for the video generation.
    - **EXAMPLE**:
      - Hooking Script: "    !   !"
      - Video Prompt Dialogue: "!! !! !!" (Max 15 chars)
    - **RULE**: Extract the *core emotion* and make the character scream/whisper it in **UNDER 15 CHARS**.
    - **REASON**: Long sentences fail in video generation. Short bursts look natural.

    [TRANSITION MODE RULES (LOGIC FOR 'CONNECT' VS 'CUT')]
    - You must decide the 'transitionMode' for each shot based on flow:
      - **"continuous"** (Default): Use this when the shot happens in the **SAME LOCATION** and **SAME TIME** as the previous shot.
      - **"cut"**: Use this when the **SCENE CHANGES** (New Location, Time Jump, Flashback, or Montage).

    [STRICT CAMERA LOGIC FOR CONTINUOUS SEQUENCES]
    - **USER RULE**: "Do not zoom in (Close-up) in the middle of a connected sequence. It hides the context."
    - **LOGIC**:
      1. **START OF SEQUENCE**: Establishing Shot / Full Shot / Waist Shot.
      2. **MIDDLE OF SEQUENCE (Connect -> Connect)**: 
         - **ABSOLUTELY NO CLOSE-UPS**.
         - **MUST MAINTAIN CONTEXT**: Use **Waist Shot**, **Knee Shot**, or **Full Shot**.
         - **REASON**: We need to see the "Relationship" and "Background" to connect the scenes smoothly. If you zoom in too early, the connection breaks.
      3. **END OF SEQUENCE (Connect -> End/Cut)**:
         - **CLOSE-UP ALLOWED HERE**: This is the climax of the sequence.
         - You can zoom in to the face (Bust Shot / Close Up) to maximize emotion ONLY at the very end of the connected chain.
    
    [OUTPUT FORMAT]
    OUTPUT JSON (Strict Array of 4 Objects):
    [
      { 
        "sequenceNumber": 1, 
        "title": "Shot Title (Korean)", 
        "visualPrompt": "Detailed visual description for Image Gen (KOREAN)", 
        "characterIds": ["char_id"], 
        "propIds": ["prop_id"],
        "videoPrompt": {
             "id": "1", 
             "scene_title": "Shot Title (Korean)", 
             "shot_type": "Waist Shot", 
             "prompt": "CINEMATIC Waist Shot. [Speaker: Age, Gender, Clothing, Position]. [Action]. [Lighting/Background].", 
             "motion_bucket": 100, 
             "cfg_scale": 7.5, 
             "dialogue": "Actual Spoken Dialogue Only (Empty String if Narration)" 
        },
        "musicPrompt": "Suno AI Prompt (SFX Only, No Music)",
        "transitionMode": "continuous" // or "cut"
      }
    ]

    [FEW-SHOT EXAMPLE - MIMIC THIS STRUCTURE EXACTLY]
    The user wants the 'videoPrompt' to look EXACTLY like this (Note the fields: id, scene_title, shot_type, prompt, motion_bucket, cfg_scale, dialogue):
    {
      "id": "1",
      "scene_title": " ",
      "shot_type": "Waist Shot",
      "prompt": "CINEMATIC Waist Shot. A 20s Korean Gisaeng in colorful Hanbok sitting on a wooden floor. She covers her mouth with one hand, laughing mockingly. Soft lantern light.",
      "motion_bucket": 100,
      "cfg_scale": 7.5,
      "dialogue": "[KOREAN DIALOGUE] ,  ...   ."
    }
    **CRITICAL**: You MUST generate the 'videoPrompt' object with THESE EXACT KEYS. Do not add 'negative_prompt' or 'camera_movement'. Keep it simple as requested.
    
    [MUSIC/SFX PROMPT EXAMPLE]
    "musicPrompt": "Sound of heavy rain pouring outside, occasional thunder rumble, door creaking open slowly. No music."
  `;try{const g=await a.models.generateContent({model:"gemini-2.5-flash",contents:p,config:{responseMimeType:"application/json",safetySettings:gi}});if(g.text){const E=Gn(g.text);if(Array.isArray(E))return E.map(x=>({id:`open-${Date.now()}-${x.sequenceNumber}`,...x}))}return[]}catch(g){throw console.error(g),new Error("  ")}},TC=async(t,e,n)=>{const r=ht(t),o=n.map(s=>`- ${s.name} (${s.gender}, ${s.age}): ${s.description}`).join(`
`),i=`
          **  (Conflict Pairs)** 4 .

    SCRIPT:
    ${e.substring(0,2e4)}

    CHARACTERS:
    ${o}

    [TASK]
    1.    ' vs '  ' & '  .
    2. (//) .

    [OUTPUT JSON]
        .
    ** JSON   ,   '' .**

    [
      {
        "title": "  (:  vs )",
        "description": "    (:      )",
        "composition": "right" //  'left', 'center'
      }
    ]

    []
    - title: " vs ", description: "      "
    - title: " &  ", description: "      "
    - title: "  vs ", description: "      "
    - title: " vs  ", description: "   "

    [RULES]
    - **title**:  **"/A vs /B"**  .
      - ** / **:  (X),  (X),  (X),  (X)
      - **  **: (O), (O), (O),  (O),  (O)
      -  ! : (X) -> (O)
    - **description**: **/  **.  **  **  . (     )
    - **composition**: 'right' (  ), 'left' (  ), 'center' ( ).
  `;try{const s=await r.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json"}});if(s.text){const a=Gn(s.text);if(Array.isArray(a))return a.map((c,d)=>{var h;return{id:`comp-${Date.now()}-${d}`,title:c.title,description:c.description,composition:((h=c.composition)==null?void 0:h.toLowerCase())||"center"}})}return[]}catch(s){return console.error("Composition Analysis Failed",s),[]}},SC=async(t,e,n,r="auto",o,i)=>{const s=ht(t),a=n.map(d=>`[CHARACTER: ${d.name}] ${d.description}`).join(`
`),c=`
    Act as a YouTube Thumbnail Artist.
    ${o?`[CRITICAL MISSION]: Create a thumbnail that perfectly matches this specific title: "${o}". Find the scene in the script that corresponds to this title.`:`Analyze the script and selected theme (${r}) to create ONE IMPACTFUL THUMBNAIL CONCEPT.`}

    ${i?`
    [USER SELECTED COMPOSITION PREFERENCE]
    The user has explicitly chosen this composition concept:
    "${i}"
    
    [INSTRUCTION]: 
    1. STRICTLY FOLLOW the user's chosen composition concept above.
    2. Incorporate the described conflict and character placement.
    3. Generate the Title and Visuals based on this concept.
    `:""}

    SCRIPT:
    ${e.substring(0,3e4)}

    CHARACTERS:
    ${a}

    TASK:
    1. ${o?`**MATCH THE TITLE**: The visual MUST explain why the title is "${o}".`:"Identify the CORE CONFLICT or RELATIONSHIP in the script."}
    2. **CHARACTER-CENTRIC COMPOSITION**:
       - **MUST INCLUDE CHARACTERS**: Folk tales (Yadam) rely on characters. Do not just show objects.
       - **KEY FIGURES**: Usually a beautiful woman (Femme Fatale/Victim) and a man (Hero/Villain/Observer).
       - **DYNAMIC**: Show the tension between them (e.g., A woman seducing a scholar, A man threatening a woman, A tragic farewell).
       - **EXTRAS**: If the scene is a market or palace, include blurred extras in the background for scale.
    3. **METHOD ACTING (BANGTONG STYLE)**:
       - **EXPRESSION IS KING**: The characters must have **INTENSE, DRAMATIC EXPRESSIONS**.
       - **NO DEAD EYES**: Eyes must be alive with desire, fear, anger, or sorrow.
       - **ACTIVE POSING**: Do not just stand. Lean in, grab, push, or hide. Make it look like a paused frame from a high-budget movie.
    4. **VISUAL METAPHOR**: Combine the characters with a symbolic action (e.g., Offering a poisoned drink, Hiding a knife).
    5. **COMPOSITION STRATEGY**:
       - Decide whether to place the character on the **RIGHT** (for text space on left) or **CENTER** (for impact).
       - **RIGHT ALIGNMENT**: Good for dialogue or explanatory text on the left.
       - **CENTER ALIGNMENT**: Good for intense portraits or symmetrical scenes.
       - **NO BLACK VOID**: Do not describe a black background. Describe the full scene.
    7. **SAFETY & POLICY COMPLIANCE (CRITICAL)**:
       - **NO GORE/BLOOD**: Do NOT show blood, open wounds, or severed body parts. Use red lighting or red fabric to symbolize danger instead.
       - **NO EXPLICIT VIOLENCE**: Do NOT show the act of beheading or torture directly. Show the *moment before* (tension) or the *aftermath* (emotional reaction).
       - **SAFE METAPHORS**: Instead of a severed head, show a fallen hat or a broken sword. Instead of torture, show ropes and shadows.
       - **FOCUS ON APPEARANCE, NOT ACTION**: Instead of "being tortured", describe the result: "torn clothes, bruises on face, messy hair, sweat, intense fear".
       - **WEAPONS**: Weapons (swords, knives) are allowed but must not be actively cutting flesh. They should be held threateningly or sheathed.

    OUTPUT JSON:
     {
         "title": "${o||"Short Catchy Title (Korean)"}",
         "composition": "right",
         "action": "Description of the situation, background, and character actions (English). DO NOT include character physical appearance here.",
         "characters": [
            { "name": "Character Name (Korean)", "action": "Specific pose/expression for this character" }
         ]
     }
    `;try{const d=await s.models.generateContent({model:"gemini-2.5-flash",contents:c,config:{responseMimeType:"application/json"}});if(d.text)return Gn(d.text);throw new Error("No response text")}catch(d){throw console.error(d),new Error("  ")}},Gs=async(t,e,n,r="16:9",o="background",i,s,a,c,d,h,m,p,g)=>{var q,Q,Me,Be;const E=ht(t),x=Tr[n].prompt,w=Tr[n].name;let v={aspectRatio:r||"16:9"},T=e;e&&/[-]/.test(e)&&(T=await Sr(E,e));const I=g?g==="right"?`
        [ABSOLUTE COMPOSITION RULE: EXTREME RIGHT SIDE ONLY]
        - **SUBJECT POSITION**: The character(s) MUST be placed on the **EXTREME RIGHT EDGE** of the frame.
        - **WIDTH LIMIT**: The character(s) MUST occupy **LESS THAN 50%** of the total image width.
        - **LEFT SIDE**: The **LEFT 50-60%** of the frame is for TEXT SPACE.
        - **BACKGROUND EXTENSION**: 
          - **DO NOT** create a black void, gradient, or vignette on the left.
          - **MUST** fill the left side with a **NATURAL, DETAILED BACKGROUND** (Scenery, Room, Landscape) that extends from the right side.
          - The background should be slightly out of focus (Bokeh) but fully visible and lit.
        - **NEGATIVE PROMPT**: Black gradient, Dark vignette, Fade to black, Empty void, Character in center, Wide character, White corner, Light leak, Sun flare, Lens flare, White glow, Fog, Haze, Washout.
      `:g==="left"?`
        [ABSOLUTE COMPOSITION RULE: EXTREME LEFT SIDE ONLY]
        - **SUBJECT POSITION**: The character(s) MUST be placed on the **EXTREME LEFT EDGE** of the frame.
        - **WIDTH LIMIT**: The character(s) MUST occupy **LESS THAN 50%** of the total image width.
        - **RIGHT SIDE**: The **RIGHT 50-60%** of the frame is for TEXT SPACE.
        - **BACKGROUND EXTENSION**: 
          - **DO NOT** create a black void, gradient, or vignette on the right.
          - **MUST** fill the right side with a **NATURAL, DETAILED BACKGROUND** (Scenery, Room, Landscape) that extends from the left side.
          - The background should be slightly out of focus (Bokeh) but fully visible and lit.
        - **NEGATIVE PROMPT**: Black gradient, Dark vignette, Fade to black, Empty void, Character in center, Wide character, White corner, Light leak, Sun flare, Lens flare, White glow, Fog, Haze, Washout.
      `:"":"";if(m&&m.length>0&&Array.isArray(i)&&i.length>0){const he=m.map((xe,be)=>`${xe} (MATCH WITH PROVIDED REFERENCE IMAGE #${be+1})`).join(", ");he&&(T+=`
[CHARACTER MATCHING: ${he}]`)}let A=s||"";s&&/[-]/.test(s)&&(A=await Sr(E,s)),d&&/[-]/.test(d)&&await Sr(E,d);let O='You are the "Continuity Supervisor" for a high-budget Korean Historical Drama.';n==="webtoon"?O='You are the "Lead Artist" for a Premium Korean Historical Webtoon (Manhwa).':n==="animation"?O='You are the "Animation Director" for a 2D Korean Folklore Animation (Studio Ghibli style).':n==="inkwash"?O='You are a "Master Illustrator" specializing in Modern Korean Watercolor Art.':n==="fantasy"&&(O='You are the "Cover Artist" for a High-End Korean Romance Fantasy Novel.');const k=`
    [ROLE] ${O}
    [ABSOLUTE CASTING RULE]
    - **DRAW ONLY** the characters explicitly listed in the "[FOCUS SUBJECT]" section of the prompt.
    - If the script mentions other characters (talking/listening) but they are NOT in "[FOCUS SUBJECT]", **DO NOT DRAW THEM**.
    - If only ONE character is listed, it must be a **SOLO SHOT**.
    
    [YOUR MISSION]
    1. **CONSISTENCY IS GOD**: 
       - If a Character Reference is provided, the character MUST look exactly like it.
       - If a Background Reference is provided, the room/environment MUST look exactly like it.
    2. **ACTING DIRECTOR**: Natural acting, candid shots.
    3. **HISTORICAL POLICE**: Enforce Joseon Dynasty rules.
  `,j=A?`
    [USER COMMAND - ABSOLUTE PRIORITY - OVERRIDES REFERENCE]
    The user wants to CHANGE specific details from the reference image.
    
    [INSTRUCTION]: "${A}"
    [ORIGINAL KOREAN]: "${s}"

    [EXECUTION RULES]
    1. **CLOTHING/HAIR CHANGE**: If the user asks to change clothing/hair (e.g., "Remove Hat", "Wear Indoor Clothes"), YOU MUST OBEY.
    2. **IGNORE REFERENCE**: Ignore the "Reference Image" constraint for that specific item.
    3. **KEEP IDENTITY**: Keep the FACE and BODY TYPE the same, but change the requested item.
    4. **CONSISTENCY CHECK**: If the user instruction conflicts with the reference image, the **USER INSTRUCTION WINS**.
  `:"";let D="";const V=Array.isArray(i)?i:i?[i]:[];V.length>0&&(o==="character"||o==="cinematic")&&(D=`
        [VISUAL ANCHOR - CHARACTERS (ABSOLUTE TRUTH)]
        The provided images (tagged as Character Refs) are the **GOD-TIER REFERENCES**.
        
        - **MATCHING RULE**: The prompt explicitly tags characters with "(MATCH WITH PROVIDED REFERENCE IMAGE #N)".
        - **EXECUTION**: You MUST map the Nth provided image to that specific character.
        - **IDENTITY LOCK**: 
          - **FACE**: Copy the facial features, age, and facial hair EXACTLY.
          - **COSTUME**: Copy the clothing style, colors, and HEADWEAR EXACTLY. 
          - **DO NOT CHANGE CLOTHES**: Unless the script explicitly says "He changed clothes", **KEEP THE REFERENCE COSTUME**.
          - **DO NOT REMOVE HATS**: If the reference has a hat (Gat/Official Cap), **KEEP IT ON** (Even indoors, unless explicitly told to remove).
          - **DO NOT HALLUCINATE**: Do not add beards, glasses, or accessories that are not in the reference.
        
        - **BACKGROUND EXCLUSION**: IGNORE any background elements in the reference images. Only look at the person.

        [CRITICAL STYLE ADAPTATION RULE]
        - **DO NOT COPY THE RENDERING STYLE** of the reference image if it conflicts with the [STYLE LOCK].
        - **IF Reference is a PHOTO** and Target Style is **WEBTOON/ANIMATION/INKWASH**:
          - **CONVERT** the character into the target Art Style.
          - **RETAIN** the facial features and clothes, but **RENDER** them as 2D Art/Webtoon.
          - **DO NOT GENERATE A PHOTO** just because the reference is a photo.
          - **FORCED OVERRIDE**: The User's Selected Art Style (${Tr[n].name}) >>> Reference Image Style.
      `);let X="";a&&(X=`
        [VISUAL MASTER - BACKGROUND & STYLE]
        The provided image is the **BACKGROUND REFERENCE**.
        1. **ARCHITECTURE & ATMOSPHERE**: Copy the room structure, furniture, lighting, and textures EXACTLY.
        2. **ADAPT FRAMING**: 
           - IF a specific Camera Shot (e.g., Waist Shot) is requested in the prompt, YOU MUST ZOOM IN/OUT within this environment.
           - DO NOT just copy the reference's framing if it conflicts with the [CAMERA] instruction.
           - Example: If Reference is Wide Room but Prompt is "Waist Shot", draw the character from waist up with the blurred room background behind them.
      `);let _="";c&&c.length>0&&(_=`
        [VISUAL ANCHOR - PROPS/OBJECTS]
        The provided additional images are IMPORTANT OBJECTS (Props) that must appear in the scene.
        1. **INTEGRATION**: Include these objects in the scene naturally as described in the script.
        2. **APPEARANCE**: Maintain their visual appearance (color, shape, details) as shown in the reference images.
        3. **INTERACTION**: If the character is interacting with them (holding, looking at), ensure realistic interaction.
      `);const z=`
    [INTERACTIVE ACTING - REACTION & RELATIONSHIP]
    - **CRITICAL MISSION**: Do not draw characters in isolation.
    - **SPEAKER vs LISTENER DYNAMICS**:
      - If Character A is yelling (Speaker), Character B MUST be **REACTING** (Listener).
      - **Speaker Actions**: Pointing finger, slamming table, grabbing collar, wide open mouth, veins popping.
      - **Listener Actions**: Covering ears, cowering in fear, looking away in shame, or glaring back in defiance.
    - **EYE CONTACT (WITH EACH OTHER)**:
      - Characters MUST look at **EACH OTHER**.
      - **ABSOLUTE RULE**: Draw an invisible line between their eyes. Their gaze must meet.
      - **NEVER** have both characters looking forward at the camera. They should be in profile or 3/4 view facing each other.
    - **PHYSICAL CONTACT**:
      - Encourage physical interaction: Holding hands, pushing, pulling, hugging, hitting.
      - If they are fighting, show the moment of impact or the tension before the strike.

    [COMPOSITION RULES - NO "POLICE LINEUP"]
    - **ABSOLUTE PROHIBITION**: NEVER draw characters standing side-by-side in a straight line facing the viewer.
    - **TRIANGLE COMPOSITION**: If there are 3 people, arrange them in a triangle (One in front, two behind OR Two in front, one behind).
    - **DEPTH STAGING**:
      - Place the Main Character in the **FOREGROUND**.
      - Place Secondary Characters in the **BACKGROUND** or **SIDE**.
      - **OVER-THE-SHOULDER**: Use the back of one character to frame the other.
    - **BAD**: A, B, C standing in a row like a K-pop group.
    - **GOOD**: A is dragging B by the arm, while C follows anxiously from behind.

    [STRICT PROHIBITION - "POLITE HANDS" POSE]
    - **NEVER** generate the "Polite Hands (Gongsu)" pose where hands are folded in front of the belly while looking at the camera.
    - **REASON**: This looks like a greeting card or a news anchor. We are making a DRAMA.
    - **ACTION**: Hands must be **DOING SOMETHING** (Grabbing, Pointing, Covering Face, Holding Object) or hanging naturally in motion.
    - **NEGATIVE PROMPT**: Hands folded in front, Polite greeting pose, Looking at camera, Standing still, Passport photo style.
  `,N=`
    [POSTURE & POSE RULES]
    1. **DEFAULT POSE**:
       - IF Location is OUTDOOR (Yard, Street, Forest): **MUST BE STANDING** unless script explicitly says "Sitting".
       - IF Location is INDOOR: Follow script context.
    2. **FRAMING VS POSE**:
       - **DO NOT CHANGE THE POSE** to fit the camera frame.
       - If "Waist Shot" is requested, **CROP THE IMAGE**. DO NOT make the character sit to hide their legs.
       - If the character is Standing, keep them Standing and just show the upper body.
  `,te=`
    [HISTORICAL ACCURACY: JOSEON DYNASTY ARCHITECTURE]
    - **PRISON/JAIL**:
      - **STRUCTURE**: Use **WOODEN LATTICE** (Grid pattern / # shape). Do NOT use vertical iron bars.
      - **NO STONE FLOOR**: The floor is **DIRT/GROUND** covered with **STRAW MATS** or scattered **HAY**.
      - **NO CHAINS**: Unless specified, use ropes (Seung) instead of metal chains.
    - **DOORS/WINDOWS**:
      - Use **PAPER DOORS (Changhoji)** with wooden frames. No glass windows.
      
    [SPATIAL REALISM & LENS]
    1. **DO NOT SHRINK THE ROOM**: The room must remain spacious. Do not make the walls close in on the characters.
    2. **DEPTH**: Use "Depth of Field" or "Bokeh" for Close-ups/Waist Shots to separate character from background.
    3. **LENS PREFERENCE (WAIST SHOT DEFAULT)**:
       - **DEFAULT TO WAIST SHOT**: The user explicitly demands **Waist Shot (Head to Waist)** as the standard framing.
       - **PROHIBITED**: Do NOT generate Full Shots or Knee Shots unless explicitly requested.
       - **Framing**: Character's Head and Torso should fill 80-90% of the vertical frame.
       - **REASON**: We need to see facial expressions clearly. Small faces in Full Shots are unacceptable.
    4. **LENS**:
       - Use **50mm or 85mm Portrait Lens**. (Focus on the person).
       - Ensure the character's hands are visible if they are acting.
  `,ge=`
    [STRICT ADHERENCE TO SCRIPT]
    - **NO HALLUCINATION**: Do NOT add any details, objects, or actions that are NOT explicitly mentioned in the user's prompt/script.
    - **ONLY WHAT IS WRITTEN**: If the script does not describe it, do not generate it.

    [HANBOK CLOTHING RULE - STRICT]
    - **DEFAULT**: Character MUST wear the FULL HANBOK set as shown in the Reference Image.
    - **NO UNDRESSING**: Do NOT remove layers unless the script EXPLICITLY says "Undress" or "Remove Clothes".
    - **SLEEPING/LYING DOWN**: Even when sleeping or lying down, **KEEP THE CLOTHES ON**. Do not change into sleepwear/underwear automatically.
    - **NO TRANSPARENCY**: The skirt (Chima) and Jacket (Jeogori) are **SOLID OPAQUE FABRIC**. DO NOT make them see-through.
    - **NEGATIVE PROMPT**: See-through clothes, Transparent fabric, Lingerie, Underwear only, Modern sleepwear, Nudity.
    
    [SPECIAL EXCEPTION: IF USER EXPLICITLY REQUESTS "UNDRESS/UNDERWEAR/SOKJEOKSAM"]
    - Only IF the prompt specifically asks for "Sokjeoksam" or "Underwear":
      1. Top (Jeogori) can be white/sheer.
      2. **BOTTOM (CHIMA) MUST BE SOLID OPAQUE**: The skirt must NEVER be transparent. It must cover the legs completely and solidly.
      3. **NO NUDITY**: No sensitive body parts visible.
  `,J=`
    [STYLE LOCK - ABSOLUTE PRIORITY]
    - Target visual style: ${w}.
    - **ART STYLE ENFORCEMENT**: The image must be a **STYLIZED 2D ILLUSTRATION** or **DIGITAL ART** matching the '${w}' description.
    - **ABSOLUTE PROHIBITION (REALISM BAN)**:
      - **NO PHOTOREALISM**: Do NOT generate a real photograph.
      - **NO LIVE-ACTION**: Do NOT look like a movie screenshot or drama still with real actors.
      - **NO 3D RENDER**: Do NOT look like a 3D game engine render (Unreal/Unity).
      - **NO HYPER-REALISM**: Do NOT show skin pores, realistic hair strands, or camera sensor noise.
    - **VISUAL TEXTURE**: Use painterly strokes, ink lines, or cell-shading (depending on the style). The image should look like a high-quality drawing.
    - **OVERRIDE REFERENCE STYLE**: Even if the Reference Image is a real photo, the OUTPUT must be a DRAWING in this style.
  `;let K="",M="";e.includes("[CAMERA]")&&(e.includes("Waist Shot")||e.includes("ws")?M=`
            [ABSOLUTE FRAMING RULE: WAIST SHOT] 
            1. **ZOOM / CROP**: The framing MUST be a **CLOSE-UP from Head to Waist**.
            2. **FILL THE SCREEN**: The Character's Head and Torso MUST FILL the vertical space of the 16:9 frame.
            3. **CUT OFF**: The bottom of the frame MUST CUT OFF at the Belt/Waist line. **DO NOT SHOW LEGS**.
            4. **HEIGHT DIFFERENCE**: If characters have different heights, **CROP TO THE SHORTER PERSON'S WAIST**. Ensure the shorter person's head is fully visible.
            5. **POSTURE**: **SITTING IS ALLOWED**. If sitting, the camera zooms in to the upper body only.
            6. **NEGATIVE PROMPT**: Full body, Distant shot, Small character, Showing legs, Showing shoes.
            7. **BACKGROUND PRIORITY**: **LOW**. The Character Framing is PRIORITIZED over showing the background location (e.g. Maru/Room). It is okay if the background is cropped or blurry. DO NOT ZOOM OUT to show the architecture.
            8. **MANDATORY**: IF the generated image shows the character's KNEES or FEET, IT IS A FAILURE. REGENERATE closer.
          `:e.includes("Bust Shot")||e.includes("bs")||e.includes("Close Up")||e.includes("cu")?M=`
            [ABSOLUTE FRAMING RULE: BUST SHOT / CLOSE UP] 
            1. **EXTREME ZOOM**: The framing is TIGHT on the Face and Shoulders.
            2. **FILL THE SCREEN**: The Face and Shoulders MUST DOMINATE the frame (80% of screen).
            3. **CUT OFF**: The bottom of the frame MUST CUT OFF at the Chest/Armpits. **DO NOT SHOW WAIST**.
            4. **HEIGHT DIFFERENCE**: If characters have different heights, **CROP TO THE SHORTER PERSON'S CHEST**. Ensure the shorter person's face is fully visible.
            5. **POSTURE**: **SITTING IS ALLOWED**. Even if sitting, we only see the face.
            6. **NEGATIVE PROMPT**: Waist, Stomach, Belt, Hands (unless gesture), Full body, Distant shot.
            7. **BACKGROUND PRIORITY**: **LOW**. The Character Framing is PRIORITIZED over showing the background location (e.g. Maru/Room). It is okay if the background is cropped or blurry. DO NOT ZOOM OUT to show the architecture.
            8. **OVER-THE-SHOULDER RULE**: If the prompt specifies "Speaker" or "OTS", **CROP TO THE SPEAKER**. The Listener (shoulder) is just a framing device and can be cut off or blurred. Focus on the Speaker's face/bust.
            9. **MANDATORY**: IF the generated image shows the character's WAIST or BELT, IT IS A FAILURE. REGENERATE closer.
          `:e.includes("Knee Shot")||e.includes("mls")?M=`
            [ABSOLUTE FRAMING RULE: KNEE SHOT (Medium Long)] 
            1. **ZOOM**: The framing is from Head to Knees.
            2. **FILL THE SCREEN**: The Character (Head to Knees) MUST FILL the vertical space.
            3. **CUT OFF**: The bottom of the frame MUST CUT OFF at the Knees/Thighs. **DO NOT SHOW FEET**.
            4. **POSTURE**: **SITTING IS ALLOWED**. If sitting, show the character from Head to Knees.
            5. **NEGATIVE PROMPT**: Feet, Shoes, Ground at feet, Full body, Distant shot.
            6. **BACKGROUND PRIORITY**: **LOW**. The Character Framing is PRIORITIZED over showing the background location (e.g. Maru/Room).
               - Match the background perspective to the **CHARACTER'S EYE/KNEE LEVEL**.
               - It is okay if the background is cropped or blurry. **DO NOT ZOOM OUT** just to show the floor or roof.
            7. **MANDATORY**: IF the generated image shows the character's SHOES, IT IS A FAILURE. REGENERATE closer.
          `:(e.includes("Full Shot")||e.includes("full"))&&(M=`
            [ABSOLUTE FRAMING RULE: FULL SHOT]
            1. **WIDE ANGLE**: Show the ENTIRE BODY from Head to Toe.
            2. **SPACE**: Leave some space above the head and below the feet.
            3. **POSTURE**: **SITTING IS ALLOWED**. Show the full pose including legs and feet.
            4. **NEGATIVE PROMPT**: Cut off feet, Cut off head, Close up, Waist shot.
            5. **MANDATORY**: IF the generated image cuts off the FEET or HEAD, IT IS A FAILURE. ZOOM OUT.
          `));let ce="";h&&(ce=`
        [VISUAL ANCHOR - MASTER SCENE LOCATION & CHARACTERS]
        The provided first image is the **ACTUAL FILM SET** and **ACTORS**.
        
        [CRITICAL SPATIAL RULES - 3D WORLD EXTENSION]
        1. **IMMUTABLE WORLD**: The walls, floor, furniture, lighting, and atmosphere are **FIXED REALITY**.
           - **DO NOT RE-DECORATE**: Do not add new furniture or change the wall paper.
           - **DO NOT RELOCATE**: Do not move the character to a different place unless the script says so.
        2. **CAMERA WORK ONLY**: You are a cameraman inside this specific room. You can ONLY change the Camera Angle, Lens, and Distance.
        3. **EXTEND THE SPACE**: 
           - Treat the image as a viewport into a full 3D room.
           - If the camera rotates to show a part NOT visible in the reference, **INFER** the environment based on the visible parts.
           - **CONTINUITY**: The unseen wall must match the style of the seen wall. The floor pattern must continue.
           - **DO NOT** invent a completely different style for the unseen areas.
        4. **PERSPECTIVE SHIFT**:
           - If prompt says "Side View", show THIS SAME ROOM from the side.
           - If prompt says "Reverse Shot", show the other side of THIS SAME ROOM.
        5. **BACKGROUND CONSISTENCY CHECK**:
           - If the generated background looks like a different room, IT IS A FAILURE.
           - The texture of the walls, the type of floor (wood vs dirt), and the lighting mood MUST MATCH the Reference Image.
           - **FAIL SAFE**: If you are unsure, KEEP THE BACKGROUND BLURRED but match the COLOR PALETTE exactly.
           
        [CHARACTER CONSISTENCY & ACTING PRIORITY]
        1. **IDENTITY (KEEP)**: The characters MUST look like the same people (Same Face, Same Hair, Same Clothes).
        2. **ACTING (CHANGE - CRITICAL)**: 
           - **DO NOT COPY THE POSE** from the reference image.
           - You MUST change the Pose, Gesture, and Facial Expression to match the NEW PROMPT.
           - If the prompt says "Surprised", they MUST look surprised, even if the reference image is "Calm".
           - **DYNAMIC MOVEMENT**: The character is ALIVE. Make it move!
           - **FAILURE CONDITION**: If the output looks exactly like the reference image with no change in acting, IT IS A FAILURE.
      `);const W=p?`
    [MANDATORY CHARACTER DESIGN - COPY PASTE]
    You MUST apply the following character visual descriptions EXACTLY as written.
    Do NOT modify, summarize, or ignore these details.
    
    ${p}
    
    [INSTRUCTION]: The above descriptions override any generic assumptions.
  `:"";K=`
    [SYSTEM INSTRUCTION: IMAGE EDITING & FRAMING MODE]
    ${ce}
    ${M}
    
    [ORIGINAL SCENE CONTEXT]
    ${k}
    ${x}
    ${J}
    ${Qu}
    ${ge}
    
    [INDOOR ETIQUETTE GUIDE]
    - IF the scene is INDOORS (Room, Maru):
      1. **SHOES**: **STRICT RULE: REMOVE SHOES**. 
         - Characters MUST be barefoot or wearing white socks (Beoseon).
         - Even if the reference image shows shoes, **YOU MUST REMOVE THEM** for indoor scenes.
      2. **HATS**: 
         - Default rule: Remove large outdoor hats (Satgat, Paeraengi).
         - **CRITICAL EXCEPTION**: If the Character Reference Image shows a specific hat (e.g. Gat, Official Cap), **KEEP IT ON** unless the user explicitly asked to remove it.
         - **IDENTITY PRIORITY**: The Character's Identity (Reference Image) is MORE IMPORTANT than the indoor rule.
  
    ${D}
    ${X}
    ${_}
    ${j}
    ${z}
    ${N}
    ${W}
    ${I}

    [SCENE GENERATION PROMPT]
    ${T}
    
    ${te}
    
    [FINAL CHECK]
    - DID YOU CROP THE IMAGE AS REQUESTED?
    - Is the framing correct (Waist/Bust/CloseUp)?
    - Is the background consistent with the Master Image?
  `;const Te=[];if(a&&!h){const he=a.match(/^data:(.+);base64,(.+)$/);he&&Te.push({inlineData:{mimeType:he[1],data:he[2]}})}if(h){const he=h.match(/^data:(.+);base64,(.+)$/);he&&Te.push({inlineData:{mimeType:he[1],data:he[2]}})}V.length>0&&(o==="character"||o==="cinematic")&&V.forEach(he=>{const xe=he.match(/^data:(.+);base64,(.+)$/);xe&&Te.push({inlineData:{mimeType:xe[1],data:xe[2]}})}),c&&c.length>0&&c.forEach(he=>{const xe=he.match(/^data:(.+);base64,(.+)$/);xe&&Te.push({inlineData:{mimeType:xe[1],data:xe[2]}})}),Te.push({text:K});try{const he=await E.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:Te},config:{imageConfig:v,safetySettings:gi}});for(const xe of((Me=(Q=(q=he.candidates)==null?void 0:q[0])==null?void 0:Q.content)==null?void 0:Me.parts)||[])if(xe.inlineData)return`data:${xe.inlineData.mimeType};base64,${xe.inlineData.data}`;throw new Error("  .")}catch(he){throw console.error(he),(Be=he.message)!=null&&Be.includes("SAFETY")?new Error("  :   ."):new Error("    .")}},Sr=async(t,e)=>{var n;if(!e||!/[-]/.test(e))return e;try{return((n=(await t.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:`Translate the following Korean text to English for an image generation prompt. Keep it concise and descriptive. Text: "${e}"`}]}})).text)==null?void 0:n.trim())||e}catch(r){return console.error("Translation failed, using original text:",r),e}},wC=async(t,e,n,r,o)=>{var d,h,m,p;const i=ht(t),s=await Sr(i,n);let c=`
    ${Tr[r].prompt}
    CONTEXT: Korea, Joseon Dynasty.
    TASK: Generate a high-quality visual reference for a specific OBJECT/PROP.
    
    OBJECT NAME: ${e}
    VISUAL DESCRIPTION: ${s}
    
    [RULES]
    1. Single Object isolated on a clean, simple background (or solid color).
    2. Focus on the object details.
    3. Historical accuracy for Joseon Dynasty.
    4. NO text, NO watermarks, NO user interface elements.
    5. High resolution, clear definition.
  `;o&&(c+=`
      [REFERENCE IMAGE PROVIDED]
      - Use the provided image as a strict visual reference for SHAPE, COLOR, and MATERIAL.
      - Copy the structure and design of the object in the reference image.
      - Apply the Joseon Dynasty context if necessary, but keep the core look from the reference.
      `);try{const g=[];if(o){const x=o.match(/^data:(.+);base64,(.+)$/);x&&g.push({inlineData:{mimeType:x[1],data:x[2]}})}g.push({text:c});const E=await i.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:g},config:{imageConfig:{aspectRatio:"1:1"},safetySettings:gi}});for(const x of((m=(h=(d=E.candidates)==null?void 0:d[0])==null?void 0:h.content)==null?void 0:m.parts)||[])if(x.inlineData)return`data:${x.inlineData.mimeType};base64,${x.inlineData.data}`;throw new Error("  .")}catch(g){throw console.error(g),(p=g.message)!=null&&p.includes("SAFETY")?new Error("  :   ."):new Error("     .")}},NC=async(t,e,n,r,o)=>{var k,j,D,V,X,_,z,N,te,ge;const i=ht(t),s={...e};let a=!1;const c=((k=e.gender)==null?void 0:k.match(/(\d+)\s*(||year)/i))||((j=e.extraDetails)==null?void 0:j.match(/(\d+)\s*(||year)/i));c&&parseInt(c[1])<18&&(a=!0);for(const J in s)if(typeof s[J]=="string"){let K=s[J],M=await Sr(i,K);a&&(J==="gender"&&(M=M.replace(/(\d+)\s*(year old|years old)/gi,"Young")),M=M.replace(/\b(slender|curvy|sexy|hot|body|figure|breast|chest|curves|S-line|voluptuous|alluring|sensual)\b/gi,"small build"),M=M.replace(/\b(mature|adult-like|grown-up)\b/gi,"youthful"),M=M.replace(/\b(jealous|jealousy)\b/gi,"displeased"),M=M.replace(/\b(competitive|ambitious)\b/gi,"determined"),M=M.replace(/\b(woman|lady|female)\b/gi,"young girl"),M=M.replace(/\b(maid|servant)\b/gi,"apprentice"),M=M.replace(/\b(court maid|palace maid|kung-nyeo|saenggak-si|royal maid)\b/gi,"young girl in traditional hanbok"),M=M.replace(/\b(trainee court maid)\b/gi,"young student in traditional hanbok")),s[J]=M}const d=await Sr(i,r||""),h=Tr[n].prompt,m=e.optionFlags||{},p=Object.entries(s).map(([J,K])=>{if(J==="optionFlags"||!K||typeof K!="string")return"";const M=m[J];if(M){if(M.enabled===!1)return"";if(M.isMandatory)return`**[CRITICAL/MANDATORY] ${J}: ${K}**`}return`${J}: ${K}`}).filter(Boolean).join(`
- `),g=(D=e.backgroundColor)!=null&&D.includes("Green")?"Solid Green Screen (#00FF00)":"Solid Background",E=((V=s.race)==null?void 0:V.toLowerCase().includes("pure animal"))||((X=s.race)==null?void 0:X.toLowerCase().includes("no clothes")),x=E?`[ANIMAL MODE - CRITICAL]
- DO NOT DRAW HUMAN CLOTHES (No Hanbok, No Hats).
- Draw a REALISTIC ANIMAL standing on four legs (unless specified otherwise).
- Focus on FUR texture and ANIMAL ANATOMY.`:ig,w=d?`
  [USER RESTRICTIONS - ABSOLUTE PRIORITY]
  DO NOT DRAW: ${d}.
  If the user asks to remove something, REMOVE IT COMPLETELY.
  `:"";let y="";const v=(_=s.gender)==null?void 0:_.match(/(\d+)\s*year\s*old/i);if(v&&!E){const J=parseInt(v[1]);J<18?J<7?y=`
             [AGE CONTROL: TODDLER / VERY YOUNG CHILD]
             - VISUALS: Small child, toddler proportions, very short.
             - **STRICT PROHIBITION**: NO "Chibi" style, NO "SD" style, NO "Big Head".
             - **SIZE & FRAMING**:
               1. **SCALE**: The child is TINY. Occupy **ONLY 40%** of the canvas height.
               2. **EMPTY SPACE**: **50% EMPTY SPACE** above head.
               3. **NEGATIVE PROMPT**: Adult, Mature, Tall.
             - **COMPOSITION**: Bottom center.
             `:J<13?y=`
             [AGE CONTROL: CHILD MODE (UNDER 13)]
             - **VISUAL HEIGHT REFERENCE**:
               1. **STANDARD ADULT**: 175-180cm (Fills 80% of canvas).
               2. **THIS CHARACTER**: **80-100cm** (MUST fill only **40%** of canvas).
               3. **COMPARISON**: The character is **HALF THE HEIGHT** of an adult.
             
             - **CULTURAL CONTEXT**: Joseon Dynasty Child (Dongja/Sonyuh).
             - **PROPORTIONS**:
               1. **HEAD SIZE**: **SMALL HEAD**. Ratio 1:7.5 to 1:8. (Same proportions as adult, just smaller scale).
               2. **BODY**: **THIN & NARROW**. SHOULDERS MUST BE NARROW.
               3. **NO BIG HEAD**: **ABSOLUTELY NO CHIBI/SD STYLE**. The head must look small.
             
             - **COMPOSITION & FRAMING (HIGHEST PRIORITY)**:
               1. **ALIGNMENT**: **STRICT BOTTOM ALIGNMENT**. Feet MUST be at the very bottom edge of the canvas (same ground level as adults).
               2. **VERTICAL OCCUPANCY**: Character MUST ONLY occupy the **BOTTOM 40%** of the canvas.
               3. **EMPTY SPACE**: The **TOP 60%** of the image MUST be EMPTY BACKGROUND.
               4. **NO FLOATING**: Do NOT center the character vertically. Put them ON THE GROUND.
               5. **ZOOM OUT**: Camera distance is **20 METERS AWAY**.
             
             - **NEGATIVE PROMPT**: Close up, Zoom in, Filling the frame, Macro, Portrait, Big head, Wide shoulders, Adult proportions, Giant, Large body, **Centered vertically**, **Floating in middle**.
             `:y=`- VISUALS: Youthful teenager, student age. Fresh skin, slightly smaller build than an adult.
`:(y=`
         [AGE CONTROL: ${J} YEARS OLD]
         - The character MUST look exactly ${J} years old.
         `,J>=60?y+=`- VISUALS: Visible WRINKLES, aged skin texture, grey/white hair (unless dyed), wise/tired eyes.
- DO NOT make them look like a young K-pop star with grey hair. They must have OLD SKIN.
`:J>=40&&(y+=`- VISUALS: Mature adult, slight laugh lines, confident bearing. Not a 20-year-old.
`))}const T=Object.values(e).join(" ").toLowerCase();(T.includes("")||T.includes("saenggak"))&&(a?y+=`
            - **COSTUME STYLE**: Traditional Korean apprentice girl outfit.
            - **HAIR**: Long braid with a ribbon (Daenggi), or looped hair (Saenggak-si style).
            - **CLOTHING**: Simple, neat Hanbok.
            - **APPEARANCE**: Young, innocent, disciplined student look.
            `:y+=`
            - **HISTORICAL ROLE: SAENGGAK-SI (LITTLE COURT MAID)**
            - **DEFINITION**: "Saenggak-si" refers to young court maids (Children) studying to become Nain in the Joseon Dynasty palace. It specifically means "Apprentice Court Maid" who just entered the palace for training.
            - **KOREAN CONTEXT**: "  ()       ,     ' '".
            - **AGE CONTEXT**: They are **CHILDREN** (trainees), NOT adults. They have childish features.
            - **HAIR**: "Saenggak-si" wear a specific hairstyle (often a long braid with a ribbon, or a special looped hair for trainees).
            - **CLOTHING**: Simple court maid uniform.
            `);let I="Full Body, Feet Visible";v&&parseInt(v[1])<13&&(I="Wide Shot, Small Scale Full Body, Distant View (20m away)");let A="";if(s.scale){const J=s.scale;A=`
      [USER DEFINED SCALE: ${J}%]
      - **CRITICAL INSTRUCTION**: The character MUST occupy **ONLY ${J}%** of the canvas height.
      - **ALIGNMENT**: **STRICT BOTTOM ALIGNMENT**. Feet at the bottom edge.
      - **EMPTY SPACE**: The TOP ${100-J}% of the image MUST be empty.
      - **REASON**: The user has manually set the character's height relative to the canvas.
      `,J<=50&&(I="Wide Shot, Small Scale Full Body, Distant View")}let O=`
    ${h}
    CONTEXT: Korea, Joseon Dynasty.
    ${x} 
    ${sg}
    ${w}
    ${y}
    ${A}

    TASK: Generate Character Reference Sheet.
    [DETAILS] - ${p}
    [RULES] ${I}, ${g}, Neutral Pose.
  `;o&&(O+=`
      [VISUAL REFERENCE - SOURCE MATERIAL]
      The provided image is the **SOURCE ACTOR/DESIGN**.
      
      [CRITICAL INSTRUCTION]
      1. **FACE & IDENTITY**: Copy the facial features, eye shape, and expression from the reference image EXACTLY.
      2. **CLOTHING**: Maintain the style and structure of the clothing from the reference.
      3. **ADAPTATION**: Apply the Joseon Dynasty style ONLY to the texture/materials if necessary, but KEEP THE FORM.
      4. **GOAL**: The result must look like the SAME PERSON wearing the SAME CLOTHES (or Joseon version of them).
      `);try{const J=[];if(o){const M=o.match(/^data:(.+);base64,(.+)$/);M&&J.push({inlineData:{mimeType:M[1],data:M[2]}})}J.push({text:O});const K=await i.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:J},config:{imageConfig:{aspectRatio:"9:16"}}});for(const M of((te=(N=(z=K.candidates)==null?void 0:z[0])==null?void 0:N.content)==null?void 0:te.parts)||[])if(M.inlineData)return`data:${M.inlineData.mimeType};base64,${M.inlineData.data}`;throw new Error("  .")}catch(J){throw(ge=J.message)!=null&&ge.includes("SAFETY")?new Error("  ."):new Error("  .")}},CC=async(t,e,n="green")=>{var c,d,h;const r=ht(t),o=e.match(/^data:(.+);base64,(.+)$/);if(!o)throw new Error("Invalid image format");const a=`
    Change the background of this image to a solid flat ${n==="green"?"Green Screen":"Solid White"} (${n==="green"?"#00FF00":"#FFFFFF"}).
    [CRITICAL RULES]
    1. **KEEP FOREGROUND EXACTLY THE SAME**: Do not change the character's face, clothes, or pose. Only change the environment behind them.
    2. The background must be a single solid color for chroma keying.
    3. High quality edges.
  `;try{const m=await r.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:o[1],data:o[2]}},{text:a}]}});for(const p of((h=(d=(c=m.candidates)==null?void 0:c[0])==null?void 0:d.content)==null?void 0:h.parts)||[])if(p.inlineData)return`data:${p.inlineData.mimeType};base64,${p.inlineData.data}`;throw new Error("  .")}catch(m){throw console.error("Bg Edit Failed",m),new Error("    .")}},IC=async(t,e)=>{var i,s,a;const n=ht(t),r=e.match(/^data:(.+);base64,(.+)$/);if(!r)throw new Error("Invalid image format");const o=`
    Remove the person/character from this image completely.
    [TASK]
    1. Identify the character in the foreground.
    2. Erase the character.
    3. Inpaint (Fill) the empty space with the background texture and objects to match the surrounding environment perfectly.
    4. The result should be an empty room/landscape with NO PEOPLE.
    5. Maintain the original lighting, style, and camera angle.
  `;try{const c=await n.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:r[1],data:r[2]}},{text:o}]}});for(const d of((a=(s=(i=c.candidates)==null?void 0:i[0])==null?void 0:s.content)==null?void 0:a.parts)||[])if(d.inlineData)return`data:${d.inlineData.mimeType};base64,${d.inlineData.data}`;throw new Error("  .")}catch(c){throw console.error("Remove Char Failed",c),new Error("    .")}},bC=async(t,e,n)=>{var a,c,d;const r=ht(t),o=await Sr(r,n),i=e.match(/^data:(.+);base64,(.+)$/);if(!i)throw new Error("Invalid image format");const s=`
    Modify this image based on the user's instruction.
    USER INSTRUCTION: "${o}"
    
    [RULES]
    1. Apply the change STRICTLY to the requested area.
    2. Keep the rest of the image (Face, Identity, Pose, Background) EXACTLY THE SAME unless the instruction asks to change it.
    3. High quality inpainting. Seamless blending.
    
    Example: 
    - If instruction is "Remove the hairpin", remove only the hairpin and reconstruct the hair.
    - If instruction is "Close eyes", change only the eyes.
  `;try{const h=await r.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:i[1],data:i[2]}},{text:s}]},config:{safetySettings:gi}});for(const m of((d=(c=(a=h.candidates)==null?void 0:a[0])==null?void 0:c.content)==null?void 0:d.parts)||[])if(m.inlineData)return`data:${m.inlineData.mimeType};base64,${m.inlineData.data}`;throw new Error(" .")}catch(h){throw console.error("Magic Edit Failed",h),new Error("   .")}},AC=async(t,e)=>{var o;const n=ht(t),r=`
          .
       ,      "   "  .
     
     [ ]
         " ", " ", "" , AI        .
     
     [ ]
    1. ** / **: (: (99 ), ())
    2. **   **: (:    ,   )
    3. **  /**: (:   )
    4. **  **: (: , )

    [ ]
    - **  .**
    - **[ ]   .** (   )
    - ** **:  ("~", "~")  , ** .** (: " .  .")
    - ** **:   **300~400 ** .
    -    ,  ** ** .
     
     SCRIPT:
     ${e.substring(0,3e4)}
   `;try{return((o=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:r}]}})).text)==null?void 0:o.trim())||""}catch(i){throw console.error("Global context analysis failed",i),new Error("  ")}},_C=async(t,e,n=[])=>{const r=ht(t),o=n.length>0,i=o?`
    [   - **    **]
      ** ()**: ${JSON.stringify(n)}

    [   -  ]
    1. **(Core) .   .**
       -      ,     .
       -  **     /** .
       - (X) "    " ( -> )
       - (O) "      ****" ( -> )

    2. **    (Mandatory Characters)**:
       -   "A vs B",   ** A B   ** .
       - (O) "    /   / "

    3. ** '()'  .**
       - (X) "    " ( )
       - (O) "     ****" ( )
    
    4. **(~, ~, ~)   .**
       - (X) " /  / " (  )
       - (O) "     /     / "

    [   ]
    - **[A ]** + **[B /]** + **[ /]**
    -  1: "  /    /   / "
    -  2: "   /    /  / "
    -  3: "   /    /  / "
    -  4: "  /     /   / "

    [ ]
    - **(** **)   .** (     )
    - **(Trivial)   .** ( ,   )
    - **        .**
    - **'~', '~'   .**
    - **/     .**
    `:`
    [  - "   "]
    1. **    **:
       - "", ""    .
       - **     ** .
    `,s=`
       1000  ** /   **.
      , **${o?"     ":"   "}** **3~4    50** .

    [ ]
    ${e.substring(0,5e4)}

    ${i}

    [  ]
    1. ****: 3~4  ('/'  ),   20 .
    2. ** **:    ** (, , )**  . (: , , , )
    3. ** **: '~', '~', '~'      .

    [ ]
    **JSON   .** (   '/'  )
    : [" /     /     / ", "   /     /   / ", ...]
  `;try{const c=(await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:s}]},config:{responseMimeType:"application/json"}})).text||"[]",d=Gn(c);return Array.isArray(d)?d:typeof d=="object"&&Array.isArray(d.titles)?d.titles:[]}catch(a){throw console.error("Massive hooking title generation failed",a),new Error("  : "+a.message)}},RC=async(t,e,n)=>{var i;const r=ht(t),o=`
        .
     (Shot)  **   (Caption)** 1 .

    [ ]
    - : ${e}
    -  : ${n}

    [ ]
    1. ****: 15   .
    2. ****: , , ,    " ".
    3. ****:    1 . ( )
    
    :
    - " ,   "
    - "   "
    - "     "
  `;try{return((i=(await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:o}]}})).text)==null?void 0:i.trim())||""}catch(s){throw console.error("Trailer caption generation failed",s),new Error("  ")}},kC=async(t,e,n,r="auto")=>{const o=ht(t),i=e.map(h=>`[Scene ${h.sequenceNumber}] ${h.title}: ${h.visualPrompt}`).join(`
`),s={auto:"",fast_exciting:`
      [STYLE]: Korean Traditional Folk, Pungmul, Madangnori (Pure Gugak).
      [INSTRUMENTS]: Korean hand gong (Kkwaenggwari, metallic, bright, fast attack), Korean hourglass drum (Janggu, rhythmic percussion, drum roll, sharp stick sound), Barrel drum (Buk, resonant, heartbeat, bass drum), Korean gong (Jing, deep, long decay, brassy), Korean oboe (Taepyeongso, piercing, high-pitched, loud).
      [TEMPO]: Fast & Energetic (Hwimori, Jajinmori), Excited, Bouncy, Rhythmic.
      [VOCAL]: Playful, Energetic, Spoken-style, Narrative, With Chuimsae (Eol-su, Jihwaja).
      [MIXING]: Rich and well-blended sound, warm spatial mixing, energetic percussion.
      [NOTE]: **NO WESTERN INSTRUMENTS**. No Guitar, No Brass. Pure Korean sound.
      [NOTE]: The lyrics MUST be in **Jeolla-do or Chungcheong-do Dialect (Saturi)**. Use spoken word style like Pansori Aniri.
              Examples: ",  !", ",   !", ", !".
    `,sad_sorrowful:`
      [STYLE]: Sad Sagueuk Ballad, Cinematic, Emotional Gugak.
      [INSTRUMENTS]: Korean fiddle (Haegeum, two-stringed, grainy, sorrowful, violin-like), Korean bass fiddle (Ajaeng, bowed zither, mellow, deep, cello-like), Korean bamboo flute (Daegeum, breathy, wind sound), Korean zither (Gayageum, plucked, clear).
      [TEMPO]: Slow, Flowing, Rubato, Melancholic.
      [VOCAL]: Soft Female Vocals, Breathy, Sorrowful, Tearful, Lyrical.
      [MIXING]: Soft resonance, emotional reverb, intimate, grainy texture.
    `,faint_hazy:`
      [STYLE]: Dreamy Sagueuk, Ambient, Ethereal Gugak.
      [INSTRUMENTS]: Korean bamboo flute (Daegeum, breathy, air sound), Small bamboo flute (Sogeum, clear, high-pitched), Korean mouth organ (Saenghwang, mysterious chords), Korean zither (Gayageum, plucked, soft).
      [TEMPO]: Slow, Floating, Non-rhythmic, Mystical.
      [VOCAL]: Whispering, Echoing, Mysterious, Faint.
      [MIXING]: Ethereal reverb, wide spatial mixing, dreamy atmosphere.
    `,slow_mystery:`
      [STYLE]: Korean Traditional Noir, Suspense, Dark Gugak.
      [INSTRUMENTS]: Korean bass zither (Geomungo, percussive strings, deep resonance, heavy), Korean gong (Jing, dark resonance, slow decay), Barrel drum (Buk, deep thud), Korean bass fiddle (Ajaeng, low friction sound).
      [TEMPO]: Slow tension, Heartbeat rhythm, Heavy, Suspenseful.
      [VOCAL]: Low male vocal, Spoken word, Warning tone, Monologue-style.
      [MIXING]: Dark ambience, deep bass resonance, tension.
    `,medium_story:`
      [STYLE]: Korean Folk Storytelling, Mid-tempo Gugak.
      [INSTRUMENTS]: Barrel drum (Buk, resonant), Korean hourglass drum (Janggu, rhythmic), Korean bamboo flute (Daegeum, breathy), Korean zither (Gayageum, plucked, clear).
      [TEMPO]: Medium, Walking pace, Rhythmic (Gutgeori), (90-110 BPM).
      [VOCAL]: Clear narration, Minyo style, Storytelling, Conversational, With Chuimsae.
      [MIXING]: Clear vocal focus, balanced ensemble.
      [NOTE]: Use a storytelling tone (Taryeong) with occasional Chuimsae. Dialect (Saturi) is preferred for humor.
    `,grand_epic:`
      [STYLE]: Epic Sagueuk Orchestra, War Movie OST (Pure Gugak Version).
      [INSTRUMENTS]: Korean oboe (Taepyeongso, piercing, loud), Massive Barrel Drum Ensemble (Buk, thunderous, epic), Korean gong (Jing, metallic resonance), Korean double reed pipe (Piri, strong, nasal, loud), Korean hand gong (Kkwaenggwari, accent).
      [TEMPO]: Dynamic, Marching, Grandiose, Powerful.
      [VOCAL]: Grand Chorus, Chanting, Heroic, Powerful, Theatrical.
      [MIXING]: Massive sound, wide dynamic range, cinematic impact.
      [NOTE]: **NO WESTERN BRASS/STRINGS**. Create epicness with massive Korean drum ensemble and piercing wind instruments.
    `},a={auto:"Analyze the sequence and choose the most fitting Sagueuk (Korean Historical Drama) OST style using ONLY Korean traditional instruments.",mystery:`
      [STYLE]: Korean Traditional Noir, Sagueuk OST, Cinematic.
      [INSTRUMENTS]: Korean bass zither (Geomungo, percussive strings), Korean gong (Jing, dark resonance), Korean bamboo flute (Daegeum, breathy).
      [TEMPO]: Slow tension, Heartbeat rhythm, Slow-burn.
      [VOCAL]: Whispering, Low male vocal, Minimal Vocals.
      [MIXING]: Dark ambience, deep resonance.
    `,comedy:`
      [STYLE]: Korean Folk Pop, Madangnori, Upbeat OST.
      [INSTRUMENTS]: Korean hand gong (Kkwaenggwari, metallic), Korean hourglass drum (Janggu, rhythmic), Korean oboe (Taepyeongso, piercing).
      [TEMPO]: Fast Tempo, Bouncy, Rhythmic, Marching.
      [VOCAL]: Playful, Storytelling, Pansori style narration, Spoken-style.
      [MIXING]: Bright, clear, energetic.
    `,destiny:`
      [STYLE]: Epic Sagueuk Orchestra, Cinematic, Grandiose.
      [INSTRUMENTS]: Korean bamboo flute (Daegeum, breathy), Massive Barrel Drum Ensemble (Buk), Korean double reed pipe (Piri).
      [TEMPO]: Slow build-up to Fast, Dynamic, Marching.
      [VOCAL]: Grand Chorus, Chanting, Heroic Vocals.
      [MIXING]: Wide, cinematic, majestic.
    `,tragedy:`
      [STYLE]: Sad Sagueuk Ballad, Cinematic, OST.
      [INSTRUMENTS]: Korean fiddle (Haegeum, grainy, sorrowful), Korean bass fiddle (Ajaeng, mellow), Korean zither (Gayageum, plucked).
      [TEMPO]: Slow, Flowing, Rubato.
      [VOCAL]: Soft Female Vocals, Emotional, Breathy, Sorrowful.
      [MIXING]: Intimate, emotional reverb.
    `,revenge:`
      [STYLE]: Intense Gugak, Cinematic, Driving.
      [INSTRUMENTS]: Korean bass zither (Geomungo, aggressive, percussive), Barrel drum (Buk, deep), Korean oboe (Taepyeongso, piercing).
      [TEMPO]: Fast Paced, Aggressive, Driving rhythm.
      [VOCAL]: Gritty, Powerful, Spoken-style.
      [MIXING]: Sharp, punchy, intense.
    `,despair:`
      [STYLE]: Minimalist Sagueuk, Cinematic, Ambient.
      [INSTRUMENTS]: Korean bass fiddle (Ajaeng, sorrowful, bowed), Korean bamboo flute (Daegeum, breathy), Wind Sound.
      [TEMPO]: Very Slow, Dragging, Stillness.
      [VOCAL]: Spoken word, Low humming, Mournful.
      [MIXING]: Empty space, cold atmosphere.
    `};let c="";r!=="auto"&&s[r]?c=s[r]:c=a[n]||a.auto;const d=`
    You are a professional Music Director and Lyricist for a Korean Historical Drama (Sagueuk).
    Create a **Background Music (OST) prompt** for the following opening sequence.

    [GOAL]
    The music must **SUPPORT** the video, not overpower it. It should set the perfect atmosphere.
    The lyrics should be poetic and abstract, enhancing the mood without narrating every detail.
    For 'fast_exciting', 'comedy', or 'medium_story' styles:
      - **TONE**: Use **Satire & Humor (Haehak)**.
      - **STYLE**: Use **Spoken Word / Monologue (Pansori Aniri)** style.
      - **DIALECT**: Use **Korean Dialect (Saturi)** like "", "", "~", "~".
      - **CONTENT**: Directly address the situation with wit. NOT poetic descriptions.
      - Example: "     !"

    [SEQUENCE STORY]
    ${i}

    [MUSIC STYLE GUIDE]
    ${c}

    [TASK]
    1. **Title**: A catchy, poetic title for the song (Korean).
    2. **Style of Music (English)**: A single string of English tags for Suno AI.
       - **CRITICAL**: COPY the full instrument descriptions including adjectives (e.g., "Korean hand gong, metallic, bright"). DO NOT shorten to just "Kkwaenggwari".
       - **COMBINE**: Genre + Full Instrument Descriptions + Tempo + Vocal Style + Mixing Keywords.
       - **FORMAT**: Comma-separated tags.
       - **MUST INCLUDE**: "Cinematic", "OST", "Background Music", "No Intro", "Immediate Start".
    3. **Style of Music (Korean)**: A single string of Korean tags for Suno AI.
       - **COMBINE ALL ELEMENTS**: Genre + Instruments + Tempo + Vocal Style in Korean.
       - **IMPORTANT**: For "No Intro", use English "No Intro" even in the Korean string as it works better.
       - **FORMAT**: Comma-separated tags (e.g., "   OST, , , ,  , ,  , No Intro").
    4. **Lyrics**: Korean lyrics structured for ~60 seconds.
       - **CRITICAL RULE 0 (NO PRELUDE)**: The song must start singing IMMEDIATELY.
       - **CRITICAL RULE 4 (LENGTH LIMIT)**: **ABSOLUTE MAXIMUM 8 LINES TOTAL**. 
         - **Recommended Structure**: 
           [Verse] (2-4 lines)
           [Chorus] (2-4 lines)
           [Outro] (1 line)
       - **CRITICAL RULE 1 (NO NAMES)**: NEVER use specific character names. Use pronouns or metaphors.
       - **CRITICAL RULE 2 (NO SPOILERS)**: Do NOT describe specific plot events literally. Focus on *Atmosphere* and *Emotion*.
       - **CRITICAL RULE 3 (SUPPORTIVE)**: The lyrics should feel like a part of the soundtrack, not a separate pop song.

    [OUTPUT JSON FORMAT]
    {
      "title": "Song Title",
      "style_en": "Style Tags (English)",
      "style_ko": "Style Tags (Korean)",
      "lyrics": "[Verse]
Line 1
Line 2...

[Chorus]
Line 3..."
    }
  `;try{const m=(await o.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:d}]},config:{responseMimeType:"application/json"}})).text||"{}";return Gn(m)}catch(h){throw console.error("Suno lyrics generation failed",h),new Error("  ")}},Jf=async(t,e,n,r,o,i)=>{var m;const s=ht(t),a=e.match(/^data:(.+);base64,(.+)$/);if(!a)return n;let c=!1,d=null;try{d=JSON.parse(n),typeof d=="object"&&d!==null&&(c=!0)}catch{c=!1}const h=`
    You are a Video Continuity Editor & Storyboard Artist.
    The user has uploaded an image that represents the **LAST FRAME** of the previous shot.
    Your goal is to generate the Video Prompt for the **NEXT SHOT** that seamlessly continues the story from this image, based on the provided [SCRIPT].

    [INPUT DATA]
    1. **Uploaded Image (Last Frame)**: The visual starting point.
    2. **Original Prompt (Placeholder)**: "${n}"
    3. **Shot Context**: ${r}
    4. **Full Script**: 
    """
    ${o.substring(0,1e4)}... (Script truncated for length)
    """
    5. **User Instruction**: "${i||"None"}" (Highest Priority if provided)

    [TASK: SCENE MATCHING & PREDICTION]
    1. **ANALYZE IMAGE**: Look at the characters (who is there?), their emotions, the location, and the current action in the image.
    2. **LOCATE IN SCRIPT**: Find the matching scene in the [Full Script] where this visual state occurs.
    3. **PREDICT NEXT ACTION**: Based on the script, what happens **IMMEDIATELY AFTER** this moment?
       - If the image shows someone raising a hand -> Next is slapping or putting it down? (Check Script)
       - If the image shows someone shouting -> Next is the other person's reaction? (Check Script)
    4. **GENERATE PROMPT**: Write a video prompt that depicts this **NEXT ACTION**.

    [INSTRUCTIONS]
    1. **CONTINUITY IS KING**: The new shot must start visually consistent with the uploaded image (Same location, same lighting, same clothes), but evolve into the next action.
    2. **SCRIPT FIDELITY**: The action and dialogue MUST follow the script's sequence.
    3. **PREVENT HALLUCINATIONS**: 
       - Do not invent new characters or props not in the script.
       - **CRITICAL**: Observe the emotions and attitudes of surrounding characters in the image. Do NOT change them unless the script explicitly says so.
       - **LOGIC CHECK**: If a character is angry/threatening in the image, they should NOT suddenly become polite or submissive.
       - **ACTION CHECK**: If the script says "Stands up", do NOT write "Bows down".
       - **FACE VISIBILITY RULE**: 
         - **AVOID**: "Character turns back to camera", "Back of head view".
         - **REASON**: The user wants to see the character's facial expression to maintain emotional continuity.
         - **REQUIRED**: Ensure the camera angle captures the character's face (Profile, 3/4 View, or Front), even if they are turning away (e.g., "Turning away but looking back over shoulder").
         - **EXCEPTION**: Only use "Back view" if the script EXPLICITLY says "We see her back" or "She walks away into the distance".

    [FORMATTING RULES]
    1. **Language**: Visuals in ENGLISH, Dialogue in KOREAN.
    2. **Dialogue Tag**: Use "[KOREAN DIALOGUE]" tag.
    3. **Structure**: [Visual Setup] + [Next Action from Script] + [KOREAN DIALOGUE] "Script Dialogue" + [Reaction].

    [OUTPUT FORMAT]
    ${c?`**CRITICAL: INPUT IS JSON, OUTPUT MUST BE JSON**
       The input "Original Prompt" was a JSON string. You MUST return a VALID JSON string with the EXACT SAME keys.
       1. **prompt**: Update this field with the refined **ENGLISH** prompt (keeping Korean dialogue inside).
          - Content: Describe the scene starting from the image state and moving to the NEXT script action.
          - **IMPORTANT**: If the scene has dialogue, you MUST include it inside the 'prompt' field as well, using the format: (Dialogue: "...")
       2. **dialogue**: Extract the **NEXT LINE** of dialogue from the script (if any) corresponding to this new action.
          - Update this field to START with "[KOREAN DIALOGUE]". 
          - **Example**: "[KOREAN DIALOGUE] ."
       3. **Other fields**: Keep them EXACTLY as they are.
       4. Return ONLY the JSON string. No markdown formatting.`:`Return ONLY the updated ENGLISH prompt string. Do not output JSON.
       Format: "[Start State (English)]. [Action (English)]. [KOREAN DIALOGUE] "Dialogue". [Reaction/Result (English)]."`}
  `;try{const g=((m=(await s.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:a[1],data:a[2]}},{text:h}]},config:{safetySettings:gi,responseMimeType:c?"application/json":"text/plain"}})).text)==null?void 0:m.trim())||n;if(c&&d){let E={...d};try{const x=JSON.parse(g);typeof x=="object"&&x!==null&&(E=x)}catch{console.warn("AI did not return JSON, using text as prompt field"),E.prompt=g}if(d.dialogue){const x=d.dialogue.replace("[KOREAN DIALOGUE]","").trim();E.dialogue=`[KOREAN DIALOGUE] ${x}`}return E.prompt||(E.prompt=n),JSON.stringify(E,null,2)}return g}catch(p){return console.error("Prompt refinement failed",p),n}},PC=async(t,e)=>{const n=ht(t),r=`
     **   **.
        **(Story) 100% **, ** (Line Break)** **(Verb)**   ** (Rephrasing)  10** .

    []
    "${e}"

    [  - "(Twist)" ]
    1. **/  **:    , ,    .
       -  "  ",   "  "  . ( "" ""   )
    2. ** (Line Break) **: 
       -   , (/)     .
       - : "A / B  / C " -> "B  A / C  / "
    3. **/ **:
       -     . ( ->  ->  /  ->  -> )
    4. **  **:      .

    [ ]
    : " /     /   "
    
     1: "   /   /   / " (/ )
     2: "  /   /    / " ( )
     3: "   /   /   /   " ( )
     4: "  /    /   / " ( /)

    [ ]
    **JSON   .**
    : ["  1", "  2", ...]
  `;try{const i=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:r}]},config:{responseMimeType:"application/json"}})).text||"[]",s=Gn(i);return Array.isArray(s)?s:typeof s=="object"&&Array.isArray(s.variations)?s.variations:[]}catch(o){return console.error("Text variation generation failed",o),[]}},OC={gender:[{label:"",value:"Male"},{label:"",value:"Female"}],class:[{label:" ()",value:"Seonbi (Joseon Scholar), noble, silk robes"},{label:"/",value:"Bandit, rough appearance, wild, animal skins"},{label:"/",value:"King of Joseon, Red Royal Robe (Gonryongpo)"},{label:"/",value:"Queen of Joseon, Royal ceremonial dress"},{label:"/",value:"General, Warrior, Military uniform (Cheollik)"},{label:"/",value:"Merchant, Peddler, carrying bundle on back"},{label:"",value:"Buddhist Monk, grey robes"},{label:"/",value:"Peasant, Commoner, White hemp clothes"},{label:"",value:"Gisaeng, colorful Hanbok, artistic"},{label:"",value:"Shaman (Mudang), colorful ritual clothing"},{label:"/",value:"Magistrate (Sato), Official uniform"},{label:"// ()",value:"Pojol (Joseon Constable), This character wears a traditional black *gat* hat with a subtle sheen, featuring a black braided band, a thinner reddish-brown braided band, and a gold-colored finial on top. On the right side, vibrant multi-colored ribbons in dark blue, emerald green, bright yellow, rich red, and a lighter blue/purple, along with bright yellow tassels, are attached. His dark hair is neatly styled, likely in a topknot under the hat as traditional, with a clean hairline. The visible clothing includes a pure white *jeogori* (top), covered by a deep charcoal grey or black long outer robe and an inner vest-like garment of the same color, both featuring a very subtle, fine, dark grey patterned texture. A striking, vibrant red sash is tied at the waist with long ends hanging down. The bottom garment consists of pure white, loose-fitting *baji* (trousers)"},{label:"",value:"Grim Reaper (Jeoseung Saja), Black Hanbok, Black Gat"},{label:"/",value:"Mother figure, modest Hanbok"},{label:"/",value:"Father figure, traditional Hanbok"}],race:[{label:"",value:"Human"},{label:" (/)",value:"Anthropomorphic Animal, Humanoid body, Wearing Hanbok, Furry, Standing on two legs"},{label:" (//)",value:"Pure Animal, Realistic Creature, Walking on four legs, No clothes, No human features, Full fur"},{label:"",value:"Dokkaebi (Korean Goblin), holding club"},{label:"",value:"Gumiho (Nine-tailed Fox)"},{label:"",value:"Virgin Ghost (Cheonyeo Gwishin), white Sobok, messy hair"},{label:" (/)",value:"Tiger Spirit, anthropomorphic"},{label:" (//)",value:"Dragon King (Turtle spirit)"}],hair:[{label:" ( )",value:"Sangtu (Topknot) with Manggeon headband"},{label:" ()",value:"Daenggi-meori (Long Braid)"},{label:"  ()",value:"Half-tied hair with Manggeon ( )"},{label:" (/)",value:"Half-tied hair (No Manggeon), wild style"},{label:"  (/)",value:"Short Bob Hair (Danbal), rough cut"},{label:" (/)",value:"Shaggy Dog Hair (Deobeok-meori), messy and unkempt"},{label:"   ()",value:"Binyeo Bun (Low bun with silver hairpin)"},{label:"  ()",value:"Grey hair Sangtu (Topknot)"},{label:"   ()",value:"Grey hair Binyeo Bun"},{label:"  ()",value:"Gisaeng Gache (Large ornate wig)"},{label:"/ ",value:"Court Lady Gache (Rounded wig)"},{label:" ()",value:"Daesu-meori (Royal ceremonial wig with gold)"},{label:"  (/)",value:"Loose long black hair"},{label:" ()",value:"Wild messy hair"}],headwear:[{label:" ",value:"None"},{label:" (  )",value:"Gat (Black translucent horsehair hat)"},{label:" ()",value:"Jeongjagwan (Indoor scholar hat)"},{label:" ()",value:"Paeraengi (Bamboo hat)"},{label:" ()",value:"Jeonrip (Military hat with peacock feather)"},{label:" ()",value:"Ikseongwan (King black cap)"},{label:" ()",value:"Samo (Official black cap with wings)"},{label:" ( )",value:"Jokduri (Wedding headpiece)"},{label:" ()",value:"Jeonmo (Wide hat with butterfly decorations)"},{label:" ()",value:"Satgat (Conical straw hat)"},{label:" ()",value:"Nambawi (Winter cap)"}],outer:[{label:"  ()",value:"None"},{label:" ()",value:"Dopo (Scholar Robe with wide sleeves)"},{label:"",value:"Durumagi (Overcoat)"},{label:" ()",value:"Cheollik (Military Robe with pleated skirt)"},{label:"/",value:"Kwaeja (Long Vest)"},{label:" ( )",value:"Jangot (Coat worn over head)"},{label:"/ ()",value:"Hwarot/Wonsam (Ceremonial Robe)"},{label:" ()",value:"Sobok (White mourning clothes)"}],top:[{label:" ",value:"Jeogori (Traditional Jacket, curved sleeves)"},{label:" ",value:"Samhwejang Jeogori (Colorful cuffs and collar)"},{label:" ",value:"Saekdong Jeogori (Striped sleeves)"},{label:" ( )",value:"Jeoksam (Hemp shirt)"}],bottom:[{label:"  ()",value:"Baji (Wide trousers tied at ankles)"},{label:"  ()",value:"Chima (Full volume Ankle-length skirt, showing shoes)"},{label:" ()",value:"Seuran-chima (Ankle-length Skirt with gold leaf pattern, showing shoes)"},{label:" ( )",value:"Short Chima (Working class)"}],shoes:[{label:" ( )",value:"Jipsin (Straw shoes, covering toes like loafers)"},{label:" ()",value:"Taasahye (Leather shoes with patterns)"},{label:" ( )",value:"Mokhwa (Black velvet boots)"},{label:" ()",value:"Kkot-sin (Flower embroidered shoes)"},{label:"",value:"Barefoot"}],accessories:[{label:"",value:"None"},{label:" ()",value:"Gombangdae (Long pipe)"},{label:"",value:"Foldable Fan"},{label:" ()",value:"Hwando (Korean Sword)"},{label:" ()",value:"Cloth Bundle/Backpack (Bojim)"},{label:"",value:"Bokjumeoni (Lucky pouch)"},{label:"",value:"Norigae (Pendant)"},{label:"",value:"Eunjangdo (Silver knife)"},{label:"",value:"Wooden Walking Stick"}],bg:[{label:"  (Green)",value:"Green Screen"},{label:"  (Blue)",value:"Blue Screen"},{label:" ",value:"Solid White"},{label:" ",value:"Solid Black"}]},MC=({onClose:t,initialName:e="",initialDesign:n,initialAge:r="30"})=>{var Y,pe,ve,fe,Se,He,ke,rt,mt,ct,vt,qe,an,H,de,re;const{apiKey:o,selectedStyle:i,setReferenceImages:s,referenceImages:a,setCharacters:c,characters:d,showToast:h,userOptions:m,addUserOption:p,removeUserOption:g}=yn(),[E,x]=ue.useState(e),[w,y]=ue.useState(r),[v,T]=ue.useState(null),[I,A]=ue.useState(""),[O,k]=ue.useState(""),[j,D]=ue.useState(null),[V,X]=ue.useState(!1),_=ue.useMemo(()=>{const B={...OC};return m&&Object.keys(m).forEach(U=>{const ee=U;B[ee]&&(B[ee]=[...B[ee],...m[ee]||[]])}),B},[m]),z=(B,U)=>{const ee=U.replace(/^\d+\.\s*/,"");T({category:B,label:ee}),A(""),k("")},N=B=>{var Ee;const U=(Ee=B.target.files)==null?void 0:Ee[0];if(!U)return;if(U.size>5*1024*1024){h("  5MB  .","warning");return}const ee=new FileReader;ee.onloadend=()=>{D(ee.result)},ee.readAsDataURL(U)},te=async()=>{if(!(!j||!v)){if(!o){h("API  .","warning");return}X(!0);try{const B=await pC(o,j,v.category);k(U=>(U?U+", ":"")+B),h("  .  .","success")}catch{h("  ","error")}finally{X(!1)}}},ge=()=>{if(v){if(!I.trim()||!O.trim()){h("    .","warning");return}p(v.category,{label:I,value:O}),T(null)}},[J,K]=ue.useState(""),[M,ce]=ue.useState({gender:(n==null?void 0:n.gender)||_.gender[0].value,class:(n==null?void 0:n.class)||_.class[0].value,race:(n==null?void 0:n.race)||_.race[0].value,hair:(n==null?void 0:n.hair)||_.hair[0].value,headwear:(n==null?void 0:n.headwear)||_.headwear[0].value,outer:(n==null?void 0:n.outer)||_.outer[0].value,top:(n==null?void 0:n.top)||_.top[0].value,bottom:(n==null?void 0:n.bottom)||_.bottom[0].value,shoes:(n==null?void 0:n.shoes)||_.shoes[0].value,accessories:(n==null?void 0:n.accessories)||_.accessories[0].value,clothingColor:(n==null?void 0:n.clothingColor)||"",backgroundColor:_.bg[0].value,extraDetails:(n==null?void 0:n.extraDetails)||"",scale:(n==null?void 0:n.scale)||90,optionFlags:(n==null?void 0:n.optionFlags)||{}}),[W,$]=ue.useState(!1),[Te,q]=ue.useState(!1),[Q,Me]=ue.useState(null),[Be,he]=ue.useState(null),[xe,be]=ue.useState([]),Le=B=>{x(B.name),y(B.age||"30");let U="";if(B.description&&B.description.includes("[Visual Analysis]")){const ee=B.description.split("[Visual Analysis]");if(ee.length>1){const Ee=ee[1].split("[Basic Info]")[0].trim();Ee&&(U=Ee)}}else B.description&&(U=B.description);ce(ee=>({...ee,extraDetails:U})),B.visualGuide,U?h(`'${B.name}'  .   ' ' .`,"success"):h(`'${B.name}'  . (   )`,"info")},it=B=>{const U=a==null?void 0:a.find(ee=>ee.name===B.name);if(U&&U.imageUrl){if(he(U.imageUrl),Le(B),U.design){const ee=U.design;let Ee=ee.gender||"Male";Ee.includes("Male")&&(Ee="Male"),Ee.includes("Female")&&(Ee="Female"),ce(Ce=>({...Ce,...ee,gender:Ee,optionFlags:ee.optionFlags||Ce.optionFlags}))}h(`'${B.name}'  .       !`,"success")}else h(`'${B.name}'   .`,"warning")};ue.useEffect(()=>{},[M.gender,w]);const Ve=(B,U)=>{ce(ee=>({...ee,[B]:U}))},S=B=>{var Ee;const U=(Ee=B.target.files)==null?void 0:Ee[0];if(!U)return;if(U.size>5*1024*1024){h("  5MB  .","warning");return}const ee=new FileReader;ee.onloadend=()=>{he(ee.result)},ee.readAsDataURL(U)},ie=async()=>{if(!E.trim())return h("  ","warning");if(!w.trim())return h(" ","warning");if(!o)return h("API  ","warning");$(!0);try{const B={...M,gender:`${w} year old ${M.gender}`},U=await NC(o,B,i,J,Be||void 0);Me(U),be(ee=>[U,...ee]),h(" .   .","success")}catch(B){h(B.message,"error")}finally{$(!1)}},Z=async()=>{if(!(!Q||!E)){if(!o)return h("API  .","warning");q(!0);try{h("AI      ...","info");let B="";try{B=await ag(o,Q)}catch(De){console.error("Image analysis failed",De),B="   (  )"}const U=`${w} ${M.class}. ${M.hair}, ${M.headwear}. ${M.facialFeatures?`(: ${M.facialFeatures}) `:""}${M.extraDetails}`,Ee=B&&!B.includes("")?B:U,Ce=d.some(De=>De.name===E);let Ae=E;s(De=>[...De.filter(Re=>Re.name!==E),{id:`ref-${Date.now()}`,name:E,imageUrl:Q,description:Ee,design:{...M,gender:`${w} year old ${M.gender}`}}]),c(De=>{const Oe=De.findIndex(Re=>Re.name===E);if(Oe>=0){const Re=[...De];return Re[Oe]={...Re[Oe],description:Ee,age:w,gender:M.gender},Re}else return[...De,{id:`char-builder-${Date.now()}`,name:E,description:Ee,visualGuide:"AI     ( )",age:w,gender:M.gender,hasDialogue:!0,chromaKeyColor:"green",actions:[]}]}),h(`'${E}'  . (   )`,"success"),t()}catch(B){h("   .","error"),console.error(B)}finally{q(!1)}}},R=(B,U)=>{window.confirm(`'${U}'   ?`)&&g(B,U)},b=(B,U,ee)=>{B.stopPropagation(),window.confirm(` '${ee}'  ?
(     )`)&&(c(Ee=>Ee.filter(Ce=>Ce.id!==U)),s(Ee=>Ee.filter(Ce=>Ce.name!==ee)),h(`'${ee}'  .`,"success"),E===ee&&x(""))},F=(B,U)=>((m==null?void 0:m[B])||[]).some(Ee=>Ee.label===U),se=(B,U)=>{ce(ee=>{const Ee=ee.optionFlags||{},Ce=Ee[B]||{enabled:!0,isMandatory:!1};return{...ee,optionFlags:{...Ee,[B]:{...Ce,[U]:!Ce[U]}}}})},oe=(B,U,ee,Ee)=>{var Oe;const Ce=((Oe=M.optionFlags)==null?void 0:Oe[U])||{enabled:!0,isMandatory:!1},Ae=Ce.enabled,De=Ce.isMandatory;return u.jsxs("div",{className:`flex flex-col gap-1 transition-opacity ${Ae?"":"opacity-50"}`,children:[u.jsxs("div",{className:"flex justify-between items-end",children:[u.jsx("label",{className:"text-xs text-slate-400 font-bold",children:B}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("button",{onClick:()=>se(U,"enabled"),className:`text-[10px] px-2 py-0.5 rounded border font-bold ${Ae?"bg-indigo-600 text-white border-indigo-500":"bg-slate-700 text-slate-400 border-slate-600"}`,title:Ae?"  (AI )":"  (AI    -   )",children:Ae?"ON":"OFF"}),u.jsx("button",{onClick:()=>se(U,"isMandatory"),disabled:!Ae,className:`text-[10px] px-2 py-0.5 rounded border font-bold ${De?"bg-red-600 text-white border-red-500":"bg-slate-700 text-slate-400 border-slate-600"} ${Ae?"":"opacity-0 cursor-default"}`,title:"   ( )",children:De?"":""}),u.jsx("button",{onClick:()=>z(Ee||U,B),className:"text-[10px] text-indigo-400 hover:text-indigo-300 flex items-center gap-1 bg-indigo-900/30 px-2 py-0.5 rounded border border-indigo-500/30",title:"  ",children:u.jsx("i",{className:"fas fa-plus"})})]})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("select",{value:typeof M[U]=="string"?M[U]:"",onChange:Re=>Ve(U,Re.target.value),disabled:!Ae,className:"bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-indigo-500 flex-grow disabled:bg-slate-800 disabled:text-slate-500",children:ee.map((Re,le)=>u.jsxs("option",{value:Re.value,children:[Re.label," ",F(Ee||U,Re.label)?"( )":""]},le))}),(()=>{var le;const Re=(le=ee.find(Ue=>Ue.value===M[U]))==null?void 0:le.label;return Re&&F(Ee||U,Re)?u.jsx("button",{onClick:()=>R(Ee||U,Re),className:"bg-red-900/30 text-red-400 border border-red-500/30 px-2 rounded hover:bg-red-900/50",title:"   ",children:u.jsx("i",{className:"fas fa-trash"})}):null})()]})]})};return u.jsxs("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-fade-in overflow-hidden",children:[v&&u.jsx("div",{className:"fixed inset-0 z-[150] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:u.jsxs("div",{className:"bg-slate-800 p-6 rounded-xl border border-slate-600 shadow-2xl w-full max-w-md animate-fade-in",children:[u.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-plus-circle text-indigo-400"})," '",v.label,"'  "]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"  (  )"}),u.jsx("input",{type:"text",value:I,onChange:B=>A(B.target.value),placeholder:":  ( 9)",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white focus:ring-indigo-500",autoFocus:!0})]}),u.jsxs("div",{className:"bg-slate-900/50 p-3 rounded border border-slate-700",children:[u.jsxs("label",{className:"block text-xs font-bold text-indigo-400 mb-2 flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-camera"}),"    ()"]}),u.jsxs("div",{className:"flex gap-3 items-center",children:[j?u.jsxs("div",{className:"relative h-16 w-16 bg-black rounded overflow-hidden border border-slate-600 flex-shrink-0",children:[u.jsx("img",{src:j,alt:"Option Ref",className:"h-full w-full object-cover"}),u.jsx("button",{onClick:()=>D(null),className:"absolute inset-0 bg-black/50 flex items-center justify-center text-white opacity-0 hover:opacity-100 transition-opacity",children:u.jsx("i",{className:"fas fa-times"})})]}):u.jsxs("label",{className:"cursor-pointer h-16 w-16 bg-slate-800 rounded border border-dashed border-slate-600 flex items-center justify-center text-slate-500 hover:text-white hover:border-indigo-500 transition-colors flex-shrink-0",children:[u.jsx("i",{className:"fas fa-plus"}),u.jsx("input",{type:"file",accept:"image/*",onChange:N,className:"hidden"})]}),u.jsxs("div",{className:"flex-grow",children:[u.jsx("p",{className:"text-[10px] text-slate-500 mb-2 leading-relaxed",children:"       AI    ."}),u.jsxs("button",{onClick:te,disabled:!j||V,className:`w-full py-2 rounded text-xs font-bold flex items-center justify-center gap-2 ${j?"bg-indigo-600 hover:bg-indigo-500 text-white":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,children:[V?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-magic"}),V?" ...":"    "]})]})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"AI   (  )"}),u.jsx("textarea",{value:O,onChange:B=>k(B.target.value),placeholder:":  9  ,  ,  ,    (  )",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white focus:ring-indigo-500 h-24 resize-none"}),u.jsx("p",{className:"text-[10px] text-slate-500 mt-1",children:"   AI    ."})]}),u.jsxs("div",{className:"flex gap-2 pt-2",children:[u.jsx("button",{onClick:()=>T(null),className:"flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-lg font-bold",children:""}),u.jsx("button",{onClick:ge,className:"flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-lg font-bold",children:""})]})]})]})}),u.jsxs("div",{className:"bg-slate-800 w-full max-w-6xl h-[90vh] rounded-2xl border border-slate-600 shadow-2xl flex flex-col md:flex-row overflow-hidden",children:[u.jsxs("div",{className:"w-full md:w-1/2 p-6 overflow-y-auto border-r border-slate-700 custom-scrollbar bg-slate-800 z-10",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-user-edit text-indigo-400"}),"   "]}),u.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white",children:u.jsx("i",{className:"fas fa-times text-xl"})})]}),d&&d.length>0&&u.jsxs("div",{className:"mb-6 bg-slate-900/50 p-3 rounded-lg border border-slate-700",children:[u.jsxs("label",{className:"text-xs text-indigo-400 font-bold block mb-2 flex items-center gap-1",children:[u.jsx("i",{className:"fas fa-users"}),"   (  )"]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(B=>u.jsxs("div",{className:"relative group",children:[u.jsxs("button",{onClick:()=>{Le(B),B.isGroup&&h(`'${B.name}'() /.       . (  '  ' )`,"info")},className:`px-3 py-1.5 rounded-full text-xs font-bold transition-all border shadow-sm pr-14 flex items-center gap-1
                                    ${E===B.name?"bg-indigo-600 text-white border-indigo-400 ring-2 ring-indigo-400/50":B.isGroup?"bg-slate-800 text-slate-400 border-slate-700 hover:bg-slate-700 hover:text-slate-200 border-dashed":"bg-slate-700 text-slate-300 border-slate-600 hover:bg-slate-600 hover:text-white"}`,children:[B.isGroup&&u.jsx("i",{className:"fas fa-users text-[10px] opacity-70"}),B.name]}),u.jsxs("div",{className:"absolute right-1 top-1/2 -translate-y-1/2 flex gap-1",children:[u.jsx("button",{onClick:U=>{U.stopPropagation(),it(B)},className:"w-5 h-5 rounded-full bg-slate-800 text-slate-400 hover:text-indigo-400 hover:bg-slate-900 border border-slate-600 flex items-center justify-center transition-colors",title:"     (/ )",children:u.jsx("i",{className:"fas fa-edit text-[9px]"})}),u.jsx("button",{onClick:U=>b(U,B.id,B.name),className:"w-5 h-5 rounded-full bg-slate-800 text-slate-400 hover:text-red-400 hover:bg-slate-900 border border-slate-600 flex items-center justify-center transition-colors",title:"  ( )",children:u.jsx("i",{className:"fas fa-trash text-[9px]"})})]})]},B.id))}),u.jsxs("p",{className:"text-[10px] text-slate-500 mt-2",children:[u.jsx("i",{className:"fas fa-info-circle"}),"  ()       ."]})]}),n&&u.jsxs("div",{className:"mb-4 bg-indigo-900/40 border border-indigo-500/50 p-3 rounded-lg flex items-center gap-3",children:[u.jsx("i",{className:"fas fa-robot text-indigo-300 text-xl"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-indigo-200 text-sm font-bold",children:"AI   "}),u.jsx("p",{className:"text-xs text-indigo-400",children:"   , ,   ."})]})]}),u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"text-sm font-bold text-slate-300 block mb-2",children:"  ( )"}),u.jsx("input",{type:"text",value:E,onChange:B=>x(B.target.value),placeholder:": , ",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white focus:ring-indigo-500 font-bold text-lg"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"col-span-2 flex gap-4",children:[u.jsxs("div",{className:`flex-1 transition-opacity ${((pe=(Y=M.optionFlags)==null?void 0:Y.gender)==null?void 0:pe.enabled)===!1?"opacity-50":""}`,children:[u.jsxs("div",{className:"flex justify-between items-end",children:[u.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"1. "}),u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("button",{onClick:()=>se("gender","enabled"),className:`text-[10px] px-2 py-0.5 rounded border font-bold ${((fe=(ve=M.optionFlags)==null?void 0:ve.gender)==null?void 0:fe.enabled)!==!1?"bg-indigo-600 text-white border-indigo-500":"bg-slate-700 text-slate-400 border-slate-600"}`,title:((He=(Se=M.optionFlags)==null?void 0:Se.gender)==null?void 0:He.enabled)!==!1?" ":" ",children:((rt=(ke=M.optionFlags)==null?void 0:ke.gender)==null?void 0:rt.enabled)!==!1?"ON":"OFF"}),u.jsx("button",{onClick:()=>se("gender","isMandatory"),disabled:((ct=(mt=M.optionFlags)==null?void 0:mt.gender)==null?void 0:ct.enabled)===!1,className:`text-[10px] px-2 py-0.5 rounded border font-bold ${(qe=(vt=M.optionFlags)==null?void 0:vt.gender)!=null&&qe.isMandatory?"bg-red-600 text-white border-red-500":"bg-slate-700 text-slate-400 border-slate-600"}`,title:"  ",children:(H=(an=M.optionFlags)==null?void 0:an.gender)!=null&&H.isMandatory?"":""}),u.jsx("button",{onClick:()=>z("gender",""),className:"text-[10px] text-indigo-400 hover:text-indigo-300 flex items-center gap-1 bg-indigo-900/30 px-2 py-0.5 rounded border border-indigo-500/30",title:"   ",children:u.jsx("i",{className:"fas fa-plus"})})]})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("select",{value:M.gender,onChange:B=>Ve("gender",B.target.value),disabled:((re=(de=M.optionFlags)==null?void 0:de.gender)==null?void 0:re.enabled)===!1,className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white disabled:bg-slate-800 disabled:text-slate-500",children:_.gender.map((B,U)=>u.jsxs("option",{value:B.value,children:[B.label," ",F("gender",B.label)?"()":""]},U))}),(()=>{const B=_.gender.find(U=>U.value===M.gender);return B&&F("gender",B.label)?u.jsx("button",{onClick:()=>R("gender",B.label),className:"bg-red-900/30 text-red-400 border border-red-500/30 px-2 rounded hover:bg-red-900/50",title:"  ",children:u.jsx("i",{className:"fas fa-trash"})}):null})()]})]}),u.jsxs("div",{className:"flex-1",children:[u.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:" ( )"}),u.jsx("input",{type:"number",value:w,onChange:B=>y(B.target.value),placeholder:": 60",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white"})]})]}),oe("2. /","class",_.class),oe("3. ","race",_.race),!(M.race.includes("Pure Animal")||M.race.includes(" ("))&&u.jsxs(u.Fragment,{children:[oe("4.  ","hair",_.hair),oe("5. /","headwear",_.headwear),oe("6. ","outer",_.outer),oe("7. ","top",_.top),oe("8. ","bottom",_.bottom),oe("9. ","shoes",_.shoes),oe("10. /","accessories",_.accessories)]})]}),!(M.race.includes("Pure Animal")||M.race.includes(" ("))&&u.jsxs("div",{className:"space-y-2",children:[u.jsx("label",{className:"text-xs text-slate-400 font-bold",children:"11.   ( )"}),u.jsx("input",{type:"text",value:M.clothingColor,onChange:B=>Ve("clothingColor",B.target.value),placeholder:":    ,  ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx("label",{className:"text-xs text-slate-400 font-bold",children:"12.   (:  )"}),u.jsx("input",{type:"text",value:M.facialFeatures||"",onChange:B=>Ve("facialFeatures",B.target.value),placeholder:":  , , ,  , ...",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-yellow-500"})]}),u.jsxs("div",{className:"space-y-2 bg-indigo-900/20 p-3 rounded border border-indigo-500/30",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("label",{className:"text-xs text-indigo-300 font-bold flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-plus-circle"}),"   /  ()"]}),u.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(M.extraDetails),h(" .","success")},className:"text-[10px] text-indigo-400 hover:text-indigo-200 flex items-center gap-1 px-2 py-1 rounded bg-indigo-900/50 border border-indigo-500/30 transition-all",title:" ",children:[u.jsx("i",{className:"fas fa-copy"})," "]})]}),u.jsx("textarea",{value:M.extraDetails,onChange:B=>Ve("extraDetails",B.target.value),placeholder:":    ,  ,  ,  ...",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white h-16 focus:ring-indigo-500 resize-none"})]}),u.jsxs("div",{className:"space-y-2 bg-yellow-900/10 p-3 rounded border border-yellow-500/30",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("label",{className:"text-xs text-yellow-400 font-bold flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-ruler-vertical"}),"  /   (Scale)"]}),u.jsxs("span",{className:"text-xs font-bold text-yellow-200",children:[M.scale||90,"%"]})]}),u.jsx("input",{type:"range",min:"30",max:"100",step:"5",value:M.scale||90,onChange:B=>{const U=parseInt(B.target.value);Ve("scale",U)},className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-yellow-500"}),u.jsxs("p",{className:"text-[10px] text-slate-400 flex justify-between",children:[u.jsx("span",{children:" ()"}),u.jsx("span",{children:" ()"}),u.jsx("span",{children:" "})]}),u.jsxs("p",{className:"text-[10px] text-slate-400 mt-1",children:[" ",u.jsx("strong",{children:"30-40%"}),": , ",u.jsx("strong",{children:"80-90%"}),": , ",u.jsx("strong",{children:"100%"}),": "]})]}),u.jsxs("div",{className:"space-y-2 bg-red-900/10 p-3 rounded border border-red-500/30",children:[u.jsxs("label",{className:"text-xs text-red-400 font-bold flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-ban"}),"  /  (  )"]}),u.jsx("input",{type:"text",value:J,onChange:B=>K(B.target.value),placeholder:": , ,  , , , ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-red-500 placeholder-slate-500"}),u.jsxs("p",{className:"text-[10px] text-slate-400",children:["    AI ",u.jsx("strong",{children:'"   !"'}),"  ."]})]}),u.jsxs("div",{className:"space-y-2 bg-indigo-900/20 p-3 rounded border border-indigo-500/30",children:[u.jsxs("label",{className:"text-xs text-indigo-300 font-bold flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-image"}),"    (/ )"]}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsxs("label",{className:"cursor-pointer bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded border border-slate-600 flex items-center gap-2 text-sm",children:[u.jsx("i",{className:"fas fa-upload"}),"  ",u.jsx("input",{type:"file",accept:"image/*",onChange:S,className:"hidden"})]}),Be&&u.jsxs("div",{className:"relative h-16 w-16 bg-black rounded border border-slate-600 overflow-hidden group",children:[u.jsx("img",{src:Be,alt:"Reference",className:"h-full w-full object-cover"}),u.jsx("button",{onClick:()=>he(null),className:"absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center text-red-400",children:u.jsx("i",{className:"fas fa-trash"})})]})]}),u.jsx("p",{className:"text-[10px] text-slate-400",children:" , ,     AI   ."})]}),oe("13.  ()","backgroundColor",_.bg,"bg"),u.jsxs("button",{onClick:ie,disabled:W,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 mt-4",children:[W?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-paint-brush"}),"  "]})]})]}),u.jsxs("div",{className:"w-full md:w-1/2 bg-black flex flex-col relative h-full",children:[u.jsxs("div",{className:"p-4 flex-grow flex flex-col items-center justify-center overflow-hidden",children:[u.jsx("h3",{className:"text-slate-500 font-bold mb-4 absolute top-6 left-6",children:""}),u.jsxs("div",{className:"w-full max-w-sm aspect-[9/16] bg-slate-900 rounded-lg overflow-hidden border border-slate-700 flex items-center justify-center mb-4 relative shadow-2xl",children:[Q?u.jsx("img",{src:Q,alt:"Preview",className:"w-full h-full object-contain"}):u.jsxs("div",{className:"text-center text-slate-600",children:[u.jsx("i",{className:"fas fa-user-circle text-6xl mb-4 opacity-50"}),u.jsxs("p",{children:["  ",u.jsx("br",{}),"  ."]})]}),W&&u.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center backdrop-blur-sm",children:u.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-indigo-500"})})]}),Q&&u.jsxs("div",{className:"flex gap-4 w-full max-w-sm",children:[u.jsx("button",{onClick:Z,disabled:Te,className:`flex-1 text-white py-3 rounded-lg font-bold shadow-lg transform hover:scale-105 transition-all ${Te?"bg-slate-600 cursor-not-allowed":"bg-green-600 hover:bg-green-500"}`,children:Te?u.jsxs("span",{children:[u.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"    ..."]}):u.jsxs("span",{children:[u.jsx("i",{className:"fas fa-check-circle mr-2"}),"    ()"]})}),u.jsx("a",{href:Q,download:`${E}_reference.png`,className:"bg-slate-800 hover:bg-slate-700 text-white px-4 py-3 rounded-lg border border-slate-600",children:u.jsx("i",{className:"fas fa-download"})})]})]}),u.jsxs("div",{className:"bg-slate-900 border-t border-slate-700 p-4 h-48 flex-shrink-0 flex flex-col",children:[u.jsxs("p",{className:"text-xs text-slate-400 mb-2 font-bold flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-history text-indigo-400"}),"     (",xe.length,")",u.jsx("span",{className:"text-[10px] font-normal text-slate-500 ml-auto",children:" "})]}),xe.length===0?u.jsx("div",{className:"flex-grow flex items-center justify-center text-slate-600 text-xs border border-dashed border-slate-700 rounded-lg",children:"   ."}):u.jsx("div",{className:"flex gap-3 overflow-x-auto overflow-y-hidden pb-2 custom-scrollbar px-1 h-full items-center",children:xe.map((B,U)=>u.jsx("div",{onClick:()=>Me(B),className:`flex-shrink-0 w-20 h-28 rounded-lg overflow-hidden cursor-pointer border-2 transition-all hover:scale-105 shadow-lg ${Q===B?"border-indigo-500 ring-2 ring-indigo-500/50 scale-105":"border-slate-700 hover:border-slate-500 opacity-70 hover:opacity-100"}`,children:u.jsx("img",{src:B,alt:`History ${U}`,className:"w-full h-full object-cover"})},U))})]})]})]})]})},Wi={types:[{label:" ",value:"Object"},{label:"/ ",value:"Evidence"},{label:" (/ )",value:"Weapon"},{label:" (/ )",value:"Accessory"},{label:"/ ",value:"Furniture"}],materials:[{label:" (Wood)",value:"Wooden"},{label:"/ (Metal)",value:"Metal, Iron, Steel"},{label:" (Gold)",value:"Gold"},{label:" (Silver)",value:"Silver"},{label:" (Jade)",value:"Jade"},{label:"/ (Fabric)",value:"Fabric, Silk, Cotton"},{label:" (Paper)",value:"Paper"},{label:" (Ceramic)",value:"Ceramic, Porcelain"},{label:" (Stone)",value:"Stone"}],colors:[{label:"/",value:"Natural"},{label:" (Red)",value:"Red"},{label:" (Blue)",value:"Blue"},{label:" (Black)",value:"Black"},{label:" (White)",value:"White"},{label:" (Gold)",value:"Gold"},{label:" (Silver)",value:"Silver"},{label:" (Green)",value:"Green"}]},LC=({onClose:t,initialName:e=""})=>{const{apiKey:n,selectedStyle:r,setProps:o,showToast:i}=yn(),[s,a]=ue.useState(e),[c,d]=ue.useState(Wi.types[0].value),[h,m]=ue.useState(""),[p,g]=ue.useState(""),[E,x]=ue.useState(""),[w,y]=ue.useState(!1),[v,T]=ue.useState(null),[I,A]=ue.useState(null),[O,k]=ue.useState([]),j=X=>{var N;const _=(N=X.target.files)==null?void 0:N[0];if(!_)return;if(_.size>5*1024*1024){i("  5MB  .","warning");return}const z=new FileReader;z.onloadend=()=>{A(z.result)},z.readAsDataURL(_)},D=async()=>{if(!s.trim())return i("  ","warning");if(!E.trim()&&!I)return i("     .","warning");if(!n)return i("API  ","warning");y(!0);try{let X=`Type: ${c}.
`;p&&(X+=`Color: ${p}.
`),h&&(X+=`Material: ${h}.
`),X+=`Details: ${E}`;const _=await wC(n,s,X,r,I||void 0);T(_),k(z=>[_,...z]),i(" .   .","success")}catch(X){i(X.message,"error")}finally{y(!1)}},V=()=>{if(!v||!s)return;const X=`${p} ${h} ${s}. ${E}`;o(_=>[..._,{id:`prop-builder-${Date.now()}`,name:s,imageUrl:v,description:X,type:"object"}]),i(`'${s}'  !`,"success"),t()};return u.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-fade-in overflow-hidden",children:u.jsxs("div",{className:"bg-slate-800 w-full max-w-6xl h-[90vh] rounded-2xl border border-slate-600 shadow-2xl flex flex-col md:flex-row overflow-hidden",children:[u.jsxs("div",{className:"w-full md:w-1/2 p-6 overflow-y-auto border-r border-slate-700 custom-scrollbar bg-slate-800 z-10",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-cube text-amber-500"}),"   "]}),u.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white",children:u.jsx("i",{className:"fas fa-times text-xl"})})]}),u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"text-sm font-bold text-slate-300 block mb-2",children:" "}),u.jsx("input",{type:"text",value:s,onChange:X=>a(X.target.value),placeholder:": , , ",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white focus:ring-amber-500 font-bold text-lg"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"col-span-2",children:[u.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"1.  "}),u.jsx("select",{value:c,onChange:X=>d(X.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-amber-500",children:Wi.types.map((X,_)=>u.jsx("option",{value:X.value,children:X.label},_))})]}),u.jsxs("div",{children:[u.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"2.  (Color)"}),u.jsx("input",{type:"text",value:p,onChange:X=>g(X.target.value),placeholder:": , ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-amber-500",list:"color-options"}),u.jsx("datalist",{id:"color-options",children:Wi.colors.map((X,_)=>u.jsx("option",{value:X.label},_))})]}),u.jsxs("div",{children:[u.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"3.  (Material)"}),u.jsx("input",{type:"text",value:h,onChange:X=>m(X.target.value),placeholder:": , , ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-amber-500",list:"material-options"}),u.jsx("datalist",{id:"material-options",children:Wi.materials.map((X,_)=>u.jsx("option",{value:X.label},_))})]})]}),u.jsxs("div",{className:"space-y-2 bg-slate-900/50 p-3 rounded border border-slate-700",children:[u.jsxs("label",{className:"text-xs text-amber-400 font-bold flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-pen"}),"    (, )"]}),u.jsx("textarea",{value:E,onChange:X=>x(X.target.value),placeholder:":     ,     .   .",className:"w-full bg-slate-800 border border-slate-600 rounded p-2 text-sm text-white h-24 focus:ring-amber-500 resize-none"})]}),u.jsxs("div",{className:"space-y-2 bg-amber-900/20 p-3 rounded border border-amber-500/30",children:[u.jsxs("label",{className:"text-xs text-amber-300 font-bold flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-image"}),"    (/ )"]}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsxs("label",{className:"cursor-pointer bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded border border-slate-600 flex items-center gap-2 text-sm transition-colors",children:[u.jsx("i",{className:"fas fa-upload"}),"  ",u.jsx("input",{type:"file",accept:"image/*",onChange:j,className:"hidden"})]}),I&&u.jsxs("div",{className:"relative h-16 w-16 bg-black rounded border border-slate-600 overflow-hidden group",children:[u.jsx("img",{src:I,alt:"Reference",className:"h-full w-full object-cover"}),u.jsx("button",{onClick:()=>A(null),className:"absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center text-red-400",children:u.jsx("i",{className:"fas fa-trash"})})]})]}),u.jsx("p",{className:"text-[10px] text-slate-400",children:"   AI       ."})]}),u.jsxs("button",{onClick:D,disabled:w,className:"w-full bg-amber-600 hover:bg-amber-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 mt-4 transition-all hover:shadow-amber-500/20",children:[w?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-paint-brush"})," "]})]})]}),u.jsxs("div",{className:"w-full md:w-1/2 bg-black/50 p-6 flex flex-col relative",children:[u.jsx("div",{className:"flex-grow flex items-center justify-center relative bg-[url('/grid.png')]",children:v?u.jsxs("div",{className:"relative w-full max-w-md aspect-square shadow-2xl rounded-lg overflow-hidden border-2 border-slate-700 group",children:[u.jsx("img",{src:v,alt:"Preview",className:"w-full h-full object-contain bg-[#202020]"}),u.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 p-4 transform translate-y-full group-hover:translate-y-0 transition-transform",children:u.jsxs("button",{onClick:V,className:"w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg font-bold shadow-lg",children:[u.jsx("i",{className:"fas fa-check mr-2"}),"   "]})})]}):u.jsxs("div",{className:"text-center text-slate-500",children:[u.jsx("i",{className:"fas fa-cube text-6xl mb-4 opacity-20"}),u.jsx("p",{className:"text-lg",children:"  '' ."})]})}),O.length>0&&u.jsx("div",{className:"h-24 border-t border-slate-700 bg-slate-900/80 p-2 flex gap-2 overflow-x-auto custom-scrollbar mt-4",children:O.map((X,_)=>u.jsx("div",{onClick:()=>T(X),className:`aspect-square h-full rounded cursor-pointer border-2 overflow-hidden flex-shrink-0 ${v===X?"border-amber-500":"border-transparent opacity-50 hover:opacity-100"}`,children:u.jsx("img",{src:X,alt:`History ${_}`,className:"w-full h-full object-cover"})},_))})]})]})})},DC=({id:t,style:e,selected:n,onSelect:r})=>u.jsxs("div",{onClick:()=>r(t),className:`cursor-pointer rounded-xl p-4 border-2 transition-all h-full flex flex-col gap-2 relative overflow-hidden ${n?"border-indigo-500 bg-indigo-900/30 ring-2 ring-indigo-500/50":"border-slate-700 bg-slate-800 hover:border-slate-500"}`,children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("span",{className:`text-lg font-bold ${n?"text-indigo-300":"text-slate-200"}`,children:e.name}),n&&u.jsx("i",{className:"fas fa-check-circle text-indigo-400 text-xl"})]}),u.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:e.desc})]}),UC=({selected:t,onChange:e})=>{const n=[{id:"16:9",label:" (16:9)",icon:"fa-tv"},{id:"9:16",label:" (9:16)",icon:"fa-mobile-alt"},{id:"1:1",label:" (1:1)",icon:"fa-square"}];return u.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(r=>u.jsxs("button",{onClick:()=>e(r.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-2 border transition-all ${t===r.id?"bg-indigo-600 text-white border-indigo-500 shadow-md":"bg-slate-800 text-slate-400 border-slate-700 hover:bg-slate-700"}`,children:[u.jsx("i",{className:`fas ${r.icon}`}),r.label]},r.id))})},FC=({onAnalyze:t,isAnalyzing:e})=>{const{apiKey:n,script:r,scriptSegments:o,addScriptSegment:i,removeScriptSegment:s,clearScriptSegments:a,selectedStyle:c,setSelectedStyle:d,globalAspectRatio:h,setGlobalAspectRatio:m,isContinuityMode:p,setIsContinuityMode:g,referenceImages:E,setReferenceImages:x,characters:w,setCharacters:y,props:v,setProps:T,showToast:I,openModal:A}=yn(),[O,k]=ue.useState(!1),[j,D]=ue.useState(!1),[V,X]=ue.useState(null),[_,z]=ue.useState(""),[N,te]=ue.useState(""),ge=ue.useRef(null),J=ue.useRef(null),K=ue.useRef(null),M=ue.useRef(null),ce=()=>{var b;return(b=ge.current)==null?void 0:b.scrollIntoView({behavior:"smooth"})},W=()=>{var b;return(b=J.current)==null?void 0:b.scrollIntoView({behavior:"smooth"})},$=(b,F,se)=>{b.preventDefault(),b.stopPropagation(),A({type:"confirm",title:"  ",message:`'${se}'    ?
(   .)`,onConfirm:()=>{x(oe=>oe.filter(Y=>Y.id!==F)),I(".","success")}})},Te=()=>{K.current&&(K.current.value="",K.current.click())},q=b=>{var oe;const F=(oe=b.target.files)==null?void 0:oe[0];if(!F)return;if(F.size>5*1024*1024){I("   5MB  .","warning");return}const se=new FileReader;se.onload=async Y=>{var ve;const pe=(ve=Y.target)==null?void 0:ve.result;pe&&A({type:"prompt",title:"  ",message:"    (: )",confirmText:": AI ",onConfirm:async fe=>{if(fe&&fe.trim()){const Se=fe.trim();let He="Imported external character. (Auto-analysis failed)";if(n){I("AI    ...","success");try{He=await ag(n,pe)}catch(ke){console.error(ke),I(" .  .","error"),He=" .       ."}}A({type:"textarea",title:`${Se} /  ()`,message:`AI  . 
      ** **. 
 , ,     !`,defaultValue:He,confirmText:"  (  )",onConfirm:ke=>{const rt=ke||He;x(mt=>[...mt,{id:`ref-upload-${Date.now()}`,name:Se,imageUrl:pe,description:rt}]),y(mt=>{const ct=mt.findIndex(vt=>vt.name===Se);if(ct!==-1){const vt=[...mt];return vt[ct]={...vt[ct],description:rt,visualGuide:"   ( )"},vt}return[...mt,{id:`char-manual-${Date.now()}`,name:Se,description:rt,visualGuide:"   ( )",age:"",gender:"",hasDialogue:!0,chromaKeyColor:"green",actions:[]}]}),I(`'${Se}'   !`,"success")}})}}})},se.onerror=()=>{I("   .","error")},se.readAsDataURL(F)},Q=()=>{M.current&&(M.current.value="",M.current.click())},Me=b=>{var oe;const F=(oe=b.target.files)==null?void 0:oe[0];if(!F)return;if(F.size>5*1024*1024){I("   5MB  .","warning");return}const se=new FileReader;se.onload=async Y=>{var ve;const pe=(ve=Y.target)==null?void 0:ve.result;pe&&A({type:"prompt",title:"/  ",message:"    (: ,   )",confirmText:"",onConfirm:fe=>{if(fe&&fe.trim()){const Se=fe.trim();A({type:"textarea",title:`${Se}  `,message:`     .
(AI      .)`,defaultValue:"  , ,  ...",confirmText:"",onConfirm:He=>{T(ke=>[...ke,{id:`prop-upload-${Date.now()}`,name:Se,imageUrl:pe,description:He||" ",type:"object"}]),I(`'${Se}'  !`,"success")}})}}})},se.readAsDataURL(F)},Be=()=>{if(!n){I("API  .","warning");return}D(!0)},he=(b,F,se)=>{b.preventDefault(),b.stopPropagation(),A({type:"confirm",title:" ",message:`'${se}'  ?`,onConfirm:()=>{T(oe=>oe.filter(Y=>Y.id!==F)),I(".","success")}})},xe=()=>{A({type:"confirm",title:"  ",message:"  () ?",confirmText:"",onConfirm:()=>a()})},be=()=>{if(!_.trim()){I(" .","warning");return}const b=N.trim()||`Chapter ${o.length+1}`;i(b,_),z(""),te(""),I(`${b} !`,"success")},Le=(b,F)=>{navigator.clipboard.writeText(b),I(`'${F}'  .`,"success")},it=()=>{if(o.length===0)return;const b=o.map(F=>`[${F.title}]
${F.content}`).join(`

`);navigator.clipboard.writeText(b),I("  .","success")},[Ve,S]=ue.useState(30),ie=p&&o.length>0?o[o.length-1]:null,Z=ie?ie.content.length:r.length,R=ie?`  (${ie.title||" "}) `:`  (${o.length} ) `;return u.jsxs("div",{className:"space-y-10 animate-fade-in relative",children:[u.jsx("div",{ref:ge}),u.jsxs("div",{className:"fixed left-6 bottom-20 flex flex-col gap-2 z-50",children:[u.jsx("button",{onClick:ce,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:u.jsx("i",{className:"fas fa-arrow-up"})}),u.jsx("button",{onClick:W,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:u.jsx("i",{className:"fas fa-arrow-down"})})]}),u.jsxs("section",{className:"space-y-4",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[u.jsx("span",{className:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-sm",children:"1"}),"  ( )"]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("input",{type:"file",ref:K,onChange:q,accept:"image/*",className:"hidden"}),u.jsxs("button",{onClick:Te,className:"bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 border border-slate-600",children:[u.jsx("i",{className:"fas fa-upload"}),"   "]}),u.jsxs("button",{onClick:()=>k(!0),className:"bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 shadow-lg",children:[u.jsx("i",{className:"fas fa-plus"}),"  "]})]})]}),E.length===0?u.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 border-dashed rounded-xl p-6 text-center text-slate-500",children:[u.jsx("i",{className:"fas fa-users text-4xl mb-3 opacity-30"}),u.jsx("p",{children:"   ."})]}):u.jsx("div",{className:"flex gap-4 overflow-x-auto pt-2 pb-4 custom-scrollbar px-1",children:E.map(b=>u.jsxs("div",{className:"min-w-[180px] w-48 bg-slate-800 rounded-lg border border-slate-700 p-3 relative group hover:border-indigo-500 transition-colors",children:[u.jsx("button",{onClick:F=>$(F,b.id,b.name),className:"absolute top-2 right-2 bg-red-600 hover:bg-red-500 text-white w-7 h-7 rounded-full flex items-center justify-center shadow-lg z-20 opacity-0 group-hover:opacity-100 transition-opacity",title:"",children:u.jsx("i",{className:"fas fa-times text-xs"})}),u.jsxs("div",{className:"aspect-[9/16] bg-black rounded overflow-hidden mb-2 relative cursor-zoom-in",onClick:()=>X({url:b.imageUrl,title:b.name}),children:[u.jsx("img",{src:b.imageUrl,alt:b.name,className:"w-full h-full object-cover hover:scale-110 transition-transform duration-300"}),u.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:u.jsx("i",{className:"fas fa-search-plus text-white opacity-0 group-hover:opacity-100 text-2xl drop-shadow-lg transform scale-50 group-hover:scale-100 transition-all"})})]}),u.jsx("p",{className:"font-bold text-center text-white text-base truncate mb-2",children:b.name}),u.jsxs("div",{className:"flex gap-2 justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:[u.jsx("button",{onClick:F=>{F.stopPropagation(),A({type:"alert",title:`${b.name} AI  `,message:b.description||"  .",confirmText:"",showCopyButton:!0,onConfirm:()=>{}})},className:"bg-green-600 hover:bg-green-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg",title:"AI   ",children:u.jsx("i",{className:"fas fa-file-alt text-xs"})}),u.jsx("button",{onClick:F=>{F.stopPropagation(),K.current&&Te()},className:"bg-indigo-600 hover:bg-indigo-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg",title:" /",children:u.jsx("i",{className:"fas fa-sync-alt text-xs"})})]})]},b.id))})]}),u.jsxs("section",{className:"space-y-4",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[u.jsx("span",{className:"w-8 h-8 rounded-full bg-amber-600 flex items-center justify-center text-sm",children:"1.5"}),"  ( /)"]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("input",{type:"file",ref:M,onChange:Me,accept:"image/*",className:"hidden"}),u.jsxs("button",{onClick:Q,className:"bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 border border-slate-600",children:[u.jsx("i",{className:"fas fa-upload"}),"   "]}),u.jsxs("button",{onClick:Be,className:"bg-amber-600 hover:bg-amber-500 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 shadow-lg",children:[u.jsx("i",{className:"fas fa-cube"}),"  "]})]})]}),v.length===0?u.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 border-dashed rounded-xl p-6 text-center text-slate-500",children:[u.jsx("i",{className:"fas fa-box-open text-4xl mb-3 opacity-30"}),u.jsx("p",{children:"   . (: , ,   )"})]}):u.jsx("div",{className:"flex gap-4 overflow-x-auto pt-2 pb-4 custom-scrollbar px-1",children:v.map(b=>u.jsxs("div",{className:"min-w-[100px] w-28 bg-slate-800 rounded-lg border border-slate-700 p-2 relative group hover:border-amber-500 transition-colors",children:[u.jsxs("div",{className:"aspect-square bg-black rounded overflow-hidden mb-2 relative cursor-zoom-in",onClick:()=>X({url:b.imageUrl,title:b.name}),children:[u.jsx("img",{src:b.imageUrl,alt:b.name,className:"w-full h-full object-cover hover:scale-110 transition-transform duration-300"}),u.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:u.jsx("i",{className:"fas fa-search-plus text-white opacity-0 group-hover:opacity-100 text-lg drop-shadow-lg transform scale-50 group-hover:scale-100 transition-all"})})]}),u.jsx("p",{className:"font-bold text-center text-white text-xs truncate",children:b.name}),u.jsx("button",{onClick:F=>he(F,b.id,b.name),className:"absolute top-1 right-1 bg-red-600 hover:bg-red-500 text-white w-6 h-6 rounded-full flex items-center justify-center shadow-lg z-20 transition-transform active:scale-95",title:"",children:u.jsx("i",{className:"fas fa-times text-xs"})})]},b.id))})]}),u.jsxs("section",{className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[u.jsx("span",{className:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-sm",children:"2"}),"  ( )"]}),u.jsxs("div",{className:"text-slate-400 text-sm",children:["  : ",u.jsx("span",{className:"text-indigo-400 font-bold",children:r.length}),"  / ",o.length," "]})]}),u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[u.jsxs("div",{className:"bg-slate-800 p-5 rounded-xl border border-slate-700 shadow-lg flex flex-col h-full",children:[u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{className:"text-xs text-slate-400 font-bold block mb-1",children:"  ()"}),u.jsx("input",{type:"text",value:N,onChange:b=>te(b.target.value),placeholder:`Chapter ${o.length+1}`,className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-white focus:ring-indigo-500 text-sm"})]}),u.jsx("label",{className:"text-xs text-slate-400 font-bold block mb-1",children:" "}),u.jsx("textarea",{value:_,onChange:b=>z(b.target.value),placeholder:"    . (:    ...)",className:"w-full flex-grow min-h-[200px] bg-slate-900 text-base p-4 rounded-lg border border-slate-700 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 text-slate-100 placeholder-slate-500 resize-none mb-4"}),u.jsxs("button",{onClick:be,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-lg font-bold shadow-lg flex items-center justify-center gap-2 transition-all",children:[u.jsx("i",{className:"fas fa-plus-circle"}),"  "]})]}),u.jsxs("div",{className:"bg-slate-900/50 p-5 rounded-xl border border-slate-700 h-full flex flex-col",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsxs("h3",{className:"text-lg font-bold text-slate-200",children:[u.jsx("i",{className:"fas fa-list-ol mr-2 text-indigo-400"}),"  "]}),u.jsxs("div",{className:"flex gap-2",children:[o.length>0&&u.jsxs("button",{onClick:it,className:"text-xs text-green-400 hover:text-green-300 underline mr-2",children:[u.jsx("i",{className:"fas fa-copy mr-1"})," "]}),o.length>0&&u.jsx("button",{onClick:xe,className:"text-xs text-red-400 hover:text-red-300 underline",children:" "})]})]}),u.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-3 pr-2",style:{maxHeight:"400px"},children:o.length===0?u.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-600 opacity-50",children:[u.jsx("i",{className:"fas fa-book-open text-5xl mb-3"}),u.jsxs("p",{children:["  ",u.jsx("br",{}),"'' ."]})]}):o.map((b,F)=>u.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-600 relative group hover:border-indigo-500 transition-colors",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-xs font-bold text-indigo-300 bg-indigo-900/50 px-2 py-0.5 rounded uppercase",children:b.title||`Chapter ${F+1}`}),u.jsx("button",{onClick:()=>Le(b.content,b.title||`Chapter ${F+1}`),className:"text-slate-500 hover:text-green-400 p-1 transition-colors",title:" ",children:u.jsx("i",{className:"fas fa-copy"})})]}),u.jsx("button",{onClick:()=>s(b.id),className:"text-slate-500 hover:text-red-500 p-1",children:u.jsx("i",{className:"fas fa-trash-alt"})})]}),u.jsx("p",{className:"text-sm text-slate-300 line-clamp-3",children:b.content})]},b.id))})]})]})]}),u.jsxs("section",{className:"space-y-4",children:[u.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[u.jsx("span",{className:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-sm",children:"3"}),""]}),u.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700 mb-4",children:[u.jsxs("div",{className:"mb-2 font-bold text-slate-300 flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-crop-alt"}),"  "]}),u.jsx(UC,{selected:h,onChange:m})]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.keys(Tr).map(b=>u.jsx(DC,{id:b,style:Tr[b],selected:c===b,onSelect:d},b))})]}),u.jsxs("div",{className:"flex flex-col items-center gap-4 pt-8",children:[u.jsxs("label",{className:"flex items-center gap-3 bg-slate-800 px-6 py-3 rounded-full border border-slate-600 cursor-pointer hover:bg-slate-750 select-none",children:[u.jsx("input",{type:"checkbox",checked:p,onChange:b=>g(b.target.checked),className:"w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300"}),u.jsx("span",{className:"text-lg font-bold text-indigo-300",children:"  "}),u.jsx("span",{className:"text-xs text-slate-400 border-l border-slate-600 pl-3",children:"      ."})]}),o.length===0&&u.jsx("p",{className:"text-red-400 text-sm font-bold animate-pulse",children:"   !"}),u.jsxs("div",{className:"w-full max-w-3xl bg-slate-800/80 p-6 rounded-xl border-2 border-indigo-500/30 shadow-lg mb-4",children:[u.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-calculator text-indigo-400"}),"   (AI )"]}),u.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center items-center",children:[u.jsxs("div",{className:"bg-slate-900 p-4 rounded-lg border border-slate-700 flex flex-col items-center justify-center h-24",children:[u.jsx("div",{className:"text-xs text-slate-400 uppercase tracking-wider mb-1",children:"  "}),u.jsxs("div",{className:"text-2xl font-bold text-white",children:[Z.toLocaleString()," ",u.jsx("span",{className:"text-sm text-slate-500",children:""})]}),u.jsx("div",{className:"text-xs text-indigo-400 mt-1 truncate max-w-full px-2",children:R})]}),u.jsxs("div",{className:"flex flex-col justify-center items-center text-slate-500",children:[u.jsx("div",{className:"text-xs mb-1",children:""}),u.jsx("i",{className:"fas fa-divide text-2xl"})]}),u.jsxs("div",{className:"bg-slate-900 p-4 rounded-lg border border-indigo-500 flex flex-col items-center justify-center h-24 relative",children:[u.jsx("div",{className:"text-xs text-slate-400 uppercase tracking-wider mb-1",children:"   ()"}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("button",{onClick:()=>S(Math.max(1,Ve-1)),className:"w-6 h-6 rounded-full bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center text-xs",children:u.jsx("i",{className:"fas fa-minus"})}),u.jsx("input",{type:"number",value:Ve,onChange:b=>S(parseInt(b.target.value)||0),className:"w-16 bg-transparent border-b border-indigo-400 text-center text-2xl font-bold text-white focus:outline-none",min:"1"}),u.jsx("button",{onClick:()=>S(Ve+1),className:"w-6 h-6 rounded-full bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center text-xs",children:u.jsx("i",{className:"fas fa-plus"})})]})]})]}),u.jsxs("div",{className:"mt-4 bg-indigo-900/20 border border-indigo-500/50 rounded-lg p-4 flex flex-col md:flex-row items-center justify-between gap-4",children:[u.jsxs("div",{className:"text-left flex-1",children:[u.jsxs("div",{className:"text-sm text-indigo-300 font-bold mb-1",children:[u.jsx("i",{className:"fas fa-robot mr-1"}),"AI   "]}),u.jsxs("p",{className:"text-sm text-indigo-100 leading-relaxed",children:['"',u.jsx("b",{children:R}),"",u.jsx("br",{})," ",u.jsx("span",{className:"font-bold text-yellow-300 text-lg mx-1",children:Math.round(Z/Math.max(1,Ve)).toLocaleString()}),"   ",u.jsx("br",{})," ",u.jsx("b",{children:Ve}),'  ."']})]}),u.jsxs("div",{className:"text-right bg-black/30 p-3 rounded-lg min-w-[120px]",children:[u.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"  "}),u.jsxs("div",{className:"text-3xl font-bold text-yellow-400",children:[Math.round(Z/Math.max(1,Ve)).toLocaleString()," ",u.jsx("span",{className:"text-sm text-slate-400",children:""})]})]})]})]}),u.jsxs("button",{onClick:()=>{if(_.trim().length>0){alert(`     !

 [ ]       .`);return}t(Ve)},disabled:e,className:"bg-indigo-600 hover:bg-indigo-500 text-white text-xl font-bold px-12 py-5 rounded-full shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-3 w-full max-w-lg justify-center",children:[e?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-magic"}),e?" ...":"   /  "]})]}),V&&u.jsx("div",{className:"fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",onClick:()=>X(null),children:u.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh] flex flex-col items-center",children:[u.jsx("img",{src:V.url,alt:V.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl border border-slate-700",onClick:b=>b.stopPropagation()}),u.jsx("p",{className:"text-white font-bold text-xl mt-4 drop-shadow-md",children:V.title}),u.jsx("button",{onClick:()=>X(null),className:"absolute -top-12 right-0 text-slate-400 hover:text-white transition-colors",children:u.jsx("i",{className:"fas fa-times text-4xl"})})]})}),O&&u.jsx(MC,{onClose:()=>k(!1)}),j&&u.jsx(LC,{onClose:()=>D(!1)}),u.jsx("div",{ref:J})]})};function Yi(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var lg={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,o,i){function s(d,h){if(!o[d]){if(!r[d]){var m=typeof Yi=="function"&&Yi;if(!h&&m)return m(d,!0);if(a)return a(d,!0);var p=new Error("Cannot find module '"+d+"'");throw p.code="MODULE_NOT_FOUND",p}var g=o[d]={exports:{}};r[d][0].call(g.exports,function(E){var x=r[d][1][E];return s(x||E)},g,g.exports,n,r,o,i)}return o[d].exports}for(var a=typeof Yi=="function"&&Yi,c=0;c<i.length;c++)s(i[c]);return s}({1:[function(n,r,o){var i=n("./utils"),s=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(c){for(var d,h,m,p,g,E,x,w=[],y=0,v=c.length,T=v,I=i.getTypeOf(c)!=="string";y<c.length;)T=v-y,m=I?(d=c[y++],h=y<v?c[y++]:0,y<v?c[y++]:0):(d=c.charCodeAt(y++),h=y<v?c.charCodeAt(y++):0,y<v?c.charCodeAt(y++):0),p=d>>2,g=(3&d)<<4|h>>4,E=1<T?(15&h)<<2|m>>6:64,x=2<T?63&m:64,w.push(a.charAt(p)+a.charAt(g)+a.charAt(E)+a.charAt(x));return w.join("")},o.decode=function(c){var d,h,m,p,g,E,x=0,w=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var v,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=s.uint8array?new Uint8Array(0|T):new Array(0|T);x<c.length;)d=a.indexOf(c.charAt(x++))<<2|(p=a.indexOf(c.charAt(x++)))>>4,h=(15&p)<<4|(g=a.indexOf(c.charAt(x++)))>>2,m=(3&g)<<6|(E=a.indexOf(c.charAt(x++))),v[w++]=d,g!==64&&(v[w++]=h),E!==64&&(v[w++]=m);return v}},{"./support":30,"./utils":32}],2:[function(n,r,o){var i=n("./external"),s=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function d(h,m,p,g,E){this.compressedSize=h,this.uncompressedSize=m,this.crc32=p,this.compression=g,this.compressedContent=E}d.prototype={getContentWorker:function(){var h=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),m=this;return h.on("end",function(){if(this.streamInfo.data_length!==m.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(h,m,p){return h.pipe(new a).pipe(new c("uncompressedSize")).pipe(m.compressWorker(p)).pipe(new c("compressedSize")).withStreamInfo("compression",m)},r.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,o){var i=n("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},o.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,o){var i=n("./utils"),s=function(){for(var a,c=[],d=0;d<256;d++){a=d;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;c[d]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?i.getTypeOf(a)!=="string"?function(d,h,m,p){var g=s,E=p+m;d^=-1;for(var x=p;x<E;x++)d=d>>>8^g[255&(d^h[x])];return-1^d}(0|c,a,a.length,0):function(d,h,m,p){var g=s,E=p+m;d^=-1;for(var x=p;x<E;x++)d=d>>>8^g[255&(d^h.charCodeAt(x))];return-1^d}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(n,r,o){var i=null;i=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:i}},{lie:37}],7:[function(n,r,o){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),d=i?"uint8array":"array";function h(m,p){c.call(this,"FlateWorker/"+m),this._pako=null,this._pakoAction=m,this._pakoOptions=p,this.meta={}}o.magic="\b\0",a.inherits(h,c),h.prototype.processChunk=function(m){this.meta=m.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(d,m.data),!1)},h.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var m=this;this._pako.onData=function(p){m.push({data:p,meta:m.meta})}},o.compressWorker=function(m){return new h("Deflate",m)},o.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,o){function i(g,E){var x,w="";for(x=0;x<E;x++)w+=String.fromCharCode(255&g),g>>>=8;return w}function s(g,E,x,w,y,v){var T,I,A=g.file,O=g.compression,k=v!==d.utf8encode,j=a.transformTo("string",v(A.name)),D=a.transformTo("string",d.utf8encode(A.name)),V=A.comment,X=a.transformTo("string",v(V)),_=a.transformTo("string",d.utf8encode(V)),z=D.length!==A.name.length,N=_.length!==V.length,te="",ge="",J="",K=A.dir,M=A.date,ce={crc32:0,compressedSize:0,uncompressedSize:0};E&&!x||(ce.crc32=g.crc32,ce.compressedSize=g.compressedSize,ce.uncompressedSize=g.uncompressedSize);var W=0;E&&(W|=8),k||!z&&!N||(W|=2048);var $=0,Te=0;K&&($|=16),y==="UNIX"?(Te=798,$|=function(Q,Me){var Be=Q;return Q||(Be=Me?16893:33204),(65535&Be)<<16}(A.unixPermissions,K)):(Te=20,$|=function(Q){return 63&(Q||0)}(A.dosPermissions)),T=M.getUTCHours(),T<<=6,T|=M.getUTCMinutes(),T<<=5,T|=M.getUTCSeconds()/2,I=M.getUTCFullYear()-1980,I<<=4,I|=M.getUTCMonth()+1,I<<=5,I|=M.getUTCDate(),z&&(ge=i(1,1)+i(h(j),4)+D,te+="up"+i(ge.length,2)+ge),N&&(J=i(1,1)+i(h(X),4)+_,te+="uc"+i(J.length,2)+J);var q="";return q+=`
\0`,q+=i(W,2),q+=O.magic,q+=i(T,2),q+=i(I,2),q+=i(ce.crc32,4),q+=i(ce.compressedSize,4),q+=i(ce.uncompressedSize,4),q+=i(j.length,2),q+=i(te.length,2),{fileRecord:m.LOCAL_FILE_HEADER+q+j+te,dirRecord:m.CENTRAL_FILE_HEADER+i(Te,2)+q+i(X.length,2)+"\0\0\0\0"+i($,4)+i(w,4)+j+te+X}}var a=n("../utils"),c=n("../stream/GenericWorker"),d=n("../utf8"),h=n("../crc32"),m=n("../signature");function p(g,E,x,w){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=E,this.zipPlatform=x,this.encodeFileName=w,this.streamFiles=g,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(p,c),p.prototype.push=function(g){var E=g.meta.percent||0,x=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(g):(this.bytesWritten+=g.data.length,c.prototype.push.call(this,{data:g.data,meta:{currentFile:this.currentFile,percent:x?(E+100*(x-w-1))/x:100}}))},p.prototype.openedSource=function(g){this.currentSourceOffset=this.bytesWritten,this.currentFile=g.file.name;var E=this.streamFiles&&!g.file.dir;if(E){var x=s(g,E,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(g){this.accumulate=!1;var E=this.streamFiles&&!g.file.dir,x=s(g,E,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),E)this.push({data:function(w){return m.DATA_DESCRIPTOR+i(w.crc32,4)+i(w.compressedSize,4)+i(w.uncompressedSize,4)}(g),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var g=this.bytesWritten,E=0;E<this.dirRecords.length;E++)this.push({data:this.dirRecords[E],meta:{percent:100}});var x=this.bytesWritten-g,w=function(y,v,T,I,A){var O=a.transformTo("string",A(I));return m.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(y,2)+i(y,2)+i(v,4)+i(T,4)+i(O.length,2)+O}(this.dirRecords.length,x,g,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(g){this._sources.push(g);var E=this;return g.on("data",function(x){E.processChunk(x)}),g.on("end",function(){E.closedSource(E.previous.streamInfo),E._sources.length?E.prepareNextSource():E.end()}),g.on("error",function(x){E.error(x)}),this},p.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(g){var E=this._sources;if(!c.prototype.error.call(this,g))return!1;for(var x=0;x<E.length;x++)try{E[x].error(g)}catch{}return!0},p.prototype.lock=function(){c.prototype.lock.call(this);for(var g=this._sources,E=0;E<g.length;E++)g[E].lock()},r.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,o){var i=n("../compressions"),s=n("./ZipFileWorker");o.generateWorker=function(a,c,d){var h=new s(c.streamFiles,d,c.platform,c.encodeFileName),m=0;try{a.forEach(function(p,g){m++;var E=function(v,T){var I=v||T,A=i[I];if(!A)throw new Error(I+" is not a valid compression method !");return A}(g.options.compression,c.compression),x=g.options.compressionOptions||c.compressionOptions||{},w=g.dir,y=g.date;g._compressWorker(E,x).withStreamInfo("file",{name:p,dir:w,date:y,comment:g.comment||"",unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions}).pipe(h)}),h.entriesCount=m}catch(p){h.error(p)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,o){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var a in this)typeof this[a]!="function"&&(s[a]=this[a]);return s}}(i.prototype=n("./object")).loadAsync=n("./load"),i.support=n("./support"),i.defaults=n("./defaults"),i.version="3.10.1",i.loadAsync=function(s,a){return new i().loadAsync(s,a)},i.external=n("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,o){var i=n("./utils"),s=n("./external"),a=n("./utf8"),c=n("./zipEntries"),d=n("./stream/Crc32Probe"),h=n("./nodejsUtils");function m(p){return new s.Promise(function(g,E){var x=p.decompressed.getContentWorker().pipe(new d);x.on("error",function(w){E(w)}).on("end",function(){x.streamInfo.crc32!==p.decompressed.crc32?E(new Error("Corrupted zip : CRC32 mismatch")):g()}).resume()})}r.exports=function(p,g){var E=this;return g=i.extend(g||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(p)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",p,!0,g.optimizedBinaryString,g.base64).then(function(x){var w=new c(g);return w.load(x),w}).then(function(x){var w=[s.Promise.resolve(x)],y=x.files;if(g.checkCRC32)for(var v=0;v<y.length;v++)w.push(m(y[v]));return s.Promise.all(w)}).then(function(x){for(var w=x.shift(),y=w.files,v=0;v<y.length;v++){var T=y[v],I=T.fileNameStr,A=i.resolve(T.fileNameStr);E.file(A,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:g.createFolders}),T.dir||(E.file(A).unsafeOriginalName=I)}return w.zipComment.length&&(E.comment=w.zipComment),E})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,o){var i=n("../utils"),s=n("../stream/GenericWorker");function a(c,d){s.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(d)}i.inherits(a,s),a.prototype._bindStream=function(c){var d=this;(this._stream=c).pause(),c.on("data",function(h){d.push({data:h,meta:{percent:0}})}).on("error",function(h){d.isPaused?this.generatedError=h:d.error(h)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},a.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,o){var i=n("readable-stream").Readable;function s(a,c,d){i.call(this,c),this._helper=a;var h=this;a.on("data",function(m,p){h.push(m)||h._helper.pause(),d&&d(p)}).on("error",function(m){h.emit("error",m)}).on("end",function(){h.push(null)})}n("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(n,r,o){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(n,r,o){function i(A,O,k){var j,D=a.getTypeOf(O),V=a.extend(k||{},h);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(A=y(A)),V.createFolders&&(j=w(A))&&v.call(this,j,!0);var X=D==="string"&&V.binary===!1&&V.base64===!1;k&&k.binary!==void 0||(V.binary=!X),(O instanceof m&&O.uncompressedSize===0||V.dir||!O||O.length===0)&&(V.base64=!1,V.binary=!0,O="",V.compression="STORE",D="string");var _=null;_=O instanceof m||O instanceof c?O:E.isNode&&E.isStream(O)?new x(A,O):a.prepareContent(A,O,V.binary,V.optimizedBinaryString,V.base64);var z=new p(A,_,V);this.files[A]=z}var s=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),d=n("./stream/StreamHelper"),h=n("./defaults"),m=n("./compressedObject"),p=n("./zipObject"),g=n("./generate"),E=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),w=function(A){A.slice(-1)==="/"&&(A=A.substring(0,A.length-1));var O=A.lastIndexOf("/");return 0<O?A.substring(0,O):""},y=function(A){return A.slice(-1)!=="/"&&(A+="/"),A},v=function(A,O){return O=O!==void 0?O:h.createFolders,A=y(A),this.files[A]||i.call(this,A,null,{dir:!0,createFolders:O}),this.files[A]};function T(A){return Object.prototype.toString.call(A)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(A){var O,k,j;for(O in this.files)j=this.files[O],(k=O.slice(this.root.length,O.length))&&O.slice(0,this.root.length)===this.root&&A(k,j)},filter:function(A){var O=[];return this.forEach(function(k,j){A(k,j)&&O.push(j)}),O},file:function(A,O,k){if(arguments.length!==1)return A=this.root+A,i.call(this,A,O,k),this;if(T(A)){var j=A;return this.filter(function(V,X){return!X.dir&&j.test(V)})}var D=this.files[this.root+A];return D&&!D.dir?D:null},folder:function(A){if(!A)return this;if(T(A))return this.filter(function(D,V){return V.dir&&A.test(D)});var O=this.root+A,k=v.call(this,O),j=this.clone();return j.root=k.name,j},remove:function(A){A=this.root+A;var O=this.files[A];if(O||(A.slice(-1)!=="/"&&(A+="/"),O=this.files[A]),O&&!O.dir)delete this.files[A];else for(var k=this.filter(function(D,V){return V.name.slice(0,A.length)===A}),j=0;j<k.length;j++)delete this.files[k[j].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(A){var O,k={};try{if((k=a.extend(A||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");a.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var j=k.comment||this.comment||"";O=g.generateWorker(this,k,j)}catch(D){(O=new c("error")).error(D)}return new d(O,k.type||"string",k.mimeType)},generateAsync:function(A,O){return this.generateInternalStream(A).accumulate(O)},generateNodeStream:function(A,O){return(A=A||{}).type||(A.type="nodebuffer"),this.generateInternalStream(A).toNodejsStream(O)}};r.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,o){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,o){var i=n("./DataReader");function s(a){i.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(s,i),s.prototype.byteAt=function(a){return this.data[this.zero+a]},s.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),d=a.charCodeAt(1),h=a.charCodeAt(2),m=a.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===c&&this.data[p+1]===d&&this.data[p+2]===h&&this.data[p+3]===m)return p-this.zero;return-1},s.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),d=a.charCodeAt(1),h=a.charCodeAt(2),m=a.charCodeAt(3),p=this.readData(4);return c===p[0]&&d===p[1]&&h===p[2]&&m===p[3]},s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(n,r,o){var i=n("../utils");function s(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,d=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)d=(d<<8)+this.byteAt(c);return this.index+=a,d},readString:function(a){return i.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=s},{"../utils":32}],19:[function(n,r,o){var i=n("./Uint8ArrayReader");function s(a){i.call(this,a)}n("../utils").inherits(s,i),s.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,o){var i=n("./DataReader");function s(a){i.call(this,a)}n("../utils").inherits(s,i),s.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},s.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},s.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},s.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(n,r,o){var i=n("./ArrayReader");function s(a){i.call(this,a)}n("../utils").inherits(s,i),s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,o){var i=n("../utils"),s=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),d=n("./NodeBufferReader"),h=n("./Uint8ArrayReader");r.exports=function(m){var p=i.getTypeOf(m);return i.checkSupport(p),p!=="string"||s.uint8array?p==="nodebuffer"?new d(m):s.uint8array?new h(i.transformTo("uint8array",m)):new a(i.transformTo("array",m)):new c(m)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,o){var i=n("./GenericWorker"),s=n("../utils");function a(c){i.call(this,"ConvertWorker to "+c),this.destType=c}s.inherits(a,i),a.prototype.processChunk=function(c){this.push({data:s.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,o){var i=n("./GenericWorker"),s=n("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,i),a.prototype.processChunk=function(c){this.streamInfo.crc32=s(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,o){var i=n("../utils"),s=n("./GenericWorker");function a(c){s.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}i.inherits(a,s),a.prototype.processChunk=function(c){if(c){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+c.data.length}s.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,o){var i=n("../utils"),s=n("./GenericWorker");function a(c){s.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(h){d.dataIsReady=!0,d.data=h,d.max=h&&h.length||0,d.type=i.getTypeOf(h),d.isPaused||d._tickAndRepeat()},function(h){d.error(h)})}i.inherits(a,s),a.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,d);break;case"uint8array":c=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":c=this.data.slice(this.index,d)}return this.index=d,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,o){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,a){return this._listeners[s].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,a){if(this._listeners[s])for(var c=0;c<this._listeners[s].length;c++)this._listeners[s][c].call(this,a)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var a=this;return s.on("data",function(c){a.processChunk(c)}),s.on("end",function(){a.end()}),s.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,a){return this.extraStreamInfo[s]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},r.exports=i},{}],29:[function(n,r,o){var i=n("../utils"),s=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),d=n("../support"),h=n("../external"),m=null;if(d.nodestream)try{m=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(E,x){return new h.Promise(function(w,y){var v=[],T=E._internalType,I=E._outputType,A=E._mimeType;E.on("data",function(O,k){v.push(O),x&&x(k)}).on("error",function(O){v=[],y(O)}).on("end",function(){try{var O=function(k,j,D){switch(k){case"blob":return i.newBlob(i.transformTo("arraybuffer",j),D);case"base64":return c.encode(j);default:return i.transformTo(k,j)}}(I,function(k,j){var D,V=0,X=null,_=0;for(D=0;D<j.length;D++)_+=j[D].length;switch(k){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for(X=new Uint8Array(_),D=0;D<j.length;D++)X.set(j[D],V),V+=j[D].length;return X;case"nodebuffer":return Buffer.concat(j);default:throw new Error("concat : unsupported type '"+k+"'")}}(T,v),A);w(O)}catch(k){y(k)}v=[]}).resume()})}function g(E,x,w){var y=x;switch(x){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=x,this._mimeType=w,i.checkSupport(y),this._worker=E.pipe(new s(y)),E.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}g.prototype={accumulate:function(E){return p(this,E)},on:function(E,x){var w=this;return E==="data"?this._worker.on(E,function(y){x.call(w,y.data,y.meta)}):this._worker.on(E,function(){i.delay(x,arguments,w)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(E){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new m(this,{objectMode:this._outputType!=="nodebuffer"},E)}},r.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var i=new ArrayBuffer(0);try{o.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),o.blob=s.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!n("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,o){for(var i=n("./utils"),s=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),d=new Array(256),h=0;h<256;h++)d[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;d[254]=d[254]=1;function m(){c.call(this,"utf-8 decode"),this.leftOver=null}function p(){c.call(this,"utf-8 encode")}o.utf8encode=function(g){return s.nodebuffer?a.newBufferFrom(g,"utf-8"):function(E){var x,w,y,v,T,I=E.length,A=0;for(v=0;v<I;v++)(64512&(w=E.charCodeAt(v)))==55296&&v+1<I&&(64512&(y=E.charCodeAt(v+1)))==56320&&(w=65536+(w-55296<<10)+(y-56320),v++),A+=w<128?1:w<2048?2:w<65536?3:4;for(x=s.uint8array?new Uint8Array(A):new Array(A),v=T=0;T<A;v++)(64512&(w=E.charCodeAt(v)))==55296&&v+1<I&&(64512&(y=E.charCodeAt(v+1)))==56320&&(w=65536+(w-55296<<10)+(y-56320),v++),w<128?x[T++]=w:(w<2048?x[T++]=192|w>>>6:(w<65536?x[T++]=224|w>>>12:(x[T++]=240|w>>>18,x[T++]=128|w>>>12&63),x[T++]=128|w>>>6&63),x[T++]=128|63&w);return x}(g)},o.utf8decode=function(g){return s.nodebuffer?i.transformTo("nodebuffer",g).toString("utf-8"):function(E){var x,w,y,v,T=E.length,I=new Array(2*T);for(x=w=0;x<T;)if((y=E[x++])<128)I[w++]=y;else if(4<(v=d[y]))I[w++]=65533,x+=v-1;else{for(y&=v===2?31:v===3?15:7;1<v&&x<T;)y=y<<6|63&E[x++],v--;1<v?I[w++]=65533:y<65536?I[w++]=y:(y-=65536,I[w++]=55296|y>>10&1023,I[w++]=56320|1023&y)}return I.length!==w&&(I.subarray?I=I.subarray(0,w):I.length=w),i.applyFromCharCode(I)}(g=i.transformTo(s.uint8array?"uint8array":"array",g))},i.inherits(m,c),m.prototype.processChunk=function(g){var E=i.transformTo(s.uint8array?"uint8array":"array",g.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var x=E;(E=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),E.set(x,this.leftOver.length)}else E=this.leftOver.concat(E);this.leftOver=null}var w=function(v,T){var I;for((T=T||v.length)>v.length&&(T=v.length),I=T-1;0<=I&&(192&v[I])==128;)I--;return I<0||I===0?T:I+d[v[I]]>T?I:T}(E),y=E;w!==E.length&&(s.uint8array?(y=E.subarray(0,w),this.leftOver=E.subarray(w,E.length)):(y=E.slice(0,w),this.leftOver=E.slice(w,E.length))),this.push({data:o.utf8decode(y),meta:g.meta})},m.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=m,i.inherits(p,c),p.prototype.processChunk=function(g){this.push({data:o.utf8encode(g.data),meta:g.meta})},o.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,o){var i=n("./support"),s=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function d(x){return x}function h(x,w){for(var y=0;y<x.length;++y)w[y]=255&x.charCodeAt(y);return w}n("setimmediate"),o.newBlob=function(x,w){o.checkSupport("blob");try{return new Blob([x],{type:w})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(x),y.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var m={stringifyByChunk:function(x,w,y){var v=[],T=0,I=x.length;if(I<=y)return String.fromCharCode.apply(null,x);for(;T<I;)w==="array"||w==="nodebuffer"?v.push(String.fromCharCode.apply(null,x.slice(T,Math.min(T+y,I)))):v.push(String.fromCharCode.apply(null,x.subarray(T,Math.min(T+y,I)))),T+=y;return v.join("")},stringifyByChar:function(x){for(var w="",y=0;y<x.length;y++)w+=String.fromCharCode(x[y]);return w},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function p(x){var w=65536,y=o.getTypeOf(x),v=!0;if(y==="uint8array"?v=m.applyCanBeUsed.uint8array:y==="nodebuffer"&&(v=m.applyCanBeUsed.nodebuffer),v)for(;1<w;)try{return m.stringifyByChunk(x,y,w)}catch{w=Math.floor(w/2)}return m.stringifyByChar(x)}function g(x,w){for(var y=0;y<x.length;y++)w[y]=x[y];return w}o.applyFromCharCode=p;var E={};E.string={string:d,array:function(x){return h(x,new Array(x.length))},arraybuffer:function(x){return E.string.uint8array(x).buffer},uint8array:function(x){return h(x,new Uint8Array(x.length))},nodebuffer:function(x){return h(x,a.allocBuffer(x.length))}},E.array={string:p,array:d,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return a.newBufferFrom(x)}},E.arraybuffer={string:function(x){return p(new Uint8Array(x))},array:function(x){return g(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:d,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return a.newBufferFrom(new Uint8Array(x))}},E.uint8array={string:p,array:function(x){return g(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:d,nodebuffer:function(x){return a.newBufferFrom(x)}},E.nodebuffer={string:p,array:function(x){return g(x,new Array(x.length))},arraybuffer:function(x){return E.nodebuffer.uint8array(x).buffer},uint8array:function(x){return g(x,new Uint8Array(x.length))},nodebuffer:d},o.transformTo=function(x,w){if(w=w||"",!x)return w;o.checkSupport(x);var y=o.getTypeOf(w);return E[y][x](w)},o.resolve=function(x){for(var w=x.split("/"),y=[],v=0;v<w.length;v++){var T=w[v];T==="."||T===""&&v!==0&&v!==w.length-1||(T===".."?y.pop():y.push(T))}return y.join("/")},o.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":i.nodebuffer&&a.isBuffer(x)?"nodebuffer":i.uint8array&&x instanceof Uint8Array?"uint8array":i.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(x){if(!i[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(x){var w,y,v="";for(y=0;y<(x||"").length;y++)v+="\\x"+((w=x.charCodeAt(y))<16?"0":"")+w.toString(16).toUpperCase();return v},o.delay=function(x,w,y){setImmediate(function(){x.apply(y||null,w||[])})},o.inherits=function(x,w){function y(){}y.prototype=w.prototype,x.prototype=new y},o.extend=function(){var x,w,y={};for(x=0;x<arguments.length;x++)for(w in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],w)&&y[w]===void 0&&(y[w]=arguments[x][w]);return y},o.prepareContent=function(x,w,y,v,T){return c.Promise.resolve(w).then(function(I){return i.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new c.Promise(function(A,O){var k=new FileReader;k.onload=function(j){A(j.target.result)},k.onerror=function(j){O(j.target.error)},k.readAsArrayBuffer(I)}):I}).then(function(I){var A=o.getTypeOf(I);return A?(A==="arraybuffer"?I=o.transformTo("uint8array",I):A==="string"&&(T?I=s.decode(I):y&&v!==!0&&(I=function(O){return h(O,i.uint8array?new Uint8Array(O.length):new Array(O.length))}(I))),I):c.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,o){var i=n("./reader/readerFor"),s=n("./utils"),a=n("./signature"),c=n("./zipEntry"),d=n("./support");function h(m){this.files=[],this.loadOptions=m}h.prototype={checkSignature:function(m){if(!this.reader.readAndCheckSignature(m)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(p)+", expected "+s.pretty(m)+")")}},isSignature:function(m,p){var g=this.reader.index;this.reader.setIndex(m);var E=this.reader.readString(4)===p;return this.reader.setIndex(g),E},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var m=this.reader.readData(this.zipCommentLength),p=d.uint8array?"uint8array":"array",g=s.transformTo(p,m);this.zipComment=this.loadOptions.decodeFileName(g)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var m,p,g,E=this.zip64EndOfCentralSize-44;0<E;)m=this.reader.readInt(2),p=this.reader.readInt(4),g=this.reader.readData(p),this.zip64ExtensibleData[m]={id:m,length:p,value:g}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var m,p;for(m=0;m<this.files.length;m++)p=this.files[m],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var m;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(m=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(m);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var m=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(m<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(m);var p=m;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(m=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(m),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var g=this.centralDirOffset+this.centralDirSize;this.zip64&&(g+=20,g+=12+this.zip64EndOfCentralSize);var E=p-g;if(0<E)this.isSignature(p,a.CENTRAL_FILE_HEADER)||(this.reader.zero=E);else if(E<0)throw new Error("Corrupted zip: missing "+Math.abs(E)+" bytes.")},prepareReader:function(m){this.reader=i(m)},load:function(m){this.prepareReader(m),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,o){var i=n("./reader/readerFor"),s=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),d=n("./utf8"),h=n("./compressions"),m=n("./support");function p(g,E){this.options=g,this.loadOptions=E}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(g){var E,x;if(g.skip(22),this.fileNameLength=g.readInt(2),x=g.readInt(2),this.fileName=g.readData(this.fileNameLength),g.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((E=function(w){for(var y in h)if(Object.prototype.hasOwnProperty.call(h,y)&&h[y].magic===w)return h[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,E,g.readData(this.compressedSize))},readCentralPart:function(g){this.versionMadeBy=g.readInt(2),g.skip(2),this.bitFlag=g.readInt(2),this.compressionMethod=g.readString(2),this.date=g.readDate(),this.crc32=g.readInt(4),this.compressedSize=g.readInt(4),this.uncompressedSize=g.readInt(4);var E=g.readInt(2);if(this.extraFieldsLength=g.readInt(2),this.fileCommentLength=g.readInt(2),this.diskNumberStart=g.readInt(2),this.internalFileAttributes=g.readInt(2),this.externalFileAttributes=g.readInt(4),this.localHeaderOffset=g.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");g.skip(E),this.readExtraFields(g),this.parseZIP64ExtraField(g),this.fileComment=g.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var g=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),g==0&&(this.dosPermissions=63&this.externalFileAttributes),g==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var g=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=g.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=g.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=g.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=g.readInt(4))}},readExtraFields:function(g){var E,x,w,y=g.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});g.index+4<y;)E=g.readInt(2),x=g.readInt(2),w=g.readData(x),this.extraFields[E]={id:E,length:x,value:w};g.setIndex(y)},handleUTF8:function(){var g=m.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var E=this.findExtraFieldUnicodePath();if(E!==null)this.fileNameStr=E;else{var x=s.transformTo(g,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var y=s.transformTo(g,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var g=this.extraFields[28789];if(g){var E=i(g.value);return E.readInt(1)!==1||c(this.fileName)!==E.readInt(4)?null:d.utf8decode(E.readData(g.length-5))}return null},findExtraFieldUnicodeComment:function(){var g=this.extraFields[25461];if(g){var E=i(g.value);return E.readInt(1)!==1||c(this.fileComment)!==E.readInt(4)?null:d.utf8decode(E.readData(g.length-5))}return null}},r.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,o){function i(E,x,w){this.name=E,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=x,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var s=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),d=n("./compressedObject"),h=n("./stream/GenericWorker");i.prototype={internalStream:function(E){var x=null,w="string";try{if(!E)throw new Error("No output type specified.");var y=(w=E.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),x=this._decompressWorker();var v=!this._dataBinary;v&&!y&&(x=x.pipe(new c.Utf8EncodeWorker)),!v&&y&&(x=x.pipe(new c.Utf8DecodeWorker))}catch(T){(x=new h("error")).error(T)}return new s(x,w,"")},async:function(E,x){return this.internalStream(E).accumulate(x)},nodeStream:function(E,x){return this.internalStream(E||"nodebuffer").toNodejsStream(x)},_compressWorker:function(E,x){if(this._data instanceof d&&this._data.compression.magic===E.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new c.Utf8EncodeWorker)),d.createWorkerFrom(w,E,x)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var m=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},g=0;g<m.length;g++)i.prototype[m[g]]=p;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,o){(function(i){var s,a,c=i.MutationObserver||i.WebKitMutationObserver;if(c){var d=0,h=new c(E),m=i.document.createTextNode("");h.observe(m,{characterData:!0}),s=function(){m.data=d=++d%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var x=i.document.createElement("script");x.onreadystatechange=function(){E(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},i.document.documentElement.appendChild(x)}:function(){setTimeout(E,0)};else{var p=new i.MessageChannel;p.port1.onmessage=E,s=function(){p.port2.postMessage(0)}}var g=[];function E(){var x,w;a=!0;for(var y=g.length;y;){for(w=g,g=[],x=-1;++x<y;)w[x]();y=g.length}a=!1}r.exports=function(x){g.push(x)!==1||a||s()}}).call(this,typeof bn<"u"?bn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,o){var i=n("immediate");function s(){}var a={},c=["REJECTED"],d=["FULFILLED"],h=["PENDING"];function m(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,y!==s&&x(this,y)}function p(y,v,T){this.promise=y,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function g(y,v,T){i(function(){var I;try{I=v(T)}catch(A){return a.reject(y,A)}I===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,I)})}function E(y){var v=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof v=="function")return function(){v.apply(y,arguments)}}function x(y,v){var T=!1;function I(k){T||(T=!0,a.reject(y,k))}function A(k){T||(T=!0,a.resolve(y,k))}var O=w(function(){v(A,I)});O.status==="error"&&I(O.value)}function w(y,v){var T={};try{T.value=y(v),T.status="success"}catch(I){T.status="error",T.value=I}return T}(r.exports=m).prototype.finally=function(y){if(typeof y!="function")return this;var v=this.constructor;return this.then(function(T){return v.resolve(y()).then(function(){return T})},function(T){return v.resolve(y()).then(function(){throw T})})},m.prototype.catch=function(y){return this.then(null,y)},m.prototype.then=function(y,v){if(typeof y!="function"&&this.state===d||typeof v!="function"&&this.state===c)return this;var T=new this.constructor(s);return this.state!==h?g(T,this.state===d?y:v,this.outcome):this.queue.push(new p(T,y,v)),T},p.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},p.prototype.otherCallFulfilled=function(y){g(this.promise,this.onFulfilled,y)},p.prototype.callRejected=function(y){a.reject(this.promise,y)},p.prototype.otherCallRejected=function(y){g(this.promise,this.onRejected,y)},a.resolve=function(y,v){var T=w(E,v);if(T.status==="error")return a.reject(y,T.value);var I=T.value;if(I)x(y,I);else{y.state=d,y.outcome=v;for(var A=-1,O=y.queue.length;++A<O;)y.queue[A].callFulfilled(v)}return y},a.reject=function(y,v){y.state=c,y.outcome=v;for(var T=-1,I=y.queue.length;++T<I;)y.queue[T].callRejected(v);return y},m.resolve=function(y){return y instanceof this?y:a.resolve(new this(s),y)},m.reject=function(y){var v=new this(s);return a.reject(v,y)},m.all=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,I=!1;if(!T)return this.resolve([]);for(var A=new Array(T),O=0,k=-1,j=new this(s);++k<T;)D(y[k],k);return j;function D(V,X){v.resolve(V).then(function(_){A[X]=_,++O!==T||I||(I=!0,a.resolve(j,A))},function(_){I||(I=!0,a.reject(j,_))})}},m.race=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,I=!1;if(!T)return this.resolve([]);for(var A=-1,O=new this(s);++A<T;)k=y[A],v.resolve(k).then(function(j){I||(I=!0,a.resolve(O,j))},function(j){I||(I=!0,a.reject(O,j))});var k;return O}},{immediate:36}],38:[function(n,r,o){var i={};(0,n("./lib/utils/common").assign)(i,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,o){var i=n("./zlib/deflate"),s=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),d=n("./zlib/zstream"),h=Object.prototype.toString,m=0,p=-1,g=0,E=8;function x(y){if(!(this instanceof x))return new x(y);this.options=s.assign({level:p,method:E,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},y||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var T=i.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(T!==m)throw new Error(c[T]);if(v.header&&i.deflateSetHeader(this.strm,v.header),v.dictionary){var I;if(I=typeof v.dictionary=="string"?a.string2buf(v.dictionary):h.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(T=i.deflateSetDictionary(this.strm,I))!==m)throw new Error(c[T]);this._dict_set=!0}}function w(y,v){var T=new x(v);if(T.push(y,!0),T.err)throw T.msg||c[T.err];return T.result}x.prototype.push=function(y,v){var T,I,A=this.strm,O=this.options.chunkSize;if(this.ended)return!1;I=v===~~v?v:v===!0?4:0,typeof y=="string"?A.input=a.string2buf(y):h.call(y)==="[object ArrayBuffer]"?A.input=new Uint8Array(y):A.input=y,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new s.Buf8(O),A.next_out=0,A.avail_out=O),(T=i.deflate(A,I))!==1&&T!==m)return this.onEnd(T),!(this.ended=!0);A.avail_out!==0&&(A.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(s.shrinkBuf(A.output,A.next_out))):this.onData(s.shrinkBuf(A.output,A.next_out)))}while((0<A.avail_in||A.avail_out===0)&&T!==1);return I===4?(T=i.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===m):I!==2||(this.onEnd(m),!(A.avail_out=0))},x.prototype.onData=function(y){this.chunks.push(y)},x.prototype.onEnd=function(y){y===m&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},o.Deflate=x,o.deflate=w,o.deflateRaw=function(y,v){return(v=v||{}).raw=!0,w(y,v)},o.gzip=function(y,v){return(v=v||{}).gzip=!0,w(y,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,o){var i=n("./zlib/inflate"),s=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),d=n("./zlib/messages"),h=n("./zlib/zstream"),m=n("./zlib/gzheader"),p=Object.prototype.toString;function g(x){if(!(this instanceof g))return new g(x);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},x||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||x&&x.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var y=i.inflateInit2(this.strm,w.windowBits);if(y!==c.Z_OK)throw new Error(d[y]);this.header=new m,i.inflateGetHeader(this.strm,this.header)}function E(x,w){var y=new g(w);if(y.push(x,!0),y.err)throw y.msg||d[y.err];return y.result}g.prototype.push=function(x,w){var y,v,T,I,A,O,k=this.strm,j=this.options.chunkSize,D=this.options.dictionary,V=!1;if(this.ended)return!1;v=w===~~w?w:w===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof x=="string"?k.input=a.binstring2buf(x):p.call(x)==="[object ArrayBuffer]"?k.input=new Uint8Array(x):k.input=x,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new s.Buf8(j),k.next_out=0,k.avail_out=j),(y=i.inflate(k,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&D&&(O=typeof D=="string"?a.string2buf(D):p.call(D)==="[object ArrayBuffer]"?new Uint8Array(D):D,y=i.inflateSetDictionary(this.strm,O)),y===c.Z_BUF_ERROR&&V===!0&&(y=c.Z_OK,V=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&y!==c.Z_STREAM_END&&(k.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(k.output,k.next_out),I=k.next_out-T,A=a.buf2string(k.output,T),k.next_out=I,k.avail_out=j-I,I&&s.arraySet(k.output,k.output,T,I,0),this.onData(A)):this.onData(s.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(V=!0)}while((0<k.avail_in||k.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(y=i.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(k.avail_out=0))},g.prototype.onData=function(x){this.chunks.push(x)},g.prototype.onEnd=function(x){x===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},o.Inflate=g,o.inflate=E,o.inflateRaw=function(x,w){return(w=w||{}).raw=!0,E(x,w)},o.ungzip=E},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,o){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(c){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var h=d.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var m in h)h.hasOwnProperty(m)&&(c[m]=h[m])}}return c},o.shrinkBuf=function(c,d){return c.length===d?c:c.subarray?c.subarray(0,d):(c.length=d,c)};var s={arraySet:function(c,d,h,m,p){if(d.subarray&&c.subarray)c.set(d.subarray(h,h+m),p);else for(var g=0;g<m;g++)c[p+g]=d[h+g]},flattenChunks:function(c){var d,h,m,p,g,E;for(d=m=0,h=c.length;d<h;d++)m+=c[d].length;for(E=new Uint8Array(m),d=p=0,h=c.length;d<h;d++)g=c[d],E.set(g,p),p+=g.length;return E}},a={arraySet:function(c,d,h,m,p){for(var g=0;g<m;g++)c[p+g]=d[h+g]},flattenChunks:function(c){return[].concat.apply([],c)}};o.setTyped=function(c){c?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,s)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,a))},o.setTyped(i)},{}],42:[function(n,r,o){var i=n("./common"),s=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new i.Buf8(256),d=0;d<256;d++)c[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function h(m,p){if(p<65537&&(m.subarray&&a||!m.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(m,p));for(var g="",E=0;E<p;E++)g+=String.fromCharCode(m[E]);return g}c[254]=c[254]=1,o.string2buf=function(m){var p,g,E,x,w,y=m.length,v=0;for(x=0;x<y;x++)(64512&(g=m.charCodeAt(x)))==55296&&x+1<y&&(64512&(E=m.charCodeAt(x+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),x++),v+=g<128?1:g<2048?2:g<65536?3:4;for(p=new i.Buf8(v),x=w=0;w<v;x++)(64512&(g=m.charCodeAt(x)))==55296&&x+1<y&&(64512&(E=m.charCodeAt(x+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),x++),g<128?p[w++]=g:(g<2048?p[w++]=192|g>>>6:(g<65536?p[w++]=224|g>>>12:(p[w++]=240|g>>>18,p[w++]=128|g>>>12&63),p[w++]=128|g>>>6&63),p[w++]=128|63&g);return p},o.buf2binstring=function(m){return h(m,m.length)},o.binstring2buf=function(m){for(var p=new i.Buf8(m.length),g=0,E=p.length;g<E;g++)p[g]=m.charCodeAt(g);return p},o.buf2string=function(m,p){var g,E,x,w,y=p||m.length,v=new Array(2*y);for(g=E=0;g<y;)if((x=m[g++])<128)v[E++]=x;else if(4<(w=c[x]))v[E++]=65533,g+=w-1;else{for(x&=w===2?31:w===3?15:7;1<w&&g<y;)x=x<<6|63&m[g++],w--;1<w?v[E++]=65533:x<65536?v[E++]=x:(x-=65536,v[E++]=55296|x>>10&1023,v[E++]=56320|1023&x)}return h(v,E)},o.utf8border=function(m,p){var g;for((p=p||m.length)>m.length&&(p=m.length),g=p-1;0<=g&&(192&m[g])==128;)g--;return g<0||g===0?p:g+c[m[g]]>p?g:p}},{"./common":41}],43:[function(n,r,o){r.exports=function(i,s,a,c){for(var d=65535&i|0,h=i>>>16&65535|0,m=0;a!==0;){for(a-=m=2e3<a?2e3:a;h=h+(d=d+s[c++]|0)|0,--m;);d%=65521,h%=65521}return d|h<<16|0}},{}],44:[function(n,r,o){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,o){var i=function(){for(var s,a=[],c=0;c<256;c++){s=c;for(var d=0;d<8;d++)s=1&s?3988292384^s>>>1:s>>>1;a[c]=s}return a}();r.exports=function(s,a,c,d){var h=i,m=d+c;s^=-1;for(var p=d;p<m;p++)s=s>>>8^h[255&(s^a[p])];return-1^s}},{}],46:[function(n,r,o){var i,s=n("../utils/common"),a=n("./trees"),c=n("./adler32"),d=n("./crc32"),h=n("./messages"),m=0,p=4,g=0,E=-2,x=-1,w=4,y=2,v=8,T=9,I=286,A=30,O=19,k=2*I+1,j=15,D=3,V=258,X=V+D+1,_=42,z=113,N=1,te=2,ge=3,J=4;function K(S,ie){return S.msg=h[ie],ie}function M(S){return(S<<1)-(4<S?9:0)}function ce(S){for(var ie=S.length;0<=--ie;)S[ie]=0}function W(S){var ie=S.state,Z=ie.pending;Z>S.avail_out&&(Z=S.avail_out),Z!==0&&(s.arraySet(S.output,ie.pending_buf,ie.pending_out,Z,S.next_out),S.next_out+=Z,ie.pending_out+=Z,S.total_out+=Z,S.avail_out-=Z,ie.pending-=Z,ie.pending===0&&(ie.pending_out=0))}function $(S,ie){a._tr_flush_block(S,0<=S.block_start?S.block_start:-1,S.strstart-S.block_start,ie),S.block_start=S.strstart,W(S.strm)}function Te(S,ie){S.pending_buf[S.pending++]=ie}function q(S,ie){S.pending_buf[S.pending++]=ie>>>8&255,S.pending_buf[S.pending++]=255&ie}function Q(S,ie){var Z,R,b=S.max_chain_length,F=S.strstart,se=S.prev_length,oe=S.nice_match,Y=S.strstart>S.w_size-X?S.strstart-(S.w_size-X):0,pe=S.window,ve=S.w_mask,fe=S.prev,Se=S.strstart+V,He=pe[F+se-1],ke=pe[F+se];S.prev_length>=S.good_match&&(b>>=2),oe>S.lookahead&&(oe=S.lookahead);do if(pe[(Z=ie)+se]===ke&&pe[Z+se-1]===He&&pe[Z]===pe[F]&&pe[++Z]===pe[F+1]){F+=2,Z++;do;while(pe[++F]===pe[++Z]&&pe[++F]===pe[++Z]&&pe[++F]===pe[++Z]&&pe[++F]===pe[++Z]&&pe[++F]===pe[++Z]&&pe[++F]===pe[++Z]&&pe[++F]===pe[++Z]&&pe[++F]===pe[++Z]&&F<Se);if(R=V-(Se-F),F=Se-V,se<R){if(S.match_start=ie,oe<=(se=R))break;He=pe[F+se-1],ke=pe[F+se]}}while((ie=fe[ie&ve])>Y&&--b!=0);return se<=S.lookahead?se:S.lookahead}function Me(S){var ie,Z,R,b,F,se,oe,Y,pe,ve,fe=S.w_size;do{if(b=S.window_size-S.lookahead-S.strstart,S.strstart>=fe+(fe-X)){for(s.arraySet(S.window,S.window,fe,fe,0),S.match_start-=fe,S.strstart-=fe,S.block_start-=fe,ie=Z=S.hash_size;R=S.head[--ie],S.head[ie]=fe<=R?R-fe:0,--Z;);for(ie=Z=fe;R=S.prev[--ie],S.prev[ie]=fe<=R?R-fe:0,--Z;);b+=fe}if(S.strm.avail_in===0)break;if(se=S.strm,oe=S.window,Y=S.strstart+S.lookahead,pe=b,ve=void 0,ve=se.avail_in,pe<ve&&(ve=pe),Z=ve===0?0:(se.avail_in-=ve,s.arraySet(oe,se.input,se.next_in,ve,Y),se.state.wrap===1?se.adler=c(se.adler,oe,ve,Y):se.state.wrap===2&&(se.adler=d(se.adler,oe,ve,Y)),se.next_in+=ve,se.total_in+=ve,ve),S.lookahead+=Z,S.lookahead+S.insert>=D)for(F=S.strstart-S.insert,S.ins_h=S.window[F],S.ins_h=(S.ins_h<<S.hash_shift^S.window[F+1])&S.hash_mask;S.insert&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[F+D-1])&S.hash_mask,S.prev[F&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=F,F++,S.insert--,!(S.lookahead+S.insert<D)););}while(S.lookahead<X&&S.strm.avail_in!==0)}function Be(S,ie){for(var Z,R;;){if(S.lookahead<X){if(Me(S),S.lookahead<X&&ie===m)return N;if(S.lookahead===0)break}if(Z=0,S.lookahead>=D&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+D-1])&S.hash_mask,Z=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),Z!==0&&S.strstart-Z<=S.w_size-X&&(S.match_length=Q(S,Z)),S.match_length>=D)if(R=a._tr_tally(S,S.strstart-S.match_start,S.match_length-D),S.lookahead-=S.match_length,S.match_length<=S.max_lazy_match&&S.lookahead>=D){for(S.match_length--;S.strstart++,S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+D-1])&S.hash_mask,Z=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart,--S.match_length!=0;);S.strstart++}else S.strstart+=S.match_length,S.match_length=0,S.ins_h=S.window[S.strstart],S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+1])&S.hash_mask;else R=a._tr_tally(S,0,S.window[S.strstart]),S.lookahead--,S.strstart++;if(R&&($(S,!1),S.strm.avail_out===0))return N}return S.insert=S.strstart<D-1?S.strstart:D-1,ie===p?($(S,!0),S.strm.avail_out===0?ge:J):S.last_lit&&($(S,!1),S.strm.avail_out===0)?N:te}function he(S,ie){for(var Z,R,b;;){if(S.lookahead<X){if(Me(S),S.lookahead<X&&ie===m)return N;if(S.lookahead===0)break}if(Z=0,S.lookahead>=D&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+D-1])&S.hash_mask,Z=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),S.prev_length=S.match_length,S.prev_match=S.match_start,S.match_length=D-1,Z!==0&&S.prev_length<S.max_lazy_match&&S.strstart-Z<=S.w_size-X&&(S.match_length=Q(S,Z),S.match_length<=5&&(S.strategy===1||S.match_length===D&&4096<S.strstart-S.match_start)&&(S.match_length=D-1)),S.prev_length>=D&&S.match_length<=S.prev_length){for(b=S.strstart+S.lookahead-D,R=a._tr_tally(S,S.strstart-1-S.prev_match,S.prev_length-D),S.lookahead-=S.prev_length-1,S.prev_length-=2;++S.strstart<=b&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+D-1])&S.hash_mask,Z=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),--S.prev_length!=0;);if(S.match_available=0,S.match_length=D-1,S.strstart++,R&&($(S,!1),S.strm.avail_out===0))return N}else if(S.match_available){if((R=a._tr_tally(S,0,S.window[S.strstart-1]))&&$(S,!1),S.strstart++,S.lookahead--,S.strm.avail_out===0)return N}else S.match_available=1,S.strstart++,S.lookahead--}return S.match_available&&(R=a._tr_tally(S,0,S.window[S.strstart-1]),S.match_available=0),S.insert=S.strstart<D-1?S.strstart:D-1,ie===p?($(S,!0),S.strm.avail_out===0?ge:J):S.last_lit&&($(S,!1),S.strm.avail_out===0)?N:te}function xe(S,ie,Z,R,b){this.good_length=S,this.max_lazy=ie,this.nice_length=Z,this.max_chain=R,this.func=b}function be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*k),this.dyn_dtree=new s.Buf16(2*(2*A+1)),this.bl_tree=new s.Buf16(2*(2*O+1)),ce(this.dyn_ltree),ce(this.dyn_dtree),ce(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(j+1),this.heap=new s.Buf16(2*I+1),ce(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*I+1),ce(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Le(S){var ie;return S&&S.state?(S.total_in=S.total_out=0,S.data_type=y,(ie=S.state).pending=0,ie.pending_out=0,ie.wrap<0&&(ie.wrap=-ie.wrap),ie.status=ie.wrap?_:z,S.adler=ie.wrap===2?0:1,ie.last_flush=m,a._tr_init(ie),g):K(S,E)}function it(S){var ie=Le(S);return ie===g&&function(Z){Z.window_size=2*Z.w_size,ce(Z.head),Z.max_lazy_match=i[Z.level].max_lazy,Z.good_match=i[Z.level].good_length,Z.nice_match=i[Z.level].nice_length,Z.max_chain_length=i[Z.level].max_chain,Z.strstart=0,Z.block_start=0,Z.lookahead=0,Z.insert=0,Z.match_length=Z.prev_length=D-1,Z.match_available=0,Z.ins_h=0}(S.state),ie}function Ve(S,ie,Z,R,b,F){if(!S)return E;var se=1;if(ie===x&&(ie=6),R<0?(se=0,R=-R):15<R&&(se=2,R-=16),b<1||T<b||Z!==v||R<8||15<R||ie<0||9<ie||F<0||w<F)return K(S,E);R===8&&(R=9);var oe=new be;return(S.state=oe).strm=S,oe.wrap=se,oe.gzhead=null,oe.w_bits=R,oe.w_size=1<<oe.w_bits,oe.w_mask=oe.w_size-1,oe.hash_bits=b+7,oe.hash_size=1<<oe.hash_bits,oe.hash_mask=oe.hash_size-1,oe.hash_shift=~~((oe.hash_bits+D-1)/D),oe.window=new s.Buf8(2*oe.w_size),oe.head=new s.Buf16(oe.hash_size),oe.prev=new s.Buf16(oe.w_size),oe.lit_bufsize=1<<b+6,oe.pending_buf_size=4*oe.lit_bufsize,oe.pending_buf=new s.Buf8(oe.pending_buf_size),oe.d_buf=1*oe.lit_bufsize,oe.l_buf=3*oe.lit_bufsize,oe.level=ie,oe.strategy=F,oe.method=Z,it(S)}i=[new xe(0,0,0,0,function(S,ie){var Z=65535;for(Z>S.pending_buf_size-5&&(Z=S.pending_buf_size-5);;){if(S.lookahead<=1){if(Me(S),S.lookahead===0&&ie===m)return N;if(S.lookahead===0)break}S.strstart+=S.lookahead,S.lookahead=0;var R=S.block_start+Z;if((S.strstart===0||S.strstart>=R)&&(S.lookahead=S.strstart-R,S.strstart=R,$(S,!1),S.strm.avail_out===0)||S.strstart-S.block_start>=S.w_size-X&&($(S,!1),S.strm.avail_out===0))return N}return S.insert=0,ie===p?($(S,!0),S.strm.avail_out===0?ge:J):(S.strstart>S.block_start&&($(S,!1),S.strm.avail_out),N)}),new xe(4,4,8,4,Be),new xe(4,5,16,8,Be),new xe(4,6,32,32,Be),new xe(4,4,16,16,he),new xe(8,16,32,32,he),new xe(8,16,128,128,he),new xe(8,32,128,256,he),new xe(32,128,258,1024,he),new xe(32,258,258,4096,he)],o.deflateInit=function(S,ie){return Ve(S,ie,v,15,8,0)},o.deflateInit2=Ve,o.deflateReset=it,o.deflateResetKeep=Le,o.deflateSetHeader=function(S,ie){return S&&S.state?S.state.wrap!==2?E:(S.state.gzhead=ie,g):E},o.deflate=function(S,ie){var Z,R,b,F;if(!S||!S.state||5<ie||ie<0)return S?K(S,E):E;if(R=S.state,!S.output||!S.input&&S.avail_in!==0||R.status===666&&ie!==p)return K(S,S.avail_out===0?-5:E);if(R.strm=S,Z=R.last_flush,R.last_flush=ie,R.status===_)if(R.wrap===2)S.adler=0,Te(R,31),Te(R,139),Te(R,8),R.gzhead?(Te(R,(R.gzhead.text?1:0)+(R.gzhead.hcrc?2:0)+(R.gzhead.extra?4:0)+(R.gzhead.name?8:0)+(R.gzhead.comment?16:0)),Te(R,255&R.gzhead.time),Te(R,R.gzhead.time>>8&255),Te(R,R.gzhead.time>>16&255),Te(R,R.gzhead.time>>24&255),Te(R,R.level===9?2:2<=R.strategy||R.level<2?4:0),Te(R,255&R.gzhead.os),R.gzhead.extra&&R.gzhead.extra.length&&(Te(R,255&R.gzhead.extra.length),Te(R,R.gzhead.extra.length>>8&255)),R.gzhead.hcrc&&(S.adler=d(S.adler,R.pending_buf,R.pending,0)),R.gzindex=0,R.status=69):(Te(R,0),Te(R,0),Te(R,0),Te(R,0),Te(R,0),Te(R,R.level===9?2:2<=R.strategy||R.level<2?4:0),Te(R,3),R.status=z);else{var se=v+(R.w_bits-8<<4)<<8;se|=(2<=R.strategy||R.level<2?0:R.level<6?1:R.level===6?2:3)<<6,R.strstart!==0&&(se|=32),se+=31-se%31,R.status=z,q(R,se),R.strstart!==0&&(q(R,S.adler>>>16),q(R,65535&S.adler)),S.adler=1}if(R.status===69)if(R.gzhead.extra){for(b=R.pending;R.gzindex<(65535&R.gzhead.extra.length)&&(R.pending!==R.pending_buf_size||(R.gzhead.hcrc&&R.pending>b&&(S.adler=d(S.adler,R.pending_buf,R.pending-b,b)),W(S),b=R.pending,R.pending!==R.pending_buf_size));)Te(R,255&R.gzhead.extra[R.gzindex]),R.gzindex++;R.gzhead.hcrc&&R.pending>b&&(S.adler=d(S.adler,R.pending_buf,R.pending-b,b)),R.gzindex===R.gzhead.extra.length&&(R.gzindex=0,R.status=73)}else R.status=73;if(R.status===73)if(R.gzhead.name){b=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>b&&(S.adler=d(S.adler,R.pending_buf,R.pending-b,b)),W(S),b=R.pending,R.pending===R.pending_buf_size)){F=1;break}F=R.gzindex<R.gzhead.name.length?255&R.gzhead.name.charCodeAt(R.gzindex++):0,Te(R,F)}while(F!==0);R.gzhead.hcrc&&R.pending>b&&(S.adler=d(S.adler,R.pending_buf,R.pending-b,b)),F===0&&(R.gzindex=0,R.status=91)}else R.status=91;if(R.status===91)if(R.gzhead.comment){b=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>b&&(S.adler=d(S.adler,R.pending_buf,R.pending-b,b)),W(S),b=R.pending,R.pending===R.pending_buf_size)){F=1;break}F=R.gzindex<R.gzhead.comment.length?255&R.gzhead.comment.charCodeAt(R.gzindex++):0,Te(R,F)}while(F!==0);R.gzhead.hcrc&&R.pending>b&&(S.adler=d(S.adler,R.pending_buf,R.pending-b,b)),F===0&&(R.status=103)}else R.status=103;if(R.status===103&&(R.gzhead.hcrc?(R.pending+2>R.pending_buf_size&&W(S),R.pending+2<=R.pending_buf_size&&(Te(R,255&S.adler),Te(R,S.adler>>8&255),S.adler=0,R.status=z)):R.status=z),R.pending!==0){if(W(S),S.avail_out===0)return R.last_flush=-1,g}else if(S.avail_in===0&&M(ie)<=M(Z)&&ie!==p)return K(S,-5);if(R.status===666&&S.avail_in!==0)return K(S,-5);if(S.avail_in!==0||R.lookahead!==0||ie!==m&&R.status!==666){var oe=R.strategy===2?function(Y,pe){for(var ve;;){if(Y.lookahead===0&&(Me(Y),Y.lookahead===0)){if(pe===m)return N;break}if(Y.match_length=0,ve=a._tr_tally(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++,ve&&($(Y,!1),Y.strm.avail_out===0))return N}return Y.insert=0,pe===p?($(Y,!0),Y.strm.avail_out===0?ge:J):Y.last_lit&&($(Y,!1),Y.strm.avail_out===0)?N:te}(R,ie):R.strategy===3?function(Y,pe){for(var ve,fe,Se,He,ke=Y.window;;){if(Y.lookahead<=V){if(Me(Y),Y.lookahead<=V&&pe===m)return N;if(Y.lookahead===0)break}if(Y.match_length=0,Y.lookahead>=D&&0<Y.strstart&&(fe=ke[Se=Y.strstart-1])===ke[++Se]&&fe===ke[++Se]&&fe===ke[++Se]){He=Y.strstart+V;do;while(fe===ke[++Se]&&fe===ke[++Se]&&fe===ke[++Se]&&fe===ke[++Se]&&fe===ke[++Se]&&fe===ke[++Se]&&fe===ke[++Se]&&fe===ke[++Se]&&Se<He);Y.match_length=V-(He-Se),Y.match_length>Y.lookahead&&(Y.match_length=Y.lookahead)}if(Y.match_length>=D?(ve=a._tr_tally(Y,1,Y.match_length-D),Y.lookahead-=Y.match_length,Y.strstart+=Y.match_length,Y.match_length=0):(ve=a._tr_tally(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++),ve&&($(Y,!1),Y.strm.avail_out===0))return N}return Y.insert=0,pe===p?($(Y,!0),Y.strm.avail_out===0?ge:J):Y.last_lit&&($(Y,!1),Y.strm.avail_out===0)?N:te}(R,ie):i[R.level].func(R,ie);if(oe!==ge&&oe!==J||(R.status=666),oe===N||oe===ge)return S.avail_out===0&&(R.last_flush=-1),g;if(oe===te&&(ie===1?a._tr_align(R):ie!==5&&(a._tr_stored_block(R,0,0,!1),ie===3&&(ce(R.head),R.lookahead===0&&(R.strstart=0,R.block_start=0,R.insert=0))),W(S),S.avail_out===0))return R.last_flush=-1,g}return ie!==p?g:R.wrap<=0?1:(R.wrap===2?(Te(R,255&S.adler),Te(R,S.adler>>8&255),Te(R,S.adler>>16&255),Te(R,S.adler>>24&255),Te(R,255&S.total_in),Te(R,S.total_in>>8&255),Te(R,S.total_in>>16&255),Te(R,S.total_in>>24&255)):(q(R,S.adler>>>16),q(R,65535&S.adler)),W(S),0<R.wrap&&(R.wrap=-R.wrap),R.pending!==0?g:1)},o.deflateEnd=function(S){var ie;return S&&S.state?(ie=S.state.status)!==_&&ie!==69&&ie!==73&&ie!==91&&ie!==103&&ie!==z&&ie!==666?K(S,E):(S.state=null,ie===z?K(S,-3):g):E},o.deflateSetDictionary=function(S,ie){var Z,R,b,F,se,oe,Y,pe,ve=ie.length;if(!S||!S.state||(F=(Z=S.state).wrap)===2||F===1&&Z.status!==_||Z.lookahead)return E;for(F===1&&(S.adler=c(S.adler,ie,ve,0)),Z.wrap=0,ve>=Z.w_size&&(F===0&&(ce(Z.head),Z.strstart=0,Z.block_start=0,Z.insert=0),pe=new s.Buf8(Z.w_size),s.arraySet(pe,ie,ve-Z.w_size,Z.w_size,0),ie=pe,ve=Z.w_size),se=S.avail_in,oe=S.next_in,Y=S.input,S.avail_in=ve,S.next_in=0,S.input=ie,Me(Z);Z.lookahead>=D;){for(R=Z.strstart,b=Z.lookahead-(D-1);Z.ins_h=(Z.ins_h<<Z.hash_shift^Z.window[R+D-1])&Z.hash_mask,Z.prev[R&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=R,R++,--b;);Z.strstart=R,Z.lookahead=D-1,Me(Z)}return Z.strstart+=Z.lookahead,Z.block_start=Z.strstart,Z.insert=Z.lookahead,Z.lookahead=0,Z.match_length=Z.prev_length=D-1,Z.match_available=0,S.next_in=oe,S.input=Y,S.avail_in=se,Z.wrap=F,g},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,o){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,o){r.exports=function(i,s){var a,c,d,h,m,p,g,E,x,w,y,v,T,I,A,O,k,j,D,V,X,_,z,N,te;a=i.state,c=i.next_in,N=i.input,d=c+(i.avail_in-5),h=i.next_out,te=i.output,m=h-(s-i.avail_out),p=h+(i.avail_out-257),g=a.dmax,E=a.wsize,x=a.whave,w=a.wnext,y=a.window,v=a.hold,T=a.bits,I=a.lencode,A=a.distcode,O=(1<<a.lenbits)-1,k=(1<<a.distbits)-1;e:do{T<15&&(v+=N[c++]<<T,T+=8,v+=N[c++]<<T,T+=8),j=I[v&O];t:for(;;){if(v>>>=D=j>>>24,T-=D,(D=j>>>16&255)===0)te[h++]=65535&j;else{if(!(16&D)){if(!(64&D)){j=I[(65535&j)+(v&(1<<D)-1)];continue t}if(32&D){a.mode=12;break e}i.msg="invalid literal/length code",a.mode=30;break e}V=65535&j,(D&=15)&&(T<D&&(v+=N[c++]<<T,T+=8),V+=v&(1<<D)-1,v>>>=D,T-=D),T<15&&(v+=N[c++]<<T,T+=8,v+=N[c++]<<T,T+=8),j=A[v&k];n:for(;;){if(v>>>=D=j>>>24,T-=D,!(16&(D=j>>>16&255))){if(!(64&D)){j=A[(65535&j)+(v&(1<<D)-1)];continue n}i.msg="invalid distance code",a.mode=30;break e}if(X=65535&j,T<(D&=15)&&(v+=N[c++]<<T,(T+=8)<D&&(v+=N[c++]<<T,T+=8)),g<(X+=v&(1<<D)-1)){i.msg="invalid distance too far back",a.mode=30;break e}if(v>>>=D,T-=D,(D=h-m)<X){if(x<(D=X-D)&&a.sane){i.msg="invalid distance too far back",a.mode=30;break e}if(z=y,(_=0)===w){if(_+=E-D,D<V){for(V-=D;te[h++]=y[_++],--D;);_=h-X,z=te}}else if(w<D){if(_+=E+w-D,(D-=w)<V){for(V-=D;te[h++]=y[_++],--D;);if(_=0,w<V){for(V-=D=w;te[h++]=y[_++],--D;);_=h-X,z=te}}}else if(_+=w-D,D<V){for(V-=D;te[h++]=y[_++],--D;);_=h-X,z=te}for(;2<V;)te[h++]=z[_++],te[h++]=z[_++],te[h++]=z[_++],V-=3;V&&(te[h++]=z[_++],1<V&&(te[h++]=z[_++]))}else{for(_=h-X;te[h++]=te[_++],te[h++]=te[_++],te[h++]=te[_++],2<(V-=3););V&&(te[h++]=te[_++],1<V&&(te[h++]=te[_++]))}break}}break}}while(c<d&&h<p);c-=V=T>>3,v&=(1<<(T-=V<<3))-1,i.next_in=c,i.next_out=h,i.avail_in=c<d?d-c+5:5-(c-d),i.avail_out=h<p?p-h+257:257-(h-p),a.hold=v,a.bits=T}},{}],49:[function(n,r,o){var i=n("../utils/common"),s=n("./adler32"),a=n("./crc32"),c=n("./inffast"),d=n("./inftrees"),h=1,m=2,p=0,g=-2,E=1,x=852,w=592;function y(_){return(_>>>24&255)+(_>>>8&65280)+((65280&_)<<8)+((255&_)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(_){var z;return _&&_.state?(z=_.state,_.total_in=_.total_out=z.total=0,_.msg="",z.wrap&&(_.adler=1&z.wrap),z.mode=E,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new i.Buf32(x),z.distcode=z.distdyn=new i.Buf32(w),z.sane=1,z.back=-1,p):g}function I(_){var z;return _&&_.state?((z=_.state).wsize=0,z.whave=0,z.wnext=0,T(_)):g}function A(_,z){var N,te;return _&&_.state?(te=_.state,z<0?(N=0,z=-z):(N=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?g:(te.window!==null&&te.wbits!==z&&(te.window=null),te.wrap=N,te.wbits=z,I(_))):g}function O(_,z){var N,te;return _?(te=new v,(_.state=te).window=null,(N=A(_,z))!==p&&(_.state=null),N):g}var k,j,D=!0;function V(_){if(D){var z;for(k=new i.Buf32(512),j=new i.Buf32(32),z=0;z<144;)_.lens[z++]=8;for(;z<256;)_.lens[z++]=9;for(;z<280;)_.lens[z++]=7;for(;z<288;)_.lens[z++]=8;for(d(h,_.lens,0,288,k,0,_.work,{bits:9}),z=0;z<32;)_.lens[z++]=5;d(m,_.lens,0,32,j,0,_.work,{bits:5}),D=!1}_.lencode=k,_.lenbits=9,_.distcode=j,_.distbits=5}function X(_,z,N,te){var ge,J=_.state;return J.window===null&&(J.wsize=1<<J.wbits,J.wnext=0,J.whave=0,J.window=new i.Buf8(J.wsize)),te>=J.wsize?(i.arraySet(J.window,z,N-J.wsize,J.wsize,0),J.wnext=0,J.whave=J.wsize):(te<(ge=J.wsize-J.wnext)&&(ge=te),i.arraySet(J.window,z,N-te,ge,J.wnext),(te-=ge)?(i.arraySet(J.window,z,N-te,te,0),J.wnext=te,J.whave=J.wsize):(J.wnext+=ge,J.wnext===J.wsize&&(J.wnext=0),J.whave<J.wsize&&(J.whave+=ge))),0}o.inflateReset=I,o.inflateReset2=A,o.inflateResetKeep=T,o.inflateInit=function(_){return O(_,15)},o.inflateInit2=O,o.inflate=function(_,z){var N,te,ge,J,K,M,ce,W,$,Te,q,Q,Me,Be,he,xe,be,Le,it,Ve,S,ie,Z,R,b=0,F=new i.Buf8(4),se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!_||!_.state||!_.output||!_.input&&_.avail_in!==0)return g;(N=_.state).mode===12&&(N.mode=13),K=_.next_out,ge=_.output,ce=_.avail_out,J=_.next_in,te=_.input,M=_.avail_in,W=N.hold,$=N.bits,Te=M,q=ce,ie=p;e:for(;;)switch(N.mode){case E:if(N.wrap===0){N.mode=13;break}for(;$<16;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}if(2&N.wrap&&W===35615){F[N.check=0]=255&W,F[1]=W>>>8&255,N.check=a(N.check,F,2,0),$=W=0,N.mode=2;break}if(N.flags=0,N.head&&(N.head.done=!1),!(1&N.wrap)||(((255&W)<<8)+(W>>8))%31){_.msg="incorrect header check",N.mode=30;break}if((15&W)!=8){_.msg="unknown compression method",N.mode=30;break}if($-=4,S=8+(15&(W>>>=4)),N.wbits===0)N.wbits=S;else if(S>N.wbits){_.msg="invalid window size",N.mode=30;break}N.dmax=1<<S,_.adler=N.check=1,N.mode=512&W?10:12,$=W=0;break;case 2:for(;$<16;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}if(N.flags=W,(255&N.flags)!=8){_.msg="unknown compression method",N.mode=30;break}if(57344&N.flags){_.msg="unknown header flags set",N.mode=30;break}N.head&&(N.head.text=W>>8&1),512&N.flags&&(F[0]=255&W,F[1]=W>>>8&255,N.check=a(N.check,F,2,0)),$=W=0,N.mode=3;case 3:for(;$<32;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}N.head&&(N.head.time=W),512&N.flags&&(F[0]=255&W,F[1]=W>>>8&255,F[2]=W>>>16&255,F[3]=W>>>24&255,N.check=a(N.check,F,4,0)),$=W=0,N.mode=4;case 4:for(;$<16;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}N.head&&(N.head.xflags=255&W,N.head.os=W>>8),512&N.flags&&(F[0]=255&W,F[1]=W>>>8&255,N.check=a(N.check,F,2,0)),$=W=0,N.mode=5;case 5:if(1024&N.flags){for(;$<16;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}N.length=W,N.head&&(N.head.extra_len=W),512&N.flags&&(F[0]=255&W,F[1]=W>>>8&255,N.check=a(N.check,F,2,0)),$=W=0}else N.head&&(N.head.extra=null);N.mode=6;case 6:if(1024&N.flags&&(M<(Q=N.length)&&(Q=M),Q&&(N.head&&(S=N.head.extra_len-N.length,N.head.extra||(N.head.extra=new Array(N.head.extra_len)),i.arraySet(N.head.extra,te,J,Q,S)),512&N.flags&&(N.check=a(N.check,te,Q,J)),M-=Q,J+=Q,N.length-=Q),N.length))break e;N.length=0,N.mode=7;case 7:if(2048&N.flags){if(M===0)break e;for(Q=0;S=te[J+Q++],N.head&&S&&N.length<65536&&(N.head.name+=String.fromCharCode(S)),S&&Q<M;);if(512&N.flags&&(N.check=a(N.check,te,Q,J)),M-=Q,J+=Q,S)break e}else N.head&&(N.head.name=null);N.length=0,N.mode=8;case 8:if(4096&N.flags){if(M===0)break e;for(Q=0;S=te[J+Q++],N.head&&S&&N.length<65536&&(N.head.comment+=String.fromCharCode(S)),S&&Q<M;);if(512&N.flags&&(N.check=a(N.check,te,Q,J)),M-=Q,J+=Q,S)break e}else N.head&&(N.head.comment=null);N.mode=9;case 9:if(512&N.flags){for(;$<16;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}if(W!==(65535&N.check)){_.msg="header crc mismatch",N.mode=30;break}$=W=0}N.head&&(N.head.hcrc=N.flags>>9&1,N.head.done=!0),_.adler=N.check=0,N.mode=12;break;case 10:for(;$<32;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}_.adler=N.check=y(W),$=W=0,N.mode=11;case 11:if(N.havedict===0)return _.next_out=K,_.avail_out=ce,_.next_in=J,_.avail_in=M,N.hold=W,N.bits=$,2;_.adler=N.check=1,N.mode=12;case 12:if(z===5||z===6)break e;case 13:if(N.last){W>>>=7&$,$-=7&$,N.mode=27;break}for(;$<3;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}switch(N.last=1&W,$-=1,3&(W>>>=1)){case 0:N.mode=14;break;case 1:if(V(N),N.mode=20,z!==6)break;W>>>=2,$-=2;break e;case 2:N.mode=17;break;case 3:_.msg="invalid block type",N.mode=30}W>>>=2,$-=2;break;case 14:for(W>>>=7&$,$-=7&$;$<32;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}if((65535&W)!=(W>>>16^65535)){_.msg="invalid stored block lengths",N.mode=30;break}if(N.length=65535&W,$=W=0,N.mode=15,z===6)break e;case 15:N.mode=16;case 16:if(Q=N.length){if(M<Q&&(Q=M),ce<Q&&(Q=ce),Q===0)break e;i.arraySet(ge,te,J,Q,K),M-=Q,J+=Q,ce-=Q,K+=Q,N.length-=Q;break}N.mode=12;break;case 17:for(;$<14;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}if(N.nlen=257+(31&W),W>>>=5,$-=5,N.ndist=1+(31&W),W>>>=5,$-=5,N.ncode=4+(15&W),W>>>=4,$-=4,286<N.nlen||30<N.ndist){_.msg="too many length or distance symbols",N.mode=30;break}N.have=0,N.mode=18;case 18:for(;N.have<N.ncode;){for(;$<3;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}N.lens[se[N.have++]]=7&W,W>>>=3,$-=3}for(;N.have<19;)N.lens[se[N.have++]]=0;if(N.lencode=N.lendyn,N.lenbits=7,Z={bits:N.lenbits},ie=d(0,N.lens,0,19,N.lencode,0,N.work,Z),N.lenbits=Z.bits,ie){_.msg="invalid code lengths set",N.mode=30;break}N.have=0,N.mode=19;case 19:for(;N.have<N.nlen+N.ndist;){for(;xe=(b=N.lencode[W&(1<<N.lenbits)-1])>>>16&255,be=65535&b,!((he=b>>>24)<=$);){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}if(be<16)W>>>=he,$-=he,N.lens[N.have++]=be;else{if(be===16){for(R=he+2;$<R;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}if(W>>>=he,$-=he,N.have===0){_.msg="invalid bit length repeat",N.mode=30;break}S=N.lens[N.have-1],Q=3+(3&W),W>>>=2,$-=2}else if(be===17){for(R=he+3;$<R;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}$-=he,S=0,Q=3+(7&(W>>>=he)),W>>>=3,$-=3}else{for(R=he+7;$<R;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}$-=he,S=0,Q=11+(127&(W>>>=he)),W>>>=7,$-=7}if(N.have+Q>N.nlen+N.ndist){_.msg="invalid bit length repeat",N.mode=30;break}for(;Q--;)N.lens[N.have++]=S}}if(N.mode===30)break;if(N.lens[256]===0){_.msg="invalid code -- missing end-of-block",N.mode=30;break}if(N.lenbits=9,Z={bits:N.lenbits},ie=d(h,N.lens,0,N.nlen,N.lencode,0,N.work,Z),N.lenbits=Z.bits,ie){_.msg="invalid literal/lengths set",N.mode=30;break}if(N.distbits=6,N.distcode=N.distdyn,Z={bits:N.distbits},ie=d(m,N.lens,N.nlen,N.ndist,N.distcode,0,N.work,Z),N.distbits=Z.bits,ie){_.msg="invalid distances set",N.mode=30;break}if(N.mode=20,z===6)break e;case 20:N.mode=21;case 21:if(6<=M&&258<=ce){_.next_out=K,_.avail_out=ce,_.next_in=J,_.avail_in=M,N.hold=W,N.bits=$,c(_,q),K=_.next_out,ge=_.output,ce=_.avail_out,J=_.next_in,te=_.input,M=_.avail_in,W=N.hold,$=N.bits,N.mode===12&&(N.back=-1);break}for(N.back=0;xe=(b=N.lencode[W&(1<<N.lenbits)-1])>>>16&255,be=65535&b,!((he=b>>>24)<=$);){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}if(xe&&!(240&xe)){for(Le=he,it=xe,Ve=be;xe=(b=N.lencode[Ve+((W&(1<<Le+it)-1)>>Le)])>>>16&255,be=65535&b,!(Le+(he=b>>>24)<=$);){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}W>>>=Le,$-=Le,N.back+=Le}if(W>>>=he,$-=he,N.back+=he,N.length=be,xe===0){N.mode=26;break}if(32&xe){N.back=-1,N.mode=12;break}if(64&xe){_.msg="invalid literal/length code",N.mode=30;break}N.extra=15&xe,N.mode=22;case 22:if(N.extra){for(R=N.extra;$<R;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}N.length+=W&(1<<N.extra)-1,W>>>=N.extra,$-=N.extra,N.back+=N.extra}N.was=N.length,N.mode=23;case 23:for(;xe=(b=N.distcode[W&(1<<N.distbits)-1])>>>16&255,be=65535&b,!((he=b>>>24)<=$);){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}if(!(240&xe)){for(Le=he,it=xe,Ve=be;xe=(b=N.distcode[Ve+((W&(1<<Le+it)-1)>>Le)])>>>16&255,be=65535&b,!(Le+(he=b>>>24)<=$);){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}W>>>=Le,$-=Le,N.back+=Le}if(W>>>=he,$-=he,N.back+=he,64&xe){_.msg="invalid distance code",N.mode=30;break}N.offset=be,N.extra=15&xe,N.mode=24;case 24:if(N.extra){for(R=N.extra;$<R;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}N.offset+=W&(1<<N.extra)-1,W>>>=N.extra,$-=N.extra,N.back+=N.extra}if(N.offset>N.dmax){_.msg="invalid distance too far back",N.mode=30;break}N.mode=25;case 25:if(ce===0)break e;if(Q=q-ce,N.offset>Q){if((Q=N.offset-Q)>N.whave&&N.sane){_.msg="invalid distance too far back",N.mode=30;break}Me=Q>N.wnext?(Q-=N.wnext,N.wsize-Q):N.wnext-Q,Q>N.length&&(Q=N.length),Be=N.window}else Be=ge,Me=K-N.offset,Q=N.length;for(ce<Q&&(Q=ce),ce-=Q,N.length-=Q;ge[K++]=Be[Me++],--Q;);N.length===0&&(N.mode=21);break;case 26:if(ce===0)break e;ge[K++]=N.length,ce--,N.mode=21;break;case 27:if(N.wrap){for(;$<32;){if(M===0)break e;M--,W|=te[J++]<<$,$+=8}if(q-=ce,_.total_out+=q,N.total+=q,q&&(_.adler=N.check=N.flags?a(N.check,ge,q,K-q):s(N.check,ge,q,K-q)),q=ce,(N.flags?W:y(W))!==N.check){_.msg="incorrect data check",N.mode=30;break}$=W=0}N.mode=28;case 28:if(N.wrap&&N.flags){for(;$<32;){if(M===0)break e;M--,W+=te[J++]<<$,$+=8}if(W!==(4294967295&N.total)){_.msg="incorrect length check",N.mode=30;break}$=W=0}N.mode=29;case 29:ie=1;break e;case 30:ie=-3;break e;case 31:return-4;case 32:default:return g}return _.next_out=K,_.avail_out=ce,_.next_in=J,_.avail_in=M,N.hold=W,N.bits=$,(N.wsize||q!==_.avail_out&&N.mode<30&&(N.mode<27||z!==4))&&X(_,_.output,_.next_out,q-_.avail_out)?(N.mode=31,-4):(Te-=_.avail_in,q-=_.avail_out,_.total_in+=Te,_.total_out+=q,N.total+=q,N.wrap&&q&&(_.adler=N.check=N.flags?a(N.check,ge,q,_.next_out-q):s(N.check,ge,q,_.next_out-q)),_.data_type=N.bits+(N.last?64:0)+(N.mode===12?128:0)+(N.mode===20||N.mode===15?256:0),(Te==0&&q===0||z===4)&&ie===p&&(ie=-5),ie)},o.inflateEnd=function(_){if(!_||!_.state)return g;var z=_.state;return z.window&&(z.window=null),_.state=null,p},o.inflateGetHeader=function(_,z){var N;return _&&_.state&&2&(N=_.state).wrap?((N.head=z).done=!1,p):g},o.inflateSetDictionary=function(_,z){var N,te=z.length;return _&&_.state?(N=_.state).wrap!==0&&N.mode!==11?g:N.mode===11&&s(1,z,te,0)!==N.check?-3:X(_,z,te,te)?(N.mode=31,-4):(N.havedict=1,p):g},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,o){var i=n("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(h,m,p,g,E,x,w,y){var v,T,I,A,O,k,j,D,V,X=y.bits,_=0,z=0,N=0,te=0,ge=0,J=0,K=0,M=0,ce=0,W=0,$=null,Te=0,q=new i.Buf16(16),Q=new i.Buf16(16),Me=null,Be=0;for(_=0;_<=15;_++)q[_]=0;for(z=0;z<g;z++)q[m[p+z]]++;for(ge=X,te=15;1<=te&&q[te]===0;te--);if(te<ge&&(ge=te),te===0)return E[x++]=20971520,E[x++]=20971520,y.bits=1,0;for(N=1;N<te&&q[N]===0;N++);for(ge<N&&(ge=N),_=M=1;_<=15;_++)if(M<<=1,(M-=q[_])<0)return-1;if(0<M&&(h===0||te!==1))return-1;for(Q[1]=0,_=1;_<15;_++)Q[_+1]=Q[_]+q[_];for(z=0;z<g;z++)m[p+z]!==0&&(w[Q[m[p+z]]++]=z);if(k=h===0?($=Me=w,19):h===1?($=s,Te-=257,Me=a,Be-=257,256):($=c,Me=d,-1),_=N,O=x,K=z=W=0,I=-1,A=(ce=1<<(J=ge))-1,h===1&&852<ce||h===2&&592<ce)return 1;for(;;){for(j=_-K,V=w[z]<k?(D=0,w[z]):w[z]>k?(D=Me[Be+w[z]],$[Te+w[z]]):(D=96,0),v=1<<_-K,N=T=1<<J;E[O+(W>>K)+(T-=v)]=j<<24|D<<16|V|0,T!==0;);for(v=1<<_-1;W&v;)v>>=1;if(v!==0?(W&=v-1,W+=v):W=0,z++,--q[_]==0){if(_===te)break;_=m[p+w[z]]}if(ge<_&&(W&A)!==I){for(K===0&&(K=ge),O+=N,M=1<<(J=_-K);J+K<te&&!((M-=q[J+K])<=0);)J++,M<<=1;if(ce+=1<<J,h===1&&852<ce||h===2&&592<ce)return 1;E[I=W&A]=ge<<24|J<<16|O-x|0}}return W!==0&&(E[O+W]=_-K<<24|64<<16|0),y.bits=ge,0}},{"../utils/common":41}],51:[function(n,r,o){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,o){var i=n("../utils/common"),s=0,a=1;function c(b){for(var F=b.length;0<=--F;)b[F]=0}var d=0,h=29,m=256,p=m+1+h,g=30,E=19,x=2*p+1,w=15,y=16,v=7,T=256,I=16,A=17,O=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=new Array(2*(p+2));c(X);var _=new Array(2*g);c(_);var z=new Array(512);c(z);var N=new Array(256);c(N);var te=new Array(h);c(te);var ge,J,K,M=new Array(g);function ce(b,F,se,oe,Y){this.static_tree=b,this.extra_bits=F,this.extra_base=se,this.elems=oe,this.max_length=Y,this.has_stree=b&&b.length}function W(b,F){this.dyn_tree=b,this.max_code=0,this.stat_desc=F}function $(b){return b<256?z[b]:z[256+(b>>>7)]}function Te(b,F){b.pending_buf[b.pending++]=255&F,b.pending_buf[b.pending++]=F>>>8&255}function q(b,F,se){b.bi_valid>y-se?(b.bi_buf|=F<<b.bi_valid&65535,Te(b,b.bi_buf),b.bi_buf=F>>y-b.bi_valid,b.bi_valid+=se-y):(b.bi_buf|=F<<b.bi_valid&65535,b.bi_valid+=se)}function Q(b,F,se){q(b,se[2*F],se[2*F+1])}function Me(b,F){for(var se=0;se|=1&b,b>>>=1,se<<=1,0<--F;);return se>>>1}function Be(b,F,se){var oe,Y,pe=new Array(w+1),ve=0;for(oe=1;oe<=w;oe++)pe[oe]=ve=ve+se[oe-1]<<1;for(Y=0;Y<=F;Y++){var fe=b[2*Y+1];fe!==0&&(b[2*Y]=Me(pe[fe]++,fe))}}function he(b){var F;for(F=0;F<p;F++)b.dyn_ltree[2*F]=0;for(F=0;F<g;F++)b.dyn_dtree[2*F]=0;for(F=0;F<E;F++)b.bl_tree[2*F]=0;b.dyn_ltree[2*T]=1,b.opt_len=b.static_len=0,b.last_lit=b.matches=0}function xe(b){8<b.bi_valid?Te(b,b.bi_buf):0<b.bi_valid&&(b.pending_buf[b.pending++]=b.bi_buf),b.bi_buf=0,b.bi_valid=0}function be(b,F,se,oe){var Y=2*F,pe=2*se;return b[Y]<b[pe]||b[Y]===b[pe]&&oe[F]<=oe[se]}function Le(b,F,se){for(var oe=b.heap[se],Y=se<<1;Y<=b.heap_len&&(Y<b.heap_len&&be(F,b.heap[Y+1],b.heap[Y],b.depth)&&Y++,!be(F,oe,b.heap[Y],b.depth));)b.heap[se]=b.heap[Y],se=Y,Y<<=1;b.heap[se]=oe}function it(b,F,se){var oe,Y,pe,ve,fe=0;if(b.last_lit!==0)for(;oe=b.pending_buf[b.d_buf+2*fe]<<8|b.pending_buf[b.d_buf+2*fe+1],Y=b.pending_buf[b.l_buf+fe],fe++,oe===0?Q(b,Y,F):(Q(b,(pe=N[Y])+m+1,F),(ve=k[pe])!==0&&q(b,Y-=te[pe],ve),Q(b,pe=$(--oe),se),(ve=j[pe])!==0&&q(b,oe-=M[pe],ve)),fe<b.last_lit;);Q(b,T,F)}function Ve(b,F){var se,oe,Y,pe=F.dyn_tree,ve=F.stat_desc.static_tree,fe=F.stat_desc.has_stree,Se=F.stat_desc.elems,He=-1;for(b.heap_len=0,b.heap_max=x,se=0;se<Se;se++)pe[2*se]!==0?(b.heap[++b.heap_len]=He=se,b.depth[se]=0):pe[2*se+1]=0;for(;b.heap_len<2;)pe[2*(Y=b.heap[++b.heap_len]=He<2?++He:0)]=1,b.depth[Y]=0,b.opt_len--,fe&&(b.static_len-=ve[2*Y+1]);for(F.max_code=He,se=b.heap_len>>1;1<=se;se--)Le(b,pe,se);for(Y=Se;se=b.heap[1],b.heap[1]=b.heap[b.heap_len--],Le(b,pe,1),oe=b.heap[1],b.heap[--b.heap_max]=se,b.heap[--b.heap_max]=oe,pe[2*Y]=pe[2*se]+pe[2*oe],b.depth[Y]=(b.depth[se]>=b.depth[oe]?b.depth[se]:b.depth[oe])+1,pe[2*se+1]=pe[2*oe+1]=Y,b.heap[1]=Y++,Le(b,pe,1),2<=b.heap_len;);b.heap[--b.heap_max]=b.heap[1],function(ke,rt){var mt,ct,vt,qe,an,H,de=rt.dyn_tree,re=rt.max_code,B=rt.stat_desc.static_tree,U=rt.stat_desc.has_stree,ee=rt.stat_desc.extra_bits,Ee=rt.stat_desc.extra_base,Ce=rt.stat_desc.max_length,Ae=0;for(qe=0;qe<=w;qe++)ke.bl_count[qe]=0;for(de[2*ke.heap[ke.heap_max]+1]=0,mt=ke.heap_max+1;mt<x;mt++)Ce<(qe=de[2*de[2*(ct=ke.heap[mt])+1]+1]+1)&&(qe=Ce,Ae++),de[2*ct+1]=qe,re<ct||(ke.bl_count[qe]++,an=0,Ee<=ct&&(an=ee[ct-Ee]),H=de[2*ct],ke.opt_len+=H*(qe+an),U&&(ke.static_len+=H*(B[2*ct+1]+an)));if(Ae!==0){do{for(qe=Ce-1;ke.bl_count[qe]===0;)qe--;ke.bl_count[qe]--,ke.bl_count[qe+1]+=2,ke.bl_count[Ce]--,Ae-=2}while(0<Ae);for(qe=Ce;qe!==0;qe--)for(ct=ke.bl_count[qe];ct!==0;)re<(vt=ke.heap[--mt])||(de[2*vt+1]!==qe&&(ke.opt_len+=(qe-de[2*vt+1])*de[2*vt],de[2*vt+1]=qe),ct--)}}(b,F),Be(pe,He,b.bl_count)}function S(b,F,se){var oe,Y,pe=-1,ve=F[1],fe=0,Se=7,He=4;for(ve===0&&(Se=138,He=3),F[2*(se+1)+1]=65535,oe=0;oe<=se;oe++)Y=ve,ve=F[2*(oe+1)+1],++fe<Se&&Y===ve||(fe<He?b.bl_tree[2*Y]+=fe:Y!==0?(Y!==pe&&b.bl_tree[2*Y]++,b.bl_tree[2*I]++):fe<=10?b.bl_tree[2*A]++:b.bl_tree[2*O]++,pe=Y,He=(fe=0)===ve?(Se=138,3):Y===ve?(Se=6,3):(Se=7,4))}function ie(b,F,se){var oe,Y,pe=-1,ve=F[1],fe=0,Se=7,He=4;for(ve===0&&(Se=138,He=3),oe=0;oe<=se;oe++)if(Y=ve,ve=F[2*(oe+1)+1],!(++fe<Se&&Y===ve)){if(fe<He)for(;Q(b,Y,b.bl_tree),--fe!=0;);else Y!==0?(Y!==pe&&(Q(b,Y,b.bl_tree),fe--),Q(b,I,b.bl_tree),q(b,fe-3,2)):fe<=10?(Q(b,A,b.bl_tree),q(b,fe-3,3)):(Q(b,O,b.bl_tree),q(b,fe-11,7));pe=Y,He=(fe=0)===ve?(Se=138,3):Y===ve?(Se=6,3):(Se=7,4)}}c(M);var Z=!1;function R(b,F,se,oe){q(b,(d<<1)+(oe?1:0),3),function(Y,pe,ve,fe){xe(Y),Te(Y,ve),Te(Y,~ve),i.arraySet(Y.pending_buf,Y.window,pe,ve,Y.pending),Y.pending+=ve}(b,F,se)}o._tr_init=function(b){Z||(function(){var F,se,oe,Y,pe,ve=new Array(w+1);for(Y=oe=0;Y<h-1;Y++)for(te[Y]=oe,F=0;F<1<<k[Y];F++)N[oe++]=Y;for(N[oe-1]=Y,Y=pe=0;Y<16;Y++)for(M[Y]=pe,F=0;F<1<<j[Y];F++)z[pe++]=Y;for(pe>>=7;Y<g;Y++)for(M[Y]=pe<<7,F=0;F<1<<j[Y]-7;F++)z[256+pe++]=Y;for(se=0;se<=w;se++)ve[se]=0;for(F=0;F<=143;)X[2*F+1]=8,F++,ve[8]++;for(;F<=255;)X[2*F+1]=9,F++,ve[9]++;for(;F<=279;)X[2*F+1]=7,F++,ve[7]++;for(;F<=287;)X[2*F+1]=8,F++,ve[8]++;for(Be(X,p+1,ve),F=0;F<g;F++)_[2*F+1]=5,_[2*F]=Me(F,5);ge=new ce(X,k,m+1,p,w),J=new ce(_,j,0,g,w),K=new ce(new Array(0),D,0,E,v)}(),Z=!0),b.l_desc=new W(b.dyn_ltree,ge),b.d_desc=new W(b.dyn_dtree,J),b.bl_desc=new W(b.bl_tree,K),b.bi_buf=0,b.bi_valid=0,he(b)},o._tr_stored_block=R,o._tr_flush_block=function(b,F,se,oe){var Y,pe,ve=0;0<b.level?(b.strm.data_type===2&&(b.strm.data_type=function(fe){var Se,He=4093624447;for(Se=0;Se<=31;Se++,He>>>=1)if(1&He&&fe.dyn_ltree[2*Se]!==0)return s;if(fe.dyn_ltree[18]!==0||fe.dyn_ltree[20]!==0||fe.dyn_ltree[26]!==0)return a;for(Se=32;Se<m;Se++)if(fe.dyn_ltree[2*Se]!==0)return a;return s}(b)),Ve(b,b.l_desc),Ve(b,b.d_desc),ve=function(fe){var Se;for(S(fe,fe.dyn_ltree,fe.l_desc.max_code),S(fe,fe.dyn_dtree,fe.d_desc.max_code),Ve(fe,fe.bl_desc),Se=E-1;3<=Se&&fe.bl_tree[2*V[Se]+1]===0;Se--);return fe.opt_len+=3*(Se+1)+5+5+4,Se}(b),Y=b.opt_len+3+7>>>3,(pe=b.static_len+3+7>>>3)<=Y&&(Y=pe)):Y=pe=se+5,se+4<=Y&&F!==-1?R(b,F,se,oe):b.strategy===4||pe===Y?(q(b,2+(oe?1:0),3),it(b,X,_)):(q(b,4+(oe?1:0),3),function(fe,Se,He,ke){var rt;for(q(fe,Se-257,5),q(fe,He-1,5),q(fe,ke-4,4),rt=0;rt<ke;rt++)q(fe,fe.bl_tree[2*V[rt]+1],3);ie(fe,fe.dyn_ltree,Se-1),ie(fe,fe.dyn_dtree,He-1)}(b,b.l_desc.max_code+1,b.d_desc.max_code+1,ve+1),it(b,b.dyn_ltree,b.dyn_dtree)),he(b),oe&&xe(b)},o._tr_tally=function(b,F,se){return b.pending_buf[b.d_buf+2*b.last_lit]=F>>>8&255,b.pending_buf[b.d_buf+2*b.last_lit+1]=255&F,b.pending_buf[b.l_buf+b.last_lit]=255&se,b.last_lit++,F===0?b.dyn_ltree[2*se]++:(b.matches++,F--,b.dyn_ltree[2*(N[se]+m+1)]++,b.dyn_dtree[2*$(F)]++),b.last_lit===b.lit_bufsize-1},o._tr_align=function(b){q(b,2,3),Q(b,T,X),function(F){F.bi_valid===16?(Te(F,F.bi_buf),F.bi_buf=0,F.bi_valid=0):8<=F.bi_valid&&(F.pending_buf[F.pending++]=255&F.bi_buf,F.bi_buf>>=8,F.bi_valid-=8)}(b)}},{"../utils/common":41}],53:[function(n,r,o){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,o){(function(i){(function(s,a){if(!s.setImmediate){var c,d,h,m,p=1,g={},E=!1,x=s.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(s);w=w&&w.setTimeout?w:s,c={}.toString.call(s.process)==="[object process]"?function(I){process.nextTick(function(){v(I)})}:function(){if(s.postMessage&&!s.importScripts){var I=!0,A=s.onmessage;return s.onmessage=function(){I=!1},s.postMessage("","*"),s.onmessage=A,I}}()?(m="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",T,!1):s.attachEvent("onmessage",T),function(I){s.postMessage(m+I,"*")}):s.MessageChannel?((h=new MessageChannel).port1.onmessage=function(I){v(I.data)},function(I){h.port2.postMessage(I)}):x&&"onreadystatechange"in x.createElement("script")?(d=x.documentElement,function(I){var A=x.createElement("script");A.onreadystatechange=function(){v(I),A.onreadystatechange=null,d.removeChild(A),A=null},d.appendChild(A)}):function(I){setTimeout(v,0,I)},w.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var A=new Array(arguments.length-1),O=0;O<A.length;O++)A[O]=arguments[O+1];var k={callback:I,args:A};return g[p]=k,c(p),p++},w.clearImmediate=y}function y(I){delete g[I]}function v(I){if(E)setTimeout(v,0,I);else{var A=g[I];if(A){E=!0;try{(function(O){var k=O.callback,j=O.args;switch(j.length){case 0:k();break;case 1:k(j[0]);break;case 2:k(j[0],j[1]);break;case 3:k(j[0],j[1],j[2]);break;default:k.apply(a,j)}})(A)}finally{y(I),E=!1}}}}function T(I){I.source===s&&typeof I.data=="string"&&I.data.indexOf(m)===0&&v(+I.data.slice(m.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof bn<"u"?bn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(lg);var GC=lg.exports;const Yl=Zf(GC);var ug={exports:{}};(function(t,e){(function(n,r){r()})(bn,function(){function n(d,h){return typeof h>"u"?h={autoBom:!1}:typeof h!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),h={autoBom:!h}),h.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(d.type)?new Blob(["\uFEFF",d],{type:d.type}):d}function r(d,h,m){var p=new XMLHttpRequest;p.open("GET",d),p.responseType="blob",p.onload=function(){c(p.response,h,m)},p.onerror=function(){console.error("could not download file")},p.send()}function o(d){var h=new XMLHttpRequest;h.open("HEAD",d,!1);try{h.send()}catch{}return 200<=h.status&&299>=h.status}function i(d){try{d.dispatchEvent(new MouseEvent("click"))}catch{var h=document.createEvent("MouseEvents");h.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),d.dispatchEvent(h)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof bn=="object"&&bn.global===bn?bn:void 0,a=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(d,h,m){var p=s.URL||s.webkitURL,g=document.createElement("a");h=h||d.name||"download",g.download=h,g.rel="noopener",typeof d=="string"?(g.href=d,g.origin===location.origin?i(g):o(g.href)?r(d,h,m):i(g,g.target="_blank")):(g.href=p.createObjectURL(d),setTimeout(function(){p.revokeObjectURL(g.href)},4e4),setTimeout(function(){i(g)},0))}:"msSaveOrOpenBlob"in navigator?function(d,h,m){if(h=h||d.name||"download",typeof d!="string")navigator.msSaveOrOpenBlob(n(d,m),h);else if(o(d))r(d,h,m);else{var p=document.createElement("a");p.href=d,p.target="_blank",setTimeout(function(){i(p)})}}:function(d,h,m,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof d=="string")return r(d,h,m);var g=d.type==="application/octet-stream",E=/constructor/i.test(s.HTMLElement)||s.safari,x=/CriOS\/[\d]+/.test(navigator.userAgent);if((x||g&&E||a)&&typeof FileReader<"u"){var w=new FileReader;w.onloadend=function(){var T=w.result;T=x?T:T.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=T:location=T,p=null},w.readAsDataURL(d)}else{var y=s.URL||s.webkitURL,v=y.createObjectURL(d);p?p.location=v:location.href=v,p=null,setTimeout(function(){y.revokeObjectURL(v)},4e4)}});s.saveAs=c.saveAs=c,t.exports=c})})(ug);var ls=ug.exports;const Xf=[{value:"background",label:"  ( )"},{value:"full",label:"  ()"},{value:"mls",label:"  ( )"},{value:"ws",label:"  ( , )"},{value:"bs",label:"  ( )"},{value:"cu",label:" ()"}],HC=t=>{switch(t){case"mls":return"[CAMERA] Knee Shot (Medium Long)";case"ws":return"[CAMERA] Waist Shot";case"bs":return"[CAMERA] Bust Shot";case"full":return"[CAMERA] Full Shot";case"cu":return"[CAMERA] Close Up";default:return""}},BC=({onNext:t,isNextLoading:e})=>{const{scenes:n,setScenes:r,characters:o,referenceImages:i,apiKey:s,selectedStyle:a,globalAspectRatio:c,setGlobalAspectRatio:d,showToast:h,openModal:m,globalScenePrompt:p,setGlobalScenePrompt:g,props:E,script:x}=yn(),[w,y]=ue.useState({}),[v,T]=ue.useState(!1),[I,A]=ue.useState({}),[O,k]=ue.useState({}),[j,D]=ue.useState(!0),[V,X]=ue.useState(!1),[_,z]=ue.useState({}),[N,te]=ue.useState({}),[ge,J]=ue.useState([]),K=ue.useRef(null),M=ue.useRef(null),ce=ue.useRef(null),[W,$]=ue.useState(null),Te=()=>{var H;return(H=M.current)==null?void 0:H.scrollIntoView({behavior:"smooth"})},q=()=>{var H;return(H=ce.current)==null?void 0:H.scrollIntoView({behavior:"smooth"})},Q=H=>H.replace(/[\s\[\]\(\):]/g,"");ue.useEffect(()=>{let H=!1;const de=n.map(re=>{if(!re.casting&&o.length>0){const B=Q(re.scriptSegment),U=Q(re.description),ee=o.filter(Oe=>{const Re=Q(Oe.name);if(B.includes(Re)||U.includes(Re))return!0;const le=Oe.name.split("(")[0].trim();if(le.length>=2){const Ue=Q(le);if(B.includes(Ue)||U.includes(Ue))return!0}return!1}),Ee=ee.slice(0,3).map(Oe=>Oe.id),Ce=ee.slice(3,6).map(Oe=>Oe.id),De=(E?E.filter(Oe=>{const Re=Q(Oe.name);return B.includes(Re)||U.includes(Re)}):[]).map(Oe=>Oe.id);return H=!0,{...re,casting:{mainIds:Ee,subIds:Ce,propIds:De}}}return re});H&&r(de)},[o.length,E==null?void 0:E.length,n.length]);const Me=()=>{J(H=>[...H,n])},Be=()=>{if(ge.length===0)return;const H=ge[ge.length-1];r(H),J(de=>de.slice(0,-1)),h("  .","success")},he=(H,de)=>{const re=n.find(Ee=>Ee.id===H);if(!re)return"";const B=re.casting||{mainIds:[],subIds:[]};let U="";p&&p.trim()&&(U+=`[ MANDATORY BACKGROUND & PROP CONSISTENCY RULES ]
`,U+=`(These rules are ABSOLUTE. Prioritize them over generic descriptions.)
`,U+=`${p}

`),U+=`[SCENE INFO]
Location: ${re.location}
Time: ${re.timeOfDay}
`;let ee=re.description||"";if(ee.includes("[SCENE INFO]")&&(ee=ee.split("[SCENE INFO]")[0].trim()),ee.includes("[CAMERA]")&&(ee=ee.split("[CAMERA]")[0].trim()),de==="background"?U+=`Mood/Weather: ${ee}
`:U+=`Action/Context: ${ee}
`,de==="background")U+=`
[INSTRUCTION]
NO PEOPLE. EMPTY BACKGROUND ONLY.
Focus on architecture and atmosphere.`;else{if(U+=`
[CAMERA]
${HC(de)}
`,U+=`
[ACTING & EYE CONTACT RULES]
`,U+=`- **ABSOLUTELY NO LOOKING AT CAMERA**: Characters MUST NOT stare at the viewer. This is a movie scene, not a portrait session.
`,U+=`- **INTERACTION FOCUS**: Characters MUST look at each other or the object/person they are talking to.
`,U+=`- **NATURAL ACTING**: Avoid stiff "Passport Photo" poses. Use dynamic gestures and facial expressions matching the emotion.
`,U+=`- **SITTING POSTURE**: If sitting, DO NOT just sit straight like a statue. Lean forward, rest arm on knee, or gesture with hands while talking.
`,(re.location.includes("")||re.location.includes("")||re.location.includes("")||re.location.includes(""))&&(U+=`
[INDOOR ETIQUETTE - ABSOLUTE SHOES RULE]
`,U+=`- **LOCATION IS INDOORS**: Character MUST be barefoot or wearing white socks (Beoseon).
`,U+=`- **OVERRIDE REFERENCE**: Even if the Reference Image shows shoes, **YOU MUST REMOVE THEM**.
`,U+=`- **NEGATIVE PROMPT**: Shoes, Boots, Sandals, Jipsin, Geta, Zori.
`,U+=`
[INDOOR ETIQUETTE - HEADWEAR]
`,U+=`- **REMOVE OUTDOOR HATS**: Take off "Gat", "Satgat", "Paeraengi".
`,U+=`- **ALLOWED HEADWEAR**: Headbands (Manggeon), Hairpins (Binyeo), Small Indoor Caps (Tanggeon/Jeongjagwan).
`),B.mainIds.length>0){const Ce=B.mainIds.map($e=>o.find(Ge=>Ge.id===$e)).filter(Boolean),Ae=Ce.filter($e=>{const Ge=(($e==null?void 0:$e.description)||"").toLowerCase();return Ge.includes("daenggi")||Ge.includes("half-tied")||Ge.includes("danbal")||Ge.includes("deobeok")||Ge.includes("shaggy")});Ae.length>0&&(U+=`
[HAIR-BASED HAT RULE]
`,Ae.forEach($e=>{U+=`- **CHARACTER ${$e==null?void 0:$e.name}**: Has specific hairstyle (Daenggi/Half-tied/Shaggy). **MUST NOT WEAR A GAT** (Hat). Show the hair clearly.
`}),Ae.length===Ce.length&&(U+=`- **NEGATIVE PROMPT**: Gat, Wide Brim Hat, Satgat.
`)),U+=`
[FOCUS SUBJECT - MAIN CHARACTERS]
`,!!re.focusId?U+=`TOTAL CHARACTERS: 1 (Active Speaker) + Blurred Foreground Element (Listener)
`:(U+=`TOTAL CHARACTERS: ${B.mainIds.length} (DO NOT DRAW MORE THAN ${B.mainIds.length})
`,B.mainIds.length===2&&(U+=`[COMPOSITION: TWO SHOT]
- Show both characters in the frame.
- Equal importance/focus on both.
`));let Oe=0;const Re=B.mainIds.map($e=>{const Ge=o.find(ze=>ze.id===$e),Pe=Ge?i.find(ze=>ze.name===Ge.name):null;return Pe!=null&&Pe.imageUrl&&Oe++,{id:$e,hasRef:!!(Pe!=null&&Pe.imageUrl),refIndex:Pe!=null&&Pe.imageUrl?Oe:0}});if(B.mainIds.forEach($e=>{var Pe,ze;const Ge=o.find(Ze=>Ze.id===$e);if(Ge){const Ze=Re.find(Bn=>Bn.id===$e),Gt=i.find(Bn=>Bn.name===Ge.name);let Hn=Gt?Gt.description:Ge.visualGuide||Ge.description;Hn.includes("[Basic Info]")&&(Hn=Hn.split("[Basic Info]")[0].trim());const Eo=re.focusId===$e,yi=!!re.focusId,vi=Ze!=null&&Ze.hasRef?`(MATCH WITH PROVIDED REFERENCE IMAGE #${Ze.refIndex})`:"(No Reference Image - Generate Freely)";if(U+=`
 CHARACTER: ${Ge.name} ${Eo?"( PRIMARY FOCUS - SPEAKER)":""} ${vi}
`,Ge.name.trim().endsWith("")||Ge.name.includes("")||Ge.name.includes("")||Ge.name.includes("")||/\d+/.test(Ge.name)){U+=`  - **GROUP ENTITY**: This character represents a **GROUP** of people (Crowd/Team).
`;const Bn=Ge.name.match(/(\d+)/);if(Bn){const xi=Bn[1];U+=`  - **QUANTITY**: Generate EXACTLY ${xi} people for this entry.
`}else U+=`  - **QUANTITY**: Generate MULTIPLE people (3 to 5) for this entry.
`;U+=`  - **UNIFORM RULE**: All members of this group MUST wear the **EXACT SAME CLOTHING** (Uniform) as shown in the Reference Image.
`,U+=`  - **VARIATION**: They can have different heights, weights, and faces, but the **COSTUME MUST BE IDENTICAL**.
`}yi&&!Eo?(U+=`  - ROLE: **LISTENER** (Foreground Framing Element)
`,U+=`  - IDENTITY: ${Ge.name} (Shoulder/Back View). ${vi}
`,U+=`  - APPEARANCE: ${Hn}
`,(Pe=Gt==null?void 0:Gt.design)!=null&&Pe.clothingColor&&(U+=`  - CLOTHING COLOR: ${Gt.design.clothingColor}
`),U+=`  - INSTRUCTION: **PUSH TO THE EDGE**. Show ONLY the back of the shoulder/head on the extreme edge of the frame.
`,U+=`  - **SIZE**: The Listener MUST NOT block the view. They should take up less than 15% of the frame width.
`,U+=`  - **BLUR**: Heavily blur this character (Bokeh).
`):(Ze!=null&&Ze.hasRef?(U+=`  - **VISUAL SOURCE**: REFERENCE IMAGE #${Ze.refIndex}
`,U+=`  - **APPEARANCE**: ${Hn}
`):(U+=`  - APPEARANCE: ${Hn} (Use as general guide, adapt to scene context)
`,U+=`  - **CROWD/EXTRA RULE**: If this is a group/crowd, prioritize the overall vibe over exact details.
`),(ze=Gt==null?void 0:Gt.design)!=null&&ze.clothingColor&&(U+=`  - CLOTHING: ${Gt.design.clothingColor}
`),yi&&Eo?U+=`  - ROLE: **ACTIVE SPEAKER** (Camera Focus on this person).
`:U+=`  - ROLE: Main Actor
`)}}),B.mainIds.length>=3&&!re.focusId)U+=`
    [COMPOSITION: GROUP SHOT]
    - **SHOW ALL CHARACTERS**: The frame MUST contain ALL ${B.mainIds.length} characters.
    - **ARRANGEMENT**: Do NOT line them up in a straight line. Use a triangle or semi-circle formation.
    - **DEPTH**: Place some characters closer, some further back to create depth.
    `;else if(B.mainIds.length===2&&!re.focusId)U+=`
    [COMPOSITION: DYNAMIC TWO SHOT]
    - **GOAL**: Variety in staging.
    - **OPTION A (Standard)**: Side-by-side (Full Shot). Good for walking or standing formally.
    - **OPTION B (Cinematic)**: Depth Staging. One character in foreground (shoulder/back), one in background (face).
    - **OPTION C (Interaction)**: Angled view showing them looking at EACH OTHER (Profile).
    - **INSTRUCTION**: Choose the option that best fits the action. Do NOT use Option A for every scene.
    `;else if(B.mainIds.length===1||re.focusId&&B.mainIds.length>0)if(U+=`
    [SOLO/OTS SHOT & ANGLE INSTRUCTION]
    `,re.focusId){const $e=n.findIndex(Pe=>Pe.id===H);let Ge=!1;if($e>0){const Pe=n[$e-1];Pe.focusId&&Pe.focusId!==re.focusId&&(Ge=!0)}U+=`
    - **CAMERA FOCUS**: Focus SHARPLY on the Active Speaker.
    - **COMPOSITION**: Dirty Single Shot / Tight Over-the-Shoulder.
    - **LISTENER POSITION**: The Listener is TOO BIG. **MOVE THEM OUT OF THE FRAME**.
    - **VISIBILITY**: Show ONLY a sliver of the Listener's shoulder/head on the edge.
    - **RATIO**: Speaker (85% of frame) vs Listener (15% of frame).
    - **EYE CONTACT**: Speaker looks at the Listener (Not at Camera).
    `,Ge?U+=`
    [SPATIAL INVERSION RULE - CRITICAL]
    - The camera has rotated 180 degrees.
    - **VISUAL NEGATION**: Any furniture/objects visible behind the characters in the PREVIOUS shot (e.g., Folding Screen, High Chair) MUST BE BEHIND THE CAMERA now.
    - **CURRENT BACKGROUND**: Show the OPPOSITE wall.
      - **STRUCTURE**: If the previous shot showed the Main Seat/Folding Screen, this shot MUST show Doors/Windows/Courtyard View.
      - **ASYMMETRY**: The two sides of the room are NOT symmetrical. One side is solid (wall/screen), the other is open (doors/windows).
    - **LIGHTING/TONE**: Keep the same color palette and lighting atmosphere, but change the geometry/objects completely.
    `:U+=`
    - **NEGATIVE PROMPT**: Third person, extra characters, crowd, listener facing camera, listener blocking view.
    `}else U+=`
    - **PRIMARY FOCUS**: The camera focuses on the Main Character listed above.
    - **ENVIRONMENT**: The character MUST be integrated into the scene (Background/Location). DO NOT isolate them on a blank background.
    - **ANGLE**: Use a cinematic angle (e.g., 3/4 view, Rule of Thirds).
    - **EYE CONTACT**: DO NOT look at the camera. Look at the invisible listener or object.
    - **COMPOSITION**: Place the character slightly off-center to create a dynamic composition.
                       `;const le=re.description.toLowerCase(),Ue=[],Ke=[];(le.includes("prison")||le.includes("jail")||le.includes("cell")||le.includes("bars"))&&(Ke.push("SEPARATED BY WOODEN LATTICE (# shape bars)"),U+=`
[HISTORICAL SETTING: JOSEON PRISON]
`,U+=`- **STRUCTURE**: Use **WOODEN LATTICE BARS** (Grid pattern / # shape). Do NOT use vertical-only bars.
`,U+=`- **MATERIAL**: Rough, thick wooden beams forming a criss-cross pattern.
`,U+=`- **FLOOR**: NO STONE FLOOR. Use **DIRT GROUND** covered with **STRAW/HAY**.
`,U+=`- **ATMOSPHERE**: Wooden structure, straw mats, sunlight coming through wooden gaps.
`,U+=`- **NEGATIVE PROMPT**: Iron bars, metal cell, stone floor, dungeon, chains, vertical only bars.
`),(le.includes("door")||le.includes("gate")||le.includes("entrance"))&&Ke.push("FRAMED BY WOODEN DOOR (Character seen through the doorway)"),le.includes("window")&&Ke.push("SEEN THROUGH WINDOW"),(le.includes("low angle")||le.includes("looking up")||le.includes("from below"))&&Ue.push("LOW ANGLE (Heroic/Intimidating)"),(le.includes("high angle")||le.includes("looking down")||le.includes("from above"))&&Ue.push("HIGH ANGLE (Vulnerable/Weak)"),(le.includes("hand")||le.includes("finger")||le.includes("fist"))&&Ue.push("EXTREME CLOSE-UP on HANDS"),(le.includes("foot")||le.includes("feet")||le.includes("shoe")||le.includes("walking"))&&Ue.push("LOW ANGLE / CLOSE-UP on FEET"),(le.includes("eye")||le.includes("tear")||le.includes("stare"))&&Ue.push("EXTREME CLOSE-UP on EYES"),(le.includes("back")||le.includes("behind")||le.includes("leaving"))&&Ue.push("BACK VIEW (Following Shot)"),(le.includes("wide")||le.includes("landscape")||le.includes("far"))&&Ue.push("WIDE SHOT (Establishing)"),(le.includes("side")||le.includes("profile"))&&Ue.push("SIDE PROFILE VIEW"),Ke.length>0&&(U+=`
[SPATIAL BARRIER - CRITICAL]
`,U+=`- **BARRIER**: ${Ke.join(" + ")}
`,U+=`- **DEPTH**: Do NOT place characters side-by-side. One must be BEHIND the barrier.
`),Ue.length>0&&(U+=`
[CAMERA ANGLE & FOCUS - CRITICAL]
`,U+=`- **MANDATORY ANGLE**: ${Ue.join(" + ")}
`,U+=`- **PRIORITY**: This angle instruction OVERRIDES standard framing. Focus on the specific body part or angle requested.
`)}B.propIds&&B.propIds.length>0&&(U+=`
[IMPORTANT PROPS/OBJECTS]
`,B.propIds.forEach(Ce=>{const Ae=E==null?void 0:E.find(De=>De.id===Ce);Ae&&(U+=` PROP: ${Ae.name}
`,U+=`  - APPEARANCE: ${Ae.description}
`,U+=`  - NOTE: Must be visible and look exactly as described.
`)})),B.subIds.length>0&&(U+=`
[BACKGROUND/EXTRAS (ATMOSPHERE)]
`,U+=`- **ROLE**: These are BACKGROUND CHARACTERS. They must NOT draw attention away from the Main Cast.
`,U+=`- **CONSISTENCY**: If the previous scene had a specific crowd, try to match their vibe/clothing.
`,B.subIds.forEach(Ce=>{const Ae=o.find(De=>De.id===Ce);if(Ae){const De=i.find(Re=>Re.name===Ae.name),Oe=De?De.description:Ae.description;U+=`- ${Ae.name}: ${Oe}
`}}))}return k(Ee=>({...Ee,[H]:U})),U},xe=(H,de)=>{A(re=>({...re,[H]:de})),he(H,de)},be=(H,de)=>{r(re=>re.map(B=>{if(B.id===H){const U=B.focusId===de?void 0:de;return{...B,focusId:U}}return B}))},Le=(H,de,re,B)=>{r(U=>U.map(ee=>{if(ee.id!==H)return ee;const Ee=ee.casting||{mainIds:[],subIds:[],propIds:[]};let Ce=[...Ee.mainIds],Ae=[...Ee.subIds],De=[...Ee.propIds||[]],Oe=ee.focusId;if(B==="remove")de==="main"&&(Ce=Ce.filter(Re=>Re!==re),Oe===re&&(Oe=void 0)),de==="sub"&&(Ae=Ae.filter(Re=>Re!==re)),de==="prop"&&(De=De.filter(Re=>Re!==re));else if(de==="main"){if(Ce.length>=6)return h("  6.","warning"),ee;Ce.includes(re)||Ce.push(re),Ae=Ae.filter(Re=>Re!==re)}else if(de==="sub"){if(Ae.length>=6)return h("  6.","warning"),ee;Ae.includes(re)||Ae.push(re),Ce=Ce.filter(Re=>Re!==re)}else if(de==="prop"){if(De.length>=3)return h("  3.","warning"),ee;De.includes(re)||De.push(re)}return{...ee,casting:{mainIds:Ce,subIds:Ae,propIds:De},focusId:Oe}}))},it=(H,de)=>{var re;m({type:"textarea",title:`SCENE ${(re=n.find(B=>B.id===H))==null?void 0:re.sceneNumber}  `,message:`      .
(          .)`,defaultValue:de,confirmText:" ",onConfirm:B=>{k(U=>({...U,[H]:B||""}))}})},Ve=H=>{var B;const de=(B=H.target.files)==null?void 0:B[0];if(!de||!W)return;const re=new FileReader;re.onload=U=>{var Ee;const ee=(Ee=U.target)==null?void 0:Ee.result;ee&&(r(Ce=>Ce.map(Ae=>Ae.id===W?{...Ae,backgroundRefUrl:ee}:Ae)),h("   .","success"),$(null))},re.readAsDataURL(de)},S=H=>{if(H===0)return h("  .","warning");const de=n[H];let re=null;for(let B=H-1;B>=0;B--)if(n[B].location===de.location&&n[B].generatedImageUrl){re=n[B].generatedImageUrl;break}!re&&n[H-1].generatedImageUrl&&(re=n[H-1].generatedImageUrl),re?(r(B=>B.map((U,ee)=>ee===H?{...U,backgroundRefUrl:re}:U)),h("   !","success")):h("      .","warning")},ie=H=>{m({type:"confirm",title:"   ",message:`     ?
(  .)`,confirmText:"",onConfirm:()=>{r(de=>de.map(re=>{if(re.id===H){const B={...re};return delete B.backgroundRefUrl,B}return re})),h("   .","success")}})},Z=()=>{confirm(`    ?
(, ,  .)

 :      .`)&&(r([]),A({}),k({}),z({}),y({}),te({}),J([]),h("   .    .","success"))},R=()=>{if(!confirm(`     ?
(       .)`))return;const H=n.map(de=>{var De,Oe,Re;const re=Q(de.scriptSegment),B=Q(de.description),U=o.filter(le=>{const Ue=Q(le.name);if(re.includes(Ue)||B.includes(Ue))return!0;const Ke=le.name.split("(")[0].trim();if(Ke.length>=2){const $e=Q(Ke);if(re.includes($e)||B.includes($e))return!0}return!1}),ee=((De=de.casting)==null?void 0:De.mainIds)||[],Ee=((Oe=de.casting)==null?void 0:Oe.subIds)||[],Ce=((Re=de.casting)==null?void 0:Re.propIds)||[],Ae=[...ee];return U.forEach(le=>{!Ae.includes(le.id)&&!Ee.includes(le.id)&&Ae.push(le.id)}),{...de,casting:{mainIds:Ae,subIds:Ee,propIds:Ce}}});r(H),h("   . (  )","success")},b=async()=>{if(!x)return h("  .","warning");if(!s)return h("API  .","warning");X(!0),h("      ...","success");try{const H=await AC(s,x);g(H),h("  .   .","success")}catch(H){h(H.message,"error")}finally{X(!1)}},F=async H=>{var B,U;let de=O[H];const re=I[H]||"background";if(de||(de=he(H,re)),!de){h(" ","error");return}y(ee=>({...ee,[H]:!0}));try{const ee=n.find(Ge=>Ge.id===H),Ee=(ee==null?void 0:ee.aspectRatio)||c||"16:9";let Ce=[],Ae=[];re!=="background"&&((B=ee==null?void 0:ee.casting)!=null&&B.mainIds)&&ee.casting.mainIds.length>0&&ee.casting.mainIds.forEach(Ge=>{const Pe=o.find(ze=>ze.id===Ge);if(Pe){const ze=i.find(Ze=>Ze.name===Pe.name);ze!=null&&ze.imageUrl&&(Ce.push(ze.imageUrl),Ae.push(Pe.name))}});const De=_[H]||"",Re=!!(ee!=null&&ee.focusId)||ee==null?void 0:ee.backgroundRefUrl;let le=[];(U=ee==null?void 0:ee.casting)!=null&&U.propIds&&ee.casting.propIds.length>0&&ee.casting.propIds.forEach(Ge=>{const Pe=E==null?void 0:E.find(ze=>ze.id===Ge);Pe&&Pe.imageUrl&&le.push(Pe.imageUrl)});let Ue,Ke=ee==null?void 0:ee.masterFullShotUrl;if(!Ke){const Ge=n.findIndex(Pe=>Pe.id===H);for(let Pe=Ge-1;Pe>=0;Pe--)if(n[Pe].location===(ee==null?void 0:ee.location)&&n[Pe].masterFullShotUrl){Ke=n[Pe].masterFullShotUrl;break}}re==="full"?Ue=ee==null?void 0:ee.generatedImageUrl:Ue=Ke||(ee==null?void 0:ee.generatedImageUrl);const $e=await Gs(s,de,a,Ee,re==="background"?"background":"cinematic",Ce,De,Re,le,p,Ue,Ae);r(Ge=>Ge.map(Pe=>{if(Pe.id===H){const ze=Pe.imageHistory?[$e,...Pe.imageHistory]:[$e];!Pe.imageHistory&&Pe.generatedImageUrl&&ze.push(Pe.generatedImageUrl);const Ze=re==="full"?$e:Pe.masterFullShotUrl;return{...Pe,generatedImageUrl:$e,masterFullShotUrl:Ze,imageHistory:ze,aspectRatio:Ee}}return Pe})),v||h(" !","success")}catch(ee){v||h(ee.message,"error")}finally{y(ee=>({...ee,[H]:!1}))}},se=async(H,de)=>{const re=n.find(B=>B.id===H);if(!(!(re!=null&&re.generatedImageUrl)||!de)){y(B=>({...B,[H]:!0})),h("  ...","success");try{const B=await bC(s,re.generatedImageUrl,de);r(U=>U.map(ee=>{if(ee.id===H){const Ee=[B,...ee.imageHistory||[]];return{...ee,generatedImageUrl:B,imageHistory:Ee}}return ee})),h(" !","success")}catch(B){h(B.message,"error")}finally{y(B=>({...B,[H]:!1}))}}},oe=async(H,de)=>{if(!s)return h("API  .","warning");Me();const re=n.findIndex(U=>U.id===H);if(re===-1)return;const B=n[re];te(U=>({...U,[H]:!0})),h(` ${de}  ... (  )`,"success");try{const U=await mC(s,B,de),ee=[...n];ee.splice(re,1,...U);const Ee=ee.map((Ce,Ae)=>({...Ce,sceneNumber:Ae+1}));r(Ee),h(`! ${B.sceneNumber}  ${de} .`,"success")}catch(U){h(U.message,"error")}finally{te(U=>({...U,[H]:!1}))}},Y=H=>{var Ee,Ce,Ae,De;if(H===0)return;Me();const de=n[H-1],re=n[H],B={mainIds:[...new Set([...((Ee=de.casting)==null?void 0:Ee.mainIds)||[],...((Ce=re.casting)==null?void 0:Ce.mainIds)||[]])],subIds:[...new Set([...((Ae=de.casting)==null?void 0:Ae.subIds)||[],...((De=re.casting)==null?void 0:De.subIds)||[]])]},U={...de,scriptSegment:`${de.scriptSegment}
${re.scriptSegment}`,description:`${de.description} ${re.description}`,casting:B},ee=[...n];ee.splice(H-1,2,U),r(ee.map((Oe,Re)=>({...Oe,sceneNumber:Re+1}))),h(`${H+1} ${H}  .`,"success")},pe=H=>{H!==n.length-1&&Y(H+1)},ve=async()=>{const H=n.filter(B=>B.generatedImageUrl);if(H.length===0)return h("   .","warning");const de=new Yl;let re=0;h(`${H.length}   ...`,"success");try{const B=H.map(async U=>{if(U.generatedImageUrl)try{const Ee=`${U.sceneNumber.toString().padStart(2,"0")}_Scene_${U.sceneNumber}.png`,Ae=await(await fetch(U.generatedImageUrl)).blob();de.file(Ee,Ae),re++}catch(ee){console.error(`Failed to fetch image for scene ${U.sceneNumber}`,ee)}});if(await Promise.all(B),re>0){const U=await de.generateAsync({type:"blob"});ls.saveAs(U,"Sintong_Scenes.zip"),h("   .","success")}else h("   .","error")}catch(B){console.error("Zip generation failed",B),h("     .","error")}},[fe,Se]=ue.useState(null),He=async()=>{if(!s)return h("API  .","warning");const H=n.filter(de=>!de.generatedImageUrl);if(H.length===0)return h("    .","warning");m({type:"confirm",title:"  (  )",message:` ${H.length}   .

[ ]
1. :   (//   )
2. :    
3. :  (${c}) 

:       .`,confirmText:"   ",onConfirm:async()=>{T(!0),Se({current:0,total:H.length,startTime:Date.now()}),h("    ... ( 5  )","success");const de=["full","mls","ws","bs","cu"];let re=0;const B=5;for(let U=0;U<H.length;U+=B){const Ee=H.slice(U,U+B).map(async(Ce,Ae)=>{var De;try{const Oe=de[Math.floor(Math.random()*de.length)];A(Pe=>({...Pe,[Ce.id]:Oe}));const Re=he(Ce.id,Oe),le=Ce.aspectRatio||c||"16:9";let Ue=[],Ke=[];Oe!=="background"&&((De=Ce==null?void 0:Ce.casting)!=null&&De.mainIds)&&Ce.casting.mainIds.length>0&&Ce.casting.mainIds.forEach(Pe=>{const ze=o.find(Ze=>Ze.id===Pe);if(ze){const Ze=i.find(Gt=>Gt.name===ze.name);Ze!=null&&Ze.imageUrl&&(Ue.push(Ze.imageUrl),Ke.push(ze.name))}});const $e=_[Ce.id]||"",Ge=await Gs(s,Re||"Scene",a,le,"cinematic",Ue,$e,void 0,void 0,p,void 0,Ke);r(Pe=>Pe.map(ze=>{if(ze.id===Ce.id){const Ze=ze.imageHistory?[Ge,...ze.imageHistory]:[Ge];return!ze.imageHistory&&ze.generatedImageUrl&&Ze.push(ze.generatedImageUrl),{...ze,generatedImageUrl:Ge,imageHistory:Ze,aspectRatio:le}}return ze})),re++}catch(Oe){console.error(`Failed scene ${Ce.sceneNumber}`,Oe)}finally{Se(Oe=>Oe?{...Oe,current:Math.min(Oe.current+1,Oe.total)}:null)}});await Promise.all(Ee)}T(!1),Se(null),h(`  ! (${re}/${H.length} )`,"success")}})},ke=(H,de)=>{const re=document.createElement("a");re.href=H,re.download=de,re.click()},rt=(H,de)=>{r(re=>re.map(B=>B.id===H?{...B,generatedImageUrl:de}:B))},mt=(H,de,re)=>{H.stopPropagation(),confirm("   ?")&&r(B=>B.map(U=>{var ee;if(U.id===de){const Ee=((ee=U.imageHistory)==null?void 0:ee.filter(Ae=>Ae!==re))||[];let Ce=U.generatedImageUrl;return U.generatedImageUrl===re&&(Ce=Ee.length>0?Ee[0]:void 0),{...U,imageHistory:Ee,generatedImageUrl:Ce}}return U}))},ct=async H=>{const de=n.find(re=>re.id===H);if(de!=null&&de.generatedImageUrl){if(!s)return h("API  .","warning");m({type:"confirm",title:"  ",message:"   ,  () ?",confirmText:"",onConfirm:async()=>{y(re=>({...re,[H]:!0}));try{const re=await CC(s,de.generatedImageUrl);r(B=>B.map(U=>{if(U.id===H){const ee=[re,...U.imageHistory||[]];return{...U,generatedImageUrl:re,imageHistory:ee}}return U})),h(" .","success")}catch(re){h(re.message,"error")}finally{y(re=>({...re,[H]:!1}))}}})}},vt=async H=>{const de=n.find(re=>re.id===H);if(de!=null&&de.generatedImageUrl){if(!s)return h("API  .","warning");m({type:"confirm",title:"  ( )",message:`     ?
(    )`,confirmText:" ",onConfirm:async()=>{y(re=>({...re,[H]:!0}));try{const re=await IC(s,de.generatedImageUrl);r(B=>B.map(U=>{if(U.id===H){const ee=[re,...U.imageHistory||[]];return{...U,generatedImageUrl:re,imageHistory:ee}}return U})),h(" .","success")}catch(re){h(re.message,"error")}finally{y(re=>({...re,[H]:!1}))}}})}},qe=(H,de)=>{r(re=>re.map(B=>B.id===H?{...B,aspectRatio:de}:B)),h(`   ${de} .`,"success")},an=()=>{if(!v||!fe)return null;const H=Math.round(fe.current/fe.total*100),de=Math.floor((Date.now()-fe.startTime)/1e3),re=B=>{const U=Math.floor(B/60),ee=B%60;return`${U}:${ee.toString().padStart(2,"0")}`};return u.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:u.jsxs("div",{className:"bg-white rounded-xl p-8 max-w-md w-full shadow-2xl text-center space-y-6 animate-pulse-slow",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx("h3",{className:"text-2xl font-bold text-indigo-700",children:"   ..."}),u.jsx("p",{className:"text-gray-500",children:" .   ."})]}),u.jsxs("div",{className:"relative pt-1",children:[u.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[u.jsx("div",{children:u.jsx("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-indigo-600 bg-indigo-200",children:"Progress"})}),u.jsx("div",{className:"text-right",children:u.jsxs("span",{className:"text-xs font-semibold inline-block text-indigo-600",children:[H,"% (",fe.current," / ",fe.total,")"]})})]}),u.jsx("div",{className:"overflow-hidden h-4 mb-4 text-xs flex rounded bg-indigo-100",children:u.jsx("div",{style:{width:`${H}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-indigo-600 transition-all duration-500 ease-out"})})]}),u.jsx("div",{className:"flex justify-center text-sm bg-gray-50 p-4 rounded-lg",children:u.jsxs("div",{className:"flex flex-col items-center",children:[u.jsx("span",{className:"text-gray-400",children:" "}),u.jsx("span",{className:"font-mono font-bold text-gray-700",children:re(de)})]})}),u.jsx("button",{onClick:()=>{confirm("?        .")&&window.location.reload()},className:"text-red-400 hover:text-red-600 text-sm underline decoration-red-300",children:"  "})]})})};return u.jsxs("div",{className:"space-y-6 animate-fade-in relative",children:[u.jsx("div",{ref:M}),u.jsxs("div",{className:"fixed left-6 bottom-20 flex flex-col gap-2 z-50",children:[u.jsx("button",{onClick:Te,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:u.jsx("i",{className:"fas fa-arrow-up"})}),u.jsx("button",{onClick:q,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:u.jsx("i",{className:"fas fa-arrow-down"})})]}),an(),u.jsx("input",{type:"file",ref:K,onChange:Ve,accept:"image/*",className:"hidden"}),u.jsxs("div",{className:"flex flex-col xl:flex-row justify-between items-center bg-slate-800 p-6 rounded-xl border border-slate-700 gap-4",children:[u.jsxs("div",{children:[u.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["   (",n.length,")"]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("span",{className:"text-sm text-slate-400",children:"  :"}),u.jsxs("select",{value:c,onChange:H=>d(H.target.value),className:"bg-slate-900 border border-slate-600 rounded px-2 py-1 text-sm font-bold text-indigo-300 focus:ring-2 focus:ring-indigo-500",children:[u.jsx("option",{value:"16:9",children:"16:9 ()"}),u.jsx("option",{value:"9:16",children:"9:16 (/)"}),u.jsx("option",{value:"1:1",children:"1:1 ()"}),u.jsx("option",{value:"4:3",children:"4:3 ()"}),u.jsx("option",{value:"3:4",children:"3:4 ()"})]})]})]}),u.jsxs("div",{className:"flex gap-3 items-center",children:[u.jsxs("button",{onClick:Z,className:"px-4 py-3 rounded-lg font-bold bg-red-900/50 hover:bg-red-900 text-red-200 border border-red-700/50 flex items-center gap-2",title:"     (/ )",children:[u.jsx("i",{className:"fas fa-trash-restore"}),"  "]}),u.jsxs("button",{onClick:R,className:"px-4 py-3 rounded-lg font-bold bg-indigo-900/50 hover:bg-indigo-900 text-indigo-200 border border-indigo-700/50 flex items-center gap-2",title:"     (  )",children:[u.jsx("i",{className:"fas fa-sync-alt"}),"  "]}),ge.length>0&&u.jsxs("button",{onClick:Be,className:"px-4 py-3 rounded-lg font-bold bg-slate-700 hover:bg-slate-600 text-slate-200 border border-slate-600 flex items-center gap-2",title:" / ",children:[u.jsx("i",{className:"fas fa-undo"}),"  "]}),u.jsxs("button",{onClick:He,disabled:v||e,className:`px-5 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2 border transition-all ${v?"bg-yellow-700 text-yellow-100 border-yellow-600 animate-pulse":"bg-slate-700 hover:bg-slate-600 text-slate-200 border-slate-600"}`,children:[v?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-layer-group"}),v?" ...":"   "]}),u.jsxs("button",{onClick:ve,disabled:v,className:"px-5 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2 border transition-all bg-indigo-700 hover:bg-indigo-600 text-white border-indigo-500",title:"     ",children:[u.jsx("i",{className:"fas fa-file-archive"}),"  "]}),u.jsxs("button",{onClick:t,disabled:e||v,className:"bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2",children:[e?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-arrow-right"})," () "]})]})]}),u.jsxs("div",{className:"bg-indigo-900/30 border border-indigo-500/50 rounded-xl p-6 shadow-lg",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>D(!j),children:[u.jsxs("h3",{className:"text-lg font-bold text-indigo-200 flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-globe-asia"})," []  / "]}),u.jsx("i",{className:`fas fa-chevron-${j?"up":"down"} text-indigo-400`})]}),j&&u.jsxs("div",{className:"animate-fade-in",children:[u.jsxs("p",{className:"text-sm text-slate-400 mb-2",children:["  ",u.jsx("strong",{children:"  "}),'. "   ", "  ", "    "  AI     .']}),u.jsx("div",{className:"flex justify-end mb-2",children:u.jsxs("button",{onClick:b,disabled:V,className:"text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded flex items-center gap-2 border border-indigo-400 shadow-sm",children:[V?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-magic"}),"   /"]})}),u.jsx("textarea",{value:p,onChange:H=>g(H.target.value),placeholder:":      .      .          .",className:"w-full h-32 bg-slate-800 border border-slate-600 rounded-lg p-3 text-sm text-white focus:ring-2 focus:ring-indigo-500 resize-none leading-relaxed"}),u.jsx("div",{className:"flex justify-end mt-2",children:u.jsxs("button",{onClick:()=>{n.forEach(H=>he(H.id,I[H.id]||"background")),h("     . ( )","success")},className:"text-xs bg-indigo-700 hover:bg-indigo-600 text-white px-3 py-1.5 rounded flex items-center gap-1",children:[u.jsx("i",{className:"fas fa-sync-alt"}),"   "]})})]})]}),u.jsx("div",{className:"space-y-12",children:n.map((H,de)=>{var re,B,U,ee,Ee,Ce,Ae,De,Oe,Re;return u.jsxs("div",{className:"bg-slate-800 rounded-2xl overflow-hidden border border-slate-700 shadow-xl",children:[u.jsxs("div",{className:"bg-slate-900/50 p-6 border-b border-slate-700",children:[u.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-3",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsxs("span",{className:"bg-indigo-600 text-white px-3 py-1 rounded text-sm font-bold whitespace-nowrap",children:["SCENE ",H.sceneNumber]}),u.jsx("h3",{className:"text-xl md:text-2xl font-bold text-white truncate max-w-[200px] md:max-w-md",children:H.location}),u.jsx("span",{className:"text-slate-400 text-sm border border-slate-600 px-2 py-0.5 rounded-full whitespace-nowrap",children:H.timeOfDay})]}),u.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[u.jsxs("div",{className:"flex items-center gap-1 bg-slate-800 rounded-lg p-1 border border-slate-600",children:[u.jsxs("span",{className:"text-[10px] text-slate-400 px-2 font-bold uppercase",children:[u.jsx("i",{className:"fas fa-link mr-1"}),""]}),u.jsx("button",{onClick:()=>Y(de),disabled:de===0,className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"   (     )",children:u.jsx("i",{className:"fas fa-arrow-up"})}),u.jsx("button",{onClick:()=>pe(de),disabled:de===n.length-1,className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"   (     )",children:u.jsx("i",{className:"fas fa-arrow-down"})})]}),u.jsxs("div",{className:"flex items-center gap-1 bg-slate-800 rounded-lg p-1 border border-slate-600",children:[u.jsxs("span",{className:"text-[10px] text-slate-400 px-2 font-bold uppercase",children:[u.jsx("i",{className:"fas fa-cut mr-1"}),""]}),u.jsx("button",{onClick:()=>oe(H.id,2),disabled:N[H.id],className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors",title:"     2 ",children:"2"}),u.jsx("button",{onClick:()=>oe(H.id,3),disabled:N[H.id],className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors",title:"     3 ",children:"3"})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-xs text-slate-500",children:":"}),u.jsxs("select",{value:H.aspectRatio||c,onChange:le=>qe(H.id,le.target.value),className:"bg-slate-800 text-xs text-slate-300 border border-slate-600 rounded px-1 py-1",children:[u.jsx("option",{value:"16:9",children:"16:9"}),u.jsx("option",{value:"9:16",children:"9:16"}),u.jsx("option",{value:"1:1",children:"1:1"}),u.jsx("option",{value:"4:3",children:"4:3"}),u.jsx("option",{value:"3:4",children:"3:4"})]})]})]})]}),N[H.id]&&u.jsxs("div",{className:"mb-4 bg-indigo-900/30 border border-indigo-500/30 text-indigo-300 px-4 py-2 rounded text-sm flex items-center gap-3 animate-pulse",children:[u.jsx("i",{className:"fas fa-spinner fa-spin"}),u.jsx("span",{children:"AI      ..."})]}),u.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-600/50",children:[u.jsxs("p",{className:"text-indigo-300 text-sm font-bold mb-1",children:[u.jsx("i",{className:"fas fa-quote-left mr-2"})," "]}),u.jsx("p",{className:"text-lg text-slate-200",children:H.scriptSegment})]})]}),u.jsx("div",{className:"p-6",children:u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[u.jsxs("div",{className:"lg:col-span-2 flex flex-col gap-4",children:[u.jsxs("div",{className:"relative w-full bg-black rounded-lg overflow-hidden border border-slate-700 flex items-center justify-center transition-all",style:{width:"100%",aspectRatio:(H.aspectRatio||c).replace(":","/")},children:[H.generatedImageUrl?u.jsx("img",{src:H.generatedImageUrl,alt:"Background",className:"w-full h-full object-contain"}):u.jsxs("div",{className:"text-slate-600 flex flex-col items-center",children:[u.jsx("i",{className:"fas fa-image text-6xl mb-4 opacity-30"}),u.jsx("span",{children:" "})]}),w[H.id]&&u.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center backdrop-blur-sm",children:u.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-indigo-500"})}),I[H.id]&&I[H.id]!=="background"&&u.jsx("div",{className:"absolute top-4 right-4 bg-black/80 text-white text-xs px-2 py-1 rounded border border-white/30 backdrop-blur-md",children:(re=Xf.find(le=>le.value===I[H.id]))==null?void 0:re.label}),H.backgroundRefUrl&&u.jsxs("div",{className:"absolute bottom-4 left-4 bg-blue-900/80 text-white text-xs px-2 py-1 rounded border border-blue-500 flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-layer-group"}),"    ( )"]})]}),H.imageHistory&&H.imageHistory.length>0&&u.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 custom-scrollbar",children:H.imageHistory.map((le,Ue)=>u.jsxs("div",{onClick:()=>rt(H.id,le),className:`relative group flex-shrink-0 w-16 h-16 rounded cursor-pointer border-2 transition-all hover:scale-105 ${H.generatedImageUrl===le?"border-indigo-500 ring-1":"border-slate-700 opacity-60"}`,children:[u.jsx("img",{src:le,alt:"History",className:"w-full h-full object-cover rounded-[inherit]"}),u.jsx("button",{onClick:Ke=>mt(Ke,H.id,le),className:"absolute -top-2 -right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-[10px] opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-10",title:"",children:u.jsx("i",{className:"fas fa-times"})})]},Ue))}),H.generatedImageUrl&&u.jsxs("div",{className:"flex gap-2",children:[u.jsxs("button",{onClick:()=>ke(H.generatedImageUrl,`scene_${H.sceneNumber}.png`),className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white px-4 py-3 rounded-lg font-bold border border-slate-600 flex items-center justify-center gap-2",children:[u.jsx("i",{className:"fas fa-download"})," "]}),I[H.id]!=="background"&&u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:()=>ct(H.id),className:"flex-1 bg-green-900/50 hover:bg-green-800/80 text-green-300 hover:text-white px-4 py-3 rounded-lg font-bold border border-green-700/50 flex items-center justify-center gap-2",title:"    ",children:[u.jsx("i",{className:"fas fa-magic"}),"  "]}),u.jsxs("button",{onClick:()=>vt(H.id),className:"flex-1 bg-slate-700 hover:bg-red-900/50 text-slate-300 hover:text-red-300 px-4 py-3 rounded-lg font-bold border border-slate-600 hover:border-red-700 flex items-center justify-center gap-2",title:"    ",children:[u.jsx("i",{className:"fas fa-user-slash"}),"  "]})]})]}),H.generatedImageUrl&&u.jsxs("div",{className:"mt-2 bg-purple-900/20 border border-purple-500/30 p-4 rounded-lg",children:[u.jsxs("label",{className:"text-sm font-bold text-purple-300 block mb-2",children:[u.jsx("i",{className:"fas fa-magic mr-2"}),"  (   )"]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("input",{type:"text",id:`fix-input-${H.id}`,placeholder:":   ,   ",className:"flex-1 bg-slate-900 border border-purple-500/50 rounded-lg px-4 py-3 text-white focus:border-purple-400 focus:ring-1 focus:ring-purple-400 placeholder-slate-500",onKeyDown:le=>{if(le.key==="Enter"){const Ue=le.currentTarget.value;Ue&&se(H.id,Ue)}}}),u.jsx("button",{onClick:()=>{const le=document.getElementById(`fix-input-${H.id}`);le&&le.value&&se(H.id,le.value)},disabled:w[H.id],className:"bg-purple-600 hover:bg-purple-500 text-white px-6 py-3 rounded-lg font-bold shadow-lg whitespace-nowrap",children:w[H.id]?u.jsx("i",{className:"fas fa-spinner fa-spin"}):" "})]}),u.jsx("p",{className:"text-xs text-purple-400/70 mt-2 ml-1",children:"* 3     .     ."})]})]}),u.jsxs("div",{className:"lg:col-span-1 flex flex-col gap-4",children:[u.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-700",children:[u.jsxs("label",{className:"text-xs font-bold text-slate-400 mb-2 block uppercase",children:[u.jsx("i",{className:"fas fa-camera mr-1"}),"   ( )"]}),u.jsx("div",{className:"flex gap-2 flex-wrap",children:Xf.map(le=>u.jsx("button",{onClick:()=>xe(H.id,le.value),className:`px-3 py-2 rounded text-xs font-bold border transition-all ${I[H.id]===le.value||!I[H.id]&&le.value==="background"?"bg-indigo-600 text-white border-indigo-500":"bg-slate-800 text-slate-400 border-slate-600 hover:bg-slate-700"}`,children:le.label},le.value))})]}),I[H.id]!=="background"&&u.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-700",children:[u.jsxs("h4",{className:"text-sm font-bold text-white mb-3 flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-users-cog text-yellow-500"}),"  "]}),u.jsxs("div",{className:"mb-4",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("label",{className:"text-xs font-bold text-indigo-400",children:"  (Foreground)"}),u.jsxs("select",{className:"bg-slate-800 text-xs text-white border border-slate-600 rounded px-2 py-1 w-24",onChange:le=>{le.target.value&&Le(H.id,"main",le.target.value,"add"),le.target.value=""},children:[u.jsx("option",{value:"",children:"+ "}),o.map(le=>u.jsx("option",{value:le.id,children:le.name},le.id))]})]}),u.jsxs("div",{className:"flex flex-col gap-2 min-h-[30px]",children:[(U=(B=H.casting)==null?void 0:B.mainIds)==null?void 0:U.map(le=>{const Ue=o.find($e=>$e.id===le),Ke=H.focusId===le;return Ue?u.jsxs("div",{className:`flex items-center justify-between p-2 rounded-lg border ${Ke?"bg-indigo-900/80 border-indigo-400":"bg-slate-800 border-slate-700"}`,children:[u.jsx("div",{className:"flex items-center gap-2",children:u.jsx("span",{className:`text-xs font-bold ${Ke?"text-white":"text-slate-300"}`,children:Ue.name})}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("button",{onClick:()=>be(H.id,le),className:`text-[10px] px-2 py-0.5 rounded border ${Ke?"bg-indigo-500 text-white border-indigo-400":"bg-slate-700 text-slate-400 border-slate-600 hover:bg-slate-600"}`,title:Ke?"   ( )":"    ",children:[u.jsx("i",{className:`fas ${Ke?"fa-video":"fa-video-slash"} mr-1`}),Ke?"ON":"OFF"]}),u.jsx("button",{onClick:()=>Le(H.id,"main",le,"remove"),className:"text-slate-500 hover:text-red-400",children:u.jsx("i",{className:"fas fa-times"})})]})]},le):null}),(!((ee=H.casting)!=null&&ee.mainIds)||H.casting.mainIds.length===0)&&u.jsx("span",{className:"text-xs text-slate-600",children:" "}),((Ee=H.casting)==null?void 0:Ee.mainIds)&&H.casting.mainIds.length>=2&&!H.focusId&&u.jsxs("div",{className:"mt-2 bg-slate-900/50 p-2 rounded border border-slate-600",children:[u.jsxs("p",{className:"text-[10px] text-slate-300 mb-1",children:[u.jsx("i",{className:"fas fa-video mr-1"})," ",u.jsx("strong",{children:"  "})]}),u.jsxs("ul",{className:"text-[10px] text-slate-400 space-y-1 list-disc pl-3",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"():"}),"  [ON]      . (    )"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"/OTS:"}),"   ",u.jsx("span",{className:"text-indigo-400 font-bold",children:"[ON]"}),",     ."]})]})]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("label",{className:"text-xs font-bold text-slate-400",children:" (Background)"}),u.jsxs("select",{className:"bg-slate-800 text-xs text-white border border-slate-600 rounded px-2 py-1 w-24",onChange:le=>{le.target.value&&Le(H.id,"sub",le.target.value,"add"),le.target.value=""},children:[u.jsx("option",{value:"",children:"+ "}),o.map(le=>u.jsx("option",{value:le.id,children:le.name},le.id))]})]}),u.jsx("div",{className:"flex gap-2 flex-wrap min-h-[30px]",children:(Ae=(Ce=H.casting)==null?void 0:Ce.subIds)==null?void 0:Ae.map(le=>{const Ue=o.find(Ke=>Ke.id===le);return Ue?u.jsxs("div",{className:"bg-slate-700 text-slate-300 text-xs px-2 py-1 rounded-full flex items-center gap-1 border border-slate-600",children:[u.jsx("span",{children:Ue.name}),u.jsx("button",{onClick:()=>Le(H.id,"sub",le,"remove"),className:"hover:text-red-300",children:u.jsx("i",{className:"fas fa-times"})})]},le):null})})]}),u.jsxs("div",{className:"mt-4 border-t border-slate-800 pt-4",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("label",{className:"text-xs font-bold text-green-400",children:"   (Props)"}),u.jsxs("select",{className:"bg-slate-800 text-xs text-white border border-slate-600 rounded px-2 py-1 w-24",onChange:le=>{le.target.value&&Le(H.id,"prop",le.target.value,"add"),le.target.value=""},children:[u.jsx("option",{value:"",children:"+ "}),E&&E.map(le=>u.jsx("option",{value:le.id,children:le.name},le.id))]})]}),u.jsxs("div",{className:"flex gap-2 flex-wrap min-h-[30px]",children:[(Oe=(De=H.casting)==null?void 0:De.propIds)==null?void 0:Oe.map(le=>{const Ue=E==null?void 0:E.find(Ke=>Ke.id===le);return Ue?u.jsxs("div",{className:"bg-green-700 text-green-100 text-xs px-2 py-1 rounded-full flex items-center gap-1 shadow-sm",children:[u.jsx("span",{children:Ue.name}),u.jsx("button",{onClick:()=>Le(H.id,"prop",le,"remove"),className:"hover:text-red-300",children:u.jsx("i",{className:"fas fa-times"})})]},le):null}),(!((Re=H.casting)!=null&&Re.propIds)||H.casting.propIds.length===0)&&u.jsx("span",{className:"text-xs text-slate-600",children:" "})]})]})]}),u.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-700",children:[u.jsxs("label",{className:"text-xs font-bold text-blue-400 mb-2 block uppercase flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-image"}),"   ( )"]}),H.backgroundRefUrl?u.jsxs("div",{className:"relative",children:[u.jsxs("div",{className:"w-full h-20 bg-black rounded border border-blue-500 overflow-hidden mb-2 relative",children:[u.jsx("img",{src:H.backgroundRefUrl,alt:"Background Ref",className:"w-full h-full object-cover opacity-70"}),u.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold text-white bg-black/50 text-center leading-tight",children:["  ",u.jsx("br",{}),"(/ )"]})]}),u.jsxs("button",{onClick:()=>ie(H.id),className:"relative z-20 w-full text-xs text-white bg-red-800 hover:bg-red-600 border border-red-500 rounded py-3 transition-colors font-bold cursor-pointer shadow-md",children:[u.jsx("i",{className:"fas fa-trash-alt mr-1"}),"    ()"]})]}):u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs("button",{onClick:()=>S(de),className:"bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs py-2 px-1 rounded border border-slate-600 flex flex-col items-center gap-1",title:"    ",children:[u.jsx("i",{className:"fas fa-arrow-left"}),"  "]}),u.jsxs("button",{onClick:()=>{var le;$(H.id),(le=K.current)==null||le.click()},className:"bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs py-2 px-1 rounded border border-slate-600 flex flex-col items-center gap-1",title:"PC  ",children:[u.jsx("i",{className:"fas fa-upload"}),"  "]})]}),u.jsxs("p",{className:"text-[10px] text-slate-500 mt-2 leading-tight",children:["*      ",u.jsx("strong",{children:"()"}),"  ."]})]}),u.jsxs("div",{className:"flex-grow flex flex-col gap-2",children:[u.jsxs("div",{className:"flex justify-between items-end",children:[u.jsxs("label",{className:"text-xs font-bold text-green-400 uppercase",children:[u.jsx("i",{className:"fas fa-terminal mr-1"})," AI  "]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs("button",{onClick:()=>it(H.id,O[H.id]||""),className:"text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-2 py-1 rounded border border-indigo-500 transition-colors shadow-sm",children:[u.jsx("i",{className:"fas fa-expand-arrows-alt mr-1"}),"  "]}),u.jsx("button",{onClick:()=>{he(H.id,I[H.id]||"background"),h("   .","success")},className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors",title:"    ",children:u.jsx("i",{className:"fas fa-sync-alt"})})]})]}),u.jsx("textarea",{value:O[H.id]||"",onChange:le=>k(Ue=>({...Ue,[H.id]:le.target.value})),onDoubleClick:()=>it(H.id,O[H.id]||""),placeholder:"       .",className:"w-full h-24 bg-black/30 border border-slate-600 rounded-lg p-3 text-xs text-slate-300 font-mono focus:ring-1 focus:ring-green-500 focus:border-green-500 resize-none leading-relaxed cursor-text"})]}),u.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 p-4 rounded-lg mt-auto",children:[u.jsxs("label",{className:"text-sm font-bold text-red-400 block mb-2",children:[u.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),"    (  )"]}),u.jsx("input",{type:"text",value:_[H.id]||"",onChange:le=>z(Ue=>({...Ue,[H.id]:le.target.value})),placeholder:":   ,  ,  ",className:"w-full bg-slate-900 border border-red-500/50 rounded-lg px-4 py-3 text-white focus:border-red-500 focus:ring-1 focus:ring-red-500 placeholder-slate-500"})]}),u.jsxs("button",{onClick:()=>F(H.id),disabled:w[H.id]||v,className:`w-full py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all ${I[H.id]&&I[H.id]!=="background"?"bg-indigo-600 hover:bg-indigo-500 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-200"}`,children:[w[H.id]?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-magic"}),H.generatedImageUrl?"   ":"  (Generate)"]})]})]})})]},H.id)})}),u.jsx("div",{ref:ce})]})},jC=()=>{var sc;const{script:t,characters:e,referenceImages:n,apiKey:r,selectedStyle:o,setSelectedStyle:i,globalAspectRatio:s,showToast:a,props:c,scriptSegments:d,globalScenePrompt:h,openModal:m}=yn(),[p,g]=ue.useState("ALL"),[E,x]=ue.useState("auto"),[w,y]=ue.useState("auto"),[v,T]=ue.useState(!1),I=ue.useRef(null),A=ue.useRef(null),O=ue.useRef(null),k=ue.useRef(null),j=()=>{var C;return(C=I.current)==null?void 0:C.scrollIntoView({behavior:"smooth"})},D=()=>{var C;return(C=A.current)==null?void 0:C.scrollIntoView({behavior:"smooth"})},[V,X]=ue.useState([]),[_,z]=ue.useState({}),[N,te]=ue.useState(null),[ge,J]=ue.useState([]),[K,M]=ue.useState([]),[ce,W]=ue.useState(!1),[$,Te]=ue.useState("16:9"),[q,Q]=ue.useState(null),[Me,Be]=ue.useState(!1),[he,xe]=ue.useState(null),[be,Le]=ue.useState(!1),[it,Ve]=ue.useState(null),[S,ie]=ue.useState(""),[Z,R]=ue.useState(1),[b,F]=ue.useState(!1),[se,oe]=ue.useState(!1),[Y,pe]=ue.useState(null),[ve,fe]=ue.useState(!1),[Se,He]=ue.useState(""),[ke,rt]=ue.useState([]),[mt,ct]=ue.useState(!1);ue.useEffect(()=>{(async()=>{if(typeof window<"u"){const G=localStorage.getItem("bangtong-favorite-fonts_v2");if(G)try{rt(JSON.parse(G))}catch{}const ne=localStorage.getItem("bangtong-opening-sequence_v2");if(ne)try{const ye=JSON.parse(ne);Array.isArray(ye)&&ye.length>0&&(await hr("bangtong-opening-sequence_v2",ye),X(ye)),localStorage.removeItem("bangtong-opening-sequence_v2")}catch{}else{const ye=await Mr("bangtong-opening-sequence_v2");ye&&X(ye)}const L=localStorage.getItem("bangtong-hooking-texts_v2");if(L)try{const ye=JSON.parse(L);Array.isArray(ye)&&ye.length>0&&(await hr("bangtong-hooking-texts_v2",ye),J(ye)),localStorage.removeItem("bangtong-hooking-texts_v2")}catch{}else{const ye=await Mr("bangtong-hooking-texts_v2");ye&&J(ye)}const P=await Mr("bangtong-hooking-script");P&&ie(P);const ae=await Mr("bangtong-opening-sequence_v2");ae&&ae.length>0&&R(2);const we=await Mr("bangtong-thumbnail-data_v2");we&&(we.characters&&Array.isArray(we.characters)?Q(we):(console.log("Old thumbnail data format detected. Clearing."),await pr("bangtong-thumbnail-data_v2"),Q(null)))}})()},[]),ue.useEffect(()=>{V.length>0&&hr("bangtong-opening-sequence",V)},[V]),ue.useEffect(()=>{ge.length>0&&hr("bangtong-hooking-texts",ge)},[ge]),ue.useEffect(()=>{S&&hr("bangtong-hooking-script",S)},[S]),ue.useEffect(()=>{q&&hr("bangtong-thumbnail-data",q)},[q]);const vt=async()=>{window.confirm(`   ?
(,  ,   )`)&&(X([]),J([]),Q(null),ie(""),R(1),await pr("bangtong-opening-sequence"),await pr("bangtong-hooking-texts"),await pr("bangtong-thumbnail-data"),await pr("bangtong-hooking-script"),localStorage.removeItem("bangtong-opening-sequence"),a("   .","success"))},[qe,an]=ue.useState([{name:" ()",value:"sans-serif"},{name:" ()",value:"serif"},{name:"",value:"Gungsuh, serif"},{name:"",value:"Gulim, sans-serif"},{name:"",value:"Dotum, sans-serif"},{name:"Impact ( )",value:"Impact, sans-serif"},{name:"Arial Black",value:'"Arial Black", sans-serif'},{name:"",value:'"Nanum Gothic", sans-serif'},{name:"",value:'"Nanum Myeongjo", serif'},{name:" ",value:'"BM DoHyeon", sans-serif'},{name:" ",value:'"BM Jua", sans-serif'}]),H=async()=>{if(!("queryLocalFonts"in window)){a("      . (Chrome/Edge  )","error");return}fe(!0);try{const C=await window.queryLocalFonts(),G=new Set,ne=[];for(const L of C){const P=L.fullName||L.family;G.has(P)||(G.add(P),ne.push({name:P,value:`"${L.family}", sans-serif`}))}ne.sort((L,P)=>L.name.localeCompare(P.name,"ko")),an(L=>{const P=new Set(L.map(we=>we.name)),ae=ne.filter(we=>!P.has(we.name));return[...L,...ae]}),a(`${ne.length}   !`,"success")}catch(C){console.error(C),a("   . ( )","error")}finally{fe(!1)}},de=C=>{rt(G=>{let ne;return G.includes(C)?ne=G.filter(L=>L!==C):ne=[...G,C],localStorage.setItem("bangtong-favorite-fonts_v2",JSON.stringify(ne)),ne})},re=async()=>{if(!r)return a("API  .","warning");if(K.length===0)return a("  .","warning");ct(!0);let C=0;try{const G=await Promise.all(K.map(async L=>{try{const P=await PC(r,L);return{original:L,variations:P}}catch(P){return console.error(`Failed to twist "${L}"`,P),{original:L,variations:[]}}})),ne=new Map;G.forEach(L=>{L.variations.length>0&&(ne.set(L.original,L.variations),C+=L.variations.length)}),C===0?a("   .","error"):(J(L=>{const P=[];return ne.forEach(ae=>{P.push(...ae)}),P}),M([]),a(`${C}   ! (  )`,"success"))}catch(G){a(G.message,"error")}finally{ct(!1)}},B=async C=>{var G;if(!t)return a(" .","warning");if(!r)return a("API  .","warning");Be(!0);try{let ne="";if(kr&&(ne+=`[  ]: ${kr}
`),xn.length>0){const ye=Ei.filter(_e=>xn.includes(_e.id));ye.length>0&&(ne+=`[    (  )]:
${ye.map(_e=>`- : ${_e.title} (${_e.composition==="right"?" ":_e.composition==="left"?" ":" "})
  : ${_e.description}`).join(`
`)}`)}const L=await SC(r,t,e,E,C,ne),P=L.characters.map(ye=>{const _e=e.find(Je=>Je.name===ye.name);return{...ye,appearance:_e?_e.description:""}}),ae=[{name:" ()",value:"sans-serif"},{name:" ()",value:"serif"},{name:"",value:"Gungsuh, serif"},{name:"",value:"Gulim, sans-serif"},{name:"",value:"Dotum, sans-serif"},{name:"Impact ( )",value:"Impact, sans-serif"},{name:"Arial Black",value:'"Arial Black", sans-serif'},{name:"",value:'"Nanum Gothic", sans-serif'},{name:"",value:'"Nanum Myeongjo", serif'},{name:" ",value:'"BM DoHyeon", sans-serif'},{name:" ",value:'"BM Jua", sans-serif'}],we=C?[{id:"line-1",text:C,color:"#FFFFFF",size:48,x:10,y:50,fontFamily:"sans-serif",fontWeight:"900",outlineColor:"#000000",outlineWidth:8,heightScale:1}]:[{id:"line-1",text:L.title,color:"#FFFFFF",size:48,x:10,y:50,fontFamily:"sans-serif",fontWeight:"900",outlineColor:"#000000",outlineWidth:8,heightScale:1}];Q({title:L.title,composition:(G=L.composition)!=null&&G.toLowerCase().includes("right")?"right":"center",action:L.action,characters:P,textLines:we,gradientDirection:"left-to-right",gradientPosition:40,negativeSpaceRatio:40}),a("  !","success")}catch(ne){a(ne.message,"error")}finally{Be(!1)}},U=(C,G)=>{Q(ne=>ne?{...ne,[C]:G}:null)},ee=C=>{const G=e.find(ne=>ne.id===C);!G||!q||Q(ne=>ne?ne.characters.some(L=>L.name===G.name)?ne:{...ne,characters:[...ne.characters,{name:G.name,action:"Standing",appearance:G.description}]}:null)},Ee=(C,G,ne)=>{Q(L=>{if(!L)return null;const P=[...L.characters];return P[C]={...P[C],[G]:ne},{...L,characters:P}})},Ce=C=>{Q(G=>{if(!G)return null;const ne=G.characters.filter((L,P)=>P!==C);return{...G,characters:ne}})},Ae=C=>{if(!q)return;const G=q.characters[C];m({type:"textarea",title:`${G.name}  `,message:`${G.name}   .
(/    )`,defaultValue:G.appearance||"",onConfirm:ne=>Ee(C,"appearance",ne||""),confirmText:"",showCopyButton:!0})},De=async()=>{if(q){Be(!0);try{const C=q.characters.map(_e=>{const Je=e.find(zt=>zt.name===_e.name);if(!Je||!Je.referenceImageId)return null;const xt=n.find(zt=>zt.id===Je.referenceImageId);return xt?{name:_e.name,imageUrl:xt.imageUrl}:null}).filter(_e=>_e!==null),G=C.map(_e=>_e.imageUrl),ne=C.map(_e=>_e.name),L=q.characters.map(_e=>` CHARACTER: ${_e.name}
  - ACTION: ${_e.action}
  - APPEARANCE: ${_e.appearance||"(Follow Reference Image)"}`).join(`
`),P=q.composition||"center";let ae="";P==="right"?ae=`
        [YOUTUBE THUMBNAIL COMPOSITION - RIGHT SIDE FOCUS]
        - **RULE OF THIRDS**: The main character MUST be positioned on the **RIGHT SIDE** (Right 1/3) of the screen.
        - **BACKGROUND**: The left side should feature a detailed, cinematic background relevant to the scene. **DO NOT LEAVE IT EMPTY/BLACK**. Fill it with environment/scenery.
        - **FACE POSITION**: The character's face must be located in the **RIGHT THIRD** of the image.
        - **CAMERA**: Wide shot or Medium shot allowing space on the left for text (but filled with background details).
            `:ae=`
        [YOUTUBE THUMBNAIL COMPOSITION - CENTER FOCUS]
        - **CENTER PLACEMENT**: The main character MUST be positioned in the **CENTER** of the screen.
        - **SYMMETRY**: Balanced composition with the character in the middle.
        - **BACKGROUND**: Detailed cinematic background filling the entire screen behind the character.
        - **FACE POSITION**: The character's face must be located in the **UPPER CENTER** of the image.
        - **CAMERA**: Medium shot or Close-up emphasizing the character.
            `;const we=`
        ${ae}
        
        [SCENE ACTION]
        ${q.action}

        [CHARACTERS]
        ${L}

        - **LIGHTING**: High contrast, dramatic lighting.
        - **NEGATIVE PROMPT**: **PHOTOREALISTIC**, **REALISTIC**, **3D RENDER**, **MOVIE PHOTO**, Text, Font, Letter, Alphabet, Number, Logo, UI, Watermark, Split screen, Vertical line, White line, Border, Divider, White corner, Light leak, **Dust**, **Particles**, **Noise**, **White dots**, **Stars**, **Grain**, **Specks**.
        `,ye=await Gs(r,we,o,"16:9","cinematic",G,void 0,void 0,void 0,void 0,void 0,ne,void 0,P);Q(_e=>_e?{..._e,imageUrl:ye,imageHistory:[ye,..._e.imageHistory||[]]}:null),a("  !","success")}catch(C){a(C.message,"error")}finally{Be(!1)}}},Oe=(C,G,ne)=>{X(L=>L.map(P=>{if(P.id!==C)return P;let ae=[...P.propIds||[]];return ne==="add"?ae.includes(G)||ae.push(G):ae=ae.filter(we=>we!==G),{...P,propIds:ae}}))},Re=(C,G,ne)=>{X(L=>L.map(P=>{if(P.id!==C)return P;let ae=[...P.characterIds||[]],we=P.visualPrompt;if(ne==="add"){if(!ae.includes(G)){ae.push(G);const ye=e.find(_e=>_e.id===G);if(ye){let _e=ye.description,Je=null;ye.referenceImageId&&(Je=n.find(zt=>zt.id===ye.referenceImageId)),Je||(Je=n.find(zt=>zt.name===ye.name)),Je&&Je.description&&(_e=Je.description),_e||(_e=ye.visualGuide);const xt=`[CHARACTER: ${ye.name}]`;!we.includes(xt)&&!we.includes(`[: ${ye.name}]`)&&(we+=`

${xt}
${_e}`)}}}else ae=ae.filter(ye=>ye!==G);return{...P,characterIds:ae,visualPrompt:we}}))},le=(C,G)=>{X(ne=>ne.map(L=>L.id===C?{...L,visualPrompt:G}:L))},Ue=(C,G)=>{X(ne=>ne.map(L=>L.id===C?{...L,userRefineInstruction:G}:L))},Ke=C=>{X(G=>{const ne=G.findIndex(ye=>ye.id===C);if(ne===-1)return G;const L=G[ne],ae={id:`shot-${Date.now()}`,sequenceNumber:L.sequenceNumber+1,title:`  (Connected Scene #${L.sequenceNumber+1})`,visualPrompt:"",videoPrompt:"      .",transitionMode:"continuous",userRefineInstruction:"      .",propIds:[...L.propIds||[]],characterIds:[...L.characterIds||[]]},we=[...G];we.splice(ne+1,0,ae);for(let ye=ne+2;ye<we.length;ye++)we[ye].sequenceNumber+=1;return we}),a("   !   .","success")},$e=C=>{confirm("   ? (    )")&&(X(G=>G.filter(L=>L.id!==C).map((L,P)=>({...L,sequenceNumber:P+1}))),a(" .","info"))},Ge=(C,G)=>{X(ne=>ne.map(L=>L.id===C?{...L,generatedImageUrl:G}:L)),a(" .","success")},Pe=(C,G,ne)=>{ne.stopPropagation(),confirm("    ?")&&(X(L=>L.map(P=>{if(P.id!==C)return P;const ae=(P.imageHistory||[]).filter(ye=>ye!==G);let we=P.generatedImageUrl;return P.generatedImageUrl===G&&(we=ae.length>0?ae[0]:void 0),{...P,generatedImageUrl:we,imageHistory:ae}})),a("  .","info"))},ze=C=>{te(C),O.current&&(O.current.value="",O.current.click())},Ze=(C,G)=>{X(ne=>ne.map(L=>{if(L.id!==C)return L;let P=[...L.imageHistory||[]];return L.generatedImageUrl&&!P.includes(L.generatedImageUrl)&&P.push(L.generatedImageUrl),P.includes(G)||P.push(G),{...L,generatedImageUrl:G,imageHistory:P}})),a(" .   ...","success"),r&&C&&(async()=>{try{z(P=>({...P,[C]:!0}));const ne=V.find(P=>P.id===C),L=V.find(P=>P.id===C);if(L){const P=typeof L.videoPrompt=="string"?L.videoPrompt:JSON.stringify(L.videoPrompt,null,2),ae=await Jf(r,G,P,L.title,t||"",L.userRefineInstruction);X(we=>we.map(ye=>ye.id!==C?ye:{...ye,videoPrompt:ae})),a("    !","success")}}catch(ne){console.error("Prompt refinement failed",ne),a("  .","error")}finally{z(ne=>({...ne,[C]:!1}))}})()},Gt=C=>{var L;const G=(L=C.target.files)==null?void 0:L[0];if(!G||!N)return;if(G.size>5*1024*1024){a("   5MB  .","warning");return}const ne=new FileReader;ne.onload=P=>{var we;const ae=(we=P.target)==null?void 0:we.result;ae&&Ze(N,ae)},ne.readAsDataURL(G),te(null)},Hn=async C=>{try{const G=await navigator.clipboard.read();for(const ne of G)if(ne.types.some(L=>L.startsWith("image/"))){const L=await ne.getType(ne.types.find(ae=>ae.startsWith("image/")));if(L.size>5*1024*1024){a("   5MB  .","warning");return}const P=new FileReader;P.onload=ae=>{var ye;const we=(ye=ae.target)==null?void 0:ye.result;we&&Ze(C,we)},P.readAsDataURL(L);return}a("    .","warning")}catch(G){console.error("Failed to read clipboard contents: ",G),a("     .","error")}},Eo=C=>{var L;const G=(L=C.target.files)==null?void 0:L[0];if(!G)return;if(G.size>5*1024*1024){a("   5MB  .","warning");return}const ne=new FileReader;ne.onload=P=>{var we;const ae=(we=P.target)==null?void 0:we.result;ae&&(Q(ye=>ye?{...ye,imageUrl:ae}:null),a("  .","success"))},ne.readAsDataURL(G),C.target.value=""},yi=async()=>{if(!t)return a("   . ' '   .","warning");if(!r)return a("API  .","warning");F(!0);try{const C=await xC(r,t,E);ie(C),R(1),a("  .   .","success")}catch(C){a(C.message,"error")}finally{F(!1)}},vi=async()=>{let C=S;if(!C){if(!t)return a(" .","warning");if(C=t,typeof p<"u"&&p!=="ALL"&&typeof d<"u"){const G=d.find(ne=>ne.id===p);G&&(C=G.content)}}if(!r)return a("API  .","warning");T(!0);try{const ne=(await EC(r,C,e,c,h,E,t)).map(L=>{let P=L.visualPrompt;return L.characterIds&&L.characterIds.length>0&&L.characterIds.forEach(ae=>{const we=e.find(ye=>ye.id===ae);if(we){let ye=we.description,_e=null;we.referenceImageId&&(_e=n.find(xt=>xt.id===we.referenceImageId)),_e||(_e=n.find(xt=>xt.name===we.name)),_e&&_e.description&&(ye=_e.description),ye||(ye=we.visualGuide);const Je=`[CHARACTER: ${we.name}]`;!P.includes(Je)&&!P.includes(`[: ${we.name}]`)&&(P+=`

${Je}
${ye}`)}}),{...L,visualPrompt:P}});X(ne),R(2),a("/  !","success")}catch(G){a(G.message,"error")}finally{T(!1)}},ec=async C=>{if(!C.generatedImageUrl)return a("  .","warning");if(!r)return a("API  .","warning");z(G=>({...G,[C.id]:!0}));try{const G=typeof C.videoPrompt=="string"?C.videoPrompt:JSON.stringify(C.videoPrompt,null,2),ne=await Jf(r,C.generatedImageUrl,G,C.title,t||"",C.userRefineInstruction);X(L=>L.map(P=>P.id!==C.id?P:{...P,videoPrompt:ne})),a("    !","success")}catch(G){console.error("Prompt refinement failed",G),a("  .","error")}finally{z(G=>({...G,[C.id]:!1}))}},Bn=async C=>{var G,ne;z(L=>({...L,[C.id]:!0}));try{const L=((G=C.propIds)==null?void 0:G.map(Qe=>{var st;return(st=c.find(bt=>bt.id===Qe))==null?void 0:st.imageUrl}).filter(Boolean))||[],P=((ne=C.characterIds)==null?void 0:ne.map(Qe=>e.find(st=>st.id===Qe)).filter(Qe=>!!Qe))||[],ae=P.map(Qe=>{if(!Qe.referenceImageId)return null;const st=n.find(bt=>bt.id===Qe.referenceImageId);return st?{name:Qe.name,imageUrl:st.imageUrl,description:st.description}:null}).filter(Qe=>Qe!==null),we=ae.map(Qe=>Qe.imageUrl),ye=ae.map(Qe=>Qe.name),_e=P.map(Qe=>{const st=n.find(ua=>ua.id===Qe.referenceImageId);let bt=(st==null?void 0:st.description)||Qe.description||"";bt.includes("[Basic Info]")&&(bt=bt.split("[Basic Info]")[0].trim());const wo=ae.findIndex(ua=>ua.name===Qe.name),Sg=wo>=0?`(MATCH WITH PROVIDED REFERENCE IMAGE #${wo+1})`:"(No Reference Image - Generate Freely)";return`
          [CHARACTER: ${Qe.name}]
          - ID MATCHING: ${Sg}
          - VISUAL PROMPT (COPY-PASTE): "${bt}"
          `}).join(`
`),Je=`
        [GLOBAL PRODUCTION RULES]
        ${h||""}
        
        (NOTE: Follow the Base Appearance, unless the Scene Action explicitly describes a different age or state like 'Young', 'Childhood', etc.)
        
        [SCENE ACTION & CAMERA]
        ${C.visualPrompt}
      `,xt=V.find(Qe=>Qe.sequenceNumber===C.sequenceNumber-1),zt=C.transitionMode!=="cut",Pr=zt?xt==null?void 0:xt.generatedImageUrl:void 0;Pr?a("    ( )","info"):xt&&!zt&&a("   ( )","info");const So=await Gs(r,Je,o,s,"cinematic",we,void 0,void 0,L,void 0,Pr,ye,_e);X(Qe=>Qe.map(st=>{if(st.id!==C.id)return st;let bt=[...st.imageHistory||[]];return st.generatedImageUrl&&!bt.includes(st.generatedImageUrl)&&bt.push(st.generatedImageUrl),bt.includes(So)||bt.push(So),{...st,generatedImageUrl:So,imageHistory:bt}})),a(`${C.sequenceNumber}   `,"success")}catch(L){a(L.message,"error")}finally{z(L=>({...L,[C.id]:!1}))}},xi=(C,G)=>{const ne=document.createElement("a");ne.href=C,ne.download=G,ne.click()},dg=async()=>{if(!(!q||!q.imageUrl)){a("   ...","info");try{const G=await(await fetch(q.imageUrl)).blob(),ne=await createImageBitmap(G),L=document.createElement("canvas");L.width=ne.width,L.height=ne.height;const P=L.getContext("2d");if(!P)throw new Error("Canvas context creation failed");if(P.drawImage(ne,0,0),q.enableGradient&&q.gradientDirection){const ae=q.gradientDirection,we=q.gradientPosition||40;let ye;ae==="left-to-right"?(ye=P.createLinearGradient(0,0,L.width,0),ye.addColorStop(0,"rgba(0,0,0,1)"),ye.addColorStop(we/100,"rgba(0,0,0,0)")):(ye=P.createLinearGradient(0,L.height,0,0),ye.addColorStop(0,"rgba(0,0,0,1)"),ye.addColorStop(we/100,"rgba(0,0,0,0)")),P.fillStyle=ye,P.fillRect(0,0,L.width,L.height)}q.textLines&&q.textLines.forEach(ae=>{const we=L.width*(ae.size/1e3),ye=ae.fontFamily?ae.fontFamily.split(",")[0].replace(/['"]/g,""):"sans-serif",_e=ae.fontWeight||"900";P.font=`${_e} ${we}px "${ye}", sans-serif`,P.fillStyle=ae.color,P.textBaseline="middle",P.lineWidth=we*((ae.outlineWidth??8)/100),P.strokeStyle=ae.outlineColor||"black",P.lineJoin="round",P.lineCap="round";const Je=L.width*(ae.x/100),xt=L.height*(ae.y/100),zt=ae.text.split(`
`),Pr=we*1.1,So=zt.length*Pr;P.save(),P.translate(Je,xt),P.scale(1,ae.heightScale||1);const Qe=-(So/2)+Pr/2;zt.forEach((st,bt)=>{const wo=Qe+bt*Pr;P.strokeText(st,0,wo),P.fillText(st,0,wo)}),P.restore()}),L.toBlob(ae=>{if(ae){const we=URL.createObjectURL(ae),ye=document.createElement("a");ye.href=we,ye.download=`thumbnail_complete_${Date.now()}.png`,ye.click(),URL.revokeObjectURL(we),a("   .","success")}},"image/png")}catch(C){console.error("Thumbnail composite failed",C),a("   .","error"),xi(q.imageUrl,"thumbnail_raw.png")}}},fg=async()=>{const C=V.filter(L=>L.generatedImageUrl);if(C.length===0)return a("   .","warning");const G=new Yl;let ne=0;a(`${C.length}   ...`,"success");try{const L=C.map(async P=>{if(P.generatedImageUrl)try{const we=`${P.sequenceNumber.toString().padStart(2,"0")}_Opening_${P.sequenceNumber}.png`,_e=await(await fetch(P.generatedImageUrl)).blob();G.file(we,_e),ne++}catch(ae){console.error(`Failed to fetch image for shot ${P.sequenceNumber}`,ae)}});if(await Promise.all(L),ne>0){const P=await G.generateAsync({type:"blob"});ls.saveAs(P,"Bangtong_Opening.zip"),a("   .","success")}else a("   .","error")}catch(L){console.error("Zip generation failed",L),a("     .","error")}},hg=async()=>{const C=V.filter(L=>L.videoPrompt);if(C.length===0)return a("   .","warning");const G=new Yl;let ne=`=== GROK BATCH PROMPTS ===

`;C.forEach(L=>{const P=L.sequenceNumber.toString().padStart(2,"0");let ae="";if(typeof L.videoPrompt=="string")ae=L.videoPrompt;else{const Je=L.videoPrompt;ae=Je.prompt||JSON.stringify(Je,null,2)}const we=L.transitionMode==="cut"?"[CUT/MONTAGE MODE]":"[CONTINUOUS FLOW MODE]",ye=L.musicPrompt?`
[MUSIC]: ${L.musicPrompt}`:"",_e=`${ae}${ye}`;G.file(`${P}_Grok_${L.sequenceNumber}.txt`,_e),ne+=`--- SHOT ${L.sequenceNumber} (${we}) ---
${_e}

`}),G.file("_ALL_PROMPTS_COMBINED.txt",ne);try{const L=await G.generateAsync({type:"blob"});ls.saveAs(L,"Bangtong_Grok_Batch_Prompts.zip"),a("Grok  (ZIP) .","success")}catch(L){console.error("Zip generation failed",L),a("     .","error")}},pg=async C=>{z(G=>({...G,[C.id]:!0}));try{const G=await RC(r,C.title,C.visualPrompt);X(ne=>ne.map(L=>L.id===C.id?{...L,trailerCaption:G}:L)),a("  !","success")}catch(G){a(G.message,"error")}finally{z(G=>({...G,[C.id]:!1}))}},[Ei,Ti]=ue.useState([]),[xn,Si]=ue.useState([]),[tc,nc]=ue.useState(!1),[kr,rc]=ue.useState(""),oc=()=>{if(!kr.trim())return;const C=`custom-${Date.now()}`,G={id:C,title:kr.trim(),description:"   ",composition:"center"};Ti(ne=>[...ne,G]),xn.length<2&&Si(ne=>[...ne,C]),rc(""),a("  .","success")},mg=async()=>{if(!t)return a(" .","warning");if(!r)return a("API  .","warning");nc(!0);try{const C=await TC(r,t,e);Ti(C),J([]),a("  .    .","success")}catch(C){a(C.message,"error")}finally{nc(!1)}},gg=async()=>{if(!t)return a(" .","warning");if(!r)return a("API  .","warning");if(xn.length===0)return a(" 1   .","warning");W(!0),M([]);try{const C=Ei.filter(ne=>xn.includes(ne.id)).map(ne=>ne.title),G=await _C(r,t,C);J(G),a(`  ${G.length} !`,"success")}catch(C){a(C.message,"error")}finally{W(!1)}},yg=C=>{Si(G=>G.includes(C)?G.filter(ne=>ne!==C):G.length>=2?(a("  2  .","warning"),G):[...G,C])},vg=C=>{M(G=>G.includes(C)?G.filter(ne=>ne!==C):[...G,C])},xg=()=>{if(K.length===0)return a("  .","warning");const C=K.join(`
`),G=new Blob([C],{type:"text/plain;charset=utf-8"});ls.saveAs(G,"selected_hooking_texts.txt"),a(`${K.length}    .`,"success")},Eg=async()=>{if(V.length===0)return a("   .","warning");if(!r)return a("API  .","warning");Le(!0);try{const C=await kC(r,V,E,w);xe(C),a("Suno  !","success")}catch(C){a(C.message,"error")}finally{Le(!1)}},To=C=>{navigator.clipboard.writeText(C),a("!","success")},ic=(C,G)=>{X(ne=>ne.map(L=>L.id===C?{...L,transitionMode:G}:L)),a(`  '${G==="continuous"?" ":" "}' .`,"success")},Tg=C=>{m({type:"textarea",title:"  ",message:"  . (   )",defaultValue:C.visualPrompt,onConfirm:G=>le(C.id,G||""),confirmText:"",showCopyButton:!0})};return u.jsxs("div",{className:"space-y-8 animate-fade-in pb-20 relative",children:[u.jsx("div",{ref:I}),u.jsx("input",{type:"file",ref:O,onChange:Gt,className:"hidden",accept:"image/*"}),u.jsx("input",{type:"file",ref:k,onChange:Eo,className:"hidden",accept:"image/*"}),u.jsxs("div",{className:"fixed left-6 bottom-20 flex flex-col gap-2 z-50",children:[u.jsx("button",{onClick:j,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:u.jsx("i",{className:"fas fa-arrow-up"})}),u.jsx("button",{onClick:D,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:u.jsx("i",{className:"fas fa-arrow-down"})})]}),u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center bg-slate-800 p-8 rounded-2xl border border-slate-700 shadow-xl relative overflow-hidden",children:[u.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500"}),u.jsxs("div",{className:"z-10 mb-4 md:mb-0",children:[u.jsxs("h2",{className:"text-3xl font-extrabold text-white mb-2 flex items-center gap-3",children:[u.jsx("i",{className:"fas fa-film text-red-500"}),"  (  )"]}),u.jsxs("p",{className:"text-slate-400 mb-4",children:["   ",u.jsx("span",{className:"text-red-400 font-bold",children:"10 (Hooking) "})," ."]}),u.jsxs("div",{className:"flex flex-col gap-2",children:[u.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700 w-fit",children:[u.jsx("span",{className:"text-xs font-bold text-slate-400 px-2",children:" :"}),u.jsxs("select",{value:p,onChange:C=>g(C.target.value),className:"bg-slate-800 text-white text-sm border border-slate-600 rounded px-3 py-1.5 focus:ring-2 focus:ring-red-500 outline-none",children:[u.jsx("option",{value:"ALL",children:"  (AI  )"}),d.map((C,G)=>u.jsxs("option",{value:C.id,children:[G+1,". ",C.title]},C.id))]})]}),u.jsxs("div",{className:"flex flex-wrap gap-2",children:[u.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700 w-fit",children:[u.jsx("span",{className:"text-xs font-bold text-slate-400 px-2",children:" :"}),u.jsxs("select",{value:E,onChange:C=>x(C.target.value),className:"bg-slate-800 text-white text-sm border border-slate-600 rounded px-3 py-1.5 focus:ring-2 focus:ring-red-500 outline-none min-w-[150px]",children:[u.jsx("option",{value:"auto",children:" AI  ( )"}),u.jsx("option",{value:"mystery",children:" /"}),u.jsx("option",{value:"comedy",children:" / (B )"}),u.jsx("option",{value:"destiny",children:"   ( )"}),u.jsx("option",{value:"tragedy",children:"  / ()"}),u.jsx("option",{value:"revenge",children:" / ()"}),u.jsx("option",{value:"despair",children:"  /"})]})]}),u.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700 w-fit",children:[u.jsx("span",{className:"text-xs font-bold text-slate-400 px-2",children:"(Style):"}),u.jsxs("select",{value:o,onChange:C=>i(C.target.value),className:`bg-slate-800 text-white text-sm border border-slate-600 rounded px-3 py-1.5 focus:ring-2 focus:ring-indigo-500 outline-none min-w-[150px] font-bold ${o==="fantasy"?"text-purple-300":"text-slate-200"}`,children:[u.jsx("option",{value:"webtoon",children:"   (Webtoon)"}),u.jsx("option",{value:"animation",children:"   (Anime)"}),u.jsx("option",{value:"inkwash",children:" / (Ink Wash)"}),u.jsx("option",{value:"fantasy",children:" / (Semirealism)"})]})]})]})]})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("button",{onClick:vt,className:"bg-slate-700 hover:bg-slate-600 text-slate-300 hover:text-white px-4 py-4 rounded-full font-bold text-lg shadow-lg transition-all",title:" ",children:u.jsx("i",{className:"fas fa-trash-alt"})}),u.jsx("button",{onClick:fg,className:"bg-green-700 hover:bg-green-600 text-slate-200 hover:text-white px-4 py-4 rounded-full font-bold text-lg shadow-lg transition-all",title:"   (ZIP)",children:u.jsx("i",{className:"fas fa-download"})}),u.jsx("button",{onClick:hg,className:"bg-teal-700 hover:bg-teal-600 text-slate-200 hover:text-white px-4 py-4 rounded-full font-bold text-lg shadow-lg transition-all",title:"   (ZIP)",children:u.jsx("i",{className:"fas fa-file-code"})}),u.jsx("button",{onClick:()=>{const C=V.map(G=>typeof G.videoPrompt=="object"?JSON.stringify(G.videoPrompt,null,2):G.videoPrompt).join(`

`);navigator.clipboard.writeText(C),a("    ( )","success")},className:"bg-indigo-700 hover:bg-indigo-600 text-slate-200 hover:text-white px-4 py-4 rounded-full font-bold text-lg shadow-lg transition-all",title:"    (Grok)",children:u.jsx("i",{className:"fas fa-copy"})})]})]}),u.jsxs("div",{className:`bg-slate-900 rounded-xl p-6 border ${Z===1?"border-blue-500 ring-1 ring-blue-500":"border-slate-700"} mb-8 transition-all`,children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[u.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Z===1?"bg-blue-600 text-white":"bg-slate-700 text-slate-400"}`,children:"STEP 1"}),"   (Hooking Script)"]}),u.jsx("div",{className:"flex items-center gap-2",children:Z!==1&&u.jsxs("button",{onClick:()=>R(1),className:"text-sm text-blue-400 hover:text-white",children:[u.jsx("i",{className:"fas fa-edit mr-1"})," "]})})]}),(Z===1||S)&&u.jsxs("div",{className:`space-y-4 animate-fade-in ${Z!==1?"hidden":""}`,children:[u.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg border border-slate-700 text-sm space-y-2",children:[u.jsx("h4",{className:"font-bold text-slate-300 mb-2",children:"    4  ( )"}),u.jsxs("ul",{className:"space-y-1 text-slate-400",children:[u.jsxs("li",{children:[u.jsx("span",{className:"text-blue-400 font-bold",children:"1.  :"}),' ", .  !" ( )']}),u.jsxs("li",{children:[u.jsx("span",{className:"text-blue-400 font-bold",children:"2.  :"}),"   ,    (~/)"]}),u.jsxs("li",{children:[u.jsx("span",{className:"text-blue-400 font-bold",children:"3.  :"}),"    / (   )"]}),u.jsxs("li",{children:[u.jsx("span",{className:"text-blue-400 font-bold",children:"4.  :"}),' "   ?" ( )']})]})]}),u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end gap-4",children:[u.jsxs("p",{className:"text-slate-400 text-sm",children:["    60    .",u.jsx("br",{}),u.jsx("span",{className:"text-xs text-slate-500",children:"*        ."})]}),u.jsxs("button",{onClick:yi,disabled:b,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg text-sm font-bold shadow flex items-center gap-2 whitespace-nowrap",children:[b?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-magic"}),"  "]})]}),u.jsx("textarea",{value:S,onChange:C=>ie(C.target.value),placeholder:"   .     .",className:"w-full h-64 bg-slate-950 text-slate-200 p-4 rounded-lg border border-slate-700 focus:ring-2 focus:ring-blue-500 outline-none font-mono text-sm leading-relaxed resize-none"}),u.jsx("div",{className:"flex justify-end pt-2",children:u.jsxs("button",{onClick:vi,disabled:!S||v,className:`px-6 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2 transition-all ${S?"bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-500 hover:to-orange-500 text-white transform hover:scale-105":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,children:[v?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-film"}),"STEP 2:    "]})})]})]}),V.length>0&&u.jsxs("div",{className:"space-y-0",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-4 px-2",children:[u.jsx("span",{className:"bg-red-600 text-white text-xs px-2 py-1 rounded-full",children:"STEP 2"}),u.jsx("h3",{className:"text-xl font-bold text-white",children:"    "})]}),V.map((C,G)=>{var ne,L;return u.jsxs("div",{className:"relative pl-8 md:pl-12 py-6 group",children:[u.jsx("div",{className:"absolute left-4 md:left-6 top-0 bottom-0 w-0.5 bg-slate-700 group-last:bottom-auto group-last:h-1/2"}),u.jsx("div",{className:"absolute left-2 md:left-4 top-12 w-4 h-4 md:w-5 md:h-5 rounded-full bg-slate-900 border-4 border-indigo-500 z-10 shadow-lg shadow-indigo-500/50"}),u.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-700 overflow-hidden hover:border-indigo-500 transition-colors",children:[u.jsxs("div",{className:"flex flex-col md:flex-row",children:[u.jsxs("div",{className:"w-full md:w-3/4 bg-black relative min-h-[500px] flex items-center justify-center border-r border-slate-800",children:[C.generatedImageUrl?u.jsx("img",{src:C.generatedImageUrl,alt:C.title,className:"w-full h-full object-cover"}):u.jsxs("div",{className:"text-center p-6",children:[u.jsx("i",{className:"fas fa-clapperboard text-4xl text-slate-700 mb-3"}),u.jsx("p",{className:"text-slate-500 text-sm",children:"  "})]}),u.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-3",children:[u.jsxs("button",{onClick:()=>Bn(C),disabled:_[C.id],className:"bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-2 rounded-full font-bold shadow-lg flex items-center gap-2",children:[_[C.id]?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-paint-brush"}),C.generatedImageUrl?"  ":" "]}),C.generatedImageUrl&&u.jsxs("button",{onClick:()=>ec(C),disabled:_[C.id],className:"bg-purple-600 hover:bg-purple-500 text-white px-6 py-2 rounded-full font-bold shadow-lg flex items-center gap-2",title:"      (   )",children:[u.jsx("i",{className:"fas fa-magic"}),"   ()"]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs("button",{onClick:()=>ze(C.id),className:"bg-slate-600 hover:bg-slate-500 text-white px-6 py-2 rounded-full font-bold shadow-lg flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-upload"}),"  "]}),u.jsxs("button",{onClick:()=>Hn(C.id),className:"bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-full font-bold shadow-lg flex items-center gap-2",title:"   (Grok     )",children:[u.jsx("i",{className:"fas fa-paste"})," "]})]}),C.generatedImageUrl&&u.jsx("button",{onClick:()=>Ve(C.generatedImageUrl),className:"bg-slate-700/80 hover:bg-slate-600 text-white p-3 rounded-full font-bold shadow-lg backdrop-blur-sm transition-transform hover:scale-110",title:" ",children:u.jsx("i",{className:"fas fa-search-plus"})}),C.generatedImageUrl&&u.jsxs("button",{onClick:()=>xi(C.generatedImageUrl,`opening_shot_${C.sequenceNumber}.png`),className:"bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-full font-bold shadow-lg flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-download"})," "]})]})]}),u.jsx("div",{className:"w-full md:w-1/4 p-4 flex flex-col justify-between overflow-y-auto h-[500px] scrollbar-thin",children:u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[u.jsxs("span",{className:"text-indigo-400",children:["#",C.sequenceNumber]})," ",C.title]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("button",{onClick:()=>$e(C.id),className:"w-6 h-6 rounded bg-slate-800 hover:bg-red-900 text-slate-500 hover:text-red-300 flex items-center justify-center transition-colors",title:"  ",children:u.jsx("i",{className:"fas fa-trash-alt text-xs"})}),u.jsxs("div",{className:"flex bg-slate-900 rounded-lg p-1 border border-slate-700 gap-1",children:[u.jsxs("button",{onClick:()=>ic(C.id,"continuous"),className:`px-2 py-1 text-[10px] rounded ${C.transitionMode!=="cut"?"bg-indigo-600 text-white font-bold shadow":"text-slate-500 hover:text-slate-300"}`,title:" :       (Seamless)",children:[u.jsx("i",{className:"fas fa-link mr-1"})," "]}),u.jsxs("button",{onClick:()=>ic(C.id,"cut"),className:`px-2 py-1 text-[10px] rounded ${C.transitionMode==="cut"?"bg-pink-600 text-white font-bold shadow":"text-slate-500 hover:text-slate-300"}`,title:" :  /  (Montage)",children:[u.jsx("i",{className:"fas fa-cut mr-1"})," "]}),u.jsxs("button",{onClick:()=>Ke(C.id),className:"px-2 py-1 text-[10px] rounded bg-green-600 text-white font-bold shadow hover:bg-green-500 ml-2 border-l border-slate-600 pl-3",title:"      . (Grok   )",children:[u.jsx("i",{className:"fas fa-plus-circle mr-1"}),"   "]})]})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[u.jsx("div",{className:"flex justify-between items-center mb-1",children:u.jsxs("p",{className:"text-xs font-bold text-orange-400 uppercase",children:[u.jsx("i",{className:"fas fa-pen-fancy mr-1"}),"  / "]})}),u.jsx("textarea",{value:C.userRefineInstruction||"",onChange:P=>Ue(C.id,P.target.value),placeholder:":      . /     . (      )",className:"w-full bg-slate-900 text-sm text-slate-300 border border-slate-600 rounded p-2 h-16 focus:ring-2 focus:ring-orange-500 outline-none resize-none placeholder-slate-600"})]}),u.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase",children:[u.jsx("i",{className:"fas fa-image mr-1"}),"    ()"]}),u.jsxs("button",{onClick:()=>Tg(C),className:"text-xs text-indigo-400 hover:text-white",children:[u.jsx("i",{className:"fas fa-expand-alt"}),"  "]})]}),u.jsx("textarea",{value:C.visualPrompt,onChange:P=>le(C.id,P.target.value),className:"w-full bg-slate-900 text-sm text-slate-300 border border-slate-600 rounded p-2 h-20 focus:ring-2 focus:ring-indigo-500 outline-none resize-none"})]}),u.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsxs("p",{className:"text-xs font-bold text-green-500 uppercase",children:[u.jsx("i",{className:"fas fa-user mr-1"}),"   (Casting)"]}),u.jsxs("select",{className:"bg-slate-900 text-xs text-slate-300 border border-slate-600 rounded px-2 py-1 max-w-[120px]",onChange:P=>{P.target.value&&Re(C.id,P.target.value,"add"),P.target.value=""},children:[u.jsx("option",{value:"",children:"+ "}),e&&e.map(P=>u.jsx("option",{value:P.id,children:P.name},P.id))]})]}),u.jsxs("div",{className:"flex gap-2 flex-wrap min-h-[24px]",children:[(ne=C.characterIds)==null?void 0:ne.map(P=>{const ae=e==null?void 0:e.find(we=>we.id===P);return ae?u.jsxs("div",{className:"bg-green-900/50 text-green-200 border border-green-700/50 text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[u.jsx("span",{children:ae.name}),u.jsx("button",{onClick:()=>Re(C.id,P,"remove"),className:"hover:text-green-100",children:u.jsx("i",{className:"fas fa-times"})})]},P):null}),(!C.characterIds||C.characterIds.length===0)&&u.jsx("span",{className:"text-xs text-slate-600",children:"  "})]})]}),u.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsxs("p",{className:"text-xs font-bold text-amber-500 uppercase",children:[u.jsx("i",{className:"fas fa-cube mr-1"}),"   (Props)"]}),u.jsxs("select",{className:"bg-slate-900 text-xs text-slate-300 border border-slate-600 rounded px-2 py-1 max-w-[120px]",onChange:P=>{P.target.value&&Oe(C.id,P.target.value,"add"),P.target.value=""},children:[u.jsx("option",{value:"",children:"+ "}),c&&c.map(P=>u.jsx("option",{value:P.id,children:P.name},P.id))]})]}),u.jsxs("div",{className:"flex gap-2 flex-wrap min-h-[24px]",children:[(L=C.propIds)==null?void 0:L.map(P=>{const ae=c==null?void 0:c.find(we=>we.id===P);return ae?u.jsxs("div",{className:"bg-amber-900/50 text-amber-200 border border-amber-700/50 text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[u.jsx("span",{children:ae.name}),u.jsx("button",{onClick:()=>Oe(C.id,P,"remove"),className:"hover:text-red-300",children:u.jsx("i",{className:"fas fa-times"})})]},P):null}),(!C.propIds||C.propIds.length===0)&&u.jsx("span",{className:"text-xs text-slate-600",children:"  "})]})]}),u.jsxs("div",{className:"bg-indigo-900/20 p-3 rounded-lg border border-indigo-500/30",children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsx("div",{className:"flex items-center gap-2",children:u.jsxs("p",{className:"text-xs font-bold text-indigo-300 uppercase",children:[u.jsx("i",{className:"fas fa-video mr-1"}),"   (Grok/Whisk)"]})}),u.jsx("div",{className:"flex gap-2",children:u.jsxs("button",{onClick:()=>{const P=typeof C.videoPrompt=="object"?JSON.stringify(C.videoPrompt,null,2):C.videoPrompt;navigator.clipboard.writeText(P),a(" ","success")},className:"text-xs text-indigo-400 hover:text-white",children:[u.jsx("i",{className:"fas fa-copy"})," "]})})]}),u.jsx("div",{className:"text-[11px] text-indigo-100 font-sans bg-black/30 p-3 rounded overflow-y-auto whitespace-pre-wrap max-h-[150px] leading-relaxed",children:typeof C.videoPrompt=="object"?JSON.stringify(C.videoPrompt,null,2):C.videoPrompt}),C.musicPrompt&&u.jsxs("div",{className:"mt-2 bg-blue-900/20 p-2 rounded border border-blue-500/30",children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsxs("p",{className:"text-[10px] font-bold text-blue-300 uppercase",children:[u.jsx("i",{className:"fas fa-music mr-1"}),"   (Suno)"]}),u.jsx("button",{onClick:()=>{navigator.clipboard.writeText(C.musicPrompt||""),a("  ","success")},className:"text-[10px] text-blue-400 hover:text-white",children:u.jsx("i",{className:"fas fa-copy"})})]}),u.jsx("p",{className:"text-[10px] text-blue-100 font-mono leading-tight truncate",children:C.musicPrompt})]}),u.jsx("p",{className:"text-[10px] text-indigo-400/70 mt-2",children:"*  JSON  Grok    . ( )"})]}),u.jsxs("div",{className:"bg-purple-900/20 p-3 rounded-lg border border-purple-500/30",children:[u.jsx("div",{className:"flex justify-between items-center mb-2",children:u.jsxs("p",{className:"text-xs font-bold text-purple-300 uppercase",children:[u.jsx("i",{className:"fas fa-closed-captioning mr-1"}),"   (Trailer Caption)"]})}),u.jsxs("div",{className:"flex flex-col gap-2",children:[u.jsxs("button",{onClick:()=>pg(C),disabled:_[C.id],className:"bg-purple-600 hover:bg-purple-500 text-white text-xs px-3 py-2 rounded-lg font-bold shadow-lg flex items-center justify-center gap-2 transition-colors w-full",children:[_[C.id]?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-magic"}),"  (AI)"]}),C.trailerCaption&&u.jsxs("div",{className:"bg-slate-900/80 p-2 rounded border border-purple-500/50 flex justify-between items-center gap-2",children:[u.jsxs("span",{className:"text-sm text-white font-serif italic",children:['"',C.trailerCaption,'"']}),u.jsx("button",{onClick:()=>{navigator.clipboard.writeText(C.trailerCaption||""),a("","success")},className:"text-purple-400 hover:text-white shrink-0",title:"",children:u.jsx("i",{className:"fas fa-copy"})})]})]})]})]})]})})]}),C.imageHistory&&C.imageHistory.length>0&&u.jsxs("div",{className:"w-full bg-slate-950/50 border-t border-slate-800 p-3",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[u.jsx("i",{className:"fas fa-history text-slate-500 text-xs"}),u.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase",children:[" (",C.imageHistory.length,")"]})]}),u.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent",children:C.imageHistory.map((P,ae)=>u.jsxs("div",{onClick:()=>Ge(C.id,P),className:`relative w-20 h-20 shrink-0 rounded-lg overflow-hidden cursor-pointer border-2 transition-all group/hist ${C.generatedImageUrl===P?"border-indigo-500 opacity-100 ring-2 ring-indigo-500/50":"border-slate-700 opacity-60 hover:opacity-100 hover:border-slate-500"}`,children:[u.jsx("img",{src:P,alt:`History ${ae}`,className:"w-full h-full object-cover"}),C.generatedImageUrl===P&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-indigo-900/40 backdrop-blur-[1px]",children:u.jsx("i",{className:"fas fa-check-circle text-white text-xl shadow-sm"})}),u.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover/hist:bg-black/20 transition-colors"}),u.jsx("button",{onClick:we=>Pe(C.id,P,we),className:"absolute top-1 right-1 w-5 h-5 bg-red-600/80 hover:bg-red-500 text-white rounded-full flex items-center justify-center text-[10px] opacity-0 group-hover/hist:opacity-100 transition-opacity shadow-sm z-10",title:"",children:u.jsx("i",{className:"fas fa-times"})})]},ae))})]})]})]},C.id)}),u.jsx("div",{className:"pl-8 md:pl-12 pb-8",children:u.jsx("div",{className:"bg-slate-800/50 border border-slate-700 border-dashed rounded-xl p-4 text-center",children:u.jsxs("p",{className:"text-slate-400 text-sm",children:[u.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"})," 10   (Cliffhanger).      ."]})})}),u.jsx("div",{className:"pl-8 md:pl-12 pb-8",children:u.jsxs("div",{className:"bg-gradient-to-r from-slate-900 to-slate-800 rounded-xl border border-slate-700 p-6 relative overflow-hidden",children:[u.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-blue-500"}),u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4",children:[u.jsxs("div",{children:[u.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-music text-blue-400"}),"    (Suno AI)"]}),u.jsxs("p",{className:"text-slate-400 text-sm mt-1 mb-3",children:[" (",E,")    ",u.jsx("span",{className:"text-blue-300",children:"  "})," ."]}),u.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700 w-fit",children:[u.jsx("span",{className:"text-xs font-bold text-slate-400 px-2",children:" :"}),u.jsxs("select",{value:w,onChange:C=>y(C.target.value),className:"bg-slate-800 text-white text-sm border border-slate-600 rounded px-3 py-1.5 focus:ring-2 focus:ring-blue-500 outline-none min-w-[150px]",children:[u.jsx("option",{value:"auto",children:"   ()"}),u.jsx("option",{value:"fast_exciting",children:" / ()"}),u.jsx("option",{value:"sad_sorrowful",children:" / ()"}),u.jsx("option",{value:"faint_hazy",children:" / ()"}),u.jsx("option",{value:"slow_mystery",children:" / ()"}),u.jsx("option",{value:"medium_story",children:" / ()"}),u.jsx("option",{value:"grand_epic",children:" / ()"})]})]})]}),u.jsxs("div",{className:"flex gap-2",children:[he&&u.jsx("button",{onClick:()=>{confirm("  ?")&&xe(null)},className:"bg-red-900/50 hover:bg-red-800 text-red-200 px-4 py-2.5 rounded-lg font-bold shadow-lg transition-all whitespace-nowrap border border-red-700/50",title:" ",children:u.jsx("i",{className:"fas fa-trash-alt"})}),u.jsxs("button",{onClick:Eg,disabled:be,className:"bg-blue-600 hover:bg-blue-500 text-white px-5 py-2.5 rounded-lg font-bold shadow-lg flex items-center gap-2 transition-all whitespace-nowrap",children:[be?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-microphone-alt"}),he?"  ":"Suno  "]})]})]}),he&&u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-slate-950/50 rounded-lg p-6 border border-slate-800",children:[u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Song Title"}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("input",{readOnly:!0,value:he.title,className:"bg-slate-900 text-white text-lg font-bold border border-slate-700 rounded px-3 py-2 w-full focus:ring-1 focus:ring-blue-500 outline-none"}),u.jsx("button",{onClick:()=>To(he.title),className:"bg-slate-800 hover:bg-slate-700 text-slate-300 p-3 rounded border border-slate-700",children:u.jsx("i",{className:"fas fa-copy"})})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Style of Music (English - Recommended)"}),u.jsxs("div",{className:"relative",children:[u.jsx("textarea",{readOnly:!0,value:he.style_en,className:"bg-slate-900 text-blue-300 text-sm border border-slate-700 rounded p-3 w-full h-20 resize-none focus:ring-1 focus:ring-blue-500 outline-none"}),u.jsx("button",{onClick:()=>To(he.style_en),className:"absolute top-2 right-2 text-slate-500 hover:text-white bg-slate-800/80 p-1.5 rounded",children:u.jsx("i",{className:"fas fa-copy"})})]}),u.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"* Suno    ."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Style of Music (Korean - Experimental)"}),u.jsxs("div",{className:"relative",children:[u.jsx("textarea",{readOnly:!0,value:he.style_ko,className:"bg-slate-900 text-green-300 text-sm border border-slate-700 rounded p-3 w-full h-20 resize-none focus:ring-1 focus:ring-green-500 outline-none"}),u.jsx("button",{onClick:()=>To(he.style_ko),className:"absolute top-2 right-2 text-slate-500 hover:text-white bg-slate-800/80 p-1.5 rounded",children:u.jsx("i",{className:"fas fa-copy"})})]}),u.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"*  . (     )"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Lyrics (~40s)"}),u.jsxs("div",{className:"relative",children:[u.jsx("textarea",{readOnly:!0,value:he.lyrics,className:"bg-slate-900 text-slate-300 text-sm border border-slate-700 rounded p-3 w-full h-48 resize-none focus:ring-1 focus:ring-blue-500 outline-none font-mono leading-relaxed"}),u.jsx("button",{onClick:()=>To(he.lyrics),className:"absolute top-2 right-2 text-slate-500 hover:text-white bg-slate-800/80 p-1.5 rounded",children:u.jsx("i",{className:"fas fa-copy"})})]}),u.jsx("p",{className:"text-xs text-slate-500 mt-1",children:'* Suno "Lyrics"  .'})]})]})]})})]}),V.length===0&&!v&&u.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-slate-600",children:[u.jsx("i",{className:"fas fa-film text-6xl mb-4 opacity-20"}),u.jsx("p",{className:"text-lg",children:"    ."})]}),u.jsxs("div",{className:"border-t border-slate-700 pt-10 mt-10",children:[u.jsx("div",{className:"bg-slate-900 rounded-xl p-6 border border-slate-700 mb-10",children:u.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[u.jsxs("div",{className:"w-full md:w-1/4 space-y-4",children:[u.jsxs("h4",{className:"text-lg font-bold text-white flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-image text-purple-400"}),"  "]}),q?u.jsxs("div",{className:"space-y-3 animate-fade-in",children:[u.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-600",children:[u.jsx("p",{className:"text-xs text-purple-300 font-bold mb-1",children:""}),u.jsx("p",{className:"text-white font-bold text-base leading-tight",children:q.title})]}),u.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-600",children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsx("p",{className:"text-xs text-slate-400 font-bold",children:"  ()"}),u.jsx("div",{className:"flex gap-2",children:u.jsxs("button",{onClick:()=>m({type:"textarea",title:"  ",message:` , ,  .
(: ,     " ", "  "    )`,defaultValue:q.action,onConfirm:C=>U("action",C||""),confirmText:"",showCopyButton:!0}),className:"text-[10px] bg-slate-700 hover:bg-slate-600 text-slate-300 px-1.5 py-0.5 rounded border border-slate-600 flex items-center gap-1",title:"  / ",children:[u.jsx("i",{className:"fas fa-expand"}),"  "]})})]}),u.jsx("textarea",{className:"w-full bg-slate-900 text-slate-300 text-[11px] leading-relaxed p-2 rounded border border-slate-700 focus:border-purple-500 focus:outline-none resize-none h-24 scrollbar-thin scrollbar-thumb-slate-600",value:q.action,onChange:C=>U("action",C.target.value),placeholder:"   ..."})]}),u.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-600",children:[u.jsx("div",{className:"flex justify-between items-center mb-2",children:u.jsxs("p",{className:"text-xs text-indigo-400 font-bold uppercase",children:[u.jsx("i",{className:"fas fa-crop-alt mr-1"}),"   (Composition)"]})}),u.jsxs("div",{className:"flex gap-2 mb-2",children:[u.jsxs("button",{onClick:()=>Q(C=>C?{...C,composition:"center"}:null),className:`flex-1 py-2 rounded text-xs font-bold transition-all border ${!q.composition||q.composition==="center"?"bg-indigo-600 text-white border-indigo-400 shadow-[0_0_10px_rgba(99,102,241,0.5)]":"bg-slate-700 text-slate-400 border-slate-600 hover:bg-slate-600"}`,children:[u.jsx("i",{className:"fas fa-arrows-alt-h mb-1 block text-lg"}),"  ()"]}),u.jsxs("button",{onClick:()=>Q(C=>C?{...C,composition:"right"}:null),className:`flex-1 py-2 rounded text-xs font-bold transition-all border ${q.composition==="right"?"bg-indigo-600 text-white border-indigo-400 shadow-[0_0_10px_rgba(99,102,241,0.5)]":"bg-slate-700 text-slate-400 border-slate-600 hover:bg-slate-600"}`,children:[u.jsx("i",{className:"fas fa-arrow-right mb-1 block text-lg"}),"  ( )"]})]}),u.jsxs("p",{className:"text-[10px] text-slate-500 text-center",children:["* ",!q.composition||q.composition==="center"?"    .":"  ,    ."]})]}),u.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-600 space-y-2",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("p",{className:"text-xs text-green-500 font-bold uppercase",children:[u.jsx("i",{className:"fas fa-users mr-1"}),"  "]}),u.jsxs("select",{className:"bg-slate-900 text-[10px] text-slate-300 border border-slate-600 rounded px-1 py-0.5 max-w-[80px]",onChange:C=>{C.target.value&&ee(C.target.value),C.target.value=""},children:[u.jsx("option",{value:"",children:"+ "}),e&&e.map(C=>u.jsx("option",{value:C.id,children:C.name},C.id))]})]}),u.jsx("p",{className:"text-[10px] text-slate-500 leading-tight",children:"* / .  ."}),u.jsx("div",{className:"space-y-1.5 max-h-[200px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-slate-700",children:q.characters&&q.characters.map((C,G)=>u.jsxs("div",{className:"bg-slate-900 p-2 rounded border border-slate-700 relative group flex items-center justify-between",children:[u.jsxs("div",{className:"flex-1 min-w-0 mr-2",children:[u.jsxs("div",{className:"flex items-center gap-1.5",children:[u.jsx("span",{className:"text-sm font-bold text-white truncate",children:C.name}),u.jsx("span",{className:"text-[10px] text-slate-400 truncate max-w-[80px]",children:C.action})]}),u.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[u.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${C.appearance?"bg-green-500":"bg-slate-600"}`}),u.jsx("span",{className:"text-[10px] text-slate-500 truncate",children:C.appearance?" ":"  ()"})]})]}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx("button",{onClick:()=>Ae(G),className:"bg-indigo-600 hover:bg-indigo-500 text-white p-1.5 rounded text-xs",title:"  ",children:u.jsx("i",{className:"fas fa-edit"})}),u.jsx("button",{onClick:()=>Ce(G),className:"bg-slate-800 hover:bg-red-900/50 text-slate-500 hover:text-red-400 p-1.5 rounded text-xs",title:"",children:u.jsx("i",{className:"fas fa-times"})})]})]},G))}),(!q.characters||q.characters.length===0)&&u.jsx("p",{className:"text-[10px] text-slate-500 text-center py-2",children:" "})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs("button",{onClick:De,disabled:Me,className:"flex-1 bg-pink-600 hover:bg-pink-500 text-white px-3 py-2 rounded-lg font-bold shadow-lg flex items-center justify-center gap-1 text-sm",children:[Me?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-paint-brush"}),""]}),u.jsxs("button",{onClick:()=>{var C;return(C=k.current)==null?void 0:C.click()},className:"bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-2 rounded-lg font-bold shadow-lg flex items-center justify-center gap-1 text-sm",title:" ",children:[u.jsx("i",{className:"fas fa-upload"})," "]}),u.jsx("button",{onClick:()=>{confirm("  ?")&&(Q(null),pr("bangtong-thumbnail-data"))},className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-3 py-2 rounded-lg text-sm",title:"",children:u.jsx("i",{className:"fas fa-trash-alt"})})]})]}):u.jsxs("div",{className:"space-y-2",children:[u.jsx("p",{className:"text-slate-400 text-sm",children:"     ."}),u.jsxs("button",{onClick:()=>B(),disabled:Me,className:"w-full bg-purple-600 hover:bg-purple-500 text-white px-4 py-3 rounded-lg font-bold shadow-lg flex items-center justify-center gap-2",children:[Me?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-brain"}),"1. "]})]})]}),u.jsxs("div",{className:"w-full md:w-3/4 flex flex-col gap-0 bg-slate-900 rounded-lg border border-slate-800 overflow-hidden",children:[u.jsx("div",{className:"w-full bg-slate-950 relative overflow-hidden group aspect-video border-2 border-slate-700 rounded-lg shadow-inner",style:{containerType:"size"},children:q!=null&&q.imageUrl?u.jsxs("div",{className:"relative w-full h-full flex items-center justify-center overflow-hidden",children:[u.jsx("img",{src:q.imageUrl,alt:"Thumbnail",className:"w-full h-full object-contain"}),q.enableGradient&&q.gradientDirection&&u.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:q.gradientDirection==="bottom-to-top"?`linear-gradient(to top, rgba(0,0,0,1) 0%, rgba(0,0,0,0) ${q.gradientPosition||40}%)`:`linear-gradient(to right, rgba(0,0,0,1) 0%, rgba(0,0,0,0) ${q.gradientPosition||40}%)`}}),q.textLines&&q.textLines.map(C=>u.jsx("div",{className:`absolute cursor-move select-none whitespace-pre leading-tight hover:ring-2 hover:ring-indigo-500/50 rounded p-1 transition-shadow ${C.shadow?"drop-shadow-[0_4px_4px_rgba(0,0,0,0.8)]":""}`,style:{left:`${C.x}%`,top:`${C.y}%`,color:C.color,fontSize:`${C.size/10}cqw`,fontFamily:C.fontFamily||"sans-serif",fontWeight:C.fontWeight||"900",WebkitTextStroke:`${C.size/10*((C.outlineWidth??8)/100)}cqw ${C.outlineColor||"#000"}`,textShadow:C.outlineBlur?`0 0 ${C.size/30}cqw ${C.outlineColor||"#000"}`:void 0,paintOrder:"stroke fill",transform:`translate(0, -50%) scaleY(${C.heightScale||1})`,transformOrigin:"center center",letterSpacing:`${(C.letterSpacing||0)/100}em`},draggable:!0,onDragEnd:G=>{},children:C.text},C.id)),u.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-3 z-20 pointer-events-none",children:u.jsxs("div",{className:"pointer-events-auto flex gap-3",children:[u.jsx("button",{onClick:()=>Ve(q.imageUrl),className:"bg-slate-700 hover:bg-slate-600 text-white p-3 rounded-full",title:" ",children:u.jsx("i",{className:"fas fa-search-plus"})}),u.jsxs("button",{onClick:dg,className:"bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-full font-bold shadow-lg",title:"  ",children:[u.jsx("i",{className:"fas fa-download"})," "]})]})})]}):u.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-slate-600",children:[u.jsx("i",{className:"fas fa-image text-4xl mb-2"}),u.jsx("p",{children:"  "})]})}),(q==null?void 0:q.imageUrl)&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"w-full bg-slate-900 border-t border-slate-800 p-3 space-y-2",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("span",{className:"text-xs font-bold text-orange-400 uppercase",children:[u.jsx("i",{className:"fas fa-adjust mr-1"}),"  "]}),u.jsxs("div",{className:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in",children:[u.jsx("input",{type:"checkbox",name:"toggle",id:"gradient-toggle",checked:!!q.enableGradient,onChange:C=>Q(G=>G?{...G,enableGradient:C.target.checked,gradientDirection:C.target.checked&&!G.gradientDirection?G.composition==="right"?"left-to-right":"bottom-to-top":G.gradientDirection}:null),className:"toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer",style:{right:q.enableGradient?"0":"50%"}}),u.jsx("label",{htmlFor:"gradient-toggle",className:`toggle-label block overflow-hidden h-5 rounded-full cursor-pointer ${q.enableGradient?"bg-orange-500":"bg-slate-700"}`})]})]}),q.enableGradient&&u.jsxs("div",{className:"bg-slate-800 p-2 rounded border border-slate-700 animate-fade-in",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[u.jsx("span",{className:"text-[10px] text-slate-400 min-w-[30px]",children:""}),u.jsxs("div",{className:"flex bg-slate-900 rounded border border-slate-600 p-0.5 flex-1",children:[u.jsxs("button",{onClick:()=>Q(C=>C?{...C,gradientDirection:"left-to-right"}:null),className:`flex-1 py-1 text-xs rounded flex items-center justify-center gap-1 ${q.gradientDirection==="left-to-right"?"bg-orange-600 text-white":"text-slate-400 hover:text-white"}`,title:"   (  )",children:[u.jsx("i",{className:"fas fa-arrow-right"})," "]}),u.jsxs("button",{onClick:()=>Q(C=>C?{...C,gradientDirection:"bottom-to-top"}:null),className:`flex-1 py-1 text-xs rounded flex items-center justify-center gap-1 ${q.gradientDirection==="bottom-to-top"?"bg-orange-600 text-white":"text-slate-400 hover:text-white"}`,title:"   (  )",children:[u.jsx("i",{className:"fas fa-arrow-up"})," "]})]})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-[10px] text-slate-400 min-w-[30px]",children:""}),u.jsx("input",{type:"range",min:"0",max:"100",value:q.gradientPosition||40,onChange:C=>Q(G=>G?{...G,gradientPosition:parseInt(C.target.value)}:null),className:"flex-1 accent-orange-500 h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer",title:"  "}),u.jsxs("span",{className:"text-[10px] text-orange-400 w-6 text-right",children:[q.gradientPosition||40,"%"]})]})]})]}),u.jsxs("div",{className:"w-full bg-slate-900 border-t border-slate-800 p-3 space-y-2",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsxs("span",{className:"text-xs font-bold text-indigo-400 uppercase",children:[u.jsx("i",{className:"fas fa-layer-group mr-1"}),"  "]}),u.jsxs("button",{onClick:()=>Q(C=>{var G;return C?{...C,textLines:[...C.textLines||[],{id:`line-${Date.now()}`,text:" ",color:"#FFFFFF",size:40,x:10,y:50+(((G=C.textLines)==null?void 0:G.length)||0)*10,fontFamily:"sans-serif"}]}:null}),className:"text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-2 py-1 rounded",children:[u.jsx("i",{className:"fas fa-plus"}),"  "]})]}),u.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-slate-700",children:(sc=q.textLines)==null?void 0:sc.map((C,G)=>{var ne;return u.jsxs("div",{className:"bg-slate-800 p-2 rounded border border-slate-700 flex flex-col gap-2",children:[u.jsxs("div",{className:"flex gap-2",children:[u.jsx("input",{type:"text",value:C.text,onChange:L=>Q(P=>{if(!P||!P.textLines)return P;const ae=[...P.textLines];return ae[G]={...ae[G],text:L.target.value},{...P,textLines:ae}}),onKeyDown:L=>{if(L.key==="Enter"){L.preventDefault();const P=L.currentTarget.selectionStart||0,ae=C.text,we=ae.substring(0,P),ye=ae.substring(P);Q(_e=>{if(!_e||!_e.textLines)return _e;const Je=[..._e.textLines];Je[G]={...Je[G],text:we};const xt={...Je[G],id:`line-${Date.now()}`,text:ye,y:Je[G].y+10};return Je.splice(G+1,0,xt),{..._e,textLines:Je}})}},className:"bg-slate-900 border border-slate-600 rounded px-2 py-1 text-sm text-white flex-1",placeholder:"  (Enter:  )"}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsxs("select",{value:C.fontWeight||"900",onChange:L=>Q(P=>{if(!P||!P.textLines)return P;const ae=[...P.textLines];return ae[G]={...ae[G],fontWeight:L.target.value},{...P,textLines:ae}}),className:"bg-slate-900 border border-slate-600 rounded px-1 py-1 text-xs text-white max-w-[60px]",title:" ",children:[u.jsx("option",{value:"100",children:"Thin"}),u.jsx("option",{value:"300",children:"Light"}),u.jsx("option",{value:"400",children:"Regular"}),u.jsx("option",{value:"500",children:"Medium"}),u.jsx("option",{value:"700",children:"Bold"}),u.jsx("option",{value:"900",children:"Black"})]}),u.jsxs("button",{onClick:()=>{pe(G),oe(!0)},className:"bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded text-xs border border-slate-600 flex items-center gap-1 min-w-[80px] justify-between",title:" ",children:[u.jsx("span",{className:"truncate max-w-[60px]",children:((ne=qe.find(L=>L.value===C.fontFamily))==null?void 0:ne.name)||""}),u.jsx("i",{className:"fas fa-chevron-down text-[10px] text-slate-400"})]})]}),u.jsx("input",{type:"color",value:C.color,onChange:L=>Q(P=>{if(!P||!P.textLines)return P;const ae=[...P.textLines];return ae[G]={...ae[G],color:L.target.value},{...P,textLines:ae}}),className:"w-8 h-8 rounded cursor-pointer bg-transparent border-0 shrink-0",title:" "}),u.jsxs("div",{className:"flex flex-col items-center justify-center -space-y-1",children:[u.jsx("span",{className:"text-[8px] text-slate-500",children:""}),u.jsx("input",{type:"color",value:C.outlineColor||"#000000",onChange:L=>Q(P=>{if(!P||!P.textLines)return P;const ae=[...P.textLines];return ae[G]={...ae[G],outlineColor:L.target.value},{...P,textLines:ae}}),className:"w-6 h-6 rounded cursor-pointer bg-transparent border-0 shrink-0",title:" "})]}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx("span",{className:"text-[10px] text-slate-400",children:""}),u.jsx("input",{type:"number",min:"0",max:"50",value:C.outlineWidth??8,onChange:L=>Q(P=>{if(!P||!P.textLines)return P;const ae=[...P.textLines];return ae[G]={...ae[G],outlineWidth:parseInt(L.target.value)},{...P,textLines:ae}}),className:"w-12 bg-slate-900 border border-slate-600 rounded px-1 py-0.5 text-xs text-white text-center focus:border-purple-500 outline-none",title:"   "})]}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx("span",{className:"text-[10px] text-slate-400",children:""}),u.jsx("input",{type:"number",min:"50",max:"200",step:"1",value:Math.round((C.heightScale||1)*100),onChange:L=>Q(P=>{if(!P||!P.textLines)return P;const ae=[...P.textLines];return ae[G]={...ae[G],heightScale:parseInt(L.target.value)/100},{...P,textLines:ae}}),className:"w-12 bg-slate-900 border border-slate-600 rounded px-1 py-0.5 text-xs text-white text-center focus:border-purple-500 outline-none",title:"   (50% ~ 200%)"}),u.jsx("span",{className:"text-[10px] text-slate-500",children:"%"})]}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx("span",{className:"text-[10px] text-slate-400",children:""}),u.jsx("input",{type:"number",step:"1",value:C.letterSpacing||0,onChange:L=>Q(P=>{if(!P||!P.textLines)return P;const ae=[...P.textLines];return ae[G]={...ae[G],letterSpacing:parseInt(L.target.value)},{...P,textLines:ae}}),className:"w-12 bg-slate-900 border border-slate-600 rounded px-1 py-0.5 text-xs text-white text-center focus:border-purple-500 outline-none",title:"  ()"})]}),u.jsxs("div",{className:"flex items-center gap-1",title:"   (Glow)",children:[u.jsx("span",{className:"text-[10px] text-slate-400",children:""}),u.jsx("input",{type:"checkbox",checked:!!C.outlineBlur,onChange:L=>Q(P=>{if(!P||!P.textLines)return P;const ae=[...P.textLines];return ae[G]={...ae[G],outlineBlur:L.target.checked},{...P,textLines:ae}}),className:"rounded bg-slate-700 border-slate-500 text-indigo-500 focus:ring-0 w-3 h-3"})]}),u.jsxs("div",{className:"flex items-center gap-1",title:"  (Shadow)",children:[u.jsx("span",{className:"text-[10px] text-slate-400",children:""}),u.jsx("input",{type:"checkbox",checked:!!C.shadow,onChange:L=>Q(P=>{if(!P||!P.textLines)return P;const ae=[...P.textLines];return ae[G]={...ae[G],shadow:L.target.checked},{...P,textLines:ae}}),className:"rounded bg-slate-700 border-slate-500 text-indigo-500 focus:ring-0 w-3 h-3"})]}),u.jsx("button",{onClick:()=>Q(L=>{if(!L||!L.textLines)return L;const P=L.textLines.filter((ae,we)=>we!==G);return{...L,textLines:P}}),className:"text-slate-500 hover:text-red-400 px-1 ml-auto",title:"",children:u.jsx("i",{className:"fas fa-times"})})]}),u.jsxs("div",{className:"flex items-center justify-between gap-2",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-[10px] text-slate-400",children:""}),u.jsx("input",{type:"number",min:"10",max:"500",value:C.size,onChange:L=>Q(P=>{if(!P||!P.textLines)return P;const ae=[...P.textLines];return ae[G]={...ae[G],size:parseInt(L.target.value)},{...P,textLines:ae}}),className:"w-16 bg-slate-900 border border-slate-600 rounded px-1 py-0.5 text-xs text-white text-center focus:border-purple-500 outline-none",title:"   "})]}),u.jsxs("div",{className:"flex gap-1 ml-auto",children:[u.jsx("button",{onClick:()=>Q(L=>{if(!L||!L.textLines)return L;const P=[...L.textLines];return P[G]={...P[G],y:P[G].y-2},{...L,textLines:P}}),className:"bg-slate-700 w-5 h-5 rounded text-[10px] hover:bg-slate-600",children:u.jsx("i",{className:"fas fa-arrow-up"})}),u.jsx("button",{onClick:()=>Q(L=>{if(!L||!L.textLines)return L;const P=[...L.textLines];return P[G]={...P[G],y:P[G].y+2},{...L,textLines:P}}),className:"bg-slate-700 w-5 h-5 rounded text-[10px] hover:bg-slate-600",children:u.jsx("i",{className:"fas fa-arrow-down"})}),u.jsx("button",{onClick:()=>Q(L=>{if(!L||!L.textLines)return L;const P=[...L.textLines];return P[G]={...P[G],x:P[G].x-2},{...L,textLines:P}}),className:"bg-slate-700 w-5 h-5 rounded text-[10px] hover:bg-slate-600",children:u.jsx("i",{className:"fas fa-arrow-left"})}),u.jsx("button",{onClick:()=>Q(L=>{if(!L||!L.textLines)return L;const P=[...L.textLines];return P[G]={...P[G],x:P[G].x+2},{...L,textLines:P}}),className:"bg-slate-700 w-5 h-5 rounded text-[10px] hover:bg-slate-600",children:u.jsx("i",{className:"fas fa-arrow-right"})})]})]})]},C.id)})})]}),q.imageHistory&&q.imageHistory.length>0&&u.jsxs("div",{className:"w-full bg-slate-950/50 border-t border-slate-800 p-2",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1 px-1",children:[u.jsx("i",{className:"fas fa-history text-slate-500 text-[10px]"}),u.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:""})]}),u.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent px-1",children:q.imageHistory.map((C,G)=>u.jsx("div",{onClick:()=>Q(ne=>ne?{...ne,imageUrl:C}:null),className:`relative w-16 h-9 shrink-0 rounded overflow-hidden cursor-pointer border transition-all group/hist ${q.imageUrl===C?"border-pink-500 opacity-100":"border-slate-700 opacity-60 hover:opacity-100"}`,children:u.jsx("img",{src:C,alt:`Thumb History ${G}`,className:"w-full h-full object-cover"})},G))})]})]})]})]})}),u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6",children:[u.jsxs("div",{children:[u.jsxs("h3",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-bolt text-yellow-400"}),"    "]}),u.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"      ,   50 ."}),K.length>0&&u.jsxs("p",{className:"text-green-400 text-sm font-bold mt-2",children:[u.jsx("i",{className:"fas fa-check-circle mr-1"})," ",K.length," "]})]}),u.jsx("div",{className:"flex gap-2",children:ge.length>0&&u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:re,disabled:K.length===0||mt,className:`px-4 py-3 rounded-full font-bold shadow-lg transition-all flex items-center gap-2 ${K.length>0?"bg-indigo-600 hover:bg-indigo-500 text-white":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,title:"   (  )",children:[mt?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-random"}),""]}),u.jsxs("button",{onClick:xg,disabled:K.length===0,className:`px-4 py-3 rounded-full font-bold shadow-lg transition-all flex items-center gap-2 ${K.length>0?"bg-green-600 hover:bg-green-500 text-white":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,title:"  ",children:[u.jsx("i",{className:"fas fa-file-download"}),"  "]}),u.jsx("button",{onClick:()=>{window.confirm("    ?")&&(J([]),M([]),Ti([]),Si([]))},className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-4 py-3 rounded-full font-bold shadow-lg transition-all",title:"",children:u.jsx("i",{className:"fas fa-trash-alt"})})]})})]}),u.jsx("div",{className:"bg-slate-800/50 rounded-xl p-6 border border-slate-700 mb-6",children:Ei.length?u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsxs("h4",{className:"text-lg font-bold text-white flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-check-double text-green-400"}),"    ( 2)"]}),u.jsx("button",{onClick:()=>{Ti([]),Si([]),J([])},className:"text-slate-400 hover:text-white text-xs underline",children:" "})]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-6",children:Ei.map(C=>u.jsx("div",{onClick:()=>yg(C.id),className:`p-4 rounded-lg border cursor-pointer transition-all flex flex-col gap-2 ${xn.includes(C.id)?"bg-indigo-900/50 border-indigo-500 shadow-lg shadow-indigo-500/20":"bg-slate-900 border-slate-700 hover:bg-slate-800"}`,children:u.jsxs("div",{className:"flex justify-between items-center w-full",children:[u.jsx("span",{className:`font-bold ${xn.includes(C.id)?"text-white":"text-slate-300"}`,children:C.title}),xn.includes(C.id)&&u.jsx("i",{className:"fas fa-check-circle text-indigo-400 text-lg"})]})},C.id))}),u.jsxs("div",{className:"flex gap-2 mb-4",children:[u.jsx("input",{type:"text",value:kr,onChange:C=>rc(C.target.value),onKeyDown:C=>C.key==="Enter"&&oc(),placeholder:"  (:  vs )",className:"flex-1 bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white text-sm focus:border-indigo-500 outline-none"}),u.jsxs("button",{onClick:oc,disabled:!kr.trim(),className:"bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded font-bold",children:[u.jsx("i",{className:"fas fa-plus"})," "]})]}),u.jsx("div",{className:"flex justify-center",children:u.jsxs("button",{onClick:gg,disabled:ce||xn.length===0,className:`px-8 py-4 rounded-full font-bold shadow-xl flex items-center gap-2 transition-all text-lg ${xn.length>0?"bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white transform hover:scale-105":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,children:[ce?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-bolt"}),"2:    50 "]})})]}):u.jsxs("div",{className:"text-center py-8",children:[u.jsx("i",{className:"fas fa-users-slash text-4xl text-slate-600 mb-3"}),u.jsx("p",{className:"text-slate-400 mb-4",children:"      ."}),u.jsxs("button",{onClick:mg,disabled:tc,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-8 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 mx-auto transition-all",children:[tc?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-search"}),"1:   "]})]})}),ge.length>0&&u.jsx("div",{className:"bg-slate-900 rounded-xl p-6 border border-slate-700 max-h-[500px] overflow-y-auto",children:u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:ge.map((C,G)=>{const ne=K.includes(C);return u.jsxs("div",{className:`p-3 rounded-lg border transition-all flex justify-between items-center group relative
                                    ${ne?"bg-green-900/30 border-green-500 shadow-[0_0_10px_rgba(34,197,94,0.3)]":"bg-slate-800 border-slate-700 hover:border-yellow-500 hover:bg-slate-700"}
                                `,children:[u.jsxs("div",{className:"flex items-center gap-3 overflow-hidden flex-1 mr-2 cursor-pointer",onClick:()=>vg(C),children:[u.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center shrink-0 transition-colors ${ne?"bg-green-500 border-green-500":"border-slate-500 bg-transparent"}`,children:ne&&u.jsx("i",{className:"fas fa-check text-white text-xs"})}),u.jsx("div",{className:`font-medium break-all whitespace-normal ${ne?"text-green-200":"text-slate-200"} flex flex-col items-start gap-1`,children:C.includes("/")?C.split("/").map((L,P)=>u.jsx("span",{className:"block leading-tight bg-black/20 px-1 rounded",children:L.trim()},P)):u.jsx("span",{children:C})})]}),u.jsxs("div",{className:"flex gap-1",children:[u.jsxs("button",{onClick:L=>{L.stopPropagation(),confirm(`"${C}"
   ?`)&&B(C)},className:"bg-purple-600 hover:bg-purple-500 text-white p-2 rounded z-10 text-xs flex items-center gap-1 shadow-lg",title:"   ",children:[u.jsx("i",{className:"fas fa-paint-brush"})," "]}),u.jsx("button",{onClick:L=>{L.stopPropagation(),To(C)},className:"text-slate-500 hover:text-white p-2 z-10",title:"",children:u.jsx("i",{className:"fas fa-copy"})})]})]},G)})})})]}),it&&u.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/95 p-8 animate-fade-in backdrop-blur-sm",onClick:()=>Ve(null),children:u.jsxs("div",{className:"relative w-full max-w-7xl aspect-video mx-auto flex items-center justify-center bg-slate-950 border border-slate-700 rounded-xl shadow-2xl overflow-hidden ring-4 ring-slate-800/50",style:{containerType:"size"},onClick:C=>C.stopPropagation(),children:[u.jsx("img",{src:it,alt:"Preview",className:"w-full h-full object-contain"}),q&&it===q.imageUrl&&q.textLines&&q.textLines.map(C=>u.jsx("div",{className:"absolute select-none whitespace-pre-wrap leading-tight drop-shadow-[0_4px_4px_rgba(0,0,0,0.8)] pointer-events-none",style:{left:`${C.x}%`,top:`${C.y}%`,color:C.color,fontSize:`${C.size/10}cqw`,fontFamily:C.fontFamily||"sans-serif",fontWeight:C.fontWeight||"900",maxWidth:"55%",WebkitTextStroke:`${C.size/10*((C.outlineWidth??8)/100)}cqw ${C.outlineColor||"#000"}`,paintOrder:"stroke fill",transform:`translate(0, -50%) scaleY(${C.heightScale||1})`,transformOrigin:"center center"},children:C.text},C.id)),u.jsx("button",{className:"absolute top-4 right-4 bg-black/50 hover:bg-black/80 text-white p-2 rounded-full transition-colors z-50",onClick:()=>Ve(null),children:u.jsx("i",{className:"fas fa-times text-xl"})})]})}),se&&u.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in",children:u.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-700 shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col overflow-hidden",children:[u.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800",children:[u.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-font text-indigo-400"}),"  "]}),u.jsx("button",{onClick:()=>oe(!1),className:"text-slate-400 hover:text-white",children:u.jsx("i",{className:"fas fa-times text-xl"})})]}),u.jsxs("div",{className:"p-4 bg-slate-850 space-y-3 border-b border-slate-700",children:[u.jsxs("button",{onClick:H,disabled:ve,className:"w-full bg-slate-700 hover:bg-slate-600 text-white px-4 py-3 rounded-lg font-bold flex items-center justify-center gap-2 transition-colors border border-slate-600",children:[ve?u.jsx("i",{className:"fas fa-spinner fa-spin"}):u.jsx("i",{className:"fas fa-laptop-code"}),"     "]}),u.jsx("p",{className:"text-xs text-slate-500 text-center",children:"* Chrome/Edge  . ( 1   )"}),u.jsxs("div",{className:"relative",children:[u.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"}),u.jsx("input",{type:"text",placeholder:"  ...",value:Se,onChange:C=>He(C.target.value),className:"w-full bg-slate-800 text-white pl-10 pr-4 py-2 rounded-lg border border-slate-600 focus:border-indigo-500 outline-none"})]})]}),u.jsx("div",{className:"flex-1 overflow-y-auto p-2 scrollbar-thin scrollbar-thumb-slate-600",children:u.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[ke.length>0&&!Se&&u.jsxs("div",{className:"mb-4",children:[u.jsxs("div",{className:"px-2 py-1 text-xs font-bold text-yellow-500 uppercase flex items-center gap-1",children:[u.jsx("i",{className:"fas fa-star"}),"  "]}),qe.filter(C=>ke.includes(C.value)).map((C,G)=>{var ne;return u.jsxs("div",{className:"flex items-center group",children:[u.jsx("button",{onClick:()=>de(C.value),className:"p-3 text-yellow-500 hover:text-yellow-400",title:" ",children:u.jsx("i",{className:"fas fa-star"})}),u.jsxs("button",{onClick:()=>{Y!==null&&q&&(Q(L=>{if(!L||!L.textLines)return L;const P=[...L.textLines];return P[Y]={...P[Y],fontFamily:C.value},{...L,textLines:P}}),oe(!1))},className:"flex-1 text-left px-2 py-3 rounded hover:bg-slate-800 border border-transparent hover:border-slate-600 transition-all",children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsx("span",{className:"text-xs text-slate-400 font-sans group-hover:text-indigo-400",children:C.name}),(q==null?void 0:q.textLines)&&((ne=q.textLines[Y])==null?void 0:ne.fontFamily)===C.value&&u.jsx("i",{className:"fas fa-check text-green-500"})]}),u.jsx("div",{className:"text-xl text-white",style:{fontFamily:C.value},children:" ABC 123"})]})]},`fav-${G}`)}),u.jsx("div",{className:"h-px bg-slate-700 my-2 mx-2"})]}),qe.filter(C=>C.name.toLowerCase().includes(Se.toLowerCase())).map((C,G)=>{var ne;return u.jsxs("div",{className:"flex items-center group",children:[u.jsx("button",{onClick:()=>de(C.value),className:`p-3 ${ke.includes(C.value)?"text-yellow-500":"text-slate-600 hover:text-yellow-500"}`,title:ke.includes(C.value)?" ":" ",children:u.jsx("i",{className:`fas fa-star ${ke.includes(C.value)?"":"opacity-50"}`})}),u.jsxs("button",{onClick:()=>{Y!==null&&q&&(Q(L=>{if(!L||!L.textLines)return L;const P=[...L.textLines];return P[Y]={...P[Y],fontFamily:C.value},{...L,textLines:P}}),oe(!1))},className:"flex-1 text-left px-2 py-3 rounded hover:bg-slate-800 border border-transparent hover:border-slate-600 transition-all",children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsx("span",{className:"text-xs text-slate-400 font-sans group-hover:text-indigo-400",children:C.name}),(q==null?void 0:q.textLines)&&((ne=q.textLines[Y])==null?void 0:ne.fontFamily)===C.value&&u.jsx("i",{className:"fas fa-check text-green-500"})]}),u.jsx("div",{className:"text-xl text-white",style:{fontFamily:C.value},children:" ABC 123"})]})]},G)}),qe.filter(C=>C.name.toLowerCase().includes(Se.toLowerCase())).length===0&&u.jsxs("div",{className:"text-center py-8 text-slate-500",children:[u.jsx("i",{className:"fas fa-search mb-2"}),u.jsx("p",{children:"  ."})]})]})})]})}),u.jsx("div",{ref:A})]})},VC=()=>{const{toast:t,closeToast:e}=yn();if(!t)return null;const n={success:"bg-green-600",error:"bg-red-600",warning:"bg-yellow-600",info:"bg-blue-600"};return u.jsxs("div",{className:`fixed bottom-6 left-1/2 transform -translate-x-1/2 ${n[t.type]} text-white px-6 py-3 rounded-full shadow-2xl z-[100] flex items-center gap-3 animate-fade-in-up cursor-pointer`,onClick:e,children:[u.jsx("i",{className:`fas ${t.type==="success"?"fa-check-circle":t.type==="warning"?"fa-exclamation-triangle":t.type==="info"?"fa-info-circle":"fa-times-circle"}`}),u.jsx("span",{className:"font-medium",children:t.message})]})},$C=()=>{const{modalConfig:t,closeModal:e,showToast:n}=yn(),[r,o]=ue.useState("");if(ue.useEffect(()=>{t&&o(t.defaultValue||"")},[t]),!t)return null;const i=()=>{t.onConfirm(r),e(),o("")},s=()=>{e(),o("")},a=async()=>{try{const c=typeof t.message=="string"?t.message:t.defaultValue||"";await navigator.clipboard.writeText(c),n(" .","success")}catch(c){console.error(c),n(" .","error")}};return u.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fade-in",children:u.jsxs("div",{className:`bg-slate-800 border border-slate-600 rounded-xl shadow-2xl w-full p-6 relative ${t.type==="textarea"?"max-w-4xl":"max-w-lg"}`,children:[u.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:t.title}),u.jsx("div",{className:"text-slate-300 mb-4 whitespace-pre-wrap leading-relaxed text-sm max-h-[60vh] overflow-y-auto custom-scrollbar",children:t.message}),t.type==="prompt"&&u.jsx("input",{autoFocus:!0,type:"text",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white mb-6 focus:ring-2 focus:ring-indigo-500 placeholder-slate-500",placeholder:" ",value:r,onChange:c=>o(c.target.value),onKeyDown:c=>{c.key==="Enter"&&i()}}),t.type==="textarea"&&u.jsx("textarea",{autoFocus:!0,className:"w-full h-[60vh] bg-slate-900 border border-slate-700 rounded p-4 text-white mb-6 focus:ring-2 focus:ring-indigo-500 placeholder-slate-500 text-sm leading-relaxed custom-scrollbar font-mono",placeholder:"  ",value:r,onChange:c=>o(c.target.value)}),u.jsxs("div",{className:"flex justify-end gap-3 items-center",children:[t.showCopyButton&&u.jsxs("button",{onClick:a,className:"mr-auto px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-indigo-300 font-bold transition-colors border border-slate-600 flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-copy"})," "]}),u.jsx("button",{onClick:s,className:"px-4 py-2 rounded-lg text-slate-300 hover:bg-slate-700 font-medium transition-colors",children:t.cancelText||""}),u.jsx("button",{onClick:i,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-2 rounded-lg font-bold transition-all shadow-lg hover:shadow-indigo-500/30",children:t.confirmText||""})]})]})})},zC=({onOpenApiKey:t})=>{const{apiKey:e}=yn();return u.jsxs("header",{className:"bg-slate-900 border-b border-slate-700 p-4 flex items-center justify-between sticky top-0 z-50 shadow-md",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center text-white text-xl font-bold shadow-lg",children:""}),u.jsxs("h1",{className:"text-2xl font-bold text-white tracking-wide",children:["  ",u.jsx("span",{className:"text-xs text-slate-500 font-normal ml-2",children:"Ver 2.0 (Joseon Ed.)"})]})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[e&&u.jsxs("div",{className:"hidden md:flex items-center gap-2 bg-slate-800 px-3 py-1.5 rounded-full border border-slate-600 mr-2",children:[u.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse"}),u.jsx("span",{className:"text-xs text-slate-300 font-medium",children:""})]}),u.jsxs("button",{onClick:t,className:"bg-slate-800 hover:bg-slate-700 text-slate-200 px-4 py-2 rounded-lg border border-slate-600 flex items-center gap-2 transition-all text-sm font-medium",children:[u.jsx("i",{className:`fas fa-key ${e?"text-green-500":"text-yellow-500"}`}),e?"API  ":"API  "]})]})]})},Ga=({active:t,label:e,icon:n,onClick:r,disabled:o})=>u.jsxs("button",{onClick:r,disabled:o,className:`flex-1 py-4 text-lg font-bold flex items-center justify-center gap-3 transition-all ${t?"bg-indigo-600 text-white shadow-inner border-b-4 border-indigo-800":"bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white border-b-4 border-slate-900"} ${o?"opacity-50 cursor-not-allowed":""}`,children:[u.jsx("i",{className:`fas ${n} text-xl`}),e]}),WC=({isOpen:t,onClose:e})=>{const{apiKey:n,setApiKey:r,showToast:o}=yn(),[i,s]=ue.useState(n);return t?u.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[150] flex items-center justify-center p-4 animate-fade-in",children:u.jsxs("div",{className:"bg-slate-800 w-full max-w-md p-8 rounded-2xl border border-slate-600 shadow-2xl relative",children:[u.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-slate-400 hover:text-white",children:u.jsx("i",{className:"fas fa-times text-xl"})}),u.jsxs("h3",{className:"text-2xl font-bold text-white mb-4 flex items-center gap-2",children:[u.jsx("i",{className:"fas fa-key text-yellow-500"})," API  "]}),u.jsx("p",{className:"text-slate-300 mb-6 text-sm",children:"Google AI Studio  Gemini API Key ."}),u.jsx("input",{type:"password",value:i,onChange:a=>s(a.target.value),placeholder:"AIzaSy...",className:"w-full bg-slate-900 border border-slate-700 rounded-lg p-4 text-white focus:ring-2 focus:ring-indigo-500 mb-6 font-mono"}),u.jsx("button",{onClick:()=>{i?(r(i),e(),o(".","success")):o(" .","warning")},className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg",children:"  "}),u.jsx("div",{className:"mt-6 pt-4 border-t border-slate-700 text-center",children:u.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noreferrer",className:"text-indigo-400 text-sm",children:"API  "})})]})}):null},YC=()=>{const{characters:t,props:e,referenceImages:n,showToast:r}=yn(),[o,i]=ue.useState(!1),[s,a]=ue.useState("char"),c=uh.useMemo(()=>{const d=new Map;return n.forEach(h=>{d.set(h.name,{id:h.id,name:h.name,description:h.description,imageUrl:h.imageUrl,isRef:!0})}),t.forEach(h=>{d.has(h.name)||d.set(h.name,{id:h.id,name:h.name,description:h.description,imageUrl:null,isRef:!1})}),Array.from(d.values())},[t,n]);return u.jsxs("div",{className:`fixed right-0 top-32 bottom-0 z-[250] flex transition-transform duration-300 ${o?"translate-x-0":"translate-x-[320px]"}`,children:[u.jsx("button",{onClick:()=>i(!o),className:"h-14 w-8 bg-slate-800 border-l border-t border-b border-slate-600 rounded-l-lg flex items-center justify-center self-center shadow-lg hover:bg-slate-700 transition-colors",title:o?" ":" ",children:u.jsx("i",{className:`fas fa-chevron-${o?"right":"left"} text-slate-400`})}),u.jsxs("div",{className:"w-80 bg-slate-900 border-l border-slate-700 shadow-2xl p-4 flex flex-col h-full",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-4 shrink-0",children:[u.jsxs("button",{onClick:()=>a("char"),className:`flex-1 py-2 rounded text-xs font-bold ${s==="char"?"bg-indigo-600 text-white":"bg-slate-800 text-slate-400"}`,children:[u.jsx("i",{className:"fas fa-user mr-1"})," "]}),u.jsxs("button",{onClick:()=>a("prop"),className:`flex-1 py-2 rounded text-xs font-bold ${s==="prop"?"bg-amber-600 text-white":"bg-slate-800 text-slate-400"}`,children:[u.jsx("i",{className:"fas fa-cube mr-1"})," "]})]}),u.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-3",children:s==="char"?c.length===0?u.jsx("p",{className:"text-slate-500 text-center text-xs py-10",children:"  ."}):c.map(d=>u.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[d.imageUrl&&u.jsx("div",{className:"w-8 h-8 rounded bg-black overflow-hidden shrink-0",children:u.jsx("img",{src:d.imageUrl,alt:d.name,className:"w-full h-full object-cover"})}),u.jsx("span",{className:"text-white font-bold text-sm truncate",children:d.name})]}),u.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(d.description||""),r(`${d.name}  !`,"success")},className:"text-xs bg-slate-700 hover:bg-indigo-600 text-slate-300 hover:text-white px-2 py-1 rounded transition-colors shrink-0",children:[u.jsx("i",{className:"fas fa-copy mr-1"})," "]})]}),u.jsx("p",{className:"text-xs text-slate-400 line-clamp-3 leading-relaxed bg-slate-900 p-2 rounded",children:d.description||" "})]},d.id)):e.length===0?u.jsx("p",{className:"text-slate-500 text-center text-xs py-10",children:"  ."}):e.map(d=>u.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("div",{className:"w-8 h-8 rounded bg-black overflow-hidden shrink-0",children:u.jsx("img",{src:d.imageUrl,alt:d.name,className:"w-full h-full object-cover"})}),u.jsx("span",{className:"text-white font-bold text-sm",children:d.name})]}),u.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(d.description||""),r(`${d.name}  !`,"success")},className:"text-xs bg-slate-700 hover:bg-amber-600 text-slate-300 hover:text-white px-2 py-1 rounded transition-colors",children:[u.jsx("i",{className:"fas fa-copy mr-1"})," "]})]}),u.jsx("p",{className:"text-xs text-slate-400 line-clamp-3 leading-relaxed bg-slate-900 p-2 rounded",children:d.description||" "})]},d.id))})]})]})},qC=()=>{const{apiKey:t,script:e,scriptSegments:n,scenes:r,characters:o,setScenes:i,setCharacters:s,isContinuityMode:a,showToast:c,resetProject:d,openModal:h}=yn(),[m,p]=ue.useState("script"),[g,E]=ue.useState(!1),[x,w]=ue.useState(!1),[y,v]=ue.useState(30),[T,I]=ue.useState(!1),A=async k=>{if(!t)return E(!0);if(!e.trim()&&n.length===0)return c(" !","warning");const j=k;if(j<1)return c("  1  .","warning");w(!0);try{let D=e,V=e;a?n.length>0&&(D=n[n.length-1].content,c(`  :  (${n[n.length-1].title})   .`,"success")):c("  :     .","success"),c(`1/2: (Scene)   ... (:  ${j})`,"success");const z=(await yC(t,D,a?r:[],j,o,!0)).map((K,M)=>({...K,id:K.id||`scene-${Date.now()}-${M}`}));c("2/2:     ...","success");const te=await vC(t,V,z,a?o:[]);let ge=[...te];if(a){const K=[...o];te.forEach(M=>{K.some(ce=>ce.name===M.name)||K.push(M)}),ge=K}const J=z.map(K=>{if(K.casting&&(K.casting.mainIds.length>0||K.casting.subIds.length>0||K.casting.propIds&&K.casting.propIds.length>0))return K;const M=K.characterNames||[],ce=ge.filter(W=>M.some($=>$.includes(W.name)||W.name.includes($))).map(W=>W.id);return{...K,casting:{mainIds:ce,subIds:[],propIds:[]}}});a?(i(J),s(K=>{const M=[...K];return te.forEach(ce=>{M.findIndex($=>$.name===ce.name)===-1&&M.push(ce)}),M}),c(` !   (${J.length}) .`,"success")):(i(J),s(te),c(` !  (${J.length}) .`,"success")),p("sintong"),w(!1)}catch(D){console.error(D),c("   .","error"),w(!1)}},O=()=>{h({type:"confirm",title:" ",message:`     ?
    .`,confirmText:"",cancelText:"",onConfirm:()=>d()})};return u.jsxs("div",{className:"min-h-screen bg-[#0f172a] text-slate-200 font-sans selection:bg-indigo-500 selection:text-white pb-20",children:[u.jsx(zC,{onOpenApiKey:()=>E(!0)}),u.jsxs("div",{className:"flex border-b border-slate-700 sticky top-[72px] z-40 bg-[#0f172a]",children:[u.jsx(Ga,{active:m==="script",onClick:()=>p("script"),label:"1. /",icon:"fa-file-alt"}),u.jsx(Ga,{active:m==="opening",onClick:()=>p("opening"),label:"2.  ()",icon:"fa-film"}),u.jsx(Ga,{active:m==="sintong",onClick:()=>p("sintong"),label:"3.  ( )",icon:"fa-layer-group"})]}),u.jsxs("main",{className:"max-w-6xl mx-auto p-6 min-h-[calc(100vh-140px)]",children:[m==="script"&&u.jsx(FC,{onAnalyze:A,isAnalyzing:x}),m==="opening"&&u.jsx(jC,{}),m==="sintong"&&u.jsx(BC,{onNext:()=>{},isNextLoading:!1})]}),u.jsx(YC,{}),u.jsx("div",{className:"fixed bottom-6 right-6 z-40",children:u.jsxs("button",{onClick:O,className:"bg-red-900/80 hover:bg-red-900 text-red-200 px-4 py-2 rounded-full text-xs border border-red-700 backdrop-blur",children:[u.jsx("i",{className:"fas fa-trash mr-1"}),"  "]})}),u.jsx($C,{}),u.jsx(VC,{}),u.jsx(WC,{isOpen:g,onClose:()=>E(!1)})]})},KC=()=>u.jsx(ev,{children:u.jsx(qC,{})}),cg=document.getElementById("root");if(!cg)throw new Error("Could not find root element to mount to");const JC=Ha.createRoot(cg);JC.render(u.jsx(uh.StrictMode,{children:u.jsx(KC,{})}));
