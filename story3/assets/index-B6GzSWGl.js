(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var Nn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kf={exports:{}},Ns={},Pf={exports:{}},je={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ei=Symbol.for("react.element"),zm=Symbol.for("react.portal"),$m=Symbol.for("react.fragment"),Wm=Symbol.for("react.strict_mode"),qm=Symbol.for("react.profiler"),Ym=Symbol.for("react.provider"),Km=Symbol.for("react.context"),Jm=Symbol.for("react.forward_ref"),Xm=Symbol.for("react.suspense"),Zm=Symbol.for("react.memo"),Qm=Symbol.for("react.lazy"),Gu=Symbol.iterator;function eg(t){return t===null||typeof t!="object"?null:(t=Gu&&t[Gu]||t["@@iterator"],typeof t=="function"?t:null)}var Mf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Lf=Object.assign,Of={};function io(t,e,n){this.props=t,this.context=e,this.refs=Of,this.updater=n||Mf}io.prototype.isReactComponent={};io.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};io.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Df(){}Df.prototype=io.prototype;function Pl(t,e,n){this.props=t,this.context=e,this.refs=Of,this.updater=n||Mf}var Ml=Pl.prototype=new Df;Ml.constructor=Pl;Lf(Ml,io.prototype);Ml.isPureReactComponent=!0;var Hu=Array.isArray,Uf=Object.prototype.hasOwnProperty,Ll={current:null},Ff={key:!0,ref:!0,__self:!0,__source:!0};function Gf(t,e,n){var r,o={},i=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(i=""+e.key),e)Uf.call(e,r)&&!Ff.hasOwnProperty(r)&&(o[r]=e[r]);var a=arguments.length-2;if(a===1)o.children=n;else if(1<a){for(var u=Array(a),d=0;d<a;d++)u[d]=arguments[d+2];o.children=u}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)o[r]===void 0&&(o[r]=a[r]);return{$$typeof:ei,type:t,key:i,ref:s,props:o,_owner:Ll.current}}function tg(t,e){return{$$typeof:ei,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Ol(t){return typeof t=="object"&&t!==null&&t.$$typeof===ei}function ng(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Bu=/\/+/g;function Ys(t,e){return typeof t=="object"&&t!==null&&t.key!=null?ng(""+t.key):e.toString(36)}function ki(t,e,n,r,o){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case ei:case zm:s=!0}}if(s)return s=t,o=o(s),t=r===""?"."+Ys(s,0):r,Hu(o)?(n="",t!=null&&(n=t.replace(Bu,"$&/")+"/"),ki(o,e,n,"",function(d){return d})):o!=null&&(Ol(o)&&(o=tg(o,n+(!o.key||s&&s.key===o.key?"":(""+o.key).replace(Bu,"$&/")+"/")+t)),e.push(o)),1;if(s=0,r=r===""?".":r+":",Hu(t))for(var a=0;a<t.length;a++){i=t[a];var u=r+Ys(i,a);s+=ki(i,e,n,u,o)}else if(u=eg(t),typeof u=="function")for(t=u.call(t),a=0;!(i=t.next()).done;)i=i.value,u=r+Ys(i,a++),s+=ki(i,e,n,u,o);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function si(t,e,n){if(t==null)return t;var r=[],o=0;return ki(t,r,"","",function(i){return e.call(n,i,o++)}),r}function rg(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ot={current:null},Pi={transition:null},og={ReactCurrentDispatcher:Ot,ReactCurrentBatchConfig:Pi,ReactCurrentOwner:Ll};function Hf(){throw Error("act(...) is not supported in production builds of React.")}je.Children={map:si,forEach:function(t,e,n){si(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return si(t,function(){e++}),e},toArray:function(t){return si(t,function(e){return e})||[]},only:function(t){if(!Ol(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};je.Component=io;je.Fragment=$m;je.Profiler=qm;je.PureComponent=Pl;je.StrictMode=Wm;je.Suspense=Xm;je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=og;je.act=Hf;je.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Lf({},t.props),o=t.key,i=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,s=Ll.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(u in e)Uf.call(e,u)&&!Ff.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&a!==void 0?a[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){a=Array(u);for(var d=0;d<u;d++)a[d]=arguments[d+2];r.children=a}return{$$typeof:ei,type:t.type,key:o,ref:i,props:r,_owner:s}};je.createContext=function(t){return t={$$typeof:Km,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Ym,_context:t},t.Consumer=t};je.createElement=Gf;je.createFactory=function(t){var e=Gf.bind(null,t);return e.type=t,e};je.createRef=function(){return{current:null}};je.forwardRef=function(t){return{$$typeof:Jm,render:t}};je.isValidElement=Ol;je.lazy=function(t){return{$$typeof:Qm,_payload:{_status:-1,_result:t},_init:rg}};je.memo=function(t,e){return{$$typeof:Zm,type:t,compare:e===void 0?null:e}};je.startTransition=function(t){var e=Pi.transition;Pi.transition={};try{t()}finally{Pi.transition=e}};je.unstable_act=Hf;je.useCallback=function(t,e){return Ot.current.useCallback(t,e)};je.useContext=function(t){return Ot.current.useContext(t)};je.useDebugValue=function(){};je.useDeferredValue=function(t){return Ot.current.useDeferredValue(t)};je.useEffect=function(t,e){return Ot.current.useEffect(t,e)};je.useId=function(){return Ot.current.useId()};je.useImperativeHandle=function(t,e,n){return Ot.current.useImperativeHandle(t,e,n)};je.useInsertionEffect=function(t,e){return Ot.current.useInsertionEffect(t,e)};je.useLayoutEffect=function(t,e){return Ot.current.useLayoutEffect(t,e)};je.useMemo=function(t,e){return Ot.current.useMemo(t,e)};je.useReducer=function(t,e,n){return Ot.current.useReducer(t,e,n)};je.useRef=function(t){return Ot.current.useRef(t)};je.useState=function(t){return Ot.current.useState(t)};je.useSyncExternalStore=function(t,e,n){return Ot.current.useSyncExternalStore(t,e,n)};je.useTransition=function(){return Ot.current.useTransition()};je.version="18.3.1";Pf.exports=je;var se=Pf.exports;const Bf=Rf(se);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ig=se,sg=Symbol.for("react.element"),ag=Symbol.for("react.fragment"),lg=Object.prototype.hasOwnProperty,ug=ig.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,cg={key:!0,ref:!0,__self:!0,__source:!0};function Vf(t,e,n){var r,o={},i=null,s=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)lg.call(e,r)&&!cg.hasOwnProperty(r)&&(o[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)o[r]===void 0&&(o[r]=e[r]);return{$$typeof:sg,type:t,key:i,ref:s,props:o,_owner:ug.current}}Ns.Fragment=ag;Ns.jsx=Vf;Ns.jsxs=Vf;kf.exports=Ns;var f=kf.exports,Ca={},jf={exports:{}},qt={},zf={exports:{}},$f={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(te,H){var ie=te.length;te.push(H);e:for(;0<ie;){var F=ie-1>>>1,R=te[F];if(0<o(R,H))te[F]=H,te[ie]=R,ie=F;else break e}}function n(te){return te.length===0?null:te[0]}function r(te){if(te.length===0)return null;var H=te[0],ie=te.pop();if(ie!==H){te[0]=ie;e:for(var F=0,R=te.length,de=R>>>1;F<de;){var ge=2*(F+1)-1,ae=te[ge],_e=ge+1,ze=te[_e];if(0>o(ae,ie))_e<R&&0>o(ze,ae)?(te[F]=ze,te[_e]=ie,F=_e):(te[F]=ae,te[ge]=ie,F=ge);else if(_e<R&&0>o(ze,ie))te[F]=ze,te[_e]=ie,F=_e;else break e}}return H}function o(te,H){var ie=te.sortIndex-H.sortIndex;return ie!==0?ie:te.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,a=s.now();t.unstable_now=function(){return s.now()-a}}var u=[],d=[],h=1,m=null,p=3,g=!1,E=!1,x=!1,w=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(te){for(var H=n(d);H!==null;){if(H.callback===null)r(d);else if(H.startTime<=te)r(d),H.sortIndex=H.expirationTime,e(u,H);else break;H=n(d)}}function N(te){if(x=!1,S(te),!E)if(n(u)!==null)E=!0,he(I);else{var H=n(d);H!==null&&J(N,H.startTime-te)}}function I(te,H){E=!1,x&&(x=!1,y(D),D=-1),g=!0;var ie=p;try{for(S(H),m=n(u);m!==null&&(!(m.expirationTime>H)||te&&!Q());){var F=m.callback;if(typeof F=="function"){m.callback=null,p=m.priorityLevel;var R=F(m.expirationTime<=H);H=t.unstable_now(),typeof R=="function"?m.callback=R:m===n(u)&&r(u),S(H)}else r(u);m=n(u)}if(m!==null)var de=!0;else{var ge=n(d);ge!==null&&J(N,ge.startTime-H),de=!1}return de}finally{m=null,p=ie,g=!1}}var L=!1,P=null,D=-1,M=5,j=-1;function Q(){return!(t.unstable_now()-j<M)}function _(){if(P!==null){var te=t.unstable_now();j=te;var H=!0;try{H=P(!0,te)}finally{H?z():(L=!1,P=null)}}else L=!1}var z;if(typeof v=="function")z=function(){v(_)};else if(typeof MessageChannel<"u"){var C=new MessageChannel,Y=C.port2;C.port1.onmessage=_,z=function(){Y.postMessage(null)}}else z=function(){w(_,0)};function he(te){P=te,L||(L=!0,z())}function J(te,H){D=w(function(){te(t.unstable_now())},H)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(te){te.callback=null},t.unstable_continueExecution=function(){E||g||(E=!0,he(I))},t.unstable_forceFrameRate=function(te){0>te||125<te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<te?Math.floor(1e3/te):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(te){switch(p){case 1:case 2:case 3:var H=3;break;default:H=p}var ie=p;p=H;try{return te()}finally{p=ie}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(te,H){switch(te){case 1:case 2:case 3:case 4:case 5:break;default:te=3}var ie=p;p=te;try{return H()}finally{p=ie}},t.unstable_scheduleCallback=function(te,H,ie){var F=t.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?F+ie:F):ie=F,te){case 1:var R=-1;break;case 2:R=250;break;case 5:R=1073741823;break;case 4:R=1e4;break;default:R=5e3}return R=ie+R,te={id:h++,callback:H,priorityLevel:te,startTime:ie,expirationTime:R,sortIndex:-1},ie>F?(te.sortIndex=ie,e(d,te),n(u)===null&&te===n(d)&&(x?(y(D),D=-1):x=!0,J(N,ie-F))):(te.sortIndex=R,e(u,te),E||g||(E=!0,he(I))),te},t.unstable_shouldYield=Q,t.unstable_wrapCallback=function(te){var H=p;return function(){var ie=p;p=H;try{return te.apply(this,arguments)}finally{p=ie}}}})($f);zf.exports=$f;var dg=zf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fg=se,Wt=dg;function me(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Wf=new Set,Do={};function Er(t,e){Zr(t,e),Zr(t+"Capture",e)}function Zr(t,e){for(Do[t]=e,t=0;t<e.length;t++)Wf.add(e[t])}var An=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Na=Object.prototype.hasOwnProperty,hg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Vu={},ju={};function pg(t){return Na.call(ju,t)?!0:Na.call(Vu,t)?!1:hg.test(t)?ju[t]=!0:(Vu[t]=!0,!1)}function mg(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function gg(t,e,n,r){if(e===null||typeof e>"u"||mg(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Dt(t,e,n,r,o,i,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=s}var wt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){wt[t]=new Dt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];wt[e]=new Dt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){wt[t]=new Dt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){wt[t]=new Dt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){wt[t]=new Dt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){wt[t]=new Dt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){wt[t]=new Dt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){wt[t]=new Dt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){wt[t]=new Dt(t,5,!1,t.toLowerCase(),null,!1,!1)});var Dl=/[\-:]([a-z])/g;function Ul(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Dl,Ul);wt[e]=new Dt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Dl,Ul);wt[e]=new Dt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Dl,Ul);wt[e]=new Dt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){wt[t]=new Dt(t,1,!1,t.toLowerCase(),null,!1,!1)});wt.xlinkHref=new Dt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){wt[t]=new Dt(t,1,!1,t.toLowerCase(),null,!0,!0)});function Fl(t,e,n,r){var o=wt.hasOwnProperty(e)?wt[e]:null;(o!==null?o.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(gg(e,n,o,r)&&(n=null),r||o===null?pg(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):o.mustUseProperty?t[o.propertyName]=n===null?o.type===3?!1:"":n:(e=o.attributeName,r=o.attributeNamespace,n===null?t.removeAttribute(e):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Ln=fg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ai=Symbol.for("react.element"),_r=Symbol.for("react.portal"),Ar=Symbol.for("react.fragment"),Gl=Symbol.for("react.strict_mode"),Ia=Symbol.for("react.profiler"),qf=Symbol.for("react.provider"),Yf=Symbol.for("react.context"),Hl=Symbol.for("react.forward_ref"),ba=Symbol.for("react.suspense"),_a=Symbol.for("react.suspense_list"),Bl=Symbol.for("react.memo"),Fn=Symbol.for("react.lazy"),Kf=Symbol.for("react.offscreen"),zu=Symbol.iterator;function fo(t){return t===null||typeof t!="object"?null:(t=zu&&t[zu]||t["@@iterator"],typeof t=="function"?t:null)}var ot=Object.assign,Ks;function So(t){if(Ks===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Ks=e&&e[1]||""}return`
`+Ks+t}var Js=!1;function Xs(t,e){if(!t||Js)return"";Js=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var o=d.stack.split(`
`),i=r.stack.split(`
`),s=o.length-1,a=i.length-1;1<=s&&0<=a&&o[s]!==i[a];)a--;for(;1<=s&&0<=a;s--,a--)if(o[s]!==i[a]){if(s!==1||a!==1)do if(s--,a--,0>a||o[s]!==i[a]){var u=`
`+o[s].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=s&&0<=a);break}}}finally{Js=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?So(t):""}function yg(t){switch(t.tag){case 5:return So(t.type);case 16:return So("Lazy");case 13:return So("Suspense");case 19:return So("SuspenseList");case 0:case 2:case 15:return t=Xs(t.type,!1),t;case 11:return t=Xs(t.type.render,!1),t;case 1:return t=Xs(t.type,!0),t;default:return""}}function Aa(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ar:return"Fragment";case _r:return"Portal";case Ia:return"Profiler";case Gl:return"StrictMode";case ba:return"Suspense";case _a:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Yf:return(t.displayName||"Context")+".Consumer";case qf:return(t._context.displayName||"Context")+".Provider";case Hl:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Bl:return e=t.displayName||null,e!==null?e:Aa(t.type)||"Memo";case Fn:e=t._payload,t=t._init;try{return Aa(t(e))}catch{}}return null}function vg(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Aa(e);case 8:return e===Gl?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Qn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Jf(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function xg(t){var e=Jf(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(s){r=""+s,i.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function li(t){t._valueTracker||(t._valueTracker=xg(t))}function Xf(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Jf(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Yi(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ra(t,e){var n=e.checked;return ot({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function $u(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Qn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Zf(t,e){e=e.checked,e!=null&&Fl(t,"checked",e,!1)}function ka(t,e){Zf(t,e);var n=Qn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Pa(t,e.type,n):e.hasOwnProperty("defaultValue")&&Pa(t,e.type,Qn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Wu(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Pa(t,e,n){(e!=="number"||Yi(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var wo=Array.isArray;function zr(t,e,n,r){if(t=t.options,e){e={};for(var o=0;o<n.length;o++)e["$"+n[o]]=!0;for(n=0;n<t.length;n++)o=e.hasOwnProperty("$"+t[n].value),t[n].selected!==o&&(t[n].selected=o),o&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Qn(n),e=null,o=0;o<t.length;o++){if(t[o].value===n){t[o].selected=!0,r&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function Ma(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(me(91));return ot({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function qu(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(me(92));if(wo(n)){if(1<n.length)throw Error(me(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Qn(n)}}function Qf(t,e){var n=Qn(e.value),r=Qn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Yu(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function eh(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function La(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?eh(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ui,th=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,o){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ui=ui||document.createElement("div"),ui.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ui.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Uo(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var bo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Eg=["Webkit","ms","Moz","O"];Object.keys(bo).forEach(function(t){Eg.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),bo[e]=bo[t]})});function nh(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||bo.hasOwnProperty(t)&&bo[t]?(""+e).trim():e+"px"}function rh(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,o=nh(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,o):t[n]=o}}var Tg=ot({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Oa(t,e){if(e){if(Tg[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(me(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(me(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(me(61))}if(e.style!=null&&typeof e.style!="object")throw Error(me(62))}}function Da(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ua=null;function Vl(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Fa=null,$r=null,Wr=null;function Ku(t){if(t=ri(t)){if(typeof Fa!="function")throw Error(me(280));var e=t.stateNode;e&&(e=Rs(e),Fa(t.stateNode,t.type,e))}}function oh(t){$r?Wr?Wr.push(t):Wr=[t]:$r=t}function ih(){if($r){var t=$r,e=Wr;if(Wr=$r=null,Ku(t),e)for(t=0;t<e.length;t++)Ku(e[t])}}function sh(t,e){return t(e)}function ah(){}var Zs=!1;function lh(t,e,n){if(Zs)return t(e,n);Zs=!0;try{return sh(t,e,n)}finally{Zs=!1,($r!==null||Wr!==null)&&(ah(),ih())}}function Fo(t,e){var n=t.stateNode;if(n===null)return null;var r=Rs(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(me(231,e,typeof n));return n}var Ga=!1;if(An)try{var ho={};Object.defineProperty(ho,"passive",{get:function(){Ga=!0}}),window.addEventListener("test",ho,ho),window.removeEventListener("test",ho,ho)}catch{Ga=!1}function Sg(t,e,n,r,o,i,s,a,u){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(h){this.onError(h)}}var _o=!1,Ki=null,Ji=!1,Ha=null,wg={onError:function(t){_o=!0,Ki=t}};function Cg(t,e,n,r,o,i,s,a,u){_o=!1,Ki=null,Sg.apply(wg,arguments)}function Ng(t,e,n,r,o,i,s,a,u){if(Cg.apply(this,arguments),_o){if(_o){var d=Ki;_o=!1,Ki=null}else throw Error(me(198));Ji||(Ji=!0,Ha=d)}}function Tr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function uh(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Ju(t){if(Tr(t)!==t)throw Error(me(188))}function Ig(t){var e=t.alternate;if(!e){if(e=Tr(t),e===null)throw Error(me(188));return e!==t?null:t}for(var n=t,r=e;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(r=o.return,r!==null){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return Ju(o),t;if(i===r)return Ju(o),e;i=i.sibling}throw Error(me(188))}if(n.return!==r.return)n=o,r=i;else{for(var s=!1,a=o.child;a;){if(a===n){s=!0,n=o,r=i;break}if(a===r){s=!0,r=o,n=i;break}a=a.sibling}if(!s){for(a=i.child;a;){if(a===n){s=!0,n=i,r=o;break}if(a===r){s=!0,r=i,n=o;break}a=a.sibling}if(!s)throw Error(me(189))}}if(n.alternate!==r)throw Error(me(190))}if(n.tag!==3)throw Error(me(188));return n.stateNode.current===n?t:e}function ch(t){return t=Ig(t),t!==null?dh(t):null}function dh(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=dh(t);if(e!==null)return e;t=t.sibling}return null}var fh=Wt.unstable_scheduleCallback,Xu=Wt.unstable_cancelCallback,bg=Wt.unstable_shouldYield,_g=Wt.unstable_requestPaint,at=Wt.unstable_now,Ag=Wt.unstable_getCurrentPriorityLevel,jl=Wt.unstable_ImmediatePriority,hh=Wt.unstable_UserBlockingPriority,Xi=Wt.unstable_NormalPriority,Rg=Wt.unstable_LowPriority,ph=Wt.unstable_IdlePriority,Is=null,Tn=null;function kg(t){if(Tn&&typeof Tn.onCommitFiberRoot=="function")try{Tn.onCommitFiberRoot(Is,t,void 0,(t.current.flags&128)===128)}catch{}}var dn=Math.clz32?Math.clz32:Lg,Pg=Math.log,Mg=Math.LN2;function Lg(t){return t>>>=0,t===0?32:31-(Pg(t)/Mg|0)|0}var ci=64,di=4194304;function Co(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Zi(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,o=t.suspendedLanes,i=t.pingedLanes,s=n&268435455;if(s!==0){var a=s&~o;a!==0?r=Co(a):(i&=s,i!==0&&(r=Co(i)))}else s=n&~o,s!==0?r=Co(s):i!==0&&(r=Co(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&o)&&(o=r&-r,i=e&-e,o>=i||o===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-dn(e),o=1<<n,r|=t[n],e&=~o;return r}function Og(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Dg(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,o=t.expirationTimes,i=t.pendingLanes;0<i;){var s=31-dn(i),a=1<<s,u=o[s];u===-1?(!(a&n)||a&r)&&(o[s]=Og(a,e)):u<=e&&(t.expiredLanes|=a),i&=~a}}function Ba(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function mh(){var t=ci;return ci<<=1,!(ci&4194240)&&(ci=64),t}function Qs(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ti(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-dn(e),t[e]=n}function Ug(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var o=31-dn(n),i=1<<o;e[o]=0,r[o]=-1,t[o]=-1,n&=~i}}function zl(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-dn(n),o=1<<r;o&e|t[r]&e&&(t[r]|=e),n&=~o}}var Ye=0;function gh(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var yh,$l,vh,xh,Eh,Va=!1,fi=[],$n=null,Wn=null,qn=null,Go=new Map,Ho=new Map,Hn=[],Fg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Zu(t,e){switch(t){case"focusin":case"focusout":$n=null;break;case"dragenter":case"dragleave":Wn=null;break;case"mouseover":case"mouseout":qn=null;break;case"pointerover":case"pointerout":Go.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ho.delete(e.pointerId)}}function po(t,e,n,r,o,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[o]},e!==null&&(e=ri(e),e!==null&&$l(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function Gg(t,e,n,r,o){switch(e){case"focusin":return $n=po($n,t,e,n,r,o),!0;case"dragenter":return Wn=po(Wn,t,e,n,r,o),!0;case"mouseover":return qn=po(qn,t,e,n,r,o),!0;case"pointerover":var i=o.pointerId;return Go.set(i,po(Go.get(i)||null,t,e,n,r,o)),!0;case"gotpointercapture":return i=o.pointerId,Ho.set(i,po(Ho.get(i)||null,t,e,n,r,o)),!0}return!1}function Th(t){var e=ur(t.target);if(e!==null){var n=Tr(e);if(n!==null){if(e=n.tag,e===13){if(e=uh(n),e!==null){t.blockedOn=e,Eh(t.priority,function(){vh(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Mi(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=ja(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Ua=r,n.target.dispatchEvent(r),Ua=null}else return e=ri(n),e!==null&&$l(e),t.blockedOn=n,!1;e.shift()}return!0}function Qu(t,e,n){Mi(t)&&n.delete(e)}function Hg(){Va=!1,$n!==null&&Mi($n)&&($n=null),Wn!==null&&Mi(Wn)&&(Wn=null),qn!==null&&Mi(qn)&&(qn=null),Go.forEach(Qu),Ho.forEach(Qu)}function mo(t,e){t.blockedOn===e&&(t.blockedOn=null,Va||(Va=!0,Wt.unstable_scheduleCallback(Wt.unstable_NormalPriority,Hg)))}function Bo(t){function e(o){return mo(o,t)}if(0<fi.length){mo(fi[0],t);for(var n=1;n<fi.length;n++){var r=fi[n];r.blockedOn===t&&(r.blockedOn=null)}}for($n!==null&&mo($n,t),Wn!==null&&mo(Wn,t),qn!==null&&mo(qn,t),Go.forEach(e),Ho.forEach(e),n=0;n<Hn.length;n++)r=Hn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Hn.length&&(n=Hn[0],n.blockedOn===null);)Th(n),n.blockedOn===null&&Hn.shift()}var qr=Ln.ReactCurrentBatchConfig,Qi=!0;function Bg(t,e,n,r){var o=Ye,i=qr.transition;qr.transition=null;try{Ye=1,Wl(t,e,n,r)}finally{Ye=o,qr.transition=i}}function Vg(t,e,n,r){var o=Ye,i=qr.transition;qr.transition=null;try{Ye=4,Wl(t,e,n,r)}finally{Ye=o,qr.transition=i}}function Wl(t,e,n,r){if(Qi){var o=ja(t,e,n,r);if(o===null)ua(t,e,r,es,n),Zu(t,r);else if(Gg(o,t,e,n,r))r.stopPropagation();else if(Zu(t,r),e&4&&-1<Fg.indexOf(t)){for(;o!==null;){var i=ri(o);if(i!==null&&yh(i),i=ja(t,e,n,r),i===null&&ua(t,e,r,es,n),i===o)break;o=i}o!==null&&r.stopPropagation()}else ua(t,e,r,null,n)}}var es=null;function ja(t,e,n,r){if(es=null,t=Vl(r),t=ur(t),t!==null)if(e=Tr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=uh(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return es=t,null}function Sh(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ag()){case jl:return 1;case hh:return 4;case Xi:case Rg:return 16;case ph:return 536870912;default:return 16}default:return 16}}var Vn=null,ql=null,Li=null;function wh(){if(Li)return Li;var t,e=ql,n=e.length,r,o="value"in Vn?Vn.value:Vn.textContent,i=o.length;for(t=0;t<n&&e[t]===o[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===o[i-r];r++);return Li=o.slice(t,1<r?1-r:void 0)}function Oi(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function hi(){return!0}function ec(){return!1}function Yt(t){function e(n,r,o,i,s){this._reactName=n,this._targetInst=o,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?hi:ec,this.isPropagationStopped=ec,this}return ot(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=hi)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=hi)},persist:function(){},isPersistent:hi}),e}var so={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yl=Yt(so),ni=ot({},so,{view:0,detail:0}),jg=Yt(ni),ea,ta,go,bs=ot({},ni,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kl,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==go&&(go&&t.type==="mousemove"?(ea=t.screenX-go.screenX,ta=t.screenY-go.screenY):ta=ea=0,go=t),ea)},movementY:function(t){return"movementY"in t?t.movementY:ta}}),tc=Yt(bs),zg=ot({},bs,{dataTransfer:0}),$g=Yt(zg),Wg=ot({},ni,{relatedTarget:0}),na=Yt(Wg),qg=ot({},so,{animationName:0,elapsedTime:0,pseudoElement:0}),Yg=Yt(qg),Kg=ot({},so,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Jg=Yt(Kg),Xg=ot({},so,{data:0}),nc=Yt(Xg),Zg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},e0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function t0(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=e0[t])?!!e[t]:!1}function Kl(){return t0}var n0=ot({},ni,{key:function(t){if(t.key){var e=Zg[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Oi(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Qg[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kl,charCode:function(t){return t.type==="keypress"?Oi(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Oi(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),r0=Yt(n0),o0=ot({},bs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rc=Yt(o0),i0=ot({},ni,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kl}),s0=Yt(i0),a0=ot({},so,{propertyName:0,elapsedTime:0,pseudoElement:0}),l0=Yt(a0),u0=ot({},bs,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),c0=Yt(u0),d0=[9,13,27,32],Jl=An&&"CompositionEvent"in window,Ao=null;An&&"documentMode"in document&&(Ao=document.documentMode);var f0=An&&"TextEvent"in window&&!Ao,Ch=An&&(!Jl||Ao&&8<Ao&&11>=Ao),oc=" ",ic=!1;function Nh(t,e){switch(t){case"keyup":return d0.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ih(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Rr=!1;function h0(t,e){switch(t){case"compositionend":return Ih(e);case"keypress":return e.which!==32?null:(ic=!0,oc);case"textInput":return t=e.data,t===oc&&ic?null:t;default:return null}}function p0(t,e){if(Rr)return t==="compositionend"||!Jl&&Nh(t,e)?(t=wh(),Li=ql=Vn=null,Rr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Ch&&e.locale!=="ko"?null:e.data;default:return null}}var m0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sc(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!m0[t.type]:e==="textarea"}function bh(t,e,n,r){oh(r),e=ts(e,"onChange"),0<e.length&&(n=new Yl("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ro=null,Vo=null;function g0(t){Fh(t,0)}function _s(t){var e=Mr(t);if(Xf(e))return t}function y0(t,e){if(t==="change")return e}var _h=!1;if(An){var ra;if(An){var oa="oninput"in document;if(!oa){var ac=document.createElement("div");ac.setAttribute("oninput","return;"),oa=typeof ac.oninput=="function"}ra=oa}else ra=!1;_h=ra&&(!document.documentMode||9<document.documentMode)}function lc(){Ro&&(Ro.detachEvent("onpropertychange",Ah),Vo=Ro=null)}function Ah(t){if(t.propertyName==="value"&&_s(Vo)){var e=[];bh(e,Vo,t,Vl(t)),lh(g0,e)}}function v0(t,e,n){t==="focusin"?(lc(),Ro=e,Vo=n,Ro.attachEvent("onpropertychange",Ah)):t==="focusout"&&lc()}function x0(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return _s(Vo)}function E0(t,e){if(t==="click")return _s(e)}function T0(t,e){if(t==="input"||t==="change")return _s(e)}function S0(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var mn=typeof Object.is=="function"?Object.is:S0;function jo(t,e){if(mn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!Na.call(e,o)||!mn(t[o],e[o]))return!1}return!0}function uc(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function cc(t,e){var n=uc(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=uc(n)}}function Rh(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Rh(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function kh(){for(var t=window,e=Yi();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Yi(t.document)}return e}function Xl(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function w0(t){var e=kh(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Rh(n.ownerDocument.documentElement,n)){if(r!==null&&Xl(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=n.textContent.length,i=Math.min(r.start,o);r=r.end===void 0?i:Math.min(r.end,o),!t.extend&&i>r&&(o=r,r=i,i=o),o=cc(n,i);var s=cc(n,r);o&&s&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var C0=An&&"documentMode"in document&&11>=document.documentMode,kr=null,za=null,ko=null,$a=!1;function dc(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;$a||kr==null||kr!==Yi(r)||(r=kr,"selectionStart"in r&&Xl(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ko&&jo(ko,r)||(ko=r,r=ts(za,"onSelect"),0<r.length&&(e=new Yl("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=kr)))}function pi(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Pr={animationend:pi("Animation","AnimationEnd"),animationiteration:pi("Animation","AnimationIteration"),animationstart:pi("Animation","AnimationStart"),transitionend:pi("Transition","TransitionEnd")},ia={},Ph={};An&&(Ph=document.createElement("div").style,"AnimationEvent"in window||(delete Pr.animationend.animation,delete Pr.animationiteration.animation,delete Pr.animationstart.animation),"TransitionEvent"in window||delete Pr.transitionend.transition);function As(t){if(ia[t])return ia[t];if(!Pr[t])return t;var e=Pr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Ph)return ia[t]=e[n];return t}var Mh=As("animationend"),Lh=As("animationiteration"),Oh=As("animationstart"),Dh=As("transitionend"),Uh=new Map,fc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function nr(t,e){Uh.set(t,e),Er(e,[t])}for(var sa=0;sa<fc.length;sa++){var aa=fc[sa],N0=aa.toLowerCase(),I0=aa[0].toUpperCase()+aa.slice(1);nr(N0,"on"+I0)}nr(Mh,"onAnimationEnd");nr(Lh,"onAnimationIteration");nr(Oh,"onAnimationStart");nr("dblclick","onDoubleClick");nr("focusin","onFocus");nr("focusout","onBlur");nr(Dh,"onTransitionEnd");Zr("onMouseEnter",["mouseout","mouseover"]);Zr("onMouseLeave",["mouseout","mouseover"]);Zr("onPointerEnter",["pointerout","pointerover"]);Zr("onPointerLeave",["pointerout","pointerover"]);Er("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Er("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Er("onBeforeInput",["compositionend","keypress","textInput","paste"]);Er("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Er("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Er("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var No="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),b0=new Set("cancel close invalid load scroll toggle".split(" ").concat(No));function hc(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Ng(r,e,void 0,t),t.currentTarget=null}function Fh(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],o=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],u=a.instance,d=a.currentTarget;if(a=a.listener,u!==i&&o.isPropagationStopped())break e;hc(o,a,d),i=u}else for(s=0;s<r.length;s++){if(a=r[s],u=a.instance,d=a.currentTarget,a=a.listener,u!==i&&o.isPropagationStopped())break e;hc(o,a,d),i=u}}}if(Ji)throw t=Ha,Ji=!1,Ha=null,t}function Ze(t,e){var n=e[Ja];n===void 0&&(n=e[Ja]=new Set);var r=t+"__bubble";n.has(r)||(Gh(e,t,2,!1),n.add(r))}function la(t,e,n){var r=0;e&&(r|=4),Gh(n,t,r,e)}var mi="_reactListening"+Math.random().toString(36).slice(2);function zo(t){if(!t[mi]){t[mi]=!0,Wf.forEach(function(n){n!=="selectionchange"&&(b0.has(n)||la(n,!1,t),la(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[mi]||(e[mi]=!0,la("selectionchange",!1,e))}}function Gh(t,e,n,r){switch(Sh(e)){case 1:var o=Bg;break;case 4:o=Vg;break;default:o=Wl}n=o.bind(null,e,n,t),o=void 0,!Ga||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),r?o!==void 0?t.addEventListener(e,n,{capture:!0,passive:o}):t.addEventListener(e,n,!0):o!==void 0?t.addEventListener(e,n,{passive:o}):t.addEventListener(e,n,!1)}function ua(t,e,n,r,o){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===o||a.nodeType===8&&a.parentNode===o)break;if(s===4)for(s=r.return;s!==null;){var u=s.tag;if((u===3||u===4)&&(u=s.stateNode.containerInfo,u===o||u.nodeType===8&&u.parentNode===o))return;s=s.return}for(;a!==null;){if(s=ur(a),s===null)return;if(u=s.tag,u===5||u===6){r=i=s;continue e}a=a.parentNode}}r=r.return}lh(function(){var d=i,h=Vl(n),m=[];e:{var p=Uh.get(t);if(p!==void 0){var g=Yl,E=t;switch(t){case"keypress":if(Oi(n)===0)break e;case"keydown":case"keyup":g=r0;break;case"focusin":E="focus",g=na;break;case"focusout":E="blur",g=na;break;case"beforeblur":case"afterblur":g=na;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=tc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=$g;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=s0;break;case Mh:case Lh:case Oh:g=Yg;break;case Dh:g=l0;break;case"scroll":g=jg;break;case"wheel":g=c0;break;case"copy":case"cut":case"paste":g=Jg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=rc}var x=(e&4)!==0,w=!x&&t==="scroll",y=x?p!==null?p+"Capture":null:p;x=[];for(var v=d,S;v!==null;){S=v;var N=S.stateNode;if(S.tag===5&&N!==null&&(S=N,y!==null&&(N=Fo(v,y),N!=null&&x.push($o(v,N,S)))),w)break;v=v.return}0<x.length&&(p=new g(p,E,null,n,h),m.push({event:p,listeners:x}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",g=t==="mouseout"||t==="pointerout",p&&n!==Ua&&(E=n.relatedTarget||n.fromElement)&&(ur(E)||E[Rn]))break e;if((g||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,g?(E=n.relatedTarget||n.toElement,g=d,E=E?ur(E):null,E!==null&&(w=Tr(E),E!==w||E.tag!==5&&E.tag!==6)&&(E=null)):(g=null,E=d),g!==E)){if(x=tc,N="onMouseLeave",y="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(x=rc,N="onPointerLeave",y="onPointerEnter",v="pointer"),w=g==null?p:Mr(g),S=E==null?p:Mr(E),p=new x(N,v+"leave",g,n,h),p.target=w,p.relatedTarget=S,N=null,ur(h)===d&&(x=new x(y,v+"enter",E,n,h),x.target=S,x.relatedTarget=w,N=x),w=N,g&&E)t:{for(x=g,y=E,v=0,S=x;S;S=Nr(S))v++;for(S=0,N=y;N;N=Nr(N))S++;for(;0<v-S;)x=Nr(x),v--;for(;0<S-v;)y=Nr(y),S--;for(;v--;){if(x===y||y!==null&&x===y.alternate)break t;x=Nr(x),y=Nr(y)}x=null}else x=null;g!==null&&pc(m,p,g,x,!1),E!==null&&w!==null&&pc(m,w,E,x,!0)}}e:{if(p=d?Mr(d):window,g=p.nodeName&&p.nodeName.toLowerCase(),g==="select"||g==="input"&&p.type==="file")var I=y0;else if(sc(p))if(_h)I=T0;else{I=x0;var L=v0}else(g=p.nodeName)&&g.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(I=E0);if(I&&(I=I(t,d))){bh(m,I,n,h);break e}L&&L(t,p,d),t==="focusout"&&(L=p._wrapperState)&&L.controlled&&p.type==="number"&&Pa(p,"number",p.value)}switch(L=d?Mr(d):window,t){case"focusin":(sc(L)||L.contentEditable==="true")&&(kr=L,za=d,ko=null);break;case"focusout":ko=za=kr=null;break;case"mousedown":$a=!0;break;case"contextmenu":case"mouseup":case"dragend":$a=!1,dc(m,n,h);break;case"selectionchange":if(C0)break;case"keydown":case"keyup":dc(m,n,h)}var P;if(Jl)e:{switch(t){case"compositionstart":var D="onCompositionStart";break e;case"compositionend":D="onCompositionEnd";break e;case"compositionupdate":D="onCompositionUpdate";break e}D=void 0}else Rr?Nh(t,n)&&(D="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(D="onCompositionStart");D&&(Ch&&n.locale!=="ko"&&(Rr||D!=="onCompositionStart"?D==="onCompositionEnd"&&Rr&&(P=wh()):(Vn=h,ql="value"in Vn?Vn.value:Vn.textContent,Rr=!0)),L=ts(d,D),0<L.length&&(D=new nc(D,t,null,n,h),m.push({event:D,listeners:L}),P?D.data=P:(P=Ih(n),P!==null&&(D.data=P)))),(P=f0?h0(t,n):p0(t,n))&&(d=ts(d,"onBeforeInput"),0<d.length&&(h=new nc("onBeforeInput","beforeinput",null,n,h),m.push({event:h,listeners:d}),h.data=P))}Fh(m,e)})}function $o(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ts(t,e){for(var n=e+"Capture",r=[];t!==null;){var o=t,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=Fo(t,n),i!=null&&r.unshift($o(t,i,o)),i=Fo(t,e),i!=null&&r.push($o(t,i,o))),t=t.return}return r}function Nr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function pc(t,e,n,r,o){for(var i=e._reactName,s=[];n!==null&&n!==r;){var a=n,u=a.alternate,d=a.stateNode;if(u!==null&&u===r)break;a.tag===5&&d!==null&&(a=d,o?(u=Fo(n,i),u!=null&&s.unshift($o(n,u,a))):o||(u=Fo(n,i),u!=null&&s.push($o(n,u,a)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var _0=/\r\n?/g,A0=/\u0000|\uFFFD/g;function mc(t){return(typeof t=="string"?t:""+t).replace(_0,`
`).replace(A0,"")}function gi(t,e,n){if(e=mc(e),mc(t)!==e&&n)throw Error(me(425))}function ns(){}var Wa=null,qa=null;function Ya(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ka=typeof setTimeout=="function"?setTimeout:void 0,R0=typeof clearTimeout=="function"?clearTimeout:void 0,gc=typeof Promise=="function"?Promise:void 0,k0=typeof queueMicrotask=="function"?queueMicrotask:typeof gc<"u"?function(t){return gc.resolve(null).then(t).catch(P0)}:Ka;function P0(t){setTimeout(function(){throw t})}function ca(t,e){var n=e,r=0;do{var o=n.nextSibling;if(t.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(r===0){t.removeChild(o),Bo(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=o}while(n);Bo(e)}function Yn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function yc(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ao=Math.random().toString(36).slice(2),En="__reactFiber$"+ao,Wo="__reactProps$"+ao,Rn="__reactContainer$"+ao,Ja="__reactEvents$"+ao,M0="__reactListeners$"+ao,L0="__reactHandles$"+ao;function ur(t){var e=t[En];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Rn]||n[En]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=yc(t);t!==null;){if(n=t[En])return n;t=yc(t)}return e}t=n,n=t.parentNode}return null}function ri(t){return t=t[En]||t[Rn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Mr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(me(33))}function Rs(t){return t[Wo]||null}var Xa=[],Lr=-1;function rr(t){return{current:t}}function Qe(t){0>Lr||(t.current=Xa[Lr],Xa[Lr]=null,Lr--)}function Je(t,e){Lr++,Xa[Lr]=t.current,t.current=e}var er={},At=rr(er),Gt=rr(!1),mr=er;function Qr(t,e){var n=t.type.contextTypes;if(!n)return er;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function Ht(t){return t=t.childContextTypes,t!=null}function rs(){Qe(Gt),Qe(At)}function vc(t,e,n){if(At.current!==er)throw Error(me(168));Je(At,e),Je(Gt,n)}function Hh(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var o in r)if(!(o in e))throw Error(me(108,vg(t)||"Unknown",o));return ot({},n,r)}function os(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||er,mr=At.current,Je(At,t),Je(Gt,Gt.current),!0}function xc(t,e,n){var r=t.stateNode;if(!r)throw Error(me(169));n?(t=Hh(t,e,mr),r.__reactInternalMemoizedMergedChildContext=t,Qe(Gt),Qe(At),Je(At,t)):Qe(Gt),Je(Gt,n)}var Cn=null,ks=!1,da=!1;function Bh(t){Cn===null?Cn=[t]:Cn.push(t)}function O0(t){ks=!0,Bh(t)}function or(){if(!da&&Cn!==null){da=!0;var t=0,e=Ye;try{var n=Cn;for(Ye=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Cn=null,ks=!1}catch(o){throw Cn!==null&&(Cn=Cn.slice(t+1)),fh(jl,or),o}finally{Ye=e,da=!1}}return null}var Or=[],Dr=0,is=null,ss=0,Zt=[],Qt=0,gr=null,In=1,bn="";function sr(t,e){Or[Dr++]=ss,Or[Dr++]=is,is=t,ss=e}function Vh(t,e,n){Zt[Qt++]=In,Zt[Qt++]=bn,Zt[Qt++]=gr,gr=t;var r=In;t=bn;var o=32-dn(r)-1;r&=~(1<<o),n+=1;var i=32-dn(e)+o;if(30<i){var s=o-o%5;i=(r&(1<<s)-1).toString(32),r>>=s,o-=s,In=1<<32-dn(e)+o|n<<o|r,bn=i+t}else In=1<<i|n<<o|r,bn=t}function Zl(t){t.return!==null&&(sr(t,1),Vh(t,1,0))}function Ql(t){for(;t===is;)is=Or[--Dr],Or[Dr]=null,ss=Or[--Dr],Or[Dr]=null;for(;t===gr;)gr=Zt[--Qt],Zt[Qt]=null,bn=Zt[--Qt],Zt[Qt]=null,In=Zt[--Qt],Zt[Qt]=null}var $t=null,zt=null,et=!1,cn=null;function jh(t,e){var n=en(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Ec(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,$t=t,zt=Yn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,$t=t,zt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=gr!==null?{id:In,overflow:bn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=en(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,$t=t,zt=null,!0):!1;default:return!1}}function Za(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Qa(t){if(et){var e=zt;if(e){var n=e;if(!Ec(t,e)){if(Za(t))throw Error(me(418));e=Yn(n.nextSibling);var r=$t;e&&Ec(t,e)?jh(r,n):(t.flags=t.flags&-4097|2,et=!1,$t=t)}}else{if(Za(t))throw Error(me(418));t.flags=t.flags&-4097|2,et=!1,$t=t}}}function Tc(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;$t=t}function yi(t){if(t!==$t)return!1;if(!et)return Tc(t),et=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Ya(t.type,t.memoizedProps)),e&&(e=zt)){if(Za(t))throw zh(),Error(me(418));for(;e;)jh(t,e),e=Yn(e.nextSibling)}if(Tc(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(me(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){zt=Yn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}zt=null}}else zt=$t?Yn(t.stateNode.nextSibling):null;return!0}function zh(){for(var t=zt;t;)t=Yn(t.nextSibling)}function eo(){zt=$t=null,et=!1}function eu(t){cn===null?cn=[t]:cn.push(t)}var D0=Ln.ReactCurrentBatchConfig;function yo(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(me(309));var r=n.stateNode}if(!r)throw Error(me(147,t));var o=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(s){var a=o.refs;s===null?delete a[i]:a[i]=s},e._stringRef=i,e)}if(typeof t!="string")throw Error(me(284));if(!n._owner)throw Error(me(290,t))}return t}function vi(t,e){throw t=Object.prototype.toString.call(e),Error(me(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Sc(t){var e=t._init;return e(t._payload)}function $h(t){function e(y,v){if(t){var S=y.deletions;S===null?(y.deletions=[v],y.flags|=16):S.push(v)}}function n(y,v){if(!t)return null;for(;v!==null;)e(y,v),v=v.sibling;return null}function r(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function o(y,v){return y=Zn(y,v),y.index=0,y.sibling=null,y}function i(y,v,S){return y.index=S,t?(S=y.alternate,S!==null?(S=S.index,S<v?(y.flags|=2,v):S):(y.flags|=2,v)):(y.flags|=1048576,v)}function s(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,v,S,N){return v===null||v.tag!==6?(v=va(S,y.mode,N),v.return=y,v):(v=o(v,S),v.return=y,v)}function u(y,v,S,N){var I=S.type;return I===Ar?h(y,v,S.props.children,N,S.key):v!==null&&(v.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Fn&&Sc(I)===v.type)?(N=o(v,S.props),N.ref=yo(y,v,S),N.return=y,N):(N=Vi(S.type,S.key,S.props,null,y.mode,N),N.ref=yo(y,v,S),N.return=y,N)}function d(y,v,S,N){return v===null||v.tag!==4||v.stateNode.containerInfo!==S.containerInfo||v.stateNode.implementation!==S.implementation?(v=xa(S,y.mode,N),v.return=y,v):(v=o(v,S.children||[]),v.return=y,v)}function h(y,v,S,N,I){return v===null||v.tag!==7?(v=hr(S,y.mode,N,I),v.return=y,v):(v=o(v,S),v.return=y,v)}function m(y,v,S){if(typeof v=="string"&&v!==""||typeof v=="number")return v=va(""+v,y.mode,S),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case ai:return S=Vi(v.type,v.key,v.props,null,y.mode,S),S.ref=yo(y,null,v),S.return=y,S;case _r:return v=xa(v,y.mode,S),v.return=y,v;case Fn:var N=v._init;return m(y,N(v._payload),S)}if(wo(v)||fo(v))return v=hr(v,y.mode,S,null),v.return=y,v;vi(y,v)}return null}function p(y,v,S,N){var I=v!==null?v.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return I!==null?null:a(y,v,""+S,N);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case ai:return S.key===I?u(y,v,S,N):null;case _r:return S.key===I?d(y,v,S,N):null;case Fn:return I=S._init,p(y,v,I(S._payload),N)}if(wo(S)||fo(S))return I!==null?null:h(y,v,S,N,null);vi(y,S)}return null}function g(y,v,S,N,I){if(typeof N=="string"&&N!==""||typeof N=="number")return y=y.get(S)||null,a(v,y,""+N,I);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case ai:return y=y.get(N.key===null?S:N.key)||null,u(v,y,N,I);case _r:return y=y.get(N.key===null?S:N.key)||null,d(v,y,N,I);case Fn:var L=N._init;return g(y,v,S,L(N._payload),I)}if(wo(N)||fo(N))return y=y.get(S)||null,h(v,y,N,I,null);vi(v,N)}return null}function E(y,v,S,N){for(var I=null,L=null,P=v,D=v=0,M=null;P!==null&&D<S.length;D++){P.index>D?(M=P,P=null):M=P.sibling;var j=p(y,P,S[D],N);if(j===null){P===null&&(P=M);break}t&&P&&j.alternate===null&&e(y,P),v=i(j,v,D),L===null?I=j:L.sibling=j,L=j,P=M}if(D===S.length)return n(y,P),et&&sr(y,D),I;if(P===null){for(;D<S.length;D++)P=m(y,S[D],N),P!==null&&(v=i(P,v,D),L===null?I=P:L.sibling=P,L=P);return et&&sr(y,D),I}for(P=r(y,P);D<S.length;D++)M=g(P,y,D,S[D],N),M!==null&&(t&&M.alternate!==null&&P.delete(M.key===null?D:M.key),v=i(M,v,D),L===null?I=M:L.sibling=M,L=M);return t&&P.forEach(function(Q){return e(y,Q)}),et&&sr(y,D),I}function x(y,v,S,N){var I=fo(S);if(typeof I!="function")throw Error(me(150));if(S=I.call(S),S==null)throw Error(me(151));for(var L=I=null,P=v,D=v=0,M=null,j=S.next();P!==null&&!j.done;D++,j=S.next()){P.index>D?(M=P,P=null):M=P.sibling;var Q=p(y,P,j.value,N);if(Q===null){P===null&&(P=M);break}t&&P&&Q.alternate===null&&e(y,P),v=i(Q,v,D),L===null?I=Q:L.sibling=Q,L=Q,P=M}if(j.done)return n(y,P),et&&sr(y,D),I;if(P===null){for(;!j.done;D++,j=S.next())j=m(y,j.value,N),j!==null&&(v=i(j,v,D),L===null?I=j:L.sibling=j,L=j);return et&&sr(y,D),I}for(P=r(y,P);!j.done;D++,j=S.next())j=g(P,y,D,j.value,N),j!==null&&(t&&j.alternate!==null&&P.delete(j.key===null?D:j.key),v=i(j,v,D),L===null?I=j:L.sibling=j,L=j);return t&&P.forEach(function(_){return e(y,_)}),et&&sr(y,D),I}function w(y,v,S,N){if(typeof S=="object"&&S!==null&&S.type===Ar&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case ai:e:{for(var I=S.key,L=v;L!==null;){if(L.key===I){if(I=S.type,I===Ar){if(L.tag===7){n(y,L.sibling),v=o(L,S.props.children),v.return=y,y=v;break e}}else if(L.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Fn&&Sc(I)===L.type){n(y,L.sibling),v=o(L,S.props),v.ref=yo(y,L,S),v.return=y,y=v;break e}n(y,L);break}else e(y,L);L=L.sibling}S.type===Ar?(v=hr(S.props.children,y.mode,N,S.key),v.return=y,y=v):(N=Vi(S.type,S.key,S.props,null,y.mode,N),N.ref=yo(y,v,S),N.return=y,y=N)}return s(y);case _r:e:{for(L=S.key;v!==null;){if(v.key===L)if(v.tag===4&&v.stateNode.containerInfo===S.containerInfo&&v.stateNode.implementation===S.implementation){n(y,v.sibling),v=o(v,S.children||[]),v.return=y,y=v;break e}else{n(y,v);break}else e(y,v);v=v.sibling}v=xa(S,y.mode,N),v.return=y,y=v}return s(y);case Fn:return L=S._init,w(y,v,L(S._payload),N)}if(wo(S))return E(y,v,S,N);if(fo(S))return x(y,v,S,N);vi(y,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,v!==null&&v.tag===6?(n(y,v.sibling),v=o(v,S),v.return=y,y=v):(n(y,v),v=va(S,y.mode,N),v.return=y,y=v),s(y)):n(y,v)}return w}var to=$h(!0),Wh=$h(!1),as=rr(null),ls=null,Ur=null,tu=null;function nu(){tu=Ur=ls=null}function ru(t){var e=as.current;Qe(as),t._currentValue=e}function el(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Yr(t,e){ls=t,tu=Ur=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ft=!0),t.firstContext=null)}function rn(t){var e=t._currentValue;if(tu!==t)if(t={context:t,memoizedValue:e,next:null},Ur===null){if(ls===null)throw Error(me(308));Ur=t,ls.dependencies={lanes:0,firstContext:t}}else Ur=Ur.next=t;return e}var cr=null;function ou(t){cr===null?cr=[t]:cr.push(t)}function qh(t,e,n,r){var o=e.interleaved;return o===null?(n.next=n,ou(e)):(n.next=o.next,o.next=n),e.interleaved=n,kn(t,r)}function kn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Gn=!1;function iu(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yh(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function _n(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Kn(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,$e&2){var o=r.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),r.pending=e,kn(t,n)}return o=r.interleaved,o===null?(e.next=e,ou(r)):(e.next=o.next,o.next=e),r.interleaved=e,kn(t,n)}function Di(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zl(t,n)}}function wc(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=s:i=i.next=s,n=n.next}while(n!==null);i===null?o=i=e:i=i.next=e}else o=i=e;n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function us(t,e,n,r){var o=t.updateQueue;Gn=!1;var i=o.firstBaseUpdate,s=o.lastBaseUpdate,a=o.shared.pending;if(a!==null){o.shared.pending=null;var u=a,d=u.next;u.next=null,s===null?i=d:s.next=d,s=u;var h=t.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==s&&(a===null?h.firstBaseUpdate=d:a.next=d,h.lastBaseUpdate=u))}if(i!==null){var m=o.baseState;s=0,h=d=u=null,a=i;do{var p=a.lane,g=a.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:g,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var E=t,x=a;switch(p=e,g=n,x.tag){case 1:if(E=x.payload,typeof E=="function"){m=E.call(g,m,p);break e}m=E;break e;case 3:E.flags=E.flags&-65537|128;case 0:if(E=x.payload,p=typeof E=="function"?E.call(g,m,p):E,p==null)break e;m=ot({},m,p);break e;case 2:Gn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,p=o.effects,p===null?o.effects=[a]:p.push(a))}else g={eventTime:g,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(d=h=g,u=m):h=h.next=g,s|=p;if(a=a.next,a===null){if(a=o.shared.pending,a===null)break;p=a,a=p.next,p.next=null,o.lastBaseUpdate=p,o.shared.pending=null}}while(!0);if(h===null&&(u=m),o.baseState=u,o.firstBaseUpdate=d,o.lastBaseUpdate=h,e=o.shared.interleaved,e!==null){o=e;do s|=o.lane,o=o.next;while(o!==e)}else i===null&&(o.shared.lanes=0);vr|=s,t.lanes=s,t.memoizedState=m}}function Cc(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],o=r.callback;if(o!==null){if(r.callback=null,r=n,typeof o!="function")throw Error(me(191,o));o.call(r)}}}var oi={},Sn=rr(oi),qo=rr(oi),Yo=rr(oi);function dr(t){if(t===oi)throw Error(me(174));return t}function su(t,e){switch(Je(Yo,e),Je(qo,t),Je(Sn,oi),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:La(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=La(e,t)}Qe(Sn),Je(Sn,e)}function no(){Qe(Sn),Qe(qo),Qe(Yo)}function Kh(t){dr(Yo.current);var e=dr(Sn.current),n=La(e,t.type);e!==n&&(Je(qo,t),Je(Sn,n))}function au(t){qo.current===t&&(Qe(Sn),Qe(qo))}var nt=rr(0);function cs(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var fa=[];function lu(){for(var t=0;t<fa.length;t++)fa[t]._workInProgressVersionPrimary=null;fa.length=0}var Ui=Ln.ReactCurrentDispatcher,ha=Ln.ReactCurrentBatchConfig,yr=0,rt=null,dt=null,ht=null,ds=!1,Po=!1,Ko=0,U0=0;function Nt(){throw Error(me(321))}function uu(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!mn(t[n],e[n]))return!1;return!0}function cu(t,e,n,r,o,i){if(yr=i,rt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ui.current=t===null||t.memoizedState===null?B0:V0,t=n(r,o),Po){i=0;do{if(Po=!1,Ko=0,25<=i)throw Error(me(301));i+=1,ht=dt=null,e.updateQueue=null,Ui.current=j0,t=n(r,o)}while(Po)}if(Ui.current=fs,e=dt!==null&&dt.next!==null,yr=0,ht=dt=rt=null,ds=!1,e)throw Error(me(300));return t}function du(){var t=Ko!==0;return Ko=0,t}function xn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ht===null?rt.memoizedState=ht=t:ht=ht.next=t,ht}function on(){if(dt===null){var t=rt.alternate;t=t!==null?t.memoizedState:null}else t=dt.next;var e=ht===null?rt.memoizedState:ht.next;if(e!==null)ht=e,dt=t;else{if(t===null)throw Error(me(310));dt=t,t={memoizedState:dt.memoizedState,baseState:dt.baseState,baseQueue:dt.baseQueue,queue:dt.queue,next:null},ht===null?rt.memoizedState=ht=t:ht=ht.next=t}return ht}function Jo(t,e){return typeof e=="function"?e(t):e}function pa(t){var e=on(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var r=dt,o=r.baseQueue,i=n.pending;if(i!==null){if(o!==null){var s=o.next;o.next=i.next,i.next=s}r.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,r=r.baseState;var a=s=null,u=null,d=i;do{var h=d.lane;if((yr&h)===h)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var m={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(a=u=m,s=r):u=u.next=m,rt.lanes|=h,vr|=h}d=d.next}while(d!==null&&d!==i);u===null?s=r:u.next=a,mn(r,e.memoizedState)||(Ft=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){o=t;do i=o.lane,rt.lanes|=i,vr|=i,o=o.next;while(o!==t)}else o===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function ma(t){var e=on(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var r=n.dispatch,o=n.pending,i=e.memoizedState;if(o!==null){n.pending=null;var s=o=o.next;do i=t(i,s.action),s=s.next;while(s!==o);mn(i,e.memoizedState)||(Ft=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function Jh(){}function Xh(t,e){var n=rt,r=on(),o=e(),i=!mn(r.memoizedState,o);if(i&&(r.memoizedState=o,Ft=!0),r=r.queue,fu(ep.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||ht!==null&&ht.memoizedState.tag&1){if(n.flags|=2048,Xo(9,Qh.bind(null,n,r,o,e),void 0,null),pt===null)throw Error(me(349));yr&30||Zh(n,e,o)}return o}function Zh(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=rt.updateQueue,e===null?(e={lastEffect:null,stores:null},rt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Qh(t,e,n,r){e.value=n,e.getSnapshot=r,tp(e)&&np(t)}function ep(t,e,n){return n(function(){tp(e)&&np(t)})}function tp(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!mn(t,n)}catch{return!0}}function np(t){var e=kn(t,1);e!==null&&fn(e,t,1,-1)}function Nc(t){var e=xn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Jo,lastRenderedState:t},e.queue=t,t=t.dispatch=H0.bind(null,rt,t),[e.memoizedState,t]}function Xo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=rt.updateQueue,e===null?(e={lastEffect:null,stores:null},rt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function rp(){return on().memoizedState}function Fi(t,e,n,r){var o=xn();rt.flags|=t,o.memoizedState=Xo(1|e,n,void 0,r===void 0?null:r)}function Ps(t,e,n,r){var o=on();r=r===void 0?null:r;var i=void 0;if(dt!==null){var s=dt.memoizedState;if(i=s.destroy,r!==null&&uu(r,s.deps)){o.memoizedState=Xo(e,n,i,r);return}}rt.flags|=t,o.memoizedState=Xo(1|e,n,i,r)}function Ic(t,e){return Fi(8390656,8,t,e)}function fu(t,e){return Ps(2048,8,t,e)}function op(t,e){return Ps(4,2,t,e)}function ip(t,e){return Ps(4,4,t,e)}function sp(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function ap(t,e,n){return n=n!=null?n.concat([t]):null,Ps(4,4,sp.bind(null,e,t),n)}function hu(){}function lp(t,e){var n=on();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&uu(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function up(t,e){var n=on();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&uu(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function cp(t,e,n){return yr&21?(mn(n,e)||(n=mh(),rt.lanes|=n,vr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ft=!0),t.memoizedState=n)}function F0(t,e){var n=Ye;Ye=n!==0&&4>n?n:4,t(!0);var r=ha.transition;ha.transition={};try{t(!1),e()}finally{Ye=n,ha.transition=r}}function dp(){return on().memoizedState}function G0(t,e,n){var r=Xn(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},fp(t))hp(e,n);else if(n=qh(t,e,n,r),n!==null){var o=Mt();fn(n,t,r,o),pp(n,e,r)}}function H0(t,e,n){var r=Xn(t),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(fp(t))hp(e,o);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var s=e.lastRenderedState,a=i(s,n);if(o.hasEagerState=!0,o.eagerState=a,mn(a,s)){var u=e.interleaved;u===null?(o.next=o,ou(e)):(o.next=u.next,u.next=o),e.interleaved=o;return}}catch{}finally{}n=qh(t,e,o,r),n!==null&&(o=Mt(),fn(n,t,r,o),pp(n,e,r))}}function fp(t){var e=t.alternate;return t===rt||e!==null&&e===rt}function hp(t,e){Po=ds=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function pp(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zl(t,n)}}var fs={readContext:rn,useCallback:Nt,useContext:Nt,useEffect:Nt,useImperativeHandle:Nt,useInsertionEffect:Nt,useLayoutEffect:Nt,useMemo:Nt,useReducer:Nt,useRef:Nt,useState:Nt,useDebugValue:Nt,useDeferredValue:Nt,useTransition:Nt,useMutableSource:Nt,useSyncExternalStore:Nt,useId:Nt,unstable_isNewReconciler:!1},B0={readContext:rn,useCallback:function(t,e){return xn().memoizedState=[t,e===void 0?null:e],t},useContext:rn,useEffect:Ic,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Fi(4194308,4,sp.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Fi(4194308,4,t,e)},useInsertionEffect:function(t,e){return Fi(4,2,t,e)},useMemo:function(t,e){var n=xn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=xn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=G0.bind(null,rt,t),[r.memoizedState,t]},useRef:function(t){var e=xn();return t={current:t},e.memoizedState=t},useState:Nc,useDebugValue:hu,useDeferredValue:function(t){return xn().memoizedState=t},useTransition:function(){var t=Nc(!1),e=t[0];return t=F0.bind(null,t[1]),xn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=rt,o=xn();if(et){if(n===void 0)throw Error(me(407));n=n()}else{if(n=e(),pt===null)throw Error(me(349));yr&30||Zh(r,e,n)}o.memoizedState=n;var i={value:n,getSnapshot:e};return o.queue=i,Ic(ep.bind(null,r,i,t),[t]),r.flags|=2048,Xo(9,Qh.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=xn(),e=pt.identifierPrefix;if(et){var n=bn,r=In;n=(r&~(1<<32-dn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ko++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=U0++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},V0={readContext:rn,useCallback:lp,useContext:rn,useEffect:fu,useImperativeHandle:ap,useInsertionEffect:op,useLayoutEffect:ip,useMemo:up,useReducer:pa,useRef:rp,useState:function(){return pa(Jo)},useDebugValue:hu,useDeferredValue:function(t){var e=on();return cp(e,dt.memoizedState,t)},useTransition:function(){var t=pa(Jo)[0],e=on().memoizedState;return[t,e]},useMutableSource:Jh,useSyncExternalStore:Xh,useId:dp,unstable_isNewReconciler:!1},j0={readContext:rn,useCallback:lp,useContext:rn,useEffect:fu,useImperativeHandle:ap,useInsertionEffect:op,useLayoutEffect:ip,useMemo:up,useReducer:ma,useRef:rp,useState:function(){return ma(Jo)},useDebugValue:hu,useDeferredValue:function(t){var e=on();return dt===null?e.memoizedState=t:cp(e,dt.memoizedState,t)},useTransition:function(){var t=ma(Jo)[0],e=on().memoizedState;return[t,e]},useMutableSource:Jh,useSyncExternalStore:Xh,useId:dp,unstable_isNewReconciler:!1};function ln(t,e){if(t&&t.defaultProps){e=ot({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function tl(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ot({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Ms={isMounted:function(t){return(t=t._reactInternals)?Tr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Mt(),o=Xn(t),i=_n(r,o);i.payload=e,n!=null&&(i.callback=n),e=Kn(t,i,o),e!==null&&(fn(e,t,o,r),Di(e,t,o))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Mt(),o=Xn(t),i=_n(r,o);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Kn(t,i,o),e!==null&&(fn(e,t,o,r),Di(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Mt(),r=Xn(t),o=_n(n,r);o.tag=2,e!=null&&(o.callback=e),e=Kn(t,o,r),e!==null&&(fn(e,t,r,n),Di(e,t,r))}};function bc(t,e,n,r,o,i,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,s):e.prototype&&e.prototype.isPureReactComponent?!jo(n,r)||!jo(o,i):!0}function mp(t,e,n){var r=!1,o=er,i=e.contextType;return typeof i=="object"&&i!==null?i=rn(i):(o=Ht(e)?mr:At.current,r=e.contextTypes,i=(r=r!=null)?Qr(t,o):er),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ms,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=i),e}function _c(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Ms.enqueueReplaceState(e,e.state,null)}function nl(t,e,n,r){var o=t.stateNode;o.props=n,o.state=t.memoizedState,o.refs={},iu(t);var i=e.contextType;typeof i=="object"&&i!==null?o.context=rn(i):(i=Ht(e)?mr:At.current,o.context=Qr(t,i)),o.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(tl(t,e,i,n),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&Ms.enqueueReplaceState(o,o.state,null),us(t,n,o,r),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function ro(t,e){try{var n="",r=e;do n+=yg(r),r=r.return;while(r);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:o,digest:null}}function ga(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function rl(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var z0=typeof WeakMap=="function"?WeakMap:Map;function gp(t,e,n){n=_n(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){ps||(ps=!0,hl=r),rl(t,e)},n}function yp(t,e,n){n=_n(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var o=e.value;n.payload=function(){return r(o)},n.callback=function(){rl(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){rl(t,e),typeof r!="function"&&(Jn===null?Jn=new Set([this]):Jn.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}function Ac(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new z0;var o=new Set;r.set(e,o)}else o=r.get(e),o===void 0&&(o=new Set,r.set(e,o));o.has(n)||(o.add(n),t=oy.bind(null,t,e,n),e.then(t,t))}function Rc(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function kc(t,e,n,r,o){return t.mode&1?(t.flags|=65536,t.lanes=o,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=_n(-1,1),e.tag=2,Kn(n,e,1))),n.lanes|=1),t)}var $0=Ln.ReactCurrentOwner,Ft=!1;function Pt(t,e,n,r){e.child=t===null?Wh(e,null,n,r):to(e,t.child,n,r)}function Pc(t,e,n,r,o){n=n.render;var i=e.ref;return Yr(e,o),r=cu(t,e,n,r,i,o),n=du(),t!==null&&!Ft?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Pn(t,e,o)):(et&&n&&Zl(e),e.flags|=1,Pt(t,e,r,o),e.child)}function Mc(t,e,n,r,o){if(t===null){var i=n.type;return typeof i=="function"&&!Tu(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,vp(t,e,i,r,o)):(t=Vi(n.type,null,r,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&o)){var s=i.memoizedProps;if(n=n.compare,n=n!==null?n:jo,n(s,r)&&t.ref===e.ref)return Pn(t,e,o)}return e.flags|=1,t=Zn(i,r),t.ref=e.ref,t.return=e,e.child=t}function vp(t,e,n,r,o){if(t!==null){var i=t.memoizedProps;if(jo(i,r)&&t.ref===e.ref)if(Ft=!1,e.pendingProps=r=i,(t.lanes&o)!==0)t.flags&131072&&(Ft=!0);else return e.lanes=t.lanes,Pn(t,e,o)}return ol(t,e,n,r,o)}function xp(t,e,n){var r=e.pendingProps,o=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Je(Gr,jt),jt|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Je(Gr,jt),jt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Je(Gr,jt),jt|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Je(Gr,jt),jt|=r;return Pt(t,e,o,n),e.child}function Ep(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function ol(t,e,n,r,o){var i=Ht(n)?mr:At.current;return i=Qr(e,i),Yr(e,o),n=cu(t,e,n,r,i,o),r=du(),t!==null&&!Ft?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Pn(t,e,o)):(et&&r&&Zl(e),e.flags|=1,Pt(t,e,n,o),e.child)}function Lc(t,e,n,r,o){if(Ht(n)){var i=!0;os(e)}else i=!1;if(Yr(e,o),e.stateNode===null)Gi(t,e),mp(e,n,r),nl(e,n,r,o),r=!0;else if(t===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var u=s.context,d=n.contextType;typeof d=="object"&&d!==null?d=rn(d):(d=Ht(n)?mr:At.current,d=Qr(e,d));var h=n.getDerivedStateFromProps,m=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function";m||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||u!==d)&&_c(e,s,r,d),Gn=!1;var p=e.memoizedState;s.state=p,us(e,r,s,o),u=e.memoizedState,a!==r||p!==u||Gt.current||Gn?(typeof h=="function"&&(tl(e,n,h,r),u=e.memoizedState),(a=Gn||bc(e,n,a,r,p,u,d))?(m||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),s.props=r,s.state=u,s.context=d,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,Yh(t,e),a=e.memoizedProps,d=e.type===e.elementType?a:ln(e.type,a),s.props=d,m=e.pendingProps,p=s.context,u=n.contextType,typeof u=="object"&&u!==null?u=rn(u):(u=Ht(n)?mr:At.current,u=Qr(e,u));var g=n.getDerivedStateFromProps;(h=typeof g=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==m||p!==u)&&_c(e,s,r,u),Gn=!1,p=e.memoizedState,s.state=p,us(e,r,s,o);var E=e.memoizedState;a!==m||p!==E||Gt.current||Gn?(typeof g=="function"&&(tl(e,n,g,r),E=e.memoizedState),(d=Gn||bc(e,n,d,r,p,E,u)||!1)?(h||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,E,u),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,E,u)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=E),s.props=r,s.state=E,s.context=u,r=d):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),r=!1)}return il(t,e,n,r,i,o)}function il(t,e,n,r,o,i){Ep(t,e);var s=(e.flags&128)!==0;if(!r&&!s)return o&&xc(e,n,!1),Pn(t,e,i);r=e.stateNode,$0.current=e;var a=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&s?(e.child=to(e,t.child,null,i),e.child=to(e,null,a,i)):Pt(t,e,a,i),e.memoizedState=r.state,o&&xc(e,n,!0),e.child}function Tp(t){var e=t.stateNode;e.pendingContext?vc(t,e.pendingContext,e.pendingContext!==e.context):e.context&&vc(t,e.context,!1),su(t,e.containerInfo)}function Oc(t,e,n,r,o){return eo(),eu(o),e.flags|=256,Pt(t,e,n,r),e.child}var sl={dehydrated:null,treeContext:null,retryLane:0};function al(t){return{baseLanes:t,cachePool:null,transitions:null}}function Sp(t,e,n){var r=e.pendingProps,o=nt.current,i=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=t!==null&&t.memoizedState===null?!1:(o&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),Je(nt,o&1),t===null)return Qa(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,t=r.fallback,i?(r=e.mode,i=e.child,s={mode:"hidden",children:s},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=s):i=Ds(s,r,0,null),t=hr(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=al(n),e.memoizedState=sl,t):pu(e,s));if(o=t.memoizedState,o!==null&&(a=o.dehydrated,a!==null))return W0(t,e,s,r,a,o,n);if(i){i=r.fallback,s=e.mode,o=t.child,a=o.sibling;var u={mode:"hidden",children:r.children};return!(s&1)&&e.child!==o?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Zn(o,u),r.subtreeFlags=o.subtreeFlags&14680064),a!==null?i=Zn(a,i):(i=hr(i,s,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,s=t.child.memoizedState,s=s===null?al(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},i.memoizedState=s,i.childLanes=t.childLanes&~n,e.memoizedState=sl,r}return i=t.child,t=i.sibling,r=Zn(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function pu(t,e){return e=Ds({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function xi(t,e,n,r){return r!==null&&eu(r),to(e,t.child,null,n),t=pu(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function W0(t,e,n,r,o,i,s){if(n)return e.flags&256?(e.flags&=-257,r=ga(Error(me(422))),xi(t,e,s,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,o=e.mode,r=Ds({mode:"visible",children:r.children},o,0,null),i=hr(i,o,s,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&to(e,t.child,null,s),e.child.memoizedState=al(s),e.memoizedState=sl,i);if(!(e.mode&1))return xi(t,e,s,null);if(o.data==="$!"){if(r=o.nextSibling&&o.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(me(419)),r=ga(i,r,void 0),xi(t,e,s,r)}if(a=(s&t.childLanes)!==0,Ft||a){if(r=pt,r!==null){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(r.suspendedLanes|s)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,kn(t,o),fn(r,t,o,-1))}return Eu(),r=ga(Error(me(421))),xi(t,e,s,r)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=iy.bind(null,t),o._reactRetry=e,null):(t=i.treeContext,zt=Yn(o.nextSibling),$t=e,et=!0,cn=null,t!==null&&(Zt[Qt++]=In,Zt[Qt++]=bn,Zt[Qt++]=gr,In=t.id,bn=t.overflow,gr=e),e=pu(e,r.children),e.flags|=4096,e)}function Dc(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),el(t.return,e,n)}function ya(t,e,n,r,o){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o)}function wp(t,e,n){var r=e.pendingProps,o=r.revealOrder,i=r.tail;if(Pt(t,e,r.children,n),r=nt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Dc(t,n,e);else if(t.tag===19)Dc(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Je(nt,r),!(e.mode&1))e.memoizedState=null;else switch(o){case"forwards":for(n=e.child,o=null;n!==null;)t=n.alternate,t!==null&&cs(t)===null&&(o=n),n=n.sibling;n=o,n===null?(o=e.child,e.child=null):(o=n.sibling,n.sibling=null),ya(e,!1,o,n,i);break;case"backwards":for(n=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&cs(t)===null){e.child=o;break}t=o.sibling,o.sibling=n,n=o,o=t}ya(e,!0,n,null,i);break;case"together":ya(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Gi(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Pn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),vr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(me(153));if(e.child!==null){for(t=e.child,n=Zn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Zn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function q0(t,e,n){switch(e.tag){case 3:Tp(e),eo();break;case 5:Kh(e);break;case 1:Ht(e.type)&&os(e);break;case 4:su(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,o=e.memoizedProps.value;Je(as,r._currentValue),r._currentValue=o;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Je(nt,nt.current&1),e.flags|=128,null):n&e.child.childLanes?Sp(t,e,n):(Je(nt,nt.current&1),t=Pn(t,e,n),t!==null?t.sibling:null);Je(nt,nt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return wp(t,e,n);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Je(nt,nt.current),r)break;return null;case 22:case 23:return e.lanes=0,xp(t,e,n)}return Pn(t,e,n)}var Cp,ll,Np,Ip;Cp=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ll=function(){};Np=function(t,e,n,r){var o=t.memoizedProps;if(o!==r){t=e.stateNode,dr(Sn.current);var i=null;switch(n){case"input":o=Ra(t,o),r=Ra(t,r),i=[];break;case"select":o=ot({},o,{value:void 0}),r=ot({},r,{value:void 0}),i=[];break;case"textarea":o=Ma(t,o),r=Ma(t,r),i=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=ns)}Oa(n,r);var s;n=null;for(d in o)if(!r.hasOwnProperty(d)&&o.hasOwnProperty(d)&&o[d]!=null)if(d==="style"){var a=o[d];for(s in a)a.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Do.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var u=r[d];if(a=o!=null?o[d]:void 0,r.hasOwnProperty(d)&&u!==a&&(u!=null||a!=null))if(d==="style")if(a){for(s in a)!a.hasOwnProperty(s)||u&&u.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in u)u.hasOwnProperty(s)&&a[s]!==u[s]&&(n||(n={}),n[s]=u[s])}else n||(i||(i=[]),i.push(d,n)),n=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,a=a?a.__html:void 0,u!=null&&a!==u&&(i=i||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Do.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&Ze("scroll",t),i||a===u||(i=[])):(i=i||[]).push(d,u))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};Ip=function(t,e,n,r){n!==r&&(e.flags|=4)};function vo(t,e){if(!et)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function It(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var o=t.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags&14680064,r|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Y0(t,e,n){var r=e.pendingProps;switch(Ql(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return It(e),null;case 1:return Ht(e.type)&&rs(),It(e),null;case 3:return r=e.stateNode,no(),Qe(Gt),Qe(At),lu(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(yi(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,cn!==null&&(gl(cn),cn=null))),ll(t,e),It(e),null;case 5:au(e);var o=dr(Yo.current);if(n=e.type,t!==null&&e.stateNode!=null)Np(t,e,n,r,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(me(166));return It(e),null}if(t=dr(Sn.current),yi(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[En]=e,r[Wo]=i,t=(e.mode&1)!==0,n){case"dialog":Ze("cancel",r),Ze("close",r);break;case"iframe":case"object":case"embed":Ze("load",r);break;case"video":case"audio":for(o=0;o<No.length;o++)Ze(No[o],r);break;case"source":Ze("error",r);break;case"img":case"image":case"link":Ze("error",r),Ze("load",r);break;case"details":Ze("toggle",r);break;case"input":$u(r,i),Ze("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Ze("invalid",r);break;case"textarea":qu(r,i),Ze("invalid",r)}Oa(n,i),o=null;for(var s in i)if(i.hasOwnProperty(s)){var a=i[s];s==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&gi(r.textContent,a,t),o=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&gi(r.textContent,a,t),o=["children",""+a]):Do.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&Ze("scroll",r)}switch(n){case"input":li(r),Wu(r,i,!0);break;case"textarea":li(r),Yu(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=ns)}r=o,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=eh(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=s.createElement(n,{is:r.is}):(t=s.createElement(n),n==="select"&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,n),t[En]=e,t[Wo]=r,Cp(t,e,!1,!1),e.stateNode=t;e:{switch(s=Da(n,r),n){case"dialog":Ze("cancel",t),Ze("close",t),o=r;break;case"iframe":case"object":case"embed":Ze("load",t),o=r;break;case"video":case"audio":for(o=0;o<No.length;o++)Ze(No[o],t);o=r;break;case"source":Ze("error",t),o=r;break;case"img":case"image":case"link":Ze("error",t),Ze("load",t),o=r;break;case"details":Ze("toggle",t),o=r;break;case"input":$u(t,r),o=Ra(t,r),Ze("invalid",t);break;case"option":o=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},o=ot({},r,{value:void 0}),Ze("invalid",t);break;case"textarea":qu(t,r),o=Ma(t,r),Ze("invalid",t);break;default:o=r}Oa(n,o),a=o;for(i in a)if(a.hasOwnProperty(i)){var u=a[i];i==="style"?rh(t,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&th(t,u)):i==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&Uo(t,u):typeof u=="number"&&Uo(t,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Do.hasOwnProperty(i)?u!=null&&i==="onScroll"&&Ze("scroll",t):u!=null&&Fl(t,i,u,s))}switch(n){case"input":li(t),Wu(t,r,!1);break;case"textarea":li(t),Yu(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Qn(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?zr(t,!!r.multiple,i,!1):r.defaultValue!=null&&zr(t,!!r.multiple,r.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=ns)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return It(e),null;case 6:if(t&&e.stateNode!=null)Ip(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(me(166));if(n=dr(Yo.current),dr(Sn.current),yi(e)){if(r=e.stateNode,n=e.memoizedProps,r[En]=e,(i=r.nodeValue!==n)&&(t=$t,t!==null))switch(t.tag){case 3:gi(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&gi(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[En]=e,e.stateNode=r}return It(e),null;case 13:if(Qe(nt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(et&&zt!==null&&e.mode&1&&!(e.flags&128))zh(),eo(),e.flags|=98560,i=!1;else if(i=yi(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(me(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(me(317));i[En]=e}else eo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;It(e),i=!1}else cn!==null&&(gl(cn),cn=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||nt.current&1?ft===0&&(ft=3):Eu())),e.updateQueue!==null&&(e.flags|=4),It(e),null);case 4:return no(),ll(t,e),t===null&&zo(e.stateNode.containerInfo),It(e),null;case 10:return ru(e.type._context),It(e),null;case 17:return Ht(e.type)&&rs(),It(e),null;case 19:if(Qe(nt),i=e.memoizedState,i===null)return It(e),null;if(r=(e.flags&128)!==0,s=i.rendering,s===null)if(r)vo(i,!1);else{if(ft!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=cs(t),s!==null){for(e.flags|=128,vo(i,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,s=i.alternate,s===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,i.type=s.type,t=s.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Je(nt,nt.current&1|2),e.child}t=t.sibling}i.tail!==null&&at()>oo&&(e.flags|=128,r=!0,vo(i,!1),e.lanes=4194304)}else{if(!r)if(t=cs(s),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),vo(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!et)return It(e),null}else 2*at()-i.renderingStartTime>oo&&n!==1073741824&&(e.flags|=128,r=!0,vo(i,!1),e.lanes=4194304);i.isBackwards?(s.sibling=e.child,e.child=s):(n=i.last,n!==null?n.sibling=s:e.child=s,i.last=s)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=at(),e.sibling=null,n=nt.current,Je(nt,r?n&1|2:n&1),e):(It(e),null);case 22:case 23:return xu(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?jt&1073741824&&(It(e),e.subtreeFlags&6&&(e.flags|=8192)):It(e),null;case 24:return null;case 25:return null}throw Error(me(156,e.tag))}function K0(t,e){switch(Ql(e),e.tag){case 1:return Ht(e.type)&&rs(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return no(),Qe(Gt),Qe(At),lu(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return au(e),null;case 13:if(Qe(nt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(me(340));eo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Qe(nt),null;case 4:return no(),null;case 10:return ru(e.type._context),null;case 22:case 23:return xu(),null;case 24:return null;default:return null}}var Ei=!1,bt=!1,J0=typeof WeakSet=="function"?WeakSet:Set,we=null;function Fr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){it(t,e,r)}else n.current=null}function ul(t,e,n){try{n()}catch(r){it(t,e,r)}}var Uc=!1;function X0(t,e){if(Wa=Qi,t=kh(),Xl(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var s=0,a=-1,u=-1,d=0,h=0,m=t,p=null;t:for(;;){for(var g;m!==n||o!==0&&m.nodeType!==3||(a=s+o),m!==i||r!==0&&m.nodeType!==3||(u=s+r),m.nodeType===3&&(s+=m.nodeValue.length),(g=m.firstChild)!==null;)p=m,m=g;for(;;){if(m===t)break t;if(p===n&&++d===o&&(a=s),p===i&&++h===r&&(u=s),(g=m.nextSibling)!==null)break;m=p,p=m.parentNode}m=g}n=a===-1||u===-1?null:{start:a,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(qa={focusedElem:t,selectionRange:n},Qi=!1,we=e;we!==null;)if(e=we,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,we=t;else for(;we!==null;){e=we;try{var E=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(E!==null){var x=E.memoizedProps,w=E.memoizedState,y=e.stateNode,v=y.getSnapshotBeforeUpdate(e.elementType===e.type?x:ln(e.type,x),w);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(me(163))}}catch(N){it(e,e.return,N)}if(t=e.sibling,t!==null){t.return=e.return,we=t;break}we=e.return}return E=Uc,Uc=!1,E}function Mo(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&t)===t){var i=o.destroy;o.destroy=void 0,i!==void 0&&ul(e,n,i)}o=o.next}while(o!==r)}}function Ls(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function cl(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function bp(t){var e=t.alternate;e!==null&&(t.alternate=null,bp(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[En],delete e[Wo],delete e[Ja],delete e[M0],delete e[L0])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function _p(t){return t.tag===5||t.tag===3||t.tag===4}function Fc(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||_p(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function dl(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ns));else if(r!==4&&(t=t.child,t!==null))for(dl(t,e,n),t=t.sibling;t!==null;)dl(t,e,n),t=t.sibling}function fl(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(fl(t,e,n),t=t.sibling;t!==null;)fl(t,e,n),t=t.sibling}var Tt=null,un=!1;function Un(t,e,n){for(n=n.child;n!==null;)Ap(t,e,n),n=n.sibling}function Ap(t,e,n){if(Tn&&typeof Tn.onCommitFiberUnmount=="function")try{Tn.onCommitFiberUnmount(Is,n)}catch{}switch(n.tag){case 5:bt||Fr(n,e);case 6:var r=Tt,o=un;Tt=null,Un(t,e,n),Tt=r,un=o,Tt!==null&&(un?(t=Tt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Tt.removeChild(n.stateNode));break;case 18:Tt!==null&&(un?(t=Tt,n=n.stateNode,t.nodeType===8?ca(t.parentNode,n):t.nodeType===1&&ca(t,n),Bo(t)):ca(Tt,n.stateNode));break;case 4:r=Tt,o=un,Tt=n.stateNode.containerInfo,un=!0,Un(t,e,n),Tt=r,un=o;break;case 0:case 11:case 14:case 15:if(!bt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){o=r=r.next;do{var i=o,s=i.destroy;i=i.tag,s!==void 0&&(i&2||i&4)&&ul(n,e,s),o=o.next}while(o!==r)}Un(t,e,n);break;case 1:if(!bt&&(Fr(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){it(n,e,a)}Un(t,e,n);break;case 21:Un(t,e,n);break;case 22:n.mode&1?(bt=(r=bt)||n.memoizedState!==null,Un(t,e,n),bt=r):Un(t,e,n);break;default:Un(t,e,n)}}function Gc(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new J0),e.forEach(function(r){var o=sy.bind(null,t,r);n.has(r)||(n.add(r),r.then(o,o))})}}function an(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var o=n[r];try{var i=t,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:Tt=a.stateNode,un=!1;break e;case 3:Tt=a.stateNode.containerInfo,un=!0;break e;case 4:Tt=a.stateNode.containerInfo,un=!0;break e}a=a.return}if(Tt===null)throw Error(me(160));Ap(i,s,o),Tt=null,un=!1;var u=o.alternate;u!==null&&(u.return=null),o.return=null}catch(d){it(o,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Rp(e,t),e=e.sibling}function Rp(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(an(e,t),vn(t),r&4){try{Mo(3,t,t.return),Ls(3,t)}catch(x){it(t,t.return,x)}try{Mo(5,t,t.return)}catch(x){it(t,t.return,x)}}break;case 1:an(e,t),vn(t),r&512&&n!==null&&Fr(n,n.return);break;case 5:if(an(e,t),vn(t),r&512&&n!==null&&Fr(n,n.return),t.flags&32){var o=t.stateNode;try{Uo(o,"")}catch(x){it(t,t.return,x)}}if(r&4&&(o=t.stateNode,o!=null)){var i=t.memoizedProps,s=n!==null?n.memoizedProps:i,a=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Zf(o,i),Da(a,s);var d=Da(a,i);for(s=0;s<u.length;s+=2){var h=u[s],m=u[s+1];h==="style"?rh(o,m):h==="dangerouslySetInnerHTML"?th(o,m):h==="children"?Uo(o,m):Fl(o,h,m,d)}switch(a){case"input":ka(o,i);break;case"textarea":Qf(o,i);break;case"select":var p=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var g=i.value;g!=null?zr(o,!!i.multiple,g,!1):p!==!!i.multiple&&(i.defaultValue!=null?zr(o,!!i.multiple,i.defaultValue,!0):zr(o,!!i.multiple,i.multiple?[]:"",!1))}o[Wo]=i}catch(x){it(t,t.return,x)}}break;case 6:if(an(e,t),vn(t),r&4){if(t.stateNode===null)throw Error(me(162));o=t.stateNode,i=t.memoizedProps;try{o.nodeValue=i}catch(x){it(t,t.return,x)}}break;case 3:if(an(e,t),vn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Bo(e.containerInfo)}catch(x){it(t,t.return,x)}break;case 4:an(e,t),vn(t);break;case 13:an(e,t),vn(t),o=t.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(yu=at())),r&4&&Gc(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(bt=(d=bt)||h,an(e,t),bt=d):an(e,t),vn(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!h&&t.mode&1)for(we=t,h=t.child;h!==null;){for(m=we=h;we!==null;){switch(p=we,g=p.child,p.tag){case 0:case 11:case 14:case 15:Mo(4,p,p.return);break;case 1:Fr(p,p.return);var E=p.stateNode;if(typeof E.componentWillUnmount=="function"){r=p,n=p.return;try{e=r,E.props=e.memoizedProps,E.state=e.memoizedState,E.componentWillUnmount()}catch(x){it(r,n,x)}}break;case 5:Fr(p,p.return);break;case 22:if(p.memoizedState!==null){Bc(m);continue}}g!==null?(g.return=p,we=g):Bc(m)}h=h.sibling}e:for(h=null,m=t;;){if(m.tag===5){if(h===null){h=m;try{o=m.stateNode,d?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=m.stateNode,u=m.memoizedProps.style,s=u!=null&&u.hasOwnProperty("display")?u.display:null,a.style.display=nh("display",s))}catch(x){it(t,t.return,x)}}}else if(m.tag===6){if(h===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(x){it(t,t.return,x)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;h===m&&(h=null),m=m.return}h===m&&(h=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:an(e,t),vn(t),r&4&&Gc(t);break;case 21:break;default:an(e,t),vn(t)}}function vn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(_p(n)){var r=n;break e}n=n.return}throw Error(me(160))}switch(r.tag){case 5:var o=r.stateNode;r.flags&32&&(Uo(o,""),r.flags&=-33);var i=Fc(t);fl(t,i,o);break;case 3:case 4:var s=r.stateNode.containerInfo,a=Fc(t);dl(t,a,s);break;default:throw Error(me(161))}}catch(u){it(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Z0(t,e,n){we=t,kp(t)}function kp(t,e,n){for(var r=(t.mode&1)!==0;we!==null;){var o=we,i=o.child;if(o.tag===22&&r){var s=o.memoizedState!==null||Ei;if(!s){var a=o.alternate,u=a!==null&&a.memoizedState!==null||bt;a=Ei;var d=bt;if(Ei=s,(bt=u)&&!d)for(we=o;we!==null;)s=we,u=s.child,s.tag===22&&s.memoizedState!==null?Vc(o):u!==null?(u.return=s,we=u):Vc(o);for(;i!==null;)we=i,kp(i),i=i.sibling;we=o,Ei=a,bt=d}Hc(t)}else o.subtreeFlags&8772&&i!==null?(i.return=o,we=i):Hc(t)}}function Hc(t){for(;we!==null;){var e=we;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:bt||Ls(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!bt)if(n===null)r.componentDidMount();else{var o=e.elementType===e.type?n.memoizedProps:ln(e.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Cc(e,i,r);break;case 3:var s=e.updateQueue;if(s!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Cc(e,s,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var m=h.dehydrated;m!==null&&Bo(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(me(163))}bt||e.flags&512&&cl(e)}catch(p){it(e,e.return,p)}}if(e===t){we=null;break}if(n=e.sibling,n!==null){n.return=e.return,we=n;break}we=e.return}}function Bc(t){for(;we!==null;){var e=we;if(e===t){we=null;break}var n=e.sibling;if(n!==null){n.return=e.return,we=n;break}we=e.return}}function Vc(t){for(;we!==null;){var e=we;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ls(4,e)}catch(u){it(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var o=e.return;try{r.componentDidMount()}catch(u){it(e,o,u)}}var i=e.return;try{cl(e)}catch(u){it(e,i,u)}break;case 5:var s=e.return;try{cl(e)}catch(u){it(e,s,u)}}}catch(u){it(e,e.return,u)}if(e===t){we=null;break}var a=e.sibling;if(a!==null){a.return=e.return,we=a;break}we=e.return}}var Q0=Math.ceil,hs=Ln.ReactCurrentDispatcher,mu=Ln.ReactCurrentOwner,tn=Ln.ReactCurrentBatchConfig,$e=0,pt=null,ct=null,St=0,jt=0,Gr=rr(0),ft=0,Zo=null,vr=0,Os=0,gu=0,Lo=null,Ut=null,yu=0,oo=1/0,wn=null,ps=!1,hl=null,Jn=null,Ti=!1,jn=null,ms=0,Oo=0,pl=null,Hi=-1,Bi=0;function Mt(){return $e&6?at():Hi!==-1?Hi:Hi=at()}function Xn(t){return t.mode&1?$e&2&&St!==0?St&-St:D0.transition!==null?(Bi===0&&(Bi=mh()),Bi):(t=Ye,t!==0||(t=window.event,t=t===void 0?16:Sh(t.type)),t):1}function fn(t,e,n,r){if(50<Oo)throw Oo=0,pl=null,Error(me(185));ti(t,n,r),(!($e&2)||t!==pt)&&(t===pt&&(!($e&2)&&(Os|=n),ft===4&&Bn(t,St)),Bt(t,r),n===1&&$e===0&&!(e.mode&1)&&(oo=at()+500,ks&&or()))}function Bt(t,e){var n=t.callbackNode;Dg(t,e);var r=Zi(t,t===pt?St:0);if(r===0)n!==null&&Xu(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Xu(n),e===1)t.tag===0?O0(jc.bind(null,t)):Bh(jc.bind(null,t)),k0(function(){!($e&6)&&or()}),n=null;else{switch(gh(r)){case 1:n=jl;break;case 4:n=hh;break;case 16:n=Xi;break;case 536870912:n=ph;break;default:n=Xi}n=Gp(n,Pp.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Pp(t,e){if(Hi=-1,Bi=0,$e&6)throw Error(me(327));var n=t.callbackNode;if(Kr()&&t.callbackNode!==n)return null;var r=Zi(t,t===pt?St:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=gs(t,r);else{e=r;var o=$e;$e|=2;var i=Lp();(pt!==t||St!==e)&&(wn=null,oo=at()+500,fr(t,e));do try{ny();break}catch(a){Mp(t,a)}while(!0);nu(),hs.current=i,$e=o,ct!==null?e=0:(pt=null,St=0,e=ft)}if(e!==0){if(e===2&&(o=Ba(t),o!==0&&(r=o,e=ml(t,o))),e===1)throw n=Zo,fr(t,0),Bn(t,r),Bt(t,at()),n;if(e===6)Bn(t,r);else{if(o=t.current.alternate,!(r&30)&&!ey(o)&&(e=gs(t,r),e===2&&(i=Ba(t),i!==0&&(r=i,e=ml(t,i))),e===1))throw n=Zo,fr(t,0),Bn(t,r),Bt(t,at()),n;switch(t.finishedWork=o,t.finishedLanes=r,e){case 0:case 1:throw Error(me(345));case 2:ar(t,Ut,wn);break;case 3:if(Bn(t,r),(r&130023424)===r&&(e=yu+500-at(),10<e)){if(Zi(t,0)!==0)break;if(o=t.suspendedLanes,(o&r)!==r){Mt(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=Ka(ar.bind(null,t,Ut,wn),e);break}ar(t,Ut,wn);break;case 4:if(Bn(t,r),(r&4194240)===r)break;for(e=t.eventTimes,o=-1;0<r;){var s=31-dn(r);i=1<<s,s=e[s],s>o&&(o=s),r&=~i}if(r=o,r=at()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Q0(r/1960))-r,10<r){t.timeoutHandle=Ka(ar.bind(null,t,Ut,wn),r);break}ar(t,Ut,wn);break;case 5:ar(t,Ut,wn);break;default:throw Error(me(329))}}}return Bt(t,at()),t.callbackNode===n?Pp.bind(null,t):null}function ml(t,e){var n=Lo;return t.current.memoizedState.isDehydrated&&(fr(t,e).flags|=256),t=gs(t,e),t!==2&&(e=Ut,Ut=n,e!==null&&gl(e)),t}function gl(t){Ut===null?Ut=t:Ut.push.apply(Ut,t)}function ey(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var o=n[r],i=o.getSnapshot;o=o.value;try{if(!mn(i(),o))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Bn(t,e){for(e&=~gu,e&=~Os,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-dn(e),r=1<<n;t[n]=-1,e&=~r}}function jc(t){if($e&6)throw Error(me(327));Kr();var e=Zi(t,0);if(!(e&1))return Bt(t,at()),null;var n=gs(t,e);if(t.tag!==0&&n===2){var r=Ba(t);r!==0&&(e=r,n=ml(t,r))}if(n===1)throw n=Zo,fr(t,0),Bn(t,e),Bt(t,at()),n;if(n===6)throw Error(me(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ar(t,Ut,wn),Bt(t,at()),null}function vu(t,e){var n=$e;$e|=1;try{return t(e)}finally{$e=n,$e===0&&(oo=at()+500,ks&&or())}}function xr(t){jn!==null&&jn.tag===0&&!($e&6)&&Kr();var e=$e;$e|=1;var n=tn.transition,r=Ye;try{if(tn.transition=null,Ye=1,t)return t()}finally{Ye=r,tn.transition=n,$e=e,!($e&6)&&or()}}function xu(){jt=Gr.current,Qe(Gr)}function fr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,R0(n)),ct!==null)for(n=ct.return;n!==null;){var r=n;switch(Ql(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&rs();break;case 3:no(),Qe(Gt),Qe(At),lu();break;case 5:au(r);break;case 4:no();break;case 13:Qe(nt);break;case 19:Qe(nt);break;case 10:ru(r.type._context);break;case 22:case 23:xu()}n=n.return}if(pt=t,ct=t=Zn(t.current,null),St=jt=e,ft=0,Zo=null,gu=Os=vr=0,Ut=Lo=null,cr!==null){for(e=0;e<cr.length;e++)if(n=cr[e],r=n.interleaved,r!==null){n.interleaved=null;var o=r.next,i=n.pending;if(i!==null){var s=i.next;i.next=o,r.next=s}n.pending=r}cr=null}return t}function Mp(t,e){do{var n=ct;try{if(nu(),Ui.current=fs,ds){for(var r=rt.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}ds=!1}if(yr=0,ht=dt=rt=null,Po=!1,Ko=0,mu.current=null,n===null||n.return===null){ft=1,Zo=e,ct=null;break}e:{var i=t,s=n.return,a=n,u=e;if(e=St,a.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,h=a,m=h.tag;if(!(h.mode&1)&&(m===0||m===11||m===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var g=Rc(s);if(g!==null){g.flags&=-257,kc(g,s,a,i,e),g.mode&1&&Ac(i,d,e),e=g,u=d;var E=e.updateQueue;if(E===null){var x=new Set;x.add(u),e.updateQueue=x}else E.add(u);break e}else{if(!(e&1)){Ac(i,d,e),Eu();break e}u=Error(me(426))}}else if(et&&a.mode&1){var w=Rc(s);if(w!==null){!(w.flags&65536)&&(w.flags|=256),kc(w,s,a,i,e),eu(ro(u,a));break e}}i=u=ro(u,a),ft!==4&&(ft=2),Lo===null?Lo=[i]:Lo.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=gp(i,u,e);wc(i,y);break e;case 1:a=u;var v=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Jn===null||!Jn.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var N=yp(i,a,e);wc(i,N);break e}}i=i.return}while(i!==null)}Dp(n)}catch(I){e=I,ct===n&&n!==null&&(ct=n=n.return);continue}break}while(!0)}function Lp(){var t=hs.current;return hs.current=fs,t===null?fs:t}function Eu(){(ft===0||ft===3||ft===2)&&(ft=4),pt===null||!(vr&268435455)&&!(Os&268435455)||Bn(pt,St)}function gs(t,e){var n=$e;$e|=2;var r=Lp();(pt!==t||St!==e)&&(wn=null,fr(t,e));do try{ty();break}catch(o){Mp(t,o)}while(!0);if(nu(),$e=n,hs.current=r,ct!==null)throw Error(me(261));return pt=null,St=0,ft}function ty(){for(;ct!==null;)Op(ct)}function ny(){for(;ct!==null&&!bg();)Op(ct)}function Op(t){var e=Fp(t.alternate,t,jt);t.memoizedProps=t.pendingProps,e===null?Dp(t):ct=e,mu.current=null}function Dp(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=K0(n,e),n!==null){n.flags&=32767,ct=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ft=6,ct=null;return}}else if(n=Y0(n,e,jt),n!==null){ct=n;return}if(e=e.sibling,e!==null){ct=e;return}ct=e=t}while(e!==null);ft===0&&(ft=5)}function ar(t,e,n){var r=Ye,o=tn.transition;try{tn.transition=null,Ye=1,ry(t,e,n,r)}finally{tn.transition=o,Ye=r}return null}function ry(t,e,n,r){do Kr();while(jn!==null);if($e&6)throw Error(me(327));n=t.finishedWork;var o=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(me(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(Ug(t,i),t===pt&&(ct=pt=null,St=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ti||(Ti=!0,Gp(Xi,function(){return Kr(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=tn.transition,tn.transition=null;var s=Ye;Ye=1;var a=$e;$e|=4,mu.current=null,X0(t,n),Rp(n,t),w0(qa),Qi=!!Wa,qa=Wa=null,t.current=n,Z0(n),_g(),$e=a,Ye=s,tn.transition=i}else t.current=n;if(Ti&&(Ti=!1,jn=t,ms=o),i=t.pendingLanes,i===0&&(Jn=null),kg(n.stateNode),Bt(t,at()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)o=e[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(ps)throw ps=!1,t=hl,hl=null,t;return ms&1&&t.tag!==0&&Kr(),i=t.pendingLanes,i&1?t===pl?Oo++:(Oo=0,pl=t):Oo=0,or(),null}function Kr(){if(jn!==null){var t=gh(ms),e=tn.transition,n=Ye;try{if(tn.transition=null,Ye=16>t?16:t,jn===null)var r=!1;else{if(t=jn,jn=null,ms=0,$e&6)throw Error(me(331));var o=$e;for($e|=4,we=t.current;we!==null;){var i=we,s=i.child;if(we.flags&16){var a=i.deletions;if(a!==null){for(var u=0;u<a.length;u++){var d=a[u];for(we=d;we!==null;){var h=we;switch(h.tag){case 0:case 11:case 15:Mo(8,h,i)}var m=h.child;if(m!==null)m.return=h,we=m;else for(;we!==null;){h=we;var p=h.sibling,g=h.return;if(bp(h),h===d){we=null;break}if(p!==null){p.return=g,we=p;break}we=g}}}var E=i.alternate;if(E!==null){var x=E.child;if(x!==null){E.child=null;do{var w=x.sibling;x.sibling=null,x=w}while(x!==null)}}we=i}}if(i.subtreeFlags&2064&&s!==null)s.return=i,we=s;else e:for(;we!==null;){if(i=we,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Mo(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,we=y;break e}we=i.return}}var v=t.current;for(we=v;we!==null;){s=we;var S=s.child;if(s.subtreeFlags&2064&&S!==null)S.return=s,we=S;else e:for(s=v;we!==null;){if(a=we,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ls(9,a)}}catch(I){it(a,a.return,I)}if(a===s){we=null;break e}var N=a.sibling;if(N!==null){N.return=a.return,we=N;break e}we=a.return}}if($e=o,or(),Tn&&typeof Tn.onPostCommitFiberRoot=="function")try{Tn.onPostCommitFiberRoot(Is,t)}catch{}r=!0}return r}finally{Ye=n,tn.transition=e}}return!1}function zc(t,e,n){e=ro(n,e),e=gp(t,e,1),t=Kn(t,e,1),e=Mt(),t!==null&&(ti(t,1,e),Bt(t,e))}function it(t,e,n){if(t.tag===3)zc(t,t,n);else for(;e!==null;){if(e.tag===3){zc(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Jn===null||!Jn.has(r))){t=ro(n,t),t=yp(e,t,1),e=Kn(e,t,1),t=Mt(),e!==null&&(ti(e,1,t),Bt(e,t));break}}e=e.return}}function oy(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Mt(),t.pingedLanes|=t.suspendedLanes&n,pt===t&&(St&n)===n&&(ft===4||ft===3&&(St&130023424)===St&&500>at()-yu?fr(t,0):gu|=n),Bt(t,e)}function Up(t,e){e===0&&(t.mode&1?(e=di,di<<=1,!(di&130023424)&&(di=4194304)):e=1);var n=Mt();t=kn(t,e),t!==null&&(ti(t,e,n),Bt(t,n))}function iy(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Up(t,n)}function sy(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,o=t.memoizedState;o!==null&&(n=o.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(me(314))}r!==null&&r.delete(e),Up(t,n)}var Fp;Fp=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Gt.current)Ft=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ft=!1,q0(t,e,n);Ft=!!(t.flags&131072)}else Ft=!1,et&&e.flags&1048576&&Vh(e,ss,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Gi(t,e),t=e.pendingProps;var o=Qr(e,At.current);Yr(e,n),o=cu(null,e,r,t,o,n);var i=du();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ht(r)?(i=!0,os(e)):i=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,iu(e),o.updater=Ms,e.stateNode=o,o._reactInternals=e,nl(e,r,t,n),e=il(null,e,r,!0,i,n)):(e.tag=0,et&&i&&Zl(e),Pt(null,e,o,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Gi(t,e),t=e.pendingProps,o=r._init,r=o(r._payload),e.type=r,o=e.tag=ly(r),t=ln(r,t),o){case 0:e=ol(null,e,r,t,n);break e;case 1:e=Lc(null,e,r,t,n);break e;case 11:e=Pc(null,e,r,t,n);break e;case 14:e=Mc(null,e,r,ln(r.type,t),n);break e}throw Error(me(306,r,""))}return e;case 0:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:ln(r,o),ol(t,e,r,o,n);case 1:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:ln(r,o),Lc(t,e,r,o,n);case 3:e:{if(Tp(e),t===null)throw Error(me(387));r=e.pendingProps,i=e.memoizedState,o=i.element,Yh(t,e),us(e,r,null,n);var s=e.memoizedState;if(r=s.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){o=ro(Error(me(423)),e),e=Oc(t,e,r,n,o);break e}else if(r!==o){o=ro(Error(me(424)),e),e=Oc(t,e,r,n,o);break e}else for(zt=Yn(e.stateNode.containerInfo.firstChild),$t=e,et=!0,cn=null,n=Wh(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(eo(),r===o){e=Pn(t,e,n);break e}Pt(t,e,r,n)}e=e.child}return e;case 5:return Kh(e),t===null&&Qa(e),r=e.type,o=e.pendingProps,i=t!==null?t.memoizedProps:null,s=o.children,Ya(r,o)?s=null:i!==null&&Ya(r,i)&&(e.flags|=32),Ep(t,e),Pt(t,e,s,n),e.child;case 6:return t===null&&Qa(e),null;case 13:return Sp(t,e,n);case 4:return su(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=to(e,null,r,n):Pt(t,e,r,n),e.child;case 11:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:ln(r,o),Pc(t,e,r,o,n);case 7:return Pt(t,e,e.pendingProps,n),e.child;case 8:return Pt(t,e,e.pendingProps.children,n),e.child;case 12:return Pt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,o=e.pendingProps,i=e.memoizedProps,s=o.value,Je(as,r._currentValue),r._currentValue=s,i!==null)if(mn(i.value,s)){if(i.children===o.children&&!Gt.current){e=Pn(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){s=i.child;for(var u=a.firstContext;u!==null;){if(u.context===r){if(i.tag===1){u=_n(-1,n&-n),u.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?u.next=u:(u.next=h.next,h.next=u),d.pending=u}}i.lanes|=n,u=i.alternate,u!==null&&(u.lanes|=n),el(i.return,n,e),a.lanes|=n;break}u=u.next}}else if(i.tag===10)s=i.type===e.type?null:i.child;else if(i.tag===18){if(s=i.return,s===null)throw Error(me(341));s.lanes|=n,a=s.alternate,a!==null&&(a.lanes|=n),el(s,n,e),s=i.sibling}else s=i.child;if(s!==null)s.return=i;else for(s=i;s!==null;){if(s===e){s=null;break}if(i=s.sibling,i!==null){i.return=s.return,s=i;break}s=s.return}i=s}Pt(t,e,o.children,n),e=e.child}return e;case 9:return o=e.type,r=e.pendingProps.children,Yr(e,n),o=rn(o),r=r(o),e.flags|=1,Pt(t,e,r,n),e.child;case 14:return r=e.type,o=ln(r,e.pendingProps),o=ln(r.type,o),Mc(t,e,r,o,n);case 15:return vp(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:ln(r,o),Gi(t,e),e.tag=1,Ht(r)?(t=!0,os(e)):t=!1,Yr(e,n),mp(e,r,o),nl(e,r,o,n),il(null,e,r,!0,t,n);case 19:return wp(t,e,n);case 22:return xp(t,e,n)}throw Error(me(156,e.tag))};function Gp(t,e){return fh(t,e)}function ay(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function en(t,e,n,r){return new ay(t,e,n,r)}function Tu(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ly(t){if(typeof t=="function")return Tu(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Hl)return 11;if(t===Bl)return 14}return 2}function Zn(t,e){var n=t.alternate;return n===null?(n=en(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Vi(t,e,n,r,o,i){var s=2;if(r=t,typeof t=="function")Tu(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case Ar:return hr(n.children,o,i,e);case Gl:s=8,o|=8;break;case Ia:return t=en(12,n,e,o|2),t.elementType=Ia,t.lanes=i,t;case ba:return t=en(13,n,e,o),t.elementType=ba,t.lanes=i,t;case _a:return t=en(19,n,e,o),t.elementType=_a,t.lanes=i,t;case Kf:return Ds(n,o,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case qf:s=10;break e;case Yf:s=9;break e;case Hl:s=11;break e;case Bl:s=14;break e;case Fn:s=16,r=null;break e}throw Error(me(130,t==null?t:typeof t,""))}return e=en(s,n,e,o),e.elementType=t,e.type=r,e.lanes=i,e}function hr(t,e,n,r){return t=en(7,t,r,e),t.lanes=n,t}function Ds(t,e,n,r){return t=en(22,t,r,e),t.elementType=Kf,t.lanes=n,t.stateNode={isHidden:!1},t}function va(t,e,n){return t=en(6,t,null,e),t.lanes=n,t}function xa(t,e,n){return e=en(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function uy(t,e,n,r,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Qs(0),this.expirationTimes=Qs(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qs(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Su(t,e,n,r,o,i,s,a,u){return t=new uy(t,e,n,a,u),e===1?(e=1,i===!0&&(e|=8)):e=0,i=en(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},iu(i),t}function cy(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_r,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Hp(t){if(!t)return er;t=t._reactInternals;e:{if(Tr(t)!==t||t.tag!==1)throw Error(me(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ht(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(me(171))}if(t.tag===1){var n=t.type;if(Ht(n))return Hh(t,n,e)}return e}function Bp(t,e,n,r,o,i,s,a,u){return t=Su(n,r,!0,t,o,i,s,a,u),t.context=Hp(null),n=t.current,r=Mt(),o=Xn(n),i=_n(r,o),i.callback=e??null,Kn(n,i,o),t.current.lanes=o,ti(t,o,r),Bt(t,r),t}function Us(t,e,n,r){var o=e.current,i=Mt(),s=Xn(o);return n=Hp(n),e.context===null?e.context=n:e.pendingContext=n,e=_n(i,s),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Kn(o,e,s),t!==null&&(fn(t,o,s,i),Di(t,o,s)),s}function ys(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function $c(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function wu(t,e){$c(t,e),(t=t.alternate)&&$c(t,e)}function dy(){return null}var Vp=typeof reportError=="function"?reportError:function(t){console.error(t)};function Cu(t){this._internalRoot=t}Fs.prototype.render=Cu.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(me(409));Us(t,e,null,null)};Fs.prototype.unmount=Cu.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;xr(function(){Us(null,t,null,null)}),e[Rn]=null}};function Fs(t){this._internalRoot=t}Fs.prototype.unstable_scheduleHydration=function(t){if(t){var e=xh();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Hn.length&&e!==0&&e<Hn[n].priority;n++);Hn.splice(n,0,t),n===0&&Th(t)}};function Nu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Gs(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Wc(){}function fy(t,e,n,r,o){if(o){if(typeof r=="function"){var i=r;r=function(){var d=ys(s);i.call(d)}}var s=Bp(e,r,t,0,null,!1,!1,"",Wc);return t._reactRootContainer=s,t[Rn]=s.current,zo(t.nodeType===8?t.parentNode:t),xr(),s}for(;o=t.lastChild;)t.removeChild(o);if(typeof r=="function"){var a=r;r=function(){var d=ys(u);a.call(d)}}var u=Su(t,0,!1,null,null,!1,!1,"",Wc);return t._reactRootContainer=u,t[Rn]=u.current,zo(t.nodeType===8?t.parentNode:t),xr(function(){Us(e,u,n,r)}),u}function Hs(t,e,n,r,o){var i=n._reactRootContainer;if(i){var s=i;if(typeof o=="function"){var a=o;o=function(){var u=ys(s);a.call(u)}}Us(e,s,t,o)}else s=fy(n,e,t,o,r);return ys(s)}yh=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Co(e.pendingLanes);n!==0&&(zl(e,n|1),Bt(e,at()),!($e&6)&&(oo=at()+500,or()))}break;case 13:xr(function(){var r=kn(t,1);if(r!==null){var o=Mt();fn(r,t,1,o)}}),wu(t,1)}};$l=function(t){if(t.tag===13){var e=kn(t,134217728);if(e!==null){var n=Mt();fn(e,t,134217728,n)}wu(t,134217728)}};vh=function(t){if(t.tag===13){var e=Xn(t),n=kn(t,e);if(n!==null){var r=Mt();fn(n,t,e,r)}wu(t,e)}};xh=function(){return Ye};Eh=function(t,e){var n=Ye;try{return Ye=t,e()}finally{Ye=n}};Fa=function(t,e,n){switch(e){case"input":if(ka(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var o=Rs(r);if(!o)throw Error(me(90));Xf(r),ka(r,o)}}}break;case"textarea":Qf(t,n);break;case"select":e=n.value,e!=null&&zr(t,!!n.multiple,e,!1)}};sh=vu;ah=xr;var hy={usingClientEntryPoint:!1,Events:[ri,Mr,Rs,oh,ih,vu]},xo={findFiberByHostInstance:ur,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},py={bundleType:xo.bundleType,version:xo.version,rendererPackageName:xo.rendererPackageName,rendererConfig:xo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ln.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ch(t),t===null?null:t.stateNode},findFiberByHostInstance:xo.findFiberByHostInstance||dy,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Si=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Si.isDisabled&&Si.supportsFiber)try{Is=Si.inject(py),Tn=Si}catch{}}qt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hy;qt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Nu(e))throw Error(me(200));return cy(t,e,null,n)};qt.createRoot=function(t,e){if(!Nu(t))throw Error(me(299));var n=!1,r="",o=Vp;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=Su(t,1,!1,null,null,n,!1,r,o),t[Rn]=e.current,zo(t.nodeType===8?t.parentNode:t),new Cu(e)};qt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(me(188)):(t=Object.keys(t).join(","),Error(me(268,t)));return t=ch(e),t=t===null?null:t.stateNode,t};qt.flushSync=function(t){return xr(t)};qt.hydrate=function(t,e,n){if(!Gs(e))throw Error(me(200));return Hs(null,t,e,!0,n)};qt.hydrateRoot=function(t,e,n){if(!Nu(t))throw Error(me(405));var r=n!=null&&n.hydratedSources||null,o=!1,i="",s=Vp;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),e=Bp(e,null,t,1,n??null,o,!1,i,s),t[Rn]=e.current,zo(t),r)for(t=0;t<r.length;t++)n=r[t],o=n._getVersion,o=o(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,o]:e.mutableSourceEagerHydrationData.push(n,o);return new Fs(e)};qt.render=function(t,e,n){if(!Gs(e))throw Error(me(200));return Hs(null,t,e,!1,n)};qt.unmountComponentAtNode=function(t){if(!Gs(t))throw Error(me(40));return t._reactRootContainer?(xr(function(){Hs(null,null,t,!1,function(){t._reactRootContainer=null,t[Rn]=null})}),!0):!1};qt.unstable_batchedUpdates=vu;qt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Gs(n))throw Error(me(200));if(t==null||t._reactInternals===void 0)throw Error(me(38));return Hs(t,e,n,!1,r)};qt.version="18.3.1-next-f1338f8080-20240426";function jp(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jp)}catch(t){console.error(t)}}jp(),jf.exports=qt;var my=jf.exports,qc=my;Ca.createRoot=qc.createRoot,Ca.hydrateRoot=qc.hydrateRoot;let wi;const gy=new Uint8Array(16);function yy(){if(!wi&&(wi=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!wi))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wi(gy)}const Et=[];for(let t=0;t<256;++t)Et.push((t+256).toString(16).slice(1));function vy(t,e=0){return Et[t[e+0]]+Et[t[e+1]]+Et[t[e+2]]+Et[t[e+3]]+"-"+Et[t[e+4]]+Et[t[e+5]]+"-"+Et[t[e+6]]+Et[t[e+7]]+"-"+Et[t[e+8]]+Et[t[e+9]]+"-"+Et[t[e+10]]+Et[t[e+11]]+Et[t[e+12]]+Et[t[e+13]]+Et[t[e+14]]+Et[t[e+15]]}const xy=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Yc={randomUUID:xy};function Ea(t,e,n){if(Yc.randomUUID&&!t)return Yc.randomUUID();t=t||{};const r=t.random||(t.rng||yy)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,vy(r)}const Ey="SintongBangtongDB",tr="projects",Iu=()=>new Promise((t,e)=>{if(typeof window>"u"||!window.indexedDB){e(new Error("IndexedDB is not supported"));return}const n=indexedDB.open(Ey,1);n.onupgradeneeded=r=>{const o=r.target.result;o.objectStoreNames.contains(tr)||o.createObjectStore(tr)},n.onsuccess=()=>t(n.result),n.onerror=()=>e(n.error)}),Ir=async(t,e)=>{try{const n=await Iu();return new Promise((r,o)=>{const a=n.transaction(tr,"readwrite").objectStore(tr).put(e,t);a.onsuccess=()=>r(),a.onerror=()=>o(a.error)})}catch(n){console.error("IndexedDB Save Error:",n)}},ji=async t=>{try{const e=await Iu();return new Promise((n,r)=>{const s=e.transaction(tr,"readonly").objectStore(tr).get(t);s.onsuccess=()=>n(s.result),s.onerror=()=>r(s.error)})}catch(e){return console.error("IndexedDB Load Error:",e),null}},zi=async t=>{try{const e=await Iu();return new Promise((n,r)=>{const s=e.transaction(tr,"readwrite").objectStore(tr).delete(t);s.onsuccess=()=>n(),s.onerror=()=>r(s.error)})}catch(e){console.error("IndexedDB Delete Error:",e)}},zp=se.createContext(void 0),Kc=`[  ]
1. :    . (  ,      )
2.   ():
   -   **()  ** . (     ).
   -       .
   -  :  ** **. (   ).
   -  : , ,   .
3.   ():
   -    .   .
   -  :  (),   /, , ,  .
   -   .`,Ty=({children:t})=>{const[e,n]=se.useState(""),[r,o]=se.useState(""),[i,s]=se.useState([]),[a,u]=se.useState("webtoon"),[d,h]=se.useState("16:9"),[m,p]=se.useState([]),[g,E]=se.useState([]),[x,w]=se.useState([]),[y,v]=se.useState([]),[S,N]=se.useState(!0),[I,L]=se.useState(Kc),[P,D]=se.useState({}),[M,j]=se.useState(!1),[Q,_]=se.useState(null),[z,C]=se.useState(null);se.useEffect(()=>{if(i.length>0){const Ee=i.map(Ne=>`[${Ne.title}]
${Ne.content}`).join(`

`);o(Ee)}},[i]),se.useEffect(()=>{(async()=>{const Ne=localStorage.getItem("sb_api_key");Ne&&n(Ne);try{let Ie=await ji("currentProject");if(!Ie){const Re=localStorage.getItem("sb_project_data");if(Re)try{Ie=JSON.parse(Re)}catch(st){console.error("Failed to parse LocalStorage data",st)}}Ie&&(o(Ie.script||""),Ie.scriptSegments&&Ie.scriptSegments.length>0?s(Ie.scriptSegments):Ie.script&&!Ie.scriptSegments&&s([{id:Ea(),title:" ",content:Ie.script}]),u(Ie.selectedStyle||"webtoon"),p(Ie.scenes||[]),E(Ie.characters||[]),w(Ie.referenceImages||[]),v(Ie.props||[]),Ie.globalAspectRatio&&h(Ie.globalAspectRatio),Ie.globalScenePrompt&&L(Ie.globalScenePrompt))}catch(Ie){console.error("Load failed",Ie)}finally{j(!0)}})()},[]);const Y=Ee=>{o(Ee),i.length===0&&s([{id:Ea(),title:" ",content:Ee}])},he=(Ee,Ne)=>{const Ie={id:Ea(),title:Ee,content:Ne};s(Re=>[...Re,Ie])},J=Ee=>{s(Ne=>Ne.filter(Ie=>Ie.id!==Ee))},te=(Ee,Ne)=>{s(Ie=>Ie.map(Re=>Re.id===Ee?{...Re,content:Ne}:Re))},H=()=>{s([]),o("")},ie=()=>{Ir("currentProject",{script:r,scriptSegments:i,selectedStyle:a,scenes:m,characters:g,referenceImages:x,props:y,globalAspectRatio:d,globalScenePrompt:I,userOptions:P}).catch(Ne=>{console.warn("Failed to save to IndexedDB",Ne),R("   (   )","error")})};se.useEffect(()=>{if(!M)return;const Ee=setTimeout(ie,2e3);return()=>clearTimeout(Ee)},[r,i,a,m,g,x,y,d,I,P,M]),se.useEffect(()=>{e&&localStorage.setItem("sb_api_key",e)},[e]);const F=async()=>{o(""),s([]),p([]),E([]),w([]),v([]),L(Kc),D({}),localStorage.removeItem("sb_project_data"),await zi("currentProject"),R(" . (  )","success")},R=(Ee,Ne="success")=>{_({message:Ee,type:Ne})},de=()=>_(null),ge=Ee=>C(Ee),ae=()=>C(null),_e=(Ee,Ne)=>{D(Ie=>({...Ie,[Ee]:[...Ie[Ee]||[],Ne]})),R(`  '${Ne.label}'() .`,"success")},ze=(Ee,Ne)=>{D(Ie=>({...Ie,[Ee]:(Ie[Ee]||[]).filter(Re=>Re.label!==Ne)})),R(` '${Ne}'() .`,"success")};return f.jsx(zp.Provider,{value:{apiKey:e,setApiKey:n,script:r,setScript:Y,scriptSegments:i,addScriptSegment:he,removeScriptSegment:J,updateScriptSegment:te,clearScriptSegments:H,selectedStyle:a,setSelectedStyle:u,globalAspectRatio:d,setGlobalAspectRatio:h,scenes:m,setScenes:p,characters:g,setCharacters:E,referenceImages:x,setReferenceImages:w,props:y,setProps:v,isContinuityMode:S,setIsContinuityMode:N,globalScenePrompt:I,setGlobalScenePrompt:L,userOptions:P,addUserOption:_e,removeUserOption:ze,saveProject:ie,resetProject:F,toast:Q,showToast:R,closeToast:de,modalConfig:z,openModal:ge,closeModal:ae},children:t})},gn=()=>{const t=se.useContext(zp);if(!t)throw new Error("useProject must be used within a ProjectProvider");return t};var Sy={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let wy,Cy;function Ny(){return{geminiUrl:wy,vertexUrl:Cy}}function Iy(t,e,n,r){var o,i;if(!(t!=null&&t.baseUrl)){const s=Ny();return e?(o=s.vertexUrl)!==null&&o!==void 0?o:n:(i=s.geminiUrl)!==null&&i!==void 0?i:r}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class On{}function Te(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(r,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){const i=e[o];return i!=null?String(i):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function c(t,e,n){for(let i=0;i<e.length-1;i++){const s=e[i];if(s.endsWith("[]")){const a=s.slice(0,-2);if(!(a in t))if(Array.isArray(n))t[a]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(t[a])){const u=t[a];if(Array.isArray(n))for(let d=0;d<u.length;d++){const h=u[d];c(h,e.slice(i+1),n[d])}else for(const d of u)c(d,e.slice(i+1),n)}return}else if(s.endsWith("[0]")){const a=s.slice(0,-3);a in t||(t[a]=[{}]);const u=t[a];c(u[0],e.slice(i+1),n);return}(!t[s]||typeof t[s]!="object")&&(t[s]={}),t=t[s]}const r=e[e.length-1],o=t[r];if(o!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===o)return;if(typeof o=="object"&&typeof n=="object"&&o!==null&&n!==null)Object.assign(o,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function l(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return n;const o=e[r];if(o.endsWith("[]")){const i=o.slice(0,-2);if(i in t){const s=t[i];return Array.isArray(s)?s.map(a=>l(a,e.slice(r+1),n)):n}else return n}else t=t[o]}return t}catch(r){if(r instanceof TypeError)return n;throw r}}function by(t,e){for(const[n,r]of Object.entries(e)){const o=n.split("."),i=r.split("."),s=new Set;let a=-1;for(let u=0;u<o.length;u++)if(o[u]==="*"){a=u;break}if(a!==-1&&i.length>a)for(let u=a;u<i.length;u++){const d=i[u];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&s.add(d)}yl(t,o,i,0,s)}}function yl(t,e,n,r,o){if(r>=e.length||typeof t!="object"||t===null)return;const i=e[r];if(i.endsWith("[]")){const s=i.slice(0,-2),a=t;if(s in a&&Array.isArray(a[s]))for(const u of a[s])yl(u,e,n,r+1,o)}else if(i==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const s=t,a=Object.keys(s).filter(d=>!d.startsWith("_")&&!o.has(d)),u={};for(const d of a)u[d]=s[d];for(const[d,h]of Object.entries(u)){const m=[];for(const p of n.slice(r))p==="*"?m.push(d):m.push(p);c(s,m,h)}for(const d of a)delete s[d]}}else{const s=t;i in s&&yl(s[i],e,n,r+1,o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function bu(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _y(t){const e={},n=l(t,["operationName"]);n!=null&&c(e,["operationName"],n);const r=l(t,["resourceName"]);return r!=null&&c(e,["_url","resourceName"],r),e}function Ay(t){const e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const o=l(t,["done"]);o!=null&&c(e,["done"],o);const i=l(t,["error"]);i!=null&&c(e,["error"],i);const s=l(t,["response","generateVideoResponse"]);return s!=null&&c(e,["response"],ky(s)),e}function Ry(t){const e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const o=l(t,["done"]);o!=null&&c(e,["done"],o);const i=l(t,["error"]);i!=null&&c(e,["error"],i);const s=l(t,["response"]);return s!=null&&c(e,["response"],Py(s)),e}function ky(t){const e={},n=l(t,["generatedSamples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>My(s))),c(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&c(e,["raiMediaFilteredReasons"],o),e}function Py(t){const e={},n=l(t,["videos"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Ly(s))),c(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&c(e,["raiMediaFilteredReasons"],o),e}function My(t){const e={},n=l(t,["video"]);return n!=null&&c(e,["video"],Hy(n)),e}function Ly(t){const e={},n=l(t,["_self"]);return n!=null&&c(e,["video"],By(n)),e}function Oy(t){const e={},n=l(t,["operationName"]);return n!=null&&c(e,["_url","operationName"],n),e}function Dy(t){const e={},n=l(t,["operationName"]);return n!=null&&c(e,["_url","operationName"],n),e}function Uy(t){const e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const o=l(t,["done"]);o!=null&&c(e,["done"],o);const i=l(t,["error"]);i!=null&&c(e,["error"],i);const s=l(t,["response"]);return s!=null&&c(e,["response"],Fy(s)),e}function Fy(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["parent"]);r!=null&&c(e,["parent"],r);const o=l(t,["documentName"]);return o!=null&&c(e,["documentName"],o),e}function $p(t){const e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const o=l(t,["done"]);o!=null&&c(e,["done"],o);const i=l(t,["error"]);i!=null&&c(e,["error"],i);const s=l(t,["response"]);return s!=null&&c(e,["response"],Gy(s)),e}function Gy(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["parent"]);r!=null&&c(e,["parent"],r);const o=l(t,["documentName"]);return o!=null&&c(e,["documentName"],o),e}function Hy(t){const e={},n=l(t,["uri"]);n!=null&&c(e,["uri"],n);const r=l(t,["encodedVideo"]);r!=null&&c(e,["videoBytes"],bu(r));const o=l(t,["encoding"]);return o!=null&&c(e,["mimeType"],o),e}function By(t){const e={},n=l(t,["gcsUri"]);n!=null&&c(e,["uri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&c(e,["videoBytes"],bu(r));const o=l(t,["mimeType"]);return o!=null&&c(e,["mimeType"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Jc;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Jc||(Jc={}));var Xc;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(Xc||(Xc={}));var Zc;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(Zc||(Zc={}));var zn;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(zn||(zn={}));var Qc;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Qc||(Qc={}));var ed;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(ed||(ed={}));var td;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(td||(td={}));var nd;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(nd||(nd={}));var rd;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(rd||(rd={}));var od;(function(t){t.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH",t.MINIMAL="MINIMAL"})(od||(od={}));var Hr;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(Hr||(Hr={}));var id;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(id||(id={}));var Br;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(Br||(Br={}));var sd;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE",t.IMAGE_RECITATION="IMAGE_RECITATION",t.IMAGE_OTHER="IMAGE_OTHER"})(sd||(sd={}));var ad;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(ad||(ad={}));var ld;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(ld||(ld={}));var ud;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(ud||(ud={}));var cd;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(cd||(cd={}));var dd;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(dd||(dd={}));var vs;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(vs||(vs={}));var fd;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(fd||(fd={}));var hd;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(hd||(hd={}));var pd;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(pd||(pd={}));var vl;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(vl||(vl={}));var md;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(md||(md={}));var gd;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",t.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(gd||(gd={}));var yd;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(yd||(yd={}));var vd;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(vd||(vd={}));var xd;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(xd||(xd={}));var Ed;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Ed||(Ed={}));var Td;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(Td||(Td={}));var Sd;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Sd||(Sd={}));var wd;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(wd||(wd={}));var Cd;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(Cd||(Cd={}));var Nd;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Nd||(Nd={}));var Id;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Id||(Id={}));var bd;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(bd||(bd={}));var _d;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(_d||(_d={}));var Ad;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(Ad||(Ad={}));var Rd;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(Rd||(Rd={}));var kd;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(kd||(kd={}));var Pd;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(Pd||(Pd={}));var Md;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Md||(Md={}));var Ld;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(Ld||(Ld={}));var Od;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(Od||(Od={}));var Dd;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(Dd||(Dd={}));var Ud;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Ud||(Ud={}));var Fd;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(Fd||(Fd={}));var Gd;(function(t){t.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",t.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",t.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(Gd||(Gd={}));var Hd;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Hd||(Hd={}));var Bd;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Bd||(Bd={}));var Vd;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Vd||(Vd={}));var jd;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(jd||(jd={}));var zd;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(zd||(zd={}));var $d;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})($d||($d={}));var Vr;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(Vr||(Vr={}));class xl{constructor(e){const n={};for(const r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class Eo{get text(){var e,n,r,o,i,s,a,u;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1;const m=[];for(const p of(u=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)!==null&&u!==void 0?u:[]){for(const[g,E]of Object.entries(p))g!=="text"&&g!=="thought"&&g!=="thoughtSignature"&&(E!==null||E!==void 0)&&m.push(g);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;h=!0,d+=p.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var e,n,r,o,i,s,a,u;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const h=[];for(const m of(u=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)!==null&&u!==void 0?u:[]){for(const[p,g]of Object.entries(m))p!=="inlineData"&&(g!==null||g!==void 0)&&h.push(p);m.inlineData&&typeof m.inlineData.data=="string"&&(d+=atob(m.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,n,r,o,i,s,a,u;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(u=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||u===void 0?void 0:u.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,n,r,o,i,s,a,u,d;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(u=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||u===void 0?void 0:u.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,n,r,o,i,s,a,u,d;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(u=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||u===void 0?void 0:u.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.output}}class Wd{}class qd{}class Vy{}class jy{}class zy{}class $y{}class Yd{}class Kd{}class Jd{}class Wy{}class xs{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new xs;let o;const i=e;return n?o=Ry(i):o=Ay(i),Object.assign(r,o),r}}class Xd{}class Zd{}class Qd{}class ef{}class qy{}class Yy{}class Ky{}class _u{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new _u,i=Uy(e);return Object.assign(r,i),r}}class Jy{}class Xy{}class Zy{}class tf{}class Qy{get text(){var e,n,r;let o="",i=!1;const s=[];for(const a of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[u,d]of Object.entries(a))u!=="text"&&u!=="thought"&&d!==null&&s.push(u);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;i=!0,o+=a.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?o:void 0}get data(){var e,n,r;let o="";const i=[];for(const s of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[a,u]of Object.entries(s))a!=="inlineData"&&u!==null&&i.push(a);s.inlineData&&typeof s.inlineData.data=="string"&&(o+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}}class ev{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Au{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new Au,i=$p(e);return Object.assign(r,i),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function We(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Wp(t,e){const n=We(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function qp(t){return Array.isArray(t)?t.map(e=>Es(e)):[Es(t)]}function Es(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function Yp(t){const e=Es(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Kp(t){const e=Es(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function nf(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Jp(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>nf(e)):[nf(t)]}function El(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function rf(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function of(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function _t(t){if(t==null)throw new Error("ContentUnion is required");return El(t)?t:{role:"user",parts:Jp(t)}}function Ru(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const r=_t(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){const n=_t(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>_t(n)):[_t(e)]}function nn(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(rf(t)||of(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[_t(t)]}const e=[],n=[],r=El(t[0]);for(const o of t){const i=El(o);if(i!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(i)e.push(o);else{if(rf(o)||of(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(o)}}return r||e.push({role:"user",parts:Jp(n)}),e}function tv(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(zn).includes(n[0].toUpperCase())?n[0].toUpperCase():zn.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of n)e.anyOf.push({type:Object.values(zn).includes(r.toUpperCase())?r.toUpperCase():zn.TYPE_UNSPECIFIED})}}function Jr(t){const e={},n=["items"],r=["anyOf"],o=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const i=t.anyOf;i!=null&&i.length==2&&(i[0].type==="null"?(e.nullable=!0,t=i[1]):i[1].type==="null"&&(e.nullable=!0,t=i[0])),t.type instanceof Array&&tv(t.type,e);for(const[s,a]of Object.entries(t))if(a!=null)if(s=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(zn).includes(a.toUpperCase())?a.toUpperCase():zn.TYPE_UNSPECIFIED}else if(n.includes(s))e[s]=Jr(a);else if(r.includes(s)){const u=[];for(const d of a){if(d.type=="null"){e.nullable=!0;continue}u.push(Jr(d))}e[s]=u}else if(o.includes(s)){const u={};for(const[d,h]of Object.entries(a))u[d]=Jr(h);e[s]=u}else{if(s==="additionalProperties")continue;e[s]=a}return e}function ku(t){return Jr(t)}function Pu(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Mu(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function lo(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Jr(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Jr(e.response));return t}function uo(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function nv(t,e,n,r=1){const o=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:o?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:o?`${n}/${e}`:e}function Dn(t,e){if(typeof e!="string")throw new Error("name must be a string");return nv(t,e,"cachedContents")}function Xp(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function ir(t){return bu(t)}function rv(t){return t!=null&&typeof t=="object"&&"name"in t}function ov(t){return t!=null&&typeof t=="object"&&"video"in t}function iv(t){return t!=null&&typeof t=="object"&&"uri"in t}function Zp(t){var e;let n;if(rv(t)&&(n=t.name),!(iv(t)&&(n=t.uri,n===void 0))&&!(ov(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const o=n.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${n}`);n=o[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Qp(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function em(t){for(const e of["models","tunedModels","publisherModels"])if(sv(t,e))return t[e];return[]}function sv(t,e){return t!==null&&typeof t=="object"&&e in t}function av(t,e={}){const n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function lv(t,e={}){const n=[],r=new Set;for(const o of t){const i=o.name;if(r.has(i))throw new Error(`Duplicate function name ${i} found in MCP tools. Please ensure function names are unique.`);r.add(i);const s=av(o,e);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}function tm(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,o=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(o>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function uv(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function nm(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const o=n.inlinedResponses;if(!Array.isArray(o)||o.length===0)return t;let i=!1;for(const s of o){if(typeof s!="object"||s===null)continue;const u=s.response;if(typeof u!="object"||u===null)continue;if(u.embedding!==void 0){i=!0;break}}return i&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function co(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function rm(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cv(t){const e={},n=l(t,["responsesFile"]);n!=null&&c(e,["fileName"],n);const r=l(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>zv(s))),c(e,["inlinedResponses"],i)}const o=l(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),c(e,["inlinedEmbedContentResponses"],i)}return e}function dv(t){const e={},n=l(t,["predictionsFormat"]);n!=null&&c(e,["format"],n);const r=l(t,["gcsDestination","outputUriPrefix"]);r!=null&&c(e,["gcsUri"],r);const o=l(t,["bigqueryDestination","outputUri"]);return o!=null&&c(e,["bigqueryUri"],o),e}function fv(t){const e={},n=l(t,["format"]);n!=null&&c(e,["predictionsFormat"],n);const r=l(t,["gcsUri"]);r!=null&&c(e,["gcsDestination","outputUriPrefix"],r);const o=l(t,["bigqueryUri"]);if(o!=null&&c(e,["bigqueryDestination","outputUri"],o),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(l(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function $i(t){const e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);const r=l(t,["metadata","displayName"]);r!=null&&c(e,["displayName"],r);const o=l(t,["metadata","state"]);o!=null&&c(e,["state"],rm(o));const i=l(t,["metadata","createTime"]);i!=null&&c(e,["createTime"],i);const s=l(t,["metadata","endTime"]);s!=null&&c(e,["endTime"],s);const a=l(t,["metadata","updateTime"]);a!=null&&c(e,["updateTime"],a);const u=l(t,["metadata","model"]);u!=null&&c(e,["model"],u);const d=l(t,["metadata","output"]);return d!=null&&c(e,["dest"],cv(nm(d))),e}function Tl(t){const e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);const r=l(t,["displayName"]);r!=null&&c(e,["displayName"],r);const o=l(t,["state"]);o!=null&&c(e,["state"],rm(o));const i=l(t,["error"]);i!=null&&c(e,["error"],i);const s=l(t,["createTime"]);s!=null&&c(e,["createTime"],s);const a=l(t,["startTime"]);a!=null&&c(e,["startTime"],a);const u=l(t,["endTime"]);u!=null&&c(e,["endTime"],u);const d=l(t,["updateTime"]);d!=null&&c(e,["updateTime"],d);const h=l(t,["model"]);h!=null&&c(e,["model"],h);const m=l(t,["inputConfig"]);m!=null&&c(e,["src"],hv(m));const p=l(t,["outputConfig"]);p!=null&&c(e,["dest"],dv(nm(p)));const g=l(t,["completionStats"]);return g!=null&&c(e,["completionStats"],g),e}function hv(t){const e={},n=l(t,["instancesFormat"]);n!=null&&c(e,["format"],n);const r=l(t,["gcsSource","uris"]);r!=null&&c(e,["gcsUri"],r);const o=l(t,["bigquerySource","inputUri"]);return o!=null&&c(e,["bigqueryUri"],o),e}function pv(t,e){const n={};if(l(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(l(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=l(e,["fileName"]);r!=null&&c(n,["fileName"],r);const o=l(e,["inlinedRequests"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>jv(t,s))),c(n,["requests","requests"],i)}return n}function mv(t){const e={},n=l(t,["format"]);n!=null&&c(e,["instancesFormat"],n);const r=l(t,["gcsUri"]);r!=null&&c(e,["gcsSource","uris"],r);const o=l(t,["bigqueryUri"]);if(o!=null&&c(e,["bigquerySource","inputUri"],o),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function gv(t){const e={},n=l(t,["data"]);if(n!=null&&c(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function yv(t,e){const n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],co(t,r)),n}function vv(t,e){const n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],co(t,r)),n}function xv(t){const e={},n=l(t,["content"]);n!=null&&c(e,["content"],n);const r=l(t,["citationMetadata"]);r!=null&&c(e,["citationMetadata"],Ev(r));const o=l(t,["tokenCount"]);o!=null&&c(e,["tokenCount"],o);const i=l(t,["finishReason"]);i!=null&&c(e,["finishReason"],i);const s=l(t,["avgLogprobs"]);s!=null&&c(e,["avgLogprobs"],s);const a=l(t,["groundingMetadata"]);a!=null&&c(e,["groundingMetadata"],a);const u=l(t,["index"]);u!=null&&c(e,["index"],u);const d=l(t,["logprobsResult"]);d!=null&&c(e,["logprobsResult"],d);const h=l(t,["safetyRatings"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(g=>g)),c(e,["safetyRatings"],p)}const m=l(t,["urlContextMetadata"]);return m!=null&&c(e,["urlContextMetadata"],m),e}function Ev(t){const e={},n=l(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),c(e,["citations"],r)}return e}function om(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>Xv(i))),c(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function Tv(t,e){const n={},r=l(t,["displayName"]);if(e!==void 0&&r!=null&&c(e,["batch","displayName"],r),l(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function Sv(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);const o=l(t,["dest"]);return e!==void 0&&o!=null&&c(e,["outputConfig"],fv(uv(o))),n}function sf(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["src"]);o!=null&&c(n,["batch","inputConfig"],pv(t,tm(t,o)));const i=l(e,["config"]);return i!=null&&Tv(i,n),n}function wv(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["model"],We(t,r));const o=l(e,["src"]);o!=null&&c(n,["inputConfig"],mv(tm(t,o)));const i=l(e,["config"]);return i!=null&&Sv(i,n),n}function Cv(t,e){const n={},r=l(t,["displayName"]);return e!==void 0&&r!=null&&c(e,["batch","displayName"],r),n}function Nv(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["src"]);o!=null&&c(n,["batch","inputConfig"],Pv(t,o));const i=l(e,["config"]);return i!=null&&Cv(i,n),n}function Iv(t,e){const n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],co(t,r)),n}function bv(t,e){const n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],co(t,r)),n}function _v(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["name"]);r!=null&&c(e,["name"],r);const o=l(t,["done"]);o!=null&&c(e,["done"],o);const i=l(t,["error"]);return i!=null&&c(e,["error"],i),e}function Av(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["name"]);r!=null&&c(e,["name"],r);const o=l(t,["done"]);o!=null&&c(e,["done"],o);const i=l(t,["error"]);return i!=null&&c(e,["error"],i),e}function Rv(t,e){const n={},r=l(e,["contents"]);if(r!=null){let i=Ru(t,r);Array.isArray(i)&&(i=i.map(s=>s)),c(n,["requests[]","request","content"],i)}const o=l(e,["config"]);return o!=null&&(c(n,["_self"],kv(o,n)),by(n,{"requests[].*":"requests[].request.*"})),n}function kv(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&c(e,["requests[]","taskType"],r);const o=l(t,["title"]);e!==void 0&&o!=null&&c(e,["requests[]","title"],o);const i=l(t,["outputDimensionality"]);if(e!==void 0&&i!=null&&c(e,["requests[]","outputDimensionality"],i),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Pv(t,e){const n={},r=l(e,["fileName"]);r!=null&&c(n,["file_name"],r);const o=l(e,["inlinedRequests"]);return o!=null&&c(n,["requests"],Rv(t,o)),n}function Mv(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&c(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function Lv(t){const e={},n=l(t,["id"]);n!=null&&c(e,["id"],n);const r=l(t,["args"]);r!=null&&c(e,["args"],r);const o=l(t,["name"]);if(o!=null&&c(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Ov(t){const e={},n=l(t,["mode"]);n!=null&&c(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);if(r!=null&&c(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Dv(t,e,n){const r={},o=l(e,["systemInstruction"]);n!==void 0&&o!=null&&c(n,["systemInstruction"],om(_t(o)));const i=l(e,["temperature"]);i!=null&&c(r,["temperature"],i);const s=l(e,["topP"]);s!=null&&c(r,["topP"],s);const a=l(e,["topK"]);a!=null&&c(r,["topK"],a);const u=l(e,["candidateCount"]);u!=null&&c(r,["candidateCount"],u);const d=l(e,["maxOutputTokens"]);d!=null&&c(r,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&c(r,["stopSequences"],h);const m=l(e,["responseLogprobs"]);m!=null&&c(r,["responseLogprobs"],m);const p=l(e,["logprobs"]);p!=null&&c(r,["logprobs"],p);const g=l(e,["presencePenalty"]);g!=null&&c(r,["presencePenalty"],g);const E=l(e,["frequencyPenalty"]);E!=null&&c(r,["frequencyPenalty"],E);const x=l(e,["seed"]);x!=null&&c(r,["seed"],x);const w=l(e,["responseMimeType"]);w!=null&&c(r,["responseMimeType"],w);const y=l(e,["responseSchema"]);y!=null&&c(r,["responseSchema"],ku(y));const v=l(e,["responseJsonSchema"]);if(v!=null&&c(r,["responseJsonSchema"],v),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const S=l(e,["safetySettings"]);if(n!==void 0&&S!=null){let z=S;Array.isArray(z)&&(z=z.map(C=>Zv(C))),c(n,["safetySettings"],z)}const N=l(e,["tools"]);if(n!==void 0&&N!=null){let z=uo(N);Array.isArray(z)&&(z=z.map(C=>ex(lo(C)))),c(n,["tools"],z)}const I=l(e,["toolConfig"]);if(n!==void 0&&I!=null&&c(n,["toolConfig"],Qv(I)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const L=l(e,["cachedContent"]);n!==void 0&&L!=null&&c(n,["cachedContent"],Dn(t,L));const P=l(e,["responseModalities"]);P!=null&&c(r,["responseModalities"],P);const D=l(e,["mediaResolution"]);D!=null&&c(r,["mediaResolution"],D);const M=l(e,["speechConfig"]);if(M!=null&&c(r,["speechConfig"],Pu(M)),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const j=l(e,["thinkingConfig"]);j!=null&&c(r,["thinkingConfig"],j);const Q=l(e,["imageConfig"]);Q!=null&&c(r,["imageConfig"],Vv(Q));const _=l(e,["enableEnhancedCivicAnswers"]);return _!=null&&c(r,["enableEnhancedCivicAnswers"],_),r}function Uv(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(d=>xv(d))),c(e,["candidates"],u)}const o=l(t,["modelVersion"]);o!=null&&c(e,["modelVersion"],o);const i=l(t,["promptFeedback"]);i!=null&&c(e,["promptFeedback"],i);const s=l(t,["responseId"]);s!=null&&c(e,["responseId"],s);const a=l(t,["usageMetadata"]);return a!=null&&c(e,["usageMetadata"],a),e}function Fv(t,e){const n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],co(t,r)),n}function Gv(t,e){const n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],co(t,r)),n}function Hv(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&c(e,["enableWidget"],n),e}function Bv(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&c(e,["timeRangeFilter"],n),e}function Vv(t){const e={},n=l(t,["aspectRatio"]);n!=null&&c(e,["aspectRatio"],n);const r=l(t,["imageSize"]);if(r!=null&&c(e,["imageSize"],r),l(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(l(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function jv(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["request","model"],We(t,r));const o=l(e,["contents"]);if(o!=null){let a=nn(o);Array.isArray(a)&&(a=a.map(u=>om(u))),c(n,["request","contents"],a)}const i=l(e,["metadata"]);i!=null&&c(n,["metadata"],i);const s=l(e,["config"]);return s!=null&&c(n,["request","generationConfig"],Dv(t,s,l(n,["request"],{}))),n}function zv(t){const e={},n=l(t,["response"]);n!=null&&c(e,["response"],Uv(n));const r=l(t,["error"]);return r!=null&&c(e,["error"],r),e}function $v(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);if(e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),l(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function Wv(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);e!==void 0&&o!=null&&c(e,["_query","pageToken"],o);const i=l(t,["filter"]);return e!==void 0&&i!=null&&c(e,["_query","filter"],i),n}function qv(t){const e={},n=l(t,["config"]);return n!=null&&$v(n,e),e}function Yv(t){const e={},n=l(t,["config"]);return n!=null&&Wv(n,e),e}function Kv(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const o=l(t,["operations"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>$i(s))),c(e,["batchJobs"],i)}return e}function Jv(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const o=l(t,["batchPredictionJobs"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>Tl(s))),c(e,["batchJobs"],i)}return e}function Xv(t){const e={},n=l(t,["mediaResolution"]);n!=null&&c(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&c(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&c(e,["fileData"],Mv(i));const s=l(t,["functionCall"]);s!=null&&c(e,["functionCall"],Lv(s));const a=l(t,["functionResponse"]);a!=null&&c(e,["functionResponse"],a);const u=l(t,["inlineData"]);u!=null&&c(e,["inlineData"],gv(u));const d=l(t,["text"]);d!=null&&c(e,["text"],d);const h=l(t,["thought"]);h!=null&&c(e,["thought"],h);const m=l(t,["thoughtSignature"]);m!=null&&c(e,["thoughtSignature"],m);const p=l(t,["videoMetadata"]);return p!=null&&c(e,["videoMetadata"],p),e}function Zv(t){const e={},n=l(t,["category"]);if(n!=null&&c(e,["category"],n),l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=l(t,["threshold"]);return r!=null&&c(e,["threshold"],r),e}function Qv(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&c(e,["functionCallingConfig"],Ov(n));const r=l(t,["retrievalConfig"]);return r!=null&&c(e,["retrievalConfig"],r),e}function ex(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&c(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&c(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&c(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&c(e,["googleMaps"],Hv(a));const u=l(t,["googleSearch"]);u!=null&&c(e,["googleSearch"],Bv(u));const d=l(t,["urlContext"]);return d!=null&&c(e,["urlContext"],d),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Mn;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(Mn||(Mn={}));class Sr{constructor(e,n,r,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,o)}init(e,n,r){var o,i;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=n.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(i=(o=s.config)===null||o===void 0?void 0:o.pageSize)!==null&&i!==void 0?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tx extends On{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Sr(Mn.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)}}createInlinedGenerateContentRequest(e){const n=sf(this.apiClient,e),r=n._url,o=Te("{model}:batchGenerateContent",r),a=n.batch.inputConfig.requests,u=a.requests,d=[];for(const h of u){const m=Object.assign({},h);if(m.systemInstruction){const p=m.systemInstruction;delete m.systemInstruction;const g=m.request;g.systemInstruction=p,m.request=g}d.push(m)}return a.requests=d,delete n.config,delete n._url,delete n._query,{path:o,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const r=n?Object.assign({},n):{},o=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${o}`),r.dest===void 0){const i=this.getGcsUri(e),s=this.getBigqueryUri(e);if(i)i.endsWith(".jsonl")?r.dest=`${i.slice(0,-6)}/dest`:r.dest=`${i}_dest_${o}`;else if(s)r.dest=`${s}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=wv(this.apiClient,e);return a=Te("batchPredictionJobs",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Tl(h))}else{const d=sf(this.apiClient,e);return a=Te("{model}:batchGenerateContent",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>$i(h))}}async createEmbeddingsInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Nv(this.apiClient,e);return i=Te("{model}:asyncBatchEmbedContent",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>$i(u))}}async get(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=Gv(this.apiClient,e);return a=Te("batchPredictionJobs/{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Tl(h))}else{const d=Fv(this.apiClient,e);return a=Te("batches/{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>$i(h))}}async cancel(e){var n,r,o,i;let s="",a={};if(this.apiClient.isVertexAI()){const u=vv(this.apiClient,e);s=Te("batchPredictionJobs/{name}:cancel",u._url),a=u._query,delete u._url,delete u._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const u=yv(this.apiClient,e);s=Te("batches/{name}:cancel",u._url),a=u._query,delete u._url,delete u._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=Yv(e);return a=Te("batchPredictionJobs",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=Jv(h),p=new tf;return Object.assign(p,m),p})}else{const d=qv(e);return a=Te("batches",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=Kv(h),p=new tf;return Object.assign(p,m),p})}}async delete(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=bv(this.apiClient,e);return a=Te("batchPredictionJobs/{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>Av(h))}else{const d=Iv(this.apiClient,e);return a=Te("batches/{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>_v(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function nx(t){const e={},n=l(t,["data"]);if(n!=null&&c(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function af(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>Nx(i))),c(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function rx(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);const o=l(t,["expireTime"]);e!==void 0&&o!=null&&c(e,["expireTime"],o);const i=l(t,["displayName"]);e!==void 0&&i!=null&&c(e,["displayName"],i);const s=l(t,["contents"]);if(e!==void 0&&s!=null){let h=nn(s);Array.isArray(h)&&(h=h.map(m=>af(m))),c(e,["contents"],h)}const a=l(t,["systemInstruction"]);e!==void 0&&a!=null&&c(e,["systemInstruction"],af(_t(a)));const u=l(t,["tools"]);if(e!==void 0&&u!=null){let h=u;Array.isArray(h)&&(h=h.map(m=>bx(m))),c(e,["tools"],h)}const d=l(t,["toolConfig"]);if(e!==void 0&&d!=null&&c(e,["toolConfig"],Ix(d)),l(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function ox(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);const o=l(t,["expireTime"]);e!==void 0&&o!=null&&c(e,["expireTime"],o);const i=l(t,["displayName"]);e!==void 0&&i!=null&&c(e,["displayName"],i);const s=l(t,["contents"]);if(e!==void 0&&s!=null){let m=nn(s);Array.isArray(m)&&(m=m.map(p=>p)),c(e,["contents"],m)}const a=l(t,["systemInstruction"]);e!==void 0&&a!=null&&c(e,["systemInstruction"],_t(a));const u=l(t,["tools"]);if(e!==void 0&&u!=null){let m=u;Array.isArray(m)&&(m=m.map(p=>_x(p))),c(e,["tools"],m)}const d=l(t,["toolConfig"]);e!==void 0&&d!=null&&c(e,["toolConfig"],d);const h=l(t,["kmsKeyName"]);return e!==void 0&&h!=null&&c(e,["encryption_spec","kmsKeyName"],h),n}function ix(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["model"],Wp(t,r));const o=l(e,["config"]);return o!=null&&rx(o,n),n}function sx(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["model"],Wp(t,r));const o=l(e,["config"]);return o!=null&&ox(o,n),n}function ax(t,e){const n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],Dn(t,r)),n}function lx(t,e){const n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],Dn(t,r)),n}function ux(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function cx(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function dx(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&c(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function fx(t){const e={},n=l(t,["id"]);n!=null&&c(e,["id"],n);const r=l(t,["args"]);r!=null&&c(e,["args"],r);const o=l(t,["name"]);if(o!=null&&c(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function hx(t){const e={},n=l(t,["mode"]);n!=null&&c(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);if(r!=null&&c(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function px(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&c(e,["description"],n);const r=l(t,["name"]);r!=null&&c(e,["name"],r);const o=l(t,["parameters"]);o!=null&&c(e,["parameters"],o);const i=l(t,["parametersJsonSchema"]);i!=null&&c(e,["parametersJsonSchema"],i);const s=l(t,["response"]);s!=null&&c(e,["response"],s);const a=l(t,["responseJsonSchema"]);return a!=null&&c(e,["responseJsonSchema"],a),e}function mx(t,e){const n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],Dn(t,r)),n}function gx(t,e){const n={},r=l(e,["name"]);return r!=null&&c(n,["_url","name"],Dn(t,r)),n}function yx(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&c(e,["enableWidget"],n),e}function vx(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&c(e,["timeRangeFilter"],n),e}function xx(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),n}function Ex(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),n}function Tx(t){const e={},n=l(t,["config"]);return n!=null&&xx(n,e),e}function Sx(t){const e={},n=l(t,["config"]);return n!=null&&Ex(n,e),e}function wx(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const o=l(t,["cachedContents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),c(e,["cachedContents"],i)}return e}function Cx(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const o=l(t,["cachedContents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),c(e,["cachedContents"],i)}return e}function Nx(t){const e={},n=l(t,["mediaResolution"]);n!=null&&c(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&c(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&c(e,["fileData"],dx(i));const s=l(t,["functionCall"]);s!=null&&c(e,["functionCall"],fx(s));const a=l(t,["functionResponse"]);a!=null&&c(e,["functionResponse"],a);const u=l(t,["inlineData"]);u!=null&&c(e,["inlineData"],nx(u));const d=l(t,["text"]);d!=null&&c(e,["text"],d);const h=l(t,["thought"]);h!=null&&c(e,["thought"],h);const m=l(t,["thoughtSignature"]);m!=null&&c(e,["thoughtSignature"],m);const p=l(t,["videoMetadata"]);return p!=null&&c(e,["videoMetadata"],p),e}function Ix(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&c(e,["functionCallingConfig"],hx(n));const r=l(t,["retrievalConfig"]);return r!=null&&c(e,["retrievalConfig"],r),e}function bx(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&c(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&c(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&c(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&c(e,["googleMaps"],yx(a));const u=l(t,["googleSearch"]);u!=null&&c(e,["googleSearch"],vx(u));const d=l(t,["urlContext"]);return d!=null&&c(e,["urlContext"],d),e}function _x(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let m=n;Array.isArray(m)&&(m=m.map(p=>px(p))),c(e,["functionDeclarations"],m)}const r=l(t,["retrieval"]);r!=null&&c(e,["retrieval"],r);const o=l(t,["googleSearchRetrieval"]);o!=null&&c(e,["googleSearchRetrieval"],o);const i=l(t,["computerUse"]);if(i!=null&&c(e,["computerUse"],i),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=l(t,["codeExecution"]);s!=null&&c(e,["codeExecution"],s);const a=l(t,["enterpriseWebSearch"]);a!=null&&c(e,["enterpriseWebSearch"],a);const u=l(t,["googleMaps"]);u!=null&&c(e,["googleMaps"],u);const d=l(t,["googleSearch"]);d!=null&&c(e,["googleSearch"],d);const h=l(t,["urlContext"]);return h!=null&&c(e,["urlContext"],h),e}function Ax(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);const o=l(t,["expireTime"]);return e!==void 0&&o!=null&&c(e,["expireTime"],o),n}function Rx(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);const o=l(t,["expireTime"]);return e!==void 0&&o!=null&&c(e,["expireTime"],o),n}function kx(t,e){const n={},r=l(e,["name"]);r!=null&&c(n,["_url","name"],Dn(t,r));const o=l(e,["config"]);return o!=null&&Ax(o,n),n}function Px(t,e){const n={},r=l(e,["name"]);r!=null&&c(n,["_url","name"],Dn(t,r));const o=l(e,["config"]);return o!=null&&Rx(o,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Mx extends On{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Sr(Mn.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=sx(this.apiClient,e);return a=Te("cachedContents",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=ix(this.apiClient,e);return a=Te("cachedContents",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async get(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=gx(this.apiClient,e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=mx(this.apiClient,e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async delete(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=lx(this.apiClient,e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=cx(h),p=new Qd;return Object.assign(p,m),p})}else{const d=ax(this.apiClient,e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=ux(h),p=new Qd;return Object.assign(p,m),p})}}async update(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=Px(this.apiClient,e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=kx(this.apiClient,e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async listInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=Sx(e);return a=Te("cachedContents",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=Cx(h),p=new ef;return Object.assign(p,m),p})}else{const d=Tx(e);return a=Te("cachedContents",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=wx(h),p=new ef;return Object.assign(p,m),p})}}}function Ts(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function lf(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Oe(t){return this instanceof Oe?(this.v=t,this):new Oe(t)}function hn(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(g){return function(E){return Promise.resolve(E).then(g,m)}}function a(g,E){r[g]&&(o[g]=function(x){return new Promise(function(w,y){i.push([g,x,w,y])>1||u(g,x)})},E&&(o[g]=E(o[g])))}function u(g,E){try{d(r[g](E))}catch(x){p(i[0][3],x)}}function d(g){g.value instanceof Oe?Promise.resolve(g.value.v).then(h,m):p(i[0][2],g)}function h(g){u("next",g)}function m(g){u("throw",g)}function p(g,E){g(E),i.shift(),i.length&&u(i[0][0],i[0][1])}}function pn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof lf=="function"?lf(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=t[i]&&function(s){return new Promise(function(a,u){s=t[i](s),o(a,u,s.done,s.value)})}}function o(i,s,a,u){Promise.resolve(u).then(function(d){i({value:d,done:a})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Lx(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:im(n)}function im(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function Ox(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function uf(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{const o=[];let i=!0;for(;r<n&&t[r].role==="model";)o.push(t[r]),i&&!im(t[r])&&(i=!1),r++;i?e.push(...o):e.pop()}return e}class Dx{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new Ux(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Ux{constructor(e,n,r,o={},i=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=o,this.history=i,this.sendPromise=Promise.resolve(),Ox(i)}async sendMessage(e){var n;await this.sendPromise;const r=_t(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var i,s,a;const u=await o,d=(s=(i=u.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content,h=u.automaticFunctionCallingHistory,m=this.getHistory(!0).length;let p=[];h!=null&&(p=(a=h.slice(m))!==null&&a!==void 0?a:[]);const g=d?[d]:[];this.recordHistory(r,g,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var n;await this.sendPromise;const r=_t(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});const i=await o;return this.processStreamResponse(i,r)}getHistory(e=!1){const n=e?uf(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){return hn(this,arguments,function*(){var o,i,s,a,u,d;const h=[];try{for(var m=!0,p=pn(e),g;g=yield Oe(p.next()),o=g.done,!o;m=!0){a=g.value,m=!1;const E=a;if(Lx(E)){const x=(d=(u=E.candidates)===null||u===void 0?void 0:u[0])===null||d===void 0?void 0:d.content;x!==void 0&&h.push(x)}yield yield Oe(E)}}catch(E){i={error:E}}finally{try{!m&&!o&&(s=p.return)&&(yield Oe(s.call(p)))}finally{if(i)throw i.error}}this.recordHistory(n,h)})}recordHistory(e,n,r){let o=[];n.length>0&&n.every(i=>i.role!==void 0)?o=n:o.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...uf(r)):this.history.push(e),this.history.push(...o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Bs extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Bs.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Fx(t){const e={},n=l(t,["file"]);return n!=null&&c(e,["file"],n),e}function Gx(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function Hx(t){const e={},n=l(t,["name"]);return n!=null&&c(e,["_url","file"],Zp(n)),e}function Bx(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function Vx(t){const e={},n=l(t,["name"]);return n!=null&&c(e,["_url","file"],Zp(n)),e}function jx(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),n}function zx(t){const e={},n=l(t,["config"]);return n!=null&&jx(n,e),e}function $x(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const o=l(t,["files"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),c(e,["files"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Wx extends On{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Sr(Mn.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=zx(e);return i=Te("files",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>{const d=$x(u),h=new Jy;return Object.assign(h,d),h})}}async createInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Fx(e);return i=Te("upload/v1beta/files",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const d=Gx(u),h=new Xy;return Object.assign(h,d),h})}}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Vx(e);return i=Te("files/{file}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>u)}}async delete(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Hx(e);return i=Te("files/{file}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>{const d=Bx(u),h=new Zy;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Wi(t){const e={},n=l(t,["data"]);if(n!=null&&c(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function qx(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>uE(i))),c(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function Yx(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&c(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function Kx(t){const e={},n=l(t,["id"]);n!=null&&c(e,["id"],n);const r=l(t,["args"]);r!=null&&c(e,["args"],r);const o=l(t,["name"]);if(o!=null&&c(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Jx(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&c(e,["description"],n);const r=l(t,["name"]);r!=null&&c(e,["name"],r);const o=l(t,["parameters"]);o!=null&&c(e,["parameters"],o);const i=l(t,["parametersJsonSchema"]);i!=null&&c(e,["parametersJsonSchema"],i);const s=l(t,["response"]);s!=null&&c(e,["response"],s);const a=l(t,["responseJsonSchema"]);return a!=null&&c(e,["responseJsonSchema"],a),e}function Xx(t){const e={},n=l(t,["modelSelectionConfig"]);n!=null&&c(e,["modelConfig"],n);const r=l(t,["responseJsonSchema"]);r!=null&&c(e,["responseJsonSchema"],r);const o=l(t,["audioTimestamp"]);o!=null&&c(e,["audioTimestamp"],o);const i=l(t,["candidateCount"]);i!=null&&c(e,["candidateCount"],i);const s=l(t,["enableAffectiveDialog"]);s!=null&&c(e,["enableAffectiveDialog"],s);const a=l(t,["frequencyPenalty"]);a!=null&&c(e,["frequencyPenalty"],a);const u=l(t,["logprobs"]);u!=null&&c(e,["logprobs"],u);const d=l(t,["maxOutputTokens"]);d!=null&&c(e,["maxOutputTokens"],d);const h=l(t,["mediaResolution"]);h!=null&&c(e,["mediaResolution"],h);const m=l(t,["presencePenalty"]);m!=null&&c(e,["presencePenalty"],m);const p=l(t,["responseLogprobs"]);p!=null&&c(e,["responseLogprobs"],p);const g=l(t,["responseMimeType"]);g!=null&&c(e,["responseMimeType"],g);const E=l(t,["responseModalities"]);E!=null&&c(e,["responseModalities"],E);const x=l(t,["responseSchema"]);x!=null&&c(e,["responseSchema"],x);const w=l(t,["routingConfig"]);w!=null&&c(e,["routingConfig"],w);const y=l(t,["seed"]);y!=null&&c(e,["seed"],y);const v=l(t,["speechConfig"]);v!=null&&c(e,["speechConfig"],v);const S=l(t,["stopSequences"]);S!=null&&c(e,["stopSequences"],S);const N=l(t,["temperature"]);N!=null&&c(e,["temperature"],N);const I=l(t,["thinkingConfig"]);I!=null&&c(e,["thinkingConfig"],I);const L=l(t,["topK"]);L!=null&&c(e,["topK"],L);const P=l(t,["topP"]);if(P!=null&&c(e,["topP"],P),l(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Zx(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&c(e,["enableWidget"],n),e}function Qx(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&c(e,["timeRangeFilter"],n),e}function eE(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],r);const o=l(t,["responseModalities"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","responseModalities"],o);const i=l(t,["temperature"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","temperature"],i);const s=l(t,["topP"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","topP"],s);const a=l(t,["topK"]);e!==void 0&&a!=null&&c(e,["setup","generationConfig","topK"],a);const u=l(t,["maxOutputTokens"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","maxOutputTokens"],u);const d=l(t,["mediaResolution"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","mediaResolution"],d);const h=l(t,["seed"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","seed"],h);const m=l(t,["speechConfig"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","speechConfig"],Mu(m));const p=l(t,["thinkingConfig"]);e!==void 0&&p!=null&&c(e,["setup","generationConfig","thinkingConfig"],p);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],g);const E=l(t,["systemInstruction"]);e!==void 0&&E!=null&&c(e,["setup","systemInstruction"],qx(_t(E)));const x=l(t,["tools"]);if(e!==void 0&&x!=null){let L=uo(x);Array.isArray(L)&&(L=L.map(P=>dE(lo(P)))),c(e,["setup","tools"],L)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&c(e,["setup","sessionResumption"],cE(w));const y=l(t,["inputAudioTranscription"]);e!==void 0&&y!=null&&c(e,["setup","inputAudioTranscription"],y);const v=l(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&c(e,["setup","outputAudioTranscription"],v);const S=l(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&c(e,["setup","realtimeInputConfig"],S);const N=l(t,["contextWindowCompression"]);e!==void 0&&N!=null&&c(e,["setup","contextWindowCompression"],N);const I=l(t,["proactivity"]);if(e!==void 0&&I!=null&&c(e,["setup","proactivity"],I),l(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function tE(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],Xx(r));const o=l(t,["responseModalities"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","responseModalities"],o);const i=l(t,["temperature"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","temperature"],i);const s=l(t,["topP"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","topP"],s);const a=l(t,["topK"]);e!==void 0&&a!=null&&c(e,["setup","generationConfig","topK"],a);const u=l(t,["maxOutputTokens"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","maxOutputTokens"],u);const d=l(t,["mediaResolution"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","mediaResolution"],d);const h=l(t,["seed"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","seed"],h);const m=l(t,["speechConfig"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","speechConfig"],Mu(m));const p=l(t,["thinkingConfig"]);e!==void 0&&p!=null&&c(e,["setup","generationConfig","thinkingConfig"],p);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],g);const E=l(t,["systemInstruction"]);e!==void 0&&E!=null&&c(e,["setup","systemInstruction"],_t(E));const x=l(t,["tools"]);if(e!==void 0&&x!=null){let P=uo(x);Array.isArray(P)&&(P=P.map(D=>fE(lo(D)))),c(e,["setup","tools"],P)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&c(e,["setup","sessionResumption"],w);const y=l(t,["inputAudioTranscription"]);e!==void 0&&y!=null&&c(e,["setup","inputAudioTranscription"],y);const v=l(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&c(e,["setup","outputAudioTranscription"],v);const S=l(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&c(e,["setup","realtimeInputConfig"],S);const N=l(t,["contextWindowCompression"]);e!==void 0&&N!=null&&c(e,["setup","contextWindowCompression"],N);const I=l(t,["proactivity"]);e!==void 0&&I!=null&&c(e,["setup","proactivity"],I);const L=l(t,["explicitVadSignal"]);return e!==void 0&&L!=null&&c(e,["setup","explicitVadSignal"],L),n}function nE(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["setup","model"],We(t,r));const o=l(e,["config"]);return o!=null&&c(n,["config"],eE(o,n)),n}function rE(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["setup","model"],We(t,r));const o=l(e,["config"]);return o!=null&&c(n,["config"],tE(o,n)),n}function oE(t){const e={},n=l(t,["musicGenerationConfig"]);return n!=null&&c(e,["musicGenerationConfig"],n),e}function iE(t){const e={},n=l(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),c(e,["weightedPrompts"],r)}return e}function sE(t){const e={},n=l(t,["media"]);if(n!=null){let d=qp(n);Array.isArray(d)&&(d=d.map(h=>Wi(h))),c(e,["mediaChunks"],d)}const r=l(t,["audio"]);r!=null&&c(e,["audio"],Wi(Kp(r)));const o=l(t,["audioStreamEnd"]);o!=null&&c(e,["audioStreamEnd"],o);const i=l(t,["video"]);i!=null&&c(e,["video"],Wi(Yp(i)));const s=l(t,["text"]);s!=null&&c(e,["text"],s);const a=l(t,["activityStart"]);a!=null&&c(e,["activityStart"],a);const u=l(t,["activityEnd"]);return u!=null&&c(e,["activityEnd"],u),e}function aE(t){const e={},n=l(t,["media"]);if(n!=null){let d=qp(n);Array.isArray(d)&&(d=d.map(h=>h)),c(e,["mediaChunks"],d)}const r=l(t,["audio"]);r!=null&&c(e,["audio"],Kp(r));const o=l(t,["audioStreamEnd"]);o!=null&&c(e,["audioStreamEnd"],o);const i=l(t,["video"]);i!=null&&c(e,["video"],Yp(i));const s=l(t,["text"]);s!=null&&c(e,["text"],s);const a=l(t,["activityStart"]);a!=null&&c(e,["activityStart"],a);const u=l(t,["activityEnd"]);return u!=null&&c(e,["activityEnd"],u),e}function lE(t){const e={},n=l(t,["setupComplete"]);n!=null&&c(e,["setupComplete"],n);const r=l(t,["serverContent"]);r!=null&&c(e,["serverContent"],r);const o=l(t,["toolCall"]);o!=null&&c(e,["toolCall"],o);const i=l(t,["toolCallCancellation"]);i!=null&&c(e,["toolCallCancellation"],i);const s=l(t,["usageMetadata"]);s!=null&&c(e,["usageMetadata"],hE(s));const a=l(t,["goAway"]);a!=null&&c(e,["goAway"],a);const u=l(t,["sessionResumptionUpdate"]);u!=null&&c(e,["sessionResumptionUpdate"],u);const d=l(t,["voiceActivityDetectionSignal"]);return d!=null&&c(e,["voiceActivityDetectionSignal"],d),e}function uE(t){const e={},n=l(t,["mediaResolution"]);n!=null&&c(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&c(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&c(e,["fileData"],Yx(i));const s=l(t,["functionCall"]);s!=null&&c(e,["functionCall"],Kx(s));const a=l(t,["functionResponse"]);a!=null&&c(e,["functionResponse"],a);const u=l(t,["inlineData"]);u!=null&&c(e,["inlineData"],Wi(u));const d=l(t,["text"]);d!=null&&c(e,["text"],d);const h=l(t,["thought"]);h!=null&&c(e,["thought"],h);const m=l(t,["thoughtSignature"]);m!=null&&c(e,["thoughtSignature"],m);const p=l(t,["videoMetadata"]);return p!=null&&c(e,["videoMetadata"],p),e}function cE(t){const e={},n=l(t,["handle"]);if(n!=null&&c(e,["handle"],n),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function dE(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&c(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&c(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&c(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&c(e,["googleMaps"],Zx(a));const u=l(t,["googleSearch"]);u!=null&&c(e,["googleSearch"],Qx(u));const d=l(t,["urlContext"]);return d!=null&&c(e,["urlContext"],d),e}function fE(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let m=n;Array.isArray(m)&&(m=m.map(p=>Jx(p))),c(e,["functionDeclarations"],m)}const r=l(t,["retrieval"]);r!=null&&c(e,["retrieval"],r);const o=l(t,["googleSearchRetrieval"]);o!=null&&c(e,["googleSearchRetrieval"],o);const i=l(t,["computerUse"]);if(i!=null&&c(e,["computerUse"],i),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=l(t,["codeExecution"]);s!=null&&c(e,["codeExecution"],s);const a=l(t,["enterpriseWebSearch"]);a!=null&&c(e,["enterpriseWebSearch"],a);const u=l(t,["googleMaps"]);u!=null&&c(e,["googleMaps"],u);const d=l(t,["googleSearch"]);d!=null&&c(e,["googleSearch"],d);const h=l(t,["urlContext"]);return h!=null&&c(e,["urlContext"],h),e}function hE(t){const e={},n=l(t,["promptTokenCount"]);n!=null&&c(e,["promptTokenCount"],n);const r=l(t,["cachedContentTokenCount"]);r!=null&&c(e,["cachedContentTokenCount"],r);const o=l(t,["candidatesTokenCount"]);o!=null&&c(e,["responseTokenCount"],o);const i=l(t,["toolUsePromptTokenCount"]);i!=null&&c(e,["toolUsePromptTokenCount"],i);const s=l(t,["thoughtsTokenCount"]);s!=null&&c(e,["thoughtsTokenCount"],s);const a=l(t,["totalTokenCount"]);a!=null&&c(e,["totalTokenCount"],a);const u=l(t,["promptTokensDetails"]);if(u!=null){let g=u;Array.isArray(g)&&(g=g.map(E=>E)),c(e,["promptTokensDetails"],g)}const d=l(t,["cacheTokensDetails"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(E=>E)),c(e,["cacheTokensDetails"],g)}const h=l(t,["candidatesTokensDetails"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(E=>E)),c(e,["responseTokensDetails"],g)}const m=l(t,["toolUsePromptTokensDetails"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(E=>E)),c(e,["toolUsePromptTokensDetails"],g)}const p=l(t,["trafficType"]);return p!=null&&c(e,["trafficType"],p),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pE(t){const e={},n=l(t,["data"]);if(n!=null&&c(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function mE(t){const e={},n=l(t,["content"]);n!=null&&c(e,["content"],n);const r=l(t,["citationMetadata"]);r!=null&&c(e,["citationMetadata"],gE(r));const o=l(t,["tokenCount"]);o!=null&&c(e,["tokenCount"],o);const i=l(t,["finishReason"]);i!=null&&c(e,["finishReason"],i);const s=l(t,["avgLogprobs"]);s!=null&&c(e,["avgLogprobs"],s);const a=l(t,["groundingMetadata"]);a!=null&&c(e,["groundingMetadata"],a);const u=l(t,["index"]);u!=null&&c(e,["index"],u);const d=l(t,["logprobsResult"]);d!=null&&c(e,["logprobsResult"],d);const h=l(t,["safetyRatings"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(g=>g)),c(e,["safetyRatings"],p)}const m=l(t,["urlContextMetadata"]);return m!=null&&c(e,["urlContextMetadata"],m),e}function gE(t){const e={},n=l(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),c(e,["citations"],r)}return e}function yE(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["contents"]);if(o!=null){let i=nn(o);Array.isArray(i)&&(i=i.map(s=>s)),c(n,["contents"],i)}return n}function vE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["tokensInfo"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),c(e,["tokensInfo"],o)}return e}function xE(t){const e={},n=l(t,["values"]);n!=null&&c(e,["values"],n);const r=l(t,["statistics"]);return r!=null&&c(e,["statistics"],EE(r)),e}function EE(t){const e={},n=l(t,["truncated"]);n!=null&&c(e,["truncated"],n);const r=l(t,["token_count"]);return r!=null&&c(e,["tokenCount"],r),e}function Vs(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>AT(i))),c(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function TE(t){const e={},n=l(t,["controlType"]);n!=null&&c(e,["controlType"],n);const r=l(t,["enableControlImageComputation"]);return r!=null&&c(e,["computeControl"],r),e}function SE(t){const e={};if(l(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(l(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(l(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function wE(t,e){const n={},r=l(t,["systemInstruction"]);e!==void 0&&r!=null&&c(e,["systemInstruction"],_t(r));const o=l(t,["tools"]);if(e!==void 0&&o!=null){let s=o;Array.isArray(s)&&(s=s.map(a=>um(a))),c(e,["tools"],s)}const i=l(t,["generationConfig"]);return e!==void 0&&i!=null&&c(e,["generationConfig"],pT(i)),n}function CE(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["contents"]);if(o!=null){let s=nn(o);Array.isArray(s)&&(s=s.map(a=>Vs(a))),c(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&SE(i),n}function NE(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["contents"]);if(o!=null){let s=nn(o);Array.isArray(s)&&(s=s.map(a=>a)),c(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&wE(i,n),n}function IE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["totalTokens"]);r!=null&&c(e,["totalTokens"],r);const o=l(t,["cachedContentTokenCount"]);return o!=null&&c(e,["cachedContentTokenCount"],o),e}function bE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["totalTokens"]);return r!=null&&c(e,["totalTokens"],r),e}function _E(t,e){const n={},r=l(e,["model"]);return r!=null&&c(n,["_url","name"],We(t,r)),n}function AE(t,e){const n={},r=l(e,["model"]);return r!=null&&c(n,["_url","name"],We(t,r)),n}function RE(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function kE(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}function PE(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);const o=l(t,["negativePrompt"]);e!==void 0&&o!=null&&c(e,["parameters","negativePrompt"],o);const i=l(t,["numberOfImages"]);e!==void 0&&i!=null&&c(e,["parameters","sampleCount"],i);const s=l(t,["aspectRatio"]);e!==void 0&&s!=null&&c(e,["parameters","aspectRatio"],s);const a=l(t,["guidanceScale"]);e!==void 0&&a!=null&&c(e,["parameters","guidanceScale"],a);const u=l(t,["seed"]);e!==void 0&&u!=null&&c(e,["parameters","seed"],u);const d=l(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&c(e,["parameters","safetySetting"],d);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&c(e,["parameters","personGeneration"],h);const m=l(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&c(e,["parameters","includeSafetyAttributes"],m);const p=l(t,["includeRaiReason"]);e!==void 0&&p!=null&&c(e,["parameters","includeRaiReason"],p);const g=l(t,["language"]);e!==void 0&&g!=null&&c(e,["parameters","language"],g);const E=l(t,["outputMimeType"]);e!==void 0&&E!=null&&c(e,["parameters","outputOptions","mimeType"],E);const x=l(t,["outputCompressionQuality"]);e!==void 0&&x!=null&&c(e,["parameters","outputOptions","compressionQuality"],x);const w=l(t,["addWatermark"]);e!==void 0&&w!=null&&c(e,["parameters","addWatermark"],w);const y=l(t,["labels"]);e!==void 0&&y!=null&&c(e,["labels"],y);const v=l(t,["editMode"]);e!==void 0&&v!=null&&c(e,["parameters","editMode"],v);const S=l(t,["baseSteps"]);return e!==void 0&&S!=null&&c(e,["parameters","editConfig","baseSteps"],S),n}function ME(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["prompt"]);o!=null&&c(n,["instances[0]","prompt"],o);const i=l(e,["referenceImages"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>OT(u))),c(n,["instances[0]","referenceImages"],a)}const s=l(e,["config"]);return s!=null&&PE(s,n),n}function LE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>js(i))),c(e,["generatedImages"],o)}return e}function OE(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&c(e,["requests[]","taskType"],r);const o=l(t,["title"]);e!==void 0&&o!=null&&c(e,["requests[]","title"],o);const i=l(t,["outputDimensionality"]);if(e!==void 0&&i!=null&&c(e,["requests[]","outputDimensionality"],i),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function DE(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&c(e,["instances[]","task_type"],r);const o=l(t,["title"]);e!==void 0&&o!=null&&c(e,["instances[]","title"],o);const i=l(t,["outputDimensionality"]);e!==void 0&&i!=null&&c(e,["parameters","outputDimensionality"],i);const s=l(t,["mimeType"]);e!==void 0&&s!=null&&c(e,["instances[]","mimeType"],s);const a=l(t,["autoTruncate"]);return e!==void 0&&a!=null&&c(e,["parameters","autoTruncate"],a),n}function UE(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["contents"]);if(o!=null){let a=Ru(t,o);Array.isArray(a)&&(a=a.map(u=>u)),c(n,["requests[]","content"],a)}const i=l(e,["config"]);i!=null&&OE(i,n);const s=l(e,["model"]);return s!==void 0&&c(n,["requests[]","model"],We(t,s)),n}function FE(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["contents"]);if(o!=null){let s=Ru(t,o);Array.isArray(s)&&(s=s.map(a=>a)),c(n,["instances[]","content"],s)}const i=l(e,["config"]);return i!=null&&DE(i,n),n}function GE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),c(e,["embeddings"],i)}const o=l(t,["metadata"]);return o!=null&&c(e,["metadata"],o),e}function HE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["predictions[]","embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>xE(s))),c(e,["embeddings"],i)}const o=l(t,["metadata"]);return o!=null&&c(e,["metadata"],o),e}function BE(t){const e={},n=l(t,["endpoint"]);n!=null&&c(e,["name"],n);const r=l(t,["deployedModelId"]);return r!=null&&c(e,["deployedModelId"],r),e}function VE(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&c(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function jE(t){const e={},n=l(t,["id"]);n!=null&&c(e,["id"],n);const r=l(t,["args"]);r!=null&&c(e,["args"],r);const o=l(t,["name"]);if(o!=null&&c(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function zE(t){const e={},n=l(t,["mode"]);n!=null&&c(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);if(r!=null&&c(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function $E(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&c(e,["description"],n);const r=l(t,["name"]);r!=null&&c(e,["name"],r);const o=l(t,["parameters"]);o!=null&&c(e,["parameters"],o);const i=l(t,["parametersJsonSchema"]);i!=null&&c(e,["parametersJsonSchema"],i);const s=l(t,["response"]);s!=null&&c(e,["response"],s);const a=l(t,["responseJsonSchema"]);return a!=null&&c(e,["responseJsonSchema"],a),e}function WE(t,e,n){const r={},o=l(e,["systemInstruction"]);n!==void 0&&o!=null&&c(n,["systemInstruction"],Vs(_t(o)));const i=l(e,["temperature"]);i!=null&&c(r,["temperature"],i);const s=l(e,["topP"]);s!=null&&c(r,["topP"],s);const a=l(e,["topK"]);a!=null&&c(r,["topK"],a);const u=l(e,["candidateCount"]);u!=null&&c(r,["candidateCount"],u);const d=l(e,["maxOutputTokens"]);d!=null&&c(r,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&c(r,["stopSequences"],h);const m=l(e,["responseLogprobs"]);m!=null&&c(r,["responseLogprobs"],m);const p=l(e,["logprobs"]);p!=null&&c(r,["logprobs"],p);const g=l(e,["presencePenalty"]);g!=null&&c(r,["presencePenalty"],g);const E=l(e,["frequencyPenalty"]);E!=null&&c(r,["frequencyPenalty"],E);const x=l(e,["seed"]);x!=null&&c(r,["seed"],x);const w=l(e,["responseMimeType"]);w!=null&&c(r,["responseMimeType"],w);const y=l(e,["responseSchema"]);y!=null&&c(r,["responseSchema"],ku(y));const v=l(e,["responseJsonSchema"]);if(v!=null&&c(r,["responseJsonSchema"],v),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const S=l(e,["safetySettings"]);if(n!==void 0&&S!=null){let z=S;Array.isArray(z)&&(z=z.map(C=>DT(C))),c(n,["safetySettings"],z)}const N=l(e,["tools"]);if(n!==void 0&&N!=null){let z=uo(N);Array.isArray(z)&&(z=z.map(C=>jT(lo(C)))),c(n,["tools"],z)}const I=l(e,["toolConfig"]);if(n!==void 0&&I!=null&&c(n,["toolConfig"],VT(I)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const L=l(e,["cachedContent"]);n!==void 0&&L!=null&&c(n,["cachedContent"],Dn(t,L));const P=l(e,["responseModalities"]);P!=null&&c(r,["responseModalities"],P);const D=l(e,["mediaResolution"]);D!=null&&c(r,["mediaResolution"],D);const M=l(e,["speechConfig"]);if(M!=null&&c(r,["speechConfig"],Pu(M)),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const j=l(e,["thinkingConfig"]);j!=null&&c(r,["thinkingConfig"],j);const Q=l(e,["imageConfig"]);Q!=null&&c(r,["imageConfig"],xT(Q));const _=l(e,["enableEnhancedCivicAnswers"]);return _!=null&&c(r,["enableEnhancedCivicAnswers"],_),r}function qE(t,e,n){const r={},o=l(e,["systemInstruction"]);n!==void 0&&o!=null&&c(n,["systemInstruction"],_t(o));const i=l(e,["temperature"]);i!=null&&c(r,["temperature"],i);const s=l(e,["topP"]);s!=null&&c(r,["topP"],s);const a=l(e,["topK"]);a!=null&&c(r,["topK"],a);const u=l(e,["candidateCount"]);u!=null&&c(r,["candidateCount"],u);const d=l(e,["maxOutputTokens"]);d!=null&&c(r,["maxOutputTokens"],d);const h=l(e,["stopSequences"]);h!=null&&c(r,["stopSequences"],h);const m=l(e,["responseLogprobs"]);m!=null&&c(r,["responseLogprobs"],m);const p=l(e,["logprobs"]);p!=null&&c(r,["logprobs"],p);const g=l(e,["presencePenalty"]);g!=null&&c(r,["presencePenalty"],g);const E=l(e,["frequencyPenalty"]);E!=null&&c(r,["frequencyPenalty"],E);const x=l(e,["seed"]);x!=null&&c(r,["seed"],x);const w=l(e,["responseMimeType"]);w!=null&&c(r,["responseMimeType"],w);const y=l(e,["responseSchema"]);y!=null&&c(r,["responseSchema"],ku(y));const v=l(e,["responseJsonSchema"]);v!=null&&c(r,["responseJsonSchema"],v);const S=l(e,["routingConfig"]);S!=null&&c(r,["routingConfig"],S);const N=l(e,["modelSelectionConfig"]);N!=null&&c(r,["modelConfig"],N);const I=l(e,["safetySettings"]);if(n!==void 0&&I!=null){let he=I;Array.isArray(he)&&(he=he.map(J=>J)),c(n,["safetySettings"],he)}const L=l(e,["tools"]);if(n!==void 0&&L!=null){let he=uo(L);Array.isArray(he)&&(he=he.map(J=>um(lo(J)))),c(n,["tools"],he)}const P=l(e,["toolConfig"]);n!==void 0&&P!=null&&c(n,["toolConfig"],P);const D=l(e,["labels"]);n!==void 0&&D!=null&&c(n,["labels"],D);const M=l(e,["cachedContent"]);n!==void 0&&M!=null&&c(n,["cachedContent"],Dn(t,M));const j=l(e,["responseModalities"]);j!=null&&c(r,["responseModalities"],j);const Q=l(e,["mediaResolution"]);Q!=null&&c(r,["mediaResolution"],Q);const _=l(e,["speechConfig"]);_!=null&&c(r,["speechConfig"],Pu(_));const z=l(e,["audioTimestamp"]);z!=null&&c(r,["audioTimestamp"],z);const C=l(e,["thinkingConfig"]);C!=null&&c(r,["thinkingConfig"],C);const Y=l(e,["imageConfig"]);if(Y!=null&&c(r,["imageConfig"],ET(Y)),l(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return r}function cf(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["contents"]);if(o!=null){let s=nn(o);Array.isArray(s)&&(s=s.map(a=>Vs(a))),c(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&c(n,["generationConfig"],WE(t,i,n)),n}function df(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["contents"]);if(o!=null){let s=nn(o);Array.isArray(s)&&(s=s.map(a=>a)),c(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&c(n,["generationConfig"],qE(t,i,n)),n}function ff(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(d=>mE(d))),c(e,["candidates"],u)}const o=l(t,["modelVersion"]);o!=null&&c(e,["modelVersion"],o);const i=l(t,["promptFeedback"]);i!=null&&c(e,["promptFeedback"],i);const s=l(t,["responseId"]);s!=null&&c(e,["responseId"],s);const a=l(t,["usageMetadata"]);return a!=null&&c(e,["usageMetadata"],a),e}function hf(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(h=>h)),c(e,["candidates"],d)}const o=l(t,["createTime"]);o!=null&&c(e,["createTime"],o);const i=l(t,["modelVersion"]);i!=null&&c(e,["modelVersion"],i);const s=l(t,["promptFeedback"]);s!=null&&c(e,["promptFeedback"],s);const a=l(t,["responseId"]);a!=null&&c(e,["responseId"],a);const u=l(t,["usageMetadata"]);return u!=null&&c(e,["usageMetadata"],u),e}function YE(t,e){const n={};if(l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);const o=l(t,["aspectRatio"]);e!==void 0&&o!=null&&c(e,["parameters","aspectRatio"],o);const i=l(t,["guidanceScale"]);if(e!==void 0&&i!=null&&c(e,["parameters","guidanceScale"],i),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=l(t,["safetyFilterLevel"]);e!==void 0&&s!=null&&c(e,["parameters","safetySetting"],s);const a=l(t,["personGeneration"]);e!==void 0&&a!=null&&c(e,["parameters","personGeneration"],a);const u=l(t,["includeSafetyAttributes"]);e!==void 0&&u!=null&&c(e,["parameters","includeSafetyAttributes"],u);const d=l(t,["includeRaiReason"]);e!==void 0&&d!=null&&c(e,["parameters","includeRaiReason"],d);const h=l(t,["language"]);e!==void 0&&h!=null&&c(e,["parameters","language"],h);const m=l(t,["outputMimeType"]);e!==void 0&&m!=null&&c(e,["parameters","outputOptions","mimeType"],m);const p=l(t,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&c(e,["parameters","outputOptions","compressionQuality"],p),l(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(l(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const g=l(t,["imageSize"]);if(e!==void 0&&g!=null&&c(e,["parameters","sampleImageSize"],g),l(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function KE(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);const o=l(t,["negativePrompt"]);e!==void 0&&o!=null&&c(e,["parameters","negativePrompt"],o);const i=l(t,["numberOfImages"]);e!==void 0&&i!=null&&c(e,["parameters","sampleCount"],i);const s=l(t,["aspectRatio"]);e!==void 0&&s!=null&&c(e,["parameters","aspectRatio"],s);const a=l(t,["guidanceScale"]);e!==void 0&&a!=null&&c(e,["parameters","guidanceScale"],a);const u=l(t,["seed"]);e!==void 0&&u!=null&&c(e,["parameters","seed"],u);const d=l(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&c(e,["parameters","safetySetting"],d);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&c(e,["parameters","personGeneration"],h);const m=l(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&c(e,["parameters","includeSafetyAttributes"],m);const p=l(t,["includeRaiReason"]);e!==void 0&&p!=null&&c(e,["parameters","includeRaiReason"],p);const g=l(t,["language"]);e!==void 0&&g!=null&&c(e,["parameters","language"],g);const E=l(t,["outputMimeType"]);e!==void 0&&E!=null&&c(e,["parameters","outputOptions","mimeType"],E);const x=l(t,["outputCompressionQuality"]);e!==void 0&&x!=null&&c(e,["parameters","outputOptions","compressionQuality"],x);const w=l(t,["addWatermark"]);e!==void 0&&w!=null&&c(e,["parameters","addWatermark"],w);const y=l(t,["labels"]);e!==void 0&&y!=null&&c(e,["labels"],y);const v=l(t,["imageSize"]);e!==void 0&&v!=null&&c(e,["parameters","sampleImageSize"],v);const S=l(t,["enhancePrompt"]);return e!==void 0&&S!=null&&c(e,["parameters","enhancePrompt"],S),n}function JE(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["prompt"]);o!=null&&c(n,["instances[0]","prompt"],o);const i=l(e,["config"]);return i!=null&&YE(i,n),n}function XE(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["prompt"]);o!=null&&c(n,["instances[0]","prompt"],o);const i=l(e,["config"]);return i!=null&&KE(i,n),n}function ZE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>cT(s))),c(e,["generatedImages"],i)}const o=l(t,["positivePromptSafetyAttributes"]);return o!=null&&c(e,["positivePromptSafetyAttributes"],am(o)),e}function QE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>js(s))),c(e,["generatedImages"],i)}const o=l(t,["positivePromptSafetyAttributes"]);return o!=null&&c(e,["positivePromptSafetyAttributes"],lm(o)),e}function eT(t,e){const n={},r=l(t,["numberOfVideos"]);if(e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r),l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=l(t,["durationSeconds"]);if(e!==void 0&&o!=null&&c(e,["parameters","durationSeconds"],o),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const i=l(t,["aspectRatio"]);e!==void 0&&i!=null&&c(e,["parameters","aspectRatio"],i);const s=l(t,["resolution"]);e!==void 0&&s!=null&&c(e,["parameters","resolution"],s);const a=l(t,["personGeneration"]);if(e!==void 0&&a!=null&&c(e,["parameters","personGeneration"],a),l(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const u=l(t,["negativePrompt"]);e!==void 0&&u!=null&&c(e,["parameters","negativePrompt"],u);const d=l(t,["enhancePrompt"]);if(e!==void 0&&d!=null&&c(e,["parameters","enhancePrompt"],d),l(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const h=l(t,["lastFrame"]);e!==void 0&&h!=null&&c(e,["instances[0]","lastFrame"],zs(h));const m=l(t,["referenceImages"]);if(e!==void 0&&m!=null){let p=m;Array.isArray(p)&&(p=p.map(g=>nS(g))),c(e,["instances[0]","referenceImages"],p)}if(l(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(l(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function tT(t,e){const n={},r=l(t,["numberOfVideos"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);const o=l(t,["outputGcsUri"]);e!==void 0&&o!=null&&c(e,["parameters","storageUri"],o);const i=l(t,["fps"]);e!==void 0&&i!=null&&c(e,["parameters","fps"],i);const s=l(t,["durationSeconds"]);e!==void 0&&s!=null&&c(e,["parameters","durationSeconds"],s);const a=l(t,["seed"]);e!==void 0&&a!=null&&c(e,["parameters","seed"],a);const u=l(t,["aspectRatio"]);e!==void 0&&u!=null&&c(e,["parameters","aspectRatio"],u);const d=l(t,["resolution"]);e!==void 0&&d!=null&&c(e,["parameters","resolution"],d);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&c(e,["parameters","personGeneration"],h);const m=l(t,["pubsubTopic"]);e!==void 0&&m!=null&&c(e,["parameters","pubsubTopic"],m);const p=l(t,["negativePrompt"]);e!==void 0&&p!=null&&c(e,["parameters","negativePrompt"],p);const g=l(t,["enhancePrompt"]);e!==void 0&&g!=null&&c(e,["parameters","enhancePrompt"],g);const E=l(t,["generateAudio"]);e!==void 0&&E!=null&&c(e,["parameters","generateAudio"],E);const x=l(t,["lastFrame"]);e!==void 0&&x!=null&&c(e,["instances[0]","lastFrame"],yn(x));const w=l(t,["referenceImages"]);if(e!==void 0&&w!=null){let S=w;Array.isArray(S)&&(S=S.map(N=>rS(N))),c(e,["instances[0]","referenceImages"],S)}const y=l(t,["mask"]);e!==void 0&&y!=null&&c(e,["instances[0]","mask"],tS(y));const v=l(t,["compressionQuality"]);return e!==void 0&&v!=null&&c(e,["parameters","compressionQuality"],v),n}function nT(t){const e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const o=l(t,["done"]);o!=null&&c(e,["done"],o);const i=l(t,["error"]);i!=null&&c(e,["error"],i);const s=l(t,["response","generateVideoResponse"]);return s!=null&&c(e,["response"],sT(s)),e}function rT(t){const e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const o=l(t,["done"]);o!=null&&c(e,["done"],o);const i=l(t,["error"]);i!=null&&c(e,["error"],i);const s=l(t,["response"]);return s!=null&&c(e,["response"],aT(s)),e}function oT(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["prompt"]);o!=null&&c(n,["instances[0]","prompt"],o);const i=l(e,["image"]);i!=null&&c(n,["instances[0]","image"],zs(i));const s=l(e,["video"]);s!=null&&c(n,["instances[0]","video"],cm(s));const a=l(e,["source"]);a!=null&&lT(a,n);const u=l(e,["config"]);return u!=null&&eT(u,n),n}function iT(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["prompt"]);o!=null&&c(n,["instances[0]","prompt"],o);const i=l(e,["image"]);i!=null&&c(n,["instances[0]","image"],yn(i));const s=l(e,["video"]);s!=null&&c(n,["instances[0]","video"],dm(s));const a=l(e,["source"]);a!=null&&uT(a,n);const u=l(e,["config"]);return u!=null&&tT(u,n),n}function sT(t){const e={},n=l(t,["generatedSamples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>fT(s))),c(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&c(e,["raiMediaFilteredReasons"],o),e}function aT(t){const e={},n=l(t,["videos"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>hT(s))),c(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&c(e,["raiMediaFilteredReasons"],o),e}function lT(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);const o=l(t,["image"]);e!==void 0&&o!=null&&c(e,["instances[0]","image"],zs(o));const i=l(t,["video"]);return e!==void 0&&i!=null&&c(e,["instances[0]","video"],cm(i)),n}function uT(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);const o=l(t,["image"]);e!==void 0&&o!=null&&c(e,["instances[0]","image"],yn(o));const i=l(t,["video"]);return e!==void 0&&i!=null&&c(e,["instances[0]","video"],dm(i)),n}function cT(t){const e={},n=l(t,["_self"]);n!=null&&c(e,["image"],TT(n));const r=l(t,["raiFilteredReason"]);r!=null&&c(e,["raiFilteredReason"],r);const o=l(t,["_self"]);return o!=null&&c(e,["safetyAttributes"],am(o)),e}function js(t){const e={},n=l(t,["_self"]);n!=null&&c(e,["image"],sm(n));const r=l(t,["raiFilteredReason"]);r!=null&&c(e,["raiFilteredReason"],r);const o=l(t,["_self"]);o!=null&&c(e,["safetyAttributes"],lm(o));const i=l(t,["prompt"]);return i!=null&&c(e,["enhancedPrompt"],i),e}function dT(t){const e={},n=l(t,["_self"]);n!=null&&c(e,["mask"],sm(n));const r=l(t,["labels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),c(e,["labels"],o)}return e}function fT(t){const e={},n=l(t,["video"]);return n!=null&&c(e,["video"],QT(n)),e}function hT(t){const e={},n=l(t,["_self"]);return n!=null&&c(e,["video"],eS(n)),e}function pT(t){const e={},n=l(t,["modelSelectionConfig"]);n!=null&&c(e,["modelConfig"],n);const r=l(t,["responseJsonSchema"]);r!=null&&c(e,["responseJsonSchema"],r);const o=l(t,["audioTimestamp"]);o!=null&&c(e,["audioTimestamp"],o);const i=l(t,["candidateCount"]);i!=null&&c(e,["candidateCount"],i);const s=l(t,["enableAffectiveDialog"]);s!=null&&c(e,["enableAffectiveDialog"],s);const a=l(t,["frequencyPenalty"]);a!=null&&c(e,["frequencyPenalty"],a);const u=l(t,["logprobs"]);u!=null&&c(e,["logprobs"],u);const d=l(t,["maxOutputTokens"]);d!=null&&c(e,["maxOutputTokens"],d);const h=l(t,["mediaResolution"]);h!=null&&c(e,["mediaResolution"],h);const m=l(t,["presencePenalty"]);m!=null&&c(e,["presencePenalty"],m);const p=l(t,["responseLogprobs"]);p!=null&&c(e,["responseLogprobs"],p);const g=l(t,["responseMimeType"]);g!=null&&c(e,["responseMimeType"],g);const E=l(t,["responseModalities"]);E!=null&&c(e,["responseModalities"],E);const x=l(t,["responseSchema"]);x!=null&&c(e,["responseSchema"],x);const w=l(t,["routingConfig"]);w!=null&&c(e,["routingConfig"],w);const y=l(t,["seed"]);y!=null&&c(e,["seed"],y);const v=l(t,["speechConfig"]);v!=null&&c(e,["speechConfig"],v);const S=l(t,["stopSequences"]);S!=null&&c(e,["stopSequences"],S);const N=l(t,["temperature"]);N!=null&&c(e,["temperature"],N);const I=l(t,["thinkingConfig"]);I!=null&&c(e,["thinkingConfig"],I);const L=l(t,["topK"]);L!=null&&c(e,["topK"],L);const P=l(t,["topP"]);if(P!=null&&c(e,["topP"],P),l(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function mT(t,e){const n={},r=l(e,["model"]);return r!=null&&c(n,["_url","name"],We(t,r)),n}function gT(t,e){const n={},r=l(e,["model"]);return r!=null&&c(n,["_url","name"],We(t,r)),n}function yT(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&c(e,["enableWidget"],n),e}function vT(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&c(e,["timeRangeFilter"],n),e}function xT(t){const e={},n=l(t,["aspectRatio"]);n!=null&&c(e,["aspectRatio"],n);const r=l(t,["imageSize"]);if(r!=null&&c(e,["imageSize"],r),l(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(l(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function ET(t){const e={},n=l(t,["aspectRatio"]);n!=null&&c(e,["aspectRatio"],n);const r=l(t,["imageSize"]);r!=null&&c(e,["imageSize"],r);const o=l(t,["outputMimeType"]);o!=null&&c(e,["imageOutputOptions","mimeType"],o);const i=l(t,["outputCompressionQuality"]);return i!=null&&c(e,["imageOutputOptions","compressionQuality"],i),e}function TT(t){const e={},n=l(t,["bytesBase64Encoded"]);n!=null&&c(e,["imageBytes"],ir(n));const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function sm(t){const e={},n=l(t,["gcsUri"]);n!=null&&c(e,["gcsUri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&c(e,["imageBytes"],ir(r));const o=l(t,["mimeType"]);return o!=null&&c(e,["mimeType"],o),e}function zs(t){const e={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=l(t,["imageBytes"]);n!=null&&c(e,["bytesBase64Encoded"],ir(n));const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function yn(t){const e={},n=l(t,["gcsUri"]);n!=null&&c(e,["gcsUri"],n);const r=l(t,["imageBytes"]);r!=null&&c(e,["bytesBase64Encoded"],ir(r));const o=l(t,["mimeType"]);return o!=null&&c(e,["mimeType"],o),e}function ST(t,e,n){const r={},o=l(e,["pageSize"]);n!==void 0&&o!=null&&c(n,["_query","pageSize"],o);const i=l(e,["pageToken"]);n!==void 0&&i!=null&&c(n,["_query","pageToken"],i);const s=l(e,["filter"]);n!==void 0&&s!=null&&c(n,["_query","filter"],s);const a=l(e,["queryBase"]);return n!==void 0&&a!=null&&c(n,["_url","models_url"],Qp(t,a)),r}function wT(t,e,n){const r={},o=l(e,["pageSize"]);n!==void 0&&o!=null&&c(n,["_query","pageSize"],o);const i=l(e,["pageToken"]);n!==void 0&&i!=null&&c(n,["_query","pageToken"],i);const s=l(e,["filter"]);n!==void 0&&s!=null&&c(n,["_query","filter"],s);const a=l(e,["queryBase"]);return n!==void 0&&a!=null&&c(n,["_url","models_url"],Qp(t,a)),r}function CT(t,e){const n={},r=l(e,["config"]);return r!=null&&ST(t,r,n),n}function NT(t,e){const n={},r=l(e,["config"]);return r!=null&&wT(t,r,n),n}function IT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const o=l(t,["_self"]);if(o!=null){let i=em(o);Array.isArray(i)&&(i=i.map(s=>Sl(s))),c(e,["models"],i)}return e}function bT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const o=l(t,["_self"]);if(o!=null){let i=em(o);Array.isArray(i)&&(i=i.map(s=>wl(s))),c(e,["models"],i)}return e}function _T(t){const e={},n=l(t,["maskMode"]);n!=null&&c(e,["maskMode"],n);const r=l(t,["segmentationClasses"]);r!=null&&c(e,["maskClasses"],r);const o=l(t,["maskDilation"]);return o!=null&&c(e,["dilation"],o),e}function Sl(t){const e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);const r=l(t,["displayName"]);r!=null&&c(e,["displayName"],r);const o=l(t,["description"]);o!=null&&c(e,["description"],o);const i=l(t,["version"]);i!=null&&c(e,["version"],i);const s=l(t,["_self"]);s!=null&&c(e,["tunedModelInfo"],zT(s));const a=l(t,["inputTokenLimit"]);a!=null&&c(e,["inputTokenLimit"],a);const u=l(t,["outputTokenLimit"]);u!=null&&c(e,["outputTokenLimit"],u);const d=l(t,["supportedGenerationMethods"]);d!=null&&c(e,["supportedActions"],d);const h=l(t,["temperature"]);h!=null&&c(e,["temperature"],h);const m=l(t,["maxTemperature"]);m!=null&&c(e,["maxTemperature"],m);const p=l(t,["topP"]);p!=null&&c(e,["topP"],p);const g=l(t,["topK"]);g!=null&&c(e,["topK"],g);const E=l(t,["thinking"]);return E!=null&&c(e,["thinking"],E),e}function wl(t){const e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);const r=l(t,["displayName"]);r!=null&&c(e,["displayName"],r);const o=l(t,["description"]);o!=null&&c(e,["description"],o);const i=l(t,["versionId"]);i!=null&&c(e,["version"],i);const s=l(t,["deployedModels"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(p=>BE(p))),c(e,["endpoints"],m)}const a=l(t,["labels"]);a!=null&&c(e,["labels"],a);const u=l(t,["_self"]);u!=null&&c(e,["tunedModelInfo"],$T(u));const d=l(t,["defaultCheckpointId"]);d!=null&&c(e,["defaultCheckpointId"],d);const h=l(t,["checkpoints"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(p=>p)),c(e,["checkpoints"],m)}return e}function AT(t){const e={},n=l(t,["mediaResolution"]);n!=null&&c(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&c(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&c(e,["fileData"],VE(i));const s=l(t,["functionCall"]);s!=null&&c(e,["functionCall"],jE(s));const a=l(t,["functionResponse"]);a!=null&&c(e,["functionResponse"],a);const u=l(t,["inlineData"]);u!=null&&c(e,["inlineData"],pE(u));const d=l(t,["text"]);d!=null&&c(e,["text"],d);const h=l(t,["thought"]);h!=null&&c(e,["thought"],h);const m=l(t,["thoughtSignature"]);m!=null&&c(e,["thoughtSignature"],m);const p=l(t,["videoMetadata"]);return p!=null&&c(e,["videoMetadata"],p),e}function RT(t){const e={},n=l(t,["productImage"]);return n!=null&&c(e,["image"],yn(n)),e}function kT(t,e){const n={},r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);const o=l(t,["baseSteps"]);e!==void 0&&o!=null&&c(e,["parameters","baseSteps"],o);const i=l(t,["outputGcsUri"]);e!==void 0&&i!=null&&c(e,["parameters","storageUri"],i);const s=l(t,["seed"]);e!==void 0&&s!=null&&c(e,["parameters","seed"],s);const a=l(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&c(e,["parameters","safetySetting"],a);const u=l(t,["personGeneration"]);e!==void 0&&u!=null&&c(e,["parameters","personGeneration"],u);const d=l(t,["addWatermark"]);e!==void 0&&d!=null&&c(e,["parameters","addWatermark"],d);const h=l(t,["outputMimeType"]);e!==void 0&&h!=null&&c(e,["parameters","outputOptions","mimeType"],h);const m=l(t,["outputCompressionQuality"]);e!==void 0&&m!=null&&c(e,["parameters","outputOptions","compressionQuality"],m);const p=l(t,["enhancePrompt"]);e!==void 0&&p!=null&&c(e,["parameters","enhancePrompt"],p);const g=l(t,["labels"]);return e!==void 0&&g!=null&&c(e,["labels"],g),n}function PT(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["source"]);o!=null&&LT(o,n);const i=l(e,["config"]);return i!=null&&kT(i,n),n}function MT(t){const e={},n=l(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>js(o))),c(e,["generatedImages"],r)}return e}function LT(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);const o=l(t,["personImage"]);e!==void 0&&o!=null&&c(e,["instances[0]","personImage","image"],yn(o));const i=l(t,["productImages"]);if(e!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>RT(a))),c(e,["instances[0]","productImages"],s)}return n}function OT(t){const e={},n=l(t,["referenceImage"]);n!=null&&c(e,["referenceImage"],yn(n));const r=l(t,["referenceId"]);r!=null&&c(e,["referenceId"],r);const o=l(t,["referenceType"]);o!=null&&c(e,["referenceType"],o);const i=l(t,["maskImageConfig"]);i!=null&&c(e,["maskImageConfig"],_T(i));const s=l(t,["controlImageConfig"]);s!=null&&c(e,["controlImageConfig"],TE(s));const a=l(t,["styleImageConfig"]);a!=null&&c(e,["styleImageConfig"],a);const u=l(t,["subjectImageConfig"]);return u!=null&&c(e,["subjectImageConfig"],u),e}function am(t){const e={},n=l(t,["safetyAttributes","categories"]);n!=null&&c(e,["categories"],n);const r=l(t,["safetyAttributes","scores"]);r!=null&&c(e,["scores"],r);const o=l(t,["contentType"]);return o!=null&&c(e,["contentType"],o),e}function lm(t){const e={},n=l(t,["safetyAttributes","categories"]);n!=null&&c(e,["categories"],n);const r=l(t,["safetyAttributes","scores"]);r!=null&&c(e,["scores"],r);const o=l(t,["contentType"]);return o!=null&&c(e,["contentType"],o),e}function DT(t){const e={},n=l(t,["category"]);if(n!=null&&c(e,["category"],n),l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=l(t,["threshold"]);return r!=null&&c(e,["threshold"],r),e}function UT(t){const e={},n=l(t,["image"]);return n!=null&&c(e,["image"],yn(n)),e}function FT(t,e){const n={},r=l(t,["mode"]);e!==void 0&&r!=null&&c(e,["parameters","mode"],r);const o=l(t,["maxPredictions"]);e!==void 0&&o!=null&&c(e,["parameters","maxPredictions"],o);const i=l(t,["confidenceThreshold"]);e!==void 0&&i!=null&&c(e,["parameters","confidenceThreshold"],i);const s=l(t,["maskDilation"]);e!==void 0&&s!=null&&c(e,["parameters","maskDilation"],s);const a=l(t,["binaryColorThreshold"]);e!==void 0&&a!=null&&c(e,["parameters","binaryColorThreshold"],a);const u=l(t,["labels"]);return e!==void 0&&u!=null&&c(e,["labels"],u),n}function GT(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["source"]);o!=null&&BT(o,n);const i=l(e,["config"]);return i!=null&&FT(i,n),n}function HT(t){const e={},n=l(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>dT(o))),c(e,["generatedMasks"],r)}return e}function BT(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);const o=l(t,["image"]);e!==void 0&&o!=null&&c(e,["instances[0]","image"],yn(o));const i=l(t,["scribbleImage"]);return e!==void 0&&i!=null&&c(e,["instances[0]","scribble"],UT(i)),n}function VT(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&c(e,["functionCallingConfig"],zE(n));const r=l(t,["retrievalConfig"]);return r!=null&&c(e,["retrievalConfig"],r),e}function jT(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&c(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&c(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&c(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&c(e,["googleMaps"],yT(a));const u=l(t,["googleSearch"]);u!=null&&c(e,["googleSearch"],vT(u));const d=l(t,["urlContext"]);return d!=null&&c(e,["urlContext"],d),e}function um(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let m=n;Array.isArray(m)&&(m=m.map(p=>$E(p))),c(e,["functionDeclarations"],m)}const r=l(t,["retrieval"]);r!=null&&c(e,["retrieval"],r);const o=l(t,["googleSearchRetrieval"]);o!=null&&c(e,["googleSearchRetrieval"],o);const i=l(t,["computerUse"]);if(i!=null&&c(e,["computerUse"],i),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=l(t,["codeExecution"]);s!=null&&c(e,["codeExecution"],s);const a=l(t,["enterpriseWebSearch"]);a!=null&&c(e,["enterpriseWebSearch"],a);const u=l(t,["googleMaps"]);u!=null&&c(e,["googleMaps"],u);const d=l(t,["googleSearch"]);d!=null&&c(e,["googleSearch"],d);const h=l(t,["urlContext"]);return h!=null&&c(e,["urlContext"],h),e}function zT(t){const e={},n=l(t,["baseModel"]);n!=null&&c(e,["baseModel"],n);const r=l(t,["createTime"]);r!=null&&c(e,["createTime"],r);const o=l(t,["updateTime"]);return o!=null&&c(e,["updateTime"],o),e}function $T(t){const e={},n=l(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&c(e,["baseModel"],n);const r=l(t,["createTime"]);r!=null&&c(e,["createTime"],r);const o=l(t,["updateTime"]);return o!=null&&c(e,["updateTime"],o),e}function WT(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);const o=l(t,["description"]);e!==void 0&&o!=null&&c(e,["description"],o);const i=l(t,["defaultCheckpointId"]);return e!==void 0&&i!=null&&c(e,["defaultCheckpointId"],i),n}function qT(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);const o=l(t,["description"]);e!==void 0&&o!=null&&c(e,["description"],o);const i=l(t,["defaultCheckpointId"]);return e!==void 0&&i!=null&&c(e,["defaultCheckpointId"],i),n}function YT(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","name"],We(t,r));const o=l(e,["config"]);return o!=null&&WT(o,n),n}function KT(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["config"]);return o!=null&&qT(o,n),n}function JT(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);const o=l(t,["safetyFilterLevel"]);e!==void 0&&o!=null&&c(e,["parameters","safetySetting"],o);const i=l(t,["personGeneration"]);e!==void 0&&i!=null&&c(e,["parameters","personGeneration"],i);const s=l(t,["includeRaiReason"]);e!==void 0&&s!=null&&c(e,["parameters","includeRaiReason"],s);const a=l(t,["outputMimeType"]);e!==void 0&&a!=null&&c(e,["parameters","outputOptions","mimeType"],a);const u=l(t,["outputCompressionQuality"]);e!==void 0&&u!=null&&c(e,["parameters","outputOptions","compressionQuality"],u);const d=l(t,["enhanceInputImage"]);e!==void 0&&d!=null&&c(e,["parameters","upscaleConfig","enhanceInputImage"],d);const h=l(t,["imagePreservationFactor"]);e!==void 0&&h!=null&&c(e,["parameters","upscaleConfig","imagePreservationFactor"],h);const m=l(t,["labels"]);e!==void 0&&m!=null&&c(e,["labels"],m);const p=l(t,["numberOfImages"]);e!==void 0&&p!=null&&c(e,["parameters","sampleCount"],p);const g=l(t,["mode"]);return e!==void 0&&g!=null&&c(e,["parameters","mode"],g),n}function XT(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["_url","model"],We(t,r));const o=l(e,["image"]);o!=null&&c(n,["instances[0]","image"],yn(o));const i=l(e,["upscaleFactor"]);i!=null&&c(n,["parameters","upscaleConfig","upscaleFactor"],i);const s=l(e,["config"]);return s!=null&&JT(s,n),n}function ZT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>js(i))),c(e,["generatedImages"],o)}return e}function QT(t){const e={},n=l(t,["uri"]);n!=null&&c(e,["uri"],n);const r=l(t,["encodedVideo"]);r!=null&&c(e,["videoBytes"],ir(r));const o=l(t,["encoding"]);return o!=null&&c(e,["mimeType"],o),e}function eS(t){const e={},n=l(t,["gcsUri"]);n!=null&&c(e,["uri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&c(e,["videoBytes"],ir(r));const o=l(t,["mimeType"]);return o!=null&&c(e,["mimeType"],o),e}function tS(t){const e={},n=l(t,["image"]);n!=null&&c(e,["_self"],yn(n));const r=l(t,["maskMode"]);return r!=null&&c(e,["maskMode"],r),e}function nS(t){const e={},n=l(t,["image"]);n!=null&&c(e,["image"],zs(n));const r=l(t,["referenceType"]);return r!=null&&c(e,["referenceType"],r),e}function rS(t){const e={},n=l(t,["image"]);n!=null&&c(e,["image"],yn(n));const r=l(t,["referenceType"]);return r!=null&&c(e,["referenceType"],r),e}function cm(t){const e={},n=l(t,["uri"]);n!=null&&c(e,["uri"],n);const r=l(t,["videoBytes"]);r!=null&&c(e,["encodedVideo"],ir(r));const o=l(t,["mimeType"]);return o!=null&&c(e,["encoding"],o),e}function dm(t){const e={},n=l(t,["uri"]);n!=null&&c(e,["gcsUri"],n);const r=l(t,["videoBytes"]);r!=null&&c(e,["bytesBase64Encoded"],ir(r));const o=l(t,["mimeType"]);return o!=null&&c(e,["mimeType"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function oS(t,e){const n={},r=l(t,["displayName"]);return e!==void 0&&r!=null&&c(e,["displayName"],r),n}function iS(t){const e={},n=l(t,["config"]);return n!=null&&oS(n,e),e}function sS(t,e){const n={},r=l(t,["force"]);return e!==void 0&&r!=null&&c(e,["_query","force"],r),n}function aS(t){const e={},n=l(t,["name"]);n!=null&&c(e,["_url","name"],n);const r=l(t,["config"]);return r!=null&&sS(r,e),e}function lS(t){const e={},n=l(t,["name"]);return n!=null&&c(e,["_url","name"],n),e}function uS(t,e){const n={},r=l(t,["customMetadata"]);if(e!==void 0&&r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),c(e,["customMetadata"],i)}const o=l(t,["chunkingConfig"]);return e!==void 0&&o!=null&&c(e,["chunkingConfig"],o),n}function cS(t){const e={},n=l(t,["name"]);n!=null&&c(e,["name"],n);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const o=l(t,["done"]);o!=null&&c(e,["done"],o);const i=l(t,["error"]);i!=null&&c(e,["error"],i);const s=l(t,["response"]);return s!=null&&c(e,["response"],fS(s)),e}function dS(t){const e={},n=l(t,["fileSearchStoreName"]);n!=null&&c(e,["_url","file_search_store_name"],n);const r=l(t,["fileName"]);r!=null&&c(e,["fileName"],r);const o=l(t,["config"]);return o!=null&&uS(o,e),e}function fS(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["parent"]);r!=null&&c(e,["parent"],r);const o=l(t,["documentName"]);return o!=null&&c(e,["documentName"],o),e}function hS(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),n}function pS(t){const e={},n=l(t,["config"]);return n!=null&&hS(n,e),e}function mS(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const o=l(t,["fileSearchStores"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),c(e,["fileSearchStores"],i)}return e}function fm(t,e){const n={},r=l(t,["mimeType"]);e!==void 0&&r!=null&&c(e,["mimeType"],r);const o=l(t,["displayName"]);e!==void 0&&o!=null&&c(e,["displayName"],o);const i=l(t,["customMetadata"]);if(e!==void 0&&i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>u)),c(e,["customMetadata"],a)}const s=l(t,["chunkingConfig"]);return e!==void 0&&s!=null&&c(e,["chunkingConfig"],s),n}function gS(t){const e={},n=l(t,["fileSearchStoreName"]);n!=null&&c(e,["_url","file_search_store_name"],n);const r=l(t,["config"]);return r!=null&&fm(r,e),e}function yS(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&c(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vS="Content-Type",xS="X-Server-Timeout",ES="User-Agent",Cl="x-goog-api-client",TS="1.34.0",SS=`google-genai-sdk/${TS}`,wS="v1beta1",CS="v1beta";class NS{constructor(e){var n,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const o={};this.clientOptions.vertexai?(o.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:wS,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:CS,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){const o=[this.getRequestUrlInternal(n)];return r&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,r);if(e.queryParams)for(const[s,a]of Object.entries(e.queryParams))o.searchParams.append(s,String(a));let i={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,n,o.toString(),e.abortSignal),this.unaryApiCall(o,i,e.httpMethod)}patchHttpOptions(e,n){const r=JSON.parse(JSON.stringify(e));for(const[o,i]of Object.entries(n))typeof i=="object"?r[o]=Object.assign(Object.assign({},r[o]),i):i!==void 0&&(r[o]=i);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,r);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,n,o.toString(),e.abortSignal),this.streamApiCall(o,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r,o){if(n&&n.timeout||o){const i=new AbortController,s=i.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const a=setTimeout(()=>i.abort(),n.timeout);a&&typeof a.unref=="function"&&a.unref()}o&&o.addEventListener("abort",()=>{i.abort()}),e.signal=s}return n&&n.extraBody!==null&&IS(e,n.extraBody),e.headers=await this.getHeadersInternal(n,r),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async o=>(await pf(o),new xl(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async o=>(await pf(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){return hn(this,arguments,function*(){var r;const o=(r=e==null?void 0:e.body)===null||r===void 0?void 0:r.getReader(),i=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let s="";const a="data:",u=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:d,value:h}=yield Oe(o.read());if(d){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const m=i.decode(h,{stream:!0});try{const E=JSON.parse(m);if("error"in E){const x=JSON.parse(JSON.stringify(E.error)),w=x.status,y=x.code,v=`got status: ${w}. ${JSON.stringify(E)}`;if(y>=400&&y<600)throw new Bs({message:v,status:y})}}catch(E){if(E.name==="ApiError")throw E}s+=m;let p=-1,g=0;for(;;){p=-1,g=0;for(const w of u){const y=s.indexOf(w);y!==-1&&(p===-1||y<p)&&(p=y,g=w.length)}if(p===-1)break;const E=s.substring(0,p);s=s.substring(p+g);const x=E.trim();if(x.startsWith(a)){const w=x.substring(a.length).trim();try{const y=new Response(w,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Oe(new xl(y))}catch(y){throw new Error(`exception parsing stream chunk ${w}. ${y}`)}}}}}finally{o.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const e={},n=SS+" "+this.clientOptions.userAgentExtra;return e[ES]=n,e[Cl]=n,e[vS]="application/json",e}async getHeadersInternal(e,n){const r=new Headers;if(e&&e.headers){for(const[o,i]of Object.entries(e.headers))r.append(o,i);e.timeout&&e.timeout>0&&r.append(xS,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(e){var n;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(e,n){var r;const o={};n!=null&&(o.mimeType=n.mimeType,o.name=n.name,o.displayName=n.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);const i=this.clientOptions.uploader,s=await i.stat(e);o.sizeBytes=String(s.size);const a=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:s.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=a;const u={file:o},d=this.getFileName(e),h=Te("upload/v1beta/files",u._url),m=await this.fetchUploadUrl(h,o.sizeBytes,o.mimeType,d,u,n==null?void 0:n.httpOptions);return i.upload(e,m,this)}async uploadFileToFileSearchStore(e,n,r){var o;const i=this.clientOptions.uploader,s=await i.stat(n),a=String(s.size),u=(o=r==null?void 0:r.mimeType)!==null&&o!==void 0?o:s.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const d=`upload/v1beta/${e}:uploadToFileSearchStore`,h=this.getFileName(n),m={};r!=null&&fm(r,m);const p=await this.fetchUploadUrl(d,a,u,h,m,r==null?void 0:r.httpOptions);return i.uploadToFileSearchStore(n,p,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,r,o,i,s){var a;let u={};s?u=s:u={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},o?{"X-Goog-Upload-File-Name":o}:{})};const d=await this.request({path:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:u});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const h=(a=d==null?void 0:d.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}}async function pf(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};const o=JSON.stringify(r);throw n>=400&&n<600?new Bs({message:o,status:n}):new Error(o)}}function IS(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const i=JSON.parse(t.body);if(typeof i=="object"&&i!==null&&!Array.isArray(i))n=i;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(i,s){const a=Object.assign({},i);for(const u in s)if(Object.prototype.hasOwnProperty.call(s,u)){const d=s[u],h=a[u];d&&typeof d=="object"&&!Array.isArray(d)&&h&&typeof h=="object"&&!Array.isArray(h)?a[u]=r(h,d):(h&&d&&typeof h!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${u}". Original type: ${typeof h}, New type: ${typeof d}. Overwriting.`),a[u]=d)}return a}const o=r(n,e);t.body=JSON.stringify(o)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bS="mcp_used/unknown";let _S=!1;function hm(t){for(const e of t)if(AS(e)||typeof e=="object"&&"inputSchema"in e)return!0;return _S}function pm(t){var e;const n=(e=t[Cl])!==null&&e!==void 0?e:"";t[Cl]=(n+` ${bS}`).trimStart()}function AS(t){return t!==null&&typeof t=="object"&&t instanceof Lu}function RS(t){return hn(this,arguments,function*(n,r=100){let o,i=0;for(;i<r;){const s=yield Oe(n.listTools({cursor:o}));for(const a of s.tools)yield yield Oe(a),i++;if(!s.nextCursor)break;o=s.nextCursor}})}class Lu{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new Lu(e,n)}async initialize(){var e,n,r,o;if(this.mcpTools.length>0)return;const i={},s=[];for(const h of this.mcpClients)try{for(var a=!0,u=(n=void 0,pn(RS(h))),d;d=await u.next(),e=d.done,!e;a=!0){o=d.value,a=!1;const m=o;s.push(m);const p=m.name;if(i[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);i[p]=h}}catch(m){n={error:m}}finally{try{!a&&!e&&(r=u.return)&&await r.call(u)}finally{if(n)throw n.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),lv(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const o=this.functionNameToMcpClient[r.name];let i;this.config.timeout&&(i={timeout:this.config.timeout});const s=await o.callTool({name:r.name,arguments:r.args},void 0,i);n.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function kS(t,e,n){const r=new ev;let o;n.data instanceof Blob?o=JSON.parse(await n.data.text()):o=JSON.parse(n.data),Object.assign(r,o),e(r)}class PS{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const o=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),s=OS(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),u=`${o}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${a}`;let d=()=>{};const h=new Promise(S=>{d=S}),m=e.callbacks,p=function(){d({})},g=this.apiClient,E={onopen:p,onmessage:S=>{kS(g,m.onmessage,S)},onerror:(n=m==null?void 0:m.onerror)!==null&&n!==void 0?n:function(S){},onclose:(r=m==null?void 0:m.onclose)!==null&&r!==void 0?r:function(S){}},x=this.webSocketFactory.create(u,LS(s),E);x.connect(),await h;const v={setup:{model:We(this.apiClient,e.model)}};return x.send(JSON.stringify(v)),new MS(x,this.apiClient)}}class MS{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=iE(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=oE(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(Vr.PLAY)}pause(){this.sendPlaybackControl(Vr.PAUSE)}stop(){this.sendPlaybackControl(Vr.STOP)}resetContext(){this.sendPlaybackControl(Vr.RESET_CONTEXT)}close(){this.conn.close()}}function LS(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function OS(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const DS="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function US(t,e,n){const r=new Qy;let o;n.data instanceof Blob?o=await n.data.text():n.data instanceof ArrayBuffer?o=new TextDecoder().decode(n.data):o=n.data;const i=JSON.parse(o);if(t.isVertexAI()){const s=lE(i);Object.assign(r,s)}else Object.assign(r,i);e(r)}class FS{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new PS(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,o,i,s,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const u=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let h;const m=this.apiClient.getHeaders();e.config&&e.config.tools&&hm(e.config.tools)&&pm(m);const p=VS(m);if(this.apiClient.isVertexAI())h=`${u}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p,h);else{const M=this.apiClient.getApiKey();let j="BidiGenerateContent",Q="key";M!=null&&M.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),j="BidiGenerateContentConstrained",Q="access_token"),h=`${u}/ws/google.ai.generativelanguage.${d}.GenerativeService.${j}?${Q}=${M}`}let g=()=>{};const E=new Promise(M=>{g=M}),x=e.callbacks,w=function(){var M;(M=x==null?void 0:x.onopen)===null||M===void 0||M.call(x),g({})},y=this.apiClient,v={onopen:w,onmessage:M=>{US(y,x.onmessage,M)},onerror:(n=x==null?void 0:x.onerror)!==null&&n!==void 0?n:function(M){},onclose:(r=x==null?void 0:x.onclose)!==null&&r!==void 0?r:function(M){}},S=this.webSocketFactory.create(h,BS(p),v);S.connect(),await E;let N=We(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&N.startsWith("publishers/")){const M=this.apiClient.getProject(),j=this.apiClient.getLocation();N=`projects/${M}/locations/${j}/`+N}let I={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[vs.AUDIO]}:e.config.responseModalities=[vs.AUDIO]),!((i=e.config)===null||i===void 0)&&i.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const L=(a=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&a!==void 0?a:[],P=[];for(const M of L)if(this.isCallableTool(M)){const j=M;P.push(await j.tool())}else P.push(M);P.length>0&&(e.config.tools=P);const D={model:N,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?I=rE(this.apiClient,D):I=nE(this.apiClient,D),delete I.config,S.send(JSON.stringify(I)),new HS(S,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const GS={turnComplete:!0};class HS{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=nn(n.turns),e.isVertexAI()||(r=r.map(o=>Vs(o)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const i of r){if(typeof i!="object"||i===null||!("name"in i)||!("response"in i))throw new Error(`Could not parse function response, type '${typeof i}'.`);if(!e.isVertexAI()&&!("id"in i))throw new Error(DS)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},GS),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:aE(e)}:n={realtimeInput:sE(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function BS(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function VS(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mf=10;function gf(t){var e,n,r;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(const s of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(Xr(s)){o=!0;break}if(!o)return!0;const i=(r=t==null?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return i&&(i<0||!Number.isInteger(i))||i==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",i),!0):!1}function Xr(t){return"callTool"in t&&typeof t.callTool=="function"}function jS(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(o=>Xr(o)))!==null&&r!==void 0?r:!1}function yf(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((r,o)=>{if(Xr(r))return;const i=r;i.functionDeclarations&&i.functionDeclarations.length>0&&n.push(o)}),n}function vf(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class zS extends On{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var r,o,i,s,a;const u=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!jS(n)||gf(n.config))return await this.generateContentInternal(u);const d=yf(n);if(d.length>0){const x=d.map(w=>`tools[${w}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${x}.`)}let h,m;const p=nn(u.contents),g=(i=(o=(r=u.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&i!==void 0?i:mf;let E=0;for(;E<g&&(h=await this.generateContentInternal(u),!(!h.functionCalls||h.functionCalls.length===0));){const x=h.candidates[0].content,w=[];for(const y of(a=(s=n.config)===null||s===void 0?void 0:s.tools)!==null&&a!==void 0?a:[])if(Xr(y)){const S=await y.callTool(h.functionCalls);w.push(...S)}E++,m={role:"user",parts:w},u.contents=nn(u.contents),u.contents.push(x),u.contents.push(m),vf(u.config)&&(p.push(x),p.push(m))}return vf(u.config)&&(h.automaticFunctionCallingHistory=p),h},this.generateContentStream=async n=>{var r,o,i,s,a;if(this.maybeMoveToResponseJsonSchem(n),gf(n.config)){const m=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(m)}const u=yf(n);if(u.length>0){const m=u.map(p=>`tools[${p}]`).join(", ");throw new Error(`Incompatible tools found at ${m}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const d=(i=(o=(r=n==null?void 0:n.config)===null||r===void 0?void 0:r.toolConfig)===null||o===void 0?void 0:o.functionCallingConfig)===null||i===void 0?void 0:i.streamFunctionCallArguments,h=(a=(s=n==null?void 0:n.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(d&&!h)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var o;let i;const s=[];if(r!=null&&r.generatedImages)for(const u of r.generatedImages)u&&(u!=null&&u.safetyAttributes)&&((o=u==null?void 0:u.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?i=u==null?void 0:u.safetyAttributes:s.push(u);let a;return i?a={generatedImages:s,positivePromptSafetyAttributes:i,sdkHttpResponse:r.sdkHttpResponse}:a={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},a}),this.list=async n=>{var r;const s={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new Sr(Mn.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(s),s)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const o={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(o)},this.generateVideos=async n=>{var r,o,i,s,a,u;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((o=n.video)===null||o===void 0)&&o.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((s=(i=n.source)===null||i===void 0?void 0:i.video)===null||s===void 0)&&s.uri&&(!((u=(a=n.source)===null||a===void 0?void 0:a.video)===null||u===void 0)&&u.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,o;const i=(n=e.config)===null||n===void 0?void 0:n.tools;if(!i)return e;const s=await Promise.all(i.map(async u=>Xr(u)?await u.tool():u)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(a.config.tools=s,e.config&&e.config.tools&&hm(e.config.tools)){const u=(o=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&o!==void 0?o:{};let d=Object.assign({},u);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),pm(d),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return a}async initAfcToolsMap(e){var n,r,o;const i=new Map;for(const s of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(Xr(s)){const a=s,u=await a.tool();for(const d of(o=u.functionDeclarations)!==null&&o!==void 0?o:[]){if(!d.name)throw new Error("Function declaration name is required.");if(i.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);i.set(d.name,a)}}return i}async processAfcStream(e){var n,r,o;const i=(o=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&o!==void 0?o:mf;let s=!1,a=0;const u=await this.initAfcToolsMap(e);return function(d,h,m){return hn(this,arguments,function*(){for(var p,g,E,x,w,y;a<i;){s&&(a++,s=!1);const I=yield Oe(d.processParamsMaybeAddMcpUsage(m)),L=yield Oe(d.generateContentStreamInternal(I)),P=[],D=[];try{for(var v=!0,S=(g=void 0,pn(L)),N;N=yield Oe(S.next()),p=N.done,!p;v=!0){x=N.value,v=!1;const M=x;if(yield yield Oe(M),M.candidates&&(!((w=M.candidates[0])===null||w===void 0)&&w.content)){D.push(M.candidates[0].content);for(const j of(y=M.candidates[0].content.parts)!==null&&y!==void 0?y:[])if(a<i&&j.functionCall){if(!j.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(j.functionCall.name)){const Q=yield Oe(h.get(j.functionCall.name).callTool([j.functionCall]));P.push(...Q)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${j.functionCall.name}`)}}}}catch(M){g={error:M}}finally{try{!v&&!p&&(E=S.return)&&(yield Oe(E.call(S)))}finally{if(g)throw g.error}}if(P.length>0){s=!0;const M=new Eo;M.candidates=[{content:{role:"user",parts:P}}],yield yield Oe(M);const j=[];j.push(...D),j.push({role:"user",parts:P});const Q=nn(m.contents).concat(j);m.contents=Q}else break}})}(this,u,e)}async generateContentInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=df(this.apiClient,e);return a=Te("{model}:generateContent",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=hf(h),p=new Eo;return Object.assign(p,m),p})}else{const d=cf(this.apiClient,e);return a=Te("{model}:generateContent",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=ff(h),p=new Eo;return Object.assign(p,m),p})}}async generateContentStreamInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=df(this.apiClient,e);return a=Te("{model}:streamGenerateContent?alt=sse",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(m){return hn(this,arguments,function*(){var p,g,E,x;try{for(var w=!0,y=pn(m),v;v=yield Oe(y.next()),p=v.done,!p;w=!0){x=v.value,w=!1;const S=x,N=hf(yield Oe(S.json()));N.sdkHttpResponse={headers:S.headers};const I=new Eo;Object.assign(I,N),yield yield Oe(I)}}catch(S){g={error:S}}finally{try{!w&&!p&&(E=y.return)&&(yield Oe(E.call(y)))}finally{if(g)throw g.error}}})})}else{const d=cf(this.apiClient,e);return a=Te("{model}:streamGenerateContent?alt=sse",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(m){return hn(this,arguments,function*(){var p,g,E,x;try{for(var w=!0,y=pn(m),v;v=yield Oe(y.next()),p=v.done,!p;w=!0){x=v.value,w=!1;const S=x,N=ff(yield Oe(S.json()));N.sdkHttpResponse={headers:S.headers};const I=new Eo;Object.assign(I,N),yield yield Oe(I)}}catch(S){g={error:S}}finally{try{!w&&!p&&(E=y.return)&&(yield Oe(E.call(y)))}finally{if(g)throw g.error}}})})}}async embedContent(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=FE(this.apiClient,e);return a=Te("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=HE(h),p=new Wd;return Object.assign(p,m),p})}else{const d=UE(this.apiClient,e);return a=Te("{model}:batchEmbedContents",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=GE(h),p=new Wd;return Object.assign(p,m),p})}}async generateImagesInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=XE(this.apiClient,e);return a=Te("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=QE(h),p=new qd;return Object.assign(p,m),p})}else{const d=JE(this.apiClient,e);return a=Te("{model}:predict",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=ZE(h),p=new qd;return Object.assign(p,m),p})}}async editImageInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=ME(this.apiClient,e);return i=Te("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>{const d=LE(u),h=new Vy;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=XT(this.apiClient,e);return i=Te("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>{const d=ZT(u),h=new jy;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=PT(this.apiClient,e);return i=Te("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const d=MT(u),h=new zy;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=GT(this.apiClient,e);return i=Te("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const d=HT(u),h=new $y;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=gT(this.apiClient,e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>wl(h))}else{const d=mT(this.apiClient,e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Sl(h))}}async listInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=NT(this.apiClient,e);return a=Te("{models_url}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=bT(h),p=new Yd;return Object.assign(p,m),p})}else{const d=CT(this.apiClient,e);return a=Te("{models_url}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=IT(h),p=new Yd;return Object.assign(p,m),p})}}async update(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=KT(this.apiClient,e);return a=Te("{model}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>wl(h))}else{const d=YT(this.apiClient,e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Sl(h))}}async delete(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=AE(this.apiClient,e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=kE(h),p=new Kd;return Object.assign(p,m),p})}else{const d=_E(this.apiClient,e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=RE(h),p=new Kd;return Object.assign(p,m),p})}}async countTokens(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=NE(this.apiClient,e);return a=Te("{model}:countTokens",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=bE(h),p=new Jd;return Object.assign(p,m),p})}else{const d=CE(this.apiClient,e);return a=Te("{model}:countTokens",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=IE(h),p=new Jd;return Object.assign(p,m),p})}}async computeTokens(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=yE(this.apiClient,e);return i=Te("{model}:computeTokens",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>{const d=vE(u),h=new Wy;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=iT(this.apiClient,e);return a=Te("{model}:predictLongRunning",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>{const m=rT(h),p=new xs;return Object.assign(p,m),p})}else{const d=oT(this.apiClient,e);return a=Te("{model}:predictLongRunning",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const m=nT(h),p=new xs;return Object.assign(p,m),p})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $S extends On{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=n.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async get(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=n.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=Dy(e);return a=Te("{operationName}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s}else{const d=Oy(e);return a=Te("{operationName}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s}}async fetchPredictVideosOperationInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=_y(e);return i=Te("{resourceName}:fetchPredictOperation",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function WS(t){const e={},n=l(t,["data"]);if(n!=null&&c(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function qS(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>nw(i))),c(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function YS(t,e,n){const r={},o=l(e,["expireTime"]);n!==void 0&&o!=null&&c(n,["expireTime"],o);const i=l(e,["newSessionExpireTime"]);n!==void 0&&i!=null&&c(n,["newSessionExpireTime"],i);const s=l(e,["uses"]);n!==void 0&&s!=null&&c(n,["uses"],s);const a=l(e,["liveConnectConstraints"]);n!==void 0&&a!=null&&c(n,["bidiGenerateContentSetup"],tw(t,a));const u=l(e,["lockAdditionalFields"]);return n!==void 0&&u!=null&&c(n,["fieldMask"],u),r}function KS(t,e){const n={},r=l(e,["config"]);return r!=null&&c(n,["config"],YS(t,r,n)),n}function JS(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&c(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function XS(t){const e={},n=l(t,["id"]);n!=null&&c(e,["id"],n);const r=l(t,["args"]);r!=null&&c(e,["args"],r);const o=l(t,["name"]);if(o!=null&&c(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function ZS(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&c(e,["enableWidget"],n),e}function QS(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&c(e,["timeRangeFilter"],n),e}function ew(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],r);const o=l(t,["responseModalities"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","responseModalities"],o);const i=l(t,["temperature"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","temperature"],i);const s=l(t,["topP"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","topP"],s);const a=l(t,["topK"]);e!==void 0&&a!=null&&c(e,["setup","generationConfig","topK"],a);const u=l(t,["maxOutputTokens"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","maxOutputTokens"],u);const d=l(t,["mediaResolution"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","mediaResolution"],d);const h=l(t,["seed"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","seed"],h);const m=l(t,["speechConfig"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","speechConfig"],Mu(m));const p=l(t,["thinkingConfig"]);e!==void 0&&p!=null&&c(e,["setup","generationConfig","thinkingConfig"],p);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],g);const E=l(t,["systemInstruction"]);e!==void 0&&E!=null&&c(e,["setup","systemInstruction"],qS(_t(E)));const x=l(t,["tools"]);if(e!==void 0&&x!=null){let L=uo(x);Array.isArray(L)&&(L=L.map(P=>ow(lo(P)))),c(e,["setup","tools"],L)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&c(e,["setup","sessionResumption"],rw(w));const y=l(t,["inputAudioTranscription"]);e!==void 0&&y!=null&&c(e,["setup","inputAudioTranscription"],y);const v=l(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&c(e,["setup","outputAudioTranscription"],v);const S=l(t,["realtimeInputConfig"]);e!==void 0&&S!=null&&c(e,["setup","realtimeInputConfig"],S);const N=l(t,["contextWindowCompression"]);e!==void 0&&N!=null&&c(e,["setup","contextWindowCompression"],N);const I=l(t,["proactivity"]);if(e!==void 0&&I!=null&&c(e,["setup","proactivity"],I),l(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function tw(t,e){const n={},r=l(e,["model"]);r!=null&&c(n,["setup","model"],We(t,r));const o=l(e,["config"]);return o!=null&&c(n,["config"],ew(o,n)),n}function nw(t){const e={},n=l(t,["mediaResolution"]);n!=null&&c(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&c(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&c(e,["fileData"],JS(i));const s=l(t,["functionCall"]);s!=null&&c(e,["functionCall"],XS(s));const a=l(t,["functionResponse"]);a!=null&&c(e,["functionResponse"],a);const u=l(t,["inlineData"]);u!=null&&c(e,["inlineData"],WS(u));const d=l(t,["text"]);d!=null&&c(e,["text"],d);const h=l(t,["thought"]);h!=null&&c(e,["thought"],h);const m=l(t,["thoughtSignature"]);m!=null&&c(e,["thoughtSignature"],m);const p=l(t,["videoMetadata"]);return p!=null&&c(e,["videoMetadata"],p),e}function rw(t){const e={},n=l(t,["handle"]);if(n!=null&&c(e,["handle"],n),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function ow(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&c(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&c(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&c(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&c(e,["googleMaps"],ZS(a));const u=l(t,["googleSearch"]);u!=null&&c(e,["googleSearch"],QS(u));const d=l(t,["urlContext"]);return d!=null&&c(e,["urlContext"],d),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function iw(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const o=Object.keys(r).map(i=>`${n}.${i}`);e.push(...o)}else e.push(n)}return e.join(",")}function sw(t,e){let n=null;const r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const i=r.setup;typeof i=="object"&&i!==null?(t.bidiGenerateContentSetup=i,n=i):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;const o=t.fieldMask;if(n){const i=iw(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)i?t.fieldMask=i:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let a=[];o.length>0&&(a=o.map(d=>s.includes(d)?`generationConfig.${d}`:d));const u=[];i&&u.push(i),a.length>0&&u.push(...a),u.length>0?t.fieldMask=u.join(","):delete t.fieldMask}else delete t.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?t.fieldMask=o.join(","):delete t.fieldMask;return t}class aw extends On{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const a=KS(this.apiClient,e);i=Te("auth_tokens",a._url),s=a._query,delete a.config,delete a._url,delete a._query;const u=sw(a,e.config);return o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function lw(t,e){const n={},r=l(t,["force"]);return e!==void 0&&r!=null&&c(e,["_query","force"],r),n}function uw(t){const e={},n=l(t,["name"]);n!=null&&c(e,["_url","name"],n);const r=l(t,["config"]);return r!=null&&lw(r,e),e}function cw(t){const e={},n=l(t,["name"]);return n!=null&&c(e,["_url","name"],n),e}function dw(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&c(e,["_query","pageToken"],o),n}function fw(t){const e={},n=l(t,["parent"]);n!=null&&c(e,["_url","parent"],n);const r=l(t,["config"]);return r!=null&&dw(r,e),e}function hw(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&c(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const o=l(t,["documents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),c(e,["documents"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class pw extends On{constructor(e){super(),this.apiClient=e,this.list=async n=>new Sr(Mn.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=cw(e);return i=Te("{name}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>u)}}async delete(e){var n,r;let o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=uw(e);o=Te("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=fw(e);return i=Te("{parent}/documents",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const d=hw(u),h=new qy;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mw extends On{constructor(e,n=new pw(e)){super(),this.apiClient=e,this.documents=n,this.list=async(r={})=>new Sr(Mn.PAGED_ITEM_FILE_SEARCH_STORES,o=>this.listInternal(o),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=iS(e);return i=Te("fileSearchStores",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>u)}}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=lS(e);return i=Te("{name}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>u)}}async delete(e){var n,r;let o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=aS(e);o=Te("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=pS(e);return i=Te("fileSearchStores",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const d=mS(u),h=new Yy;return Object.assign(h,d),h})}}async uploadToFileSearchStoreInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=gS(e);return i=Te("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const d=yS(u),h=new Ky;return Object.assign(h,d),h})}}async importFile(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=dS(e);return i=Te("{file_search_store_name}:importFile",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const d=cS(u),h=new _u;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let mm=function(){const{crypto:t}=globalThis;if(t!=null&&t.randomUUID)return mm=t.randomUUID.bind(t),t.randomUUID();const e=new Uint8Array(1),n=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))};const gw=()=>mm();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Nl(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}const Il=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){const e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class sn extends Error{}class Lt extends sn{constructor(e,n,r,o){super(`${Lt.makeMessage(e,n,r)}`),this.status=e,this.headers=o,this.error=n}static makeMessage(e,n,r){const o=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,n,r,o){if(!e||!o)return new $s({message:r,cause:Il(n)});const i=n;return e===400?new ym(e,i,r,o):e===401?new vm(e,i,r,o):e===403?new xm(e,i,r,o):e===404?new Em(e,i,r,o):e===409?new Tm(e,i,r,o):e===422?new Sm(e,i,r,o):e===429?new wm(e,i,r,o):e>=500?new Cm(e,i,r,o):new Lt(e,i,r,o)}}class bl extends Lt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class $s extends Lt{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class gm extends $s{constructor({message:e}={}){super({message:e??"Request timed out."})}}class ym extends Lt{}class vm extends Lt{}class xm extends Lt{}class Em extends Lt{}class Tm extends Lt{}class Sm extends Lt{}class wm extends Lt{}class Cm extends Lt{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const yw=/^[a-z][a-z0-9+.-]*:/i,vw=t=>yw.test(t);let _l=t=>(_l=Array.isArray,_l(t));const xw=_l;let Ew=xw;const xf=Ew;function Tw(t){if(!t)return!0;for(const e in t)return!1;return!0}function Sw(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const ww=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new sn(`${t} must be an integer`);if(e<0)throw new sn(`${t} must be a positive integer`);return e},Cw=t=>{try{return JSON.parse(t)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Nw=t=>new Promise(e=>setTimeout(e,t));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const br="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Iw(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const bw=()=>{var t,e,n,r,o;const i=Iw();if(i==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":br,"X-Stainless-OS":Tf(Deno.build.os),"X-Stainless-Arch":Ef(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(t=Deno.version)===null||t===void 0?void 0:t.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":br,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(i==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":br,"X-Stainless-OS":Tf((n=globalThis.process.platform)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Arch":Ef((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(o=globalThis.process.version)!==null&&o!==void 0?o:"unknown"};const s=_w();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":br,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":br,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function _w(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const o=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:e,version:`${o}.${i}.${s}`}}}return null}const Ef=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",Tf=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let Ci;const Aw=()=>Ci??(Ci=bw());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Rw(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Nm(...t){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function kw(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return Nm({start(){},async pull(n){const{done:r,value:o}=await e.next();r?n.close():n.enqueue(o)},async cancel(){var n;await((n=e.return)===null||n===void 0?void 0:n.call(e))}})}function Im(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Pw(t){var e,n;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((n=(e=t[Symbol.asyncIterator]()).return)===null||n===void 0?void 0:n.call(e));return}const r=t.getReader(),o=r.cancel();r.releaseLock(),await o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Mw=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bm=()=>{var t;if(typeof File>"u"){const{process:e}=globalThis,n=typeof((t=e==null?void 0:e.versions)===null||t===void 0?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Ta(t,e,n){return bm(),new File(t,e??"unknown_file",n)}function Lw(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}const Ow=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _m=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",Dw=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&_m(t),Uw=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function Fw(t,e,n){if(bm(),t=await t,Dw(t))return t instanceof File?t:Ta([await t.arrayBuffer()],t.name);if(Uw(t)){const o=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),Ta(await Al(o),e,n)}const r=await Al(t);if(e||(e=Lw(t)),!(n!=null&&n.type)){const o=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof o=="string"&&(n=Object.assign(Object.assign({},n),{type:o}))}return Ta(r,e,n)}async function Al(t){var e,n,r,o,i;let s=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)s.push(t);else if(_m(t))s.push(t instanceof Blob?t:await t.arrayBuffer());else if(Ow(t))try{for(var a=!0,u=pn(t),d;d=await u.next(),e=d.done,!e;a=!0){o=d.value,a=!1;const h=o;s.push(...await Al(h))}}catch(h){n={error:h}}finally{try{!a&&!e&&(r=u.return)&&await r.call(u)}finally{if(n)throw n.error}}else{const h=(i=t==null?void 0:t.constructor)===null||i===void 0?void 0:i.name;throw new Error(`Unexpected data type: ${typeof t}${h?`; constructor: ${h}`:""}${Gw(t)}`)}return s}function Gw(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Am{constructor(e){this._client=e}}Am._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Rm(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Sf=Object.freeze(Object.create(null)),Hw=(t=Rm)=>function(n,...r){if(n.length===1)return n[0];let o=!1;const i=[],s=n.reduce((h,m,p)=>{var g,E,x;/[?#]/.test(m)&&(o=!0);const w=r[p];let y=(o?encodeURIComponent:t)(""+w);return p!==r.length&&(w==null||typeof w=="object"&&w.toString===((x=Object.getPrototypeOf((E=Object.getPrototypeOf((g=w.hasOwnProperty)!==null&&g!==void 0?g:Sf))!==null&&E!==void 0?E:Sf))===null||x===void 0?void 0:x.toString))&&(y=w+"",i.push({start:h.length+m.length,length:y.length,error:`Value of type ${Object.prototype.toString.call(w).slice(8,-1)} is not a valid path parameter`})),h+m+(p===r.length?"":y)},""),a=s.split(/[?#]/,1)[0],u=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let d;for(;(d=u.exec(a))!==null;)i.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(i.sort((h,m)=>h.start-m.start),i.length>0){let h=0;const m=i.reduce((p,g)=>{const E=" ".repeat(g.start-h),x="^".repeat(g.length);return h=g.start+g.length,p+E+x},"");throw new sn(`Path parameters result in path with invalid segments:
${i.map(p=>p.error).join(`
`)}
${s}
${m}`)}return s},Ni=Hw(Rm);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class km extends Am{create(e,n){var r;const{api_version:o=this._client.apiVersion}=e,i=Ts(e,["api_version"]);if("model"in i&&"agent_config"in i)throw new sn("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new sn("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Ni`/${o}/interactions`,Object.assign(Object.assign({body:i},n),{stream:(r=e.stream)!==null&&r!==void 0?r:!1}))}delete(e,n={},r){const{api_version:o=this._client.apiVersion}=n??{};return this._client.delete(Ni`/${o}/interactions/${e}`,r)}cancel(e,n={},r){const{api_version:o=this._client.apiVersion}=n??{};return this._client.post(Ni`/${o}/interactions/${e}/cancel`,r)}get(e,n={},r){var o;const i=n??{},{api_version:s=this._client.apiVersion}=i,a=Ts(i,["api_version"]);return this._client.get(Ni`/${s}/interactions/${e}`,Object.assign(Object.assign({query:a},r),{stream:(o=n==null?void 0:n.stream)!==null&&o!==void 0?o:!1}))}}km._key=Object.freeze(["interactions"]);class Pm extends km{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bw(t){let e=0;for(const o of t)e+=o.length;const n=new Uint8Array(e);let r=0;for(const o of t)n.set(o,r),r+=o.length;return n}let Ii;function Ou(t){let e;return(Ii??(e=new globalThis.TextEncoder,Ii=e.encode.bind(e)))(t)}let bi;function wf(t){let e;return(bi??(e=new globalThis.TextDecoder,bi=e.decode.bind(e)))(t)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ws{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Ou(e):e;this.buffer=Bw([this.buffer,n]);const r=[];let o;for(;(o=Vw(this.buffer,this.carriageReturnIndex))!=null;){if(o.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=o.index;continue}if(this.carriageReturnIndex!=null&&(o.index!==this.carriageReturnIndex+1||o.carriage)){r.push(wf(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const i=this.carriageReturnIndex!==null?o.preceding-1:o.preceding,s=wf(this.buffer.subarray(0,i));r.push(s),this.buffer=this.buffer.subarray(o.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}}Ws.NEWLINE_CHARS=new Set([`
`,"\r"]);Ws.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Vw(t,e){for(let o=e??0;o<t.length;o++){if(t[o]===10)return{preceding:o,index:o+1,carriage:!1};if(t[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function jw(t){for(let r=0;r<t.length-1;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ss={off:0,error:200,warn:300,info:400,debug:500},Cf=(t,e,n)=>{if(t){if(Sw(Ss,t))return t;kt(n).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(Ss))}`)}};function Io(){}function _i(t,e,n){return!e||Ss[t]>Ss[n]?Io:e[t].bind(e)}const zw={error:Io,warn:Io,info:Io,debug:Io};let Nf=new WeakMap;function kt(t){var e;const n=t.logger,r=(e=t.logLevel)!==null&&e!==void 0?e:"off";if(!n)return zw;const o=Nf.get(n);if(o&&o[0]===r)return o[1];const i={error:_i("error",n,r),warn:_i("warn",n,r),info:_i("info",n,r),debug:_i("debug",n,r)};return Nf.set(n,[r,i]),i}const lr=t=>(t.options&&(t.options=Object.assign({},t.options),delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,n])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class jr{constructor(e,n,r){this.iterator=e,this.controller=n,this.client=r}static fromSSEResponse(e,n,r){let o=!1;const i=r?kt(r):console;function s(){return hn(this,arguments,function*(){var u,d,h,m;if(o)throw new sn("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let p=!1;try{try{for(var g=!0,E=pn($w(e,n)),x;x=yield Oe(E.next()),u=x.done,!u;g=!0){m=x.value,g=!1;const w=m;if(!p)if(w.data.startsWith("[DONE]")){p=!0;continue}else try{yield yield Oe(JSON.parse(w.data))}catch(y){throw i.error("Could not parse message into JSON:",w.data),i.error("From chunk:",w.raw),y}}}catch(w){d={error:w}}finally{try{!g&&!u&&(h=E.return)&&(yield Oe(h.call(E)))}finally{if(d)throw d.error}}p=!0}catch(w){if(Nl(w))return yield Oe(void 0);throw w}finally{p||n.abort()}})}return new jr(s,n,r)}static fromReadableStream(e,n,r){let o=!1;function i(){return hn(this,arguments,function*(){var u,d,h,m;const p=new Ws,g=Im(e);try{for(var E=!0,x=pn(g),w;w=yield Oe(x.next()),u=w.done,!u;E=!0){m=w.value,E=!1;const y=m;for(const v of p.decode(y))yield yield Oe(v)}}catch(y){d={error:y}}finally{try{!E&&!u&&(h=x.return)&&(yield Oe(h.call(x)))}finally{if(d)throw d.error}}for(const y of p.flush())yield yield Oe(y)})}function s(){return hn(this,arguments,function*(){var u,d,h,m;if(o)throw new sn("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let p=!1;try{try{for(var g=!0,E=pn(i()),x;x=yield Oe(E.next()),u=x.done,!u;g=!0){m=x.value,g=!1;const w=m;p||w&&(yield yield Oe(JSON.parse(w)))}}catch(w){d={error:w}}finally{try{!g&&!u&&(h=E.return)&&(yield Oe(h.call(E)))}finally{if(d)throw d.error}}p=!0}catch(w){if(Nl(w))return yield Oe(void 0);throw w}finally{p||n.abort()}})}return new jr(s,n,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),o=i=>({next:()=>{if(i.length===0){const s=r.next();e.push(s),n.push(s)}return i.shift()}});return[new jr(()=>o(e),this.controller,this.client),new jr(()=>o(n),this.controller,this.client)]}toReadableStream(){const e=this;let n;return Nm({async start(){n=e[Symbol.asyncIterator]()},async pull(r){try{const{value:o,done:i}=await n.next();if(i)return r.close();const s=Ou(JSON.stringify(o)+`
`);r.enqueue(s)}catch(o){r.error(o)}},async cancel(){var r;await((r=n.return)===null||r===void 0?void 0:r.call(n))}})}}function $w(t,e){return hn(this,arguments,function*(){var r,o,i,s;if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new sn("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new sn("Attempted to iterate over a response with no body");const a=new qw,u=new Ws,d=Im(t.body);try{for(var h=!0,m=pn(Ww(d)),p;p=yield Oe(m.next()),r=p.done,!r;h=!0){s=p.value,h=!1;const g=s;for(const E of u.decode(g)){const x=a.decode(E);x&&(yield yield Oe(x))}}}catch(g){o={error:g}}finally{try{!h&&!r&&(i=m.return)&&(yield Oe(i.call(m)))}finally{if(o)throw o.error}}for(const g of u.flush()){const E=a.decode(g);E&&(yield yield Oe(E))}})}function Ww(t){return hn(this,arguments,function*(){var n,r,o,i;let s=new Uint8Array;try{for(var a=!0,u=pn(t),d;d=yield Oe(u.next()),n=d.done,!n;a=!0){i=d.value,a=!1;const h=i;if(h==null)continue;const m=h instanceof ArrayBuffer?new Uint8Array(h):typeof h=="string"?Ou(h):h;let p=new Uint8Array(s.length+m.length);p.set(s),p.set(m,s.length),s=p;let g;for(;(g=jw(s))!==-1;)yield yield Oe(s.slice(0,g)),s=s.slice(g)}}catch(h){r={error:h}}finally{try{!a&&!n&&(o=u.return)&&(yield Oe(o.call(u)))}finally{if(r)throw r.error}}s.length>0&&(yield yield Oe(s))})}class qw{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,o]=Yw(e,":");return o.startsWith(" ")&&(o=o.substring(1)),n==="event"?this.event=o:n==="data"&&this.data.push(o),null}}function Yw(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function Kw(t,e){const{response:n,requestLogID:r,retryOfRequestLogID:o,startTime:i}=e,s=await(async()=>{var a;if(e.options.stream)return kt(t).debug("response",n.status,n.url,n.headers,n.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(n,e.controller,t):jr.fromSSEResponse(n,e.controller,t);if(n.status===204)return null;if(e.options.__binaryResponse)return n;const u=n.headers.get("content-type"),d=(a=u==null?void 0:u.split(";")[0])===null||a===void 0?void 0:a.trim();return(d==null?void 0:d.includes("application/json"))||(d==null?void 0:d.endsWith("+json"))?await n.json():await n.text()})();return kt(t).debug(`[${r}] response parsed`,lr({retryOfRequestLogID:o,url:n.url,status:n.status,body:s,durationMs:Date.now()-i})),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Du extends Promise{constructor(e,n,r=Kw){super(o=>{o(null)}),this.responsePromise=n,this.parseResponse=r,this.client=e}_thenUnwrap(e){return new Du(this.client,this.responsePromise,async(n,r)=>e(await this.parseResponse(n,r),r))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Mm=Symbol("brand.privateNullableHeaders");function*Jw(t){if(!t)return;if(Mm in t){const{values:r,nulls:o}=t;yield*r.entries();for(const i of o)yield[i,null];return}let e=!1,n;t instanceof Headers?n=t.entries():xf(t)?n=t:(e=!0,n=Object.entries(t??{}));for(let r of n){const o=r[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");const i=xf(r[1])?r[1]:[r[1]];let s=!1;for(const a of i)a!==void 0&&(e&&!s&&(s=!0,yield[o,null]),yield[o,a])}}const To=t=>{const e=new Headers,n=new Set;for(const r of t){const o=new Set;for(const[i,s]of Jw(r)){const a=i.toLowerCase();o.has(a)||(e.delete(i),o.add(a)),s===null?(e.delete(i),n.add(a)):(e.append(i,s),n.delete(a))}}return{[Mm]:!0,values:e,nulls:n}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Sa=t=>{var e,n,r,o,i,s;if(typeof globalThis.process<"u")return(r=(n=(e=Sy)===null||e===void 0?void 0:e[t])===null||n===void 0?void 0:n.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(s=(i=(o=globalThis.Deno.env)===null||o===void 0?void 0:o.get)===null||i===void 0?void 0:i.call(o,t))===null||s===void 0?void 0:s.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Lm;class qs{constructor(e){var n,r,o,i,s,a,u,{baseURL:d=Sa("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:h=(n=Sa("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:m="v1beta"}=e,p=Ts(e,["baseURL","apiKey","apiVersion"]);const g=Object.assign(Object.assign({apiKey:h,apiVersion:m},p),{baseURL:d||"https://generativelanguage.googleapis.com"});this.baseURL=g.baseURL,this.timeout=(r=g.timeout)!==null&&r!==void 0?r:qs.DEFAULT_TIMEOUT,this.logger=(o=g.logger)!==null&&o!==void 0?o:console;const E="warn";this.logLevel=E,this.logLevel=(s=(i=Cf(g.logLevel,"ClientOptions.logLevel",this))!==null&&i!==void 0?i:Cf(Sa("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&s!==void 0?s:E,this.fetchOptions=g.fetchOptions,this.maxRetries=(a=g.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(u=g.fetch)!==null&&u!==void 0?u:Rw(),this.encoder=Mw,this._options=g,this.apiKey=h,this.apiVersion=m,this.clientAdapter=g.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:n}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const n=To([e.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return To([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return To([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new sn(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${br}`}defaultIdempotencyKey(){return`stainless-node-retry-${gw()}`}makeStatusError(e,n,r,o){return Lt.generate(e,n,r,o)}buildURL(e,n,r){const o=!this.baseURLOverridden()&&r||this.baseURL,i=vw(e)?new URL(e):new URL(o+(o.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Tw(s)||(n=Object.assign(Object.assign({},s),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(i.search=this.stringifyQuery(n)),i.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const n=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(e,{url:n,options:r}){}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(o=>Object.assign({method:e,path:n},o)))}request(e,n=null){return new Du(this,this.makeRequest(e,n,void 0))}async makeRequest(e,n,r){var o,i,s;const a=await e,u=(o=a.maxRetries)!==null&&o!==void 0?o:this.maxRetries;n==null&&(n=u),await this.prepareOptions(a);const{req:d,url:h,timeout:m}=await this.buildRequest(a,{retryCount:u-n});await this.prepareRequest(d,{url:h,options:a});const p="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),g=r===void 0?"":`, retryOf: ${r}`,E=Date.now();if(kt(this).debug(`[${p}] sending request`,lr({retryOfRequestLogID:r,method:a.method,url:h,options:a,headers:d.headers})),!((i=a.signal)===null||i===void 0)&&i.aborted)throw new bl;const x=new AbortController,w=await this.fetchWithTimeout(h,d,m,x).catch(Il),y=Date.now();if(w instanceof globalThis.Error){const S=`retrying, ${n} attempts remaining`;if(!((s=a.signal)===null||s===void 0)&&s.aborted)throw new bl;const N=Nl(w)||/timed? ?out/i.test(String(w)+("cause"in w?String(w.cause):""));if(n)return kt(this).info(`[${p}] connection ${N?"timed out":"failed"} - ${S}`),kt(this).debug(`[${p}] connection ${N?"timed out":"failed"} (${S})`,lr({retryOfRequestLogID:r,url:h,durationMs:y-E,message:w.message})),this.retryRequest(a,n,r??p);throw kt(this).info(`[${p}] connection ${N?"timed out":"failed"} - error; no more retries left`),kt(this).debug(`[${p}] connection ${N?"timed out":"failed"} (error; no more retries left)`,lr({retryOfRequestLogID:r,url:h,durationMs:y-E,message:w.message})),N?new gm:new $s({cause:w})}const v=`[${p}${g}] ${d.method} ${h} ${w.ok?"succeeded":"failed"} with status ${w.status} in ${y-E}ms`;if(!w.ok){const S=await this.shouldRetry(w);if(n&&S){const M=`retrying, ${n} attempts remaining`;return await Pw(w.body),kt(this).info(`${v} - ${M}`),kt(this).debug(`[${p}] response error (${M})`,lr({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:y-E})),this.retryRequest(a,n,r??p,w.headers)}const N=S?"error; no more retries left":"error; not retryable";kt(this).info(`${v} - ${N}`);const I=await w.text().catch(M=>Il(M).message),L=Cw(I),P=L?void 0:I;throw kt(this).debug(`[${p}] response error (${N})`,lr({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,message:P,durationMs:Date.now()-E})),this.makeStatusError(w.status,L,P,w.headers)}return kt(this).info(v),kt(this).debug(`[${p}] response start`,lr({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:y-E})),{response:w,options:a,controller:x,requestLogID:p,retryOfRequestLogID:r,startTime:E}}async fetchWithTimeout(e,n,r,o){const i=n||{},{signal:s,method:a}=i,u=Ts(i,["signal","method"]);s&&s.addEventListener("abort",()=>o.abort());const d=setTimeout(()=>o.abort(),r),h=globalThis.ReadableStream&&u.body instanceof globalThis.ReadableStream||typeof u.body=="object"&&u.body!==null&&Symbol.asyncIterator in u.body,m=Object.assign(Object.assign(Object.assign({signal:o.signal},h?{duplex:"half"}:{}),{method:"GET"}),u);a&&(m.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,m)}finally{clearTimeout(d)}}async shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r,o){var i;let s;const a=o==null?void 0:o.get("retry-after-ms");if(a){const d=parseFloat(a);Number.isNaN(d)||(s=d)}const u=o==null?void 0:o.get("retry-after");if(u&&!s){const d=parseFloat(u);Number.isNaN(d)?s=Date.parse(u)-Date.now():s=d*1e3}if(!(s&&0<=s&&s<60*1e3)){const d=(i=e.maxRetries)!==null&&i!==void 0?i:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,d)}return await Nw(s),this.makeRequest(e,n-1,r)}calculateDefaultRetryTimeoutMillis(e,n){const i=n-e,s=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return s*a*1e3}async buildRequest(e,{retryCount:n=0}={}){var r,o,i;const s=Object.assign({},e),{method:a,path:u,query:d,defaultBaseURL:h}=s,m=this.buildURL(u,d,h);"timeout"in s&&ww("timeout",s.timeout),s.timeout=(r=s.timeout)!==null&&r!==void 0?r:this.timeout;const{bodyHeaders:p,body:g}=this.buildBody({options:s}),E=await this.buildHeaders({options:e,method:a,bodyHeaders:p,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:E},s.signal&&{signal:s.signal}),globalThis.ReadableStream&&g instanceof globalThis.ReadableStream&&{duplex:"half"}),g&&{body:g}),(o=this.fetchOptions)!==null&&o!==void 0?o:{}),(i=s.fetchOptions)!==null&&i!==void 0?i:{}),url:m,timeout:s.timeout}}async buildHeaders({options:e,method:n,bodyHeaders:r,retryCount:o}){let i={};this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const s=await this.authHeaders(e);let a=To([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(o)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),Aw()),this._options.defaultHeaders,r,e.headers,s]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:n}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=To([n]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:kw(e)}:this.encoder({body:e,headers:r})}}qs.DEFAULT_TIMEOUT=6e4;class mt extends qs{constructor(){super(...arguments),this.interactions=new Pm(this)}}Lm=mt;mt.GeminiNextGenAPIClient=Lm;mt.GeminiNextGenAPIClientError=sn;mt.APIError=Lt;mt.APIConnectionError=$s;mt.APIConnectionTimeoutError=gm;mt.APIUserAbortError=bl;mt.NotFoundError=Em;mt.ConflictError=Tm;mt.RateLimitError=wm;mt.BadRequestError=ym;mt.AuthenticationError=vm;mt.InternalServerError=Cm;mt.PermissionDeniedError=xm;mt.UnprocessableEntityError=Sm;mt.toFile=Fw;mt.Interactions=Pm;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Xw(t,e){const n={},r=l(t,["name"]);return r!=null&&c(n,["_url","name"],r),n}function Zw(t,e){const n={},r=l(t,["name"]);return r!=null&&c(n,["_url","name"],r),n}function Qw(t,e){const n={},r=l(t,["sdkHttpResponse"]);return r!=null&&c(n,["sdkHttpResponse"],r),n}function eC(t,e){const n={},r=l(t,["sdkHttpResponse"]);return r!=null&&c(n,["sdkHttpResponse"],r),n}function tC(t,e,n){const r={};if(l(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const o=l(t,["tunedModelDisplayName"]);if(e!==void 0&&o!=null&&c(e,["displayName"],o),l(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=l(t,["epochCount"]);e!==void 0&&i!=null&&c(e,["tuningTask","hyperparameters","epochCount"],i);const s=l(t,["learningRateMultiplier"]);if(s!=null&&c(r,["tuningTask","hyperparameters","learningRateMultiplier"],s),l(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(l(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(l(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const a=l(t,["batchSize"]);e!==void 0&&a!=null&&c(e,["tuningTask","hyperparameters","batchSize"],a);const u=l(t,["learningRate"]);if(e!==void 0&&u!=null&&c(e,["tuningTask","hyperparameters","learningRate"],u),l(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(l(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function nC(t,e,n){const r={};let o=l(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const g=l(t,["validationDataset"]);e!==void 0&&g!=null&&c(e,["supervisedTuningSpec"],If(g))}else if(o==="PREFERENCE_TUNING"){const g=l(t,["validationDataset"]);e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec"],If(g))}const i=l(t,["tunedModelDisplayName"]);e!==void 0&&i!=null&&c(e,["tunedModelDisplayName"],i);const s=l(t,["description"]);e!==void 0&&s!=null&&c(e,["description"],s);let a=l(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const g=l(t,["epochCount"]);e!==void 0&&g!=null&&c(e,["supervisedTuningSpec","hyperParameters","epochCount"],g)}else if(a==="PREFERENCE_TUNING"){const g=l(t,["epochCount"]);e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],g)}let u=l(n,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const g=l(t,["learningRateMultiplier"]);e!==void 0&&g!=null&&c(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],g)}else if(u==="PREFERENCE_TUNING"){const g=l(t,["learningRateMultiplier"]);e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],g)}let d=l(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const g=l(t,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&c(e,["supervisedTuningSpec","exportLastCheckpointOnly"],g)}else if(d==="PREFERENCE_TUNING"){const g=l(t,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],g)}let h=l(n,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const g=l(t,["adapterSize"]);e!==void 0&&g!=null&&c(e,["supervisedTuningSpec","hyperParameters","adapterSize"],g)}else if(h==="PREFERENCE_TUNING"){const g=l(t,["adapterSize"]);e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],g)}if(l(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(l(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const m=l(t,["labels"]);e!==void 0&&m!=null&&c(e,["labels"],m);const p=l(t,["beta"]);return e!==void 0&&p!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","beta"],p),r}function rC(t,e){const n={},r=l(t,["baseModel"]);r!=null&&c(n,["baseModel"],r);const o=l(t,["preTunedModel"]);o!=null&&c(n,["preTunedModel"],o);const i=l(t,["trainingDataset"]);i!=null&&pC(i);const s=l(t,["config"]);return s!=null&&tC(s,n),n}function oC(t,e){const n={},r=l(t,["baseModel"]);r!=null&&c(n,["baseModel"],r);const o=l(t,["preTunedModel"]);o!=null&&c(n,["preTunedModel"],o);const i=l(t,["trainingDataset"]);i!=null&&mC(i,n,e);const s=l(t,["config"]);return s!=null&&nC(s,n,e),n}function iC(t,e){const n={},r=l(t,["name"]);return r!=null&&c(n,["_url","name"],r),n}function sC(t,e){const n={},r=l(t,["name"]);return r!=null&&c(n,["_url","name"],r),n}function aC(t,e,n){const r={},o=l(t,["pageSize"]);e!==void 0&&o!=null&&c(e,["_query","pageSize"],o);const i=l(t,["pageToken"]);e!==void 0&&i!=null&&c(e,["_query","pageToken"],i);const s=l(t,["filter"]);return e!==void 0&&s!=null&&c(e,["_query","filter"],s),r}function lC(t,e,n){const r={},o=l(t,["pageSize"]);e!==void 0&&o!=null&&c(e,["_query","pageSize"],o);const i=l(t,["pageToken"]);e!==void 0&&i!=null&&c(e,["_query","pageToken"],i);const s=l(t,["filter"]);return e!==void 0&&s!=null&&c(e,["_query","filter"],s),r}function uC(t,e){const n={},r=l(t,["config"]);return r!=null&&aC(r,n),n}function cC(t,e){const n={},r=l(t,["config"]);return r!=null&&lC(r,n),n}function dC(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&c(n,["sdkHttpResponse"],r);const o=l(t,["nextPageToken"]);o!=null&&c(n,["nextPageToken"],o);const i=l(t,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>Om(a))),c(n,["tuningJobs"],s)}return n}function fC(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&c(n,["sdkHttpResponse"],r);const o=l(t,["nextPageToken"]);o!=null&&c(n,["nextPageToken"],o);const i=l(t,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>Rl(a))),c(n,["tuningJobs"],s)}return n}function hC(t,e){const n={},r=l(t,["name"]);r!=null&&c(n,["model"],r);const o=l(t,["name"]);return o!=null&&c(n,["endpoint"],o),n}function pC(t,e){const n={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=l(t,["examples"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),c(n,["examples","examples"],o)}return n}function mC(t,e,n){const r={};let o=l(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const s=l(t,["gcsUri"]);e!==void 0&&s!=null&&c(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(o==="PREFERENCE_TUNING"){const s=l(t,["gcsUri"]);e!==void 0&&s!=null&&c(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}let i=l(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const s=l(t,["vertexDatasetResource"]);e!==void 0&&s!=null&&c(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(i==="PREFERENCE_TUNING"){const s=l(t,["vertexDatasetResource"]);e!==void 0&&s!=null&&c(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}if(l(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function Om(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&c(n,["sdkHttpResponse"],r);const o=l(t,["name"]);o!=null&&c(n,["name"],o);const i=l(t,["state"]);i!=null&&c(n,["state"],Xp(i));const s=l(t,["createTime"]);s!=null&&c(n,["createTime"],s);const a=l(t,["tuningTask","startTime"]);a!=null&&c(n,["startTime"],a);const u=l(t,["tuningTask","completeTime"]);u!=null&&c(n,["endTime"],u);const d=l(t,["updateTime"]);d!=null&&c(n,["updateTime"],d);const h=l(t,["description"]);h!=null&&c(n,["description"],h);const m=l(t,["baseModel"]);m!=null&&c(n,["baseModel"],m);const p=l(t,["_self"]);return p!=null&&c(n,["tunedModel"],hC(p)),n}function Rl(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&c(n,["sdkHttpResponse"],r);const o=l(t,["name"]);o!=null&&c(n,["name"],o);const i=l(t,["state"]);i!=null&&c(n,["state"],Xp(i));const s=l(t,["createTime"]);s!=null&&c(n,["createTime"],s);const a=l(t,["startTime"]);a!=null&&c(n,["startTime"],a);const u=l(t,["endTime"]);u!=null&&c(n,["endTime"],u);const d=l(t,["updateTime"]);d!=null&&c(n,["updateTime"],d);const h=l(t,["error"]);h!=null&&c(n,["error"],h);const m=l(t,["description"]);m!=null&&c(n,["description"],m);const p=l(t,["baseModel"]);p!=null&&c(n,["baseModel"],p);const g=l(t,["tunedModel"]);g!=null&&c(n,["tunedModel"],g);const E=l(t,["preTunedModel"]);E!=null&&c(n,["preTunedModel"],E);const x=l(t,["supervisedTuningSpec"]);x!=null&&c(n,["supervisedTuningSpec"],x);const w=l(t,["preferenceOptimizationSpec"]);w!=null&&c(n,["preferenceOptimizationSpec"],w);const y=l(t,["tuningDataStats"]);y!=null&&c(n,["tuningDataStats"],y);const v=l(t,["encryptionSpec"]);v!=null&&c(n,["encryptionSpec"],v);const S=l(t,["partnerModelTuningSpec"]);S!=null&&c(n,["partnerModelTuningSpec"],S);const N=l(t,["customBaseModel"]);N!=null&&c(n,["customBaseModel"],N);const I=l(t,["experiment"]);I!=null&&c(n,["experiment"],I);const L=l(t,["labels"]);L!=null&&c(n,["labels"],L);const P=l(t,["outputUri"]);P!=null&&c(n,["outputUri"],P);const D=l(t,["pipelineJob"]);D!=null&&c(n,["pipelineJob"],D);const M=l(t,["serviceAccount"]);M!=null&&c(n,["serviceAccount"],M);const j=l(t,["tunedModelDisplayName"]);j!=null&&c(n,["tunedModelDisplayName"],j);const Q=l(t,["veoTuningSpec"]);return Q!=null&&c(n,["veoTuningSpec"],Q),n}function gC(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&c(n,["sdkHttpResponse"],r);const o=l(t,["name"]);o!=null&&c(n,["name"],o);const i=l(t,["metadata"]);i!=null&&c(n,["metadata"],i);const s=l(t,["done"]);s!=null&&c(n,["done"],s);const a=l(t,["error"]);return a!=null&&c(n,["error"],a),n}function If(t,e){const n={},r=l(t,["gcsUri"]);r!=null&&c(n,["validationDatasetUri"],r);const o=l(t,["vertexDatasetResource"]);return o!=null&&c(n,["validationDatasetUri"],o),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yC extends On{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Sr(Mn.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.get=async n=>await this.getInternal(n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const o={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(o.checkpointId=n.config.preTunedModelCheckpointId);const i=Object.assign(Object.assign({},n),{preTunedModel:o});return i.baseModel=void 0,await this.tuneInternal(i)}else{const o=Object.assign({},n);return await this.tuneInternal(o)}else{const o=Object.assign({},n),i=await this.tuneMldevInternal(o);let s="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?s=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(s=i.name.split("/operations/")[0]),{name:s,state:vl.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=sC(e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>Rl(h))}else{const d=iC(e);return a=Te("{name}",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>Om(h))}}async listInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=cC(e);return a=Te("tuningJobs",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=fC(h),p=new Xd;return Object.assign(p,m),p})}else{const d=uC(e);return a=Te("tunedModels",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=dC(h),p=new Xd;return Object.assign(p,m),p})}}async cancel(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const d=Zw(e);return a=Te("{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=eC(h),p=new Zd;return Object.assign(p,m),p})}else{const d=Xw(e);return a=Te("{name}:cancel",d._url),u=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:h.headers},p})),s.then(h=>{const m=Qw(h),p=new Zd;return Object.assign(p,m),p})}}async tuneInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=oC(e,e);return i=Te("tuningJobs",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>Rl(u))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=rC(e);return i=Te("tunedModels",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>gC(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vC{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const xC=1024*1024*8,EC=3,TC=1e3,SC=2,ws="x-goog-upload-status";async function wC(t,e,n){var r;const o=await Dm(t,e,n),i=await(o==null?void 0:o.json());if(((r=o==null?void 0:o.headers)===null||r===void 0?void 0:r[ws])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return i.file}async function CC(t,e,n){var r;const o=await Dm(t,e,n),i=await(o==null?void 0:o.json());if(((r=o==null?void 0:o.headers)===null||r===void 0?void 0:r[ws])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const s=$p(i),a=new Au;return Object.assign(a,s),a}async function Dm(t,e,n){var r,o;let i=0,s=0,a=new xl(new Response),u="upload";for(i=t.size;s<i;){const d=Math.min(xC,i-s),h=t.slice(s,s+d);s+d>=i&&(u+=", finalize");let m=0,p=TC;for(;m<EC&&(a=await n.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(s),"Content-Length":String(d)}}}),!(!((r=a==null?void 0:a.headers)===null||r===void 0)&&r[ws]));)m++,await IC(p),p=p*SC;if(s+=d,((o=a==null?void 0:a.headers)===null||o===void 0?void 0:o[ws])!=="active")break;if(i<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function NC(t){return{size:t.size,type:t.type}}function IC(t){return new Promise(e=>setTimeout(e,t))}class bC{async upload(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await wC(e,n,r)}async uploadToFileSearchStore(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await CC(e,n,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await NC(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _C{create(e,n,r){return new AC(e,n,r)}}class AC{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bf="x-goog-api-key";class RC{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(bf)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(bf,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const kC="gl-node/";class PC{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const n=new mt({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=n.interactions,this._interactions}constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const r=Iy(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const o=new RC(this.apiKey);this.apiClient=new NS({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:kC+"web",uploader:new bC,downloader:new vC}),this.models=new zS(this.apiClient),this.live=new FS(this.apiClient,o,new _C),this.batches=new tx(this.apiClient),this.chats=new Dx(this.models,this.apiClient),this.caches=new Mx(this.apiClient),this.files=new Wx(this.apiClient),this.operations=new $S(this.apiClient),this.authTokens=new aw(this.apiClient),this.tunings=new yC(this.apiClient),this.fileSearchStores=new mw(this.apiClient)}}const Qo={webtoon:{name:"  ",desc:"   +    ( )",prompt:"Premium Korean Historical Webtoon Style, High Quality 2D Digital Art, Crisp Line Art (Outlines), Cel Shading, Smooth Coloring, Beautiful Characters (Sparkling eyes, delicate features, pale skin, soft blush), Fusion Hanbok, Vibrant and Pastel tones, Webtoon Cover Art aesthetic, Sharp focus, No photorealism, Manhwa style"},animation:{name:"  ",desc:" ,  ",prompt:"2D cell animation style, Korean folklore atmosphere, flat shading, clean lines, Studio Ghibli inspired but Korean Joseon aesthetics"},inkwash:{name:"  (Modern)",desc:"   +   ",prompt:"Modern Korean emotional watercolor illustration, beautiful and handsome characters with modern aesthetic faces (sharp jawline, large expressive eyes, delicate features), soft transparent watercolor texture, ink spreading effect, dreamy and romantic atmosphere, detailed character design, NOT old traditional folk art style, NOT round ugly faces, pastel tones, artistic masterpiece"},fantasy:{name:"  ()",desc:"    ",prompt:"Korean Romance Fantasy Webnovel Cover Art Style, Semi-realistic Digital Illustration, Beautiful and Aesthetic, Highly Detailed Masterpiece, Soft Lighting, vibrant colors, dreamy atmosphere, detailed hair and eyes, **SMOOTH DIGITAL PAINTING**, **HIGHLY POLISHED**, **ILLUSTRATION QUALITY**, **NO ROUGH BRUSH STROKES**, **NOT PHOTOREALISTIC**, **NO REAL PHOTO**, **NO LIVE ACTION**, No Eye Contact with Camera"}},ii=[{category:Hr.HARM_CATEGORY_HARASSMENT,threshold:Br.BLOCK_NONE},{category:Hr.HARM_CATEGORY_HATE_SPEECH,threshold:Br.BLOCK_NONE},{category:Hr.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:Br.BLOCK_NONE},{category:Hr.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:Br.BLOCK_NONE}],gt=t=>{if(!t)throw new Error("API   .   'API  '    .");return new PC({apiKey:t})},wr=t=>{try{let e=t.replace(/```json\s*/g,"").replace(/```\s*/g,"");return e=e.trim(),JSON.parse(e)}catch(e){throw console.error("JSON Parse Error:",e,"Raw Text:",t),new Error("AI    . (JSON  )")}},MC=`
  [HISTORICAL VERIFICATION STANDARDS - PASSIVE CONSTRAINTS]
  * USE THIS ONLY TO VALIDATE EXISTING ELEMENTS.
  * DO NOT GENERATE THESE ITEMS UNLESS EXPLICITLY REQUESTED IN THE SCRIPT.

  1. ONDOL STRUCTURE (CRITICAL): 
     - Kitchen (Bu-eok) MUST be attached to the Main Room (An-bang). NO OUTDOOR ISLAND KITCHENS.
     - Kitchen floor is LOWER (dirt). Room floor is RAISED (wood/stone).
  2. DOORS & WINDOWS:
     - ROOM DOORS: White rice paper (Changhoji) on wooden lattice.
     - KITCHEN DOORS: Rough solid wood planks. NO PAPER.
  3. ROOF & WALLS:
     - Commoner: Mud walls + Rounded Straw Roof (Choga).
     - Noble: Plaster walls + Black Tile Roof (Giwa).
`,Um=`
  [HISTORICAL COSTUME VERIFICATION - DEFAULT STANDARDS]
  * These are general Joseon Dynasty standards. 
  * Use them to VALIDATE logic, but DO NOT OVERRIDE specific character designs in the script.
  * IF THE SCRIPT IS SILENT, assume these defaults.
  * IF THE SCRIPT SPECIFIES OTHERWISE (e.g. "Short hair"), FOLLOW THE SCRIPT.

  1. SHOES:
     - Jipsin (Straw shoes): COVERS TOES. No flip-flops.
     - Indoors: NO SHOES. White socks (Beoseon) only.
  2. CLOTHING:
     - Hanbok Skirt (Chima): **MUST BE FLOOR LENGTH (DRAGGING ON FLOOR)**. 
     - **[CRITICAL] SKIRT LENGTH**: The skirt MUST be long enough to **COVER THE FEET COMPLETELY**. It should drag on the floor.
     - **STRICT PROHIBITION**: ABSOLUTELY NO ANKLES VISIBLE. NO CALVES VISIBLE. NO SKIN VISIBLE BELOW WAIST.
     - **NEGATIVE PROMPT**: Short skirt, ankle length, exposed legs, calves visible, shin visible, mini skirt, western dress length, feet visible (unless walking).
     - Sleeves: Curved (Baerae).
  3. HAIR (DEFAULT STYLES):
     - Men (Married): Sangtu (Topknot) + Headband (Manggeon).
     - Men (Unmarried): Long braided hair (Daenggi).
     - Women (Married): Low Bun (Jjok-jin) with Binyeo (Hairpin).
     - Women (Unmarried): Long braided hair.
     - **NOTE**: Modern hairstyles (Bob, Perm) are RARE but allowed if script demands.
  
  4. **[CRITICAL] UNDRESSED STATE (SEE-THROUGH RAMIE)**:
     - When prompt says "Remove Jeogori", "Undressed", "Sleeping", "Transparent":
       - **ITEM**: **"Moshi-Jeoksam" (White Ramie Summer Shirt)**.
       - **TRANSPARENCY**: The fabric is **EXTREMELY SHEER / SEE-THROUGH**.
       - **VISUAL EFFECT**:
         1. **SKIN TONE**: The **flesh tone** of Shoulders, Arms, and **Upper Chest (Cleavage)** MUST be clearly visible through the white fabric.
         2. **UNDER-LAYER**: The **White Chest Band (Mal-gi)** wrapping the breasts is visible **BENEATH** the sheer shirt.
         3. **RIBBON (Goreum)**: Even the chest ribbon is **TRANSPARENT WHITE RAMIE**.
       - **SILHOUETTE**: A white misty veil over the skin. Not opaque.
`,LC=`
  [HISTORICAL SITTING ETIQUETTE & POSTURE RULES]
  * STRICTLY FOLLOW Social Hierarchy and Situation.
  
  1. **DEFAULT POSTURE (FLOOR SITTING)**:
     - **Yangban (Nobles/Elders)**: Sit **CROSS-LEGGED** (Yangban-dari / Agura). 
       - NEVER kneel unless in front of the King or in deep apology.
     - **Commoners/Subordinates/Children**: 
       - If informal/relaxed: Cross-legged.
       - If formal/polite (e.g., in front of Father/Master): **KNEELING** (Mureup-kkul-gi).
  
  2. **HIERARCHICAL CONTEXT (CRITICAL)**:
     - **Father vs Son**: 
       - **FATHER**: Sits **CROSS-LEGGED** (Comfortable authority).
       - **SON**: Sits **KNEELING** (Respectful attention).
       - **NEVER**: Father kneeling before Son. (Unless Father is begging for forgiveness).
     - **Master vs Servant**:
       - Master: Cross-legged.
       - Servant: Standing (head bowed) OR Kneeling on floor.
  
  3. **GENDER SPECIFICS**:
     - **Women (Noble/Commoner)**: Generally sit with knees bent to side (comfortable) or Kneeling (formal). Avoid wide cross-legged spread (considered masculine/rude in formal settings, but okay for Grandma/Ajumma in market).
`,Fm=`
  NEGATIVE PROMPT: **LOOKING AT CAMERA**, **EYE CONTACT**, posing for photo, selfie, modern items, electricity, cars, concrete, western clothes, beds, chairs, glass windows, paved roads, Japanese style shoes (Geta/Zori), Chinese queues, text, watermark, speech bubble, dirty face (unless specified), messy hair (unless specified), short skirt, showing legs, modernized hanbok, 3d render, plastic skin, western lingerie, nipples, genitals, modern bra, thick clothes, winter clothes.
`,Uu=`
  CONTEXT: Korea, Joseon Dynasty (19th Century).
  ${MC}
  ${Um}
  ${LC}
  ${Fm}
`,Gm=async(t,e)=>{const n=gt(t),r=e.match(/^data:(.+);base64,(.+)$/);if(!r)return"Imported image";const o=`
    Analyze this character image for a CONTINUITY SHEET.
    
    [CRITICAL INSTRUCTION: NO HELD ITEMS]
    Describe specific visual traits that MUST be preserved in future drawings.
    **DO NOT DESCRIBE PROPS or ITEMS IN HANDS.** (e.g., No sword, No book, No cup, No bag).
    Focus ONLY on the person's invariant appearance.

    1. **HEADWEAR**: Exact type (Gat, Nambawi, None) and color.
    2. **HAIR**: Exact style (Topknot, Braid, Bun) and hairline.
    3. **CLOTHING**: 
       - Top (Jeogori) Color & Pattern.
       - Bottom (Baji/Chima) Color.
       - Outer (Dopo/Jangot) Color.
    4. **FACE**: Eye shape, facial hair (beard/mustache), distinct features.
    5. **BODY**: Physique, height, build (e.g., muscular, slender, sturdy).
    
    Output a single paragraph. Be extremely precise about COLORS.
  `;try{return(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:r[1],data:r[2]}},{text:o}]}})).text||"Imported Character Reference"}catch(i){return console.error("Vision Analysis Failed",i),"Imported Character Reference (Analysis Failed)"}},OC=async(t,e,n)=>{var s;const r=gt(t),o=e.match(/^data:(.+);base64,(.+)$/);if(!o)return"";const i=`
    Analyze this image to create a Visual Description for a Character Design Option.
    
    [TARGET CATEGORY]: ${n}
    (e.g., if category is 'hair', focus ONLY on the hair. If 'headwear', focus on the hat.)
    
    [CONTEXT]
    The user wants to add this specific style to their character builder.
    The description will be used as a prompt for Image Generation AI (Stable Diffusion/Midjourney style).
    
    [INSTRUCTIONS]
    1. **FOCUS**: Ignore the background, ignore the face (unless category is 'face'). Look ONLY at the ${n}.
    2. **DETAIL**: Describe the shape, material, color, and texture.
    3. **TERMINOLOGY**: Use precise English terms. If it's a traditional Korean item (Joseon Dynasty), try to describe its look (e.g., "Black horsehair hat with wide brim" for Gat).
    4. **FORMAT**: Return a concise, comma-separated descriptive string.
    
    [EXAMPLE OUTPUTS]
    - (Category: Hair): "Traditional Korean Gache, large braided wig, ornate gold hairpins, heavy volume"
    - (Category: Clothing): "Red royal robe, gold dragon embroidery on chest and shoulders, wide sleeves"
  `;try{return((s=(await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:o[1],data:o[2]}},{text:i}]}})).text)==null?void 0:s.trim())||""}catch(a){throw console.error("Option Analysis Failed",a),new Error("  .")}},DC=async(t,e,n)=>{const r=gt(t),o=`
      You are a storyboard director. SPLIT this scene into ${n} sequential cuts.
      ORIGINAL: "${e.scriptSegment}" (${e.location})
      
      RULES:
      1. Break the action/dialogue logically.
      2. Keep the same Location/Time.
      3. Create specific visual descriptions for each cut.
      
      OUTPUT JSON:
      [ { "location": "Location (Keep Korean)", "timeOfDay": "Time (Keep Korean)", "scriptSegment": "Script Content (Keep Korean)", "description": "Visual Description (English)" }, ... ]

      [LANGUAGE RULES]
      1. **scriptSegment**: MUST BE KOREAN. Copy the exact lines from the original script. DO NOT TRANSLATE.
      2. **location** & **timeOfDay**: MUST BE KOREAN (e.g., "", "").
      3. **description**: MUST BE KOREAN (Detailed visual instructions for User Editing).
      
      [CRITICAL INSTRUCTION - NO CHARACTER APPEARANCE]
      - **ABSOLUTELY NO PHYSICAL DESCRIPTIONS**: Do NOT describe hair (style, color, length, accessories like Binyeo), clothes, or face.
      - **HISTORICAL RULE**: Do NOT apply \`JOSEON_COSTUME_RULES\` (like mandatory Binyeo) to this description. It creates conflicts with Character Reference Images.
      - **FILTERING RULE**: If the script describes appearance (e.g., "She fixed her binyeo"), IGNORE the object details. Just describe the action ("She touches her head").
      - **REASON**: Describing appearance here causes CONFLICTS with the Reference Image (e.g., generating "Short hair with Binyeo" which is impossible).
      - **BAD**: "     ."
      - **GOOD**: "  ."
    `;try{const i=await r.models.generateContent({model:"gemini-2.5-flash",contents:o,config:{responseMimeType:"application/json"}});if(i.text){const s=wr(i.text);if(Array.isArray(s))return s.map((a,u)=>({id:`${e.id}-split-${Date.now()}-${u}`,sceneNumber:0,location:a.location||e.location,timeOfDay:a.timeOfDay||e.timeOfDay,scriptSegment:a.scriptSegment,description:a.description,aspectRatio:e.aspectRatio,casting:e.casting}))}return[e]}catch(i){throw console.error(i),new Error("  ")}},UC=async(t,e,n,r,o,i,s,a,u,d)=>{const h=gt(t),m=s.length>0?`[KNOWN CHARACTERS (MANDATORY TO USE)]
${s.map(x=>`- ${x.name}: ${x.visualGuide||x.description}`).join(`
`)}

[CHARACTER MATCHING RULE]
- If any of these characters appear in the script, you MUST use their EXACT NAME in the 'characterNames' list.
- Even if they are minor/supporting roles (), do NOT ignore them.
- Do NOT rename them (e.g., don't call 'Village Head' just 'Old Man' if his name is 'Village Head').`:"",E=`
    Act as a **MASTER CINEMATIC DIRECTOR** for a high-budget Movie/Webtoon.
    Analyze the script and create a detailed **STORYBOARD** for a specific part of the story.
    
    ${Uu}
    ${a}
    ${m}
    
    [BATCH GENERATION MODE]
    ${o}
    ${i}
    
    [CRITICAL MISSION: DYNAMIC STORYTELLING (BANGTONG STYLE)]
    - **GOAL**: Transform text into a **VISUAL EXPERIENCE**. 
    - **STYLE**: Dynamic, Action-Oriented, Cinematic.
    - **TARGET**: Generate EXACTLY ${n} scenes starting from Scene #${r}.

    [VISUAL RULES - THE "BANGTONG" STANDARD]
    1. **DYNAMIC CAMERA MOVEMENT (MANDATORY)**:
       - **NEVER** use static "Mid-shot" repeatedly.
       - **CAMERA MOVES**:
         - **Low Angle**: Looking up at powerful/scary figures.
         - **High Angle**: Looking down at weak/sad figures.
         - **Dutch Angle**: Tilted camera for chaos/unease.
         - **Over-the-Shoulder**: For conversations (Focus on listener or speaker).
         - **Tracking Shot**: Following the movement.
       - **Instructions**: Start every description with the camera angle.
    
    2. **METHOD ACTING (NO EYE CONTACT)**:
       - **INVISIBLE CAMERA**: Characters must NEVER look at the camera.
       - **ACTION**: Characters must be **DOING**, not just standing.
       - **BAD**: "He stands there looking at the screen."
       - **GOOD**: "He slams his fist on the table, overturning the tea cup, eyes fixed on his opponent."
       - **EYES**: Describe where they look (e.g., "Glaring at the enemy", "Eyes trembling in fear", "Looking at the sky").

    3. **AUTO-POPULATE EXTRAS (WORLD BUILDING)**:
       - If Location is "Market" -> AUTOMATICALLY ADD "Peddlers, Shoppers, Children running".
       - If Location is "Palace" -> AUTOMATICALLY ADD "Eunuchs, Court Ladies walking in line".
       - The world must feel ALIVE.

    ${u?`4. **PRESERVE OPENING SCENERY (CRITICAL)**:
       - **OPENING SHOT**: If the script starts with a landscape/location description, YOU MUST MAKE IT SCENE 1.
       - **ALIVE WORLD RULE**: If the opening is a "Market", "Tavern", or "Village", **DO NOT DRAW AN EMPTY STREET**.
         - Even if no specific character is there, you **MUST DESCRIBE A CROWD**: "Busy market with peddlers and shoppers", "Villagers walking by".
         - **BAD**: "An empty market street."
         - **GOOD**: "A bustling market filled with merchants, customers, and steam rising from food stalls."`:""}
    ${d?'- **ENDING SHOT**: If the script ends with a lingering view (e.g., "Empty road", "Sunset"), YOU MUST MAKE IT THE LAST SCENE.\n       - **NO MID-SCENE FILLERS**: Do NOT create pure scenic shots in the middle unless it\'s a major time jump.\n       - **NO CHARACTER RULE**: For these shots, keep `characterNames` empty `[]`, but describe the *Anonymous Crowd* in the `description`.':""}

    5. **CONTINUITY & FLOW**:
       - Use transitions in descriptions: "Continuing from previous shot...", "Reaction to...", "The camera follows...".
       - Ensure logical flow of movement between cuts.

    [OUTPUT JSON STRUCTURE]
    Return an ARRAY of objects.
    [{ 
      "sceneNumber": ${r}, 
      "location": "Location (KOREAN)", 
      "timeOfDay": "Day/Night (KOREAN)", 
      "scriptSegment": "Original Script Text (KOREAN - DO NOT TRANSLATE)", 
      "description": "Visual Prompt (KOREAN)", 
      "characterNames": ["Name1", "Name2"] 
    }]

    [FIELD RULES]
    1. **scriptSegment**: Keep original Korean text. Group dialogue lines if needed to fit the scene count.
    2. **location/timeOfDay**: Keep in Korean.
    3. **characterNames**: List ONLY characters PHYSICALLY PRESENT.
       - Include **EXTRAS** if you added them (e.g., ["Villagers", "Merchant"]).
    4. **description**: **THE MOST IMPORTANT FIELD**.
       - Format: "[: Angle] [: Names] [: detailed movement] [: Extras/Atmosphere] [: Mood]"
       - **Example**: "[:  ] [: ] [:     .   .] [:      ,  .] [:     ]"
       - **NO** physical descriptions of known characters (Hair/Clothes) -> Use their Names.
       - **YES** physical descriptions of Extras.
       - **HISTORICAL RULE**: Apply Joseon Architecture/Sitting rules.

    SCRIPT:
    ${e.substring(0,5e4)}
  `;try{const x=await h.models.generateContent({model:"gemini-2.5-flash",contents:E,config:{responseMimeType:"application/json",maxOutputTokens:15e3}});if(x.text){const w=wr(x.text);if(Array.isArray(w))return w.map((y,v)=>({id:`scene-${Date.now()}-${v}`,...y}))}return[]}catch(x){throw console.error(x),new Error("   (   ).")}},FC=async(t,e,n=[],r=25,o=[])=>{let s=[...n],a=r,u=n.length+1;const d=Math.ceil(r/10),h=n.length>0?`EXISTING LOCATIONS: ${n.map(m=>`${m.location} (${m.description})`).join("; ")}`:"";for(let m=0;m<d;m++){const p=Math.min(10,a),g=m===0&&n.length===0,E=m===d-1,x=s.length>0?s[s.length-1]:null,w=x?`[PREVIOUS SCENE CONTEXT]
- Last Scene #${x.sceneNumber}: ${x.scriptSegment}
- Location: ${x.location}
- Action: ${x.description}

[INSTRUCTION]
- CONTINUE directly from this point. Do NOT repeat the last scene.`:`[INSTRUCTION]
- Start from the VERY BEGINNING of the script.`,y=E?`[PACING: FINAL STRETCH]
- This is the LAST batch. You MUST reach the END of the script by Scene #${u+p-1}.`:`[PACING: PART ${m+1} of ${d}]
- This is an intermediate batch. Do NOT finish the story yet. Just generate the NEXT ${p} scenes naturally.`;try{const v=await UC(t,e,p,u,w,y,o,h,g,E);if(v.length===0){console.warn("Batch generation returned empty. Stopping.");break}s=[...s,...v],a-=v.length,u+=v.length}catch(v){console.error("Batch failed",v);break}}return s},GC=async(t,e,n,r=[])=>{const o=gt(t),i=`
    You are a Casting Director. Extract characters from the script.
    OUTPUT JSON:
    [{ "name": "Name (KOREAN)", "visualGuide": "Korean Desc", "age": "20", "gender": "Male", "description": "English visual prompt", "isGroup": false }]

    [LANGUAGE RULES]
    1. **name**: Keep in KOREAN (e.g., "").
    2. **visualGuide**: Korean description for the user.
    3. **description**: English visual description for AI.
    4. **EXTRAS/GROUPS**: Extract anonymous groups as characters too (e.g., "Villagers", "Bandits").
       - Name: "Villagers" (or "Guests", "Soldiers")
       - VisualGuide: "Joseon peasants in dirty clothes"
       - Description: "Crowd of Korean peasants wearing white hanbok, straw shoes, rough texture."
    5. **isGroup**: Set to true if the name implies multiple people (e.g., ends with "", "", or is "People", "Crowd", "Soldiers").

    [CRITICAL RULE: NO PROPS/OBJECTS IN DESCRIPTION]
    - **ABSOLUTELY FORBIDDEN**: Do NOT include specific items held in hands (e.g., "holding a hammer", "carrying a radish", "holding a sword", "smoking a pipe").
    - **REASON**: If you write "holding a hammer", the character will hold a hammer in EVERY SINGLE SCENE (even when sleeping or eating).
    - **FOCUS ON PHYSIQUE**: Describe the **Physical Body** and **Face** instead.
      - BAD: "Blacksmith holding a heavy hammer."
      - GOOD: "Blacksmith with muscular arms, thick neck, sweaty skin, soot on face, wearing a leather apron."
      - BAD: "Market woman holding a basket of radishes."
      - GOOD: "Market woman with a sturdy build, sun-tanned skin, wearing a worn-out cotton hanbok, friendly round face."
    - **CLOTHING ONLY**: Describe the clothes, hair, and body type. NO HELD ITEMS.

    SCRIPT:
    ${e.substring(0,5e4)}
  `;try{const s=await o.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json",maxOutputTokens:15e3}});if(s.text){const a=wr(s.text);if(Array.isArray(a))return a.map((u,d)=>{var g;let h=u.description;(/|||||||/.test(u.name)||/police|constable|soldier|guard|officer/.test(((g=u.visualGuide)==null?void 0:g.toLowerCase())||""))&&(h="This character wears a traditional black *gat* hat with a subtle sheen, featuring a black braided band, a thinner reddish-brown braided band, and a gold-colored finial on top. On the right side, vibrant multi-colored ribbons in dark blue, emerald green, bright yellow, rich red, and a lighter blue/purple, along with bright yellow tassels, are attached. His dark hair is neatly styled, likely in a topknot under the hat as traditional, with a clean hairline. The visible clothing includes a pure white *jeogori* (top), covered by a deep charcoal grey or black long outer robe and an inner vest-like garment of the same color, both featuring a very subtle, fine, dark grey patterned texture. A striking, vibrant red sash is tied at the waist with long ends hanging down. The bottom garment consists of pure white, loose-fitting *baji* (trousers)");const p=u.isGroup||/$|$|$|$||||||/.test(u.name);return{id:`char-${Date.now()}-${d}`,...u,description:h,isGroup:p,hasDialogue:!0,chromaKeyColor:"green",actions:[]}})}return[]}catch(s){return console.error(s),[]}},HC=async(t,e,n,r,o,i="auto")=>{const s=gt(t),a=n.map(g=>`[CHARACTER: ${g.name}] (ID: ${g.id}) Gender: ${g.gender}, Age: ${g.age}, Desc: ${g.description}`).join(`
`),u=r?r.map(g=>`[PROP: ${g.name}] (ID: ${g.id}) ${g.description}`).join(`
`):"",d=o?`[GLOBAL RULES] ${o}`:"",h={auto:`
      [THEME: AI AUTO-ANALYSIS (BEST FIT)]
      - **TASK**: Analyze the script and DETERMINE THE BEST GENRE/TONE (Mystery, Comedy, Tragedy, etc.) yourself.
      - **GOAL**: Choose the theme that will generate the MOST CURIOSITY and VIEWS.
      - **EXECUTION**: Apply the rules of the chosen genre (e.g., if you choose Comedy, use wide angles; if Horror, use shadows).
      - **IMPORTANT**: Do not be generic. Pick a SPECIFIC angle (e.g., "Deep Tragedy" or "Slapstick Comedy") and stick to it.
    `,mystery:`
      [THEME: MYSTERY & THRILLER]
      - **MOOD**: Dark, Suspenseful, Uneasy.
      - **FOCUS**: Secrets, Shadows, Unseen threats.
      - **ENDING**: The protagonist opens a "Forbidden Box" or sees something shocking. CUT before revealing what it is.
      - **LIGHTING**: High contrast (Chiaroscuro), Moonlight, Flickering candles.
    `,comedy:`
      [THEME: SATIRE & COMEDY (B-Class Humor)]
      - **MOOD**: Absurd, Exaggerated, Ironic.
      - **FOCUS**: "WTF Moments", Stupid decisions, Slapstick consequences.
      - **ENDING**: A ridiculous situation freezes frame. The protagonist realizes they messed up big time.
      - **VISUALS**: Bright colors, wide angles (fisheye effect), funny facial expressions.
    `,destiny:`
      [THEME: EPIC DESTINY]
      - **MOOD**: Grand, Mythical, Serious.
      - **FOCUS**: Prophecies, Birth secrets, Royal bloodlines.
      - **ENDING**: A moment of realization or acceptance of a great burden. The "Hero's Journey" begins.
      - **VISUALS**: Cinematic wide shots, God rays, Slow motion, Golden/Warm tones.
    `,tragedy:`
      [THEME: SADNESS & HAN (Deep Sorrow)]
      - **MOOD**: Melancholic, Heartbreaking, Lonely.
      - **FOCUS**: Loss, Separation, Unjust suffering.
      - **ENDING**: The protagonist screams in silence or tears fall in slow motion. Focus on the emotional pain.
      - **VISUALS**: Desaturated colors, Rain, Snow, Cold/Blue tones, Close-ups on tears.
    `,revenge:`
      [THEME: REVENGE & PASSION]
      - **MOOD**: Intense, Violent, Burning.
      - **FOCUS**: Betrayal, Anger, Preparation for the kill.
      - **ENDING**: The protagonist eyes burn with vengeance. They hold a weapon. CUT before the strike.
      - **VISUALS**: High contrast, Red accents (blood/fire), Sharp focus, Dutch angles.
    `,despair:`
      [THEME: POVERTY & DESPAIR (Realism)]
      - **MOOD**: Gritty, Dirty, Hopeless.
      - **FOCUS**: Hunger, Cold, Cruelty of the world.
      - **ENDING**: The protagonist hits rock bottom. A look of total emptiness.
      - **VISUALS**: Dirty textures, Earthy tones, Handheld camera (shaky), Raw realism.
    `},m=h[i]||h.mystery,p=`
    Act as a PD for a viral 'Mystery/Folktale' YouTube channel.
    Create a **10-shot** "HOOKING TEASER" sequence based on the selected theme.

    [VISUAL CONSISTENCY BIBLE]
    You MUST adhere to these character and prop designs strictly.
    ${a}
    ${u}
    ${d}
    ${Uu}

    ${m}

    [CRITICAL RULE: NO SPOILERS & NO RESOLUTION]
    - **ABSOLUTE PROHIBITION**: Do NOT reveal the "Secret Identity" or "Final Twist" in the opening.
    - **NO KEY CHARACTERS**: Do NOT show the "Answer" character (e.g., The King, The Real Father). If the goal is to meet the King, do NOT show the King. Show the *Gatekeeper* or the *Obstacle* instead.
    - **AMBIGUOUS LOCATION**: Do not make it obvious where it is (e.g., "Is this the Palace or a Prison?"). Keep the background focused on the *conflict*, not the landmark.
    - **Example**: A girl holding a knife. Is she in front of the King? We don't know. We only see the knife and the soldiers blocking her. **The King is NOT in the frame.**
    - **HIDE THE ANSWER**: The audience must NOT know *who* she really is yet. They should only see a "desperate girl fighting against the world".
    - **CUT BEFORE THE TRUTH**: Stop the scene *right before* the secret is revealed.

    [CRITICAL MISSION: FIND THE "INCITING INCIDENT" AND DRAMATIZE IT]
    Every story, no matter the genre, has a "Spark" (Inciting Incident) that starts the fire.
    Your job is to **find that spark and pour gasoline on it** according to the THEME.
    
    1. **SCAN FOR CONFLICT**:
       - Look for the moment matching the theme (e.g., Absurdity for Comedy, Loss for Tragedy).
       - It could be a physical threat, a social humiliation, a shocking discovery, or a heartbreaking loss.
       - **Ignore the "Setup" and "Resolution". Go straight for the "Problem".**
    
    2. **DRAMATIZE THE MOMENT (Make it Cinematic)**:
       - Even if the text says "He was sad", you must visualize it as "He screams at the rain".
       - Even if the text says "She was scared", you must visualize it as "Her hands tremble as she hides under the floorboards".
       - **Translate "Text Description" into "Visual Action".**
    
    // Theme strategy is already injected above via selectedThemeInstruction
    
    [CRITICAL INSTRUCTION: TIME & DYNAMICS (60 SECONDS RULE)]
    - **TIME LIMIT**: The entire sequence (Shot 1 to 10) must represent **ONLY 60 SECONDS of Real-Time**.
    - **NO SUMMARY**: Do NOT summarize the whole story. Do NOT skip days or hours.
    - **DYNAMIC CUTS**: Even though it's one location, change camera angles aggressively (e.g., Extreme Close-up -> High Angle -> Low Angle).
    - **SPLIT THE MOMENT**: Take ONE intense action (e.g., "Opening a forbidden door") and split it into 10 tense micro-moments.
      - Shot 1: Hand touches the handle.
      - Shot 2: Handle turns slowly.
      - Shot 3: Dust falls from the frame.
      - Shot 4: Eye looks through the crack.
      ...
    - **GOAL**: Create a "Fast-Paced, 6-Second Cut" feel for TikTok/Shorts.

    [NARRATIVE ARC (The "60-Second Intensifier" Formula)]
       - Shot 1-2 (Trigger): The conflict begins (e.g., The threat appears).
       - Shot 3-6 (Escalation): The situation gets worse. Action intensifies.
       - Shot 7-9 (Desperation): The protagonist realizes there is no way out.
       - **Shot 10 (The CLIFFHANGER)**: **The moment of "Irreversible Action"**.
         - **RULE**: Stop exactly **1 second before the result/consequence**.
         - If they jump: Show the leap, NOT the landing.
         - If they stab: Show the blade touching the skin, NOT the blood.
         - If they scream: Show the open mouth, NOT the silence after.
         - **BLACK OUT** at the peak of tension.

    [CRITICAL: ENDING RULE - NO HAND/FOOT CLOSE-UPS]
    - **PROHIBITION**: Do NOT end a shot with a Close-up of Hands, Feet, or Objects. This ruins the AI style for the next shot.
    - **EXCEPTION (THE "FADE-OUT" RULE)**: The ONLY time you can end on a hand/foot is if you **IMMEDIATELY FADE TO BLACK**.
    - **MANDATORY INSTRUCTION**: If the action requires focusing on a hand/foot at the end, you MUST write: "**...and as the camera focuses on the hand, the screen FADES TO BLACK.**"
    - **STANDARD ENDING**: Unless it's a fade-out transition, ALWAYS end the shot with the Character's FACE or a Full/Waist shot.

    [VIDEO PROMPT GENERATION RULES - NATURAL LANGUAGE FOR GROK/WHISK]
    - Instead of JSON codes, write **CONCISE KOREAN SCREENPLAY STYLE**.
    - **TARGET AI**: Grok, Google Vids (Whisk).
    - **FORMAT**: "Dry, Action-Oriented Style". AVOID flowery metaphors like "Darkness descends...".
    - **BAD**: "Darkness descends on the rugged mountain path. In the center, Arang is reaching..."
    - **GOOD**: "Rugged mountain path at night. Arang reaches for the purple herb in the center."
    - **CRITICAL: NO CHARACTER IDS**: Do NOT include character IDs (e.g., "(char-...)") in the 'videoPrompt' text. Use ONLY the character's Name (e.g., "Arang").
    
    [CRITICAL: FACE VISIBILITY & AI CONSISTENCY]
    - **MANDATORY**: Video Generation AI (Grok, Runway) needs the FACE to maintain character identity.
    - **NO "FEET-ONLY" or "HAND-ONLY" STARTS**: Do NOT start the sequence with a shot that hides the face (e.g., Extreme Close-up of feet walking).
    - **NO BACK SHOTS**: Avoid starting with a shot of the character's back. We need to see who it is.
    - **RULE**: Shot 1 MUST include the character's FACE (Front or 45-degree angle).
    - **ALLOWED**: You can use Close-ups of eyes/mouth, but ensure the "Identity" is visible.
    
    [CRITICAL: SPATIAL & MOVEMENT DESCRIPTION]
    1. **FIXED POSITIONS**: Always specify where characters are.
       - "Left: [Character A], Right: [Character B]."
       - "Center: [Character C]."
    2. **CAMERA & CONTINUITY**:
       - **ZOOM IN/OUT**: Use "Zoom In **ON [CHARACTER]**". Never just "Zoom In".
       - **TRACKING**: "The camera follows [Character]..."
       - **NO SUDDEN CUTS**: Characters must not vanish between cuts.
    3. **WALKING/ENTERING**:
       - If a new character enters, say: "**Behind them**, [New Character] is walking towards them."
       - If someone leaves, say: "[Character] turns around and walks into the darkness."
    3. **CONTINUITY**:
       - "The camera follows [Character] as they move."
       - "The scene continues from the previous shot."

    [AUDIO CONTROL - CRITICAL: SINGLE SPEAKER FOCUS]
    - **SFX (REQUIRED)**: Describe realistic sound effects (e.g., "Sound of footsteps", "Sound of slap").
    - **DIALOGUE RULE (ONE PERSON ONLY)**:
      - **SELECT MAIN LINE**: Choose ONLY the most important line from the MAIN character in this shot.
      - **NO CONVERSATIONS**: Do NOT include back-and-forth dialogue. Just ONE person speaking.
      - **FULL TEXT PRESERVATION**: Copy that one person's line EXACTLY (don't summarize). The user will trim it later.
    - **TIMING**: Place the dialogue tag EXACTLY at the moment of action.
    - **BGM (FORBIDDEN)**: **ABSOLUTELY NO BACKGROUND MUSIC**.
    - **INSTRUCTION**: Add "(Audio: Only SFX & Dialogue, No Music)" at the end.

    [OUTPUT FORMAT]
    OUTPUT JSON: 
    [
      { 
        "sequenceNumber": 1, 
        "title": "Shot Title (Korean)", 
        "visualPrompt": "Detailed visual description for Image Gen (KOREAN)", 
        "characterIds": ["char_id"], 
        "propIds": ["prop_id"],
        "videoPrompt": "KOREAN NATURAL LANGUAGE PROMPT. (e.g., '        .     ,       .     . (: \\"!\\") (:     .  )')"
      }
    ]
     
     [CONSTRAINT]
     - "visualPrompt": MUST BE KOREAN. Detailed.
     - "videoPrompt": MUST BE KOREAN. Natural Language.
     - **CRITICAL**: The 'videoPrompt' must be ready to copy-paste into Grok.
     - **CASTING RULE**: In "characterIds", include ONLY characters PHYSICALLY VISIBLE in the shot. Do NOT include characters mentioned in the title/text but not shown.
    
    SOURCE TEXT:
    ${e.substring(0,5e4)}
  `;try{const g=await s.models.generateContent({model:"gemini-2.5-flash",contents:p,config:{responseMimeType:"application/json",safetySettings:ii}});if(g.text){const E=wr(g.text);if(Array.isArray(E))return E.map(x=>({id:`open-${Date.now()}-${x.sequenceNumber}`,...x}))}return[]}catch(g){throw console.error(g),new Error("  ")}},BC=async(t,e,n,r="auto",o)=>{const i=gt(t),s=n.map(u=>`[CHARACTER: ${u.name}] ${u.description}`).join(`
`),a=`
    Act as a YouTube Thumbnail Artist.
    ${o?`[CRITICAL MISSION]: Create a thumbnail that perfectly matches this specific title: "${o}". Find the scene in the script that corresponds to this title.`:`Analyze the script and selected theme (${r}) to create ONE IMPACTFUL THUMBNAIL CONCEPT.`}

    SCRIPT:
    ${e.substring(0,3e4)}

    CHARACTERS:
    ${s}

    TASK:
    1. ${o?`**MATCH THE TITLE**: The visual MUST explain why the title is "${o}".`:"Identify the CORE CONFLICT or RELATIONSHIP in the script."}
    2. **CHARACTER-CENTRIC COMPOSITION**:
       - **MUST INCLUDE CHARACTERS**: Folk tales (Yadam) rely on characters. Do not just show objects.
       - **KEY FIGURES**: Usually a beautiful woman (Femme Fatale/Victim) and a man (Hero/Villain/Observer).
       - **DYNAMIC**: Show the tension between them (e.g., A woman seducing a scholar, A man threatening a woman, A tragic farewell).
       - **EXTRAS**: If the scene is a market or palace, include blurred extras in the background for scale.
    3. **METHOD ACTING (BANGTONG STYLE)**:
       - **EXPRESSION IS KING**: The characters must have **INTENSE, DRAMATIC EXPRESSIONS**.
       - **NO DEAD EYES**: Eyes must be alive with desire, fear, anger, or sorrow.
       - **ACTIVE POSING**: Do not just stand. Lean in, grab, push, or hide. Make it look like a paused frame from a high-budget movie.
    4. **VISUAL METAPHOR**: Combine the characters with a symbolic action (e.g., Offering a poisoned drink, Hiding a knife).
    5. **COMPOSITION STRATEGY**:
       - Decide whether to place the character on the **RIGHT** (for text space on left) or **CENTER** (for impact).
       - **RIGHT ALIGNMENT**: Good for dialogue or explanatory text on the left.
       - **CENTER ALIGNMENT**: Good for intense portraits or symmetrical scenes.
       - **NO BLACK VOID**: Do not describe a black background. Describe the full scene.
    7. **SAFETY & POLICY COMPLIANCE (CRITICAL)**:
       - **NO GORE/BLOOD**: Do NOT show blood, open wounds, or severed body parts. Use red lighting or red fabric to symbolize danger instead.
       - **NO EXPLICIT VIOLENCE**: Do NOT show the act of beheading or torture directly. Show the *moment before* (tension) or the *aftermath* (emotional reaction).
       - **SAFE METAPHORS**: Instead of a severed head, show a fallen hat or a broken sword. Instead of torture, show ropes and shadows.
       - **FOCUS ON APPEARANCE, NOT ACTION**: Instead of "being tortured", describe the result: "torn clothes, bruises on face, messy hair, sweat, intense fear".
       - **WEAPONS**: Weapons (swords, knives) are allowed but must not be actively cutting flesh. They should be held threateningly or sheathed.

    OUTPUT JSON:
     {
         "title": "${o||"Short Catchy Title (Korean)"}",
         "composition": "right",
         "action": "Description of the situation, background, and character actions (English). DO NOT include character physical appearance here.",
         "characters": [
            { "name": "Character Name (Korean)", "action": "Specific pose/expression for this character" }
         ]
     }
    `;try{const u=await i.models.generateContent({model:"gemini-2.5-flash",contents:a,config:{responseMimeType:"application/json"}});if(u.text)return wr(u.text);throw new Error("No response text")}catch(u){throw console.error(u),new Error("  ")}},Cs=async(t,e,n,r="16:9",o="background",i,s,a,u,d,h,m)=>{var J,te,H,ie;const p=gt(t),g=Qo[n].prompt;let x={aspectRatio:r||"16:9"},w=e;if(e&&/[-]/.test(e)&&(w=await pr(p,e)),m&&m.length>0&&Array.isArray(i)&&i.length>0){const F=m.map((R,de)=>`${R} (MATCH WITH PROVIDED REFERENCE IMAGE #${de+1})`).join(", ");F&&(w+=`
[CHARACTER MATCHING: ${F}]`)}let y=s||"";s&&/[-]/.test(s)&&(y=await pr(p,s)),d&&/[-]/.test(d)&&await pr(p,d);const v=`
    [ROLE] You are the "Continuity Supervisor" for a high-budget Korean Historical Drama.
    [ABSOLUTE CASTING RULE]
    - **DRAW ONLY** the characters explicitly listed in the "[FOCUS SUBJECT]" section of the prompt.
    - If the script mentions other characters (talking/listening) but they are NOT in "[FOCUS SUBJECT]", **DO NOT DRAW THEM**.
    - If only ONE character is listed, it must be a **SOLO SHOT**.
    
    [YOUR MISSION]
    1. **CONSISTENCY IS GOD**: 
       - If a Character Reference is provided, the character MUST look exactly like it.
       - If a Background Reference is provided, the room/environment MUST look exactly like it.
    2. **ACTING DIRECTOR**: Natural acting, candid shots.
    3. **HISTORICAL POLICE**: Enforce Joseon Dynasty rules.
  `,S=y?`
    [USER COMMAND - ABSOLUTE PRIORITY - OVERRIDES REFERENCE]
    The user wants to CHANGE specific details from the reference image.
    User says: "${y}".
    
    [EXECUTION RULES]
    1. If the user asks to change clothing/hair (e.g., "Remove Hat", "Wear Indoor Clothes"), YOU MUST OBEY.
    2. Ignore the "Reference Image" constraint for that specific item.
    3. Keep the FACE and IDENTITY the same, but change the requested item.
  `:"";let N="";const I=Array.isArray(i)?i:i?[i]:[];I.length>0&&(o==="character"||o==="cinematic")&&(N=`
        [VISUAL ANCHOR - CHARACTERS (ABSOLUTE TRUTH)]
        The provided images (tagged as Character Refs) are the **GOD-TIER REFERENCES**.
        
        - **MATCHING RULE**: The prompt explicitly tags characters with "(MATCH WITH PROVIDED REFERENCE IMAGE #N)".
        - **EXECUTION**: You MUST map the Nth provided image to that specific character.
        - **IDENTITY LOCK**: 
          - **FACE**: Copy the facial features, age, and facial hair EXACTLY.
          - **COSTUME**: Copy the clothing style, colors, and HEADWEAR EXACTLY. 
          - **DO NOT CHANGE CLOTHES**: Unless the script explicitly says "He changed clothes", **KEEP THE REFERENCE COSTUME**.
          - **DO NOT REMOVE HATS**: If the reference has a hat (Gat/Official Cap), **KEEP IT ON** (Even indoors, unless explicitly told to remove).
          - **DO NOT HALLUCINATE**: Do not add beards, glasses, or accessories that are not in the reference.
        
        - **BACKGROUND EXCLUSION**: IGNORE any background elements in the reference images. Only look at the person.
      `);let L="";a&&(L=`
        [VISUAL MASTER - BACKGROUND & STYLE]
        The provided image is the **BACKGROUND REFERENCE**.
        1. **ARCHITECTURE & ATMOSPHERE**: Copy the room structure, furniture, lighting, and textures EXACTLY.
        2. **ADAPT FRAMING**: 
           - IF a specific Camera Shot (e.g., Waist Shot) is requested in the prompt, YOU MUST ZOOM IN/OUT within this environment.
           - DO NOT just copy the reference's framing if it conflicts with the [CAMERA] instruction.
           - Example: If Reference is Wide Room but Prompt is "Waist Shot", draw the character from waist up with the blurred room background behind them.
      `);let P="";u&&u.length>0&&(P=`
        [VISUAL ANCHOR - PROPS/OBJECTS]
        The provided additional images are IMPORTANT OBJECTS (Props) that must appear in the scene.
        1. **INTEGRATION**: Include these objects in the scene naturally as described in the script.
        2. **APPEARANCE**: Maintain their visual appearance (color, shape, details) as shown in the reference images.
        3. **INTERACTION**: If the character is interacting with them (holding, looking at), ensure realistic interaction.
      `);const D=`
    [ACTING & EYE CONTACT RULES - ABSOLUTE PRIORITY]
    1. **NO EYE CONTACT WITH CAMERA (CRITICAL)**: 
       - The character MUST NEVER look at the viewer/lens.
       - **EYES**: Eyes must be focused on the *situation*, *other characters*, or *objects*.
       - **PENALTY**: If the character makes eye contact with the camera, it is a FAILURE.

    2. **METHOD ACTING (IMMERSION)**:
       - **IGNORE THE CAMERA**: The camera is an invisible ghost. The characters are unaware of it.
       - **FOCUS**: 
         - **Dialogue**: Look intently at the other person.
         - **Conflict**: Glare at the enemy or the threat.
         - **Thinking**: Look down, up, or into the distance (Profile view).
         - **Fear**: Look at the source of fear (NOT the camera).

    3. **DYNAMIC POSE & MOVEMENT**:
       - **NO STIFF POSES**: Do not just stand there. 
       - **DO SOMETHING**: Use hands, lean forward, crouch, run, or struggle.
       - **ENGAGE**: Interact with the environment (touching walls, holding tools, grabbing clothes).
  `,M=`
    [POSTURE & POSE RULES]
    1. **DEFAULT POSE**:
       - IF Location is OUTDOOR (Yard, Street, Forest): **MUST BE STANDING** unless script explicitly says "Sitting".
       - IF Location is INDOOR: Follow script context.
    2. **FRAMING VS POSE**:
       - **DO NOT CHANGE THE POSE** to fit the camera frame.
       - If "Waist Shot" is requested, **CROP THE IMAGE**. DO NOT make the character sit to hide their legs.
       - If the character is Standing, keep them Standing and just show the upper body.
  `,j=`
    [HISTORICAL ACCURACY: JOSEON DYNASTY ARCHITECTURE]
    - **PRISON/JAIL**:
      - **STRUCTURE**: Use **WOODEN LATTICE** (Grid pattern / # shape). Do NOT use vertical iron bars.
      - **NO STONE FLOOR**: The floor is **DIRT/GROUND** covered with **STRAW MATS** or scattered **HAY**.
      - **NO CHAINS**: Unless specified, use ropes (Seung) instead of metal chains.
    - **DOORS/WINDOWS**:
      - Use **PAPER DOORS (Changhoji)** with wooden frames. No glass windows.
      
    [SPATIAL REALISM & LENS]
    1. **DO NOT SHRINK THE ROOM**: The room must remain spacious. Do not make the walls close in on the characters.
    2. **DEPTH**: Use "Depth of Field" or "Bokeh" for Close-ups/Waist Shots to separate character from background.
    3. **LENS PREFERENCE (ZOOM OUT - BATCH MODE)**:
       - **DEFAULT TO KNEE SHOT (Medium Long Shot)**: To allow for post-production zoom-in effects without losing quality, **ALWAYS generate at least a Knee Shot** (showing head to knees) unless "Close Up" or "Bust Shot" is explicitly requested in the user prompt.
       - **AVOID TIGHT CROPPING**: Do NOT default to Waist Shot. We need more pixel data for zooming.
       - **Framing**: Character should fill 60-70% of the vertical frame, leaving room for camera movement.
    4. **LENS**:
       - Use **50mm Standard Lens**. (Natural perspective, captures body language).
       - Ensure the character's hands and thighs are visible.
  `,Q=`
    [STRICT ADHERENCE TO SCRIPT]
    - **NO HALLUCINATION**: Do NOT add any details, objects, or actions that are NOT explicitly mentioned in the user's prompt/script.
    - **ONLY WHAT IS WRITTEN**: If the script does not describe it, do not generate it.

    [HANBOK CLOTHING RULE - STRICT]
    - **DEFAULT**: Character MUST wear the FULL HANBOK set as shown in the Reference Image.
    - **NO UNDRESSING**: Do NOT remove layers unless the script EXPLICITLY says "Undress" or "Remove Clothes".
    - **SLEEPING/LYING DOWN**: Even when sleeping or lying down, **KEEP THE CLOTHES ON**. Do not change into sleepwear/underwear automatically.
    - **NO TRANSPARENCY**: The skirt (Chima) and Jacket (Jeogori) are **SOLID OPAQUE FABRIC**. DO NOT make them see-through.
    - **NEGATIVE PROMPT**: See-through clothes, Transparent fabric, Lingerie, Underwear only, Modern sleepwear, Nudity.
    
    [SPECIAL EXCEPTION: IF USER EXPLICITLY REQUESTS "UNDRESS/UNDERWEAR/SOKJEOKSAM"]
    - Only IF the prompt specifically asks for "Sokjeoksam" or "Underwear":
      1. Top (Jeogori) can be white/sheer.
      2. **BOTTOM (CHIMA) MUST BE SOLID OPAQUE**: The skirt must NEVER be transparent. It must cover the legs completely and solidly.
      3. **NO NUDITY**: No sensitive body parts visible.
  `;let _="",z="";e.includes("[CAMERA]")&&(e.includes("Waist Shot")||e.includes("ws")?z=`
            [ABSOLUTE FRAMING RULE: WAIST SHOT] 
            1. **ZOOM / CROP**: The framing MUST be a **CLOSE-UP from Head to Waist**.
            2. **FILL THE SCREEN**: The Character's Head and Torso MUST FILL the vertical space of the 16:9 frame.
            3. **CUT OFF**: The bottom of the frame MUST CUT OFF at the Belt/Waist line. **DO NOT SHOW LEGS**.
            4. **HEIGHT DIFFERENCE**: If characters have different heights, **CROP TO THE SHORTER PERSON'S WAIST**. Ensure the shorter person's head is fully visible.
            5. **POSTURE**: **SITTING IS ALLOWED**. If sitting, the camera zooms in to the upper body only.
            6. **NEGATIVE PROMPT**: Full body, Distant shot, Small character, Showing legs, Showing shoes.
            7. **BACKGROUND PRIORITY**: **LOW**. The Character Framing is PRIORITIZED over showing the background location (e.g. Maru/Room). It is okay if the background is cropped or blurry. DO NOT ZOOM OUT to show the architecture.
            8. **MANDATORY**: IF the generated image shows the character's KNEES or FEET, IT IS A FAILURE. REGENERATE closer.
          `:e.includes("Bust Shot")||e.includes("bs")||e.includes("Close Up")||e.includes("cu")?z=`
            [ABSOLUTE FRAMING RULE: BUST SHOT / CLOSE UP] 
            1. **EXTREME ZOOM**: The framing is TIGHT on the Face and Shoulders.
            2. **FILL THE SCREEN**: The Face and Shoulders MUST DOMINATE the frame (80% of screen).
            3. **CUT OFF**: The bottom of the frame MUST CUT OFF at the Chest/Armpits. **DO NOT SHOW WAIST**.
            4. **HEIGHT DIFFERENCE**: If characters have different heights, **CROP TO THE SHORTER PERSON'S CHEST**. Ensure the shorter person's face is fully visible.
            5. **POSTURE**: **SITTING IS ALLOWED**. Even if sitting, we only see the face.
            6. **NEGATIVE PROMPT**: Waist, Stomach, Belt, Hands (unless gesture), Full body, Distant shot.
            7. **BACKGROUND PRIORITY**: **LOW**. The Character Framing is PRIORITIZED over showing the background location (e.g. Maru/Room). It is okay if the background is cropped or blurry. DO NOT ZOOM OUT to show the architecture.
            8. **OVER-THE-SHOULDER RULE**: If the prompt specifies "Speaker" or "OTS", **CROP TO THE SPEAKER**. The Listener (shoulder) is just a framing device and can be cut off or blurred. Focus on the Speaker's face/bust.
            9. **MANDATORY**: IF the generated image shows the character's WAIST or BELT, IT IS A FAILURE. REGENERATE closer.
          `:e.includes("Knee Shot")||e.includes("mls")?z=`
            [ABSOLUTE FRAMING RULE: KNEE SHOT (Medium Long)] 
            1. **ZOOM**: The framing is from Head to Knees.
            2. **FILL THE SCREEN**: The Character (Head to Knees) MUST FILL the vertical space.
            3. **CUT OFF**: The bottom of the frame MUST CUT OFF at the Knees/Thighs. **DO NOT SHOW FEET**.
            4. **POSTURE**: **SITTING IS ALLOWED**. If sitting, show the character from Head to Knees.
            5. **NEGATIVE PROMPT**: Feet, Shoes, Ground at feet, Full body, Distant shot.
            6. **BACKGROUND PRIORITY**: **LOW**. The Character Framing is PRIORITIZED over showing the background location (e.g. Maru/Room).
               - Match the background perspective to the **CHARACTER'S EYE/KNEE LEVEL**.
               - It is okay if the background is cropped or blurry. **DO NOT ZOOM OUT** just to show the floor or roof.
            7. **MANDATORY**: IF the generated image shows the character's SHOES, IT IS A FAILURE. REGENERATE closer.
          `:(e.includes("Full Shot")||e.includes("full"))&&(z=`
            [ABSOLUTE FRAMING RULE: FULL SHOT]
            1. **WIDE ANGLE**: Show the ENTIRE BODY from Head to Toe.
            2. **SPACE**: Leave some space above the head and below the feet.
            3. **POSTURE**: **SITTING IS ALLOWED**. Show the full pose including legs and feet.
            4. **NEGATIVE PROMPT**: Cut off feet, Cut off head, Close up, Waist shot.
            5. **MANDATORY**: IF the generated image cuts off the FEET or HEAD, IT IS A FAILURE. ZOOM OUT.
          `));let C="";h&&(C=`
        [VISUAL ANCHOR - MASTER SCENE LOCATION & CHARACTERS]
        The provided first image is the **ACTUAL FILM SET** and **ACTORS**.
        
        [CRITICAL SPATIAL RULES - 3D WORLD EXTENSION]
        1. **IMMUTABLE WORLD**: The walls, floor, furniture, lighting, and atmosphere are **FIXED REALITY**.
        2. **CAMERA WORK ONLY**: You are a cameraman inside this specific room. You can ONLY change the Camera Angle, Lens, and Distance.
        3. **EXTEND THE SPACE**: 
           - Treat the image as a viewport into a full 3D room.
           - If the camera rotates to show a part NOT visible in the reference, **INFER** the environment based on the visible parts.
           - **CONTINUITY**: The unseen wall must match the style of the seen wall. The floor pattern must continue.
           - **DO NOT** invent a completely different style for the unseen areas.
        4. **PERSPECTIVE SHIFT**:
           - If prompt says "Side View", show THIS SAME ROOM from the side.
           - If prompt says "Reverse Shot", show the other side of THIS SAME ROOM.
           
        [CHARACTER CONSISTENCY & ACTING PRIORITY]
        1. **IDENTITY (KEEP)**: The characters MUST look like the same people (Same Face, Same Hair, Same Clothes).
        2. **ACTING (CHANGE - CRITICAL)**: 
           - **DO NOT COPY THE POSE** from the reference image.
           - You MUST change the Pose, Gesture, and Facial Expression to match the NEW PROMPT.
           - If the prompt says "Surprised", they MUST look surprised, even if the reference image is "Calm".
           - **DYNAMIC MOVEMENT**: The character is ALIVE. Make them move!
           - **FAILURE CONDITION**: If the output looks exactly like the reference image with no change in acting, IT IS A FAILURE.
      `),_=`
    [SYSTEM INSTRUCTION: IMAGE EDITING & FRAMING MODE]
    ${C}
    ${z}
    
    [ORIGINAL SCENE CONTEXT]
    ${v}
    ${g}
    ${Uu}
    ${Q}
    
    [INDOOR ETIQUETTE GUIDE]
    - IF the scene is INDOORS (Room, Maru):
      1. **SHOES**: **STRICT RULE: REMOVE SHOES**. 
         - Characters MUST be barefoot or wearing white socks (Beoseon).
         - Even if the reference image shows shoes, **YOU MUST REMOVE THEM** for indoor scenes.
      2. **HATS**: 
         - Default rule: Remove large outdoor hats (Satgat, Paeraengi).
         - **CRITICAL EXCEPTION**: If the Character Reference Image shows a specific hat (e.g. Gat, Official Cap), **KEEP IT ON** unless the user explicitly asked to remove it.
         - **IDENTITY PRIORITY**: The Character's Identity (Reference Image) is MORE IMPORTANT than the indoor rule.
  
    ${N}
    ${L}
    ${P}
    ${S}
    ${D}
    ${M}

    [SCENE GENERATION PROMPT]
    ${w}
    
    ${j}
    
    [FINAL CHECK]
    - DID YOU CROP THE IMAGE AS REQUESTED?
    - Is the framing correct (Waist/Bust/CloseUp)?
    - Is the background consistent with the Master Image?
  `;const he=[];if(a&&!h){const F=a.match(/^data:(.+);base64,(.+)$/);F&&he.push({inlineData:{mimeType:F[1],data:F[2]}})}if(h){const F=h.match(/^data:(.+);base64,(.+)$/);F&&he.push({inlineData:{mimeType:F[1],data:F[2]}})}I.length>0&&(o==="character"||o==="cinematic")&&I.forEach(F=>{const R=F.match(/^data:(.+);base64,(.+)$/);R&&he.push({inlineData:{mimeType:R[1],data:R[2]}})}),u&&u.length>0&&u.forEach(F=>{const R=F.match(/^data:(.+);base64,(.+)$/);R&&he.push({inlineData:{mimeType:R[1],data:R[2]}})}),he.push({text:_});try{const F=await p.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:he},config:{imageConfig:x,safetySettings:ii}});for(const R of((H=(te=(J=F.candidates)==null?void 0:J[0])==null?void 0:te.content)==null?void 0:H.parts)||[])if(R.inlineData)return`data:${R.inlineData.mimeType};base64,${R.inlineData.data}`;throw new Error("  .")}catch(F){throw console.error(F),(ie=F.message)!=null&&ie.includes("SAFETY")?new Error("  :   ."):new Error("    .")}},pr=async(t,e)=>{var n;if(!e||!/[-]/.test(e))return e;try{return((n=(await t.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:`Translate the following Korean text to English for an image generation prompt. Keep it concise and descriptive. Text: "${e}"`}]}})).text)==null?void 0:n.trim())||e}catch(r){return console.error("Translation failed, using original text:",r),e}},VC=async(t,e,n,r,o)=>{var d,h,m,p;const i=gt(t),s=await pr(i,n);let u=`
    ${Qo[r].prompt}
    CONTEXT: Korea, Joseon Dynasty.
    TASK: Generate a high-quality visual reference for a specific OBJECT/PROP.
    
    OBJECT NAME: ${e}
    VISUAL DESCRIPTION: ${s}
    
    [RULES]
    1. Single Object isolated on a clean, simple background (or solid color).
    2. Focus on the object details.
    3. Historical accuracy for Joseon Dynasty.
    4. NO text, NO watermarks, NO user interface elements.
    5. High resolution, clear definition.
  `;o&&(u+=`
      [REFERENCE IMAGE PROVIDED]
      - Use the provided image as a strict visual reference for SHAPE, COLOR, and MATERIAL.
      - Copy the structure and design of the object in the reference image.
      - Apply the Joseon Dynasty context if necessary, but keep the core look from the reference.
      `);try{const g=[];if(o){const x=o.match(/^data:(.+);base64,(.+)$/);x&&g.push({inlineData:{mimeType:x[1],data:x[2]}})}g.push({text:u});const E=await i.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:g},config:{imageConfig:{aspectRatio:"1:1"},safetySettings:ii}});for(const x of((m=(h=(d=E.candidates)==null?void 0:d[0])==null?void 0:h.content)==null?void 0:m.parts)||[])if(x.inlineData)return`data:${x.inlineData.mimeType};base64,${x.inlineData.data}`;throw new Error("  .")}catch(g){throw console.error(g),(p=g.message)!=null&&p.includes("SAFETY")?new Error("  :   ."):new Error("     .")}},jC=async(t,e,n,r,o)=>{var I,L,P,D,M,j,Q,_,z,C;const i=gt(t),s={...e};let a=!1;const u=((I=e.gender)==null?void 0:I.match(/(\d+)\s*(||year)/i))||((L=e.extraDetails)==null?void 0:L.match(/(\d+)\s*(||year)/i));u&&parseInt(u[1])<18&&(a=!0);for(const Y in s)if(typeof s[Y]=="string"){let he=s[Y],J=await pr(i,he);a&&(Y==="gender"&&(J=J.replace(/(\d+)\s*(year old|years old)/gi,"Young")),J=J.replace(/\b(slender|curvy|sexy|hot|body|figure|breast|chest|curves|S-line|voluptuous|alluring|sensual)\b/gi,"small build"),J=J.replace(/\b(mature|adult-like|grown-up)\b/gi,"youthful"),J=J.replace(/\b(jealous|jealousy)\b/gi,"displeased"),J=J.replace(/\b(competitive|ambitious)\b/gi,"determined"),J=J.replace(/\b(woman|lady|female)\b/gi,"young girl"),J=J.replace(/\b(maid|servant)\b/gi,"apprentice"),J=J.replace(/\b(court maid|palace maid|kung-nyeo|saenggak-si|royal maid)\b/gi,"young girl in traditional hanbok"),J=J.replace(/\b(trainee court maid)\b/gi,"young student in traditional hanbok")),s[Y]=J}const d=await pr(i,r||""),h=Qo[n].prompt,m=e.optionFlags||{},p=Object.entries(s).map(([Y,he])=>{if(Y==="optionFlags"||!he||typeof he!="string")return"";const J=m[Y];if(J){if(J.enabled===!1)return"";if(J.isMandatory)return`**[CRITICAL/MANDATORY] ${Y}: ${he}**`}return`${Y}: ${he}`}).filter(Boolean).join(`
- `),g=(P=e.backgroundColor)!=null&&P.includes("Green")?"Solid Green Screen (#00FF00)":"Solid Background",E=((D=s.race)==null?void 0:D.toLowerCase().includes("pure animal"))||((M=s.race)==null?void 0:M.toLowerCase().includes("no clothes")),x=E?`[ANIMAL MODE - CRITICAL]
- DO NOT DRAW HUMAN CLOTHES (No Hanbok, No Hats).
- Draw a REALISTIC ANIMAL standing on four legs (unless specified otherwise).
- Focus on FUR texture and ANIMAL ANATOMY.`:Um,w=d?`
  [USER RESTRICTIONS - ABSOLUTE PRIORITY]
  DO NOT DRAW: ${d}.
  If the user asks to remove something, REMOVE IT COMPLETELY.
  `:"";let y="";const v=(j=s.gender)==null?void 0:j.match(/(\d+)\s*year\s*old/i);if(v&&!E){const Y=parseInt(v[1]);if(Y<18)if(Y<7)y=`
             [AGE CONTROL: TODDLER / VERY YOUNG CHILD]
             - VISUALS: Small child, toddler proportions, very short.
             - **STRICT PROHIBITION**: NO "Chibi" style, NO "SD" style, NO "Big Head".
             - **SIZE & FRAMING**:
               1. **SCALE**: The child is TINY. Occupy **ONLY 40%** of the canvas height.
               2. **EMPTY SPACE**: **50% EMPTY SPACE** above head.
               3. **NEGATIVE PROMPT**: Adult, Mature, Tall.
             - **COMPOSITION**: Bottom center.
             `;else if(Y<13){const he=30+(Y-7)*2,J=100-he-20;y=`
             [AGE CONTROL: YOUNG CHILD / ELEMENTARY AGE]
             - VISUALS: **Young child**. **Small stature**.
             - **CULTURAL CONTEXT**: In Joseon Dynasty, this age is considered a **YOUNG CHILD** (Dongja/Sonyuh).
             - **APPEARANCE**: Childish round face, innocent look, unstyled hair or simple braid. NOT a modern teenager style.
             - **PROPORTIONS (CRITICAL)**: 
               1. **HEAD-TO-BODY RATIO**: **1:7 to 1:8 RATIO**. The head must be **SMALL** relative to the body.
               2. **NO BIG HEAD**: **ABSOLUTELY NO CHIBI/SD STYLE**. The head size should be realistic like a small adult.
               3. **BODY TYPE**: Well-proportioned, just **SHORT IN HEIGHT**.
             - **SIZE & FRAMING (ABSOLUTE PRIORITY)**:
               1. **DO NOT FILL THE CANVAS**: The character must look **SMALL** in the frame.
               2. **CAMERA**: **EXTREME LONG SHOT**. Camera must be **FAR AWAY**.
               3. **SCALE**: The character must occupy **ONLY ${he}%** of the vertical space.
               4. **HEADROOM**: There must be **HUGE EMPTY SPACE (${J}%)** above the character's head.
               5. **ALIGNMENT**: Stand on the ground at the bottom, leaving the top empty.
               6. **NEGATIVE PROMPT**: Filling the frame, Zoomed in, Close up, Waist shot, Bust shot, Big head, SD style, Chibi, Anime proportions, Macro shot, Portrait lens, **Filling the screen**.
             `}else y=`- VISUALS: Youthful teenager, student age. Fresh skin, slightly smaller build than an adult.
`;else y=`
         [AGE CONTROL: ${Y} YEARS OLD]
         - The character MUST look exactly ${Y} years old.
         `,Y>=60?y+=`- VISUALS: Visible WRINKLES, aged skin texture, grey/white hair (unless dyed), wise/tired eyes.
- DO NOT make them look like a young K-pop star with grey hair. They must have OLD SKIN.
`:Y>=40&&(y+=`- VISUALS: Mature adult, slight laugh lines, confident bearing. Not a 20-year-old.
`)}const S=Object.values(e).join(" ").toLowerCase();(S.includes("")||S.includes("saenggak"))&&(a?y+=`
            - **COSTUME STYLE**: Traditional Korean apprentice girl outfit.
            - **HAIR**: Long braid with a ribbon (Daenggi), or looped hair (Saenggak-si style).
            - **CLOTHING**: Simple, neat Hanbok.
            - **APPEARANCE**: Young, innocent, disciplined student look.
            `:y+=`
            - **HISTORICAL ROLE: SAENGGAK-SI (LITTLE COURT MAID)**
            - **DEFINITION**: "Saenggak-si" refers to young court maids (Children) studying to become Nain in the Joseon Dynasty palace. It specifically means "Apprentice Court Maid" who just entered the palace for training.
            - **KOREAN CONTEXT**: "  ()       ,     ' '".
            - **AGE CONTEXT**: They are **CHILDREN** (trainees), NOT adults. They have childish features.
            - **HAIR**: "Saenggak-si" wear a specific hairstyle (often a long braid with a ribbon, or a special looped hair for trainees).
            - **CLOTHING**: Simple court maid uniform.
            `);let N=`
    ${h}
    CONTEXT: Korea, Joseon Dynasty.
    ${x} 
    ${Fm}
    ${w}
    ${y}

    TASK: Generate Character Reference Sheet.
    [DETAILS] - ${p}
    [RULES] Full Body, Feet Visible, ${g}, Neutral Pose.
  `;o&&(N+=`
      [VISUAL REFERENCE - SOURCE MATERIAL]
      The provided image is the **SOURCE ACTOR/DESIGN**.
      
      [CRITICAL INSTRUCTION]
      1. **FACE & IDENTITY**: Copy the facial features, eye shape, and expression from the reference image EXACTLY.
      2. **CLOTHING**: Maintain the style and structure of the clothing from the reference.
      3. **ADAPTATION**: Apply the Joseon Dynasty style ONLY to the texture/materials if necessary, but KEEP THE FORM.
      4. **GOAL**: The result must look like the SAME PERSON wearing the SAME CLOTHES (or Joseon version of them).
      `);try{const Y=[];if(o){const J=o.match(/^data:(.+);base64,(.+)$/);J&&Y.push({inlineData:{mimeType:J[1],data:J[2]}})}Y.push({text:N});const he=await i.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:Y},config:{imageConfig:{aspectRatio:"9:16"}}});for(const J of((z=(_=(Q=he.candidates)==null?void 0:Q[0])==null?void 0:_.content)==null?void 0:z.parts)||[])if(J.inlineData)return`data:${J.inlineData.mimeType};base64,${J.inlineData.data}`;throw new Error("  .")}catch(Y){throw(C=Y.message)!=null&&C.includes("SAFETY")?new Error("  ."):new Error("  .")}},zC=async(t,e,n="green")=>{var u,d,h;const r=gt(t),o=e.match(/^data:(.+);base64,(.+)$/);if(!o)throw new Error("Invalid image format");const a=`
    Change the background of this image to a solid flat ${n==="green"?"Green Screen":"Solid White"} (${n==="green"?"#00FF00":"#FFFFFF"}).
    [CRITICAL RULES]
    1. **KEEP FOREGROUND EXACTLY THE SAME**: Do not change the character's face, clothes, or pose. Only change the environment behind them.
    2. The background must be a single solid color for chroma keying.
    3. High quality edges.
  `;try{const m=await r.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:o[1],data:o[2]}},{text:a}]}});for(const p of((h=(d=(u=m.candidates)==null?void 0:u[0])==null?void 0:d.content)==null?void 0:h.parts)||[])if(p.inlineData)return`data:${p.inlineData.mimeType};base64,${p.inlineData.data}`;throw new Error("  .")}catch(m){throw console.error("Bg Edit Failed",m),new Error("    .")}},$C=async(t,e)=>{var i,s,a;const n=gt(t),r=e.match(/^data:(.+);base64,(.+)$/);if(!r)throw new Error("Invalid image format");const o=`
    Remove the person/character from this image completely.
    [TASK]
    1. Identify the character in the foreground.
    2. Erase the character.
    3. Inpaint (Fill) the empty space with the background texture and objects to match the surrounding environment perfectly.
    4. The result should be an empty room/landscape with NO PEOPLE.
    5. Maintain the original lighting, style, and camera angle.
  `;try{const u=await n.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:r[1],data:r[2]}},{text:o}]}});for(const d of((a=(s=(i=u.candidates)==null?void 0:i[0])==null?void 0:s.content)==null?void 0:a.parts)||[])if(d.inlineData)return`data:${d.inlineData.mimeType};base64,${d.inlineData.data}`;throw new Error("  .")}catch(u){throw console.error("Remove Char Failed",u),new Error("    .")}},WC=async(t,e,n)=>{var a,u,d;const r=gt(t),o=await pr(r,n),i=e.match(/^data:(.+);base64,(.+)$/);if(!i)throw new Error("Invalid image format");const s=`
    Modify this image based on the user's instruction.
    USER INSTRUCTION: "${o}"
    
    [RULES]
    1. Apply the change STRICTLY to the requested area.
    2. Keep the rest of the image (Face, Identity, Pose, Background) EXACTLY THE SAME unless the instruction asks to change it.
    3. High quality inpainting. Seamless blending.
    
    Example: 
    - If instruction is "Remove the hairpin", remove only the hairpin and reconstruct the hair.
    - If instruction is "Close eyes", change only the eyes.
  `;try{const h=await r.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:i[1],data:i[2]}},{text:s}]},config:{safetySettings:ii}});for(const m of((d=(u=(a=h.candidates)==null?void 0:a[0])==null?void 0:u.content)==null?void 0:d.parts)||[])if(m.inlineData)return`data:${m.inlineData.mimeType};base64,${m.inlineData.data}`;throw new Error(" .")}catch(h){throw console.error("Magic Edit Failed",h),new Error("   .")}},qC=async(t,e)=>{var o;const n=gt(t),r=`
          .
       ,      "   "  .
     
     [ ]
         " ", " ", "" , AI        .
     
     [ ]
    1. ** / **: (: (99 ), ())
    2. **   **: (:    ,   )
    3. **  /**: (:   )
    4. **  **: (: , )

    [ ]
    - **  .**
    - **[ ]   .** (   )
    - ** **:  ("~", "~")  , ** .** (: " .  .")
    - ** **:   **300~400 ** .
    -    ,  ** ** .
     
     SCRIPT:
     ${e.substring(0,3e4)}
   `;try{return((o=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:r}]}})).text)==null?void 0:o.trim())||""}catch(i){throw console.error("Global context analysis failed",i),new Error("  ")}},YC=async(t,e)=>{const n=gt(t),r=`
       1000  ** /   **.
      ,  **[  ]**     50 .

    [ ]
    ${e.substring(0,5e4)}

    [  - "  "]
    1. ** : ",    "**
       -  (: " !", "!") ** **.
       -    **    ** .
       - **,    !**  , **   **   .

    2. **   ( )**:
       - **  **: '', ''      .
       - **/ **: , , , , , , , , ,  ,   .
       - : "" (X) -> " " (O)

    3. **  (    )**:
       - **[ //]** + **[()]** + **[/]**
       - : "5  " () + " " () + "" ()
       - **    .**     . (: "~ ", "~ ", "~ ")
       - ** **: "      " (  )
       - ** **: "    " ( )

    4. **   (   )**:
       - "5    "
       - "5     "
       - "      "
       - "      "
       - "    "
       - "    "
       - "     "

    5. **  ( )**:
       - **  **: "  " (X) -> "     " (O)
       - ** **:      . (:   ,   )
       - ** **: "5", "", "10"      .
       - ** **:     ,    .

    6. ** **:
       -    ,     ( ,  ,  )  50 .

    [ ]
    **JSON   .**
    : ["5    ", "  ", ...]
  `;try{const i=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:r}]},config:{responseMimeType:"application/json"}})).text||"[]",s=wr(i);return Array.isArray(s)?s:typeof s=="object"&&Array.isArray(s.titles)?s.titles:[]}catch(o){throw console.error("Massive hooking title generation failed",o),new Error("  : "+o.message)}},KC=async(t,e,n)=>{var i;const r=gt(t),o=`
        .
     (Shot)  **   (Caption)** 1 .

    [ ]
    - : ${e}
    -  : ${n}

    [ ]
    1. ****: 15   .
    2. ****: , , ,    " ".
    3. ****:    1 . ( )
    
    :
    - " ,   "
    - "   "
    - "     "
  `;try{return((i=(await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:o}]}})).text)==null?void 0:i.trim())||""}catch(s){throw console.error("Trailer caption generation failed",s),new Error("  ")}},JC=async(t,e,n,r="auto")=>{const o=gt(t),i=e.map(h=>`[Scene ${h.sequenceNumber}] ${h.title}: ${h.visualPrompt}`).join(`
`),s={auto:"",fast_exciting:`
      [STYLE]: Korean Traditional Folk, Pungmul, Madangnori (Pure Gugak).
      [INSTRUMENTS]: Korean hand gong (Kkwaenggwari, metallic, bright, fast attack), Korean hourglass drum (Janggu, rhythmic percussion, drum roll, sharp stick sound), Barrel drum (Buk, resonant, heartbeat, bass drum), Korean gong (Jing, deep, long decay, brassy), Korean oboe (Taepyeongso, piercing, high-pitched, loud).
      [TEMPO]: Fast & Energetic (Hwimori, Jajinmori), Excited, Bouncy, Rhythmic.
      [VOCAL]: Playful, Energetic, Spoken-style, Narrative, With Chuimsae (Eol-su, Jihwaja).
      [MIXING]: Rich and well-blended sound, warm spatial mixing, energetic percussion.
      [NOTE]: **NO WESTERN INSTRUMENTS**. No Guitar, No Brass. Pure Korean sound.
      [NOTE]: The lyrics MUST be in **Jeolla-do or Chungcheong-do Dialect (Saturi)**. Use spoken word style like Pansori Aniri.
              Examples: ",  !", ",   !", ", !".
    `,sad_sorrowful:`
      [STYLE]: Sad Sagueuk Ballad, Cinematic, Emotional Gugak.
      [INSTRUMENTS]: Korean fiddle (Haegeum, two-stringed, grainy, sorrowful, violin-like), Korean bass fiddle (Ajaeng, bowed zither, mellow, deep, cello-like), Korean bamboo flute (Daegeum, breathy, wind sound), Korean zither (Gayageum, plucked, clear).
      [TEMPO]: Slow, Flowing, Rubato, Melancholic.
      [VOCAL]: Soft Female Vocals, Breathy, Sorrowful, Tearful, Lyrical.
      [MIXING]: Soft resonance, emotional reverb, intimate, grainy texture.
    `,faint_hazy:`
      [STYLE]: Dreamy Sagueuk, Ambient, Ethereal Gugak.
      [INSTRUMENTS]: Korean bamboo flute (Daegeum, breathy, air sound), Small bamboo flute (Sogeum, clear, high-pitched), Korean mouth organ (Saenghwang, mysterious chords), Korean zither (Gayageum, plucked, soft).
      [TEMPO]: Slow, Floating, Non-rhythmic, Mystical.
      [VOCAL]: Whispering, Echoing, Mysterious, Faint.
      [MIXING]: Ethereal reverb, wide spatial mixing, dreamy atmosphere.
    `,slow_mystery:`
      [STYLE]: Korean Traditional Noir, Suspense, Dark Gugak.
      [INSTRUMENTS]: Korean bass zither (Geomungo, percussive strings, deep resonance, heavy), Korean gong (Jing, dark resonance, slow decay), Barrel drum (Buk, deep thud), Korean bass fiddle (Ajaeng, low friction sound).
      [TEMPO]: Slow tension, Heartbeat rhythm, Heavy, Suspenseful.
      [VOCAL]: Low male vocal, Spoken word, Warning tone, Monologue-style.
      [MIXING]: Dark ambience, deep bass resonance, tension.
    `,medium_story:`
      [STYLE]: Korean Folk Storytelling, Mid-tempo Gugak.
      [INSTRUMENTS]: Barrel drum (Buk, resonant), Korean hourglass drum (Janggu, rhythmic), Korean bamboo flute (Daegeum, breathy), Korean zither (Gayageum, plucked, clear).
      [TEMPO]: Medium, Walking pace, Rhythmic (Gutgeori), (90-110 BPM).
      [VOCAL]: Clear narration, Minyo style, Storytelling, Conversational, With Chuimsae.
      [MIXING]: Clear vocal focus, balanced ensemble.
      [NOTE]: Use a storytelling tone (Taryeong) with occasional Chuimsae. Dialect (Saturi) is preferred for humor.
    `,grand_epic:`
      [STYLE]: Epic Sagueuk Orchestra, War Movie OST (Pure Gugak Version).
      [INSTRUMENTS]: Korean oboe (Taepyeongso, piercing, loud), Massive Barrel Drum Ensemble (Buk, thunderous, epic), Korean gong (Jing, metallic resonance), Korean double reed pipe (Piri, strong, nasal, loud), Korean hand gong (Kkwaenggwari, accent).
      [TEMPO]: Dynamic, Marching, Grandiose, Powerful.
      [VOCAL]: Grand Chorus, Chanting, Heroic, Powerful, Theatrical.
      [MIXING]: Massive sound, wide dynamic range, cinematic impact.
      [NOTE]: **NO WESTERN BRASS/STRINGS**. Create epicness with massive Korean drum ensemble and piercing wind instruments.
    `},a={auto:"Analyze the sequence and choose the most fitting Sagueuk (Korean Historical Drama) OST style using ONLY Korean traditional instruments.",mystery:`
      [STYLE]: Korean Traditional Noir, Sagueuk OST, Cinematic.
      [INSTRUMENTS]: Korean bass zither (Geomungo, percussive strings), Korean gong (Jing, dark resonance), Korean bamboo flute (Daegeum, breathy).
      [TEMPO]: Slow tension, Heartbeat rhythm, Slow-burn.
      [VOCAL]: Whispering, Low male vocal, Minimal Vocals.
      [MIXING]: Dark ambience, deep resonance.
    `,comedy:`
      [STYLE]: Korean Folk Pop, Madangnori, Upbeat OST.
      [INSTRUMENTS]: Korean hand gong (Kkwaenggwari, metallic), Korean hourglass drum (Janggu, rhythmic), Korean oboe (Taepyeongso, piercing).
      [TEMPO]: Fast Tempo, Bouncy, Rhythmic, Marching.
      [VOCAL]: Playful, Storytelling, Pansori style narration, Spoken-style.
      [MIXING]: Bright, clear, energetic.
    `,destiny:`
      [STYLE]: Epic Sagueuk Orchestra, Cinematic, Grandiose.
      [INSTRUMENTS]: Korean bamboo flute (Daegeum, breathy), Massive Barrel Drum Ensemble (Buk), Korean double reed pipe (Piri).
      [TEMPO]: Slow build-up to Fast, Dynamic, Marching.
      [VOCAL]: Grand Chorus, Chanting, Heroic Vocals.
      [MIXING]: Wide, cinematic, majestic.
    `,tragedy:`
      [STYLE]: Sad Sagueuk Ballad, Cinematic, OST.
      [INSTRUMENTS]: Korean fiddle (Haegeum, grainy, sorrowful), Korean bass fiddle (Ajaeng, mellow), Korean zither (Gayageum, plucked).
      [TEMPO]: Slow, Flowing, Rubato.
      [VOCAL]: Soft Female Vocals, Emotional, Breathy, Sorrowful.
      [MIXING]: Intimate, emotional reverb.
    `,revenge:`
      [STYLE]: Intense Gugak, Cinematic, Driving.
      [INSTRUMENTS]: Korean bass zither (Geomungo, aggressive, percussive), Barrel drum (Buk, deep), Korean oboe (Taepyeongso, piercing).
      [TEMPO]: Fast Paced, Aggressive, Driving rhythm.
      [VOCAL]: Gritty, Powerful, Spoken-style.
      [MIXING]: Sharp, punchy, intense.
    `,despair:`
      [STYLE]: Minimalist Sagueuk, Cinematic, Ambient.
      [INSTRUMENTS]: Korean bass fiddle (Ajaeng, sorrowful, bowed), Korean bamboo flute (Daegeum, breathy), Wind Sound.
      [TEMPO]: Very Slow, Dragging, Stillness.
      [VOCAL]: Spoken word, Low humming, Mournful.
      [MIXING]: Empty space, cold atmosphere.
    `};let u="";r!=="auto"&&s[r]?u=s[r]:u=a[n]||a.auto;const d=`
    You are a professional Music Director and Lyricist for a Korean Historical Drama (Sagueuk).
    Create a **Background Music (OST) prompt** for the following opening sequence.

    [GOAL]
    The music must **SUPPORT** the video, not overpower it. It should set the perfect atmosphere.
    The lyrics should be poetic and abstract, enhancing the mood without narrating every detail.
    For 'fast_exciting', 'comedy', or 'medium_story' styles:
      - **TONE**: Use **Satire & Humor (Haehak)**.
      - **STYLE**: Use **Spoken Word / Monologue (Pansori Aniri)** style.
      - **DIALECT**: Use **Korean Dialect (Saturi)** like "", "", "~", "~".
      - **CONTENT**: Directly address the situation with wit. NOT poetic descriptions.
      - Example: "     !"

    [SEQUENCE STORY]
    ${i}

    [MUSIC STYLE GUIDE]
    ${u}

    [TASK]
    1. **Title**: A catchy, poetic title for the song (Korean).
    2. **Style of Music (English)**: A single string of English tags for Suno AI.
       - **CRITICAL**: COPY the full instrument descriptions including adjectives (e.g., "Korean hand gong, metallic, bright"). DO NOT shorten to just "Kkwaenggwari".
       - **COMBINE**: Genre + Full Instrument Descriptions + Tempo + Vocal Style + Mixing Keywords.
       - **FORMAT**: Comma-separated tags.
       - **MUST INCLUDE**: "Cinematic", "OST", "Background Music", "No Intro", "Immediate Start".
    3. **Style of Music (Korean)**: A single string of Korean tags for Suno AI.
       - **COMBINE ALL ELEMENTS**: Genre + Instruments + Tempo + Vocal Style in Korean.
       - **IMPORTANT**: For "No Intro", use English "No Intro" even in the Korean string as it works better.
       - **FORMAT**: Comma-separated tags (e.g., "   OST, , , ,  , ,  , No Intro").
    4. **Lyrics**: Korean lyrics structured for ~60 seconds.
       - **CRITICAL RULE 0 (NO PRELUDE)**: The song must start singing IMMEDIATELY.
       - **CRITICAL RULE 4 (LENGTH LIMIT)**: **ABSOLUTE MAXIMUM 8 LINES TOTAL**. 
         - **Recommended Structure**: 
           [Verse] (2-4 lines)
           [Chorus] (2-4 lines)
           [Outro] (1 line)
       - **CRITICAL RULE 1 (NO NAMES)**: NEVER use specific character names. Use pronouns or metaphors.
       - **CRITICAL RULE 2 (NO SPOILERS)**: Do NOT describe specific plot events literally. Focus on *Atmosphere* and *Emotion*.
       - **CRITICAL RULE 3 (SUPPORTIVE)**: The lyrics should feel like a part of the soundtrack, not a separate pop song.

    [OUTPUT JSON FORMAT]
    {
      "title": "Song Title",
      "style_en": "Style Tags (English)",
      "style_ko": "Style Tags (Korean)",
      "lyrics": "[Verse]
Line 1
Line 2...

[Chorus]
Line 3..."
    }
  `;try{const m=(await o.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:d}]},config:{responseMimeType:"application/json"}})).text||"{}";return wr(m)}catch(h){throw console.error("Suno lyrics generation failed",h),new Error("  ")}},_f=async(t,e,n,r)=>{var a;const o=gt(t),i=e.match(/^data:(.+);base64,(.+)$/);if(!i)return n;const s=`
    You are a Video Continuity Editor.
    The user has uploaded an image that represents the **STARTING FRAME** of this video shot.
    (This image is the last frame of the previous shot).

    [TASK]
    Rewrite the "Video Prompt" to ensure perfect continuity from this image.

    [INPUT DATA]
    1. **Uploaded Image**: The visual starting point.
    2. **Original Prompt**: "${n}" (Use this ONLY as the 'Target Action' reference. IGNORE its description of the location/start state.)
    3. **Shot Context**: ${r}

    [INSTRUCTIONS]
    1. **ANALYZE VISUAL STATE (ABSOLUTE TRUTH)**: 
       - **DISCARD OLD SETUP**: Ignore any scene description in the "Original Prompt". The image IS the scene.
       - **LOCATION LOCK**: The video MUST START in the EXACT location shown in the image.
       - **CHARACTER LOCK**: Identify exactly **WHO is WHERE**. The video MUST START with them in these positions.
       - **TIME ZERO**: Treat the image as the "00:00" mark. The prompt MUST describe this static state first.
    
    2. **GENERATE NEW PROMPT (IMAGE + TARGET ACTION)**:
       - **Formula**: [Image Description] + [Transition to Target Action].
       - **STEP 1 (00:00 - STATE)**: Describe the static scene shown in the image. (e.g., "Arang is staring at her hand.")
       - **STEP 2 (00:01 - TRIGGER)**: Describe the FIRST movement FROM that position towards the goal. (e.g., "She slowly clenches her fist.")
       - **STEP 3 (00:02 - DIALOGUE)**: Insert the dialogue from the Original Prompt.
       - **STEP 4 (00:03 - REACTION)**: Describe the consequence.
       
    3. **PREVENT HALLUCINATIONS & CONTRADICTIONS**:
       - **RULE**: If the image contradicts the Original Prompt's setting (Location/Props), **THE IMAGE WINS**.
       - **Example**: Original Prompt says "In the palace...". Image shows "A dark cave". -> **RESULT**: "In the dark cave..." (Do not teleport them).
       - **RULE**: If an object is ALREADY in the image, DO NOT write a prompt that implies it "appears" or "flies in" again.
       - **Example**: If the image shows a net ALREADY covering the girl:
         - **BAD**: "Suddenly a net flies in and covers her." (AI will generate a SECOND net).
         - **GOOD**: "The existing net tightens around her. She struggles against the net."
       - **Example 2**: If the image shows a net HANGING ABOVE:
         - **BAD**: "A net is already covering her." (Wrong state).
         - **GOOD**: "A net is hanging above her. It suddenly drops."
       - **Example 3**: If the image shows a character holding a sword:
         - **BAD**: "He draws a sword." (He already has it).
         - **GOOD**: "He swings the sword he is holding."

    4. **INTEGRATE & CONNECT**: 
       - Start the prompt by describing the current state: "Video starts with [Description of positions/clothes/objects]..."
       - Then, **ANCHOR THE ACTION** to the specific visual figure.

    5. **DIALOGUE ADAPTATION (CRITICAL - LOGIC CHECK)**:
        - **CHECK**: Does the dialogue match the VISUAL STATE **and MOOD**?
        - **CASE A (Already Trapped/Attacked)**: If the image shows the character ALREADY caught in a net/trap OR looking **Terrified/In Pain**:
          - **MUST CHANGE DIALOGUE**: It is illogical to say a calm monologue like "This will cure mother...".
          - **ACTION**: Change the dialogue to a reaction: (: "!", " !", "!")
        - **CASE B (Safe State)**: If the image shows the character safe (before the trap triggers) AND looking **Calm/Focused**:
          - **KEEP DIALOGUE**: Keep the original monologue.

    6. **CAMERA & CONTINUITY (CRITICAL)**:
       - **ZOOM IN/OUT**: If using "Zoom In", specify "Zoom In **ON [CHARACTER]**". Do NOT just say "Zoom In" (this causes the character to disappear).
       - **CHARACTER PERMANENCE**: The character in the image MUST remain in the shot unless they explicitly leave.
       - **NO SUDDEN DISAPPEARANCE**: Do NOT write a prompt that implies the camera moves to an empty space. Always track the subject.

    7. **MAINTAIN KEY ELEMENTS**:
       - Keep the original action/movement intended in the prompt.
       - **ADJUST dialogue** only if it conflicts with the visual state (as per Rule 5).
       - Keep the audio instructions.
       - **CRITICAL: NO CHARACTER IDS**: Do NOT include character IDs (e.g., "(char-...)") in the output text. Use ONLY the character's Name (e.g., "Arang").

    8. **LANGUAGE**: Output in **KOREAN NATURAL LANGUAGE** (Concise Screenplay Style).
    
    [OUTPUT FORMAT]
    Return ONLY the updated Korean prompt string. Do not output JSON.
    Format: "[Start State]. [Action]. (Dialogue). [Reaction/Result]. (Audio)"
  `;try{return((a=(await o.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:i[1],data:i[2]}},{text:s}]},config:{safetySettings:ii}})).text)==null?void 0:a.trim())||n}catch(u){return console.error("Prompt refinement failed",u),n}},XC={gender:[{label:"",value:"Male"},{label:"",value:"Female"}],class:[{label:" ()",value:"Seonbi (Joseon Scholar), noble, silk robes"},{label:"/",value:"Bandit, rough appearance, wild, animal skins"},{label:"/",value:"King of Joseon, Red Royal Robe (Gonryongpo)"},{label:"/",value:"Queen of Joseon, Royal ceremonial dress"},{label:"/",value:"General, Warrior, Military uniform (Cheollik)"},{label:"/",value:"Merchant, Peddler, carrying bundle on back"},{label:"",value:"Buddhist Monk, grey robes"},{label:"/",value:"Peasant, Commoner, White hemp clothes"},{label:"",value:"Gisaeng, colorful Hanbok, artistic"},{label:"",value:"Shaman (Mudang), colorful ritual clothing"},{label:"/",value:"Magistrate (Sato), Official uniform"},{label:"// ()",value:"Pojol (Joseon Constable), This character wears a traditional black *gat* hat with a subtle sheen, featuring a black braided band, a thinner reddish-brown braided band, and a gold-colored finial on top. On the right side, vibrant multi-colored ribbons in dark blue, emerald green, bright yellow, rich red, and a lighter blue/purple, along with bright yellow tassels, are attached. His dark hair is neatly styled, likely in a topknot under the hat as traditional, with a clean hairline. The visible clothing includes a pure white *jeogori* (top), covered by a deep charcoal grey or black long outer robe and an inner vest-like garment of the same color, both featuring a very subtle, fine, dark grey patterned texture. A striking, vibrant red sash is tied at the waist with long ends hanging down. The bottom garment consists of pure white, loose-fitting *baji* (trousers)"},{label:"",value:"Grim Reaper (Jeoseung Saja), Black Hanbok, Black Gat"},{label:"/",value:"Mother figure, modest Hanbok"},{label:"/",value:"Father figure, traditional Hanbok"}],race:[{label:"",value:"Human"},{label:" (/)",value:"Anthropomorphic Animal, Humanoid body, Wearing Hanbok, Furry, Standing on two legs"},{label:" (//)",value:"Pure Animal, Realistic Creature, Walking on four legs, No clothes, No human features, Full fur"},{label:"",value:"Dokkaebi (Korean Goblin), holding club"},{label:"",value:"Gumiho (Nine-tailed Fox)"},{label:"",value:"Virgin Ghost (Cheonyeo Gwishin), white Sobok, messy hair"},{label:" (/)",value:"Tiger Spirit, anthropomorphic"},{label:" (//)",value:"Dragon King (Turtle spirit)"}],hair:[{label:" ( )",value:"Sangtu (Topknot) with Manggeon headband"},{label:" ()",value:"Daenggi-meori (Long Braid)"},{label:"  ()",value:"Half-tied hair with Manggeon ( )"},{label:" (/)",value:"Half-tied hair (No Manggeon), wild style"},{label:"  (/)",value:"Short Bob Hair (Danbal), rough cut"},{label:" (/)",value:"Shaggy Dog Hair (Deobeok-meori), messy and unkempt"},{label:"   ()",value:"Binyeo Bun (Low bun with silver hairpin)"},{label:"  ()",value:"Grey hair Sangtu (Topknot)"},{label:"   ()",value:"Grey hair Binyeo Bun"},{label:"  ()",value:"Gisaeng Gache (Large ornate wig)"},{label:"/ ",value:"Court Lady Gache (Rounded wig)"},{label:" ()",value:"Daesu-meori (Royal ceremonial wig with gold)"},{label:"  (/)",value:"Loose long black hair"},{label:" ()",value:"Wild messy hair"}],headwear:[{label:" ",value:"None"},{label:" (  )",value:"Gat (Black translucent horsehair hat)"},{label:" ()",value:"Jeongjagwan (Indoor scholar hat)"},{label:" ()",value:"Paeraengi (Bamboo hat)"},{label:" ()",value:"Jeonrip (Military hat with peacock feather)"},{label:" ()",value:"Ikseongwan (King black cap)"},{label:" ()",value:"Samo (Official black cap with wings)"},{label:" ( )",value:"Jokduri (Wedding headpiece)"},{label:" ()",value:"Jeonmo (Wide hat with butterfly decorations)"},{label:" ()",value:"Satgat (Conical straw hat)"},{label:" ()",value:"Nambawi (Winter cap)"}],outer:[{label:"  ()",value:"None"},{label:" ()",value:"Dopo (Scholar Robe with wide sleeves)"},{label:"",value:"Durumagi (Overcoat)"},{label:" ()",value:"Cheollik (Military Robe with pleated skirt)"},{label:"/",value:"Kwaeja (Long Vest)"},{label:" ( )",value:"Jangot (Coat worn over head)"},{label:"/ ()",value:"Hwarot/Wonsam (Ceremonial Robe)"},{label:" ()",value:"Sobok (White mourning clothes)"}],top:[{label:" ",value:"Jeogori (Traditional Jacket, curved sleeves)"},{label:" ",value:"Samhwejang Jeogori (Colorful cuffs and collar)"},{label:" ",value:"Saekdong Jeogori (Striped sleeves)"},{label:" ( )",value:"Jeoksam (Hemp shirt)"}],bottom:[{label:"  ()",value:"Baji (Wide trousers tied at ankles)"},{label:"  ()",value:"Chima (Full volume Ankle-length skirt, showing shoes)"},{label:" ()",value:"Seuran-chima (Ankle-length Skirt with gold leaf pattern, showing shoes)"},{label:" ( )",value:"Short Chima (Working class)"}],shoes:[{label:" ( )",value:"Jipsin (Straw shoes, covering toes like loafers)"},{label:" ()",value:"Taasahye (Leather shoes with patterns)"},{label:" ( )",value:"Mokhwa (Black velvet boots)"},{label:" ()",value:"Kkot-sin (Flower embroidered shoes)"},{label:"",value:"Barefoot"}],accessories:[{label:"",value:"None"},{label:" ()",value:"Gombangdae (Long pipe)"},{label:"",value:"Foldable Fan"},{label:" ()",value:"Hwando (Korean Sword)"},{label:" ()",value:"Cloth Bundle/Backpack (Bojim)"},{label:"",value:"Bokjumeoni (Lucky pouch)"},{label:"",value:"Norigae (Pendant)"},{label:"",value:"Eunjangdo (Silver knife)"},{label:"",value:"Wooden Walking Stick"}],bg:[{label:"  (Green)",value:"Green Screen"},{label:"  (Blue)",value:"Blue Screen"},{label:" ",value:"Solid White"},{label:" ",value:"Solid Black"}]},ZC=({onClose:t,initialName:e="",initialDesign:n,initialAge:r="30"})=>{var W,ue,ve,fe,Se,Ue,Me,Xe,Kt,yt,Jt,Ke,Xt,U,ce,ee;const{apiKey:o,selectedStyle:i,setReferenceImages:s,referenceImages:a,setCharacters:u,characters:d,showToast:h,userOptions:m,addUserOption:p,removeUserOption:g}=gn(),[E,x]=se.useState(e),[w,y]=se.useState(r),[v,S]=se.useState(null),[N,I]=se.useState(""),[L,P]=se.useState(""),[D,M]=se.useState(null),[j,Q]=se.useState(!1),_=se.useMemo(()=>{const G={...XC};return m&&Object.keys(m).forEach(O=>{const X=O;G[X]&&(G[X]=[...G[X],...m[X]||[]])}),G},[m]),z=(G,O)=>{const X=O.replace(/^\d+\.\s*/,"");S({category:G,label:X}),I(""),P("")},C=G=>{var ye;const O=(ye=G.target.files)==null?void 0:ye[0];if(!O)return;if(O.size>5*1024*1024){h("  5MB  .","warning");return}const X=new FileReader;X.onloadend=()=>{M(X.result)},X.readAsDataURL(O)},Y=async()=>{if(!(!D||!v)){if(!o){h("API  .","warning");return}Q(!0);try{const G=await OC(o,D,v.category);P(O=>(O?O+", ":"")+G),h("  .  .","success")}catch{h("  ","error")}finally{Q(!1)}}},he=()=>{if(v){if(!N.trim()||!L.trim()){h("    .","warning");return}p(v.category,{label:N,value:L}),S(null)}},[J,te]=se.useState(""),[H,ie]=se.useState({gender:(n==null?void 0:n.gender)||_.gender[0].value,class:(n==null?void 0:n.class)||_.class[0].value,race:(n==null?void 0:n.race)||_.race[0].value,hair:(n==null?void 0:n.hair)||_.hair[0].value,headwear:(n==null?void 0:n.headwear)||_.headwear[0].value,outer:(n==null?void 0:n.outer)||_.outer[0].value,top:(n==null?void 0:n.top)||_.top[0].value,bottom:(n==null?void 0:n.bottom)||_.bottom[0].value,shoes:(n==null?void 0:n.shoes)||_.shoes[0].value,accessories:(n==null?void 0:n.accessories)||_.accessories[0].value,clothingColor:(n==null?void 0:n.clothingColor)||"",backgroundColor:_.bg[0].value,extraDetails:(n==null?void 0:n.extraDetails)||""}),[F,R]=se.useState(!1),[de,ge]=se.useState(!1),[ae,_e]=se.useState(null),[ze,Ee]=se.useState(null),[Ne,Ie]=se.useState([]),Re=G=>{x(G.name),y(G.age||"30");let O="";if(G.description&&G.description.includes("[Visual Analysis]")){const X=G.description.split("[Visual Analysis]");if(X.length>1){const ye=X[1].split("[Basic Info]")[0].trim();ye&&(O=ye)}}else G.description&&(O=G.description);ie(X=>({...X,extraDetails:O})),G.visualGuide,O?h(`'${G.name}'  .   ' ' .`,"success"):h(`'${G.name}'  . (   )`,"info")},st=G=>{const O=a==null?void 0:a.find(X=>X.name===G.name);if(O&&O.imageUrl){if(Ee(O.imageUrl),Re(G),O.design){const X=O.design;let ye=X.gender||"Male";ye.includes("Male")&&(ye="Male"),ye.includes("Female")&&(ye="Female"),ie(be=>({...be,...X,gender:ye,optionFlags:X.optionFlags||be.optionFlags}))}h(`'${G.name}'  .       !`,"success")}else h(`'${G.name}'   .`,"warning")};se.useEffect(()=>{},[H.gender,w]);const qe=(G,O)=>{ie(X=>({...X,[G]:O}))},T=G=>{var ye;const O=(ye=G.target.files)==null?void 0:ye[0];if(!O)return;if(O.size>5*1024*1024){h("  5MB  .","warning");return}const X=new FileReader;X.onloadend=()=>{Ee(X.result)},X.readAsDataURL(O)},V=async()=>{if(!E.trim())return h("  ","warning");if(!w.trim())return h(" ","warning");if(!o)return h("API  ","warning");R(!0);try{const G={...H,gender:`${w} year old ${H.gender}`},O=await jC(o,G,i,J,ze||void 0);_e(O),Ie(X=>[O,...X]),h(" .   .","success")}catch(G){h(G.message,"error")}finally{R(!1)}},$=async()=>{if(!(!ae||!E)){if(!o)return h("API  .","warning");ge(!0);try{h("AI      ...","info");let G="";try{G=await Gm(o,ae)}catch(Le){console.error("Image analysis failed",Le),G="   (  )"}const O=`${w} ${H.class}. ${H.hair}, ${H.headwear}. ${H.facialFeatures?`(: ${H.facialFeatures}) `:""}${H.extraDetails}`,ye=G&&!G.includes("")?G:O,be=d.some(Le=>Le.name===E);let Ce=E;s(Le=>[...Le.filter(Ae=>Ae.name!==E),{id:`ref-${Date.now()}`,name:E,imageUrl:ae,description:ye,design:{...H,gender:`${w} year old ${H.gender}`}}]),u(Le=>{const Fe=Le.findIndex(Ae=>Ae.name===E);if(Fe>=0){const Ae=[...Le];return Ae[Fe]={...Ae[Fe],description:ye,age:w,gender:H.gender},Ae}else return[...Le,{id:`char-builder-${Date.now()}`,name:E,description:ye,visualGuide:"AI     ( )",age:w,gender:H.gender,hasDialogue:!0,chromaKeyColor:"green",actions:[]}]}),h(`'${E}'  . (   )`,"success"),t()}catch(G){h("   .","error"),console.error(G)}finally{ge(!1)}}},k=(G,O)=>{window.confirm(`'${O}'   ?`)&&g(G,O)},A=(G,O,X)=>{G.stopPropagation(),window.confirm(` '${X}'  ?
(     )`)&&(u(ye=>ye.filter(be=>be.id!==O)),s(ye=>ye.filter(be=>be.name!==X)),h(`'${X}'  .`,"success"),E===X&&x(""))},B=(G,O)=>((m==null?void 0:m[G])||[]).some(ye=>ye.label===O),ne=(G,O)=>{ie(X=>{const ye=X.optionFlags||{},be=ye[G]||{enabled:!0,isMandatory:!1};return{...X,optionFlags:{...ye,[G]:{...be,[O]:!be[O]}}}})},oe=(G,O,X,ye)=>{var Fe;const be=((Fe=H.optionFlags)==null?void 0:Fe[O])||{enabled:!0,isMandatory:!1},Ce=be.enabled,Le=be.isMandatory;return f.jsxs("div",{className:`flex flex-col gap-1 transition-opacity ${Ce?"":"opacity-50"}`,children:[f.jsxs("div",{className:"flex justify-between items-end",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold",children:G}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("button",{onClick:()=>ne(O,"enabled"),className:`text-[10px] px-2 py-0.5 rounded border font-bold ${Ce?"bg-indigo-600 text-white border-indigo-500":"bg-slate-700 text-slate-400 border-slate-600"}`,title:Ce?"  (AI )":"  (AI    -   )",children:Ce?"ON":"OFF"}),f.jsx("button",{onClick:()=>ne(O,"isMandatory"),disabled:!Ce,className:`text-[10px] px-2 py-0.5 rounded border font-bold ${Le?"bg-red-600 text-white border-red-500":"bg-slate-700 text-slate-400 border-slate-600"} ${Ce?"":"opacity-0 cursor-default"}`,title:"   ( )",children:Le?"":""}),f.jsx("button",{onClick:()=>z(ye||O,G),className:"text-[10px] text-indigo-400 hover:text-indigo-300 flex items-center gap-1 bg-indigo-900/30 px-2 py-0.5 rounded border border-indigo-500/30",title:"  ",children:f.jsx("i",{className:"fas fa-plus"})})]})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("select",{value:typeof H[O]=="string"?H[O]:"",onChange:Ae=>qe(O,Ae.target.value),disabled:!Ce,className:"bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-indigo-500 flex-grow disabled:bg-slate-800 disabled:text-slate-500",children:X.map((Ae,re)=>f.jsxs("option",{value:Ae.value,children:[Ae.label," ",B(ye||O,Ae.label)?"( )":""]},re))}),(()=>{var re;const Ae=(re=X.find(Pe=>Pe.value===H[O]))==null?void 0:re.label;return Ae&&B(ye||O,Ae)?f.jsx("button",{onClick:()=>k(ye||O,Ae),className:"bg-red-900/30 text-red-400 border border-red-500/30 px-2 rounded hover:bg-red-900/50",title:"   ",children:f.jsx("i",{className:"fas fa-trash"})}):null})()]})]})};return f.jsxs("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-fade-in overflow-hidden",children:[v&&f.jsx("div",{className:"fixed inset-0 z-[150] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:f.jsxs("div",{className:"bg-slate-800 p-6 rounded-xl border border-slate-600 shadow-2xl w-full max-w-md animate-fade-in",children:[f.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-plus-circle text-indigo-400"})," '",v.label,"'  "]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"  (  )"}),f.jsx("input",{type:"text",value:N,onChange:G=>I(G.target.value),placeholder:":  ( 9)",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white focus:ring-indigo-500",autoFocus:!0})]}),f.jsxs("div",{className:"bg-slate-900/50 p-3 rounded border border-slate-700",children:[f.jsxs("label",{className:"block text-xs font-bold text-indigo-400 mb-2 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-camera"}),"    ()"]}),f.jsxs("div",{className:"flex gap-3 items-center",children:[D?f.jsxs("div",{className:"relative h-16 w-16 bg-black rounded overflow-hidden border border-slate-600 flex-shrink-0",children:[f.jsx("img",{src:D,alt:"Option Ref",className:"h-full w-full object-cover"}),f.jsx("button",{onClick:()=>M(null),className:"absolute inset-0 bg-black/50 flex items-center justify-center text-white opacity-0 hover:opacity-100 transition-opacity",children:f.jsx("i",{className:"fas fa-times"})})]}):f.jsxs("label",{className:"cursor-pointer h-16 w-16 bg-slate-800 rounded border border-dashed border-slate-600 flex items-center justify-center text-slate-500 hover:text-white hover:border-indigo-500 transition-colors flex-shrink-0",children:[f.jsx("i",{className:"fas fa-plus"}),f.jsx("input",{type:"file",accept:"image/*",onChange:C,className:"hidden"})]}),f.jsxs("div",{className:"flex-grow",children:[f.jsx("p",{className:"text-[10px] text-slate-500 mb-2 leading-relaxed",children:"       AI    ."}),f.jsxs("button",{onClick:Y,disabled:!D||j,className:`w-full py-2 rounded text-xs font-bold flex items-center justify-center gap-2 ${D?"bg-indigo-600 hover:bg-indigo-500 text-white":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,children:[j?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-magic"}),j?" ...":"    "]})]})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-xs font-bold text-slate-400 mb-1",children:"AI   (  )"}),f.jsx("textarea",{value:L,onChange:G=>P(G.target.value),placeholder:":  9  ,  ,  ,    (  )",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white focus:ring-indigo-500 h-24 resize-none"}),f.jsx("p",{className:"text-[10px] text-slate-500 mt-1",children:"   AI    ."})]}),f.jsxs("div",{className:"flex gap-2 pt-2",children:[f.jsx("button",{onClick:()=>S(null),className:"flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-lg font-bold",children:""}),f.jsx("button",{onClick:he,className:"flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-lg font-bold",children:""})]})]})]})}),f.jsxs("div",{className:"bg-slate-800 w-full max-w-6xl h-[90vh] rounded-2xl border border-slate-600 shadow-2xl flex flex-col md:flex-row overflow-hidden",children:[f.jsxs("div",{className:"w-full md:w-1/2 p-6 overflow-y-auto border-r border-slate-700 custom-scrollbar bg-slate-800 z-10",children:[f.jsxs("div",{className:"flex justify-between items-center mb-6",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-user-edit text-indigo-400"}),"   "]}),f.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white",children:f.jsx("i",{className:"fas fa-times text-xl"})})]}),d&&d.length>0&&f.jsxs("div",{className:"mb-6 bg-slate-900/50 p-3 rounded-lg border border-slate-700",children:[f.jsxs("label",{className:"text-xs text-indigo-400 font-bold block mb-2 flex items-center gap-1",children:[f.jsx("i",{className:"fas fa-users"}),"   (  )"]}),f.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(G=>f.jsxs("div",{className:"relative group",children:[f.jsxs("button",{onClick:()=>{Re(G),G.isGroup&&h(`'${G.name}'() /.       . (  '  ' )`,"info")},className:`px-3 py-1.5 rounded-full text-xs font-bold transition-all border shadow-sm pr-14 flex items-center gap-1
                                    ${E===G.name?"bg-indigo-600 text-white border-indigo-400 ring-2 ring-indigo-400/50":G.isGroup?"bg-slate-800 text-slate-400 border-slate-700 hover:bg-slate-700 hover:text-slate-200 border-dashed":"bg-slate-700 text-slate-300 border-slate-600 hover:bg-slate-600 hover:text-white"}`,children:[G.isGroup&&f.jsx("i",{className:"fas fa-users text-[10px] opacity-70"}),G.name]}),f.jsxs("div",{className:"absolute right-1 top-1/2 -translate-y-1/2 flex gap-1",children:[f.jsx("button",{onClick:O=>{O.stopPropagation(),st(G)},className:"w-5 h-5 rounded-full bg-slate-800 text-slate-400 hover:text-indigo-400 hover:bg-slate-900 border border-slate-600 flex items-center justify-center transition-colors",title:"     (/ )",children:f.jsx("i",{className:"fas fa-edit text-[9px]"})}),f.jsx("button",{onClick:O=>A(O,G.id,G.name),className:"w-5 h-5 rounded-full bg-slate-800 text-slate-400 hover:text-red-400 hover:bg-slate-900 border border-slate-600 flex items-center justify-center transition-colors",title:"  ( )",children:f.jsx("i",{className:"fas fa-trash text-[9px]"})})]})]},G.id))}),f.jsxs("p",{className:"text-[10px] text-slate-500 mt-2",children:[f.jsx("i",{className:"fas fa-info-circle"}),"  ()       ."]})]}),n&&f.jsxs("div",{className:"mb-4 bg-indigo-900/40 border border-indigo-500/50 p-3 rounded-lg flex items-center gap-3",children:[f.jsx("i",{className:"fas fa-robot text-indigo-300 text-xl"}),f.jsxs("div",{children:[f.jsx("p",{className:"text-indigo-200 text-sm font-bold",children:"AI   "}),f.jsx("p",{className:"text-xs text-indigo-400",children:"   , ,   ."})]})]}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-sm font-bold text-slate-300 block mb-2",children:"  ( )"}),f.jsx("input",{type:"text",value:E,onChange:G=>x(G.target.value),placeholder:": , ",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white focus:ring-indigo-500 font-bold text-lg"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"col-span-2 flex gap-4",children:[f.jsxs("div",{className:`flex-1 transition-opacity ${((ue=(W=H.optionFlags)==null?void 0:W.gender)==null?void 0:ue.enabled)===!1?"opacity-50":""}`,children:[f.jsxs("div",{className:"flex justify-between items-end",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"1. "}),f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("button",{onClick:()=>ne("gender","enabled"),className:`text-[10px] px-2 py-0.5 rounded border font-bold ${((fe=(ve=H.optionFlags)==null?void 0:ve.gender)==null?void 0:fe.enabled)!==!1?"bg-indigo-600 text-white border-indigo-500":"bg-slate-700 text-slate-400 border-slate-600"}`,title:((Ue=(Se=H.optionFlags)==null?void 0:Se.gender)==null?void 0:Ue.enabled)!==!1?" ":" ",children:((Xe=(Me=H.optionFlags)==null?void 0:Me.gender)==null?void 0:Xe.enabled)!==!1?"ON":"OFF"}),f.jsx("button",{onClick:()=>ne("gender","isMandatory"),disabled:((yt=(Kt=H.optionFlags)==null?void 0:Kt.gender)==null?void 0:yt.enabled)===!1,className:`text-[10px] px-2 py-0.5 rounded border font-bold ${(Ke=(Jt=H.optionFlags)==null?void 0:Jt.gender)!=null&&Ke.isMandatory?"bg-red-600 text-white border-red-500":"bg-slate-700 text-slate-400 border-slate-600"}`,title:"  ",children:(U=(Xt=H.optionFlags)==null?void 0:Xt.gender)!=null&&U.isMandatory?"":""}),f.jsx("button",{onClick:()=>z("gender",""),className:"text-[10px] text-indigo-400 hover:text-indigo-300 flex items-center gap-1 bg-indigo-900/30 px-2 py-0.5 rounded border border-indigo-500/30",title:"   ",children:f.jsx("i",{className:"fas fa-plus"})})]})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("select",{value:H.gender,onChange:G=>qe("gender",G.target.value),disabled:((ee=(ce=H.optionFlags)==null?void 0:ce.gender)==null?void 0:ee.enabled)===!1,className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white disabled:bg-slate-800 disabled:text-slate-500",children:_.gender.map((G,O)=>f.jsxs("option",{value:G.value,children:[G.label," ",B("gender",G.label)?"()":""]},O))}),(()=>{const G=_.gender.find(O=>O.value===H.gender);return G&&B("gender",G.label)?f.jsx("button",{onClick:()=>k("gender",G.label),className:"bg-red-900/30 text-red-400 border border-red-500/30 px-2 rounded hover:bg-red-900/50",title:"  ",children:f.jsx("i",{className:"fas fa-trash"})}):null})()]})]}),f.jsxs("div",{className:"flex-1",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:" ( )"}),f.jsx("input",{type:"number",value:w,onChange:G=>y(G.target.value),placeholder:": 60",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white"})]})]}),oe("2. /","class",_.class),oe("3. ","race",_.race),!(H.race.includes("Pure Animal")||H.race.includes(" ("))&&f.jsxs(f.Fragment,{children:[oe("4.  ","hair",_.hair),oe("5. /","headwear",_.headwear),oe("6. ","outer",_.outer),oe("7. ","top",_.top),oe("8. ","bottom",_.bottom),oe("9. ","shoes",_.shoes),oe("10. /","accessories",_.accessories)]})]}),!(H.race.includes("Pure Animal")||H.race.includes(" ("))&&f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold",children:"11.   ( )"}),f.jsx("input",{type:"text",value:H.clothingColor,onChange:G=>qe("clothingColor",G.target.value),placeholder:":    ,  ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white"})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold",children:"12.   (:  )"}),f.jsx("input",{type:"text",value:H.facialFeatures||"",onChange:G=>qe("facialFeatures",G.target.value),placeholder:":  , , ,  , ...",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-yellow-500"})]}),f.jsxs("div",{className:"space-y-2 bg-indigo-900/20 p-3 rounded border border-indigo-500/30",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("label",{className:"text-xs text-indigo-300 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-plus-circle"}),"   /  ()"]}),f.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(H.extraDetails),h(" .","success")},className:"text-[10px] text-indigo-400 hover:text-indigo-200 flex items-center gap-1 px-2 py-1 rounded bg-indigo-900/50 border border-indigo-500/30 transition-all",title:" ",children:[f.jsx("i",{className:"fas fa-copy"})," "]})]}),f.jsx("textarea",{value:H.extraDetails,onChange:G=>qe("extraDetails",G.target.value),placeholder:":    ,  ,  ,  ...",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white h-16 focus:ring-indigo-500 resize-none"})]}),f.jsxs("div",{className:"space-y-2 bg-red-900/10 p-3 rounded border border-red-500/30",children:[f.jsxs("label",{className:"text-xs text-red-400 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-ban"}),"  /  (  )"]}),f.jsx("input",{type:"text",value:J,onChange:G=>te(G.target.value),placeholder:": , ,  , , , ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-red-500 placeholder-slate-500"}),f.jsxs("p",{className:"text-[10px] text-slate-400",children:["    AI ",f.jsx("strong",{children:'"   !"'}),"  ."]})]}),f.jsxs("div",{className:"space-y-2 bg-indigo-900/20 p-3 rounded border border-indigo-500/30",children:[f.jsxs("label",{className:"text-xs text-indigo-300 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-image"}),"    (/ )"]}),f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs("label",{className:"cursor-pointer bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded border border-slate-600 flex items-center gap-2 text-sm",children:[f.jsx("i",{className:"fas fa-upload"}),"  ",f.jsx("input",{type:"file",accept:"image/*",onChange:T,className:"hidden"})]}),ze&&f.jsxs("div",{className:"relative h-16 w-16 bg-black rounded border border-slate-600 overflow-hidden group",children:[f.jsx("img",{src:ze,alt:"Reference",className:"h-full w-full object-cover"}),f.jsx("button",{onClick:()=>Ee(null),className:"absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center text-red-400",children:f.jsx("i",{className:"fas fa-trash"})})]})]}),f.jsx("p",{className:"text-[10px] text-slate-400",children:" , ,     AI   ."})]}),oe("13.  ()","backgroundColor",_.bg,"bg"),f.jsxs("button",{onClick:V,disabled:F,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 mt-4",children:[F?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-paint-brush"}),"  "]})]})]}),f.jsxs("div",{className:"w-full md:w-1/2 bg-black flex flex-col relative h-full",children:[f.jsxs("div",{className:"p-4 flex-grow flex flex-col items-center justify-center overflow-hidden",children:[f.jsx("h3",{className:"text-slate-500 font-bold mb-4 absolute top-6 left-6",children:""}),f.jsxs("div",{className:"w-full max-w-sm aspect-[9/16] bg-slate-900 rounded-lg overflow-hidden border border-slate-700 flex items-center justify-center mb-4 relative shadow-2xl",children:[ae?f.jsx("img",{src:ae,alt:"Preview",className:"w-full h-full object-contain"}):f.jsxs("div",{className:"text-center text-slate-600",children:[f.jsx("i",{className:"fas fa-user-circle text-6xl mb-4 opacity-50"}),f.jsxs("p",{children:["  ",f.jsx("br",{}),"  ."]})]}),F&&f.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center backdrop-blur-sm",children:f.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-indigo-500"})})]}),ae&&f.jsxs("div",{className:"flex gap-4 w-full max-w-sm",children:[f.jsx("button",{onClick:$,disabled:de,className:`flex-1 text-white py-3 rounded-lg font-bold shadow-lg transform hover:scale-105 transition-all ${de?"bg-slate-600 cursor-not-allowed":"bg-green-600 hover:bg-green-500"}`,children:de?f.jsxs("span",{children:[f.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"    ..."]}):f.jsxs("span",{children:[f.jsx("i",{className:"fas fa-check-circle mr-2"}),"    ()"]})}),f.jsx("a",{href:ae,download:`${E}_reference.png`,className:"bg-slate-800 hover:bg-slate-700 text-white px-4 py-3 rounded-lg border border-slate-600",children:f.jsx("i",{className:"fas fa-download"})})]})]}),f.jsxs("div",{className:"bg-slate-900 border-t border-slate-700 p-4 h-48 flex-shrink-0 flex flex-col",children:[f.jsxs("p",{className:"text-xs text-slate-400 mb-2 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-history text-indigo-400"}),"     (",Ne.length,")",f.jsx("span",{className:"text-[10px] font-normal text-slate-500 ml-auto",children:" "})]}),Ne.length===0?f.jsx("div",{className:"flex-grow flex items-center justify-center text-slate-600 text-xs border border-dashed border-slate-700 rounded-lg",children:"   ."}):f.jsx("div",{className:"flex gap-3 overflow-x-auto overflow-y-hidden pb-2 custom-scrollbar px-1 h-full items-center",children:Ne.map((G,O)=>f.jsx("div",{onClick:()=>_e(G),className:`flex-shrink-0 w-20 h-28 rounded-lg overflow-hidden cursor-pointer border-2 transition-all hover:scale-105 shadow-lg ${ae===G?"border-indigo-500 ring-2 ring-indigo-500/50 scale-105":"border-slate-700 hover:border-slate-500 opacity-70 hover:opacity-100"}`,children:f.jsx("img",{src:G,alt:`History ${O}`,className:"w-full h-full object-cover"})},O))})]})]})]})]})},Ai={types:[{label:" ",value:"Object"},{label:"/ ",value:"Evidence"},{label:" (/ )",value:"Weapon"},{label:" (/ )",value:"Accessory"},{label:"/ ",value:"Furniture"}],materials:[{label:" (Wood)",value:"Wooden"},{label:"/ (Metal)",value:"Metal, Iron, Steel"},{label:" (Gold)",value:"Gold"},{label:" (Silver)",value:"Silver"},{label:" (Jade)",value:"Jade"},{label:"/ (Fabric)",value:"Fabric, Silk, Cotton"},{label:" (Paper)",value:"Paper"},{label:" (Ceramic)",value:"Ceramic, Porcelain"},{label:" (Stone)",value:"Stone"}],colors:[{label:"/",value:"Natural"},{label:" (Red)",value:"Red"},{label:" (Blue)",value:"Blue"},{label:" (Black)",value:"Black"},{label:" (White)",value:"White"},{label:" (Gold)",value:"Gold"},{label:" (Silver)",value:"Silver"},{label:" (Green)",value:"Green"}]},QC=({onClose:t,initialName:e=""})=>{const{apiKey:n,selectedStyle:r,setProps:o,showToast:i}=gn(),[s,a]=se.useState(e),[u,d]=se.useState(Ai.types[0].value),[h,m]=se.useState(""),[p,g]=se.useState(""),[E,x]=se.useState(""),[w,y]=se.useState(!1),[v,S]=se.useState(null),[N,I]=se.useState(null),[L,P]=se.useState([]),D=Q=>{var C;const _=(C=Q.target.files)==null?void 0:C[0];if(!_)return;if(_.size>5*1024*1024){i("  5MB  .","warning");return}const z=new FileReader;z.onloadend=()=>{I(z.result)},z.readAsDataURL(_)},M=async()=>{if(!s.trim())return i("  ","warning");if(!E.trim()&&!N)return i("     .","warning");if(!n)return i("API  ","warning");y(!0);try{let Q=`Type: ${u}.
`;p&&(Q+=`Color: ${p}.
`),h&&(Q+=`Material: ${h}.
`),Q+=`Details: ${E}`;const _=await VC(n,s,Q,r,N||void 0);S(_),P(z=>[_,...z]),i(" .   .","success")}catch(Q){i(Q.message,"error")}finally{y(!1)}},j=()=>{if(!v||!s)return;const Q=`${p} ${h} ${s}. ${E}`;o(_=>[..._,{id:`prop-builder-${Date.now()}`,name:s,imageUrl:v,description:Q,type:"object"}]),i(`'${s}'  !`,"success"),t()};return f.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-fade-in overflow-hidden",children:f.jsxs("div",{className:"bg-slate-800 w-full max-w-6xl h-[90vh] rounded-2xl border border-slate-600 shadow-2xl flex flex-col md:flex-row overflow-hidden",children:[f.jsxs("div",{className:"w-full md:w-1/2 p-6 overflow-y-auto border-r border-slate-700 custom-scrollbar bg-slate-800 z-10",children:[f.jsxs("div",{className:"flex justify-between items-center mb-6",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-cube text-amber-500"}),"   "]}),f.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white",children:f.jsx("i",{className:"fas fa-times text-xl"})})]}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-sm font-bold text-slate-300 block mb-2",children:" "}),f.jsx("input",{type:"text",value:s,onChange:Q=>a(Q.target.value),placeholder:": , , ",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white focus:ring-amber-500 font-bold text-lg"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"col-span-2",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"1.  "}),f.jsx("select",{value:u,onChange:Q=>d(Q.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-amber-500",children:Ai.types.map((Q,_)=>f.jsx("option",{value:Q.value,children:Q.label},_))})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"2.  (Color)"}),f.jsx("input",{type:"text",value:p,onChange:Q=>g(Q.target.value),placeholder:": , ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-amber-500",list:"color-options"}),f.jsx("datalist",{id:"color-options",children:Ai.colors.map((Q,_)=>f.jsx("option",{value:Q.label},_))})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"3.  (Material)"}),f.jsx("input",{type:"text",value:h,onChange:Q=>m(Q.target.value),placeholder:": , , ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-amber-500",list:"material-options"}),f.jsx("datalist",{id:"material-options",children:Ai.materials.map((Q,_)=>f.jsx("option",{value:Q.label},_))})]})]}),f.jsxs("div",{className:"space-y-2 bg-slate-900/50 p-3 rounded border border-slate-700",children:[f.jsxs("label",{className:"text-xs text-amber-400 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-pen"}),"    (, )"]}),f.jsx("textarea",{value:E,onChange:Q=>x(Q.target.value),placeholder:":     ,     .   .",className:"w-full bg-slate-800 border border-slate-600 rounded p-2 text-sm text-white h-24 focus:ring-amber-500 resize-none"})]}),f.jsxs("div",{className:"space-y-2 bg-amber-900/20 p-3 rounded border border-amber-500/30",children:[f.jsxs("label",{className:"text-xs text-amber-300 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-image"}),"    (/ )"]}),f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs("label",{className:"cursor-pointer bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded border border-slate-600 flex items-center gap-2 text-sm transition-colors",children:[f.jsx("i",{className:"fas fa-upload"}),"  ",f.jsx("input",{type:"file",accept:"image/*",onChange:D,className:"hidden"})]}),N&&f.jsxs("div",{className:"relative h-16 w-16 bg-black rounded border border-slate-600 overflow-hidden group",children:[f.jsx("img",{src:N,alt:"Reference",className:"h-full w-full object-cover"}),f.jsx("button",{onClick:()=>I(null),className:"absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center text-red-400",children:f.jsx("i",{className:"fas fa-trash"})})]})]}),f.jsx("p",{className:"text-[10px] text-slate-400",children:"   AI       ."})]}),f.jsxs("button",{onClick:M,disabled:w,className:"w-full bg-amber-600 hover:bg-amber-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 mt-4 transition-all hover:shadow-amber-500/20",children:[w?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-paint-brush"})," "]})]})]}),f.jsxs("div",{className:"w-full md:w-1/2 bg-black/50 p-6 flex flex-col relative",children:[f.jsx("div",{className:"flex-grow flex items-center justify-center relative bg-[url('/grid.png')]",children:v?f.jsxs("div",{className:"relative w-full max-w-md aspect-square shadow-2xl rounded-lg overflow-hidden border-2 border-slate-700 group",children:[f.jsx("img",{src:v,alt:"Preview",className:"w-full h-full object-contain bg-[#202020]"}),f.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 p-4 transform translate-y-full group-hover:translate-y-0 transition-transform",children:f.jsxs("button",{onClick:j,className:"w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg font-bold shadow-lg",children:[f.jsx("i",{className:"fas fa-check mr-2"}),"   "]})})]}):f.jsxs("div",{className:"text-center text-slate-500",children:[f.jsx("i",{className:"fas fa-cube text-6xl mb-4 opacity-20"}),f.jsx("p",{className:"text-lg",children:"  '' ."})]})}),L.length>0&&f.jsx("div",{className:"h-24 border-t border-slate-700 bg-slate-900/80 p-2 flex gap-2 overflow-x-auto custom-scrollbar mt-4",children:L.map((Q,_)=>f.jsx("div",{onClick:()=>S(Q),className:`aspect-square h-full rounded cursor-pointer border-2 overflow-hidden flex-shrink-0 ${v===Q?"border-amber-500":"border-transparent opacity-50 hover:opacity-100"}`,children:f.jsx("img",{src:Q,alt:`History ${_}`,className:"w-full h-full object-cover"})},_))})]})]})})},eN=({id:t,style:e,selected:n,onSelect:r})=>f.jsxs("div",{onClick:()=>r(t),className:`cursor-pointer rounded-xl p-4 border-2 transition-all h-full flex flex-col gap-2 relative overflow-hidden ${n?"border-indigo-500 bg-indigo-900/30 ring-2 ring-indigo-500/50":"border-slate-700 bg-slate-800 hover:border-slate-500"}`,children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("span",{className:`text-lg font-bold ${n?"text-indigo-300":"text-slate-200"}`,children:e.name}),n&&f.jsx("i",{className:"fas fa-check-circle text-indigo-400 text-xl"})]}),f.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:e.desc})]}),tN=({selected:t,onChange:e})=>{const n=[{id:"16:9",label:" (16:9)",icon:"fa-tv"},{id:"9:16",label:" (9:16)",icon:"fa-mobile-alt"},{id:"1:1",label:" (1:1)",icon:"fa-square"}];return f.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(r=>f.jsxs("button",{onClick:()=>e(r.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-2 border transition-all ${t===r.id?"bg-indigo-600 text-white border-indigo-500 shadow-md":"bg-slate-800 text-slate-400 border-slate-700 hover:bg-slate-700"}`,children:[f.jsx("i",{className:`fas ${r.icon}`}),r.label]},r.id))})},nN=({onAnalyze:t,isAnalyzing:e})=>{const{apiKey:n,script:r,scriptSegments:o,addScriptSegment:i,removeScriptSegment:s,clearScriptSegments:a,selectedStyle:u,setSelectedStyle:d,globalAspectRatio:h,setGlobalAspectRatio:m,isContinuityMode:p,setIsContinuityMode:g,referenceImages:E,setReferenceImages:x,characters:w,setCharacters:y,props:v,setProps:S,showToast:N,openModal:I}=gn(),[L,P]=se.useState(!1),[D,M]=se.useState(!1),[j,Q]=se.useState(null),[_,z]=se.useState(""),[C,Y]=se.useState(""),he=se.useRef(null),J=se.useRef(null),te=se.useRef(null),H=se.useRef(null),ie=()=>{var V;return(V=he.current)==null?void 0:V.scrollIntoView({behavior:"smooth"})},F=()=>{var V;return(V=J.current)==null?void 0:V.scrollIntoView({behavior:"smooth"})},R=(V,$,k)=>{V.preventDefault(),V.stopPropagation(),I({type:"confirm",title:"  ",message:`'${k}'    ?
(   .)`,onConfirm:()=>{x(A=>A.filter(B=>B.id!==$)),N(".","success")}})},de=()=>{te.current&&(te.current.value="",te.current.click())},ge=V=>{var A;const $=(A=V.target.files)==null?void 0:A[0];if(!$)return;if($.size>5*1024*1024){N("   5MB  .","warning");return}const k=new FileReader;k.onload=async B=>{var oe;const ne=(oe=B.target)==null?void 0:oe.result;ne&&I({type:"prompt",title:"  ",message:"    (: )",confirmText:": AI ",onConfirm:async W=>{if(W&&W.trim()){const ue=W.trim();let ve="Imported external character. (Auto-analysis failed)";if(n){N("AI    ...","success");try{ve=await Gm(n,ne)}catch(fe){console.error(fe),N(" .  .","error"),ve=" .       ."}}I({type:"textarea",title:`${ue} /  ()`,message:`AI  . 
      ** **. 
 , ,     !`,defaultValue:ve,confirmText:"  (  )",onConfirm:fe=>{const Se=fe||ve;x(Ue=>[...Ue,{id:`ref-upload-${Date.now()}`,name:ue,imageUrl:ne,description:Se}]),y(Ue=>{const Me=Ue.findIndex(Xe=>Xe.name===ue);if(Me!==-1){const Xe=[...Ue];return Xe[Me]={...Xe[Me],description:Se,visualGuide:"   ( )"},Xe}return[...Ue,{id:`char-manual-${Date.now()}`,name:ue,description:Se,visualGuide:"   ( )",age:"",gender:"",hasDialogue:!0,chromaKeyColor:"green",actions:[]}]}),N(`'${ue}'   !`,"success")}})}}})},k.onerror=()=>{N("   .","error")},k.readAsDataURL($)},ae=()=>{H.current&&(H.current.value="",H.current.click())},_e=V=>{var A;const $=(A=V.target.files)==null?void 0:A[0];if(!$)return;if($.size>5*1024*1024){N("   5MB  .","warning");return}const k=new FileReader;k.onload=async B=>{var oe;const ne=(oe=B.target)==null?void 0:oe.result;ne&&I({type:"prompt",title:"/  ",message:"    (: ,   )",confirmText:"",onConfirm:W=>{if(W&&W.trim()){const ue=W.trim();I({type:"textarea",title:`${ue}  `,message:`     .
(AI      .)`,defaultValue:"  , ,  ...",confirmText:"",onConfirm:ve=>{S(fe=>[...fe,{id:`prop-upload-${Date.now()}`,name:ue,imageUrl:ne,description:ve||" ",type:"object"}]),N(`'${ue}'  !`,"success")}})}}})},k.readAsDataURL($)},ze=()=>{if(!n){N("API  .","warning");return}M(!0)},Ee=(V,$,k)=>{V.preventDefault(),V.stopPropagation(),I({type:"confirm",title:" ",message:`'${k}'  ?`,onConfirm:()=>{S(A=>A.filter(B=>B.id!==$)),N(".","success")}})},Ne=()=>{I({type:"confirm",title:"  ",message:"  () ?",confirmText:"",onConfirm:()=>a()})},Ie=()=>{if(!_.trim()){N(" .","warning");return}const V=C.trim()||`Chapter ${o.length+1}`;i(V,_),z(""),Y(""),N(`${V} !`,"success")},Re=(V,$)=>{navigator.clipboard.writeText(V),N(`'${$}'  .`,"success")},st=()=>{if(o.length===0)return;const V=o.map($=>`[${$.title}]
${$.content}`).join(`

`);navigator.clipboard.writeText(V),N("  .","success")},[qe,T]=se.useState(30);return f.jsxs("div",{className:"space-y-10 animate-fade-in relative",children:[f.jsx("div",{ref:he}),f.jsxs("div",{className:"fixed left-6 bottom-20 flex flex-col gap-2 z-50",children:[f.jsx("button",{onClick:ie,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:f.jsx("i",{className:"fas fa-arrow-up"})}),f.jsx("button",{onClick:F,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:f.jsx("i",{className:"fas fa-arrow-down"})})]}),f.jsxs("section",{className:"space-y-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("span",{className:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-sm",children:"1"}),"  ( )"]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("input",{type:"file",ref:te,onChange:ge,accept:"image/*",className:"hidden"}),f.jsxs("button",{onClick:de,className:"bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 border border-slate-600",children:[f.jsx("i",{className:"fas fa-upload"}),"   "]}),f.jsxs("button",{onClick:()=>P(!0),className:"bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 shadow-lg",children:[f.jsx("i",{className:"fas fa-plus"}),"  "]})]})]}),E.length===0?f.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 border-dashed rounded-xl p-6 text-center text-slate-500",children:[f.jsx("i",{className:"fas fa-users text-4xl mb-3 opacity-30"}),f.jsx("p",{children:"   ."})]}):f.jsx("div",{className:"flex gap-4 overflow-x-auto pt-2 pb-4 custom-scrollbar px-1",children:E.map(V=>f.jsxs("div",{className:"min-w-[180px] w-48 bg-slate-800 rounded-lg border border-slate-700 p-3 relative group hover:border-indigo-500 transition-colors",children:[f.jsx("button",{onClick:$=>R($,V.id,V.name),className:"absolute top-2 right-2 bg-red-600 hover:bg-red-500 text-white w-7 h-7 rounded-full flex items-center justify-center shadow-lg z-20 opacity-0 group-hover:opacity-100 transition-opacity",title:"",children:f.jsx("i",{className:"fas fa-times text-xs"})}),f.jsxs("div",{className:"aspect-[9/16] bg-black rounded overflow-hidden mb-2 relative cursor-zoom-in",onClick:()=>Q({url:V.imageUrl,title:V.name}),children:[f.jsx("img",{src:V.imageUrl,alt:V.name,className:"w-full h-full object-cover hover:scale-110 transition-transform duration-300"}),f.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:f.jsx("i",{className:"fas fa-search-plus text-white opacity-0 group-hover:opacity-100 text-2xl drop-shadow-lg transform scale-50 group-hover:scale-100 transition-all"})})]}),f.jsx("p",{className:"font-bold text-center text-white text-base truncate mb-2",children:V.name}),f.jsxs("div",{className:"flex gap-2 justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:[f.jsx("button",{onClick:$=>{$.stopPropagation(),I({type:"alert",title:`${V.name} AI  `,message:V.description||"  .",confirmText:"",showCopyButton:!0,onConfirm:()=>{}})},className:"bg-green-600 hover:bg-green-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg",title:"AI   ",children:f.jsx("i",{className:"fas fa-file-alt text-xs"})}),f.jsx("button",{onClick:$=>{$.stopPropagation(),te.current&&de()},className:"bg-indigo-600 hover:bg-indigo-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg",title:" /",children:f.jsx("i",{className:"fas fa-sync-alt text-xs"})})]})]},V.id))})]}),f.jsxs("section",{className:"space-y-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("span",{className:"w-8 h-8 rounded-full bg-amber-600 flex items-center justify-center text-sm",children:"1.5"}),"  ( /)"]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("input",{type:"file",ref:H,onChange:_e,accept:"image/*",className:"hidden"}),f.jsxs("button",{onClick:ae,className:"bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 border border-slate-600",children:[f.jsx("i",{className:"fas fa-upload"}),"   "]}),f.jsxs("button",{onClick:ze,className:"bg-amber-600 hover:bg-amber-500 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 shadow-lg",children:[f.jsx("i",{className:"fas fa-cube"}),"  "]})]})]}),v.length===0?f.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 border-dashed rounded-xl p-6 text-center text-slate-500",children:[f.jsx("i",{className:"fas fa-box-open text-4xl mb-3 opacity-30"}),f.jsx("p",{children:"   . (: , ,   )"})]}):f.jsx("div",{className:"flex gap-4 overflow-x-auto pt-2 pb-4 custom-scrollbar px-1",children:v.map(V=>f.jsxs("div",{className:"min-w-[100px] w-28 bg-slate-800 rounded-lg border border-slate-700 p-2 relative group hover:border-amber-500 transition-colors",children:[f.jsxs("div",{className:"aspect-square bg-black rounded overflow-hidden mb-2 relative cursor-zoom-in",onClick:()=>Q({url:V.imageUrl,title:V.name}),children:[f.jsx("img",{src:V.imageUrl,alt:V.name,className:"w-full h-full object-cover hover:scale-110 transition-transform duration-300"}),f.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:f.jsx("i",{className:"fas fa-search-plus text-white opacity-0 group-hover:opacity-100 text-lg drop-shadow-lg transform scale-50 group-hover:scale-100 transition-all"})})]}),f.jsx("p",{className:"font-bold text-center text-white text-xs truncate",children:V.name}),f.jsx("button",{onClick:$=>Ee($,V.id,V.name),className:"absolute top-1 right-1 bg-red-600 hover:bg-red-500 text-white w-6 h-6 rounded-full flex items-center justify-center shadow-lg z-20 transition-transform active:scale-95",title:"",children:f.jsx("i",{className:"fas fa-times text-xs"})})]},V.id))})]}),f.jsxs("section",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("span",{className:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-sm",children:"2"}),"  ( )"]}),f.jsxs("div",{className:"text-slate-400 text-sm",children:["  : ",f.jsx("span",{className:"text-indigo-400 font-bold",children:r.length}),"  / ",o.length," "]})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[f.jsxs("div",{className:"bg-slate-800 p-5 rounded-xl border border-slate-700 shadow-lg flex flex-col h-full",children:[f.jsxs("div",{className:"mb-4",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold block mb-1",children:"  ()"}),f.jsx("input",{type:"text",value:C,onChange:V=>Y(V.target.value),placeholder:`Chapter ${o.length+1}`,className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-white focus:ring-indigo-500 text-sm"})]}),f.jsx("label",{className:"text-xs text-slate-400 font-bold block mb-1",children:" "}),f.jsx("textarea",{value:_,onChange:V=>z(V.target.value),placeholder:"    . (:    ...)",className:"w-full flex-grow min-h-[200px] bg-slate-900 text-base p-4 rounded-lg border border-slate-700 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 text-slate-100 placeholder-slate-500 resize-none mb-4"}),f.jsxs("button",{onClick:Ie,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-lg font-bold shadow-lg flex items-center justify-center gap-2 transition-all",children:[f.jsx("i",{className:"fas fa-plus-circle"}),"  "]})]}),f.jsxs("div",{className:"bg-slate-900/50 p-5 rounded-xl border border-slate-700 h-full flex flex-col",children:[f.jsxs("div",{className:"flex justify-between items-center mb-4",children:[f.jsxs("h3",{className:"text-lg font-bold text-slate-200",children:[f.jsx("i",{className:"fas fa-list-ol mr-2 text-indigo-400"}),"  "]}),f.jsxs("div",{className:"flex gap-2",children:[o.length>0&&f.jsxs("button",{onClick:st,className:"text-xs text-green-400 hover:text-green-300 underline mr-2",children:[f.jsx("i",{className:"fas fa-copy mr-1"})," "]}),o.length>0&&f.jsx("button",{onClick:Ne,className:"text-xs text-red-400 hover:text-red-300 underline",children:" "})]})]}),f.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-3 pr-2",style:{maxHeight:"400px"},children:o.length===0?f.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-600 opacity-50",children:[f.jsx("i",{className:"fas fa-book-open text-5xl mb-3"}),f.jsxs("p",{children:["  ",f.jsx("br",{}),"'' ."]})]}):o.map((V,$)=>f.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-600 relative group hover:border-indigo-500 transition-colors",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-xs font-bold text-indigo-300 bg-indigo-900/50 px-2 py-0.5 rounded uppercase",children:V.title||`Chapter ${$+1}`}),f.jsx("button",{onClick:()=>Re(V.content,V.title||`Chapter ${$+1}`),className:"text-slate-500 hover:text-green-400 p-1 transition-colors",title:" ",children:f.jsx("i",{className:"fas fa-copy"})})]}),f.jsx("button",{onClick:()=>s(V.id),className:"text-slate-500 hover:text-red-500 p-1",children:f.jsx("i",{className:"fas fa-trash-alt"})})]}),f.jsx("p",{className:"text-sm text-slate-300 line-clamp-3",children:V.content})]},V.id))})]})]})]}),f.jsxs("section",{className:"space-y-4",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("span",{className:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-sm",children:"3"}),""]}),f.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700 mb-4",children:[f.jsxs("div",{className:"mb-2 font-bold text-slate-300 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-crop-alt"}),"  "]}),f.jsx(tN,{selected:h,onChange:m})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.keys(Qo).map(V=>f.jsx(eN,{id:V,style:Qo[V],selected:u===V,onSelect:d},V))})]}),f.jsxs("div",{className:"flex flex-col items-center gap-4 pt-8",children:[f.jsxs("label",{className:"flex items-center gap-3 bg-slate-800 px-6 py-3 rounded-full border border-slate-600 cursor-pointer hover:bg-slate-750 select-none",children:[f.jsx("input",{type:"checkbox",checked:p,onChange:V=>g(V.target.checked),className:"w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300"}),f.jsx("span",{className:"text-lg font-bold text-indigo-300",children:"  "}),f.jsx("span",{className:"text-xs text-slate-400 border-l border-slate-600 pl-3",children:"      ."})]}),o.length===0&&f.jsx("p",{className:"text-red-400 text-sm font-bold animate-pulse",children:"   !"}),f.jsxs("div",{className:"flex items-center gap-4 bg-slate-800 p-4 rounded-xl border border-slate-700",children:[f.jsxs("div",{className:"flex flex-col",children:[f.jsxs("label",{className:"text-sm font-bold text-indigo-300 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-cut"}),"  ()  "]}),f.jsx("p",{className:"text-xs text-slate-400",children:"AI     ."})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("button",{onClick:()=>T(Math.max(5,qe-5)),className:"w-8 h-8 rounded-full bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center border border-slate-600",children:f.jsx("i",{className:"fas fa-minus"})}),f.jsx("input",{type:"number",value:qe,onChange:V=>T(parseInt(V.target.value)||0),className:"w-20 bg-slate-900 border border-indigo-500 rounded-lg p-2 text-center text-xl font-bold text-white focus:ring-2 focus:ring-indigo-500",min:"1"}),f.jsx("button",{onClick:()=>T(qe+5),className:"w-8 h-8 rounded-full bg-slate-700 hover:bg-slate-600 text-white flex items-center justify-center border border-slate-600",children:f.jsx("i",{className:"fas fa-plus"})})]})]}),f.jsxs("button",{onClick:()=>t(qe),disabled:e||o.length===0,className:"bg-indigo-600 hover:bg-indigo-500 text-white text-xl font-bold px-12 py-5 rounded-full shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-3 w-full max-w-lg justify-center",children:[e?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-magic"}),e?" ...":"   /  "]})]}),j&&f.jsx("div",{className:"fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",onClick:()=>Q(null),children:f.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh] flex flex-col items-center",children:[f.jsx("img",{src:j.url,alt:j.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl border border-slate-700",onClick:V=>V.stopPropagation()}),f.jsx("p",{className:"text-white font-bold text-xl mt-4 drop-shadow-md",children:j.title}),f.jsx("button",{onClick:()=>Q(null),className:"absolute -top-12 right-0 text-slate-400 hover:text-white transition-colors",children:f.jsx("i",{className:"fas fa-times text-4xl"})})]})}),L&&f.jsx(ZC,{onClose:()=>P(!1)}),D&&f.jsx(QC,{onClose:()=>M(!1)}),f.jsx("div",{ref:J})]})};function Ri(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Hm={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,o,i){function s(d,h){if(!o[d]){if(!r[d]){var m=typeof Ri=="function"&&Ri;if(!h&&m)return m(d,!0);if(a)return a(d,!0);var p=new Error("Cannot find module '"+d+"'");throw p.code="MODULE_NOT_FOUND",p}var g=o[d]={exports:{}};r[d][0].call(g.exports,function(E){var x=r[d][1][E];return s(x||E)},g,g.exports,n,r,o,i)}return o[d].exports}for(var a=typeof Ri=="function"&&Ri,u=0;u<i.length;u++)s(i[u]);return s}({1:[function(n,r,o){var i=n("./utils"),s=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(u){for(var d,h,m,p,g,E,x,w=[],y=0,v=u.length,S=v,N=i.getTypeOf(u)!=="string";y<u.length;)S=v-y,m=N?(d=u[y++],h=y<v?u[y++]:0,y<v?u[y++]:0):(d=u.charCodeAt(y++),h=y<v?u.charCodeAt(y++):0,y<v?u.charCodeAt(y++):0),p=d>>2,g=(3&d)<<4|h>>4,E=1<S?(15&h)<<2|m>>6:64,x=2<S?63&m:64,w.push(a.charAt(p)+a.charAt(g)+a.charAt(E)+a.charAt(x));return w.join("")},o.decode=function(u){var d,h,m,p,g,E,x=0,w=0,y="data:";if(u.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var v,S=3*(u=u.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(u.charAt(u.length-1)===a.charAt(64)&&S--,u.charAt(u.length-2)===a.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=s.uint8array?new Uint8Array(0|S):new Array(0|S);x<u.length;)d=a.indexOf(u.charAt(x++))<<2|(p=a.indexOf(u.charAt(x++)))>>4,h=(15&p)<<4|(g=a.indexOf(u.charAt(x++)))>>2,m=(3&g)<<6|(E=a.indexOf(u.charAt(x++))),v[w++]=d,g!==64&&(v[w++]=h),E!==64&&(v[w++]=m);return v}},{"./support":30,"./utils":32}],2:[function(n,r,o){var i=n("./external"),s=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),u=n("./stream/DataLengthProbe");function d(h,m,p,g,E){this.compressedSize=h,this.uncompressedSize=m,this.crc32=p,this.compression=g,this.compressedContent=E}d.prototype={getContentWorker:function(){var h=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new u("data_length")),m=this;return h.on("end",function(){if(this.streamInfo.data_length!==m.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(h,m,p){return h.pipe(new a).pipe(new u("uncompressedSize")).pipe(m.compressWorker(p)).pipe(new u("compressedSize")).withStreamInfo("compression",m)},r.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,o){var i=n("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},o.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,o){var i=n("./utils"),s=function(){for(var a,u=[],d=0;d<256;d++){a=d;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;u[d]=a}return u}();r.exports=function(a,u){return a!==void 0&&a.length?i.getTypeOf(a)!=="string"?function(d,h,m,p){var g=s,E=p+m;d^=-1;for(var x=p;x<E;x++)d=d>>>8^g[255&(d^h[x])];return-1^d}(0|u,a,a.length,0):function(d,h,m,p){var g=s,E=p+m;d^=-1;for(var x=p;x<E;x++)d=d>>>8^g[255&(d^h.charCodeAt(x))];return-1^d}(0|u,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(n,r,o){var i=null;i=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:i}},{lie:37}],7:[function(n,r,o){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=n("pako"),a=n("./utils"),u=n("./stream/GenericWorker"),d=i?"uint8array":"array";function h(m,p){u.call(this,"FlateWorker/"+m),this._pako=null,this._pakoAction=m,this._pakoOptions=p,this.meta={}}o.magic="\b\0",a.inherits(h,u),h.prototype.processChunk=function(m){this.meta=m.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(d,m.data),!1)},h.prototype.flush=function(){u.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var m=this;this._pako.onData=function(p){m.push({data:p,meta:m.meta})}},o.compressWorker=function(m){return new h("Deflate",m)},o.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,o){function i(g,E){var x,w="";for(x=0;x<E;x++)w+=String.fromCharCode(255&g),g>>>=8;return w}function s(g,E,x,w,y,v){var S,N,I=g.file,L=g.compression,P=v!==d.utf8encode,D=a.transformTo("string",v(I.name)),M=a.transformTo("string",d.utf8encode(I.name)),j=I.comment,Q=a.transformTo("string",v(j)),_=a.transformTo("string",d.utf8encode(j)),z=M.length!==I.name.length,C=_.length!==j.length,Y="",he="",J="",te=I.dir,H=I.date,ie={crc32:0,compressedSize:0,uncompressedSize:0};E&&!x||(ie.crc32=g.crc32,ie.compressedSize=g.compressedSize,ie.uncompressedSize=g.uncompressedSize);var F=0;E&&(F|=8),P||!z&&!C||(F|=2048);var R=0,de=0;te&&(R|=16),y==="UNIX"?(de=798,R|=function(ae,_e){var ze=ae;return ae||(ze=_e?16893:33204),(65535&ze)<<16}(I.unixPermissions,te)):(de=20,R|=function(ae){return 63&(ae||0)}(I.dosPermissions)),S=H.getUTCHours(),S<<=6,S|=H.getUTCMinutes(),S<<=5,S|=H.getUTCSeconds()/2,N=H.getUTCFullYear()-1980,N<<=4,N|=H.getUTCMonth()+1,N<<=5,N|=H.getUTCDate(),z&&(he=i(1,1)+i(h(D),4)+M,Y+="up"+i(he.length,2)+he),C&&(J=i(1,1)+i(h(Q),4)+_,Y+="uc"+i(J.length,2)+J);var ge="";return ge+=`
\0`,ge+=i(F,2),ge+=L.magic,ge+=i(S,2),ge+=i(N,2),ge+=i(ie.crc32,4),ge+=i(ie.compressedSize,4),ge+=i(ie.uncompressedSize,4),ge+=i(D.length,2),ge+=i(Y.length,2),{fileRecord:m.LOCAL_FILE_HEADER+ge+D+Y,dirRecord:m.CENTRAL_FILE_HEADER+i(de,2)+ge+i(Q.length,2)+"\0\0\0\0"+i(R,4)+i(w,4)+D+Y+Q}}var a=n("../utils"),u=n("../stream/GenericWorker"),d=n("../utf8"),h=n("../crc32"),m=n("../signature");function p(g,E,x,w){u.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=E,this.zipPlatform=x,this.encodeFileName=w,this.streamFiles=g,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(p,u),p.prototype.push=function(g){var E=g.meta.percent||0,x=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(g):(this.bytesWritten+=g.data.length,u.prototype.push.call(this,{data:g.data,meta:{currentFile:this.currentFile,percent:x?(E+100*(x-w-1))/x:100}}))},p.prototype.openedSource=function(g){this.currentSourceOffset=this.bytesWritten,this.currentFile=g.file.name;var E=this.streamFiles&&!g.file.dir;if(E){var x=s(g,E,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:x.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(g){this.accumulate=!1;var E=this.streamFiles&&!g.file.dir,x=s(g,E,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(x.dirRecord),E)this.push({data:function(w){return m.DATA_DESCRIPTOR+i(w.crc32,4)+i(w.compressedSize,4)+i(w.uncompressedSize,4)}(g),meta:{percent:100}});else for(this.push({data:x.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var g=this.bytesWritten,E=0;E<this.dirRecords.length;E++)this.push({data:this.dirRecords[E],meta:{percent:100}});var x=this.bytesWritten-g,w=function(y,v,S,N,I){var L=a.transformTo("string",I(N));return m.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(y,2)+i(y,2)+i(v,4)+i(S,4)+i(L.length,2)+L}(this.dirRecords.length,x,g,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(g){this._sources.push(g);var E=this;return g.on("data",function(x){E.processChunk(x)}),g.on("end",function(){E.closedSource(E.previous.streamInfo),E._sources.length?E.prepareNextSource():E.end()}),g.on("error",function(x){E.error(x)}),this},p.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(g){var E=this._sources;if(!u.prototype.error.call(this,g))return!1;for(var x=0;x<E.length;x++)try{E[x].error(g)}catch{}return!0},p.prototype.lock=function(){u.prototype.lock.call(this);for(var g=this._sources,E=0;E<g.length;E++)g[E].lock()},r.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,o){var i=n("../compressions"),s=n("./ZipFileWorker");o.generateWorker=function(a,u,d){var h=new s(u.streamFiles,d,u.platform,u.encodeFileName),m=0;try{a.forEach(function(p,g){m++;var E=function(v,S){var N=v||S,I=i[N];if(!I)throw new Error(N+" is not a valid compression method !");return I}(g.options.compression,u.compression),x=g.options.compressionOptions||u.compressionOptions||{},w=g.dir,y=g.date;g._compressWorker(E,x).withStreamInfo("file",{name:p,dir:w,date:y,comment:g.comment||"",unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions}).pipe(h)}),h.entriesCount=m}catch(p){h.error(p)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,o){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var a in this)typeof this[a]!="function"&&(s[a]=this[a]);return s}}(i.prototype=n("./object")).loadAsync=n("./load"),i.support=n("./support"),i.defaults=n("./defaults"),i.version="3.10.1",i.loadAsync=function(s,a){return new i().loadAsync(s,a)},i.external=n("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,o){var i=n("./utils"),s=n("./external"),a=n("./utf8"),u=n("./zipEntries"),d=n("./stream/Crc32Probe"),h=n("./nodejsUtils");function m(p){return new s.Promise(function(g,E){var x=p.decompressed.getContentWorker().pipe(new d);x.on("error",function(w){E(w)}).on("end",function(){x.streamInfo.crc32!==p.decompressed.crc32?E(new Error("Corrupted zip : CRC32 mismatch")):g()}).resume()})}r.exports=function(p,g){var E=this;return g=i.extend(g||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(p)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",p,!0,g.optimizedBinaryString,g.base64).then(function(x){var w=new u(g);return w.load(x),w}).then(function(x){var w=[s.Promise.resolve(x)],y=x.files;if(g.checkCRC32)for(var v=0;v<y.length;v++)w.push(m(y[v]));return s.Promise.all(w)}).then(function(x){for(var w=x.shift(),y=w.files,v=0;v<y.length;v++){var S=y[v],N=S.fileNameStr,I=i.resolve(S.fileNameStr);E.file(I,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:g.createFolders}),S.dir||(E.file(I).unsafeOriginalName=N)}return w.zipComment.length&&(E.comment=w.zipComment),E})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,o){var i=n("../utils"),s=n("../stream/GenericWorker");function a(u,d){s.call(this,"Nodejs stream input adapter for "+u),this._upstreamEnded=!1,this._bindStream(d)}i.inherits(a,s),a.prototype._bindStream=function(u){var d=this;(this._stream=u).pause(),u.on("data",function(h){d.push({data:h,meta:{percent:0}})}).on("error",function(h){d.isPaused?this.generatedError=h:d.error(h)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},a.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,o){var i=n("readable-stream").Readable;function s(a,u,d){i.call(this,u),this._helper=a;var h=this;a.on("data",function(m,p){h.push(m)||h._helper.pause(),d&&d(p)}).on("error",function(m){h.emit("error",m)}).on("end",function(){h.push(null)})}n("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(n,r,o){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(n,r,o){function i(I,L,P){var D,M=a.getTypeOf(L),j=a.extend(P||{},h);j.date=j.date||new Date,j.compression!==null&&(j.compression=j.compression.toUpperCase()),typeof j.unixPermissions=="string"&&(j.unixPermissions=parseInt(j.unixPermissions,8)),j.unixPermissions&&16384&j.unixPermissions&&(j.dir=!0),j.dosPermissions&&16&j.dosPermissions&&(j.dir=!0),j.dir&&(I=y(I)),j.createFolders&&(D=w(I))&&v.call(this,D,!0);var Q=M==="string"&&j.binary===!1&&j.base64===!1;P&&P.binary!==void 0||(j.binary=!Q),(L instanceof m&&L.uncompressedSize===0||j.dir||!L||L.length===0)&&(j.base64=!1,j.binary=!0,L="",j.compression="STORE",M="string");var _=null;_=L instanceof m||L instanceof u?L:E.isNode&&E.isStream(L)?new x(I,L):a.prepareContent(I,L,j.binary,j.optimizedBinaryString,j.base64);var z=new p(I,_,j);this.files[I]=z}var s=n("./utf8"),a=n("./utils"),u=n("./stream/GenericWorker"),d=n("./stream/StreamHelper"),h=n("./defaults"),m=n("./compressedObject"),p=n("./zipObject"),g=n("./generate"),E=n("./nodejsUtils"),x=n("./nodejs/NodejsStreamInputAdapter"),w=function(I){I.slice(-1)==="/"&&(I=I.substring(0,I.length-1));var L=I.lastIndexOf("/");return 0<L?I.substring(0,L):""},y=function(I){return I.slice(-1)!=="/"&&(I+="/"),I},v=function(I,L){return L=L!==void 0?L:h.createFolders,I=y(I),this.files[I]||i.call(this,I,null,{dir:!0,createFolders:L}),this.files[I]};function S(I){return Object.prototype.toString.call(I)==="[object RegExp]"}var N={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(I){var L,P,D;for(L in this.files)D=this.files[L],(P=L.slice(this.root.length,L.length))&&L.slice(0,this.root.length)===this.root&&I(P,D)},filter:function(I){var L=[];return this.forEach(function(P,D){I(P,D)&&L.push(D)}),L},file:function(I,L,P){if(arguments.length!==1)return I=this.root+I,i.call(this,I,L,P),this;if(S(I)){var D=I;return this.filter(function(j,Q){return!Q.dir&&D.test(j)})}var M=this.files[this.root+I];return M&&!M.dir?M:null},folder:function(I){if(!I)return this;if(S(I))return this.filter(function(M,j){return j.dir&&I.test(M)});var L=this.root+I,P=v.call(this,L),D=this.clone();return D.root=P.name,D},remove:function(I){I=this.root+I;var L=this.files[I];if(L||(I.slice(-1)!=="/"&&(I+="/"),L=this.files[I]),L&&!L.dir)delete this.files[I];else for(var P=this.filter(function(M,j){return j.name.slice(0,I.length)===I}),D=0;D<P.length;D++)delete this.files[P[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(I){var L,P={};try{if((P=a.extend(I||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");a.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var D=P.comment||this.comment||"";L=g.generateWorker(this,P,D)}catch(M){(L=new u("error")).error(M)}return new d(L,P.type||"string",P.mimeType)},generateAsync:function(I,L){return this.generateInternalStream(I).accumulate(L)},generateNodeStream:function(I,L){return(I=I||{}).type||(I.type="nodebuffer"),this.generateInternalStream(I).toNodejsStream(L)}};r.exports=N},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,o){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,o){var i=n("./DataReader");function s(a){i.call(this,a);for(var u=0;u<this.data.length;u++)a[u]=255&a[u]}n("../utils").inherits(s,i),s.prototype.byteAt=function(a){return this.data[this.zero+a]},s.prototype.lastIndexOfSignature=function(a){for(var u=a.charCodeAt(0),d=a.charCodeAt(1),h=a.charCodeAt(2),m=a.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===u&&this.data[p+1]===d&&this.data[p+2]===h&&this.data[p+3]===m)return p-this.zero;return-1},s.prototype.readAndCheckSignature=function(a){var u=a.charCodeAt(0),d=a.charCodeAt(1),h=a.charCodeAt(2),m=a.charCodeAt(3),p=this.readData(4);return u===p[0]&&d===p[1]&&h===p[2]&&m===p[3]},s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(n,r,o){var i=n("../utils");function s(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var u,d=0;for(this.checkOffset(a),u=this.index+a-1;u>=this.index;u--)d=(d<<8)+this.byteAt(u);return this.index+=a,d},readString:function(a){return i.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=s},{"../utils":32}],19:[function(n,r,o){var i=n("./Uint8ArrayReader");function s(a){i.call(this,a)}n("../utils").inherits(s,i),s.prototype.readData=function(a){this.checkOffset(a);var u=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,o){var i=n("./DataReader");function s(a){i.call(this,a)}n("../utils").inherits(s,i),s.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},s.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},s.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},s.prototype.readData=function(a){this.checkOffset(a);var u=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(n,r,o){var i=n("./ArrayReader");function s(a){i.call(this,a)}n("../utils").inherits(s,i),s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,o){var i=n("../utils"),s=n("../support"),a=n("./ArrayReader"),u=n("./StringReader"),d=n("./NodeBufferReader"),h=n("./Uint8ArrayReader");r.exports=function(m){var p=i.getTypeOf(m);return i.checkSupport(p),p!=="string"||s.uint8array?p==="nodebuffer"?new d(m):s.uint8array?new h(i.transformTo("uint8array",m)):new a(i.transformTo("array",m)):new u(m)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,o){var i=n("./GenericWorker"),s=n("../utils");function a(u){i.call(this,"ConvertWorker to "+u),this.destType=u}s.inherits(a,i),a.prototype.processChunk=function(u){this.push({data:s.transformTo(this.destType,u.data),meta:u.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,o){var i=n("./GenericWorker"),s=n("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,i),a.prototype.processChunk=function(u){this.streamInfo.crc32=s(u.data,this.streamInfo.crc32||0),this.push(u)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,o){var i=n("../utils"),s=n("./GenericWorker");function a(u){s.call(this,"DataLengthProbe for "+u),this.propName=u,this.withStreamInfo(u,0)}i.inherits(a,s),a.prototype.processChunk=function(u){if(u){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+u.data.length}s.prototype.processChunk.call(this,u)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,o){var i=n("../utils"),s=n("./GenericWorker");function a(u){s.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(h){d.dataIsReady=!0,d.data=h,d.max=h&&h.length||0,d.type=i.getTypeOf(h),d.isPaused||d._tickAndRepeat()},function(h){d.error(h)})}i.inherits(a,s),a.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,d);break;case"uint8array":u=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":u=this.data.slice(this.index,d)}return this.index=d,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,o){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,a){return this._listeners[s].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,a){if(this._listeners[s])for(var u=0;u<this._listeners[s].length;u++)this._listeners[s][u].call(this,a)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var a=this;return s.on("data",function(u){a.processChunk(u)}),s.on("end",function(){a.end()}),s.on("error",function(u){a.error(u)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,a){return this.extraStreamInfo[s]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},r.exports=i},{}],29:[function(n,r,o){var i=n("../utils"),s=n("./ConvertWorker"),a=n("./GenericWorker"),u=n("../base64"),d=n("../support"),h=n("../external"),m=null;if(d.nodestream)try{m=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(E,x){return new h.Promise(function(w,y){var v=[],S=E._internalType,N=E._outputType,I=E._mimeType;E.on("data",function(L,P){v.push(L),x&&x(P)}).on("error",function(L){v=[],y(L)}).on("end",function(){try{var L=function(P,D,M){switch(P){case"blob":return i.newBlob(i.transformTo("arraybuffer",D),M);case"base64":return u.encode(D);default:return i.transformTo(P,D)}}(N,function(P,D){var M,j=0,Q=null,_=0;for(M=0;M<D.length;M++)_+=D[M].length;switch(P){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(Q=new Uint8Array(_),M=0;M<D.length;M++)Q.set(D[M],j),j+=D[M].length;return Q;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+P+"'")}}(S,v),I);w(L)}catch(P){y(P)}v=[]}).resume()})}function g(E,x,w){var y=x;switch(x){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=x,this._mimeType=w,i.checkSupport(y),this._worker=E.pipe(new s(y)),E.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}g.prototype={accumulate:function(E){return p(this,E)},on:function(E,x){var w=this;return E==="data"?this._worker.on(E,function(y){x.call(w,y.data,y.meta)}):this._worker.on(E,function(){i.delay(x,arguments,w)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(E){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new m(this,{objectMode:this._outputType!=="nodebuffer"},E)}},r.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var i=new ArrayBuffer(0);try{o.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),o.blob=s.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!n("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,o){for(var i=n("./utils"),s=n("./support"),a=n("./nodejsUtils"),u=n("./stream/GenericWorker"),d=new Array(256),h=0;h<256;h++)d[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;d[254]=d[254]=1;function m(){u.call(this,"utf-8 decode"),this.leftOver=null}function p(){u.call(this,"utf-8 encode")}o.utf8encode=function(g){return s.nodebuffer?a.newBufferFrom(g,"utf-8"):function(E){var x,w,y,v,S,N=E.length,I=0;for(v=0;v<N;v++)(64512&(w=E.charCodeAt(v)))==55296&&v+1<N&&(64512&(y=E.charCodeAt(v+1)))==56320&&(w=65536+(w-55296<<10)+(y-56320),v++),I+=w<128?1:w<2048?2:w<65536?3:4;for(x=s.uint8array?new Uint8Array(I):new Array(I),v=S=0;S<I;v++)(64512&(w=E.charCodeAt(v)))==55296&&v+1<N&&(64512&(y=E.charCodeAt(v+1)))==56320&&(w=65536+(w-55296<<10)+(y-56320),v++),w<128?x[S++]=w:(w<2048?x[S++]=192|w>>>6:(w<65536?x[S++]=224|w>>>12:(x[S++]=240|w>>>18,x[S++]=128|w>>>12&63),x[S++]=128|w>>>6&63),x[S++]=128|63&w);return x}(g)},o.utf8decode=function(g){return s.nodebuffer?i.transformTo("nodebuffer",g).toString("utf-8"):function(E){var x,w,y,v,S=E.length,N=new Array(2*S);for(x=w=0;x<S;)if((y=E[x++])<128)N[w++]=y;else if(4<(v=d[y]))N[w++]=65533,x+=v-1;else{for(y&=v===2?31:v===3?15:7;1<v&&x<S;)y=y<<6|63&E[x++],v--;1<v?N[w++]=65533:y<65536?N[w++]=y:(y-=65536,N[w++]=55296|y>>10&1023,N[w++]=56320|1023&y)}return N.length!==w&&(N.subarray?N=N.subarray(0,w):N.length=w),i.applyFromCharCode(N)}(g=i.transformTo(s.uint8array?"uint8array":"array",g))},i.inherits(m,u),m.prototype.processChunk=function(g){var E=i.transformTo(s.uint8array?"uint8array":"array",g.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var x=E;(E=new Uint8Array(x.length+this.leftOver.length)).set(this.leftOver,0),E.set(x,this.leftOver.length)}else E=this.leftOver.concat(E);this.leftOver=null}var w=function(v,S){var N;for((S=S||v.length)>v.length&&(S=v.length),N=S-1;0<=N&&(192&v[N])==128;)N--;return N<0||N===0?S:N+d[v[N]]>S?N:S}(E),y=E;w!==E.length&&(s.uint8array?(y=E.subarray(0,w),this.leftOver=E.subarray(w,E.length)):(y=E.slice(0,w),this.leftOver=E.slice(w,E.length))),this.push({data:o.utf8decode(y),meta:g.meta})},m.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=m,i.inherits(p,u),p.prototype.processChunk=function(g){this.push({data:o.utf8encode(g.data),meta:g.meta})},o.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,o){var i=n("./support"),s=n("./base64"),a=n("./nodejsUtils"),u=n("./external");function d(x){return x}function h(x,w){for(var y=0;y<x.length;++y)w[y]=255&x.charCodeAt(y);return w}n("setimmediate"),o.newBlob=function(x,w){o.checkSupport("blob");try{return new Blob([x],{type:w})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(x),y.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var m={stringifyByChunk:function(x,w,y){var v=[],S=0,N=x.length;if(N<=y)return String.fromCharCode.apply(null,x);for(;S<N;)w==="array"||w==="nodebuffer"?v.push(String.fromCharCode.apply(null,x.slice(S,Math.min(S+y,N)))):v.push(String.fromCharCode.apply(null,x.subarray(S,Math.min(S+y,N)))),S+=y;return v.join("")},stringifyByChar:function(x){for(var w="",y=0;y<x.length;y++)w+=String.fromCharCode(x[y]);return w},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function p(x){var w=65536,y=o.getTypeOf(x),v=!0;if(y==="uint8array"?v=m.applyCanBeUsed.uint8array:y==="nodebuffer"&&(v=m.applyCanBeUsed.nodebuffer),v)for(;1<w;)try{return m.stringifyByChunk(x,y,w)}catch{w=Math.floor(w/2)}return m.stringifyByChar(x)}function g(x,w){for(var y=0;y<x.length;y++)w[y]=x[y];return w}o.applyFromCharCode=p;var E={};E.string={string:d,array:function(x){return h(x,new Array(x.length))},arraybuffer:function(x){return E.string.uint8array(x).buffer},uint8array:function(x){return h(x,new Uint8Array(x.length))},nodebuffer:function(x){return h(x,a.allocBuffer(x.length))}},E.array={string:p,array:d,arraybuffer:function(x){return new Uint8Array(x).buffer},uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return a.newBufferFrom(x)}},E.arraybuffer={string:function(x){return p(new Uint8Array(x))},array:function(x){return g(new Uint8Array(x),new Array(x.byteLength))},arraybuffer:d,uint8array:function(x){return new Uint8Array(x)},nodebuffer:function(x){return a.newBufferFrom(new Uint8Array(x))}},E.uint8array={string:p,array:function(x){return g(x,new Array(x.length))},arraybuffer:function(x){return x.buffer},uint8array:d,nodebuffer:function(x){return a.newBufferFrom(x)}},E.nodebuffer={string:p,array:function(x){return g(x,new Array(x.length))},arraybuffer:function(x){return E.nodebuffer.uint8array(x).buffer},uint8array:function(x){return g(x,new Uint8Array(x.length))},nodebuffer:d},o.transformTo=function(x,w){if(w=w||"",!x)return w;o.checkSupport(x);var y=o.getTypeOf(w);return E[y][x](w)},o.resolve=function(x){for(var w=x.split("/"),y=[],v=0;v<w.length;v++){var S=w[v];S==="."||S===""&&v!==0&&v!==w.length-1||(S===".."?y.pop():y.push(S))}return y.join("/")},o.getTypeOf=function(x){return typeof x=="string"?"string":Object.prototype.toString.call(x)==="[object Array]"?"array":i.nodebuffer&&a.isBuffer(x)?"nodebuffer":i.uint8array&&x instanceof Uint8Array?"uint8array":i.arraybuffer&&x instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(x){if(!i[x.toLowerCase()])throw new Error(x+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(x){var w,y,v="";for(y=0;y<(x||"").length;y++)v+="\\x"+((w=x.charCodeAt(y))<16?"0":"")+w.toString(16).toUpperCase();return v},o.delay=function(x,w,y){setImmediate(function(){x.apply(y||null,w||[])})},o.inherits=function(x,w){function y(){}y.prototype=w.prototype,x.prototype=new y},o.extend=function(){var x,w,y={};for(x=0;x<arguments.length;x++)for(w in arguments[x])Object.prototype.hasOwnProperty.call(arguments[x],w)&&y[w]===void 0&&(y[w]=arguments[x][w]);return y},o.prepareContent=function(x,w,y,v,S){return u.Promise.resolve(w).then(function(N){return i.blob&&(N instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(N))!==-1)&&typeof FileReader<"u"?new u.Promise(function(I,L){var P=new FileReader;P.onload=function(D){I(D.target.result)},P.onerror=function(D){L(D.target.error)},P.readAsArrayBuffer(N)}):N}).then(function(N){var I=o.getTypeOf(N);return I?(I==="arraybuffer"?N=o.transformTo("uint8array",N):I==="string"&&(S?N=s.decode(N):y&&v!==!0&&(N=function(L){return h(L,i.uint8array?new Uint8Array(L.length):new Array(L.length))}(N))),N):u.Promise.reject(new Error("Can't read the data of '"+x+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,o){var i=n("./reader/readerFor"),s=n("./utils"),a=n("./signature"),u=n("./zipEntry"),d=n("./support");function h(m){this.files=[],this.loadOptions=m}h.prototype={checkSignature:function(m){if(!this.reader.readAndCheckSignature(m)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(p)+", expected "+s.pretty(m)+")")}},isSignature:function(m,p){var g=this.reader.index;this.reader.setIndex(m);var E=this.reader.readString(4)===p;return this.reader.setIndex(g),E},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var m=this.reader.readData(this.zipCommentLength),p=d.uint8array?"uint8array":"array",g=s.transformTo(p,m);this.zipComment=this.loadOptions.decodeFileName(g)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var m,p,g,E=this.zip64EndOfCentralSize-44;0<E;)m=this.reader.readInt(2),p=this.reader.readInt(4),g=this.reader.readData(p),this.zip64ExtensibleData[m]={id:m,length:p,value:g}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var m,p;for(m=0;m<this.files.length;m++)p=this.files[m],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var m;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(m=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(m);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var m=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(m<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(m);var p=m;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(m=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(m),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var g=this.centralDirOffset+this.centralDirSize;this.zip64&&(g+=20,g+=12+this.zip64EndOfCentralSize);var E=p-g;if(0<E)this.isSignature(p,a.CENTRAL_FILE_HEADER)||(this.reader.zero=E);else if(E<0)throw new Error("Corrupted zip: missing "+Math.abs(E)+" bytes.")},prepareReader:function(m){this.reader=i(m)},load:function(m){this.prepareReader(m),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,o){var i=n("./reader/readerFor"),s=n("./utils"),a=n("./compressedObject"),u=n("./crc32"),d=n("./utf8"),h=n("./compressions"),m=n("./support");function p(g,E){this.options=g,this.loadOptions=E}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(g){var E,x;if(g.skip(22),this.fileNameLength=g.readInt(2),x=g.readInt(2),this.fileName=g.readData(this.fileNameLength),g.skip(x),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((E=function(w){for(var y in h)if(Object.prototype.hasOwnProperty.call(h,y)&&h[y].magic===w)return h[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,E,g.readData(this.compressedSize))},readCentralPart:function(g){this.versionMadeBy=g.readInt(2),g.skip(2),this.bitFlag=g.readInt(2),this.compressionMethod=g.readString(2),this.date=g.readDate(),this.crc32=g.readInt(4),this.compressedSize=g.readInt(4),this.uncompressedSize=g.readInt(4);var E=g.readInt(2);if(this.extraFieldsLength=g.readInt(2),this.fileCommentLength=g.readInt(2),this.diskNumberStart=g.readInt(2),this.internalFileAttributes=g.readInt(2),this.externalFileAttributes=g.readInt(4),this.localHeaderOffset=g.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");g.skip(E),this.readExtraFields(g),this.parseZIP64ExtraField(g),this.fileComment=g.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var g=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),g==0&&(this.dosPermissions=63&this.externalFileAttributes),g==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var g=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=g.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=g.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=g.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=g.readInt(4))}},readExtraFields:function(g){var E,x,w,y=g.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});g.index+4<y;)E=g.readInt(2),x=g.readInt(2),w=g.readData(x),this.extraFields[E]={id:E,length:x,value:w};g.setIndex(y)},handleUTF8:function(){var g=m.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var E=this.findExtraFieldUnicodePath();if(E!==null)this.fileNameStr=E;else{var x=s.transformTo(g,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(x)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var y=s.transformTo(g,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var g=this.extraFields[28789];if(g){var E=i(g.value);return E.readInt(1)!==1||u(this.fileName)!==E.readInt(4)?null:d.utf8decode(E.readData(g.length-5))}return null},findExtraFieldUnicodeComment:function(){var g=this.extraFields[25461];if(g){var E=i(g.value);return E.readInt(1)!==1||u(this.fileComment)!==E.readInt(4)?null:d.utf8decode(E.readData(g.length-5))}return null}},r.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,o){function i(E,x,w){this.name=E,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=x,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var s=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),u=n("./utf8"),d=n("./compressedObject"),h=n("./stream/GenericWorker");i.prototype={internalStream:function(E){var x=null,w="string";try{if(!E)throw new Error("No output type specified.");var y=(w=E.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),x=this._decompressWorker();var v=!this._dataBinary;v&&!y&&(x=x.pipe(new u.Utf8EncodeWorker)),!v&&y&&(x=x.pipe(new u.Utf8DecodeWorker))}catch(S){(x=new h("error")).error(S)}return new s(x,w,"")},async:function(E,x){return this.internalStream(E).accumulate(x)},nodeStream:function(E,x){return this.internalStream(E||"nodebuffer").toNodejsStream(x)},_compressWorker:function(E,x){if(this._data instanceof d&&this._data.compression.magic===E.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new u.Utf8EncodeWorker)),d.createWorkerFrom(w,E,x)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var m=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},g=0;g<m.length;g++)i.prototype[m[g]]=p;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,o){(function(i){var s,a,u=i.MutationObserver||i.WebKitMutationObserver;if(u){var d=0,h=new u(E),m=i.document.createTextNode("");h.observe(m,{characterData:!0}),s=function(){m.data=d=++d%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var x=i.document.createElement("script");x.onreadystatechange=function(){E(),x.onreadystatechange=null,x.parentNode.removeChild(x),x=null},i.document.documentElement.appendChild(x)}:function(){setTimeout(E,0)};else{var p=new i.MessageChannel;p.port1.onmessage=E,s=function(){p.port2.postMessage(0)}}var g=[];function E(){var x,w;a=!0;for(var y=g.length;y;){for(w=g,g=[],x=-1;++x<y;)w[x]();y=g.length}a=!1}r.exports=function(x){g.push(x)!==1||a||s()}}).call(this,typeof Nn<"u"?Nn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,o){var i=n("immediate");function s(){}var a={},u=["REJECTED"],d=["FULFILLED"],h=["PENDING"];function m(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,y!==s&&x(this,y)}function p(y,v,S){this.promise=y,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function g(y,v,S){i(function(){var N;try{N=v(S)}catch(I){return a.reject(y,I)}N===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,N)})}function E(y){var v=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof v=="function")return function(){v.apply(y,arguments)}}function x(y,v){var S=!1;function N(P){S||(S=!0,a.reject(y,P))}function I(P){S||(S=!0,a.resolve(y,P))}var L=w(function(){v(I,N)});L.status==="error"&&N(L.value)}function w(y,v){var S={};try{S.value=y(v),S.status="success"}catch(N){S.status="error",S.value=N}return S}(r.exports=m).prototype.finally=function(y){if(typeof y!="function")return this;var v=this.constructor;return this.then(function(S){return v.resolve(y()).then(function(){return S})},function(S){return v.resolve(y()).then(function(){throw S})})},m.prototype.catch=function(y){return this.then(null,y)},m.prototype.then=function(y,v){if(typeof y!="function"&&this.state===d||typeof v!="function"&&this.state===u)return this;var S=new this.constructor(s);return this.state!==h?g(S,this.state===d?y:v,this.outcome):this.queue.push(new p(S,y,v)),S},p.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},p.prototype.otherCallFulfilled=function(y){g(this.promise,this.onFulfilled,y)},p.prototype.callRejected=function(y){a.reject(this.promise,y)},p.prototype.otherCallRejected=function(y){g(this.promise,this.onRejected,y)},a.resolve=function(y,v){var S=w(E,v);if(S.status==="error")return a.reject(y,S.value);var N=S.value;if(N)x(y,N);else{y.state=d,y.outcome=v;for(var I=-1,L=y.queue.length;++I<L;)y.queue[I].callFulfilled(v)}return y},a.reject=function(y,v){y.state=u,y.outcome=v;for(var S=-1,N=y.queue.length;++S<N;)y.queue[S].callRejected(v);return y},m.resolve=function(y){return y instanceof this?y:a.resolve(new this(s),y)},m.reject=function(y){var v=new this(s);return a.reject(v,y)},m.all=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=y.length,N=!1;if(!S)return this.resolve([]);for(var I=new Array(S),L=0,P=-1,D=new this(s);++P<S;)M(y[P],P);return D;function M(j,Q){v.resolve(j).then(function(_){I[Q]=_,++L!==S||N||(N=!0,a.resolve(D,I))},function(_){N||(N=!0,a.reject(D,_))})}},m.race=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=y.length,N=!1;if(!S)return this.resolve([]);for(var I=-1,L=new this(s);++I<S;)P=y[I],v.resolve(P).then(function(D){N||(N=!0,a.resolve(L,D))},function(D){N||(N=!0,a.reject(L,D))});var P;return L}},{immediate:36}],38:[function(n,r,o){var i={};(0,n("./lib/utils/common").assign)(i,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,o){var i=n("./zlib/deflate"),s=n("./utils/common"),a=n("./utils/strings"),u=n("./zlib/messages"),d=n("./zlib/zstream"),h=Object.prototype.toString,m=0,p=-1,g=0,E=8;function x(y){if(!(this instanceof x))return new x(y);this.options=s.assign({level:p,method:E,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},y||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var S=i.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(S!==m)throw new Error(u[S]);if(v.header&&i.deflateSetHeader(this.strm,v.header),v.dictionary){var N;if(N=typeof v.dictionary=="string"?a.string2buf(v.dictionary):h.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(S=i.deflateSetDictionary(this.strm,N))!==m)throw new Error(u[S]);this._dict_set=!0}}function w(y,v){var S=new x(v);if(S.push(y,!0),S.err)throw S.msg||u[S.err];return S.result}x.prototype.push=function(y,v){var S,N,I=this.strm,L=this.options.chunkSize;if(this.ended)return!1;N=v===~~v?v:v===!0?4:0,typeof y=="string"?I.input=a.string2buf(y):h.call(y)==="[object ArrayBuffer]"?I.input=new Uint8Array(y):I.input=y,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new s.Buf8(L),I.next_out=0,I.avail_out=L),(S=i.deflate(I,N))!==1&&S!==m)return this.onEnd(S),!(this.ended=!0);I.avail_out!==0&&(I.avail_in!==0||N!==4&&N!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(s.shrinkBuf(I.output,I.next_out))):this.onData(s.shrinkBuf(I.output,I.next_out)))}while((0<I.avail_in||I.avail_out===0)&&S!==1);return N===4?(S=i.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===m):N!==2||(this.onEnd(m),!(I.avail_out=0))},x.prototype.onData=function(y){this.chunks.push(y)},x.prototype.onEnd=function(y){y===m&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},o.Deflate=x,o.deflate=w,o.deflateRaw=function(y,v){return(v=v||{}).raw=!0,w(y,v)},o.gzip=function(y,v){return(v=v||{}).gzip=!0,w(y,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,o){var i=n("./zlib/inflate"),s=n("./utils/common"),a=n("./utils/strings"),u=n("./zlib/constants"),d=n("./zlib/messages"),h=n("./zlib/zstream"),m=n("./zlib/gzheader"),p=Object.prototype.toString;function g(x){if(!(this instanceof g))return new g(x);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},x||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||x&&x.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var y=i.inflateInit2(this.strm,w.windowBits);if(y!==u.Z_OK)throw new Error(d[y]);this.header=new m,i.inflateGetHeader(this.strm,this.header)}function E(x,w){var y=new g(w);if(y.push(x,!0),y.err)throw y.msg||d[y.err];return y.result}g.prototype.push=function(x,w){var y,v,S,N,I,L,P=this.strm,D=this.options.chunkSize,M=this.options.dictionary,j=!1;if(this.ended)return!1;v=w===~~w?w:w===!0?u.Z_FINISH:u.Z_NO_FLUSH,typeof x=="string"?P.input=a.binstring2buf(x):p.call(x)==="[object ArrayBuffer]"?P.input=new Uint8Array(x):P.input=x,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new s.Buf8(D),P.next_out=0,P.avail_out=D),(y=i.inflate(P,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&M&&(L=typeof M=="string"?a.string2buf(M):p.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,y=i.inflateSetDictionary(this.strm,L)),y===u.Z_BUF_ERROR&&j===!0&&(y=u.Z_OK,j=!1),y!==u.Z_STREAM_END&&y!==u.Z_OK)return this.onEnd(y),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&y!==u.Z_STREAM_END&&(P.avail_in!==0||v!==u.Z_FINISH&&v!==u.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=a.utf8border(P.output,P.next_out),N=P.next_out-S,I=a.buf2string(P.output,S),P.next_out=N,P.avail_out=D-N,N&&s.arraySet(P.output,P.output,S,N,0),this.onData(I)):this.onData(s.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(j=!0)}while((0<P.avail_in||P.avail_out===0)&&y!==u.Z_STREAM_END);return y===u.Z_STREAM_END&&(v=u.Z_FINISH),v===u.Z_FINISH?(y=i.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===u.Z_OK):v!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),!(P.avail_out=0))},g.prototype.onData=function(x){this.chunks.push(x)},g.prototype.onEnd=function(x){x===u.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},o.Inflate=g,o.inflate=E,o.inflateRaw=function(x,w){return(w=w||{}).raw=!0,E(x,w)},o.ungzip=E},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,o){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(u){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var h=d.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var m in h)h.hasOwnProperty(m)&&(u[m]=h[m])}}return u},o.shrinkBuf=function(u,d){return u.length===d?u:u.subarray?u.subarray(0,d):(u.length=d,u)};var s={arraySet:function(u,d,h,m,p){if(d.subarray&&u.subarray)u.set(d.subarray(h,h+m),p);else for(var g=0;g<m;g++)u[p+g]=d[h+g]},flattenChunks:function(u){var d,h,m,p,g,E;for(d=m=0,h=u.length;d<h;d++)m+=u[d].length;for(E=new Uint8Array(m),d=p=0,h=u.length;d<h;d++)g=u[d],E.set(g,p),p+=g.length;return E}},a={arraySet:function(u,d,h,m,p){for(var g=0;g<m;g++)u[p+g]=d[h+g]},flattenChunks:function(u){return[].concat.apply([],u)}};o.setTyped=function(u){u?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,s)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,a))},o.setTyped(i)},{}],42:[function(n,r,o){var i=n("./common"),s=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var u=new i.Buf8(256),d=0;d<256;d++)u[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function h(m,p){if(p<65537&&(m.subarray&&a||!m.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(m,p));for(var g="",E=0;E<p;E++)g+=String.fromCharCode(m[E]);return g}u[254]=u[254]=1,o.string2buf=function(m){var p,g,E,x,w,y=m.length,v=0;for(x=0;x<y;x++)(64512&(g=m.charCodeAt(x)))==55296&&x+1<y&&(64512&(E=m.charCodeAt(x+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),x++),v+=g<128?1:g<2048?2:g<65536?3:4;for(p=new i.Buf8(v),x=w=0;w<v;x++)(64512&(g=m.charCodeAt(x)))==55296&&x+1<y&&(64512&(E=m.charCodeAt(x+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),x++),g<128?p[w++]=g:(g<2048?p[w++]=192|g>>>6:(g<65536?p[w++]=224|g>>>12:(p[w++]=240|g>>>18,p[w++]=128|g>>>12&63),p[w++]=128|g>>>6&63),p[w++]=128|63&g);return p},o.buf2binstring=function(m){return h(m,m.length)},o.binstring2buf=function(m){for(var p=new i.Buf8(m.length),g=0,E=p.length;g<E;g++)p[g]=m.charCodeAt(g);return p},o.buf2string=function(m,p){var g,E,x,w,y=p||m.length,v=new Array(2*y);for(g=E=0;g<y;)if((x=m[g++])<128)v[E++]=x;else if(4<(w=u[x]))v[E++]=65533,g+=w-1;else{for(x&=w===2?31:w===3?15:7;1<w&&g<y;)x=x<<6|63&m[g++],w--;1<w?v[E++]=65533:x<65536?v[E++]=x:(x-=65536,v[E++]=55296|x>>10&1023,v[E++]=56320|1023&x)}return h(v,E)},o.utf8border=function(m,p){var g;for((p=p||m.length)>m.length&&(p=m.length),g=p-1;0<=g&&(192&m[g])==128;)g--;return g<0||g===0?p:g+u[m[g]]>p?g:p}},{"./common":41}],43:[function(n,r,o){r.exports=function(i,s,a,u){for(var d=65535&i|0,h=i>>>16&65535|0,m=0;a!==0;){for(a-=m=2e3<a?2e3:a;h=h+(d=d+s[u++]|0)|0,--m;);d%=65521,h%=65521}return d|h<<16|0}},{}],44:[function(n,r,o){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,o){var i=function(){for(var s,a=[],u=0;u<256;u++){s=u;for(var d=0;d<8;d++)s=1&s?3988292384^s>>>1:s>>>1;a[u]=s}return a}();r.exports=function(s,a,u,d){var h=i,m=d+u;s^=-1;for(var p=d;p<m;p++)s=s>>>8^h[255&(s^a[p])];return-1^s}},{}],46:[function(n,r,o){var i,s=n("../utils/common"),a=n("./trees"),u=n("./adler32"),d=n("./crc32"),h=n("./messages"),m=0,p=4,g=0,E=-2,x=-1,w=4,y=2,v=8,S=9,N=286,I=30,L=19,P=2*N+1,D=15,M=3,j=258,Q=j+M+1,_=42,z=113,C=1,Y=2,he=3,J=4;function te(T,V){return T.msg=h[V],V}function H(T){return(T<<1)-(4<T?9:0)}function ie(T){for(var V=T.length;0<=--V;)T[V]=0}function F(T){var V=T.state,$=V.pending;$>T.avail_out&&($=T.avail_out),$!==0&&(s.arraySet(T.output,V.pending_buf,V.pending_out,$,T.next_out),T.next_out+=$,V.pending_out+=$,T.total_out+=$,T.avail_out-=$,V.pending-=$,V.pending===0&&(V.pending_out=0))}function R(T,V){a._tr_flush_block(T,0<=T.block_start?T.block_start:-1,T.strstart-T.block_start,V),T.block_start=T.strstart,F(T.strm)}function de(T,V){T.pending_buf[T.pending++]=V}function ge(T,V){T.pending_buf[T.pending++]=V>>>8&255,T.pending_buf[T.pending++]=255&V}function ae(T,V){var $,k,A=T.max_chain_length,B=T.strstart,ne=T.prev_length,oe=T.nice_match,W=T.strstart>T.w_size-Q?T.strstart-(T.w_size-Q):0,ue=T.window,ve=T.w_mask,fe=T.prev,Se=T.strstart+j,Ue=ue[B+ne-1],Me=ue[B+ne];T.prev_length>=T.good_match&&(A>>=2),oe>T.lookahead&&(oe=T.lookahead);do if(ue[($=V)+ne]===Me&&ue[$+ne-1]===Ue&&ue[$]===ue[B]&&ue[++$]===ue[B+1]){B+=2,$++;do;while(ue[++B]===ue[++$]&&ue[++B]===ue[++$]&&ue[++B]===ue[++$]&&ue[++B]===ue[++$]&&ue[++B]===ue[++$]&&ue[++B]===ue[++$]&&ue[++B]===ue[++$]&&ue[++B]===ue[++$]&&B<Se);if(k=j-(Se-B),B=Se-j,ne<k){if(T.match_start=V,oe<=(ne=k))break;Ue=ue[B+ne-1],Me=ue[B+ne]}}while((V=fe[V&ve])>W&&--A!=0);return ne<=T.lookahead?ne:T.lookahead}function _e(T){var V,$,k,A,B,ne,oe,W,ue,ve,fe=T.w_size;do{if(A=T.window_size-T.lookahead-T.strstart,T.strstart>=fe+(fe-Q)){for(s.arraySet(T.window,T.window,fe,fe,0),T.match_start-=fe,T.strstart-=fe,T.block_start-=fe,V=$=T.hash_size;k=T.head[--V],T.head[V]=fe<=k?k-fe:0,--$;);for(V=$=fe;k=T.prev[--V],T.prev[V]=fe<=k?k-fe:0,--$;);A+=fe}if(T.strm.avail_in===0)break;if(ne=T.strm,oe=T.window,W=T.strstart+T.lookahead,ue=A,ve=void 0,ve=ne.avail_in,ue<ve&&(ve=ue),$=ve===0?0:(ne.avail_in-=ve,s.arraySet(oe,ne.input,ne.next_in,ve,W),ne.state.wrap===1?ne.adler=u(ne.adler,oe,ve,W):ne.state.wrap===2&&(ne.adler=d(ne.adler,oe,ve,W)),ne.next_in+=ve,ne.total_in+=ve,ve),T.lookahead+=$,T.lookahead+T.insert>=M)for(B=T.strstart-T.insert,T.ins_h=T.window[B],T.ins_h=(T.ins_h<<T.hash_shift^T.window[B+1])&T.hash_mask;T.insert&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[B+M-1])&T.hash_mask,T.prev[B&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=B,B++,T.insert--,!(T.lookahead+T.insert<M)););}while(T.lookahead<Q&&T.strm.avail_in!==0)}function ze(T,V){for(var $,k;;){if(T.lookahead<Q){if(_e(T),T.lookahead<Q&&V===m)return C;if(T.lookahead===0)break}if($=0,T.lookahead>=M&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+M-1])&T.hash_mask,$=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),$!==0&&T.strstart-$<=T.w_size-Q&&(T.match_length=ae(T,$)),T.match_length>=M)if(k=a._tr_tally(T,T.strstart-T.match_start,T.match_length-M),T.lookahead-=T.match_length,T.match_length<=T.max_lazy_match&&T.lookahead>=M){for(T.match_length--;T.strstart++,T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+M-1])&T.hash_mask,$=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart,--T.match_length!=0;);T.strstart++}else T.strstart+=T.match_length,T.match_length=0,T.ins_h=T.window[T.strstart],T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+1])&T.hash_mask;else k=a._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++;if(k&&(R(T,!1),T.strm.avail_out===0))return C}return T.insert=T.strstart<M-1?T.strstart:M-1,V===p?(R(T,!0),T.strm.avail_out===0?he:J):T.last_lit&&(R(T,!1),T.strm.avail_out===0)?C:Y}function Ee(T,V){for(var $,k,A;;){if(T.lookahead<Q){if(_e(T),T.lookahead<Q&&V===m)return C;if(T.lookahead===0)break}if($=0,T.lookahead>=M&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+M-1])&T.hash_mask,$=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),T.prev_length=T.match_length,T.prev_match=T.match_start,T.match_length=M-1,$!==0&&T.prev_length<T.max_lazy_match&&T.strstart-$<=T.w_size-Q&&(T.match_length=ae(T,$),T.match_length<=5&&(T.strategy===1||T.match_length===M&&4096<T.strstart-T.match_start)&&(T.match_length=M-1)),T.prev_length>=M&&T.match_length<=T.prev_length){for(A=T.strstart+T.lookahead-M,k=a._tr_tally(T,T.strstart-1-T.prev_match,T.prev_length-M),T.lookahead-=T.prev_length-1,T.prev_length-=2;++T.strstart<=A&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+M-1])&T.hash_mask,$=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),--T.prev_length!=0;);if(T.match_available=0,T.match_length=M-1,T.strstart++,k&&(R(T,!1),T.strm.avail_out===0))return C}else if(T.match_available){if((k=a._tr_tally(T,0,T.window[T.strstart-1]))&&R(T,!1),T.strstart++,T.lookahead--,T.strm.avail_out===0)return C}else T.match_available=1,T.strstart++,T.lookahead--}return T.match_available&&(k=a._tr_tally(T,0,T.window[T.strstart-1]),T.match_available=0),T.insert=T.strstart<M-1?T.strstart:M-1,V===p?(R(T,!0),T.strm.avail_out===0?he:J):T.last_lit&&(R(T,!1),T.strm.avail_out===0)?C:Y}function Ne(T,V,$,k,A){this.good_length=T,this.max_lazy=V,this.nice_length=$,this.max_chain=k,this.func=A}function Ie(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*P),this.dyn_dtree=new s.Buf16(2*(2*I+1)),this.bl_tree=new s.Buf16(2*(2*L+1)),ie(this.dyn_ltree),ie(this.dyn_dtree),ie(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(D+1),this.heap=new s.Buf16(2*N+1),ie(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*N+1),ie(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Re(T){var V;return T&&T.state?(T.total_in=T.total_out=0,T.data_type=y,(V=T.state).pending=0,V.pending_out=0,V.wrap<0&&(V.wrap=-V.wrap),V.status=V.wrap?_:z,T.adler=V.wrap===2?0:1,V.last_flush=m,a._tr_init(V),g):te(T,E)}function st(T){var V=Re(T);return V===g&&function($){$.window_size=2*$.w_size,ie($.head),$.max_lazy_match=i[$.level].max_lazy,$.good_match=i[$.level].good_length,$.nice_match=i[$.level].nice_length,$.max_chain_length=i[$.level].max_chain,$.strstart=0,$.block_start=0,$.lookahead=0,$.insert=0,$.match_length=$.prev_length=M-1,$.match_available=0,$.ins_h=0}(T.state),V}function qe(T,V,$,k,A,B){if(!T)return E;var ne=1;if(V===x&&(V=6),k<0?(ne=0,k=-k):15<k&&(ne=2,k-=16),A<1||S<A||$!==v||k<8||15<k||V<0||9<V||B<0||w<B)return te(T,E);k===8&&(k=9);var oe=new Ie;return(T.state=oe).strm=T,oe.wrap=ne,oe.gzhead=null,oe.w_bits=k,oe.w_size=1<<oe.w_bits,oe.w_mask=oe.w_size-1,oe.hash_bits=A+7,oe.hash_size=1<<oe.hash_bits,oe.hash_mask=oe.hash_size-1,oe.hash_shift=~~((oe.hash_bits+M-1)/M),oe.window=new s.Buf8(2*oe.w_size),oe.head=new s.Buf16(oe.hash_size),oe.prev=new s.Buf16(oe.w_size),oe.lit_bufsize=1<<A+6,oe.pending_buf_size=4*oe.lit_bufsize,oe.pending_buf=new s.Buf8(oe.pending_buf_size),oe.d_buf=1*oe.lit_bufsize,oe.l_buf=3*oe.lit_bufsize,oe.level=V,oe.strategy=B,oe.method=$,st(T)}i=[new Ne(0,0,0,0,function(T,V){var $=65535;for($>T.pending_buf_size-5&&($=T.pending_buf_size-5);;){if(T.lookahead<=1){if(_e(T),T.lookahead===0&&V===m)return C;if(T.lookahead===0)break}T.strstart+=T.lookahead,T.lookahead=0;var k=T.block_start+$;if((T.strstart===0||T.strstart>=k)&&(T.lookahead=T.strstart-k,T.strstart=k,R(T,!1),T.strm.avail_out===0)||T.strstart-T.block_start>=T.w_size-Q&&(R(T,!1),T.strm.avail_out===0))return C}return T.insert=0,V===p?(R(T,!0),T.strm.avail_out===0?he:J):(T.strstart>T.block_start&&(R(T,!1),T.strm.avail_out),C)}),new Ne(4,4,8,4,ze),new Ne(4,5,16,8,ze),new Ne(4,6,32,32,ze),new Ne(4,4,16,16,Ee),new Ne(8,16,32,32,Ee),new Ne(8,16,128,128,Ee),new Ne(8,32,128,256,Ee),new Ne(32,128,258,1024,Ee),new Ne(32,258,258,4096,Ee)],o.deflateInit=function(T,V){return qe(T,V,v,15,8,0)},o.deflateInit2=qe,o.deflateReset=st,o.deflateResetKeep=Re,o.deflateSetHeader=function(T,V){return T&&T.state?T.state.wrap!==2?E:(T.state.gzhead=V,g):E},o.deflate=function(T,V){var $,k,A,B;if(!T||!T.state||5<V||V<0)return T?te(T,E):E;if(k=T.state,!T.output||!T.input&&T.avail_in!==0||k.status===666&&V!==p)return te(T,T.avail_out===0?-5:E);if(k.strm=T,$=k.last_flush,k.last_flush=V,k.status===_)if(k.wrap===2)T.adler=0,de(k,31),de(k,139),de(k,8),k.gzhead?(de(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),de(k,255&k.gzhead.time),de(k,k.gzhead.time>>8&255),de(k,k.gzhead.time>>16&255),de(k,k.gzhead.time>>24&255),de(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),de(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(de(k,255&k.gzhead.extra.length),de(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(T.adler=d(T.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(de(k,0),de(k,0),de(k,0),de(k,0),de(k,0),de(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),de(k,3),k.status=z);else{var ne=v+(k.w_bits-8<<4)<<8;ne|=(2<=k.strategy||k.level<2?0:k.level<6?1:k.level===6?2:3)<<6,k.strstart!==0&&(ne|=32),ne+=31-ne%31,k.status=z,ge(k,ne),k.strstart!==0&&(ge(k,T.adler>>>16),ge(k,65535&T.adler)),T.adler=1}if(k.status===69)if(k.gzhead.extra){for(A=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>A&&(T.adler=d(T.adler,k.pending_buf,k.pending-A,A)),F(T),A=k.pending,k.pending!==k.pending_buf_size));)de(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>A&&(T.adler=d(T.adler,k.pending_buf,k.pending-A,A)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(k.status===73)if(k.gzhead.name){A=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>A&&(T.adler=d(T.adler,k.pending_buf,k.pending-A,A)),F(T),A=k.pending,k.pending===k.pending_buf_size)){B=1;break}B=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,de(k,B)}while(B!==0);k.gzhead.hcrc&&k.pending>A&&(T.adler=d(T.adler,k.pending_buf,k.pending-A,A)),B===0&&(k.gzindex=0,k.status=91)}else k.status=91;if(k.status===91)if(k.gzhead.comment){A=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>A&&(T.adler=d(T.adler,k.pending_buf,k.pending-A,A)),F(T),A=k.pending,k.pending===k.pending_buf_size)){B=1;break}B=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,de(k,B)}while(B!==0);k.gzhead.hcrc&&k.pending>A&&(T.adler=d(T.adler,k.pending_buf,k.pending-A,A)),B===0&&(k.status=103)}else k.status=103;if(k.status===103&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&F(T),k.pending+2<=k.pending_buf_size&&(de(k,255&T.adler),de(k,T.adler>>8&255),T.adler=0,k.status=z)):k.status=z),k.pending!==0){if(F(T),T.avail_out===0)return k.last_flush=-1,g}else if(T.avail_in===0&&H(V)<=H($)&&V!==p)return te(T,-5);if(k.status===666&&T.avail_in!==0)return te(T,-5);if(T.avail_in!==0||k.lookahead!==0||V!==m&&k.status!==666){var oe=k.strategy===2?function(W,ue){for(var ve;;){if(W.lookahead===0&&(_e(W),W.lookahead===0)){if(ue===m)return C;break}if(W.match_length=0,ve=a._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++,ve&&(R(W,!1),W.strm.avail_out===0))return C}return W.insert=0,ue===p?(R(W,!0),W.strm.avail_out===0?he:J):W.last_lit&&(R(W,!1),W.strm.avail_out===0)?C:Y}(k,V):k.strategy===3?function(W,ue){for(var ve,fe,Se,Ue,Me=W.window;;){if(W.lookahead<=j){if(_e(W),W.lookahead<=j&&ue===m)return C;if(W.lookahead===0)break}if(W.match_length=0,W.lookahead>=M&&0<W.strstart&&(fe=Me[Se=W.strstart-1])===Me[++Se]&&fe===Me[++Se]&&fe===Me[++Se]){Ue=W.strstart+j;do;while(fe===Me[++Se]&&fe===Me[++Se]&&fe===Me[++Se]&&fe===Me[++Se]&&fe===Me[++Se]&&fe===Me[++Se]&&fe===Me[++Se]&&fe===Me[++Se]&&Se<Ue);W.match_length=j-(Ue-Se),W.match_length>W.lookahead&&(W.match_length=W.lookahead)}if(W.match_length>=M?(ve=a._tr_tally(W,1,W.match_length-M),W.lookahead-=W.match_length,W.strstart+=W.match_length,W.match_length=0):(ve=a._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++),ve&&(R(W,!1),W.strm.avail_out===0))return C}return W.insert=0,ue===p?(R(W,!0),W.strm.avail_out===0?he:J):W.last_lit&&(R(W,!1),W.strm.avail_out===0)?C:Y}(k,V):i[k.level].func(k,V);if(oe!==he&&oe!==J||(k.status=666),oe===C||oe===he)return T.avail_out===0&&(k.last_flush=-1),g;if(oe===Y&&(V===1?a._tr_align(k):V!==5&&(a._tr_stored_block(k,0,0,!1),V===3&&(ie(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0))),F(T),T.avail_out===0))return k.last_flush=-1,g}return V!==p?g:k.wrap<=0?1:(k.wrap===2?(de(k,255&T.adler),de(k,T.adler>>8&255),de(k,T.adler>>16&255),de(k,T.adler>>24&255),de(k,255&T.total_in),de(k,T.total_in>>8&255),de(k,T.total_in>>16&255),de(k,T.total_in>>24&255)):(ge(k,T.adler>>>16),ge(k,65535&T.adler)),F(T),0<k.wrap&&(k.wrap=-k.wrap),k.pending!==0?g:1)},o.deflateEnd=function(T){var V;return T&&T.state?(V=T.state.status)!==_&&V!==69&&V!==73&&V!==91&&V!==103&&V!==z&&V!==666?te(T,E):(T.state=null,V===z?te(T,-3):g):E},o.deflateSetDictionary=function(T,V){var $,k,A,B,ne,oe,W,ue,ve=V.length;if(!T||!T.state||(B=($=T.state).wrap)===2||B===1&&$.status!==_||$.lookahead)return E;for(B===1&&(T.adler=u(T.adler,V,ve,0)),$.wrap=0,ve>=$.w_size&&(B===0&&(ie($.head),$.strstart=0,$.block_start=0,$.insert=0),ue=new s.Buf8($.w_size),s.arraySet(ue,V,ve-$.w_size,$.w_size,0),V=ue,ve=$.w_size),ne=T.avail_in,oe=T.next_in,W=T.input,T.avail_in=ve,T.next_in=0,T.input=V,_e($);$.lookahead>=M;){for(k=$.strstart,A=$.lookahead-(M-1);$.ins_h=($.ins_h<<$.hash_shift^$.window[k+M-1])&$.hash_mask,$.prev[k&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=k,k++,--A;);$.strstart=k,$.lookahead=M-1,_e($)}return $.strstart+=$.lookahead,$.block_start=$.strstart,$.insert=$.lookahead,$.lookahead=0,$.match_length=$.prev_length=M-1,$.match_available=0,T.next_in=oe,T.input=W,T.avail_in=ne,$.wrap=B,g},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,o){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,o){r.exports=function(i,s){var a,u,d,h,m,p,g,E,x,w,y,v,S,N,I,L,P,D,M,j,Q,_,z,C,Y;a=i.state,u=i.next_in,C=i.input,d=u+(i.avail_in-5),h=i.next_out,Y=i.output,m=h-(s-i.avail_out),p=h+(i.avail_out-257),g=a.dmax,E=a.wsize,x=a.whave,w=a.wnext,y=a.window,v=a.hold,S=a.bits,N=a.lencode,I=a.distcode,L=(1<<a.lenbits)-1,P=(1<<a.distbits)-1;e:do{S<15&&(v+=C[u++]<<S,S+=8,v+=C[u++]<<S,S+=8),D=N[v&L];t:for(;;){if(v>>>=M=D>>>24,S-=M,(M=D>>>16&255)===0)Y[h++]=65535&D;else{if(!(16&M)){if(!(64&M)){D=N[(65535&D)+(v&(1<<M)-1)];continue t}if(32&M){a.mode=12;break e}i.msg="invalid literal/length code",a.mode=30;break e}j=65535&D,(M&=15)&&(S<M&&(v+=C[u++]<<S,S+=8),j+=v&(1<<M)-1,v>>>=M,S-=M),S<15&&(v+=C[u++]<<S,S+=8,v+=C[u++]<<S,S+=8),D=I[v&P];n:for(;;){if(v>>>=M=D>>>24,S-=M,!(16&(M=D>>>16&255))){if(!(64&M)){D=I[(65535&D)+(v&(1<<M)-1)];continue n}i.msg="invalid distance code",a.mode=30;break e}if(Q=65535&D,S<(M&=15)&&(v+=C[u++]<<S,(S+=8)<M&&(v+=C[u++]<<S,S+=8)),g<(Q+=v&(1<<M)-1)){i.msg="invalid distance too far back",a.mode=30;break e}if(v>>>=M,S-=M,(M=h-m)<Q){if(x<(M=Q-M)&&a.sane){i.msg="invalid distance too far back",a.mode=30;break e}if(z=y,(_=0)===w){if(_+=E-M,M<j){for(j-=M;Y[h++]=y[_++],--M;);_=h-Q,z=Y}}else if(w<M){if(_+=E+w-M,(M-=w)<j){for(j-=M;Y[h++]=y[_++],--M;);if(_=0,w<j){for(j-=M=w;Y[h++]=y[_++],--M;);_=h-Q,z=Y}}}else if(_+=w-M,M<j){for(j-=M;Y[h++]=y[_++],--M;);_=h-Q,z=Y}for(;2<j;)Y[h++]=z[_++],Y[h++]=z[_++],Y[h++]=z[_++],j-=3;j&&(Y[h++]=z[_++],1<j&&(Y[h++]=z[_++]))}else{for(_=h-Q;Y[h++]=Y[_++],Y[h++]=Y[_++],Y[h++]=Y[_++],2<(j-=3););j&&(Y[h++]=Y[_++],1<j&&(Y[h++]=Y[_++]))}break}}break}}while(u<d&&h<p);u-=j=S>>3,v&=(1<<(S-=j<<3))-1,i.next_in=u,i.next_out=h,i.avail_in=u<d?d-u+5:5-(u-d),i.avail_out=h<p?p-h+257:257-(h-p),a.hold=v,a.bits=S}},{}],49:[function(n,r,o){var i=n("../utils/common"),s=n("./adler32"),a=n("./crc32"),u=n("./inffast"),d=n("./inftrees"),h=1,m=2,p=0,g=-2,E=1,x=852,w=592;function y(_){return(_>>>24&255)+(_>>>8&65280)+((65280&_)<<8)+((255&_)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(_){var z;return _&&_.state?(z=_.state,_.total_in=_.total_out=z.total=0,_.msg="",z.wrap&&(_.adler=1&z.wrap),z.mode=E,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new i.Buf32(x),z.distcode=z.distdyn=new i.Buf32(w),z.sane=1,z.back=-1,p):g}function N(_){var z;return _&&_.state?((z=_.state).wsize=0,z.whave=0,z.wnext=0,S(_)):g}function I(_,z){var C,Y;return _&&_.state?(Y=_.state,z<0?(C=0,z=-z):(C=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?g:(Y.window!==null&&Y.wbits!==z&&(Y.window=null),Y.wrap=C,Y.wbits=z,N(_))):g}function L(_,z){var C,Y;return _?(Y=new v,(_.state=Y).window=null,(C=I(_,z))!==p&&(_.state=null),C):g}var P,D,M=!0;function j(_){if(M){var z;for(P=new i.Buf32(512),D=new i.Buf32(32),z=0;z<144;)_.lens[z++]=8;for(;z<256;)_.lens[z++]=9;for(;z<280;)_.lens[z++]=7;for(;z<288;)_.lens[z++]=8;for(d(h,_.lens,0,288,P,0,_.work,{bits:9}),z=0;z<32;)_.lens[z++]=5;d(m,_.lens,0,32,D,0,_.work,{bits:5}),M=!1}_.lencode=P,_.lenbits=9,_.distcode=D,_.distbits=5}function Q(_,z,C,Y){var he,J=_.state;return J.window===null&&(J.wsize=1<<J.wbits,J.wnext=0,J.whave=0,J.window=new i.Buf8(J.wsize)),Y>=J.wsize?(i.arraySet(J.window,z,C-J.wsize,J.wsize,0),J.wnext=0,J.whave=J.wsize):(Y<(he=J.wsize-J.wnext)&&(he=Y),i.arraySet(J.window,z,C-Y,he,J.wnext),(Y-=he)?(i.arraySet(J.window,z,C-Y,Y,0),J.wnext=Y,J.whave=J.wsize):(J.wnext+=he,J.wnext===J.wsize&&(J.wnext=0),J.whave<J.wsize&&(J.whave+=he))),0}o.inflateReset=N,o.inflateReset2=I,o.inflateResetKeep=S,o.inflateInit=function(_){return L(_,15)},o.inflateInit2=L,o.inflate=function(_,z){var C,Y,he,J,te,H,ie,F,R,de,ge,ae,_e,ze,Ee,Ne,Ie,Re,st,qe,T,V,$,k,A=0,B=new i.Buf8(4),ne=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!_||!_.state||!_.output||!_.input&&_.avail_in!==0)return g;(C=_.state).mode===12&&(C.mode=13),te=_.next_out,he=_.output,ie=_.avail_out,J=_.next_in,Y=_.input,H=_.avail_in,F=C.hold,R=C.bits,de=H,ge=ie,V=p;e:for(;;)switch(C.mode){case E:if(C.wrap===0){C.mode=13;break}for(;R<16;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}if(2&C.wrap&&F===35615){B[C.check=0]=255&F,B[1]=F>>>8&255,C.check=a(C.check,B,2,0),R=F=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&F)<<8)+(F>>8))%31){_.msg="incorrect header check",C.mode=30;break}if((15&F)!=8){_.msg="unknown compression method",C.mode=30;break}if(R-=4,T=8+(15&(F>>>=4)),C.wbits===0)C.wbits=T;else if(T>C.wbits){_.msg="invalid window size",C.mode=30;break}C.dmax=1<<T,_.adler=C.check=1,C.mode=512&F?10:12,R=F=0;break;case 2:for(;R<16;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}if(C.flags=F,(255&C.flags)!=8){_.msg="unknown compression method",C.mode=30;break}if(57344&C.flags){_.msg="unknown header flags set",C.mode=30;break}C.head&&(C.head.text=F>>8&1),512&C.flags&&(B[0]=255&F,B[1]=F>>>8&255,C.check=a(C.check,B,2,0)),R=F=0,C.mode=3;case 3:for(;R<32;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}C.head&&(C.head.time=F),512&C.flags&&(B[0]=255&F,B[1]=F>>>8&255,B[2]=F>>>16&255,B[3]=F>>>24&255,C.check=a(C.check,B,4,0)),R=F=0,C.mode=4;case 4:for(;R<16;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}C.head&&(C.head.xflags=255&F,C.head.os=F>>8),512&C.flags&&(B[0]=255&F,B[1]=F>>>8&255,C.check=a(C.check,B,2,0)),R=F=0,C.mode=5;case 5:if(1024&C.flags){for(;R<16;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}C.length=F,C.head&&(C.head.extra_len=F),512&C.flags&&(B[0]=255&F,B[1]=F>>>8&255,C.check=a(C.check,B,2,0)),R=F=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(H<(ae=C.length)&&(ae=H),ae&&(C.head&&(T=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Array(C.head.extra_len)),i.arraySet(C.head.extra,Y,J,ae,T)),512&C.flags&&(C.check=a(C.check,Y,ae,J)),H-=ae,J+=ae,C.length-=ae),C.length))break e;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(H===0)break e;for(ae=0;T=Y[J+ae++],C.head&&T&&C.length<65536&&(C.head.name+=String.fromCharCode(T)),T&&ae<H;);if(512&C.flags&&(C.check=a(C.check,Y,ae,J)),H-=ae,J+=ae,T)break e}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(H===0)break e;for(ae=0;T=Y[J+ae++],C.head&&T&&C.length<65536&&(C.head.comment+=String.fromCharCode(T)),T&&ae<H;);if(512&C.flags&&(C.check=a(C.check,Y,ae,J)),H-=ae,J+=ae,T)break e}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;R<16;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}if(F!==(65535&C.check)){_.msg="header crc mismatch",C.mode=30;break}R=F=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),_.adler=C.check=0,C.mode=12;break;case 10:for(;R<32;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}_.adler=C.check=y(F),R=F=0,C.mode=11;case 11:if(C.havedict===0)return _.next_out=te,_.avail_out=ie,_.next_in=J,_.avail_in=H,C.hold=F,C.bits=R,2;_.adler=C.check=1,C.mode=12;case 12:if(z===5||z===6)break e;case 13:if(C.last){F>>>=7&R,R-=7&R,C.mode=27;break}for(;R<3;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}switch(C.last=1&F,R-=1,3&(F>>>=1)){case 0:C.mode=14;break;case 1:if(j(C),C.mode=20,z!==6)break;F>>>=2,R-=2;break e;case 2:C.mode=17;break;case 3:_.msg="invalid block type",C.mode=30}F>>>=2,R-=2;break;case 14:for(F>>>=7&R,R-=7&R;R<32;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}if((65535&F)!=(F>>>16^65535)){_.msg="invalid stored block lengths",C.mode=30;break}if(C.length=65535&F,R=F=0,C.mode=15,z===6)break e;case 15:C.mode=16;case 16:if(ae=C.length){if(H<ae&&(ae=H),ie<ae&&(ae=ie),ae===0)break e;i.arraySet(he,Y,J,ae,te),H-=ae,J+=ae,ie-=ae,te+=ae,C.length-=ae;break}C.mode=12;break;case 17:for(;R<14;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}if(C.nlen=257+(31&F),F>>>=5,R-=5,C.ndist=1+(31&F),F>>>=5,R-=5,C.ncode=4+(15&F),F>>>=4,R-=4,286<C.nlen||30<C.ndist){_.msg="too many length or distance symbols",C.mode=30;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;R<3;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}C.lens[ne[C.have++]]=7&F,F>>>=3,R-=3}for(;C.have<19;)C.lens[ne[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,$={bits:C.lenbits},V=d(0,C.lens,0,19,C.lencode,0,C.work,$),C.lenbits=$.bits,V){_.msg="invalid code lengths set",C.mode=30;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;Ne=(A=C.lencode[F&(1<<C.lenbits)-1])>>>16&255,Ie=65535&A,!((Ee=A>>>24)<=R);){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}if(Ie<16)F>>>=Ee,R-=Ee,C.lens[C.have++]=Ie;else{if(Ie===16){for(k=Ee+2;R<k;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}if(F>>>=Ee,R-=Ee,C.have===0){_.msg="invalid bit length repeat",C.mode=30;break}T=C.lens[C.have-1],ae=3+(3&F),F>>>=2,R-=2}else if(Ie===17){for(k=Ee+3;R<k;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}R-=Ee,T=0,ae=3+(7&(F>>>=Ee)),F>>>=3,R-=3}else{for(k=Ee+7;R<k;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}R-=Ee,T=0,ae=11+(127&(F>>>=Ee)),F>>>=7,R-=7}if(C.have+ae>C.nlen+C.ndist){_.msg="invalid bit length repeat",C.mode=30;break}for(;ae--;)C.lens[C.have++]=T}}if(C.mode===30)break;if(C.lens[256]===0){_.msg="invalid code -- missing end-of-block",C.mode=30;break}if(C.lenbits=9,$={bits:C.lenbits},V=d(h,C.lens,0,C.nlen,C.lencode,0,C.work,$),C.lenbits=$.bits,V){_.msg="invalid literal/lengths set",C.mode=30;break}if(C.distbits=6,C.distcode=C.distdyn,$={bits:C.distbits},V=d(m,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,$),C.distbits=$.bits,V){_.msg="invalid distances set",C.mode=30;break}if(C.mode=20,z===6)break e;case 20:C.mode=21;case 21:if(6<=H&&258<=ie){_.next_out=te,_.avail_out=ie,_.next_in=J,_.avail_in=H,C.hold=F,C.bits=R,u(_,ge),te=_.next_out,he=_.output,ie=_.avail_out,J=_.next_in,Y=_.input,H=_.avail_in,F=C.hold,R=C.bits,C.mode===12&&(C.back=-1);break}for(C.back=0;Ne=(A=C.lencode[F&(1<<C.lenbits)-1])>>>16&255,Ie=65535&A,!((Ee=A>>>24)<=R);){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}if(Ne&&!(240&Ne)){for(Re=Ee,st=Ne,qe=Ie;Ne=(A=C.lencode[qe+((F&(1<<Re+st)-1)>>Re)])>>>16&255,Ie=65535&A,!(Re+(Ee=A>>>24)<=R);){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}F>>>=Re,R-=Re,C.back+=Re}if(F>>>=Ee,R-=Ee,C.back+=Ee,C.length=Ie,Ne===0){C.mode=26;break}if(32&Ne){C.back=-1,C.mode=12;break}if(64&Ne){_.msg="invalid literal/length code",C.mode=30;break}C.extra=15&Ne,C.mode=22;case 22:if(C.extra){for(k=C.extra;R<k;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}C.length+=F&(1<<C.extra)-1,F>>>=C.extra,R-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;Ne=(A=C.distcode[F&(1<<C.distbits)-1])>>>16&255,Ie=65535&A,!((Ee=A>>>24)<=R);){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}if(!(240&Ne)){for(Re=Ee,st=Ne,qe=Ie;Ne=(A=C.distcode[qe+((F&(1<<Re+st)-1)>>Re)])>>>16&255,Ie=65535&A,!(Re+(Ee=A>>>24)<=R);){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}F>>>=Re,R-=Re,C.back+=Re}if(F>>>=Ee,R-=Ee,C.back+=Ee,64&Ne){_.msg="invalid distance code",C.mode=30;break}C.offset=Ie,C.extra=15&Ne,C.mode=24;case 24:if(C.extra){for(k=C.extra;R<k;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}C.offset+=F&(1<<C.extra)-1,F>>>=C.extra,R-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){_.msg="invalid distance too far back",C.mode=30;break}C.mode=25;case 25:if(ie===0)break e;if(ae=ge-ie,C.offset>ae){if((ae=C.offset-ae)>C.whave&&C.sane){_.msg="invalid distance too far back",C.mode=30;break}_e=ae>C.wnext?(ae-=C.wnext,C.wsize-ae):C.wnext-ae,ae>C.length&&(ae=C.length),ze=C.window}else ze=he,_e=te-C.offset,ae=C.length;for(ie<ae&&(ae=ie),ie-=ae,C.length-=ae;he[te++]=ze[_e++],--ae;);C.length===0&&(C.mode=21);break;case 26:if(ie===0)break e;he[te++]=C.length,ie--,C.mode=21;break;case 27:if(C.wrap){for(;R<32;){if(H===0)break e;H--,F|=Y[J++]<<R,R+=8}if(ge-=ie,_.total_out+=ge,C.total+=ge,ge&&(_.adler=C.check=C.flags?a(C.check,he,ge,te-ge):s(C.check,he,ge,te-ge)),ge=ie,(C.flags?F:y(F))!==C.check){_.msg="incorrect data check",C.mode=30;break}R=F=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;R<32;){if(H===0)break e;H--,F+=Y[J++]<<R,R+=8}if(F!==(4294967295&C.total)){_.msg="incorrect length check",C.mode=30;break}R=F=0}C.mode=29;case 29:V=1;break e;case 30:V=-3;break e;case 31:return-4;case 32:default:return g}return _.next_out=te,_.avail_out=ie,_.next_in=J,_.avail_in=H,C.hold=F,C.bits=R,(C.wsize||ge!==_.avail_out&&C.mode<30&&(C.mode<27||z!==4))&&Q(_,_.output,_.next_out,ge-_.avail_out)?(C.mode=31,-4):(de-=_.avail_in,ge-=_.avail_out,_.total_in+=de,_.total_out+=ge,C.total+=ge,C.wrap&&ge&&(_.adler=C.check=C.flags?a(C.check,he,ge,_.next_out-ge):s(C.check,he,ge,_.next_out-ge)),_.data_type=C.bits+(C.last?64:0)+(C.mode===12?128:0)+(C.mode===20||C.mode===15?256:0),(de==0&&ge===0||z===4)&&V===p&&(V=-5),V)},o.inflateEnd=function(_){if(!_||!_.state)return g;var z=_.state;return z.window&&(z.window=null),_.state=null,p},o.inflateGetHeader=function(_,z){var C;return _&&_.state&&2&(C=_.state).wrap?((C.head=z).done=!1,p):g},o.inflateSetDictionary=function(_,z){var C,Y=z.length;return _&&_.state?(C=_.state).wrap!==0&&C.mode!==11?g:C.mode===11&&s(1,z,Y,0)!==C.check?-3:Q(_,z,Y,Y)?(C.mode=31,-4):(C.havedict=1,p):g},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,o){var i=n("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(h,m,p,g,E,x,w,y){var v,S,N,I,L,P,D,M,j,Q=y.bits,_=0,z=0,C=0,Y=0,he=0,J=0,te=0,H=0,ie=0,F=0,R=null,de=0,ge=new i.Buf16(16),ae=new i.Buf16(16),_e=null,ze=0;for(_=0;_<=15;_++)ge[_]=0;for(z=0;z<g;z++)ge[m[p+z]]++;for(he=Q,Y=15;1<=Y&&ge[Y]===0;Y--);if(Y<he&&(he=Y),Y===0)return E[x++]=20971520,E[x++]=20971520,y.bits=1,0;for(C=1;C<Y&&ge[C]===0;C++);for(he<C&&(he=C),_=H=1;_<=15;_++)if(H<<=1,(H-=ge[_])<0)return-1;if(0<H&&(h===0||Y!==1))return-1;for(ae[1]=0,_=1;_<15;_++)ae[_+1]=ae[_]+ge[_];for(z=0;z<g;z++)m[p+z]!==0&&(w[ae[m[p+z]]++]=z);if(P=h===0?(R=_e=w,19):h===1?(R=s,de-=257,_e=a,ze-=257,256):(R=u,_e=d,-1),_=C,L=x,te=z=F=0,N=-1,I=(ie=1<<(J=he))-1,h===1&&852<ie||h===2&&592<ie)return 1;for(;;){for(D=_-te,j=w[z]<P?(M=0,w[z]):w[z]>P?(M=_e[ze+w[z]],R[de+w[z]]):(M=96,0),v=1<<_-te,C=S=1<<J;E[L+(F>>te)+(S-=v)]=D<<24|M<<16|j|0,S!==0;);for(v=1<<_-1;F&v;)v>>=1;if(v!==0?(F&=v-1,F+=v):F=0,z++,--ge[_]==0){if(_===Y)break;_=m[p+w[z]]}if(he<_&&(F&I)!==N){for(te===0&&(te=he),L+=C,H=1<<(J=_-te);J+te<Y&&!((H-=ge[J+te])<=0);)J++,H<<=1;if(ie+=1<<J,h===1&&852<ie||h===2&&592<ie)return 1;E[N=F&I]=he<<24|J<<16|L-x|0}}return F!==0&&(E[L+F]=_-te<<24|64<<16|0),y.bits=he,0}},{"../utils/common":41}],51:[function(n,r,o){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,o){var i=n("../utils/common"),s=0,a=1;function u(A){for(var B=A.length;0<=--B;)A[B]=0}var d=0,h=29,m=256,p=m+1+h,g=30,E=19,x=2*p+1,w=15,y=16,v=7,S=256,N=16,I=17,L=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(p+2));u(Q);var _=new Array(2*g);u(_);var z=new Array(512);u(z);var C=new Array(256);u(C);var Y=new Array(h);u(Y);var he,J,te,H=new Array(g);function ie(A,B,ne,oe,W){this.static_tree=A,this.extra_bits=B,this.extra_base=ne,this.elems=oe,this.max_length=W,this.has_stree=A&&A.length}function F(A,B){this.dyn_tree=A,this.max_code=0,this.stat_desc=B}function R(A){return A<256?z[A]:z[256+(A>>>7)]}function de(A,B){A.pending_buf[A.pending++]=255&B,A.pending_buf[A.pending++]=B>>>8&255}function ge(A,B,ne){A.bi_valid>y-ne?(A.bi_buf|=B<<A.bi_valid&65535,de(A,A.bi_buf),A.bi_buf=B>>y-A.bi_valid,A.bi_valid+=ne-y):(A.bi_buf|=B<<A.bi_valid&65535,A.bi_valid+=ne)}function ae(A,B,ne){ge(A,ne[2*B],ne[2*B+1])}function _e(A,B){for(var ne=0;ne|=1&A,A>>>=1,ne<<=1,0<--B;);return ne>>>1}function ze(A,B,ne){var oe,W,ue=new Array(w+1),ve=0;for(oe=1;oe<=w;oe++)ue[oe]=ve=ve+ne[oe-1]<<1;for(W=0;W<=B;W++){var fe=A[2*W+1];fe!==0&&(A[2*W]=_e(ue[fe]++,fe))}}function Ee(A){var B;for(B=0;B<p;B++)A.dyn_ltree[2*B]=0;for(B=0;B<g;B++)A.dyn_dtree[2*B]=0;for(B=0;B<E;B++)A.bl_tree[2*B]=0;A.dyn_ltree[2*S]=1,A.opt_len=A.static_len=0,A.last_lit=A.matches=0}function Ne(A){8<A.bi_valid?de(A,A.bi_buf):0<A.bi_valid&&(A.pending_buf[A.pending++]=A.bi_buf),A.bi_buf=0,A.bi_valid=0}function Ie(A,B,ne,oe){var W=2*B,ue=2*ne;return A[W]<A[ue]||A[W]===A[ue]&&oe[B]<=oe[ne]}function Re(A,B,ne){for(var oe=A.heap[ne],W=ne<<1;W<=A.heap_len&&(W<A.heap_len&&Ie(B,A.heap[W+1],A.heap[W],A.depth)&&W++,!Ie(B,oe,A.heap[W],A.depth));)A.heap[ne]=A.heap[W],ne=W,W<<=1;A.heap[ne]=oe}function st(A,B,ne){var oe,W,ue,ve,fe=0;if(A.last_lit!==0)for(;oe=A.pending_buf[A.d_buf+2*fe]<<8|A.pending_buf[A.d_buf+2*fe+1],W=A.pending_buf[A.l_buf+fe],fe++,oe===0?ae(A,W,B):(ae(A,(ue=C[W])+m+1,B),(ve=P[ue])!==0&&ge(A,W-=Y[ue],ve),ae(A,ue=R(--oe),ne),(ve=D[ue])!==0&&ge(A,oe-=H[ue],ve)),fe<A.last_lit;);ae(A,S,B)}function qe(A,B){var ne,oe,W,ue=B.dyn_tree,ve=B.stat_desc.static_tree,fe=B.stat_desc.has_stree,Se=B.stat_desc.elems,Ue=-1;for(A.heap_len=0,A.heap_max=x,ne=0;ne<Se;ne++)ue[2*ne]!==0?(A.heap[++A.heap_len]=Ue=ne,A.depth[ne]=0):ue[2*ne+1]=0;for(;A.heap_len<2;)ue[2*(W=A.heap[++A.heap_len]=Ue<2?++Ue:0)]=1,A.depth[W]=0,A.opt_len--,fe&&(A.static_len-=ve[2*W+1]);for(B.max_code=Ue,ne=A.heap_len>>1;1<=ne;ne--)Re(A,ue,ne);for(W=Se;ne=A.heap[1],A.heap[1]=A.heap[A.heap_len--],Re(A,ue,1),oe=A.heap[1],A.heap[--A.heap_max]=ne,A.heap[--A.heap_max]=oe,ue[2*W]=ue[2*ne]+ue[2*oe],A.depth[W]=(A.depth[ne]>=A.depth[oe]?A.depth[ne]:A.depth[oe])+1,ue[2*ne+1]=ue[2*oe+1]=W,A.heap[1]=W++,Re(A,ue,1),2<=A.heap_len;);A.heap[--A.heap_max]=A.heap[1],function(Me,Xe){var Kt,yt,Jt,Ke,Xt,U,ce=Xe.dyn_tree,ee=Xe.max_code,G=Xe.stat_desc.static_tree,O=Xe.stat_desc.has_stree,X=Xe.stat_desc.extra_bits,ye=Xe.stat_desc.extra_base,be=Xe.stat_desc.max_length,Ce=0;for(Ke=0;Ke<=w;Ke++)Me.bl_count[Ke]=0;for(ce[2*Me.heap[Me.heap_max]+1]=0,Kt=Me.heap_max+1;Kt<x;Kt++)be<(Ke=ce[2*ce[2*(yt=Me.heap[Kt])+1]+1]+1)&&(Ke=be,Ce++),ce[2*yt+1]=Ke,ee<yt||(Me.bl_count[Ke]++,Xt=0,ye<=yt&&(Xt=X[yt-ye]),U=ce[2*yt],Me.opt_len+=U*(Ke+Xt),O&&(Me.static_len+=U*(G[2*yt+1]+Xt)));if(Ce!==0){do{for(Ke=be-1;Me.bl_count[Ke]===0;)Ke--;Me.bl_count[Ke]--,Me.bl_count[Ke+1]+=2,Me.bl_count[be]--,Ce-=2}while(0<Ce);for(Ke=be;Ke!==0;Ke--)for(yt=Me.bl_count[Ke];yt!==0;)ee<(Jt=Me.heap[--Kt])||(ce[2*Jt+1]!==Ke&&(Me.opt_len+=(Ke-ce[2*Jt+1])*ce[2*Jt],ce[2*Jt+1]=Ke),yt--)}}(A,B),ze(ue,Ue,A.bl_count)}function T(A,B,ne){var oe,W,ue=-1,ve=B[1],fe=0,Se=7,Ue=4;for(ve===0&&(Se=138,Ue=3),B[2*(ne+1)+1]=65535,oe=0;oe<=ne;oe++)W=ve,ve=B[2*(oe+1)+1],++fe<Se&&W===ve||(fe<Ue?A.bl_tree[2*W]+=fe:W!==0?(W!==ue&&A.bl_tree[2*W]++,A.bl_tree[2*N]++):fe<=10?A.bl_tree[2*I]++:A.bl_tree[2*L]++,ue=W,Ue=(fe=0)===ve?(Se=138,3):W===ve?(Se=6,3):(Se=7,4))}function V(A,B,ne){var oe,W,ue=-1,ve=B[1],fe=0,Se=7,Ue=4;for(ve===0&&(Se=138,Ue=3),oe=0;oe<=ne;oe++)if(W=ve,ve=B[2*(oe+1)+1],!(++fe<Se&&W===ve)){if(fe<Ue)for(;ae(A,W,A.bl_tree),--fe!=0;);else W!==0?(W!==ue&&(ae(A,W,A.bl_tree),fe--),ae(A,N,A.bl_tree),ge(A,fe-3,2)):fe<=10?(ae(A,I,A.bl_tree),ge(A,fe-3,3)):(ae(A,L,A.bl_tree),ge(A,fe-11,7));ue=W,Ue=(fe=0)===ve?(Se=138,3):W===ve?(Se=6,3):(Se=7,4)}}u(H);var $=!1;function k(A,B,ne,oe){ge(A,(d<<1)+(oe?1:0),3),function(W,ue,ve,fe){Ne(W),de(W,ve),de(W,~ve),i.arraySet(W.pending_buf,W.window,ue,ve,W.pending),W.pending+=ve}(A,B,ne)}o._tr_init=function(A){$||(function(){var B,ne,oe,W,ue,ve=new Array(w+1);for(W=oe=0;W<h-1;W++)for(Y[W]=oe,B=0;B<1<<P[W];B++)C[oe++]=W;for(C[oe-1]=W,W=ue=0;W<16;W++)for(H[W]=ue,B=0;B<1<<D[W];B++)z[ue++]=W;for(ue>>=7;W<g;W++)for(H[W]=ue<<7,B=0;B<1<<D[W]-7;B++)z[256+ue++]=W;for(ne=0;ne<=w;ne++)ve[ne]=0;for(B=0;B<=143;)Q[2*B+1]=8,B++,ve[8]++;for(;B<=255;)Q[2*B+1]=9,B++,ve[9]++;for(;B<=279;)Q[2*B+1]=7,B++,ve[7]++;for(;B<=287;)Q[2*B+1]=8,B++,ve[8]++;for(ze(Q,p+1,ve),B=0;B<g;B++)_[2*B+1]=5,_[2*B]=_e(B,5);he=new ie(Q,P,m+1,p,w),J=new ie(_,D,0,g,w),te=new ie(new Array(0),M,0,E,v)}(),$=!0),A.l_desc=new F(A.dyn_ltree,he),A.d_desc=new F(A.dyn_dtree,J),A.bl_desc=new F(A.bl_tree,te),A.bi_buf=0,A.bi_valid=0,Ee(A)},o._tr_stored_block=k,o._tr_flush_block=function(A,B,ne,oe){var W,ue,ve=0;0<A.level?(A.strm.data_type===2&&(A.strm.data_type=function(fe){var Se,Ue=4093624447;for(Se=0;Se<=31;Se++,Ue>>>=1)if(1&Ue&&fe.dyn_ltree[2*Se]!==0)return s;if(fe.dyn_ltree[18]!==0||fe.dyn_ltree[20]!==0||fe.dyn_ltree[26]!==0)return a;for(Se=32;Se<m;Se++)if(fe.dyn_ltree[2*Se]!==0)return a;return s}(A)),qe(A,A.l_desc),qe(A,A.d_desc),ve=function(fe){var Se;for(T(fe,fe.dyn_ltree,fe.l_desc.max_code),T(fe,fe.dyn_dtree,fe.d_desc.max_code),qe(fe,fe.bl_desc),Se=E-1;3<=Se&&fe.bl_tree[2*j[Se]+1]===0;Se--);return fe.opt_len+=3*(Se+1)+5+5+4,Se}(A),W=A.opt_len+3+7>>>3,(ue=A.static_len+3+7>>>3)<=W&&(W=ue)):W=ue=ne+5,ne+4<=W&&B!==-1?k(A,B,ne,oe):A.strategy===4||ue===W?(ge(A,2+(oe?1:0),3),st(A,Q,_)):(ge(A,4+(oe?1:0),3),function(fe,Se,Ue,Me){var Xe;for(ge(fe,Se-257,5),ge(fe,Ue-1,5),ge(fe,Me-4,4),Xe=0;Xe<Me;Xe++)ge(fe,fe.bl_tree[2*j[Xe]+1],3);V(fe,fe.dyn_ltree,Se-1),V(fe,fe.dyn_dtree,Ue-1)}(A,A.l_desc.max_code+1,A.d_desc.max_code+1,ve+1),st(A,A.dyn_ltree,A.dyn_dtree)),Ee(A),oe&&Ne(A)},o._tr_tally=function(A,B,ne){return A.pending_buf[A.d_buf+2*A.last_lit]=B>>>8&255,A.pending_buf[A.d_buf+2*A.last_lit+1]=255&B,A.pending_buf[A.l_buf+A.last_lit]=255&ne,A.last_lit++,B===0?A.dyn_ltree[2*ne]++:(A.matches++,B--,A.dyn_ltree[2*(C[ne]+m+1)]++,A.dyn_dtree[2*R(B)]++),A.last_lit===A.lit_bufsize-1},o._tr_align=function(A){ge(A,2,3),ae(A,S,Q),function(B){B.bi_valid===16?(de(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):8<=B.bi_valid&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)}(A)}},{"../utils/common":41}],53:[function(n,r,o){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,o){(function(i){(function(s,a){if(!s.setImmediate){var u,d,h,m,p=1,g={},E=!1,x=s.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(s);w=w&&w.setTimeout?w:s,u={}.toString.call(s.process)==="[object process]"?function(N){process.nextTick(function(){v(N)})}:function(){if(s.postMessage&&!s.importScripts){var N=!0,I=s.onmessage;return s.onmessage=function(){N=!1},s.postMessage("","*"),s.onmessage=I,N}}()?(m="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",S,!1):s.attachEvent("onmessage",S),function(N){s.postMessage(m+N,"*")}):s.MessageChannel?((h=new MessageChannel).port1.onmessage=function(N){v(N.data)},function(N){h.port2.postMessage(N)}):x&&"onreadystatechange"in x.createElement("script")?(d=x.documentElement,function(N){var I=x.createElement("script");I.onreadystatechange=function(){v(N),I.onreadystatechange=null,d.removeChild(I),I=null},d.appendChild(I)}):function(N){setTimeout(v,0,N)},w.setImmediate=function(N){typeof N!="function"&&(N=new Function(""+N));for(var I=new Array(arguments.length-1),L=0;L<I.length;L++)I[L]=arguments[L+1];var P={callback:N,args:I};return g[p]=P,u(p),p++},w.clearImmediate=y}function y(N){delete g[N]}function v(N){if(E)setTimeout(v,0,N);else{var I=g[N];if(I){E=!0;try{(function(L){var P=L.callback,D=L.args;switch(D.length){case 0:P();break;case 1:P(D[0]);break;case 2:P(D[0],D[1]);break;case 3:P(D[0],D[1],D[2]);break;default:P.apply(a,D)}})(I)}finally{y(N),E=!1}}}}function S(N){N.source===s&&typeof N.data=="string"&&N.data.indexOf(m)===0&&v(+N.data.slice(m.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Nn<"u"?Nn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Hm);var rN=Hm.exports;const kl=Rf(rN);var Bm={exports:{}};(function(t,e){(function(n,r){r()})(Nn,function(){function n(d,h){return typeof h>"u"?h={autoBom:!1}:typeof h!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),h={autoBom:!h}),h.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(d.type)?new Blob(["\uFEFF",d],{type:d.type}):d}function r(d,h,m){var p=new XMLHttpRequest;p.open("GET",d),p.responseType="blob",p.onload=function(){u(p.response,h,m)},p.onerror=function(){console.error("could not download file")},p.send()}function o(d){var h=new XMLHttpRequest;h.open("HEAD",d,!1);try{h.send()}catch{}return 200<=h.status&&299>=h.status}function i(d){try{d.dispatchEvent(new MouseEvent("click"))}catch{var h=document.createEvent("MouseEvents");h.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),d.dispatchEvent(h)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Nn=="object"&&Nn.global===Nn?Nn:void 0,a=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(d,h,m){var p=s.URL||s.webkitURL,g=document.createElement("a");h=h||d.name||"download",g.download=h,g.rel="noopener",typeof d=="string"?(g.href=d,g.origin===location.origin?i(g):o(g.href)?r(d,h,m):i(g,g.target="_blank")):(g.href=p.createObjectURL(d),setTimeout(function(){p.revokeObjectURL(g.href)},4e4),setTimeout(function(){i(g)},0))}:"msSaveOrOpenBlob"in navigator?function(d,h,m){if(h=h||d.name||"download",typeof d!="string")navigator.msSaveOrOpenBlob(n(d,m),h);else if(o(d))r(d,h,m);else{var p=document.createElement("a");p.href=d,p.target="_blank",setTimeout(function(){i(p)})}}:function(d,h,m,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof d=="string")return r(d,h,m);var g=d.type==="application/octet-stream",E=/constructor/i.test(s.HTMLElement)||s.safari,x=/CriOS\/[\d]+/.test(navigator.userAgent);if((x||g&&E||a)&&typeof FileReader<"u"){var w=new FileReader;w.onloadend=function(){var S=w.result;S=x?S:S.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=S:location=S,p=null},w.readAsDataURL(d)}else{var y=s.URL||s.webkitURL,v=y.createObjectURL(d);p?p.location=v:location.href=v,p=null,setTimeout(function(){y.revokeObjectURL(v)},4e4)}});s.saveAs=u.saveAs=u,t.exports=u})})(Bm);var qi=Bm.exports;const Af=[{value:"background",label:"  ( )"},{value:"full",label:"  ()"},{value:"mls",label:"  ( )"},{value:"ws",label:"  ( , )"},{value:"bs",label:"  ( )"},{value:"cu",label:" ()"}],oN=t=>{switch(t){case"mls":return"[CAMERA] Knee Shot (Medium Long)";case"ws":return"[CAMERA] Waist Shot";case"bs":return"[CAMERA] Bust Shot";case"full":return"[CAMERA] Full Shot";case"cu":return"[CAMERA] Close Up";default:return""}},iN=({onNext:t,isNextLoading:e})=>{const{scenes:n,setScenes:r,characters:o,referenceImages:i,apiKey:s,selectedStyle:a,globalAspectRatio:u,setGlobalAspectRatio:d,showToast:h,openModal:m,globalScenePrompt:p,setGlobalScenePrompt:g,props:E,script:x}=gn(),[w,y]=se.useState({}),[v,S]=se.useState(!1),[N,I]=se.useState({}),[L,P]=se.useState({}),[D,M]=se.useState(!0),[j,Q]=se.useState(!1),[_,z]=se.useState({}),[C,Y]=se.useState({}),[he,J]=se.useState([]),te=se.useRef(null),H=se.useRef(null),ie=se.useRef(null),[F,R]=se.useState(null),de=()=>{var U;return(U=H.current)==null?void 0:U.scrollIntoView({behavior:"smooth"})},ge=()=>{var U;return(U=ie.current)==null?void 0:U.scrollIntoView({behavior:"smooth"})},ae=U=>U.replace(/[\s\[\]\(\):]/g,"");se.useEffect(()=>{let U=!1;const ce=n.map(ee=>{if(!ee.casting&&o.length>0){const G=ae(ee.scriptSegment),O=ae(ee.description),X=o.filter(Fe=>{const Ae=ae(Fe.name);if(G.includes(Ae)||O.includes(Ae))return!0;const re=Fe.name.split("(")[0].trim();if(re.length>=2){const Pe=ae(re);if(G.includes(Pe)||O.includes(Pe))return!0}return!1}),ye=X.slice(0,3).map(Fe=>Fe.id),be=X.slice(3,6).map(Fe=>Fe.id),Le=(E?E.filter(Fe=>{const Ae=ae(Fe.name);return G.includes(Ae)||O.includes(Ae)}):[]).map(Fe=>Fe.id);return U=!0,{...ee,casting:{mainIds:ye,subIds:be,propIds:Le}}}return ee});U&&r(ce)},[o.length,E==null?void 0:E.length,n.length]);const _e=()=>{J(U=>[...U,n])},ze=()=>{if(he.length===0)return;const U=he[he.length-1];r(U),J(ce=>ce.slice(0,-1)),h("  .","success")},Ee=(U,ce)=>{const ee=n.find(ye=>ye.id===U);if(!ee)return"";const G=ee.casting||{mainIds:[],subIds:[]};let O="";p&&p.trim()&&(O+=`[ MANDATORY BACKGROUND & PROP CONSISTENCY RULES ]
`,O+=`(These rules are ABSOLUTE. Prioritize them over generic descriptions.)
`,O+=`${p}

`),O+=`[SCENE INFO]
Location: ${ee.location}
Time: ${ee.timeOfDay}
`;let X=ee.description||"";if(X.includes("[SCENE INFO]")&&(X=X.split("[SCENE INFO]")[0].trim()),X.includes("[CAMERA]")&&(X=X.split("[CAMERA]")[0].trim()),ce==="background"?O+=`Mood/Weather: ${X}
`:O+=`Action/Context: ${X}
`,ce==="background")O+=`
[INSTRUCTION]
NO PEOPLE. EMPTY BACKGROUND ONLY.
Focus on architecture and atmosphere.`;else{if(O+=`
[CAMERA]
${oN(ce)}
`,O+=`
[ACTING & EYE CONTACT RULES]
`,O+=`- **ABSOLUTELY NO LOOKING AT CAMERA**: Characters MUST NOT stare at the viewer. This is a movie scene, not a portrait session.
`,O+=`- **INTERACTION FOCUS**: Characters MUST look at each other or the object/person they are talking to.
`,O+=`- **NATURAL ACTING**: Avoid stiff "Passport Photo" poses. Use dynamic gestures and facial expressions matching the emotion.
`,O+=`- **SITTING POSTURE**: If sitting, DO NOT just sit straight like a statue. Lean forward, rest arm on knee, or gesture with hands while talking.
`,(ee.location.includes("")||ee.location.includes("")||ee.location.includes("")||ee.location.includes(""))&&(O+=`
[INDOOR ETIQUETTE - ABSOLUTE SHOES RULE]
`,O+=`- **LOCATION IS INDOORS**: Character MUST be barefoot or wearing white socks (Beoseon).
`,O+=`- **OVERRIDE REFERENCE**: Even if the Reference Image shows shoes, **YOU MUST REMOVE THEM**.
`,O+=`- **NEGATIVE PROMPT**: Shoes, Boots, Sandals, Jipsin, Geta, Zori.
`,O+=`
[INDOOR ETIQUETTE - HEADWEAR]
`,O+=`- **REMOVE OUTDOOR HATS**: Take off "Gat", "Satgat", "Paeraengi".
`,O+=`- **ALLOWED HEADWEAR**: Headbands (Manggeon), Hairpins (Binyeo), Small Indoor Caps (Tanggeon/Jeongjagwan).
`),G.mainIds.length>0){const be=G.mainIds.map(De=>o.find(Ge=>Ge.id===De)).filter(Boolean),Ce=be.filter(De=>{const Ge=((De==null?void 0:De.description)||"").toLowerCase();return Ge.includes("daenggi")||Ge.includes("half-tied")||Ge.includes("danbal")||Ge.includes("deobeok")||Ge.includes("shaggy")});Ce.length>0&&(O+=`
[HAIR-BASED HAT RULE]
`,Ce.forEach(De=>{O+=`- **CHARACTER ${De==null?void 0:De.name}**: Has specific hairstyle (Daenggi/Half-tied/Shaggy). **MUST NOT WEAR A GAT** (Hat). Show the hair clearly.
`}),Ce.length===be.length&&(O+=`- **NEGATIVE PROMPT**: Gat, Wide Brim Hat, Satgat.
`)),O+=`
[FOCUS SUBJECT - MAIN CHARACTERS]
`,!!ee.focusId?O+=`TOTAL CHARACTERS: 1 (Active Speaker) + Blurred Foreground Element (Listener)
`:(O+=`TOTAL CHARACTERS: ${G.mainIds.length} (DO NOT DRAW MORE THAN ${G.mainIds.length})
`,G.mainIds.length===2&&(O+=`[COMPOSITION: TWO SHOT]
- Show both characters in the frame.
- Equal importance/focus on both.
`));let Fe=0;const Ae=G.mainIds.map(De=>{const Ge=o.find(lt=>lt.id===De),ke=Ge?i.find(lt=>lt.name===Ge.name):null;return ke!=null&&ke.imageUrl&&Fe++,{id:De,hasRef:!!(ke!=null&&ke.imageUrl),refIndex:ke!=null&&ke.imageUrl?Fe:0}});if(G.mainIds.forEach(De=>{var ke,lt;const Ge=o.find(vt=>vt.id===De);if(Ge){const vt=Ae.find(xe=>xe.id===De),b=i.find(xe=>xe.name===Ge.name);let K=b?b.description:Ge.visualGuide||Ge.description;K.includes("[Basic Info]")&&(K=K.split("[Basic Info]")[0].trim());const le=ee.focusId===De,pe=!!ee.focusId,q=vt!=null&&vt.hasRef?`(MATCH WITH PROVIDED REFERENCE IMAGE #${vt.refIndex})`:"(No Reference Image - Generate Freely)";if(O+=`
 CHARACTER: ${Ge.name} ${le?"( PRIMARY FOCUS - SPEAKER)":""} ${q}
`,Ge.name.trim().endsWith("")||Ge.name.includes("")||Ge.name.includes("")||Ge.name.includes("")||/\d+/.test(Ge.name)){O+=`  - **GROUP ENTITY**: This character represents a **GROUP** of people (Crowd/Team).
`;const xe=Ge.name.match(/(\d+)/);if(xe){const He=xe[1];O+=`  - **QUANTITY**: Generate EXACTLY ${He} people for this entry.
`}else O+=`  - **QUANTITY**: Generate MULTIPLE people (3 to 5) for this entry.
`;O+=`  - **UNIFORM RULE**: All members of this group MUST wear the **EXACT SAME CLOTHING** (Uniform) as shown in the Reference Image.
`,O+=`  - **VARIATION**: They can have different heights, weights, and faces, but the **COSTUME MUST BE IDENTICAL**.
`}pe&&!le?(O+=`  - ROLE: **LISTENER** (Foreground Framing Element)
`,O+=`  - IDENTITY: ${Ge.name} (Shoulder/Back View). ${q}
`,O+=`  - APPEARANCE: ${K}
`,(ke=b==null?void 0:b.design)!=null&&ke.clothingColor&&(O+=`  - CLOTHING COLOR: ${b.design.clothingColor}
`),O+=`  - INSTRUCTION: **PUSH TO THE EDGE**. Show ONLY the back of the shoulder/head on the extreme edge of the frame.
`,O+=`  - **SIZE**: The Listener MUST NOT block the view. They should take up less than 15% of the frame width.
`,O+=`  - **BLUR**: Heavily blur this character (Bokeh).
`):(vt!=null&&vt.hasRef?(O+=`  - **VISUAL SOURCE**: REFERENCE IMAGE #${vt.refIndex}
`,O+=`  - **APPEARANCE**: ${K}
`):(O+=`  - APPEARANCE: ${K} (Use as general guide, adapt to scene context)
`,O+=`  - **CROWD/EXTRA RULE**: If this is a group/crowd, prioritize the overall vibe over exact details.
`),(lt=b==null?void 0:b.design)!=null&&lt.clothingColor&&(O+=`  - CLOTHING: ${b.design.clothingColor}
`),pe&&le?O+=`  - ROLE: **ACTIVE SPEAKER** (Camera Focus on this person).
`:O+=`  - ROLE: Main Actor
`)}}),G.mainIds.length>=3&&!ee.focusId)O+=`
    [COMPOSITION: GROUP SHOT]
    - **SHOW ALL CHARACTERS**: The frame MUST contain ALL ${G.mainIds.length} characters.
    - **ARRANGEMENT**: Do NOT line them up in a straight line. Use a triangle or semi-circle formation.
    - **DEPTH**: Place some characters closer, some further back to create depth.
    `;else if(G.mainIds.length===2&&!ee.focusId)O+=`
    [COMPOSITION: DYNAMIC TWO SHOT]
    - **GOAL**: Variety in staging.
    - **OPTION A (Standard)**: Side-by-side (Full Shot). Good for walking or standing formally.
    - **OPTION B (Cinematic)**: Depth Staging. One character in foreground (shoulder/back), one in background (face).
    - **OPTION C (Interaction)**: Angled view showing them looking at EACH OTHER (Profile).
    - **INSTRUCTION**: Choose the option that best fits the action. Do NOT use Option A for every scene.
    `;else if(G.mainIds.length===1||ee.focusId&&G.mainIds.length>0)if(O+=`
    [SOLO/OTS SHOT & ANGLE INSTRUCTION]
    `,ee.focusId){const De=n.findIndex(ke=>ke.id===U);let Ge=!1;if(De>0){const ke=n[De-1];ke.focusId&&ke.focusId!==ee.focusId&&(Ge=!0)}O+=`
    - **CAMERA FOCUS**: Focus SHARPLY on the Active Speaker.
    - **COMPOSITION**: Dirty Single Shot / Tight Over-the-Shoulder.
    - **LISTENER POSITION**: The Listener is TOO BIG. **MOVE THEM OUT OF THE FRAME**.
    - **VISIBILITY**: Show ONLY a sliver of the Listener's shoulder/head on the edge.
    - **RATIO**: Speaker (85% of frame) vs Listener (15% of frame).
    - **EYE CONTACT**: Speaker looks at the Listener (Not at Camera).
    `,Ge?O+=`
    [SPATIAL INVERSION RULE - CRITICAL]
    - The camera has rotated 180 degrees.
    - **VISUAL NEGATION**: Any furniture/objects visible behind the characters in the PREVIOUS shot (e.g., Folding Screen, High Chair) MUST BE BEHIND THE CAMERA now.
    - **CURRENT BACKGROUND**: Show the OPPOSITE wall.
      - **STRUCTURE**: If the previous shot showed the Main Seat/Folding Screen, this shot MUST show Doors/Windows/Courtyard View.
      - **ASYMMETRY**: The two sides of the room are NOT symmetrical. One side is solid (wall/screen), the other is open (doors/windows).
    - **LIGHTING/TONE**: Keep the same color palette and lighting atmosphere, but change the geometry/objects completely.
    `:O+=`
    - **NEGATIVE PROMPT**: Third person, extra characters, crowd, listener facing camera, listener blocking view.
    `}else O+=`
    - **PRIMARY FOCUS**: The camera focuses on the Main Character listed above.
    - **ENVIRONMENT**: The character MUST be integrated into the scene (Background/Location). DO NOT isolate them on a blank background.
    - **ANGLE**: Use a cinematic angle (e.g., 3/4 view, Rule of Thirds).
    - **EYE CONTACT**: DO NOT look at the camera. Look at the invisible listener or object.
    - **COMPOSITION**: Place the character slightly off-center to create a dynamic composition.
                       `;const re=ee.description.toLowerCase(),Pe=[],Ve=[];(re.includes("prison")||re.includes("jail")||re.includes("cell")||re.includes("bars"))&&(Ve.push("SEPARATED BY WOODEN LATTICE (# shape bars)"),O+=`
[HISTORICAL SETTING: JOSEON PRISON]
`,O+=`- **STRUCTURE**: Use **WOODEN LATTICE BARS** (Grid pattern / # shape). Do NOT use vertical-only bars.
`,O+=`- **MATERIAL**: Rough, thick wooden beams forming a criss-cross pattern.
`,O+=`- **FLOOR**: NO STONE FLOOR. Use **DIRT GROUND** covered with **STRAW/HAY**.
`,O+=`- **ATMOSPHERE**: Wooden structure, straw mats, sunlight coming through wooden gaps.
`,O+=`- **NEGATIVE PROMPT**: Iron bars, metal cell, stone floor, dungeon, chains, vertical only bars.
`),(re.includes("door")||re.includes("gate")||re.includes("entrance"))&&Ve.push("FRAMED BY WOODEN DOOR (Character seen through the doorway)"),re.includes("window")&&Ve.push("SEEN THROUGH WINDOW"),(re.includes("low angle")||re.includes("looking up")||re.includes("from below"))&&Pe.push("LOW ANGLE (Heroic/Intimidating)"),(re.includes("high angle")||re.includes("looking down")||re.includes("from above"))&&Pe.push("HIGH ANGLE (Vulnerable/Weak)"),(re.includes("hand")||re.includes("finger")||re.includes("fist"))&&Pe.push("EXTREME CLOSE-UP on HANDS"),(re.includes("foot")||re.includes("feet")||re.includes("shoe")||re.includes("walking"))&&Pe.push("LOW ANGLE / CLOSE-UP on FEET"),(re.includes("eye")||re.includes("tear")||re.includes("stare"))&&Pe.push("EXTREME CLOSE-UP on EYES"),(re.includes("back")||re.includes("behind")||re.includes("leaving"))&&Pe.push("BACK VIEW (Following Shot)"),(re.includes("wide")||re.includes("landscape")||re.includes("far"))&&Pe.push("WIDE SHOT (Establishing)"),(re.includes("side")||re.includes("profile"))&&Pe.push("SIDE PROFILE VIEW"),Ve.length>0&&(O+=`
[SPATIAL BARRIER - CRITICAL]
`,O+=`- **BARRIER**: ${Ve.join(" + ")}
`,O+=`- **DEPTH**: Do NOT place characters side-by-side. One must be BEHIND the barrier.
`),Pe.length>0&&(O+=`
[CAMERA ANGLE & FOCUS - CRITICAL]
`,O+=`- **MANDATORY ANGLE**: ${Pe.join(" + ")}
`,O+=`- **PRIORITY**: This angle instruction OVERRIDES standard framing. Focus on the specific body part or angle requested.
`)}G.propIds&&G.propIds.length>0&&(O+=`
[IMPORTANT PROPS/OBJECTS]
`,G.propIds.forEach(be=>{const Ce=E==null?void 0:E.find(Le=>Le.id===be);Ce&&(O+=` PROP: ${Ce.name}
`,O+=`  - APPEARANCE: ${Ce.description}
`,O+=`  - NOTE: Must be visible and look exactly as described.
`)})),G.subIds.length>0&&(O+=`
[BACKGROUND/EXTRAS (ATMOSPHERE)]
`,O+=`- **ROLE**: These are BACKGROUND CHARACTERS. They must NOT draw attention away from the Main Cast.
`,O+=`- **CONSISTENCY**: If the previous scene had a specific crowd, try to match their vibe/clothing.
`,G.subIds.forEach(be=>{const Ce=o.find(Le=>Le.id===be);if(Ce){const Le=i.find(Ae=>Ae.name===Ce.name),Fe=Le?Le.description:Ce.description;O+=`- ${Ce.name}: ${Fe}
`}}))}return P(ye=>({...ye,[U]:O})),O},Ne=(U,ce)=>{I(ee=>({...ee,[U]:ce})),Ee(U,ce)},Ie=(U,ce)=>{r(ee=>ee.map(G=>{if(G.id===U){const O=G.focusId===ce?void 0:ce;return{...G,focusId:O}}return G}))},Re=(U,ce,ee,G)=>{r(O=>O.map(X=>{if(X.id!==U)return X;const ye=X.casting||{mainIds:[],subIds:[],propIds:[]};let be=[...ye.mainIds],Ce=[...ye.subIds],Le=[...ye.propIds||[]],Fe=X.focusId;if(G==="remove")ce==="main"&&(be=be.filter(Ae=>Ae!==ee),Fe===ee&&(Fe=void 0)),ce==="sub"&&(Ce=Ce.filter(Ae=>Ae!==ee)),ce==="prop"&&(Le=Le.filter(Ae=>Ae!==ee));else if(ce==="main"){if(be.length>=6)return h("  6.","warning"),X;be.includes(ee)||be.push(ee),Ce=Ce.filter(Ae=>Ae!==ee)}else if(ce==="sub"){if(Ce.length>=6)return h("  6.","warning"),X;Ce.includes(ee)||Ce.push(ee),be=be.filter(Ae=>Ae!==ee)}else if(ce==="prop"){if(Le.length>=3)return h("  3.","warning"),X;Le.includes(ee)||Le.push(ee)}return{...X,casting:{mainIds:be,subIds:Ce,propIds:Le},focusId:Fe}}))},st=(U,ce)=>{var ee;m({type:"textarea",title:`SCENE ${(ee=n.find(G=>G.id===U))==null?void 0:ee.sceneNumber}  `,message:`      .
(          .)`,defaultValue:ce,confirmText:" ",onConfirm:G=>{P(O=>({...O,[U]:G||""}))}})},qe=U=>{var G;const ce=(G=U.target.files)==null?void 0:G[0];if(!ce||!F)return;const ee=new FileReader;ee.onload=O=>{var ye;const X=(ye=O.target)==null?void 0:ye.result;X&&(r(be=>be.map(Ce=>Ce.id===F?{...Ce,backgroundRefUrl:X}:Ce)),h("   .","success"),R(null))},ee.readAsDataURL(ce)},T=U=>{if(U===0)return h("  .","warning");const ce=n[U];let ee=null;for(let G=U-1;G>=0;G--)if(n[G].location===ce.location&&n[G].generatedImageUrl){ee=n[G].generatedImageUrl;break}!ee&&n[U-1].generatedImageUrl&&(ee=n[U-1].generatedImageUrl),ee?(r(G=>G.map((O,X)=>X===U?{...O,backgroundRefUrl:ee}:O)),h("   !","success")):h("      .","warning")},V=U=>{m({type:"confirm",title:"   ",message:`     ?
(  .)`,confirmText:"",onConfirm:()=>{r(ce=>ce.map(ee=>{if(ee.id===U){const G={...ee};return delete G.backgroundRefUrl,G}return ee})),h("   .","success")}})},$=()=>{confirm(`    ?
(, ,  .)

 :      .`)&&(r([]),I({}),P({}),z({}),y({}),Y({}),J([]),h("   .    .","success"))},k=()=>{if(!confirm(`     ?
(       .)`))return;const U=n.map(ce=>{var Le,Fe,Ae;const ee=ae(ce.scriptSegment),G=ae(ce.description),O=o.filter(re=>{const Pe=ae(re.name);if(ee.includes(Pe)||G.includes(Pe))return!0;const Ve=re.name.split("(")[0].trim();if(Ve.length>=2){const De=ae(Ve);if(ee.includes(De)||G.includes(De))return!0}return!1}),X=((Le=ce.casting)==null?void 0:Le.mainIds)||[],ye=((Fe=ce.casting)==null?void 0:Fe.subIds)||[],be=((Ae=ce.casting)==null?void 0:Ae.propIds)||[],Ce=[...X];return O.forEach(re=>{!Ce.includes(re.id)&&!ye.includes(re.id)&&Ce.push(re.id)}),{...ce,casting:{mainIds:Ce,subIds:ye,propIds:be}}});r(U),h("   . (  )","success")},A=async()=>{if(!x)return h("  .","warning");if(!s)return h("API  .","warning");Q(!0),h("      ...","success");try{const U=await qC(s,x);g(U),h("  .   .","success")}catch(U){h(U.message,"error")}finally{Q(!1)}},B=async U=>{var G,O;let ce=L[U];const ee=N[U]||"background";if(ce||(ce=Ee(U,ee)),!ce){h(" ","error");return}y(X=>({...X,[U]:!0}));try{const X=n.find(Ge=>Ge.id===U),ye=(X==null?void 0:X.aspectRatio)||u||"16:9";let be=[],Ce=[];ee!=="background"&&((G=X==null?void 0:X.casting)!=null&&G.mainIds)&&X.casting.mainIds.length>0&&X.casting.mainIds.forEach(Ge=>{const ke=o.find(lt=>lt.id===Ge);if(ke){const lt=i.find(vt=>vt.name===ke.name);lt!=null&&lt.imageUrl&&(be.push(lt.imageUrl),Ce.push(ke.name))}});const Le=_[U]||"",Ae=!!(X!=null&&X.focusId)||X==null?void 0:X.backgroundRefUrl;let re=[];(O=X==null?void 0:X.casting)!=null&&O.propIds&&X.casting.propIds.length>0&&X.casting.propIds.forEach(Ge=>{const ke=E==null?void 0:E.find(lt=>lt.id===Ge);ke&&ke.imageUrl&&re.push(ke.imageUrl)});let Pe,Ve=X==null?void 0:X.masterFullShotUrl;if(!Ve){const Ge=n.findIndex(ke=>ke.id===U);for(let ke=Ge-1;ke>=0;ke--)if(n[ke].location===(X==null?void 0:X.location)&&n[ke].masterFullShotUrl){Ve=n[ke].masterFullShotUrl;break}}ee==="full"?Pe=X==null?void 0:X.generatedImageUrl:Pe=Ve||(X==null?void 0:X.generatedImageUrl);const De=await Cs(s,ce,a,ye,ee==="background"?"background":"cinematic",be,Le,Ae,re,p,Pe,Ce);r(Ge=>Ge.map(ke=>{if(ke.id===U){const lt=ke.imageHistory?[De,...ke.imageHistory]:[De];!ke.imageHistory&&ke.generatedImageUrl&&lt.push(ke.generatedImageUrl);const vt=ee==="full"?De:ke.masterFullShotUrl;return{...ke,generatedImageUrl:De,masterFullShotUrl:vt,imageHistory:lt,aspectRatio:ye}}return ke})),v||h(" !","success")}catch(X){v||h(X.message,"error")}finally{y(X=>({...X,[U]:!1}))}},ne=async(U,ce)=>{const ee=n.find(G=>G.id===U);if(!(!(ee!=null&&ee.generatedImageUrl)||!ce)){y(G=>({...G,[U]:!0})),h("  ...","success");try{const G=await WC(s,ee.generatedImageUrl,ce);r(O=>O.map(X=>{if(X.id===U){const ye=[G,...X.imageHistory||[]];return{...X,generatedImageUrl:G,imageHistory:ye}}return X})),h(" !","success")}catch(G){h(G.message,"error")}finally{y(G=>({...G,[U]:!1}))}}},oe=async(U,ce)=>{if(!s)return h("API  .","warning");_e();const ee=n.findIndex(O=>O.id===U);if(ee===-1)return;const G=n[ee];Y(O=>({...O,[U]:!0})),h(` ${ce}  ... (  )`,"success");try{const O=await DC(s,G,ce),X=[...n];X.splice(ee,1,...O);const ye=X.map((be,Ce)=>({...be,sceneNumber:Ce+1}));r(ye),h(`! ${G.sceneNumber}  ${ce} .`,"success")}catch(O){h(O.message,"error")}finally{Y(O=>({...O,[U]:!1}))}},W=U=>{var ye,be,Ce,Le;if(U===0)return;_e();const ce=n[U-1],ee=n[U],G={mainIds:[...new Set([...((ye=ce.casting)==null?void 0:ye.mainIds)||[],...((be=ee.casting)==null?void 0:be.mainIds)||[]])],subIds:[...new Set([...((Ce=ce.casting)==null?void 0:Ce.subIds)||[],...((Le=ee.casting)==null?void 0:Le.subIds)||[]])]},O={...ce,scriptSegment:`${ce.scriptSegment}
${ee.scriptSegment}`,description:`${ce.description} ${ee.description}`,casting:G},X=[...n];X.splice(U-1,2,O),r(X.map((Fe,Ae)=>({...Fe,sceneNumber:Ae+1}))),h(`${U+1} ${U}  .`,"success")},ue=U=>{U!==n.length-1&&W(U+1)},ve=async()=>{const U=n.filter(G=>G.generatedImageUrl);if(U.length===0)return h("   .","warning");const ce=new kl;let ee=0;h(`${U.length}   ...`,"success");try{const G=U.map(async O=>{if(O.generatedImageUrl)try{const ye=`${O.sceneNumber.toString().padStart(2,"0")}_Scene_${O.sceneNumber}.png`,Ce=await(await fetch(O.generatedImageUrl)).blob();ce.file(ye,Ce),ee++}catch(X){console.error(`Failed to fetch image for scene ${O.sceneNumber}`,X)}});if(await Promise.all(G),ee>0){const O=await ce.generateAsync({type:"blob"});qi.saveAs(O,"Sintong_Scenes.zip"),h("   .","success")}else h("   .","error")}catch(G){console.error("Zip generation failed",G),h("     .","error")}},[fe,Se]=se.useState(null),Ue=async()=>{if(!s)return h("API  .","warning");const U=n.filter(ce=>!ce.generatedImageUrl);if(U.length===0)return h("    .","warning");m({type:"confirm",title:"  (  )",message:` ${U.length}   .

[ ]
1. :   (//   )
2. :    
3. :  (${u}) 

:       .`,confirmText:"   ",onConfirm:async()=>{var G;S(!0),Se({current:0,total:U.length,startTime:Date.now()}),h("    ... (3 )","success");const ce=["full","mls","ws","bs","cu"];let ee=0;for(let O=0;O<U.length;O++){const X=U[O];Se({current:O+1,total:U.length,startTime:Date.now()});try{const ye=ce[Math.floor(Math.random()*ce.length)];I(Pe=>({...Pe,[X.id]:ye}));const be=Ee(X.id,ye),Ce=X.aspectRatio||u||"16:9";let Le=[];ye!=="background"&&((G=X==null?void 0:X.casting)!=null&&G.mainIds)&&X.casting.mainIds.length>0&&X.casting.mainIds.forEach(Pe=>{const Ve=o.find(De=>De.id===Pe);if(Ve){const De=i.find(Ge=>Ge.name===Ve.name);De!=null&&De.imageUrl&&Le.push(De.imageUrl)}});const Fe=_[X.id]||"",Ae=X.backgroundRefUrl,re=await Cs(s,be||"Scene",a,Ce,"cinematic",Le,Fe,void 0,void 0,p);r(Pe=>Pe.map(Ve=>{if(Ve.id===X.id){const De=Ve.imageHistory?[re,...Ve.imageHistory]:[re];return!Ve.imageHistory&&Ve.generatedImageUrl&&De.push(Ve.generatedImageUrl),{...Ve,generatedImageUrl:re,imageHistory:De,aspectRatio:Ce}}return Ve})),ee++}catch(ye){console.error(`Failed scene ${X.sceneNumber}`,ye)}O<U.length-1&&await new Promise(ye=>setTimeout(ye,3e3))}S(!1),Se(null),h(`  ! (${ee}/${U.length} )`,"success")}})},Me=(U,ce)=>{const ee=document.createElement("a");ee.href=U,ee.download=ce,ee.click()},Xe=(U,ce)=>{r(ee=>ee.map(G=>G.id===U?{...G,generatedImageUrl:ce}:G))},Kt=(U,ce,ee)=>{U.stopPropagation(),confirm("   ?")&&r(G=>G.map(O=>{var X;if(O.id===ce){const ye=((X=O.imageHistory)==null?void 0:X.filter(Ce=>Ce!==ee))||[];let be=O.generatedImageUrl;return O.generatedImageUrl===ee&&(be=ye.length>0?ye[0]:void 0),{...O,imageHistory:ye,generatedImageUrl:be}}return O}))},yt=async U=>{const ce=n.find(ee=>ee.id===U);if(ce!=null&&ce.generatedImageUrl){if(!s)return h("API  .","warning");m({type:"confirm",title:"  ",message:"   ,  () ?",confirmText:"",onConfirm:async()=>{y(ee=>({...ee,[U]:!0}));try{const ee=await zC(s,ce.generatedImageUrl);r(G=>G.map(O=>{if(O.id===U){const X=[ee,...O.imageHistory||[]];return{...O,generatedImageUrl:ee,imageHistory:X}}return O})),h(" .","success")}catch(ee){h(ee.message,"error")}finally{y(ee=>({...ee,[U]:!1}))}}})}},Jt=async U=>{const ce=n.find(ee=>ee.id===U);if(ce!=null&&ce.generatedImageUrl){if(!s)return h("API  .","warning");m({type:"confirm",title:"  ( )",message:`     ?
(    )`,confirmText:" ",onConfirm:async()=>{y(ee=>({...ee,[U]:!0}));try{const ee=await $C(s,ce.generatedImageUrl);r(G=>G.map(O=>{if(O.id===U){const X=[ee,...O.imageHistory||[]];return{...O,generatedImageUrl:ee,imageHistory:X}}return O})),h(" .","success")}catch(ee){h(ee.message,"error")}finally{y(ee=>({...ee,[U]:!1}))}}})}},Ke=(U,ce)=>{r(ee=>ee.map(G=>G.id===U?{...G,aspectRatio:ce}:G)),h(`   ${ce} .`,"success")},Xt=()=>{if(!v||!fe)return null;const U=Math.round(fe.current/fe.total*100),ce=Math.floor((Date.now()-fe.startTime)/1e3),ee=G=>{const O=Math.floor(G/60),X=G%60;return`${O}:${X.toString().padStart(2,"0")}`};return f.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:f.jsxs("div",{className:"bg-white rounded-xl p-8 max-w-md w-full shadow-2xl text-center space-y-6 animate-pulse-slow",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx("h3",{className:"text-2xl font-bold text-indigo-700",children:"   ..."}),f.jsx("p",{className:"text-gray-500",children:" .   ."})]}),f.jsxs("div",{className:"relative pt-1",children:[f.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[f.jsx("div",{children:f.jsx("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-indigo-600 bg-indigo-200",children:"Progress"})}),f.jsx("div",{className:"text-right",children:f.jsxs("span",{className:"text-xs font-semibold inline-block text-indigo-600",children:[U,"% (",fe.current," / ",fe.total,")"]})})]}),f.jsx("div",{className:"overflow-hidden h-4 mb-4 text-xs flex rounded bg-indigo-100",children:f.jsx("div",{style:{width:`${U}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-indigo-600 transition-all duration-500 ease-out"})})]}),f.jsx("div",{className:"flex justify-center text-sm bg-gray-50 p-4 rounded-lg",children:f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsx("span",{className:"text-gray-400",children:" "}),f.jsx("span",{className:"font-mono font-bold text-gray-700",children:ee(ce)})]})}),f.jsx("button",{onClick:()=>{confirm("?        .")&&window.location.reload()},className:"text-red-400 hover:text-red-600 text-sm underline decoration-red-300",children:"  "})]})})};return f.jsxs("div",{className:"space-y-6 animate-fade-in relative",children:[f.jsx("div",{ref:H}),f.jsxs("div",{className:"fixed left-6 bottom-20 flex flex-col gap-2 z-50",children:[f.jsx("button",{onClick:de,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:f.jsx("i",{className:"fas fa-arrow-up"})}),f.jsx("button",{onClick:ge,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:f.jsx("i",{className:"fas fa-arrow-down"})})]}),Xt(),f.jsx("input",{type:"file",ref:te,onChange:qe,accept:"image/*",className:"hidden"}),f.jsxs("div",{className:"flex flex-col xl:flex-row justify-between items-center bg-slate-800 p-6 rounded-xl border border-slate-700 gap-4",children:[f.jsxs("div",{children:[f.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["   (",n.length,")"]}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("span",{className:"text-sm text-slate-400",children:"  :"}),f.jsxs("select",{value:u,onChange:U=>d(U.target.value),className:"bg-slate-900 border border-slate-600 rounded px-2 py-1 text-sm font-bold text-indigo-300 focus:ring-2 focus:ring-indigo-500",children:[f.jsx("option",{value:"16:9",children:"16:9 ()"}),f.jsx("option",{value:"9:16",children:"9:16 (/)"}),f.jsx("option",{value:"1:1",children:"1:1 ()"}),f.jsx("option",{value:"4:3",children:"4:3 ()"}),f.jsx("option",{value:"3:4",children:"3:4 ()"})]})]})]}),f.jsxs("div",{className:"flex gap-3 items-center",children:[f.jsxs("button",{onClick:$,className:"px-4 py-3 rounded-lg font-bold bg-red-900/50 hover:bg-red-900 text-red-200 border border-red-700/50 flex items-center gap-2",title:"     (/ )",children:[f.jsx("i",{className:"fas fa-trash-restore"}),"  "]}),f.jsxs("button",{onClick:k,className:"px-4 py-3 rounded-lg font-bold bg-indigo-900/50 hover:bg-indigo-900 text-indigo-200 border border-indigo-700/50 flex items-center gap-2",title:"     (  )",children:[f.jsx("i",{className:"fas fa-sync-alt"}),"  "]}),he.length>0&&f.jsxs("button",{onClick:ze,className:"px-4 py-3 rounded-lg font-bold bg-slate-700 hover:bg-slate-600 text-slate-200 border border-slate-600 flex items-center gap-2",title:" / ",children:[f.jsx("i",{className:"fas fa-undo"}),"  "]}),f.jsxs("button",{onClick:Ue,disabled:v||e,className:`px-5 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2 border transition-all ${v?"bg-yellow-700 text-yellow-100 border-yellow-600 animate-pulse":"bg-slate-700 hover:bg-slate-600 text-slate-200 border-slate-600"}`,children:[v?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-layer-group"}),v?" ...":"   "]}),f.jsxs("button",{onClick:ve,disabled:v,className:"px-5 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2 border transition-all bg-indigo-700 hover:bg-indigo-600 text-white border-indigo-500",title:"     ",children:[f.jsx("i",{className:"fas fa-file-archive"}),"  "]}),f.jsxs("button",{onClick:t,disabled:e||v,className:"bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2",children:[e?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-arrow-right"})," () "]})]})]}),f.jsxs("div",{className:"bg-indigo-900/30 border border-indigo-500/50 rounded-xl p-6 shadow-lg",children:[f.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>M(!D),children:[f.jsxs("h3",{className:"text-lg font-bold text-indigo-200 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-globe-asia"})," []  / "]}),f.jsx("i",{className:`fas fa-chevron-${D?"up":"down"} text-indigo-400`})]}),D&&f.jsxs("div",{className:"animate-fade-in",children:[f.jsxs("p",{className:"text-sm text-slate-400 mb-2",children:["  ",f.jsx("strong",{children:"  "}),'. "   ", "  ", "    "  AI     .']}),f.jsx("div",{className:"flex justify-end mb-2",children:f.jsxs("button",{onClick:A,disabled:j,className:"text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded flex items-center gap-2 border border-indigo-400 shadow-sm",children:[j?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-magic"}),"   /"]})}),f.jsx("textarea",{value:p,onChange:U=>g(U.target.value),placeholder:":      .      .          .",className:"w-full h-32 bg-slate-800 border border-slate-600 rounded-lg p-3 text-sm text-white focus:ring-2 focus:ring-indigo-500 resize-none leading-relaxed"}),f.jsx("div",{className:"flex justify-end mt-2",children:f.jsxs("button",{onClick:()=>{n.forEach(U=>Ee(U.id,N[U.id]||"background")),h("     . ( )","success")},className:"text-xs bg-indigo-700 hover:bg-indigo-600 text-white px-3 py-1.5 rounded flex items-center gap-1",children:[f.jsx("i",{className:"fas fa-sync-alt"}),"   "]})})]})]}),f.jsx("div",{className:"space-y-12",children:n.map((U,ce)=>{var ee,G,O,X,ye,be,Ce,Le,Fe,Ae;return f.jsxs("div",{className:"bg-slate-800 rounded-2xl overflow-hidden border border-slate-700 shadow-xl",children:[f.jsxs("div",{className:"bg-slate-900/50 p-6 border-b border-slate-700",children:[f.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-3",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsxs("span",{className:"bg-indigo-600 text-white px-3 py-1 rounded text-sm font-bold whitespace-nowrap",children:["SCENE ",U.sceneNumber]}),f.jsx("h3",{className:"text-xl md:text-2xl font-bold text-white truncate max-w-[200px] md:max-w-md",children:U.location}),f.jsx("span",{className:"text-slate-400 text-sm border border-slate-600 px-2 py-0.5 rounded-full whitespace-nowrap",children:U.timeOfDay})]}),f.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[f.jsxs("div",{className:"flex items-center gap-1 bg-slate-800 rounded-lg p-1 border border-slate-600",children:[f.jsxs("span",{className:"text-[10px] text-slate-400 px-2 font-bold uppercase",children:[f.jsx("i",{className:"fas fa-link mr-1"}),""]}),f.jsx("button",{onClick:()=>W(ce),disabled:ce===0,className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"   (     )",children:f.jsx("i",{className:"fas fa-arrow-up"})}),f.jsx("button",{onClick:()=>ue(ce),disabled:ce===n.length-1,className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"   (     )",children:f.jsx("i",{className:"fas fa-arrow-down"})})]}),f.jsxs("div",{className:"flex items-center gap-1 bg-slate-800 rounded-lg p-1 border border-slate-600",children:[f.jsxs("span",{className:"text-[10px] text-slate-400 px-2 font-bold uppercase",children:[f.jsx("i",{className:"fas fa-cut mr-1"}),""]}),f.jsx("button",{onClick:()=>oe(U.id,2),disabled:C[U.id],className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors",title:"     2 ",children:"2"}),f.jsx("button",{onClick:()=>oe(U.id,3),disabled:C[U.id],className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors",title:"     3 ",children:"3"})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-xs text-slate-500",children:":"}),f.jsxs("select",{value:U.aspectRatio||u,onChange:re=>Ke(U.id,re.target.value),className:"bg-slate-800 text-xs text-slate-300 border border-slate-600 rounded px-1 py-1",children:[f.jsx("option",{value:"16:9",children:"16:9"}),f.jsx("option",{value:"9:16",children:"9:16"}),f.jsx("option",{value:"1:1",children:"1:1"}),f.jsx("option",{value:"4:3",children:"4:3"}),f.jsx("option",{value:"3:4",children:"3:4"})]})]})]})]}),C[U.id]&&f.jsxs("div",{className:"mb-4 bg-indigo-900/30 border border-indigo-500/30 text-indigo-300 px-4 py-2 rounded text-sm flex items-center gap-3 animate-pulse",children:[f.jsx("i",{className:"fas fa-spinner fa-spin"}),f.jsx("span",{children:"AI      ..."})]}),f.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-600/50",children:[f.jsxs("p",{className:"text-indigo-300 text-sm font-bold mb-1",children:[f.jsx("i",{className:"fas fa-quote-left mr-2"})," "]}),f.jsx("p",{className:"text-lg text-slate-200",children:U.scriptSegment})]})]}),f.jsx("div",{className:"p-6",children:f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[f.jsxs("div",{className:"lg:col-span-2 flex flex-col gap-4",children:[f.jsxs("div",{className:"relative w-full bg-black rounded-lg overflow-hidden border border-slate-700 flex items-center justify-center transition-all",style:{width:"100%",aspectRatio:(U.aspectRatio||u).replace(":","/")},children:[U.generatedImageUrl?f.jsx("img",{src:U.generatedImageUrl,alt:"Background",className:"w-full h-full object-contain"}):f.jsxs("div",{className:"text-slate-600 flex flex-col items-center",children:[f.jsx("i",{className:"fas fa-image text-6xl mb-4 opacity-30"}),f.jsx("span",{children:" "})]}),w[U.id]&&f.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center backdrop-blur-sm",children:f.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-indigo-500"})}),N[U.id]&&N[U.id]!=="background"&&f.jsx("div",{className:"absolute top-4 right-4 bg-black/80 text-white text-xs px-2 py-1 rounded border border-white/30 backdrop-blur-md",children:(ee=Af.find(re=>re.value===N[U.id]))==null?void 0:ee.label}),U.backgroundRefUrl&&f.jsxs("div",{className:"absolute bottom-4 left-4 bg-blue-900/80 text-white text-xs px-2 py-1 rounded border border-blue-500 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-layer-group"}),"    ( )"]})]}),U.imageHistory&&U.imageHistory.length>0&&f.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 custom-scrollbar",children:U.imageHistory.map((re,Pe)=>f.jsxs("div",{onClick:()=>Xe(U.id,re),className:`relative group flex-shrink-0 w-16 h-16 rounded cursor-pointer border-2 transition-all hover:scale-105 ${U.generatedImageUrl===re?"border-indigo-500 ring-1":"border-slate-700 opacity-60"}`,children:[f.jsx("img",{src:re,alt:"History",className:"w-full h-full object-cover rounded-[inherit]"}),f.jsx("button",{onClick:Ve=>Kt(Ve,U.id,re),className:"absolute -top-2 -right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-[10px] opacity-0 group-hover:opacity-100 transition-opacity shadow-sm z-10",title:"",children:f.jsx("i",{className:"fas fa-times"})})]},Pe))}),U.generatedImageUrl&&f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:()=>Me(U.generatedImageUrl,`scene_${U.sceneNumber}.png`),className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white px-4 py-3 rounded-lg font-bold border border-slate-600 flex items-center justify-center gap-2",children:[f.jsx("i",{className:"fas fa-download"})," "]}),N[U.id]!=="background"&&f.jsxs(f.Fragment,{children:[f.jsxs("button",{onClick:()=>yt(U.id),className:"flex-1 bg-green-900/50 hover:bg-green-800/80 text-green-300 hover:text-white px-4 py-3 rounded-lg font-bold border border-green-700/50 flex items-center justify-center gap-2",title:"    ",children:[f.jsx("i",{className:"fas fa-magic"}),"  "]}),f.jsxs("button",{onClick:()=>Jt(U.id),className:"flex-1 bg-slate-700 hover:bg-red-900/50 text-slate-300 hover:text-red-300 px-4 py-3 rounded-lg font-bold border border-slate-600 hover:border-red-700 flex items-center justify-center gap-2",title:"    ",children:[f.jsx("i",{className:"fas fa-user-slash"}),"  "]})]})]}),U.generatedImageUrl&&f.jsxs("div",{className:"mt-2 bg-purple-900/20 border border-purple-500/30 p-4 rounded-lg",children:[f.jsxs("label",{className:"text-sm font-bold text-purple-300 block mb-2",children:[f.jsx("i",{className:"fas fa-magic mr-2"}),"  (   )"]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("input",{type:"text",id:`fix-input-${U.id}`,placeholder:":   ,   ",className:"flex-1 bg-slate-900 border border-purple-500/50 rounded-lg px-4 py-3 text-white focus:border-purple-400 focus:ring-1 focus:ring-purple-400 placeholder-slate-500",onKeyDown:re=>{if(re.key==="Enter"){const Pe=re.currentTarget.value;Pe&&ne(U.id,Pe)}}}),f.jsx("button",{onClick:()=>{const re=document.getElementById(`fix-input-${U.id}`);re&&re.value&&ne(U.id,re.value)},disabled:w[U.id],className:"bg-purple-600 hover:bg-purple-500 text-white px-6 py-3 rounded-lg font-bold shadow-lg whitespace-nowrap",children:w[U.id]?f.jsx("i",{className:"fas fa-spinner fa-spin"}):" "})]}),f.jsx("p",{className:"text-xs text-purple-400/70 mt-2 ml-1",children:"* 3     .     ."})]})]}),f.jsxs("div",{className:"lg:col-span-1 flex flex-col gap-4",children:[f.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-700",children:[f.jsxs("label",{className:"text-xs font-bold text-slate-400 mb-2 block uppercase",children:[f.jsx("i",{className:"fas fa-camera mr-1"}),"   ( )"]}),f.jsx("div",{className:"flex gap-2 flex-wrap",children:Af.map(re=>f.jsx("button",{onClick:()=>Ne(U.id,re.value),className:`px-3 py-2 rounded text-xs font-bold border transition-all ${N[U.id]===re.value||!N[U.id]&&re.value==="background"?"bg-indigo-600 text-white border-indigo-500":"bg-slate-800 text-slate-400 border-slate-600 hover:bg-slate-700"}`,children:re.label},re.value))})]}),N[U.id]!=="background"&&f.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-700",children:[f.jsxs("h4",{className:"text-sm font-bold text-white mb-3 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-users-cog text-yellow-500"}),"  "]}),f.jsxs("div",{className:"mb-4",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsx("label",{className:"text-xs font-bold text-indigo-400",children:"  (Foreground)"}),f.jsxs("select",{className:"bg-slate-800 text-xs text-white border border-slate-600 rounded px-2 py-1 w-24",onChange:re=>{re.target.value&&Re(U.id,"main",re.target.value,"add"),re.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),o.map(re=>f.jsx("option",{value:re.id,children:re.name},re.id))]})]}),f.jsxs("div",{className:"flex flex-col gap-2 min-h-[30px]",children:[(O=(G=U.casting)==null?void 0:G.mainIds)==null?void 0:O.map(re=>{const Pe=o.find(De=>De.id===re),Ve=U.focusId===re;return Pe?f.jsxs("div",{className:`flex items-center justify-between p-2 rounded-lg border ${Ve?"bg-indigo-900/80 border-indigo-400":"bg-slate-800 border-slate-700"}`,children:[f.jsx("div",{className:"flex items-center gap-2",children:f.jsx("span",{className:`text-xs font-bold ${Ve?"text-white":"text-slate-300"}`,children:Pe.name})}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs("button",{onClick:()=>Ie(U.id,re),className:`text-[10px] px-2 py-0.5 rounded border ${Ve?"bg-indigo-500 text-white border-indigo-400":"bg-slate-700 text-slate-400 border-slate-600 hover:bg-slate-600"}`,title:Ve?"   ( )":"    ",children:[f.jsx("i",{className:`fas ${Ve?"fa-video":"fa-video-slash"} mr-1`}),Ve?"ON":"OFF"]}),f.jsx("button",{onClick:()=>Re(U.id,"main",re,"remove"),className:"text-slate-500 hover:text-red-400",children:f.jsx("i",{className:"fas fa-times"})})]})]},re):null}),(!((X=U.casting)!=null&&X.mainIds)||U.casting.mainIds.length===0)&&f.jsx("span",{className:"text-xs text-slate-600",children:" "}),((ye=U.casting)==null?void 0:ye.mainIds)&&U.casting.mainIds.length>=2&&!U.focusId&&f.jsxs("div",{className:"mt-2 bg-slate-900/50 p-2 rounded border border-slate-600",children:[f.jsxs("p",{className:"text-[10px] text-slate-300 mb-1",children:[f.jsx("i",{className:"fas fa-video mr-1"})," ",f.jsx("strong",{children:"  "})]}),f.jsxs("ul",{className:"text-[10px] text-slate-400 space-y-1 list-disc pl-3",children:[f.jsxs("li",{children:[f.jsx("strong",{children:"():"}),"  [ON]      . (    )"]}),f.jsxs("li",{children:[f.jsx("strong",{children:"/OTS:"}),"   ",f.jsx("span",{className:"text-indigo-400 font-bold",children:"[ON]"}),",     ."]})]})]})]})]}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsx("label",{className:"text-xs font-bold text-slate-400",children:" (Background)"}),f.jsxs("select",{className:"bg-slate-800 text-xs text-white border border-slate-600 rounded px-2 py-1 w-24",onChange:re=>{re.target.value&&Re(U.id,"sub",re.target.value,"add"),re.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),o.map(re=>f.jsx("option",{value:re.id,children:re.name},re.id))]})]}),f.jsx("div",{className:"flex gap-2 flex-wrap min-h-[30px]",children:(Ce=(be=U.casting)==null?void 0:be.subIds)==null?void 0:Ce.map(re=>{const Pe=o.find(Ve=>Ve.id===re);return Pe?f.jsxs("div",{className:"bg-slate-700 text-slate-300 text-xs px-2 py-1 rounded-full flex items-center gap-1 border border-slate-600",children:[f.jsx("span",{children:Pe.name}),f.jsx("button",{onClick:()=>Re(U.id,"sub",re,"remove"),className:"hover:text-red-300",children:f.jsx("i",{className:"fas fa-times"})})]},re):null})})]}),f.jsxs("div",{className:"mt-4 border-t border-slate-800 pt-4",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsx("label",{className:"text-xs font-bold text-green-400",children:"   (Props)"}),f.jsxs("select",{className:"bg-slate-800 text-xs text-white border border-slate-600 rounded px-2 py-1 w-24",onChange:re=>{re.target.value&&Re(U.id,"prop",re.target.value,"add"),re.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),E&&E.map(re=>f.jsx("option",{value:re.id,children:re.name},re.id))]})]}),f.jsxs("div",{className:"flex gap-2 flex-wrap min-h-[30px]",children:[(Fe=(Le=U.casting)==null?void 0:Le.propIds)==null?void 0:Fe.map(re=>{const Pe=E==null?void 0:E.find(Ve=>Ve.id===re);return Pe?f.jsxs("div",{className:"bg-green-700 text-green-100 text-xs px-2 py-1 rounded-full flex items-center gap-1 shadow-sm",children:[f.jsx("span",{children:Pe.name}),f.jsx("button",{onClick:()=>Re(U.id,"prop",re,"remove"),className:"hover:text-red-300",children:f.jsx("i",{className:"fas fa-times"})})]},re):null}),(!((Ae=U.casting)!=null&&Ae.propIds)||U.casting.propIds.length===0)&&f.jsx("span",{className:"text-xs text-slate-600",children:" "})]})]})]}),f.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-700",children:[f.jsxs("label",{className:"text-xs font-bold text-blue-400 mb-2 block uppercase flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-image"}),"   ( )"]}),U.backgroundRefUrl?f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"w-full h-20 bg-black rounded border border-blue-500 overflow-hidden mb-2 relative",children:[f.jsx("img",{src:U.backgroundRefUrl,alt:"Background Ref",className:"w-full h-full object-cover opacity-70"}),f.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold text-white bg-black/50 text-center leading-tight",children:["  ",f.jsx("br",{}),"(/ )"]})]}),f.jsxs("button",{onClick:()=>V(U.id),className:"relative z-20 w-full text-xs text-white bg-red-800 hover:bg-red-600 border border-red-500 rounded py-3 transition-colors font-bold cursor-pointer shadow-md",children:[f.jsx("i",{className:"fas fa-trash-alt mr-1"}),"    ()"]})]}):f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsxs("button",{onClick:()=>T(ce),className:"bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs py-2 px-1 rounded border border-slate-600 flex flex-col items-center gap-1",title:"    ",children:[f.jsx("i",{className:"fas fa-arrow-left"}),"  "]}),f.jsxs("button",{onClick:()=>{var re;R(U.id),(re=te.current)==null||re.click()},className:"bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs py-2 px-1 rounded border border-slate-600 flex flex-col items-center gap-1",title:"PC  ",children:[f.jsx("i",{className:"fas fa-upload"}),"  "]})]}),f.jsxs("p",{className:"text-[10px] text-slate-500 mt-2 leading-tight",children:["*      ",f.jsx("strong",{children:"()"}),"  ."]})]}),f.jsxs("div",{className:"flex-grow flex flex-col gap-2",children:[f.jsxs("div",{className:"flex justify-between items-end",children:[f.jsxs("label",{className:"text-xs font-bold text-green-400 uppercase",children:[f.jsx("i",{className:"fas fa-terminal mr-1"})," AI  "]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:()=>st(U.id,L[U.id]||""),className:"text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-2 py-1 rounded border border-indigo-500 transition-colors shadow-sm",children:[f.jsx("i",{className:"fas fa-expand-arrows-alt mr-1"}),"  "]}),f.jsx("button",{onClick:()=>{Ee(U.id,N[U.id]||"background"),h("   .","success")},className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors",title:"    ",children:f.jsx("i",{className:"fas fa-sync-alt"})})]})]}),f.jsx("textarea",{value:L[U.id]||"",onChange:re=>P(Pe=>({...Pe,[U.id]:re.target.value})),onDoubleClick:()=>st(U.id,L[U.id]||""),placeholder:"       .",className:"w-full h-24 bg-black/30 border border-slate-600 rounded-lg p-3 text-xs text-slate-300 font-mono focus:ring-1 focus:ring-green-500 focus:border-green-500 resize-none leading-relaxed cursor-text"})]}),f.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 p-4 rounded-lg mt-auto",children:[f.jsxs("label",{className:"text-sm font-bold text-red-400 block mb-2",children:[f.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),"    (  )"]}),f.jsx("input",{type:"text",value:_[U.id]||"",onChange:re=>z(Pe=>({...Pe,[U.id]:re.target.value})),placeholder:":   ,  ,  ",className:"w-full bg-slate-900 border border-red-500/50 rounded-lg px-4 py-3 text-white focus:border-red-500 focus:ring-1 focus:ring-red-500 placeholder-slate-500"})]}),f.jsxs("button",{onClick:()=>B(U.id),disabled:w[U.id]||v,className:`w-full py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all ${N[U.id]&&N[U.id]!=="background"?"bg-indigo-600 hover:bg-indigo-500 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-200"}`,children:[w[U.id]?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-magic"}),U.generatedImageUrl?"   ":"  (Generate)"]})]})]})})]},U.id)})}),f.jsx("div",{ref:ie})]})},sN=()=>{var vt;const{script:t,characters:e,referenceImages:n,apiKey:r,selectedStyle:o,globalAspectRatio:i,showToast:s,props:a,scriptSegments:u,globalScenePrompt:d,openModal:h}=gn(),[m,p]=se.useState("ALL"),[g,E]=se.useState("auto"),[x,w]=se.useState("auto"),[y,v]=se.useState(!1),S=se.useRef(null),N=se.useRef(null),I=se.useRef(null),L=()=>{var b;return(b=S.current)==null?void 0:b.scrollIntoView({behavior:"smooth"})},P=()=>{var b;return(b=N.current)==null?void 0:b.scrollIntoView({behavior:"smooth"})},[D,M]=se.useState([]),[j,Q]=se.useState({}),[_,z]=se.useState(null),[C,Y]=se.useState([]),[he,J]=se.useState([]),[te,H]=se.useState(!1),[ie,F]=se.useState("16:9"),[R,de]=se.useState(null),[ge,ae]=se.useState(!1),[_e,ze]=se.useState(null),[Ee,Ne]=se.useState(!1),[Ie,Re]=se.useState(null),[st,qe]=se.useState(!1),[T,V]=se.useState(null),[$,k]=se.useState(!1),[A,B]=se.useState(""),[ne,oe]=se.useState([]);se.useEffect(()=>{(async()=>{if(typeof window<"u"){const K=localStorage.getItem("bangtong-favorite-fonts");if(K)try{oe(JSON.parse(K))}catch{}const le=localStorage.getItem("bangtong-opening-sequence");if(le)try{const Z=JSON.parse(le);Array.isArray(Z)&&Z.length>0&&(await Ir("bangtong-opening-sequence",Z),M(Z)),localStorage.removeItem("bangtong-opening-sequence")}catch{}else{const Z=await ji("bangtong-opening-sequence");Z&&M(Z)}const pe=localStorage.getItem("bangtong-hooking-texts");if(pe)try{const Z=JSON.parse(pe);Array.isArray(Z)&&Z.length>0&&(await Ir("bangtong-hooking-texts",Z),Y(Z)),localStorage.removeItem("bangtong-hooking-texts")}catch{}else{const Z=await ji("bangtong-hooking-texts");Z&&Y(Z)}const q=await ji("bangtong-thumbnail-data");q&&(q.characters&&Array.isArray(q.characters)?de(q):(console.log("Old thumbnail data format detected. Clearing."),await zi("bangtong-thumbnail-data"),de(null)))}})()},[]),se.useEffect(()=>{D.length>0&&Ir("bangtong-opening-sequence",D)},[D]),se.useEffect(()=>{C.length>0&&Ir("bangtong-hooking-texts",C)},[C]),se.useEffect(()=>{R&&Ir("bangtong-thumbnail-data",R)},[R]);const W=async()=>{window.confirm(`   ?
(  .)`)&&(M([]),await zi("bangtong-opening-sequence"),localStorage.removeItem("bangtong-opening-sequence"),s("  .","success"))},[ue,ve]=se.useState([{name:" ()",value:"sans-serif"},{name:" ()",value:"serif"},{name:"",value:"Gungsuh, serif"},{name:"",value:"Gulim, sans-serif"},{name:"",value:"Dotum, sans-serif"},{name:"Impact ( )",value:"Impact, sans-serif"},{name:"Arial Black",value:'"Arial Black", sans-serif'},{name:"",value:'"Nanum Gothic", sans-serif'},{name:"",value:'"Nanum Myeongjo", serif'},{name:" ",value:'"BM DoHyeon", sans-serif'},{name:" ",value:'"BM Jua", sans-serif'}]),fe=async()=>{if(!("queryLocalFonts"in window)){s("      . (Chrome/Edge  )","error");return}k(!0);try{const b=await window.queryLocalFonts(),K=new Set,le=[];for(const pe of b){const q=pe.fullName||pe.family;K.has(q)||(K.add(q),le.push({name:q,value:`"${pe.family}", sans-serif`}))}le.sort((pe,q)=>pe.name.localeCompare(q.name,"ko")),ve(pe=>{const q=new Set(pe.map(xe=>xe.name)),Z=le.filter(xe=>!q.has(xe.name));return[...pe,...Z]}),s(`${le.length}   !`,"success")}catch(b){console.error(b),s("   . ( )","error")}finally{k(!1)}},Se=b=>{oe(K=>{let le;return K.includes(b)?le=K.filter(pe=>pe!==b):le=[...K,b],localStorage.setItem("bangtong-favorite-fonts",JSON.stringify(le)),le})},Ue=async b=>{var K;if(!t)return s(" .","warning");if(!r)return s("API  .","warning");ae(!0);try{const le=await BC(r,t,e,g,b),pe=le.characters.map(xe=>{const He=e.find(Be=>Be.name===xe.name);return{...xe,appearance:He?He.description:""}}),q=[{name:" ()",value:"sans-serif"},{name:" ()",value:"serif"},{name:"",value:"Gungsuh, serif"},{name:"",value:"Gulim, sans-serif"},{name:"",value:"Dotum, sans-serif"},{name:"Impact ( )",value:"Impact, sans-serif"},{name:"Arial Black",value:'"Arial Black", sans-serif'},{name:"",value:'"Nanum Gothic", sans-serif'},{name:"",value:'"Nanum Myeongjo", serif'},{name:" ",value:'"BM DoHyeon", sans-serif'},{name:" ",value:'"BM Jua", sans-serif'}],Z=b?[{id:"line-1",text:b,color:"#FFFFFF",size:48,x:10,y:50,fontFamily:"sans-serif",fontWeight:"900",outlineColor:"#000000",outlineWidth:8,heightScale:1}]:[{id:"line-1",text:le.title,color:"#FFFFFF",size:48,x:10,y:50,fontFamily:"sans-serif",fontWeight:"900",outlineColor:"#000000",outlineWidth:8,heightScale:1}];de({title:le.title,composition:(K=le.composition)!=null&&K.toLowerCase().includes("right")?"right":"center",action:le.action,characters:pe,textLines:Z,gradientDirection:"left-to-right",gradientPosition:40,negativeSpaceRatio:40}),s("  !","success")}catch(le){s(le.message,"error")}finally{ae(!1)}},Me=(b,K)=>{de(le=>le?{...le,[b]:K}:null)},Xe=b=>{const K=e.find(le=>le.id===b);!K||!R||de(le=>le?le.characters.some(pe=>pe.name===K.name)?le:{...le,characters:[...le.characters,{name:K.name,action:"Standing",appearance:K.description}]}:null)},Kt=(b,K,le)=>{de(pe=>{if(!pe)return null;const q=[...pe.characters];return q[b]={...q[b],[K]:le},{...pe,characters:q}})},yt=b=>{de(K=>{if(!K)return null;const le=K.characters.filter((pe,q)=>q!==b);return{...K,characters:le}})},Jt=b=>{if(!R)return;const K=R.characters[b];h({type:"textarea",title:`${K.name}  `,message:`${K.name}   .
(/    )`,defaultValue:K.appearance||"",onConfirm:le=>Kt(b,"appearance",le||""),confirmText:"",showCopyButton:!0})},Ke=async()=>{if(R){ae(!0);try{const b=R.characters.map(Be=>{const tt=e.find(Ct=>Ct.name===Be.name);if(!tt||!tt.referenceImageId)return null;const Rt=n.find(Ct=>Ct.id===tt.referenceImageId);return Rt?{name:Be.name,imageUrl:Rt.imageUrl}:null}).filter(Be=>Be!==null),K=b.map(Be=>Be.imageUrl),le=b.map(Be=>Be.name),pe=R.characters.map(Be=>` CHARACTER: ${Be.name}
  - ACTION: ${Be.action}
  - APPEARANCE: ${Be.appearance||"(Follow Reference Image)"}`).join(`
`),q=R.composition||"center";let Z="";q==="right"?Z=`
        [YOUTUBE THUMBNAIL COMPOSITION - RIGHT SIDE FOCUS]
        - **RULE OF THIRDS**: The main character MUST be positioned on the **RIGHT SIDE** (Right 1/3) of the screen.
        - **BACKGROUND**: The left side should feature a detailed, cinematic background relevant to the scene. **DO NOT LEAVE IT EMPTY/BLACK**. Fill it with environment/scenery.
        - **FACE POSITION**: The character's face must be located in the **RIGHT THIRD** of the image.
        - **CAMERA**: Wide shot or Medium shot allowing space on the left for text (but filled with background details).
            `:Z=`
        [YOUTUBE THUMBNAIL COMPOSITION - CENTER FOCUS]
        - **CENTER PLACEMENT**: The main character MUST be positioned in the **CENTER** of the screen.
        - **SYMMETRY**: Balanced composition with the character in the middle.
        - **BACKGROUND**: Detailed cinematic background filling the entire screen behind the character.
        - **FACE POSITION**: The character's face must be located in the **UPPER CENTER** of the image.
        - **CAMERA**: Medium shot or Close-up emphasizing the character.
            `;const xe=`
        ${Z}
        
        [SCENE ACTION]
        ${R.action}

        [CHARACTERS]
        ${pe}

        - **LIGHTING**: High contrast, dramatic lighting.
        - **NEGATIVE PROMPT**: **PHOTOREALISTIC**, **REALISTIC**, **3D RENDER**, **MOVIE PHOTO**, Text, Font, Letter, Alphabet, Number, Logo, UI, Watermark, Split screen, Vertical line, White line, Border, Divider, White corner, Light leak, **Dust**, **Particles**, **Noise**, **White dots**, **Stars**, **Grain**, **Specks**.
        `,He=await Cs(r,xe,o,"16:9","cinematic",K,void 0,void 0,void 0,void 0,void 0,le);de(Be=>Be?{...Be,imageUrl:He,imageHistory:[He,...Be.imageHistory||[]]}:null),s("  !","success")}catch(b){s(b.message,"error")}finally{ae(!1)}}},Xt=(b,K,le)=>{M(pe=>pe.map(q=>{if(q.id!==b)return q;let Z=[...q.propIds||[]];return le==="add"?Z.includes(K)||Z.push(K):Z=Z.filter(xe=>xe!==K),{...q,propIds:Z}}))},U=(b,K,le)=>{M(pe=>pe.map(q=>{if(q.id!==b)return q;let Z=[...q.characterIds||[]];return le==="add"?Z.includes(K)||Z.push(K):Z=Z.filter(xe=>xe!==K),{...q,characterIds:Z}}))},ce=(b,K)=>{M(le=>le.map(pe=>pe.id===b?{...pe,visualPrompt:K}:pe))},ee=(b,K)=>{M(le=>le.map(pe=>pe.id===b?{...pe,generatedImageUrl:K}:pe)),s(" .","success")},G=b=>{z(b),I.current&&(I.current.value="",I.current.click())},O=b=>{var pe;const K=(pe=b.target.files)==null?void 0:pe[0];if(!K||!_)return;if(K.size>5*1024*1024){s("   5MB  .","warning");return}const le=new FileReader;le.onload=async q=>{var xe;const Z=(xe=q.target)==null?void 0:xe.result;if(Z&&(M(He=>He.map(Be=>{if(Be.id!==_)return Be;let tt=[...Be.imageHistory||[]];return Be.generatedImageUrl&&!tt.includes(Be.generatedImageUrl)&&tt.push(Be.generatedImageUrl),tt.includes(Z)||tt.push(Z),{...Be,generatedImageUrl:Z,imageHistory:tt}})),s(" .   ...","success"),r&&_))try{Q(Be=>({...Be,[_]:!0}));const He=D.find(Be=>Be.id===_);if(He){const Be=typeof He.videoPrompt=="string"?He.videoPrompt:JSON.stringify(He.videoPrompt,null,2),tt=await _f(r,Z,Be,He.title);M(Rt=>Rt.map(Ct=>Ct.id!==_?Ct:{...Ct,videoPrompt:tt})),s("    !","success")}}catch(He){console.error("Prompt refinement failed",He),s("  .","error")}finally{Q(He=>({...He,[_]:!1}))}},le.readAsDataURL(K),z(null)},X=async()=>{if(!t)return s(" .","warning");if(!r)return s("API  .","warning");v(!0);try{let b=t;if(typeof m<"u"&&m!=="ALL"&&typeof u<"u"){const le=u.find(pe=>pe.id===m);le&&(b=le.content)}const K=await HC(r,b,e,a,d,g);M(K),s("/  !","success")}catch(b){s(b.message,"error")}finally{v(!1)}},ye=async b=>{if(!b.generatedImageUrl)return s("  .","warning");if(!r)return s("API  .","warning");Q(K=>({...K,[b.id]:!0}));try{const K=typeof b.videoPrompt=="string"?b.videoPrompt:JSON.stringify(b.videoPrompt,null,2),le=await _f(r,b.generatedImageUrl,K,b.title);M(pe=>pe.map(q=>q.id!==b.id?q:{...q,videoPrompt:le})),s("    !","success")}catch(K){console.error("Prompt refinement failed",K),s("  .","error")}finally{Q(K=>({...K,[b.id]:!1}))}},be=async b=>{var K,le;Q(pe=>({...pe,[b.id]:!0}));try{const pe=((K=b.propIds)==null?void 0:K.map(ut=>{var xt;return(xt=a.find(Vt=>Vt.id===ut))==null?void 0:xt.imageUrl}).filter(Boolean))||[],q=((le=b.characterIds)==null?void 0:le.map(ut=>{const xt=e.find(Cr=>Cr.id===ut);if(!xt||!xt.referenceImageId)return null;const Vt=n.find(Cr=>Cr.id===xt.referenceImageId);return Vt?{name:xt.name,imageUrl:Vt.imageUrl,description:Vt.description}:null}).filter(ut=>ut!==null))||[],Z=q.map(ut=>ut.imageUrl),xe=q.map(ut=>ut.name),He=q.map(ut=>` CHARACTER: ${ut.name}
  - BASE APPEARANCE: ${ut.description}`).join(`
`),Be=`
        [GLOBAL PRODUCTION RULES]
        ${d||""}
        
        [CHARACTER REFERENCE]
        ${He}
        (NOTE: Follow the Base Appearance, unless the Scene Action explicitly describes a different age or state like 'Young', 'Childhood', etc.)
        
        [SCENE ACTION & CAMERA]
        ${b.visualPrompt}
      `,tt=D.find(ut=>ut.sequenceNumber===b.sequenceNumber-1),Rt=tt==null?void 0:tt.generatedImageUrl,Ct=await Cs(r,Be,o,i,"cinematic",Z,void 0,void 0,pe,void 0,Rt,xe);M(ut=>ut.map(xt=>{if(xt.id!==b.id)return xt;let Vt=[...xt.imageHistory||[]];return xt.generatedImageUrl&&!Vt.includes(xt.generatedImageUrl)&&Vt.push(xt.generatedImageUrl),Vt.includes(Ct)||Vt.push(Ct),{...xt,generatedImageUrl:Ct,imageHistory:Vt}})),s(`${b.sequenceNumber}   `,"success")}catch(pe){s(pe.message,"error")}finally{Q(pe=>({...pe,[b.id]:!1}))}},Ce=(b,K)=>{const le=document.createElement("a");le.href=b,le.download=K,le.click()},Le=async()=>{if(!(!R||!R.imageUrl)){s("   ...","info");try{const K=await(await fetch(R.imageUrl)).blob(),le=await createImageBitmap(K),pe=document.createElement("canvas");pe.width=le.width,pe.height=le.height;const q=pe.getContext("2d");if(!q)throw new Error("Canvas context creation failed");if(q.drawImage(le,0,0),R.enableGradient&&R.gradientDirection){const Z=R.gradientDirection,xe=R.gradientPosition||40;let He;Z==="left-to-right"?(He=q.createLinearGradient(0,0,pe.width,0),He.addColorStop(0,"rgba(0,0,0,1)"),He.addColorStop(xe/100,"rgba(0,0,0,0)")):(He=q.createLinearGradient(0,pe.height,0,0),He.addColorStop(0,"rgba(0,0,0,1)"),He.addColorStop(xe/100,"rgba(0,0,0,0)")),q.fillStyle=He,q.fillRect(0,0,pe.width,pe.height)}R.textLines&&R.textLines.forEach(Z=>{const xe=pe.width*(Z.size/1e3),He=Z.fontFamily?Z.fontFamily.split(",")[0].replace(/['"]/g,""):"sans-serif",Be=Z.fontWeight||"900";q.font=`${Be} ${xe}px "${He}", sans-serif`,q.fillStyle=Z.color,q.textBaseline="middle",q.lineWidth=xe*((Z.outlineWidth??8)/100),q.strokeStyle=Z.outlineColor||"black",q.lineJoin="round",q.lineCap="round";const tt=pe.width*(Z.x/100),Rt=pe.height*(Z.y/100),Ct=Z.text.split(`
`),ut=xe*1.1,xt=Ct.length*ut;q.save(),q.translate(tt,Rt),q.scale(1,Z.heightScale||1);const Vt=-(xt/2)+ut/2;Ct.forEach((Cr,jm)=>{const Fu=Vt+jm*ut;q.strokeText(Cr,0,Fu),q.fillText(Cr,0,Fu)}),q.restore()}),pe.toBlob(Z=>{if(Z){const xe=URL.createObjectURL(Z),He=document.createElement("a");He.href=xe,He.download=`thumbnail_complete_${Date.now()}.png`,He.click(),URL.revokeObjectURL(xe),s("   .","success")}},"image/png")}catch(b){console.error("Thumbnail composite failed",b),s("   .","error"),Ce(R.imageUrl,"thumbnail_raw.png")}}},Fe=async()=>{const b=D.filter(pe=>pe.generatedImageUrl);if(b.length===0)return s("   .","warning");const K=new kl;let le=0;s(`${b.length}   ...`,"success");try{const pe=b.map(async q=>{if(q.generatedImageUrl)try{const xe=`${q.sequenceNumber.toString().padStart(2,"0")}_Opening_${q.sequenceNumber}.png`,Be=await(await fetch(q.generatedImageUrl)).blob();K.file(xe,Be),le++}catch(Z){console.error(`Failed to fetch image for shot ${q.sequenceNumber}`,Z)}});if(await Promise.all(pe),le>0){const q=await K.generateAsync({type:"blob"});qi.saveAs(q,"Bangtong_Opening.zip"),s("   .","success")}else s("   .","error")}catch(pe){console.error("Zip generation failed",pe),s("     .","error")}},Ae=async()=>{const b=D.filter(le=>le.videoPrompt);if(b.length===0)return s("   .","warning");const K=new kl;b.forEach(le=>{const q=`${le.sequenceNumber.toString().padStart(2,"0")}_GrokPrompt_${le.sequenceNumber}.txt`,Z=typeof le.videoPrompt=="string"?le.videoPrompt:JSON.stringify(le.videoPrompt,null,2);K.file(q,Z||"")});try{const le=await K.generateAsync({type:"blob"});qi.saveAs(le,"Bangtong_GrokPrompts.zip"),s("   .","success")}catch(le){console.error("Zip generation failed",le),s("     .","error")}},re=async b=>{Q(K=>({...K,[b.id]:!0}));try{const K=await KC(r,b.title,b.visualPrompt);M(le=>le.map(pe=>pe.id===b.id?{...pe,trailerCaption:K}:pe)),s("  !","success")}catch(K){s(K.message,"error")}finally{Q(K=>({...K,[b.id]:!1}))}},Pe=async()=>{if(!t)return s(" .","warning");if(!r)return s("API  .","warning");H(!0),J([]);try{const b=await YC(r,t);Y(b),s(`  ${b.length} !`,"success")}catch(b){s(b.message,"error")}finally{H(!1)}},Ve=b=>{J(K=>K.includes(b)?K.filter(le=>le!==b):[...K,b])},De=()=>{if(he.length===0)return s("  .","warning");const b=he.join(`
`),K=new Blob([b],{type:"text/plain;charset=utf-8"});qi.saveAs(K,"selected_hooking_texts.txt"),s(`${he.length}    .`,"success")},Ge=async()=>{if(D.length===0)return s("   .","warning");if(!r)return s("API  .","warning");Ne(!0);try{const b=await JC(r,D,g,x);ze(b),s("Suno  !","success")}catch(b){s(b.message,"error")}finally{Ne(!1)}},ke=b=>{navigator.clipboard.writeText(b),s("!","success")},lt=b=>{h({type:"textarea",title:"  ",message:"  . (   )",defaultValue:b.visualPrompt,onConfirm:K=>ce(b.id,K||""),confirmText:"",showCopyButton:!0})};return f.jsxs("div",{className:"space-y-8 animate-fade-in pb-20 relative",children:[f.jsx("div",{ref:S}),f.jsx("input",{type:"file",ref:I,onChange:O,className:"hidden",accept:"image/*"}),f.jsxs("div",{className:"fixed left-6 bottom-20 flex flex-col gap-2 z-50",children:[f.jsx("button",{onClick:L,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:f.jsx("i",{className:"fas fa-arrow-up"})}),f.jsx("button",{onClick:P,className:"bg-slate-700/80 hover:bg-indigo-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm border border-slate-600 transition-all",title:" ",children:f.jsx("i",{className:"fas fa-arrow-down"})})]}),f.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center bg-slate-800 p-8 rounded-2xl border border-slate-700 shadow-xl relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500"}),f.jsxs("div",{className:"z-10 mb-4 md:mb-0",children:[f.jsxs("h2",{className:"text-3xl font-extrabold text-white mb-2 flex items-center gap-3",children:[f.jsx("i",{className:"fas fa-film text-red-500"}),"  (  )"]}),f.jsxs("p",{className:"text-slate-400 mb-4",children:["   ",f.jsx("span",{className:"text-red-400 font-bold",children:"10 (Hooking) "})," ."]}),f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700 w-fit",children:[f.jsx("span",{className:"text-xs font-bold text-slate-400 px-2",children:" :"}),f.jsxs("select",{value:m,onChange:b=>p(b.target.value),className:"bg-slate-800 text-white text-sm border border-slate-600 rounded px-3 py-1.5 focus:ring-2 focus:ring-red-500 outline-none",children:[f.jsx("option",{value:"ALL",children:"  (AI  )"}),u.map((b,K)=>f.jsxs("option",{value:b.id,children:[K+1,". ",b.title]},b.id))]})]}),f.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700 w-fit",children:[f.jsx("span",{className:"text-xs font-bold text-slate-400 px-2",children:" :"}),f.jsxs("select",{value:g,onChange:b=>E(b.target.value),className:"bg-slate-800 text-white text-sm border border-slate-600 rounded px-3 py-1.5 focus:ring-2 focus:ring-red-500 outline-none min-w-[150px]",children:[f.jsx("option",{value:"auto",children:" AI  ( )"}),f.jsx("option",{value:"mystery",children:" /"}),f.jsx("option",{value:"comedy",children:" / (B )"}),f.jsx("option",{value:"destiny",children:"   ( )"}),f.jsx("option",{value:"tragedy",children:"  / ()"}),f.jsx("option",{value:"revenge",children:" / ()"}),f.jsx("option",{value:"despair",children:"  /"})]})]})]})]}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("button",{onClick:W,className:"bg-slate-700 hover:bg-slate-600 text-slate-300 hover:text-white px-4 py-4 rounded-full font-bold text-lg shadow-lg transition-all",title:" ",children:f.jsx("i",{className:"fas fa-trash-alt"})}),f.jsx("button",{onClick:Fe,className:"bg-green-700 hover:bg-green-600 text-slate-200 hover:text-white px-4 py-4 rounded-full font-bold text-lg shadow-lg transition-all",title:"   (ZIP)",children:f.jsx("i",{className:"fas fa-download"})}),f.jsx("button",{onClick:Ae,className:"bg-teal-700 hover:bg-teal-600 text-slate-200 hover:text-white px-4 py-4 rounded-full font-bold text-lg shadow-lg transition-all",title:"   (ZIP)",children:f.jsx("i",{className:"fas fa-file-code"})}),f.jsxs("button",{onClick:X,disabled:y,className:"bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-500 hover:to-orange-500 text-white px-8 py-4 rounded-full font-bold text-lg shadow-lg shadow-red-900/50 flex items-center gap-3 transition-all transform hover:scale-105",children:[y?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-magic"}),"   (AI)"]})]})]}),D.length>0&&f.jsxs("div",{className:"space-y-0",children:[D.map((b,K)=>{var le,pe;return f.jsxs("div",{className:"relative pl-8 md:pl-12 py-6 group",children:[f.jsx("div",{className:"absolute left-4 md:left-6 top-0 bottom-0 w-0.5 bg-slate-700 group-last:bottom-auto group-last:h-1/2"}),f.jsx("div",{className:"absolute left-2 md:left-4 top-12 w-4 h-4 md:w-5 md:h-5 rounded-full bg-slate-900 border-4 border-indigo-500 z-10 shadow-lg shadow-indigo-500/50"}),f.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-700 overflow-hidden hover:border-indigo-500 transition-colors",children:[f.jsxs("div",{className:"flex flex-col md:flex-row",children:[f.jsxs("div",{className:"w-full md:w-3/4 bg-black relative min-h-[500px] flex items-center justify-center border-r border-slate-800",children:[b.generatedImageUrl?f.jsx("img",{src:b.generatedImageUrl,alt:b.title,className:"w-full h-full object-cover"}):f.jsxs("div",{className:"text-center p-6",children:[f.jsx("i",{className:"fas fa-clapperboard text-4xl text-slate-700 mb-3"}),f.jsx("p",{className:"text-slate-500 text-sm",children:"  "})]}),f.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-3",children:[f.jsxs("button",{onClick:()=>be(b),disabled:j[b.id],className:"bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-2 rounded-full font-bold shadow-lg flex items-center gap-2",children:[j[b.id]?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-paint-brush"}),b.generatedImageUrl?"  ":" "]}),b.generatedImageUrl&&f.jsxs("button",{onClick:()=>ye(b),disabled:j[b.id],className:"bg-purple-600 hover:bg-purple-500 text-white px-6 py-2 rounded-full font-bold shadow-lg flex items-center gap-2",title:"      (   )",children:[f.jsx("i",{className:"fas fa-magic"}),"   ()"]}),f.jsxs("button",{onClick:()=>G(b.id),className:"bg-slate-600 hover:bg-slate-500 text-white px-6 py-2 rounded-full font-bold shadow-lg flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-upload"}),"  "]}),b.generatedImageUrl&&f.jsx("button",{onClick:()=>Re(b.generatedImageUrl),className:"bg-slate-700/80 hover:bg-slate-600 text-white p-3 rounded-full font-bold shadow-lg backdrop-blur-sm transition-transform hover:scale-110",title:" ",children:f.jsx("i",{className:"fas fa-search-plus"})}),b.generatedImageUrl&&f.jsxs("button",{onClick:()=>Ce(b.generatedImageUrl,`opening_shot_${b.sequenceNumber}.png`),className:"bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-full font-bold shadow-lg flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-download"})," "]})]})]}),f.jsx("div",{className:"w-full md:w-1/4 p-4 flex flex-col justify-between overflow-y-auto h-[500px] scrollbar-thin",children:f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center justify-between mb-3",children:[f.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[f.jsxs("span",{className:"text-indigo-400",children:["#",b.sequenceNumber]})," ",b.title]}),K<D.length-1&&f.jsxs("span",{className:"text-xs bg-slate-800 text-slate-400 px-2 py-1 rounded border border-slate-700",children:["   ",f.jsx("i",{className:"fas fa-arrow-down ml-1"})]})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-1",children:[f.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase",children:[f.jsx("i",{className:"fas fa-image mr-1"}),"    ()"]}),f.jsxs("button",{onClick:()=>lt(b),className:"text-xs text-indigo-400 hover:text-white",children:[f.jsx("i",{className:"fas fa-expand-alt"}),"  "]})]}),f.jsx("textarea",{value:b.visualPrompt,onChange:q=>ce(b.id,q.target.value),className:"w-full bg-slate-900 text-sm text-slate-300 border border-slate-600 rounded p-2 h-20 focus:ring-2 focus:ring-indigo-500 outline-none resize-none"})]}),f.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("p",{className:"text-xs font-bold text-green-500 uppercase",children:[f.jsx("i",{className:"fas fa-user mr-1"}),"   (Casting)"]}),f.jsxs("select",{className:"bg-slate-900 text-xs text-slate-300 border border-slate-600 rounded px-2 py-1 max-w-[120px]",onChange:q=>{q.target.value&&U(b.id,q.target.value,"add"),q.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),e&&e.map(q=>f.jsx("option",{value:q.id,children:q.name},q.id))]})]}),f.jsxs("div",{className:"flex gap-2 flex-wrap min-h-[24px]",children:[(le=b.characterIds)==null?void 0:le.map(q=>{const Z=e==null?void 0:e.find(xe=>xe.id===q);return Z?f.jsxs("div",{className:"bg-green-900/50 text-green-200 border border-green-700/50 text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[f.jsx("span",{children:Z.name}),f.jsx("button",{onClick:()=>U(b.id,q,"remove"),className:"hover:text-green-100",children:f.jsx("i",{className:"fas fa-times"})})]},q):null}),(!b.characterIds||b.characterIds.length===0)&&f.jsx("span",{className:"text-xs text-slate-600",children:"  "})]})]}),f.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("p",{className:"text-xs font-bold text-amber-500 uppercase",children:[f.jsx("i",{className:"fas fa-cube mr-1"}),"   (Props)"]}),f.jsxs("select",{className:"bg-slate-900 text-xs text-slate-300 border border-slate-600 rounded px-2 py-1 max-w-[120px]",onChange:q=>{q.target.value&&Xt(b.id,q.target.value,"add"),q.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),a&&a.map(q=>f.jsx("option",{value:q.id,children:q.name},q.id))]})]}),f.jsxs("div",{className:"flex gap-2 flex-wrap min-h-[24px]",children:[(pe=b.propIds)==null?void 0:pe.map(q=>{const Z=a==null?void 0:a.find(xe=>xe.id===q);return Z?f.jsxs("div",{className:"bg-amber-900/50 text-amber-200 border border-amber-700/50 text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[f.jsx("span",{children:Z.name}),f.jsx("button",{onClick:()=>Xt(b.id,q,"remove"),className:"hover:text-red-300",children:f.jsx("i",{className:"fas fa-times"})})]},q):null}),(!b.propIds||b.propIds.length===0)&&f.jsx("span",{className:"text-xs text-slate-600",children:"  "})]})]}),f.jsxs("div",{className:"bg-indigo-900/20 p-3 rounded-lg border border-indigo-500/30",children:[f.jsxs("div",{className:"flex justify-between items-center mb-1",children:[f.jsx("div",{className:"flex items-center gap-2",children:f.jsxs("p",{className:"text-xs font-bold text-indigo-300 uppercase",children:[f.jsx("i",{className:"fas fa-video mr-1"}),"   (Grok/Whisk)"]})}),f.jsx("div",{className:"flex gap-2",children:f.jsxs("button",{onClick:()=>{const q=typeof b.videoPrompt=="object"?JSON.stringify(b.videoPrompt,null,2):b.videoPrompt;navigator.clipboard.writeText(q),s(" ","success")},className:"text-xs text-indigo-400 hover:text-white",children:[f.jsx("i",{className:"fas fa-copy"})," "]})})]}),f.jsx("div",{className:"text-[11px] text-indigo-100 font-sans bg-black/30 p-3 rounded overflow-y-auto whitespace-pre-wrap max-h-[150px] leading-relaxed",children:typeof b.videoPrompt=="object"?JSON.stringify(b.videoPrompt,null,2):b.videoPrompt}),f.jsx("p",{className:"text-[10px] text-indigo-400/70 mt-2",children:"* Grok, Google Vids  ' '      ."})]}),f.jsxs("div",{className:"bg-purple-900/20 p-3 rounded-lg border border-purple-500/30",children:[f.jsx("div",{className:"flex justify-between items-center mb-2",children:f.jsxs("p",{className:"text-xs font-bold text-purple-300 uppercase",children:[f.jsx("i",{className:"fas fa-closed-captioning mr-1"}),"   (Trailer Caption)"]})}),f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsxs("button",{onClick:()=>re(b),disabled:j[b.id],className:"bg-purple-600 hover:bg-purple-500 text-white text-xs px-3 py-2 rounded-lg font-bold shadow-lg flex items-center justify-center gap-2 transition-colors w-full",children:[j[b.id]?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-magic"}),"  (AI)"]}),b.trailerCaption&&f.jsxs("div",{className:"bg-slate-900/80 p-2 rounded border border-purple-500/50 flex justify-between items-center gap-2",children:[f.jsxs("span",{className:"text-sm text-white font-serif italic",children:['"',b.trailerCaption,'"']}),f.jsx("button",{onClick:()=>{navigator.clipboard.writeText(b.trailerCaption||""),s("","success")},className:"text-purple-400 hover:text-white shrink-0",title:"",children:f.jsx("i",{className:"fas fa-copy"})})]})]})]})]})]})})]}),b.imageHistory&&b.imageHistory.length>0&&f.jsxs("div",{className:"w-full bg-slate-950/50 border-t border-slate-800 p-3",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx("i",{className:"fas fa-history text-slate-500 text-xs"}),f.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase",children:[" (",b.imageHistory.length,")"]})]}),f.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent",children:b.imageHistory.map((q,Z)=>f.jsxs("div",{onClick:()=>ee(b.id,q),className:`relative w-20 h-20 shrink-0 rounded-lg overflow-hidden cursor-pointer border-2 transition-all group/hist ${b.generatedImageUrl===q?"border-indigo-500 opacity-100 ring-2 ring-indigo-500/50":"border-slate-700 opacity-60 hover:opacity-100 hover:border-slate-500"}`,children:[f.jsx("img",{src:q,alt:`History ${Z}`,className:"w-full h-full object-cover"}),b.generatedImageUrl===q&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-indigo-900/40 backdrop-blur-[1px]",children:f.jsx("i",{className:"fas fa-check-circle text-white text-xl shadow-sm"})}),f.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover/hist:bg-black/20 transition-colors"})]},Z))})]})]})]},b.id)}),f.jsx("div",{className:"pl-8 md:pl-12 pb-8",children:f.jsx("div",{className:"bg-slate-800/50 border border-slate-700 border-dashed rounded-xl p-4 text-center",children:f.jsxs("p",{className:"text-slate-400 text-sm",children:[f.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"})," 10   (Cliffhanger).      ."]})})}),f.jsx("div",{className:"pl-8 md:pl-12 pb-8",children:f.jsxs("div",{className:"bg-gradient-to-r from-slate-900 to-slate-800 rounded-xl border border-slate-700 p-6 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-blue-500"}),f.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4",children:[f.jsxs("div",{children:[f.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-music text-blue-400"}),"    (Suno AI)"]}),f.jsxs("p",{className:"text-slate-400 text-sm mt-1 mb-3",children:[" (",g,")    ",f.jsx("span",{className:"text-blue-300",children:"  "})," ."]}),f.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700 w-fit",children:[f.jsx("span",{className:"text-xs font-bold text-slate-400 px-2",children:" :"}),f.jsxs("select",{value:x,onChange:b=>w(b.target.value),className:"bg-slate-800 text-white text-sm border border-slate-600 rounded px-3 py-1.5 focus:ring-2 focus:ring-blue-500 outline-none min-w-[150px]",children:[f.jsx("option",{value:"auto",children:"   ()"}),f.jsx("option",{value:"fast_exciting",children:" / ()"}),f.jsx("option",{value:"sad_sorrowful",children:" / ()"}),f.jsx("option",{value:"faint_hazy",children:" / ()"}),f.jsx("option",{value:"slow_mystery",children:" / ()"}),f.jsx("option",{value:"medium_story",children:" / ()"}),f.jsx("option",{value:"grand_epic",children:" / ()"})]})]})]}),f.jsxs("div",{className:"flex gap-2",children:[_e&&f.jsx("button",{onClick:()=>{confirm("  ?")&&ze(null)},className:"bg-red-900/50 hover:bg-red-800 text-red-200 px-4 py-2.5 rounded-lg font-bold shadow-lg transition-all whitespace-nowrap border border-red-700/50",title:" ",children:f.jsx("i",{className:"fas fa-trash-alt"})}),f.jsxs("button",{onClick:Ge,disabled:Ee,className:"bg-blue-600 hover:bg-blue-500 text-white px-5 py-2.5 rounded-lg font-bold shadow-lg flex items-center gap-2 transition-all whitespace-nowrap",children:[Ee?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-microphone-alt"}),_e?"  ":"Suno  "]})]})]}),_e&&f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-slate-950/50 rounded-lg p-6 border border-slate-800",children:[f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Song Title"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("input",{readOnly:!0,value:_e.title,className:"bg-slate-900 text-white text-lg font-bold border border-slate-700 rounded px-3 py-2 w-full focus:ring-1 focus:ring-blue-500 outline-none"}),f.jsx("button",{onClick:()=>ke(_e.title),className:"bg-slate-800 hover:bg-slate-700 text-slate-300 p-3 rounded border border-slate-700",children:f.jsx("i",{className:"fas fa-copy"})})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Style of Music (English - Recommended)"}),f.jsxs("div",{className:"relative",children:[f.jsx("textarea",{readOnly:!0,value:_e.style_en,className:"bg-slate-900 text-blue-300 text-sm border border-slate-700 rounded p-3 w-full h-20 resize-none focus:ring-1 focus:ring-blue-500 outline-none"}),f.jsx("button",{onClick:()=>ke(_e.style_en),className:"absolute top-2 right-2 text-slate-500 hover:text-white bg-slate-800/80 p-1.5 rounded",children:f.jsx("i",{className:"fas fa-copy"})})]}),f.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"* Suno    ."})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Style of Music (Korean - Experimental)"}),f.jsxs("div",{className:"relative",children:[f.jsx("textarea",{readOnly:!0,value:_e.style_ko,className:"bg-slate-900 text-green-300 text-sm border border-slate-700 rounded p-3 w-full h-20 resize-none focus:ring-1 focus:ring-green-500 outline-none"}),f.jsx("button",{onClick:()=>ke(_e.style_ko),className:"absolute top-2 right-2 text-slate-500 hover:text-white bg-slate-800/80 p-1.5 rounded",children:f.jsx("i",{className:"fas fa-copy"})})]}),f.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"*  . (     )"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Lyrics (~40s)"}),f.jsxs("div",{className:"relative",children:[f.jsx("textarea",{readOnly:!0,value:_e.lyrics,className:"bg-slate-900 text-slate-300 text-sm border border-slate-700 rounded p-3 w-full h-48 resize-none focus:ring-1 focus:ring-blue-500 outline-none font-mono leading-relaxed"}),f.jsx("button",{onClick:()=>ke(_e.lyrics),className:"absolute top-2 right-2 text-slate-500 hover:text-white bg-slate-800/80 p-1.5 rounded",children:f.jsx("i",{className:"fas fa-copy"})})]}),f.jsx("p",{className:"text-xs text-slate-500 mt-1",children:'* Suno "Lyrics"  .'})]})]})]})})]}),D.length===0&&!y&&f.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-slate-600",children:[f.jsx("i",{className:"fas fa-film text-6xl mb-4 opacity-20"}),f.jsx("p",{className:"text-lg",children:"    ."})]}),f.jsxs("div",{className:"border-t border-slate-700 pt-10 mt-10",children:[f.jsx("div",{className:"bg-slate-900 rounded-xl p-6 border border-slate-700 mb-10",children:f.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[f.jsxs("div",{className:"w-full md:w-1/4 space-y-4",children:[f.jsxs("h4",{className:"text-lg font-bold text-white flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-image text-purple-400"}),"  "]}),R?f.jsxs("div",{className:"space-y-3 animate-fade-in",children:[f.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-600",children:[f.jsx("p",{className:"text-xs text-purple-300 font-bold mb-1",children:""}),f.jsx("p",{className:"text-white font-bold text-base leading-tight",children:R.title})]}),f.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-600",children:[f.jsxs("div",{className:"flex justify-between items-center mb-1",children:[f.jsx("p",{className:"text-xs text-slate-400 font-bold",children:"  ()"}),f.jsx("div",{className:"flex gap-2",children:f.jsxs("button",{onClick:()=>h({type:"textarea",title:"  ",message:` , ,  .
(: ,     " ", "  "    )`,defaultValue:R.action,onConfirm:b=>Me("action",b||""),confirmText:"",showCopyButton:!0}),className:"text-[10px] bg-slate-700 hover:bg-slate-600 text-slate-300 px-1.5 py-0.5 rounded border border-slate-600 flex items-center gap-1",title:"  / ",children:[f.jsx("i",{className:"fas fa-expand"}),"  "]})})]}),f.jsx("textarea",{className:"w-full bg-slate-900 text-slate-300 text-[11px] leading-relaxed p-2 rounded border border-slate-700 focus:border-purple-500 focus:outline-none resize-none h-24 scrollbar-thin scrollbar-thumb-slate-600",value:R.action,onChange:b=>Me("action",b.target.value),placeholder:"   ..."})]}),f.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-600",children:[f.jsx("div",{className:"flex justify-between items-center mb-2",children:f.jsxs("p",{className:"text-xs text-indigo-400 font-bold uppercase",children:[f.jsx("i",{className:"fas fa-crop-alt mr-1"}),"   (Composition)"]})}),f.jsxs("div",{className:"flex gap-2 mb-2",children:[f.jsxs("button",{onClick:()=>de(b=>b?{...b,composition:"center"}:null),className:`flex-1 py-2 rounded text-xs font-bold transition-all border ${!R.composition||R.composition==="center"?"bg-indigo-600 text-white border-indigo-400 shadow-[0_0_10px_rgba(99,102,241,0.5)]":"bg-slate-700 text-slate-400 border-slate-600 hover:bg-slate-600"}`,children:[f.jsx("i",{className:"fas fa-arrows-alt-h mb-1 block text-lg"}),"  ()"]}),f.jsxs("button",{onClick:()=>de(b=>b?{...b,composition:"right"}:null),className:`flex-1 py-2 rounded text-xs font-bold transition-all border ${R.composition==="right"?"bg-indigo-600 text-white border-indigo-400 shadow-[0_0_10px_rgba(99,102,241,0.5)]":"bg-slate-700 text-slate-400 border-slate-600 hover:bg-slate-600"}`,children:[f.jsx("i",{className:"fas fa-arrow-right mb-1 block text-lg"}),"  ( )"]})]}),f.jsxs("p",{className:"text-[10px] text-slate-500 text-center",children:["* ",!R.composition||R.composition==="center"?"    .":"  ,    ."]})]}),f.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-600 space-y-2",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("p",{className:"text-xs text-green-500 font-bold uppercase",children:[f.jsx("i",{className:"fas fa-users mr-1"}),"  "]}),f.jsxs("select",{className:"bg-slate-900 text-[10px] text-slate-300 border border-slate-600 rounded px-1 py-0.5 max-w-[80px]",onChange:b=>{b.target.value&&Xe(b.target.value),b.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),e&&e.map(b=>f.jsx("option",{value:b.id,children:b.name},b.id))]})]}),f.jsx("p",{className:"text-[10px] text-slate-500 leading-tight",children:"* / .  ."}),f.jsx("div",{className:"space-y-1.5 max-h-[200px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-slate-700",children:R.characters&&R.characters.map((b,K)=>f.jsxs("div",{className:"bg-slate-900 p-2 rounded border border-slate-700 relative group flex items-center justify-between",children:[f.jsxs("div",{className:"flex-1 min-w-0 mr-2",children:[f.jsxs("div",{className:"flex items-center gap-1.5",children:[f.jsx("span",{className:"text-sm font-bold text-white truncate",children:b.name}),f.jsx("span",{className:"text-[10px] text-slate-400 truncate max-w-[80px]",children:b.action})]}),f.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[f.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${b.appearance?"bg-green-500":"bg-slate-600"}`}),f.jsx("span",{className:"text-[10px] text-slate-500 truncate",children:b.appearance?" ":"  ()"})]})]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx("button",{onClick:()=>Jt(K),className:"bg-indigo-600 hover:bg-indigo-500 text-white p-1.5 rounded text-xs",title:"  ",children:f.jsx("i",{className:"fas fa-edit"})}),f.jsx("button",{onClick:()=>yt(K),className:"bg-slate-800 hover:bg-red-900/50 text-slate-500 hover:text-red-400 p-1.5 rounded text-xs",title:"",children:f.jsx("i",{className:"fas fa-times"})})]})]},K))}),(!R.characters||R.characters.length===0)&&f.jsx("p",{className:"text-[10px] text-slate-500 text-center py-2",children:" "})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:Ke,disabled:ge,className:"flex-1 bg-pink-600 hover:bg-pink-500 text-white px-3 py-2 rounded-lg font-bold shadow-lg flex items-center justify-center gap-1 text-sm",children:[ge?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-paint-brush"}),""]}),f.jsx("button",{onClick:()=>{confirm("  ?")&&(de(null),zi("bangtong-thumbnail-data"))},className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-3 py-2 rounded-lg text-sm",title:"",children:f.jsx("i",{className:"fas fa-trash-alt"})})]})]}):f.jsxs("div",{className:"space-y-2",children:[f.jsx("p",{className:"text-slate-400 text-sm",children:"     ."}),f.jsxs("button",{onClick:()=>Ue(),disabled:ge,className:"w-full bg-purple-600 hover:bg-purple-500 text-white px-4 py-3 rounded-lg font-bold shadow-lg flex items-center justify-center gap-2",children:[ge?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-brain"}),"1. "]})]})]}),f.jsxs("div",{className:"w-full md:w-3/4 flex flex-col gap-0 bg-slate-900 rounded-lg border border-slate-800 overflow-hidden",children:[f.jsx("div",{className:"w-full bg-slate-950 relative overflow-hidden group aspect-video border-2 border-slate-700 rounded-lg shadow-inner",style:{containerType:"size"},children:R!=null&&R.imageUrl?f.jsxs("div",{className:"relative w-full h-full flex items-center justify-center overflow-hidden",children:[f.jsx("img",{src:R.imageUrl,alt:"Thumbnail",className:"w-full h-full object-contain"}),R.enableGradient&&R.gradientDirection&&f.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:R.gradientDirection==="bottom-to-top"?`linear-gradient(to top, rgba(0,0,0,1) 0%, rgba(0,0,0,0) ${R.gradientPosition||40}%)`:`linear-gradient(to right, rgba(0,0,0,1) 0%, rgba(0,0,0,0) ${R.gradientPosition||40}%)`}}),R.textLines&&R.textLines.map(b=>f.jsx("div",{className:"absolute cursor-move select-none whitespace-pre-wrap leading-tight drop-shadow-[0_4px_4px_rgba(0,0,0,0.8)] hover:ring-2 hover:ring-indigo-500/50 rounded p-1 transition-shadow",style:{left:`${b.x}%`,top:`${b.y}%`,color:b.color,fontSize:`${b.size/10}cqw`,fontFamily:b.fontFamily||"sans-serif",fontWeight:b.fontWeight||"900",maxWidth:"55%",WebkitTextStroke:`${b.size/10*((b.outlineWidth??8)/100)}cqw ${b.outlineColor||"#000"}`,paintOrder:"stroke fill",transform:`translate(0, -50%) scaleY(${b.heightScale||1})`,transformOrigin:"center center"},draggable:!0,onDragEnd:K=>{},children:b.text},b.id)),f.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-3 z-20 pointer-events-none",children:f.jsxs("div",{className:"pointer-events-auto flex gap-3",children:[f.jsx("button",{onClick:()=>Re(R.imageUrl),className:"bg-slate-700 hover:bg-slate-600 text-white p-3 rounded-full",title:" ",children:f.jsx("i",{className:"fas fa-search-plus"})}),f.jsxs("button",{onClick:Le,className:"bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-full font-bold shadow-lg",title:"  ",children:[f.jsx("i",{className:"fas fa-download"})," "]})]})})]}):f.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-slate-600",children:[f.jsx("i",{className:"fas fa-image text-4xl mb-2"}),f.jsx("p",{children:"  "})]})}),(R==null?void 0:R.imageUrl)&&f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"w-full bg-slate-900 border-t border-slate-800 p-3 space-y-2",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("span",{className:"text-xs font-bold text-orange-400 uppercase",children:[f.jsx("i",{className:"fas fa-adjust mr-1"}),"  "]}),f.jsxs("div",{className:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in",children:[f.jsx("input",{type:"checkbox",name:"toggle",id:"gradient-toggle",checked:!!R.enableGradient,onChange:b=>de(K=>K?{...K,enableGradient:b.target.checked,gradientDirection:b.target.checked&&!K.gradientDirection?K.composition==="right"?"left-to-right":"bottom-to-top":K.gradientDirection}:null),className:"toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer",style:{right:R.enableGradient?"0":"50%"}}),f.jsx("label",{htmlFor:"gradient-toggle",className:`toggle-label block overflow-hidden h-5 rounded-full cursor-pointer ${R.enableGradient?"bg-orange-500":"bg-slate-700"}`})]})]}),R.enableGradient&&f.jsxs("div",{className:"bg-slate-800 p-2 rounded border border-slate-700 animate-fade-in",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx("span",{className:"text-[10px] text-slate-400 min-w-[30px]",children:""}),f.jsxs("div",{className:"flex bg-slate-900 rounded border border-slate-600 p-0.5 flex-1",children:[f.jsxs("button",{onClick:()=>de(b=>b?{...b,gradientDirection:"left-to-right"}:null),className:`flex-1 py-1 text-xs rounded flex items-center justify-center gap-1 ${R.gradientDirection==="left-to-right"?"bg-orange-600 text-white":"text-slate-400 hover:text-white"}`,title:"   (  )",children:[f.jsx("i",{className:"fas fa-arrow-right"})," "]}),f.jsxs("button",{onClick:()=>de(b=>b?{...b,gradientDirection:"bottom-to-top"}:null),className:`flex-1 py-1 text-xs rounded flex items-center justify-center gap-1 ${R.gradientDirection==="bottom-to-top"?"bg-orange-600 text-white":"text-slate-400 hover:text-white"}`,title:"   (  )",children:[f.jsx("i",{className:"fas fa-arrow-up"})," "]})]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[10px] text-slate-400 min-w-[30px]",children:""}),f.jsx("input",{type:"range",min:"0",max:"100",value:R.gradientPosition||40,onChange:b=>de(K=>K?{...K,gradientPosition:parseInt(b.target.value)}:null),className:"flex-1 accent-orange-500 h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer",title:"  "}),f.jsxs("span",{className:"text-[10px] text-orange-400 w-6 text-right",children:[R.gradientPosition||40,"%"]})]})]})]}),f.jsxs("div",{className:"w-full bg-slate-900 border-t border-slate-800 p-3 space-y-2",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("span",{className:"text-xs font-bold text-indigo-400 uppercase",children:[f.jsx("i",{className:"fas fa-layer-group mr-1"}),"  "]}),f.jsxs("button",{onClick:()=>de(b=>{var K;return b?{...b,textLines:[...b.textLines||[],{id:`line-${Date.now()}`,text:" ",color:"#FFFFFF",size:40,x:10,y:50+(((K=b.textLines)==null?void 0:K.length)||0)*10,fontFamily:"sans-serif"}]}:null}),className:"text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-2 py-1 rounded",children:[f.jsx("i",{className:"fas fa-plus"}),"  "]})]}),f.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-slate-700",children:(vt=R.textLines)==null?void 0:vt.map((b,K)=>{var le,pe;return f.jsxs("div",{className:"bg-slate-800 p-2 rounded border border-slate-700 flex flex-col gap-2",children:[f.jsxs("div",{className:"flex gap-2",children:[f.jsx("input",{type:"text",value:b.text,onChange:q=>de(Z=>{if(!Z||!Z.textLines)return Z;const xe=[...Z.textLines];return xe[K]={...xe[K],text:q.target.value},{...Z,textLines:xe}}),onKeyDown:q=>{if(q.key==="Enter"){q.preventDefault();const Z=q.currentTarget.selectionStart||0,xe=b.text,He=xe.substring(0,Z),Be=xe.substring(Z);de(tt=>{if(!tt||!tt.textLines)return tt;const Rt=[...tt.textLines];Rt[K]={...Rt[K],text:He};const Ct={...Rt[K],id:`line-${Date.now()}`,text:Be,y:Rt[K].y+10};return Rt.splice(K+1,0,Ct),{...tt,textLines:Rt}})}},className:"bg-slate-900 border border-slate-600 rounded px-2 py-1 text-sm text-white flex-1",placeholder:"  (Enter:  )"}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsxs("select",{value:b.fontWeight||"900",onChange:q=>de(Z=>{if(!Z||!Z.textLines)return Z;const xe=[...Z.textLines];return xe[K]={...xe[K],fontWeight:q.target.value},{...Z,textLines:xe}}),className:"bg-slate-900 border border-slate-600 rounded px-1 py-1 text-xs text-white max-w-[60px]",title:" ",children:[f.jsx("option",{value:"100",children:"Thin"}),f.jsx("option",{value:"300",children:"Light"}),f.jsx("option",{value:"400",children:"Regular"}),f.jsx("option",{value:"500",children:"Medium"}),f.jsx("option",{value:"700",children:"Bold"}),f.jsx("option",{value:"900",children:"Black"})]}),f.jsxs("button",{onClick:()=>{V(K),qe(!0)},className:"bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded text-xs border border-slate-600 flex items-center gap-1 min-w-[80px] justify-between",title:" ",children:[f.jsx("span",{className:"truncate max-w-[60px]",children:((le=ue.find(q=>q.value===b.fontFamily))==null?void 0:le.name)||""}),f.jsx("i",{className:"fas fa-chevron-down text-[10px] text-slate-400"})]})]}),f.jsx("input",{type:"color",value:b.color,onChange:q=>de(Z=>{if(!Z||!Z.textLines)return Z;const xe=[...Z.textLines];return xe[K]={...xe[K],color:q.target.value},{...Z,textLines:xe}}),className:"w-8 h-8 rounded cursor-pointer bg-transparent border-0 shrink-0",title:" "}),f.jsxs("div",{className:"flex flex-col items-center justify-center -space-y-1",children:[f.jsxs("span",{className:"text-[8px] text-slate-500",children:[" ",((pe=b.heightScale)==null?void 0:pe.toFixed(1))||"1.0"]}),f.jsx("input",{type:"range",min:"0.5",max:"2.0",step:"0.1",value:b.heightScale||1,onChange:q=>de(Z=>{if(!Z||!Z.textLines)return Z;const xe=[...Z.textLines];return xe[K]={...xe[K],heightScale:parseFloat(q.target.value)},{...Z,textLines:xe}}),className:"w-12 accent-slate-500 h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer",title:`  : ${b.heightScale||1}`})]}),f.jsxs("div",{className:"flex flex-col items-center justify-center -space-y-1",children:[f.jsx("span",{className:"text-[8px] text-slate-500",children:""}),f.jsx("input",{type:"color",value:b.outlineColor||"#000000",onChange:q=>de(Z=>{if(!Z||!Z.textLines)return Z;const xe=[...Z.textLines];return xe[K]={...xe[K],outlineColor:q.target.value},{...Z,textLines:xe}}),className:"w-6 h-6 rounded cursor-pointer bg-transparent border-0 shrink-0",title:" "})]}),f.jsxs("div",{className:"flex flex-col items-center justify-center -space-y-1",children:[f.jsxs("span",{className:"text-[8px] text-slate-500",children:[" ",b.outlineWidth??8]}),f.jsx("input",{type:"range",min:"0",max:"30",value:b.outlineWidth??8,onChange:q=>de(Z=>{if(!Z||!Z.textLines)return Z;const xe=[...Z.textLines];return xe[K]={...xe[K],outlineWidth:parseInt(q.target.value)},{...Z,textLines:xe}}),className:"w-12 accent-slate-500 h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer",title:` : ${b.outlineWidth??8}`})]}),f.jsx("button",{onClick:()=>de(q=>{if(!q||!q.textLines)return q;const Z=q.textLines.filter((xe,He)=>He!==K);return{...q,textLines:Z}}),className:"text-slate-500 hover:text-red-400 px-1",title:"",children:f.jsx("i",{className:"fas fa-times"})})]}),f.jsxs("div",{className:"flex items-center justify-between gap-2",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[10px] text-slate-400",children:""}),f.jsx("input",{type:"number",min:"10",max:"500",value:b.size,onChange:q=>de(Z=>{if(!Z||!Z.textLines)return Z;const xe=[...Z.textLines];return xe[K]={...xe[K],size:parseInt(q.target.value)},{...Z,textLines:xe}}),className:"w-16 bg-slate-900 border border-slate-600 rounded px-1 py-0.5 text-xs text-white text-center focus:border-purple-500 outline-none",title:"   "})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[10px] text-slate-400",children:""}),f.jsx("input",{type:"range",min:"50",max:"200",step:"10",value:(b.heightScale||1)*100,onChange:q=>de(Z=>{if(!Z||!Z.textLines)return Z;const xe=[...Z.textLines];return xe[K]={...xe[K],heightScale:parseInt(q.target.value)/100},{...Z,textLines:xe}}),className:"w-16 accent-indigo-500 h-1 bg-slate-600 rounded-lg appearance-none cursor-pointer",title:"   (50% ~ 200%)"}),f.jsxs("span",{className:"text-[8px] text-slate-500 w-7 text-right",children:[(b.heightScale||1)*100,"%"]})]}),f.jsxs("div",{className:"flex gap-1",children:[f.jsx("button",{onClick:()=>de(q=>{if(!q||!q.textLines)return q;const Z=[...q.textLines];return Z[K]={...Z[K],y:Z[K].y-2},{...q,textLines:Z}}),className:"bg-slate-700 w-5 h-5 rounded text-[10px] hover:bg-slate-600",children:f.jsx("i",{className:"fas fa-arrow-up"})}),f.jsx("button",{onClick:()=>de(q=>{if(!q||!q.textLines)return q;const Z=[...q.textLines];return Z[K]={...Z[K],y:Z[K].y+2},{...q,textLines:Z}}),className:"bg-slate-700 w-5 h-5 rounded text-[10px] hover:bg-slate-600",children:f.jsx("i",{className:"fas fa-arrow-down"})}),f.jsx("button",{onClick:()=>de(q=>{if(!q||!q.textLines)return q;const Z=[...q.textLines];return Z[K]={...Z[K],x:Z[K].x-2},{...q,textLines:Z}}),className:"bg-slate-700 w-5 h-5 rounded text-[10px] hover:bg-slate-600",children:f.jsx("i",{className:"fas fa-arrow-left"})}),f.jsx("button",{onClick:()=>de(q=>{if(!q||!q.textLines)return q;const Z=[...q.textLines];return Z[K]={...Z[K],x:Z[K].x+2},{...q,textLines:Z}}),className:"bg-slate-700 w-5 h-5 rounded text-[10px] hover:bg-slate-600",children:f.jsx("i",{className:"fas fa-arrow-right"})})]})]})]},b.id)})})]}),R.imageHistory&&R.imageHistory.length>0&&f.jsxs("div",{className:"w-full bg-slate-950/50 border-t border-slate-800 p-2",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1 px-1",children:[f.jsx("i",{className:"fas fa-history text-slate-500 text-[10px]"}),f.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:""})]}),f.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent px-1",children:R.imageHistory.map((b,K)=>f.jsx("div",{onClick:()=>de(le=>le?{...le,imageUrl:b}:null),className:`relative w-16 h-9 shrink-0 rounded overflow-hidden cursor-pointer border transition-all group/hist ${R.imageUrl===b?"border-pink-500 opacity-100":"border-slate-700 opacity-60 hover:opacity-100"}`,children:f.jsx("img",{src:b,alt:`Thumb History ${K}`,className:"w-full h-full object-cover"})},K))})]})]})]})]})}),f.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6",children:[f.jsxs("div",{children:[f.jsxs("h3",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-bolt text-yellow-400"}),"    "]}),f.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"        50 ."}),he.length>0&&f.jsxs("p",{className:"text-green-400 text-sm font-bold mt-2",children:[f.jsx("i",{className:"fas fa-check-circle mr-1"})," ",he.length," "]})]}),f.jsxs("div",{className:"flex gap-2",children:[C.length>0&&f.jsxs(f.Fragment,{children:[f.jsxs("button",{onClick:De,disabled:he.length===0,className:`px-4 py-3 rounded-full font-bold shadow-lg transition-all flex items-center gap-2 ${he.length>0?"bg-green-600 hover:bg-green-500 text-white":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,title:"  ",children:[f.jsx("i",{className:"fas fa-file-download"}),"  "]}),f.jsx("button",{onClick:()=>{window.confirm("    ?")&&(Y([]),J([]))},className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-4 py-3 rounded-full font-bold shadow-lg transition-all",title:"  ",children:f.jsx("i",{className:"fas fa-trash-alt"})})]}),f.jsxs("button",{onClick:Pe,disabled:te,className:"bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white px-6 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 transition-all",children:[te?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-list-ol"}),"  50 "]})]})]}),C.length>0&&f.jsx("div",{className:"bg-slate-900 rounded-xl p-6 border border-slate-700 max-h-[500px] overflow-y-auto",children:f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:C.map((b,K)=>{const le=he.includes(b);return f.jsxs("div",{className:`p-3 rounded-lg border transition-all flex justify-between items-center group relative
                                    ${le?"bg-green-900/30 border-green-500 shadow-[0_0_10px_rgba(34,197,94,0.3)]":"bg-slate-800 border-slate-700 hover:border-yellow-500 hover:bg-slate-700"}
                                `,children:[f.jsxs("div",{className:"flex items-center gap-3 overflow-hidden flex-1 mr-2 cursor-pointer",onClick:()=>Ve(b),children:[f.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center shrink-0 transition-colors ${le?"bg-green-500 border-green-500":"border-slate-500 bg-transparent"}`,children:le&&f.jsx("i",{className:"fas fa-check text-white text-xs"})}),f.jsx("span",{className:`font-medium break-all whitespace-normal ${le?"text-green-200":"text-slate-200"}`,children:b})]}),f.jsxs("div",{className:"flex gap-1",children:[f.jsxs("button",{onClick:pe=>{pe.stopPropagation(),confirm(`"${b}"
   ?`)&&Ue(b)},className:"bg-purple-600 hover:bg-purple-500 text-white p-2 rounded z-10 text-xs flex items-center gap-1 shadow-lg",title:"   ",children:[f.jsx("i",{className:"fas fa-paint-brush"})," "]}),f.jsx("button",{onClick:pe=>{pe.stopPropagation(),ke(b)},className:"text-slate-500 hover:text-white p-2 z-10",title:"",children:f.jsx("i",{className:"fas fa-copy"})})]})]},K)})})})]}),Ie&&f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/95 p-8 animate-fade-in backdrop-blur-sm",onClick:()=>Re(null),children:f.jsxs("div",{className:"relative w-full max-w-7xl aspect-video mx-auto flex items-center justify-center bg-slate-950 border border-slate-700 rounded-xl shadow-2xl overflow-hidden ring-4 ring-slate-800/50",style:{containerType:"size"},onClick:b=>b.stopPropagation(),children:[f.jsx("img",{src:Ie,alt:"Preview",className:"w-full h-full object-contain"}),R&&Ie===R.imageUrl&&R.textLines&&R.textLines.map(b=>f.jsx("div",{className:"absolute select-none whitespace-pre-wrap leading-tight drop-shadow-[0_4px_4px_rgba(0,0,0,0.8)] pointer-events-none",style:{left:`${b.x}%`,top:`${b.y}%`,color:b.color,fontSize:`${b.size/10}cqw`,fontFamily:b.fontFamily||"sans-serif",fontWeight:b.fontWeight||"900",maxWidth:"55%",WebkitTextStroke:`${b.size/10*((b.outlineWidth??8)/100)}cqw ${b.outlineColor||"#000"}`,paintOrder:"stroke fill",transform:`translate(0, -50%) scaleY(${b.heightScale||1})`,transformOrigin:"center center"},children:b.text},b.id)),f.jsx("button",{className:"absolute top-4 right-4 bg-black/50 hover:bg-black/80 text-white p-2 rounded-full transition-colors z-50",onClick:()=>Re(null),children:f.jsx("i",{className:"fas fa-times text-xl"})})]})}),st&&f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in",children:f.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-700 shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col overflow-hidden",children:[f.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800",children:[f.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-font text-indigo-400"}),"  "]}),f.jsx("button",{onClick:()=>qe(!1),className:"text-slate-400 hover:text-white",children:f.jsx("i",{className:"fas fa-times text-xl"})})]}),f.jsxs("div",{className:"p-4 bg-slate-850 space-y-3 border-b border-slate-700",children:[f.jsxs("button",{onClick:fe,disabled:$,className:"w-full bg-slate-700 hover:bg-slate-600 text-white px-4 py-3 rounded-lg font-bold flex items-center justify-center gap-2 transition-colors border border-slate-600",children:[$?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-laptop-code"}),"     "]}),f.jsx("p",{className:"text-xs text-slate-500 text-center",children:"* Chrome/Edge  . ( 1   )"}),f.jsxs("div",{className:"relative",children:[f.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"}),f.jsx("input",{type:"text",placeholder:"  ...",value:A,onChange:b=>B(b.target.value),className:"w-full bg-slate-800 text-white pl-10 pr-4 py-2 rounded-lg border border-slate-600 focus:border-indigo-500 outline-none"})]})]}),f.jsx("div",{className:"flex-1 overflow-y-auto p-2 scrollbar-thin scrollbar-thumb-slate-600",children:f.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[ne.length>0&&!A&&f.jsxs("div",{className:"mb-4",children:[f.jsxs("div",{className:"px-2 py-1 text-xs font-bold text-yellow-500 uppercase flex items-center gap-1",children:[f.jsx("i",{className:"fas fa-star"}),"  "]}),ue.filter(b=>ne.includes(b.value)).map((b,K)=>{var le;return f.jsxs("div",{className:"flex items-center group",children:[f.jsx("button",{onClick:()=>Se(b.value),className:"p-3 text-yellow-500 hover:text-yellow-400",title:" ",children:f.jsx("i",{className:"fas fa-star"})}),f.jsxs("button",{onClick:()=>{T!==null&&R&&(de(pe=>{if(!pe||!pe.textLines)return pe;const q=[...pe.textLines];return q[T]={...q[T],fontFamily:b.value},{...pe,textLines:q}}),qe(!1))},className:"flex-1 text-left px-2 py-3 rounded hover:bg-slate-800 border border-transparent hover:border-slate-600 transition-all",children:[f.jsxs("div",{className:"flex justify-between items-center mb-1",children:[f.jsx("span",{className:"text-xs text-slate-400 font-sans group-hover:text-indigo-400",children:b.name}),(R==null?void 0:R.textLines)&&((le=R.textLines[T])==null?void 0:le.fontFamily)===b.value&&f.jsx("i",{className:"fas fa-check text-green-500"})]}),f.jsx("div",{className:"text-xl text-white",style:{fontFamily:b.value},children:" ABC 123"})]})]},`fav-${K}`)}),f.jsx("div",{className:"h-px bg-slate-700 my-2 mx-2"})]}),ue.filter(b=>b.name.toLowerCase().includes(A.toLowerCase())).map((b,K)=>{var le;return f.jsxs("div",{className:"flex items-center group",children:[f.jsx("button",{onClick:()=>Se(b.value),className:`p-3 ${ne.includes(b.value)?"text-yellow-500":"text-slate-600 hover:text-yellow-500"}`,title:ne.includes(b.value)?" ":" ",children:f.jsx("i",{className:`fas fa-star ${ne.includes(b.value)?"":"opacity-50"}`})}),f.jsxs("button",{onClick:()=>{T!==null&&R&&(de(pe=>{if(!pe||!pe.textLines)return pe;const q=[...pe.textLines];return q[T]={...q[T],fontFamily:b.value},{...pe,textLines:q}}),qe(!1))},className:"flex-1 text-left px-2 py-3 rounded hover:bg-slate-800 border border-transparent hover:border-slate-600 transition-all",children:[f.jsxs("div",{className:"flex justify-between items-center mb-1",children:[f.jsx("span",{className:"text-xs text-slate-400 font-sans group-hover:text-indigo-400",children:b.name}),(R==null?void 0:R.textLines)&&((le=R.textLines[T])==null?void 0:le.fontFamily)===b.value&&f.jsx("i",{className:"fas fa-check text-green-500"})]}),f.jsx("div",{className:"text-xl text-white",style:{fontFamily:b.value},children:" ABC 123"})]})]},K)}),ue.filter(b=>b.name.toLowerCase().includes(A.toLowerCase())).length===0&&f.jsxs("div",{className:"text-center py-8 text-slate-500",children:[f.jsx("i",{className:"fas fa-search mb-2"}),f.jsx("p",{children:"  ."})]})]})})]})}),f.jsx("div",{ref:N})]})},aN=()=>{const{toast:t,closeToast:e}=gn();if(!t)return null;const n={success:"bg-green-600",error:"bg-red-600",warning:"bg-yellow-600",info:"bg-blue-600"};return f.jsxs("div",{className:`fixed bottom-6 left-1/2 transform -translate-x-1/2 ${n[t.type]} text-white px-6 py-3 rounded-full shadow-2xl z-[100] flex items-center gap-3 animate-fade-in-up cursor-pointer`,onClick:e,children:[f.jsx("i",{className:`fas ${t.type==="success"?"fa-check-circle":t.type==="warning"?"fa-exclamation-triangle":t.type==="info"?"fa-info-circle":"fa-times-circle"}`}),f.jsx("span",{className:"font-medium",children:t.message})]})},lN=()=>{const{modalConfig:t,closeModal:e,showToast:n}=gn(),[r,o]=se.useState("");if(se.useEffect(()=>{t&&o(t.defaultValue||"")},[t]),!t)return null;const i=()=>{t.onConfirm(r),e(),o("")},s=()=>{e(),o("")},a=async()=>{try{const u=typeof t.message=="string"?t.message:t.defaultValue||"";await navigator.clipboard.writeText(u),n(" .","success")}catch(u){console.error(u),n(" .","error")}};return f.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fade-in",children:f.jsxs("div",{className:`bg-slate-800 border border-slate-600 rounded-xl shadow-2xl w-full p-6 relative ${t.type==="textarea"?"max-w-4xl":"max-w-lg"}`,children:[f.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:t.title}),f.jsx("div",{className:"text-slate-300 mb-4 whitespace-pre-wrap leading-relaxed text-sm max-h-[60vh] overflow-y-auto custom-scrollbar",children:t.message}),t.type==="prompt"&&f.jsx("input",{autoFocus:!0,type:"text",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white mb-6 focus:ring-2 focus:ring-indigo-500 placeholder-slate-500",placeholder:" ",value:r,onChange:u=>o(u.target.value),onKeyDown:u=>{u.key==="Enter"&&i()}}),t.type==="textarea"&&f.jsx("textarea",{autoFocus:!0,className:"w-full h-[60vh] bg-slate-900 border border-slate-700 rounded p-4 text-white mb-6 focus:ring-2 focus:ring-indigo-500 placeholder-slate-500 text-sm leading-relaxed custom-scrollbar font-mono",placeholder:"  ",value:r,onChange:u=>o(u.target.value)}),f.jsxs("div",{className:"flex justify-end gap-3 items-center",children:[t.showCopyButton&&f.jsxs("button",{onClick:a,className:"mr-auto px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-indigo-300 font-bold transition-colors border border-slate-600 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-copy"})," "]}),f.jsx("button",{onClick:s,className:"px-4 py-2 rounded-lg text-slate-300 hover:bg-slate-700 font-medium transition-colors",children:t.cancelText||""}),f.jsx("button",{onClick:i,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-2 rounded-lg font-bold transition-all shadow-lg hover:shadow-indigo-500/30",children:t.confirmText||""})]})]})})},uN=({onOpenApiKey:t})=>{const{apiKey:e}=gn();return f.jsxs("header",{className:"bg-slate-900 border-b border-slate-700 p-4 flex items-center justify-between sticky top-0 z-50 shadow-md",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center text-white text-xl font-bold shadow-lg",children:""}),f.jsxs("h1",{className:"text-2xl font-bold text-white tracking-wide",children:["  ",f.jsx("span",{className:"text-xs text-slate-500 font-normal ml-2",children:"Ver 2.0 (Joseon Ed.)"})]})]}),f.jsxs("div",{className:"flex items-center gap-3",children:[e&&f.jsxs("div",{className:"hidden md:flex items-center gap-2 bg-slate-800 px-3 py-1.5 rounded-full border border-slate-600 mr-2",children:[f.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse"}),f.jsx("span",{className:"text-xs text-slate-300 font-medium",children:""})]}),f.jsxs("button",{onClick:t,className:"bg-slate-800 hover:bg-slate-700 text-slate-200 px-4 py-2 rounded-lg border border-slate-600 flex items-center gap-2 transition-all text-sm font-medium",children:[f.jsx("i",{className:`fas fa-key ${e?"text-green-500":"text-yellow-500"}`}),e?"API  ":"API  "]})]})]})},wa=({active:t,label:e,icon:n,onClick:r,disabled:o})=>f.jsxs("button",{onClick:r,disabled:o,className:`flex-1 py-4 text-lg font-bold flex items-center justify-center gap-3 transition-all ${t?"bg-indigo-600 text-white shadow-inner border-b-4 border-indigo-800":"bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white border-b-4 border-slate-900"} ${o?"opacity-50 cursor-not-allowed":""}`,children:[f.jsx("i",{className:`fas ${n} text-xl`}),e]}),cN=({isOpen:t,onClose:e})=>{const{apiKey:n,setApiKey:r,showToast:o}=gn(),[i,s]=se.useState(n);return t?f.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[150] flex items-center justify-center p-4 animate-fade-in",children:f.jsxs("div",{className:"bg-slate-800 w-full max-w-md p-8 rounded-2xl border border-slate-600 shadow-2xl relative",children:[f.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-slate-400 hover:text-white",children:f.jsx("i",{className:"fas fa-times text-xl"})}),f.jsxs("h3",{className:"text-2xl font-bold text-white mb-4 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-key text-yellow-500"})," API  "]}),f.jsx("p",{className:"text-slate-300 mb-6 text-sm",children:"Google AI Studio  Gemini API Key ."}),f.jsx("input",{type:"password",value:i,onChange:a=>s(a.target.value),placeholder:"AIzaSy...",className:"w-full bg-slate-900 border border-slate-700 rounded-lg p-4 text-white focus:ring-2 focus:ring-indigo-500 mb-6 font-mono"}),f.jsx("button",{onClick:()=>{i?(r(i),e(),o(".","success")):o(" .","warning")},className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg",children:"  "}),f.jsx("div",{className:"mt-6 pt-4 border-t border-slate-700 text-center",children:f.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noreferrer",className:"text-indigo-400 text-sm",children:"API  "})})]})}):null},dN=()=>{const{characters:t,props:e,referenceImages:n,showToast:r}=gn(),[o,i]=se.useState(!1),[s,a]=se.useState("char"),u=Bf.useMemo(()=>{const d=new Map;return n.forEach(h=>{d.set(h.name,{id:h.id,name:h.name,description:h.description,imageUrl:h.imageUrl,isRef:!0})}),t.forEach(h=>{d.has(h.name)||d.set(h.name,{id:h.id,name:h.name,description:h.description,imageUrl:null,isRef:!1})}),Array.from(d.values())},[t,n]);return f.jsxs("div",{className:`fixed right-0 top-32 bottom-0 z-[250] flex transition-transform duration-300 ${o?"translate-x-0":"translate-x-[320px]"}`,children:[f.jsx("button",{onClick:()=>i(!o),className:"h-14 w-8 bg-slate-800 border-l border-t border-b border-slate-600 rounded-l-lg flex items-center justify-center self-center shadow-lg hover:bg-slate-700 transition-colors",title:o?" ":" ",children:f.jsx("i",{className:`fas fa-chevron-${o?"right":"left"} text-slate-400`})}),f.jsxs("div",{className:"w-80 bg-slate-900 border-l border-slate-700 shadow-2xl p-4 flex flex-col h-full",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4 shrink-0",children:[f.jsxs("button",{onClick:()=>a("char"),className:`flex-1 py-2 rounded text-xs font-bold ${s==="char"?"bg-indigo-600 text-white":"bg-slate-800 text-slate-400"}`,children:[f.jsx("i",{className:"fas fa-user mr-1"})," "]}),f.jsxs("button",{onClick:()=>a("prop"),className:`flex-1 py-2 rounded text-xs font-bold ${s==="prop"?"bg-amber-600 text-white":"bg-slate-800 text-slate-400"}`,children:[f.jsx("i",{className:"fas fa-cube mr-1"})," "]})]}),f.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-3",children:s==="char"?u.length===0?f.jsx("p",{className:"text-slate-500 text-center text-xs py-10",children:"  ."}):u.map(d=>f.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[d.imageUrl&&f.jsx("div",{className:"w-8 h-8 rounded bg-black overflow-hidden shrink-0",children:f.jsx("img",{src:d.imageUrl,alt:d.name,className:"w-full h-full object-cover"})}),f.jsx("span",{className:"text-white font-bold text-sm truncate",children:d.name})]}),f.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(d.description||""),r(`${d.name}  !`,"success")},className:"text-xs bg-slate-700 hover:bg-indigo-600 text-slate-300 hover:text-white px-2 py-1 rounded transition-colors shrink-0",children:[f.jsx("i",{className:"fas fa-copy mr-1"})," "]})]}),f.jsx("p",{className:"text-xs text-slate-400 line-clamp-3 leading-relaxed bg-slate-900 p-2 rounded",children:d.description||" "})]},d.id)):e.length===0?f.jsx("p",{className:"text-slate-500 text-center text-xs py-10",children:"  ."}):e.map(d=>f.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:"w-8 h-8 rounded bg-black overflow-hidden shrink-0",children:f.jsx("img",{src:d.imageUrl,alt:d.name,className:"w-full h-full object-cover"})}),f.jsx("span",{className:"text-white font-bold text-sm",children:d.name})]}),f.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(d.description||""),r(`${d.name}  !`,"success")},className:"text-xs bg-slate-700 hover:bg-amber-600 text-slate-300 hover:text-white px-2 py-1 rounded transition-colors",children:[f.jsx("i",{className:"fas fa-copy mr-1"})," "]})]}),f.jsx("p",{className:"text-xs text-slate-400 line-clamp-3 leading-relaxed bg-slate-900 p-2 rounded",children:d.description||" "})]},d.id))})]})]})},fN=()=>{const{apiKey:t,script:e,scriptSegments:n,scenes:r,characters:o,setScenes:i,setCharacters:s,isContinuityMode:a,showToast:u,resetProject:d,openModal:h}=gn(),[m,p]=se.useState("script"),[g,E]=se.useState(!1),[x,w]=se.useState(!1),[y,v]=se.useState(30),[S,N]=se.useState(!1),I=async P=>{if(!t)return E(!0);if(!e.trim()&&n.length===0)return u(" !","warning");const D=P;if(D<1)return u("  1  .","warning");w(!0);try{let M=e,j=e;a?n.length>0&&(M=n[n.length-1].content,u(`  :  (${n[n.length-1].title})   .`,"success")):u("  :     .","success"),u(`1/2: (Scene)   ... (:  ${D})`,"success");const z=(await FC(t,M,a?r:[],D,o)).map((te,H)=>({...te,id:`scene-${Date.now()}-${H}`}));u("2/2:     ...","success");const Y=await GC(t,j,z,a?o:[]);let he=[...Y];if(a){const te=new Set(o.map(ie=>ie.name)),H=[...o];Y.forEach(ie=>{H.some(F=>F.name===ie.name)||H.push(ie)}),he=H}const J=z.map(te=>{const H=te.characterNames||[],ie=he.filter(F=>H.some(R=>R.includes(F.name)||F.name.includes(R))).map(F=>F.id);return{...te,casting:{mainIds:ie,subIds:[],propIds:[]}}});a?(i(J),s(te=>{const H=[...te];return Y.forEach(ie=>{const F=H.findIndex(R=>R.name===ie.name);F===-1?H.push(ie):H[F]={...H[F],description:ie.description,visualGuide:ie.visualGuide,age:ie.age,gender:ie.gender}}),H})):(i(J),s(Y)),p("sintong"),u(` !  ${J.length} .`,"success")}catch(M){u(M.message,"error")}finally{w(!1)}},L=()=>{h({type:"confirm",title:" ",message:`     ?
    .`,confirmText:"",cancelText:"",onConfirm:()=>d()})};return f.jsxs("div",{className:"min-h-screen bg-[#0f172a] text-slate-200 font-sans selection:bg-indigo-500 selection:text-white pb-20",children:[f.jsx(uN,{onOpenApiKey:()=>E(!0)}),f.jsxs("div",{className:"flex border-b border-slate-700 sticky top-[72px] z-40 bg-[#0f172a]",children:[f.jsx(wa,{active:m==="script",onClick:()=>p("script"),label:"1. /",icon:"fa-file-alt"}),f.jsx(wa,{active:m==="opening",onClick:()=>p("opening"),label:"2.  ()",icon:"fa-film"}),f.jsx(wa,{active:m==="sintong",onClick:()=>p("sintong"),label:"3.  ( )",icon:"fa-layer-group"})]}),f.jsxs("main",{className:"max-w-6xl mx-auto p-6 min-h-[calc(100vh-140px)]",children:[m==="script"&&f.jsx(nN,{onAnalyze:I,isAnalyzing:x}),m==="opening"&&f.jsx(sN,{}),m==="sintong"&&f.jsx(iN,{onNext:()=>{},isNextLoading:!1})]}),f.jsx(dN,{}),f.jsx("div",{className:"fixed bottom-6 right-6 z-40",children:f.jsxs("button",{onClick:L,className:"bg-red-900/80 hover:bg-red-900 text-red-200 px-4 py-2 rounded-full text-xs border border-red-700 backdrop-blur",children:[f.jsx("i",{className:"fas fa-trash mr-1"}),"  "]})}),f.jsx(lN,{}),f.jsx(aN,{}),f.jsx(cN,{isOpen:g,onClose:()=>E(!1)})]})},hN=()=>f.jsx(Ty,{children:f.jsx(fN,{})}),Vm=document.getElementById("root");if(!Vm)throw new Error("Could not find root element to mount to");const pN=Ca.createRoot(Vm);pN.render(f.jsx(Bf.StrictMode,{children:f.jsx(hN,{})}));
