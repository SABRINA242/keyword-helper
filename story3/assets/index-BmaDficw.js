(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var un=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var mf={exports:{}},is={},gf={exports:{}},Me={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uo=Symbol.for("react.element"),km=Symbol.for("react.portal"),Pm=Symbol.for("react.fragment"),Mm=Symbol.for("react.strict_mode"),Lm=Symbol.for("react.profiler"),Om=Symbol.for("react.provider"),Dm=Symbol.for("react.context"),Um=Symbol.for("react.forward_ref"),Fm=Symbol.for("react.suspense"),Gm=Symbol.for("react.memo"),Hm=Symbol.for("react.lazy"),Tu=Symbol.iterator;function Bm(t){return t===null||typeof t!="object"?null:(t=Tu&&t[Tu]||t["@@iterator"],typeof t=="function"?t:null)}var yf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},vf=Object.assign,xf={};function zr(t,e,n){this.props=t,this.context=e,this.refs=xf,this.updater=n||yf}zr.prototype.isReactComponent={};zr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};zr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Ef(){}Ef.prototype=zr.prototype;function pl(t,e,n){this.props=t,this.context=e,this.refs=xf,this.updater=n||yf}var ml=pl.prototype=new Ef;ml.constructor=pl;vf(ml,zr.prototype);ml.isPureReactComponent=!0;var Su=Array.isArray,Tf=Object.prototype.hasOwnProperty,gl={current:null},Sf={key:!0,ref:!0,__self:!0,__source:!0};function wf(t,e,n){var r,o={},i=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(i=""+e.key),e)Tf.call(e,r)&&!Sf.hasOwnProperty(r)&&(o[r]=e[r]);var a=arguments.length-2;if(a===1)o.children=n;else if(1<a){for(var u=Array(a),c=0;c<a;c++)u[c]=arguments[c+2];o.children=u}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)o[r]===void 0&&(o[r]=a[r]);return{$$typeof:Uo,type:t,key:i,ref:s,props:o,_owner:gl.current}}function Vm(t,e){return{$$typeof:Uo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function yl(t){return typeof t=="object"&&t!==null&&t.$$typeof===Uo}function zm(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var wu=/\/+/g;function As(t,e){return typeof t=="object"&&t!==null&&t.key!=null?zm(""+t.key):e.toString(36)}function fi(t,e,n,r,o){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case Uo:case km:s=!0}}if(s)return s=t,o=o(s),t=r===""?"."+As(s,0):r,Su(o)?(n="",t!=null&&(n=t.replace(wu,"$&/")+"/"),fi(o,e,n,"",function(c){return c})):o!=null&&(yl(o)&&(o=Vm(o,n+(!o.key||s&&s.key===o.key?"":(""+o.key).replace(wu,"$&/")+"/")+t)),e.push(o)),1;if(s=0,r=r===""?".":r+":",Su(t))for(var a=0;a<t.length;a++){i=t[a];var u=r+As(i,a);s+=fi(i,e,n,u,o)}else if(u=Bm(t),typeof u=="function")for(t=u.call(t),a=0;!(i=t.next()).done;)i=i.value,u=r+As(i,a++),s+=fi(i,e,n,u,o);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function Vo(t,e,n){if(t==null)return t;var r=[],o=0;return fi(t,r,"","",function(i){return e.call(n,i,o++)}),r}function jm(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var St={current:null},hi={transition:null},$m={ReactCurrentDispatcher:St,ReactCurrentBatchConfig:hi,ReactCurrentOwner:gl};function Cf(){throw Error("act(...) is not supported in production builds of React.")}Me.Children={map:Vo,forEach:function(t,e,n){Vo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Vo(t,function(){e++}),e},toArray:function(t){return Vo(t,function(e){return e})||[]},only:function(t){if(!yl(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Me.Component=zr;Me.Fragment=Pm;Me.Profiler=Lm;Me.PureComponent=pl;Me.StrictMode=Mm;Me.Suspense=Fm;Me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$m;Me.act=Cf;Me.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=vf({},t.props),o=t.key,i=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,s=gl.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(u in e)Tf.call(e,u)&&!Sf.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&a!==void 0?a[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){a=Array(u);for(var c=0;c<u;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:Uo,type:t.type,key:o,ref:i,props:r,_owner:s}};Me.createContext=function(t){return t={$$typeof:Dm,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Om,_context:t},t.Consumer=t};Me.createElement=wf;Me.createFactory=function(t){var e=wf.bind(null,t);return e.type=t,e};Me.createRef=function(){return{current:null}};Me.forwardRef=function(t){return{$$typeof:Um,render:t}};Me.isValidElement=yl;Me.lazy=function(t){return{$$typeof:Hm,_payload:{_status:-1,_result:t},_init:jm}};Me.memo=function(t,e){return{$$typeof:Gm,type:t,compare:e===void 0?null:e}};Me.startTransition=function(t){var e=hi.transition;hi.transition={};try{t()}finally{hi.transition=e}};Me.unstable_act=Cf;Me.useCallback=function(t,e){return St.current.useCallback(t,e)};Me.useContext=function(t){return St.current.useContext(t)};Me.useDebugValue=function(){};Me.useDeferredValue=function(t){return St.current.useDeferredValue(t)};Me.useEffect=function(t,e){return St.current.useEffect(t,e)};Me.useId=function(){return St.current.useId()};Me.useImperativeHandle=function(t,e,n){return St.current.useImperativeHandle(t,e,n)};Me.useInsertionEffect=function(t,e){return St.current.useInsertionEffect(t,e)};Me.useLayoutEffect=function(t,e){return St.current.useLayoutEffect(t,e)};Me.useMemo=function(t,e){return St.current.useMemo(t,e)};Me.useReducer=function(t,e,n){return St.current.useReducer(t,e,n)};Me.useRef=function(t){return St.current.useRef(t)};Me.useState=function(t){return St.current.useState(t)};Me.useSyncExternalStore=function(t,e,n){return St.current.useSyncExternalStore(t,e,n)};Me.useTransition=function(){return St.current.useTransition()};Me.version="18.3.1";gf.exports=Me;var de=gf.exports;const If=pf(de);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wm=de,qm=Symbol.for("react.element"),Ym=Symbol.for("react.fragment"),Km=Object.prototype.hasOwnProperty,Jm=Wm.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Xm={key:!0,ref:!0,__self:!0,__source:!0};function Nf(t,e,n){var r,o={},i=null,s=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)Km.call(e,r)&&!Xm.hasOwnProperty(r)&&(o[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)o[r]===void 0&&(o[r]=e[r]);return{$$typeof:qm,type:t,key:i,ref:s,props:o,_owner:Jm.current}}is.Fragment=Ym;is.jsx=Nf;is.jsxs=Nf;mf.exports=is;var f=mf.exports,sa={},_f={exports:{}},Mt={},bf={exports:{}},Af={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(J,K){var ee=J.length;J.push(K);e:for(;0<ee;){var O=ee-1>>>1,V=J[O];if(0<o(V,K))J[O]=K,J[ee]=V,ee=O;else break e}}function n(J){return J.length===0?null:J[0]}function r(J){if(J.length===0)return null;var K=J[0],ee=J.pop();if(ee!==K){J[0]=ee;e:for(var O=0,V=J.length,fe=V>>>1;O<fe;){var se=2*(O+1)-1,le=J[se],xe=se+1,Ie=J[xe];if(0>o(le,ee))xe<V&&0>o(Ie,le)?(J[O]=Ie,J[xe]=ee,O=xe):(J[O]=le,J[se]=ee,O=se);else if(xe<V&&0>o(Ie,ee))J[O]=Ie,J[xe]=ee,O=xe;else break e}}return K}function o(J,K){var ee=J.sortIndex-K.sortIndex;return ee!==0?ee:J.id-K.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,a=s.now();t.unstable_now=function(){return s.now()-a}}var u=[],c=[],h=1,p=null,m=3,g=!1,E=!1,v=!1,w=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(J){for(var K=n(c);K!==null;){if(K.callback===null)r(c);else if(K.startTime<=J)r(c),K.sortIndex=K.expirationTime,e(u,K);else break;K=n(c)}}function I(J){if(v=!1,T(J),!E)if(n(u)!==null)E=!0,ce(_);else{var K=n(c);K!==null&&X(I,K.startTime-J)}}function _(J,K){E=!1,v&&(v=!1,y(j),j=-1),g=!0;var ee=m;try{for(T(K),p=n(u);p!==null&&(!(p.expirationTime>K)||J&&!ae());){var O=p.callback;if(typeof O=="function"){p.callback=null,m=p.priorityLevel;var V=O(p.expirationTime<=K);K=t.unstable_now(),typeof V=="function"?p.callback=V:p===n(u)&&r(u),T(K)}else r(u);p=n(u)}if(p!==null)var fe=!0;else{var se=n(c);se!==null&&X(I,se.startTime-K),fe=!1}return fe}finally{p=null,m=ee,g=!1}}var R=!1,k=null,j=-1,D=5,q=-1;function ae(){return!(t.unstable_now()-q<D)}function P(){if(k!==null){var J=t.unstable_now();q=J;var K=!0;try{K=k(!0,J)}finally{K?W():(R=!1,k=null)}}else R=!1}var W;if(typeof x=="function")W=function(){x(P)};else if(typeof MessageChannel<"u"){var C=new MessageChannel,G=C.port2;C.port1.onmessage=P,W=function(){G.postMessage(null)}}else W=function(){w(P,0)};function ce(J){k=J,R||(R=!0,W())}function X(J,K){j=w(function(){J(t.unstable_now())},K)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(J){J.callback=null},t.unstable_continueExecution=function(){E||g||(E=!0,ce(_))},t.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<J?Math.floor(1e3/J):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(J){switch(m){case 1:case 2:case 3:var K=3;break;default:K=m}var ee=m;m=K;try{return J()}finally{m=ee}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(J,K){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var ee=m;m=J;try{return K()}finally{m=ee}},t.unstable_scheduleCallback=function(J,K,ee){var O=t.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?O+ee:O):ee=O,J){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=ee+V,J={id:h++,callback:K,priorityLevel:J,startTime:ee,expirationTime:V,sortIndex:-1},ee>O?(J.sortIndex=ee,e(c,J),n(u)===null&&J===n(c)&&(v?(y(j),j=-1):v=!0,X(I,ee-O))):(J.sortIndex=V,e(u,J),E||g||(E=!0,ce(_))),J},t.unstable_shouldYield=ae,t.unstable_wrapCallback=function(J){var K=m;return function(){var ee=m;m=K;try{return J.apply(this,arguments)}finally{m=ee}}}})(Af);bf.exports=Af;var Zm=bf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qm=de,Pt=Zm;function he(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Rf=new Set,Eo={};function ir(t,e){Or(t,e),Or(t+"Capture",e)}function Or(t,e){for(Eo[t]=e,t=0;t<e.length;t++)Rf.add(e[t])}var hn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),aa=Object.prototype.hasOwnProperty,eg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Cu={},Iu={};function tg(t){return aa.call(Iu,t)?!0:aa.call(Cu,t)?!1:eg.test(t)?Iu[t]=!0:(Cu[t]=!0,!1)}function ng(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function rg(t,e,n,r){if(e===null||typeof e>"u"||ng(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function wt(t,e,n,r,o,i,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=s}var ft={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ft[t]=new wt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ft[e]=new wt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ft[t]=new wt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ft[t]=new wt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ft[t]=new wt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ft[t]=new wt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ft[t]=new wt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ft[t]=new wt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ft[t]=new wt(t,5,!1,t.toLowerCase(),null,!1,!1)});var vl=/[\-:]([a-z])/g;function xl(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(vl,xl);ft[e]=new wt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(vl,xl);ft[e]=new wt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(vl,xl);ft[e]=new wt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ft[t]=new wt(t,1,!1,t.toLowerCase(),null,!1,!1)});ft.xlinkHref=new wt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ft[t]=new wt(t,1,!1,t.toLowerCase(),null,!0,!0)});function El(t,e,n,r){var o=ft.hasOwnProperty(e)?ft[e]:null;(o!==null?o.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(rg(e,n,o,r)&&(n=null),r||o===null?tg(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):o.mustUseProperty?t[o.propertyName]=n===null?o.type===3?!1:"":n:(e=o.attributeName,r=o.attributeNamespace,n===null?t.removeAttribute(e):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var vn=Qm.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,zo=Symbol.for("react.element"),fr=Symbol.for("react.portal"),hr=Symbol.for("react.fragment"),Tl=Symbol.for("react.strict_mode"),la=Symbol.for("react.profiler"),kf=Symbol.for("react.provider"),Pf=Symbol.for("react.context"),Sl=Symbol.for("react.forward_ref"),ua=Symbol.for("react.suspense"),ca=Symbol.for("react.suspense_list"),wl=Symbol.for("react.memo"),wn=Symbol.for("react.lazy"),Mf=Symbol.for("react.offscreen"),Nu=Symbol.iterator;function Kr(t){return t===null||typeof t!="object"?null:(t=Nu&&t[Nu]||t["@@iterator"],typeof t=="function"?t:null)}var Xe=Object.assign,Rs;function io(t){if(Rs===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Rs=e&&e[1]||""}return`
`+Rs+t}var ks=!1;function Ps(t,e){if(!t||ks)return"";ks=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var o=c.stack.split(`
`),i=r.stack.split(`
`),s=o.length-1,a=i.length-1;1<=s&&0<=a&&o[s]!==i[a];)a--;for(;1<=s&&0<=a;s--,a--)if(o[s]!==i[a]){if(s!==1||a!==1)do if(s--,a--,0>a||o[s]!==i[a]){var u=`
`+o[s].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=s&&0<=a);break}}}finally{ks=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?io(t):""}function og(t){switch(t.tag){case 5:return io(t.type);case 16:return io("Lazy");case 13:return io("Suspense");case 19:return io("SuspenseList");case 0:case 2:case 15:return t=Ps(t.type,!1),t;case 11:return t=Ps(t.type.render,!1),t;case 1:return t=Ps(t.type,!0),t;default:return""}}function da(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case hr:return"Fragment";case fr:return"Portal";case la:return"Profiler";case Tl:return"StrictMode";case ua:return"Suspense";case ca:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Pf:return(t.displayName||"Context")+".Consumer";case kf:return(t._context.displayName||"Context")+".Provider";case Sl:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case wl:return e=t.displayName||null,e!==null?e:da(t.type)||"Memo";case wn:e=t._payload,t=t._init;try{return da(t(e))}catch{}}return null}function ig(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return da(e);case 8:return e===Tl?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Gn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Lf(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function sg(t){var e=Lf(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(s){r=""+s,i.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function jo(t){t._valueTracker||(t._valueTracker=sg(t))}function Of(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Lf(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function bi(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function fa(t,e){var n=e.checked;return Xe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function _u(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Gn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Df(t,e){e=e.checked,e!=null&&El(t,"checked",e,!1)}function ha(t,e){Df(t,e);var n=Gn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?pa(t,e.type,n):e.hasOwnProperty("defaultValue")&&pa(t,e.type,Gn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function bu(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function pa(t,e,n){(e!=="number"||bi(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var so=Array.isArray;function _r(t,e,n,r){if(t=t.options,e){e={};for(var o=0;o<n.length;o++)e["$"+n[o]]=!0;for(n=0;n<t.length;n++)o=e.hasOwnProperty("$"+t[n].value),t[n].selected!==o&&(t[n].selected=o),o&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Gn(n),e=null,o=0;o<t.length;o++){if(t[o].value===n){t[o].selected=!0,r&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function ma(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(he(91));return Xe({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Au(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(he(92));if(so(n)){if(1<n.length)throw Error(he(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Gn(n)}}function Uf(t,e){var n=Gn(e.value),r=Gn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Ru(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Ff(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ga(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Ff(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var $o,Gf=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,o){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for($o=$o||document.createElement("div"),$o.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=$o.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function To(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var co={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ag=["Webkit","ms","Moz","O"];Object.keys(co).forEach(function(t){ag.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),co[e]=co[t]})});function Hf(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||co.hasOwnProperty(t)&&co[t]?(""+e).trim():e+"px"}function Bf(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,o=Hf(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,o):t[n]=o}}var lg=Xe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ya(t,e){if(e){if(lg[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(he(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(he(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(he(61))}if(e.style!=null&&typeof e.style!="object")throw Error(he(62))}}function va(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xa=null;function Cl(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ea=null,br=null,Ar=null;function ku(t){if(t=Ho(t)){if(typeof Ea!="function")throw Error(he(280));var e=t.stateNode;e&&(e=cs(e),Ea(t.stateNode,t.type,e))}}function Vf(t){br?Ar?Ar.push(t):Ar=[t]:br=t}function zf(){if(br){var t=br,e=Ar;if(Ar=br=null,ku(t),e)for(t=0;t<e.length;t++)ku(e[t])}}function jf(t,e){return t(e)}function $f(){}var Ms=!1;function Wf(t,e,n){if(Ms)return t(e,n);Ms=!0;try{return jf(t,e,n)}finally{Ms=!1,(br!==null||Ar!==null)&&($f(),zf())}}function So(t,e){var n=t.stateNode;if(n===null)return null;var r=cs(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(he(231,e,typeof n));return n}var Ta=!1;if(hn)try{var Jr={};Object.defineProperty(Jr,"passive",{get:function(){Ta=!0}}),window.addEventListener("test",Jr,Jr),window.removeEventListener("test",Jr,Jr)}catch{Ta=!1}function ug(t,e,n,r,o,i,s,a,u){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(h){this.onError(h)}}var fo=!1,Ai=null,Ri=!1,Sa=null,cg={onError:function(t){fo=!0,Ai=t}};function dg(t,e,n,r,o,i,s,a,u){fo=!1,Ai=null,ug.apply(cg,arguments)}function fg(t,e,n,r,o,i,s,a,u){if(dg.apply(this,arguments),fo){if(fo){var c=Ai;fo=!1,Ai=null}else throw Error(he(198));Ri||(Ri=!0,Sa=c)}}function sr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function qf(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Pu(t){if(sr(t)!==t)throw Error(he(188))}function hg(t){var e=t.alternate;if(!e){if(e=sr(t),e===null)throw Error(he(188));return e!==t?null:t}for(var n=t,r=e;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(r=o.return,r!==null){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return Pu(o),t;if(i===r)return Pu(o),e;i=i.sibling}throw Error(he(188))}if(n.return!==r.return)n=o,r=i;else{for(var s=!1,a=o.child;a;){if(a===n){s=!0,n=o,r=i;break}if(a===r){s=!0,r=o,n=i;break}a=a.sibling}if(!s){for(a=i.child;a;){if(a===n){s=!0,n=i,r=o;break}if(a===r){s=!0,r=i,n=o;break}a=a.sibling}if(!s)throw Error(he(189))}}if(n.alternate!==r)throw Error(he(190))}if(n.tag!==3)throw Error(he(188));return n.stateNode.current===n?t:e}function Yf(t){return t=hg(t),t!==null?Kf(t):null}function Kf(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Kf(t);if(e!==null)return e;t=t.sibling}return null}var Jf=Pt.unstable_scheduleCallback,Mu=Pt.unstable_cancelCallback,pg=Pt.unstable_shouldYield,mg=Pt.unstable_requestPaint,Qe=Pt.unstable_now,gg=Pt.unstable_getCurrentPriorityLevel,Il=Pt.unstable_ImmediatePriority,Xf=Pt.unstable_UserBlockingPriority,ki=Pt.unstable_NormalPriority,yg=Pt.unstable_LowPriority,Zf=Pt.unstable_IdlePriority,ss=null,rn=null;function vg(t){if(rn&&typeof rn.onCommitFiberRoot=="function")try{rn.onCommitFiberRoot(ss,t,void 0,(t.current.flags&128)===128)}catch{}}var qt=Math.clz32?Math.clz32:Tg,xg=Math.log,Eg=Math.LN2;function Tg(t){return t>>>=0,t===0?32:31-(xg(t)/Eg|0)|0}var Wo=64,qo=4194304;function ao(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Pi(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,o=t.suspendedLanes,i=t.pingedLanes,s=n&268435455;if(s!==0){var a=s&~o;a!==0?r=ao(a):(i&=s,i!==0&&(r=ao(i)))}else s=n&~o,s!==0?r=ao(s):i!==0&&(r=ao(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&o)&&(o=r&-r,i=e&-e,o>=i||o===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-qt(e),o=1<<n,r|=t[n],e&=~o;return r}function Sg(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wg(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,o=t.expirationTimes,i=t.pendingLanes;0<i;){var s=31-qt(i),a=1<<s,u=o[s];u===-1?(!(a&n)||a&r)&&(o[s]=Sg(a,e)):u<=e&&(t.expiredLanes|=a),i&=~a}}function wa(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Qf(){var t=Wo;return Wo<<=1,!(Wo&4194240)&&(Wo=64),t}function Ls(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Fo(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-qt(e),t[e]=n}function Cg(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var o=31-qt(n),i=1<<o;e[o]=0,r[o]=-1,t[o]=-1,n&=~i}}function Nl(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-qt(n),o=1<<r;o&e|t[r]&e&&(t[r]|=e),n&=~o}}var He=0;function eh(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var th,_l,nh,rh,oh,Ca=!1,Yo=[],Rn=null,kn=null,Pn=null,wo=new Map,Co=new Map,In=[],Ig="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lu(t,e){switch(t){case"focusin":case"focusout":Rn=null;break;case"dragenter":case"dragleave":kn=null;break;case"mouseover":case"mouseout":Pn=null;break;case"pointerover":case"pointerout":wo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Co.delete(e.pointerId)}}function Xr(t,e,n,r,o,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[o]},e!==null&&(e=Ho(e),e!==null&&_l(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function Ng(t,e,n,r,o){switch(e){case"focusin":return Rn=Xr(Rn,t,e,n,r,o),!0;case"dragenter":return kn=Xr(kn,t,e,n,r,o),!0;case"mouseover":return Pn=Xr(Pn,t,e,n,r,o),!0;case"pointerover":var i=o.pointerId;return wo.set(i,Xr(wo.get(i)||null,t,e,n,r,o)),!0;case"gotpointercapture":return i=o.pointerId,Co.set(i,Xr(Co.get(i)||null,t,e,n,r,o)),!0}return!1}function ih(t){var e=Kn(t.target);if(e!==null){var n=sr(e);if(n!==null){if(e=n.tag,e===13){if(e=qf(n),e!==null){t.blockedOn=e,oh(t.priority,function(){nh(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function pi(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Ia(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);xa=r,n.target.dispatchEvent(r),xa=null}else return e=Ho(n),e!==null&&_l(e),t.blockedOn=n,!1;e.shift()}return!0}function Ou(t,e,n){pi(t)&&n.delete(e)}function _g(){Ca=!1,Rn!==null&&pi(Rn)&&(Rn=null),kn!==null&&pi(kn)&&(kn=null),Pn!==null&&pi(Pn)&&(Pn=null),wo.forEach(Ou),Co.forEach(Ou)}function Zr(t,e){t.blockedOn===e&&(t.blockedOn=null,Ca||(Ca=!0,Pt.unstable_scheduleCallback(Pt.unstable_NormalPriority,_g)))}function Io(t){function e(o){return Zr(o,t)}if(0<Yo.length){Zr(Yo[0],t);for(var n=1;n<Yo.length;n++){var r=Yo[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Rn!==null&&Zr(Rn,t),kn!==null&&Zr(kn,t),Pn!==null&&Zr(Pn,t),wo.forEach(e),Co.forEach(e),n=0;n<In.length;n++)r=In[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<In.length&&(n=In[0],n.blockedOn===null);)ih(n),n.blockedOn===null&&In.shift()}var Rr=vn.ReactCurrentBatchConfig,Mi=!0;function bg(t,e,n,r){var o=He,i=Rr.transition;Rr.transition=null;try{He=1,bl(t,e,n,r)}finally{He=o,Rr.transition=i}}function Ag(t,e,n,r){var o=He,i=Rr.transition;Rr.transition=null;try{He=4,bl(t,e,n,r)}finally{He=o,Rr.transition=i}}function bl(t,e,n,r){if(Mi){var o=Ia(t,e,n,r);if(o===null)js(t,e,r,Li,n),Lu(t,r);else if(Ng(o,t,e,n,r))r.stopPropagation();else if(Lu(t,r),e&4&&-1<Ig.indexOf(t)){for(;o!==null;){var i=Ho(o);if(i!==null&&th(i),i=Ia(t,e,n,r),i===null&&js(t,e,r,Li,n),i===o)break;o=i}o!==null&&r.stopPropagation()}else js(t,e,r,null,n)}}var Li=null;function Ia(t,e,n,r){if(Li=null,t=Cl(r),t=Kn(t),t!==null)if(e=sr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=qf(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Li=t,null}function sh(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gg()){case Il:return 1;case Xf:return 4;case ki:case yg:return 16;case Zf:return 536870912;default:return 16}default:return 16}}var _n=null,Al=null,mi=null;function ah(){if(mi)return mi;var t,e=Al,n=e.length,r,o="value"in _n?_n.value:_n.textContent,i=o.length;for(t=0;t<n&&e[t]===o[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===o[i-r];r++);return mi=o.slice(t,1<r?1-r:void 0)}function gi(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ko(){return!0}function Du(){return!1}function Lt(t){function e(n,r,o,i,s){this._reactName=n,this._targetInst=o,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ko:Du,this.isPropagationStopped=Du,this}return Xe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ko)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ko)},persist:function(){},isPersistent:Ko}),e}var jr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rl=Lt(jr),Go=Xe({},jr,{view:0,detail:0}),Rg=Lt(Go),Os,Ds,Qr,as=Xe({},Go,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kl,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Qr&&(Qr&&t.type==="mousemove"?(Os=t.screenX-Qr.screenX,Ds=t.screenY-Qr.screenY):Ds=Os=0,Qr=t),Os)},movementY:function(t){return"movementY"in t?t.movementY:Ds}}),Uu=Lt(as),kg=Xe({},as,{dataTransfer:0}),Pg=Lt(kg),Mg=Xe({},Go,{relatedTarget:0}),Us=Lt(Mg),Lg=Xe({},jr,{animationName:0,elapsedTime:0,pseudoElement:0}),Og=Lt(Lg),Dg=Xe({},jr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Ug=Lt(Dg),Fg=Xe({},jr,{data:0}),Fu=Lt(Fg),Gg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Hg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vg(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Bg[t])?!!e[t]:!1}function kl(){return Vg}var zg=Xe({},Go,{key:function(t){if(t.key){var e=Gg[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=gi(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Hg[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kl,charCode:function(t){return t.type==="keypress"?gi(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?gi(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),jg=Lt(zg),$g=Xe({},as,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gu=Lt($g),Wg=Xe({},Go,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kl}),qg=Lt(Wg),Yg=Xe({},jr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Kg=Lt(Yg),Jg=Xe({},as,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Xg=Lt(Jg),Zg=[9,13,27,32],Pl=hn&&"CompositionEvent"in window,ho=null;hn&&"documentMode"in document&&(ho=document.documentMode);var Qg=hn&&"TextEvent"in window&&!ho,lh=hn&&(!Pl||ho&&8<ho&&11>=ho),Hu=" ",Bu=!1;function uh(t,e){switch(t){case"keyup":return Zg.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ch(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var pr=!1;function e0(t,e){switch(t){case"compositionend":return ch(e);case"keypress":return e.which!==32?null:(Bu=!0,Hu);case"textInput":return t=e.data,t===Hu&&Bu?null:t;default:return null}}function t0(t,e){if(pr)return t==="compositionend"||!Pl&&uh(t,e)?(t=ah(),mi=Al=_n=null,pr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return lh&&e.locale!=="ko"?null:e.data;default:return null}}var n0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vu(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!n0[t.type]:e==="textarea"}function dh(t,e,n,r){Vf(r),e=Oi(e,"onChange"),0<e.length&&(n=new Rl("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var po=null,No=null;function r0(t){Sh(t,0)}function ls(t){var e=yr(t);if(Of(e))return t}function o0(t,e){if(t==="change")return e}var fh=!1;if(hn){var Fs;if(hn){var Gs="oninput"in document;if(!Gs){var zu=document.createElement("div");zu.setAttribute("oninput","return;"),Gs=typeof zu.oninput=="function"}Fs=Gs}else Fs=!1;fh=Fs&&(!document.documentMode||9<document.documentMode)}function ju(){po&&(po.detachEvent("onpropertychange",hh),No=po=null)}function hh(t){if(t.propertyName==="value"&&ls(No)){var e=[];dh(e,No,t,Cl(t)),Wf(r0,e)}}function i0(t,e,n){t==="focusin"?(ju(),po=e,No=n,po.attachEvent("onpropertychange",hh)):t==="focusout"&&ju()}function s0(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ls(No)}function a0(t,e){if(t==="click")return ls(e)}function l0(t,e){if(t==="input"||t==="change")return ls(e)}function u0(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Xt=typeof Object.is=="function"?Object.is:u0;function _o(t,e){if(Xt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!aa.call(e,o)||!Xt(t[o],e[o]))return!1}return!0}function $u(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Wu(t,e){var n=$u(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=$u(n)}}function ph(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?ph(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function mh(){for(var t=window,e=bi();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=bi(t.document)}return e}function Ml(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function c0(t){var e=mh(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&ph(n.ownerDocument.documentElement,n)){if(r!==null&&Ml(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=n.textContent.length,i=Math.min(r.start,o);r=r.end===void 0?i:Math.min(r.end,o),!t.extend&&i>r&&(o=r,r=i,i=o),o=Wu(n,i);var s=Wu(n,r);o&&s&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var d0=hn&&"documentMode"in document&&11>=document.documentMode,mr=null,Na=null,mo=null,_a=!1;function qu(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;_a||mr==null||mr!==bi(r)||(r=mr,"selectionStart"in r&&Ml(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),mo&&_o(mo,r)||(mo=r,r=Oi(Na,"onSelect"),0<r.length&&(e=new Rl("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=mr)))}function Jo(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var gr={animationend:Jo("Animation","AnimationEnd"),animationiteration:Jo("Animation","AnimationIteration"),animationstart:Jo("Animation","AnimationStart"),transitionend:Jo("Transition","TransitionEnd")},Hs={},gh={};hn&&(gh=document.createElement("div").style,"AnimationEvent"in window||(delete gr.animationend.animation,delete gr.animationiteration.animation,delete gr.animationstart.animation),"TransitionEvent"in window||delete gr.transitionend.transition);function us(t){if(Hs[t])return Hs[t];if(!gr[t])return t;var e=gr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in gh)return Hs[t]=e[n];return t}var yh=us("animationend"),vh=us("animationiteration"),xh=us("animationstart"),Eh=us("transitionend"),Th=new Map,Yu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vn(t,e){Th.set(t,e),ir(e,[t])}for(var Bs=0;Bs<Yu.length;Bs++){var Vs=Yu[Bs],f0=Vs.toLowerCase(),h0=Vs[0].toUpperCase()+Vs.slice(1);Vn(f0,"on"+h0)}Vn(yh,"onAnimationEnd");Vn(vh,"onAnimationIteration");Vn(xh,"onAnimationStart");Vn("dblclick","onDoubleClick");Vn("focusin","onFocus");Vn("focusout","onBlur");Vn(Eh,"onTransitionEnd");Or("onMouseEnter",["mouseout","mouseover"]);Or("onMouseLeave",["mouseout","mouseover"]);Or("onPointerEnter",["pointerout","pointerover"]);Or("onPointerLeave",["pointerout","pointerover"]);ir("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ir("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ir("onBeforeInput",["compositionend","keypress","textInput","paste"]);ir("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ir("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ir("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),p0=new Set("cancel close invalid load scroll toggle".split(" ").concat(lo));function Ku(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,fg(r,e,void 0,t),t.currentTarget=null}function Sh(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],o=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],u=a.instance,c=a.currentTarget;if(a=a.listener,u!==i&&o.isPropagationStopped())break e;Ku(o,a,c),i=u}else for(s=0;s<r.length;s++){if(a=r[s],u=a.instance,c=a.currentTarget,a=a.listener,u!==i&&o.isPropagationStopped())break e;Ku(o,a,c),i=u}}}if(Ri)throw t=Sa,Ri=!1,Sa=null,t}function We(t,e){var n=e[Pa];n===void 0&&(n=e[Pa]=new Set);var r=t+"__bubble";n.has(r)||(wh(e,t,2,!1),n.add(r))}function zs(t,e,n){var r=0;e&&(r|=4),wh(n,t,r,e)}var Xo="_reactListening"+Math.random().toString(36).slice(2);function bo(t){if(!t[Xo]){t[Xo]=!0,Rf.forEach(function(n){n!=="selectionchange"&&(p0.has(n)||zs(n,!1,t),zs(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Xo]||(e[Xo]=!0,zs("selectionchange",!1,e))}}function wh(t,e,n,r){switch(sh(e)){case 1:var o=bg;break;case 4:o=Ag;break;default:o=bl}n=o.bind(null,e,n,t),o=void 0,!Ta||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),r?o!==void 0?t.addEventListener(e,n,{capture:!0,passive:o}):t.addEventListener(e,n,!0):o!==void 0?t.addEventListener(e,n,{passive:o}):t.addEventListener(e,n,!1)}function js(t,e,n,r,o){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===o||a.nodeType===8&&a.parentNode===o)break;if(s===4)for(s=r.return;s!==null;){var u=s.tag;if((u===3||u===4)&&(u=s.stateNode.containerInfo,u===o||u.nodeType===8&&u.parentNode===o))return;s=s.return}for(;a!==null;){if(s=Kn(a),s===null)return;if(u=s.tag,u===5||u===6){r=i=s;continue e}a=a.parentNode}}r=r.return}Wf(function(){var c=i,h=Cl(n),p=[];e:{var m=Th.get(t);if(m!==void 0){var g=Rl,E=t;switch(t){case"keypress":if(gi(n)===0)break e;case"keydown":case"keyup":g=jg;break;case"focusin":E="focus",g=Us;break;case"focusout":E="blur",g=Us;break;case"beforeblur":case"afterblur":g=Us;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=Uu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=Pg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=qg;break;case yh:case vh:case xh:g=Og;break;case Eh:g=Kg;break;case"scroll":g=Rg;break;case"wheel":g=Xg;break;case"copy":case"cut":case"paste":g=Ug;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=Gu}var v=(e&4)!==0,w=!v&&t==="scroll",y=v?m!==null?m+"Capture":null:m;v=[];for(var x=c,T;x!==null;){T=x;var I=T.stateNode;if(T.tag===5&&I!==null&&(T=I,y!==null&&(I=So(x,y),I!=null&&v.push(Ao(x,I,T)))),w)break;x=x.return}0<v.length&&(m=new g(m,E,null,n,h),p.push({event:m,listeners:v}))}}if(!(e&7)){e:{if(m=t==="mouseover"||t==="pointerover",g=t==="mouseout"||t==="pointerout",m&&n!==xa&&(E=n.relatedTarget||n.fromElement)&&(Kn(E)||E[pn]))break e;if((g||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,g?(E=n.relatedTarget||n.toElement,g=c,E=E?Kn(E):null,E!==null&&(w=sr(E),E!==w||E.tag!==5&&E.tag!==6)&&(E=null)):(g=null,E=c),g!==E)){if(v=Uu,I="onMouseLeave",y="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(v=Gu,I="onPointerLeave",y="onPointerEnter",x="pointer"),w=g==null?m:yr(g),T=E==null?m:yr(E),m=new v(I,x+"leave",g,n,h),m.target=w,m.relatedTarget=T,I=null,Kn(h)===c&&(v=new v(y,x+"enter",E,n,h),v.target=T,v.relatedTarget=w,I=v),w=I,g&&E)t:{for(v=g,y=E,x=0,T=v;T;T=lr(T))x++;for(T=0,I=y;I;I=lr(I))T++;for(;0<x-T;)v=lr(v),x--;for(;0<T-x;)y=lr(y),T--;for(;x--;){if(v===y||y!==null&&v===y.alternate)break t;v=lr(v),y=lr(y)}v=null}else v=null;g!==null&&Ju(p,m,g,v,!1),E!==null&&w!==null&&Ju(p,w,E,v,!0)}}e:{if(m=c?yr(c):window,g=m.nodeName&&m.nodeName.toLowerCase(),g==="select"||g==="input"&&m.type==="file")var _=o0;else if(Vu(m))if(fh)_=l0;else{_=s0;var R=i0}else(g=m.nodeName)&&g.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(_=a0);if(_&&(_=_(t,c))){dh(p,_,n,h);break e}R&&R(t,m,c),t==="focusout"&&(R=m._wrapperState)&&R.controlled&&m.type==="number"&&pa(m,"number",m.value)}switch(R=c?yr(c):window,t){case"focusin":(Vu(R)||R.contentEditable==="true")&&(mr=R,Na=c,mo=null);break;case"focusout":mo=Na=mr=null;break;case"mousedown":_a=!0;break;case"contextmenu":case"mouseup":case"dragend":_a=!1,qu(p,n,h);break;case"selectionchange":if(d0)break;case"keydown":case"keyup":qu(p,n,h)}var k;if(Pl)e:{switch(t){case"compositionstart":var j="onCompositionStart";break e;case"compositionend":j="onCompositionEnd";break e;case"compositionupdate":j="onCompositionUpdate";break e}j=void 0}else pr?uh(t,n)&&(j="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(j="onCompositionStart");j&&(lh&&n.locale!=="ko"&&(pr||j!=="onCompositionStart"?j==="onCompositionEnd"&&pr&&(k=ah()):(_n=h,Al="value"in _n?_n.value:_n.textContent,pr=!0)),R=Oi(c,j),0<R.length&&(j=new Fu(j,t,null,n,h),p.push({event:j,listeners:R}),k?j.data=k:(k=ch(n),k!==null&&(j.data=k)))),(k=Qg?e0(t,n):t0(t,n))&&(c=Oi(c,"onBeforeInput"),0<c.length&&(h=new Fu("onBeforeInput","beforeinput",null,n,h),p.push({event:h,listeners:c}),h.data=k))}Sh(p,e)})}function Ao(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Oi(t,e){for(var n=e+"Capture",r=[];t!==null;){var o=t,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=So(t,n),i!=null&&r.unshift(Ao(t,i,o)),i=So(t,e),i!=null&&r.push(Ao(t,i,o))),t=t.return}return r}function lr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ju(t,e,n,r,o){for(var i=e._reactName,s=[];n!==null&&n!==r;){var a=n,u=a.alternate,c=a.stateNode;if(u!==null&&u===r)break;a.tag===5&&c!==null&&(a=c,o?(u=So(n,i),u!=null&&s.unshift(Ao(n,u,a))):o||(u=So(n,i),u!=null&&s.push(Ao(n,u,a)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var m0=/\r\n?/g,g0=/\u0000|\uFFFD/g;function Xu(t){return(typeof t=="string"?t:""+t).replace(m0,`
`).replace(g0,"")}function Zo(t,e,n){if(e=Xu(e),Xu(t)!==e&&n)throw Error(he(425))}function Di(){}var ba=null,Aa=null;function Ra(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ka=typeof setTimeout=="function"?setTimeout:void 0,y0=typeof clearTimeout=="function"?clearTimeout:void 0,Zu=typeof Promise=="function"?Promise:void 0,v0=typeof queueMicrotask=="function"?queueMicrotask:typeof Zu<"u"?function(t){return Zu.resolve(null).then(t).catch(x0)}:ka;function x0(t){setTimeout(function(){throw t})}function $s(t,e){var n=e,r=0;do{var o=n.nextSibling;if(t.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(r===0){t.removeChild(o),Io(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=o}while(n);Io(e)}function Mn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Qu(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var $r=Math.random().toString(36).slice(2),nn="__reactFiber$"+$r,Ro="__reactProps$"+$r,pn="__reactContainer$"+$r,Pa="__reactEvents$"+$r,E0="__reactListeners$"+$r,T0="__reactHandles$"+$r;function Kn(t){var e=t[nn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[pn]||n[nn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Qu(t);t!==null;){if(n=t[nn])return n;t=Qu(t)}return e}t=n,n=t.parentNode}return null}function Ho(t){return t=t[nn]||t[pn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function yr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(he(33))}function cs(t){return t[Ro]||null}var Ma=[],vr=-1;function zn(t){return{current:t}}function qe(t){0>vr||(t.current=Ma[vr],Ma[vr]=null,vr--)}function je(t,e){vr++,Ma[vr]=t.current,t.current=e}var Hn={},yt=zn(Hn),Nt=zn(!1),er=Hn;function Dr(t,e){var n=t.type.contextTypes;if(!n)return Hn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function _t(t){return t=t.childContextTypes,t!=null}function Ui(){qe(Nt),qe(yt)}function ec(t,e,n){if(yt.current!==Hn)throw Error(he(168));je(yt,e),je(Nt,n)}function Ch(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var o in r)if(!(o in e))throw Error(he(108,ig(t)||"Unknown",o));return Xe({},n,r)}function Fi(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Hn,er=yt.current,je(yt,t),je(Nt,Nt.current),!0}function tc(t,e,n){var r=t.stateNode;if(!r)throw Error(he(169));n?(t=Ch(t,e,er),r.__reactInternalMemoizedMergedChildContext=t,qe(Nt),qe(yt),je(yt,t)):qe(Nt),je(Nt,n)}var ln=null,ds=!1,Ws=!1;function Ih(t){ln===null?ln=[t]:ln.push(t)}function S0(t){ds=!0,Ih(t)}function jn(){if(!Ws&&ln!==null){Ws=!0;var t=0,e=He;try{var n=ln;for(He=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}ln=null,ds=!1}catch(o){throw ln!==null&&(ln=ln.slice(t+1)),Jf(Il,jn),o}finally{He=e,Ws=!1}}return null}var xr=[],Er=0,Gi=null,Hi=0,Ot=[],Dt=0,tr=null,cn=1,dn="";function Wn(t,e){xr[Er++]=Hi,xr[Er++]=Gi,Gi=t,Hi=e}function Nh(t,e,n){Ot[Dt++]=cn,Ot[Dt++]=dn,Ot[Dt++]=tr,tr=t;var r=cn;t=dn;var o=32-qt(r)-1;r&=~(1<<o),n+=1;var i=32-qt(e)+o;if(30<i){var s=o-o%5;i=(r&(1<<s)-1).toString(32),r>>=s,o-=s,cn=1<<32-qt(e)+o|n<<o|r,dn=i+t}else cn=1<<i|n<<o|r,dn=t}function Ll(t){t.return!==null&&(Wn(t,1),Nh(t,1,0))}function Ol(t){for(;t===Gi;)Gi=xr[--Er],xr[Er]=null,Hi=xr[--Er],xr[Er]=null;for(;t===tr;)tr=Ot[--Dt],Ot[Dt]=null,dn=Ot[--Dt],Ot[Dt]=null,cn=Ot[--Dt],Ot[Dt]=null}var kt=null,Rt=null,Ye=!1,Wt=null;function _h(t,e){var n=Ut(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function nc(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,kt=t,Rt=Mn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,kt=t,Rt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=tr!==null?{id:cn,overflow:dn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Ut(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,kt=t,Rt=null,!0):!1;default:return!1}}function La(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Oa(t){if(Ye){var e=Rt;if(e){var n=e;if(!nc(t,e)){if(La(t))throw Error(he(418));e=Mn(n.nextSibling);var r=kt;e&&nc(t,e)?_h(r,n):(t.flags=t.flags&-4097|2,Ye=!1,kt=t)}}else{if(La(t))throw Error(he(418));t.flags=t.flags&-4097|2,Ye=!1,kt=t}}}function rc(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;kt=t}function Qo(t){if(t!==kt)return!1;if(!Ye)return rc(t),Ye=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Ra(t.type,t.memoizedProps)),e&&(e=Rt)){if(La(t))throw bh(),Error(he(418));for(;e;)_h(t,e),e=Mn(e.nextSibling)}if(rc(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(he(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Rt=Mn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Rt=null}}else Rt=kt?Mn(t.stateNode.nextSibling):null;return!0}function bh(){for(var t=Rt;t;)t=Mn(t.nextSibling)}function Ur(){Rt=kt=null,Ye=!1}function Dl(t){Wt===null?Wt=[t]:Wt.push(t)}var w0=vn.ReactCurrentBatchConfig;function eo(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(he(309));var r=n.stateNode}if(!r)throw Error(he(147,t));var o=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(s){var a=o.refs;s===null?delete a[i]:a[i]=s},e._stringRef=i,e)}if(typeof t!="string")throw Error(he(284));if(!n._owner)throw Error(he(290,t))}return t}function ei(t,e){throw t=Object.prototype.toString.call(e),Error(he(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function oc(t){var e=t._init;return e(t._payload)}function Ah(t){function e(y,x){if(t){var T=y.deletions;T===null?(y.deletions=[x],y.flags|=16):T.push(x)}}function n(y,x){if(!t)return null;for(;x!==null;)e(y,x),x=x.sibling;return null}function r(y,x){for(y=new Map;x!==null;)x.key!==null?y.set(x.key,x):y.set(x.index,x),x=x.sibling;return y}function o(y,x){return y=Un(y,x),y.index=0,y.sibling=null,y}function i(y,x,T){return y.index=T,t?(T=y.alternate,T!==null?(T=T.index,T<x?(y.flags|=2,x):T):(y.flags|=2,x)):(y.flags|=1048576,x)}function s(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,x,T,I){return x===null||x.tag!==6?(x=Qs(T,y.mode,I),x.return=y,x):(x=o(x,T),x.return=y,x)}function u(y,x,T,I){var _=T.type;return _===hr?h(y,x,T.props.children,I,T.key):x!==null&&(x.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===wn&&oc(_)===x.type)?(I=o(x,T.props),I.ref=eo(y,x,T),I.return=y,I):(I=wi(T.type,T.key,T.props,null,y.mode,I),I.ref=eo(y,x,T),I.return=y,I)}function c(y,x,T,I){return x===null||x.tag!==4||x.stateNode.containerInfo!==T.containerInfo||x.stateNode.implementation!==T.implementation?(x=ea(T,y.mode,I),x.return=y,x):(x=o(x,T.children||[]),x.return=y,x)}function h(y,x,T,I,_){return x===null||x.tag!==7?(x=Qn(T,y.mode,I,_),x.return=y,x):(x=o(x,T),x.return=y,x)}function p(y,x,T){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Qs(""+x,y.mode,T),x.return=y,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case zo:return T=wi(x.type,x.key,x.props,null,y.mode,T),T.ref=eo(y,null,x),T.return=y,T;case fr:return x=ea(x,y.mode,T),x.return=y,x;case wn:var I=x._init;return p(y,I(x._payload),T)}if(so(x)||Kr(x))return x=Qn(x,y.mode,T,null),x.return=y,x;ei(y,x)}return null}function m(y,x,T,I){var _=x!==null?x.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return _!==null?null:a(y,x,""+T,I);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case zo:return T.key===_?u(y,x,T,I):null;case fr:return T.key===_?c(y,x,T,I):null;case wn:return _=T._init,m(y,x,_(T._payload),I)}if(so(T)||Kr(T))return _!==null?null:h(y,x,T,I,null);ei(y,T)}return null}function g(y,x,T,I,_){if(typeof I=="string"&&I!==""||typeof I=="number")return y=y.get(T)||null,a(x,y,""+I,_);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case zo:return y=y.get(I.key===null?T:I.key)||null,u(x,y,I,_);case fr:return y=y.get(I.key===null?T:I.key)||null,c(x,y,I,_);case wn:var R=I._init;return g(y,x,T,R(I._payload),_)}if(so(I)||Kr(I))return y=y.get(T)||null,h(x,y,I,_,null);ei(x,I)}return null}function E(y,x,T,I){for(var _=null,R=null,k=x,j=x=0,D=null;k!==null&&j<T.length;j++){k.index>j?(D=k,k=null):D=k.sibling;var q=m(y,k,T[j],I);if(q===null){k===null&&(k=D);break}t&&k&&q.alternate===null&&e(y,k),x=i(q,x,j),R===null?_=q:R.sibling=q,R=q,k=D}if(j===T.length)return n(y,k),Ye&&Wn(y,j),_;if(k===null){for(;j<T.length;j++)k=p(y,T[j],I),k!==null&&(x=i(k,x,j),R===null?_=k:R.sibling=k,R=k);return Ye&&Wn(y,j),_}for(k=r(y,k);j<T.length;j++)D=g(k,y,j,T[j],I),D!==null&&(t&&D.alternate!==null&&k.delete(D.key===null?j:D.key),x=i(D,x,j),R===null?_=D:R.sibling=D,R=D);return t&&k.forEach(function(ae){return e(y,ae)}),Ye&&Wn(y,j),_}function v(y,x,T,I){var _=Kr(T);if(typeof _!="function")throw Error(he(150));if(T=_.call(T),T==null)throw Error(he(151));for(var R=_=null,k=x,j=x=0,D=null,q=T.next();k!==null&&!q.done;j++,q=T.next()){k.index>j?(D=k,k=null):D=k.sibling;var ae=m(y,k,q.value,I);if(ae===null){k===null&&(k=D);break}t&&k&&ae.alternate===null&&e(y,k),x=i(ae,x,j),R===null?_=ae:R.sibling=ae,R=ae,k=D}if(q.done)return n(y,k),Ye&&Wn(y,j),_;if(k===null){for(;!q.done;j++,q=T.next())q=p(y,q.value,I),q!==null&&(x=i(q,x,j),R===null?_=q:R.sibling=q,R=q);return Ye&&Wn(y,j),_}for(k=r(y,k);!q.done;j++,q=T.next())q=g(k,y,j,q.value,I),q!==null&&(t&&q.alternate!==null&&k.delete(q.key===null?j:q.key),x=i(q,x,j),R===null?_=q:R.sibling=q,R=q);return t&&k.forEach(function(P){return e(y,P)}),Ye&&Wn(y,j),_}function w(y,x,T,I){if(typeof T=="object"&&T!==null&&T.type===hr&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case zo:e:{for(var _=T.key,R=x;R!==null;){if(R.key===_){if(_=T.type,_===hr){if(R.tag===7){n(y,R.sibling),x=o(R,T.props.children),x.return=y,y=x;break e}}else if(R.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===wn&&oc(_)===R.type){n(y,R.sibling),x=o(R,T.props),x.ref=eo(y,R,T),x.return=y,y=x;break e}n(y,R);break}else e(y,R);R=R.sibling}T.type===hr?(x=Qn(T.props.children,y.mode,I,T.key),x.return=y,y=x):(I=wi(T.type,T.key,T.props,null,y.mode,I),I.ref=eo(y,x,T),I.return=y,y=I)}return s(y);case fr:e:{for(R=T.key;x!==null;){if(x.key===R)if(x.tag===4&&x.stateNode.containerInfo===T.containerInfo&&x.stateNode.implementation===T.implementation){n(y,x.sibling),x=o(x,T.children||[]),x.return=y,y=x;break e}else{n(y,x);break}else e(y,x);x=x.sibling}x=ea(T,y.mode,I),x.return=y,y=x}return s(y);case wn:return R=T._init,w(y,x,R(T._payload),I)}if(so(T))return E(y,x,T,I);if(Kr(T))return v(y,x,T,I);ei(y,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,x!==null&&x.tag===6?(n(y,x.sibling),x=o(x,T),x.return=y,y=x):(n(y,x),x=Qs(T,y.mode,I),x.return=y,y=x),s(y)):n(y,x)}return w}var Fr=Ah(!0),Rh=Ah(!1),Bi=zn(null),Vi=null,Tr=null,Ul=null;function Fl(){Ul=Tr=Vi=null}function Gl(t){var e=Bi.current;qe(Bi),t._currentValue=e}function Da(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function kr(t,e){Vi=t,Ul=Tr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(It=!0),t.firstContext=null)}function Ht(t){var e=t._currentValue;if(Ul!==t)if(t={context:t,memoizedValue:e,next:null},Tr===null){if(Vi===null)throw Error(he(308));Tr=t,Vi.dependencies={lanes:0,firstContext:t}}else Tr=Tr.next=t;return e}var Jn=null;function Hl(t){Jn===null?Jn=[t]:Jn.push(t)}function kh(t,e,n,r){var o=e.interleaved;return o===null?(n.next=n,Hl(e)):(n.next=o.next,o.next=n),e.interleaved=n,mn(t,r)}function mn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Cn=!1;function Bl(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ph(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function fn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ln(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Fe&2){var o=r.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),r.pending=e,mn(t,n)}return o=r.interleaved,o===null?(e.next=e,Hl(r)):(e.next=o.next,o.next=e),r.interleaved=e,mn(t,n)}function yi(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Nl(t,n)}}function ic(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=s:i=i.next=s,n=n.next}while(n!==null);i===null?o=i=e:i=i.next=e}else o=i=e;n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function zi(t,e,n,r){var o=t.updateQueue;Cn=!1;var i=o.firstBaseUpdate,s=o.lastBaseUpdate,a=o.shared.pending;if(a!==null){o.shared.pending=null;var u=a,c=u.next;u.next=null,s===null?i=c:s.next=c,s=u;var h=t.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==s&&(a===null?h.firstBaseUpdate=c:a.next=c,h.lastBaseUpdate=u))}if(i!==null){var p=o.baseState;s=0,h=c=u=null,a=i;do{var m=a.lane,g=a.eventTime;if((r&m)===m){h!==null&&(h=h.next={eventTime:g,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var E=t,v=a;switch(m=e,g=n,v.tag){case 1:if(E=v.payload,typeof E=="function"){p=E.call(g,p,m);break e}p=E;break e;case 3:E.flags=E.flags&-65537|128;case 0:if(E=v.payload,m=typeof E=="function"?E.call(g,p,m):E,m==null)break e;p=Xe({},p,m);break e;case 2:Cn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,m=o.effects,m===null?o.effects=[a]:m.push(a))}else g={eventTime:g,lane:m,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(c=h=g,u=p):h=h.next=g,s|=m;if(a=a.next,a===null){if(a=o.shared.pending,a===null)break;m=a,a=m.next,m.next=null,o.lastBaseUpdate=m,o.shared.pending=null}}while(!0);if(h===null&&(u=p),o.baseState=u,o.firstBaseUpdate=c,o.lastBaseUpdate=h,e=o.shared.interleaved,e!==null){o=e;do s|=o.lane,o=o.next;while(o!==e)}else i===null&&(o.shared.lanes=0);rr|=s,t.lanes=s,t.memoizedState=p}}function sc(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],o=r.callback;if(o!==null){if(r.callback=null,r=n,typeof o!="function")throw Error(he(191,o));o.call(r)}}}var Bo={},on=zn(Bo),ko=zn(Bo),Po=zn(Bo);function Xn(t){if(t===Bo)throw Error(he(174));return t}function Vl(t,e){switch(je(Po,e),je(ko,t),je(on,Bo),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ga(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ga(e,t)}qe(on),je(on,e)}function Gr(){qe(on),qe(ko),qe(Po)}function Mh(t){Xn(Po.current);var e=Xn(on.current),n=ga(e,t.type);e!==n&&(je(ko,t),je(on,n))}function zl(t){ko.current===t&&(qe(on),qe(ko))}var Ke=zn(0);function ji(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var qs=[];function jl(){for(var t=0;t<qs.length;t++)qs[t]._workInProgressVersionPrimary=null;qs.length=0}var vi=vn.ReactCurrentDispatcher,Ys=vn.ReactCurrentBatchConfig,nr=0,Je=null,rt=null,st=null,$i=!1,go=!1,Mo=0,C0=0;function ht(){throw Error(he(321))}function $l(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Xt(t[n],e[n]))return!1;return!0}function Wl(t,e,n,r,o,i){if(nr=i,Je=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,vi.current=t===null||t.memoizedState===null?b0:A0,t=n(r,o),go){i=0;do{if(go=!1,Mo=0,25<=i)throw Error(he(301));i+=1,st=rt=null,e.updateQueue=null,vi.current=R0,t=n(r,o)}while(go)}if(vi.current=Wi,e=rt!==null&&rt.next!==null,nr=0,st=rt=Je=null,$i=!1,e)throw Error(he(300));return t}function ql(){var t=Mo!==0;return Mo=0,t}function tn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return st===null?Je.memoizedState=st=t:st=st.next=t,st}function Bt(){if(rt===null){var t=Je.alternate;t=t!==null?t.memoizedState:null}else t=rt.next;var e=st===null?Je.memoizedState:st.next;if(e!==null)st=e,rt=t;else{if(t===null)throw Error(he(310));rt=t,t={memoizedState:rt.memoizedState,baseState:rt.baseState,baseQueue:rt.baseQueue,queue:rt.queue,next:null},st===null?Je.memoizedState=st=t:st=st.next=t}return st}function Lo(t,e){return typeof e=="function"?e(t):e}function Ks(t){var e=Bt(),n=e.queue;if(n===null)throw Error(he(311));n.lastRenderedReducer=t;var r=rt,o=r.baseQueue,i=n.pending;if(i!==null){if(o!==null){var s=o.next;o.next=i.next,i.next=s}r.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,r=r.baseState;var a=s=null,u=null,c=i;do{var h=c.lane;if((nr&h)===h)u!==null&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var p={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};u===null?(a=u=p,s=r):u=u.next=p,Je.lanes|=h,rr|=h}c=c.next}while(c!==null&&c!==i);u===null?s=r:u.next=a,Xt(r,e.memoizedState)||(It=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){o=t;do i=o.lane,Je.lanes|=i,rr|=i,o=o.next;while(o!==t)}else o===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Js(t){var e=Bt(),n=e.queue;if(n===null)throw Error(he(311));n.lastRenderedReducer=t;var r=n.dispatch,o=n.pending,i=e.memoizedState;if(o!==null){n.pending=null;var s=o=o.next;do i=t(i,s.action),s=s.next;while(s!==o);Xt(i,e.memoizedState)||(It=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function Lh(){}function Oh(t,e){var n=Je,r=Bt(),o=e(),i=!Xt(r.memoizedState,o);if(i&&(r.memoizedState=o,It=!0),r=r.queue,Yl(Fh.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||st!==null&&st.memoizedState.tag&1){if(n.flags|=2048,Oo(9,Uh.bind(null,n,r,o,e),void 0,null),at===null)throw Error(he(349));nr&30||Dh(n,e,o)}return o}function Dh(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Je.updateQueue,e===null?(e={lastEffect:null,stores:null},Je.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Uh(t,e,n,r){e.value=n,e.getSnapshot=r,Gh(e)&&Hh(t)}function Fh(t,e,n){return n(function(){Gh(e)&&Hh(t)})}function Gh(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Xt(t,n)}catch{return!0}}function Hh(t){var e=mn(t,1);e!==null&&Yt(e,t,1,-1)}function ac(t){var e=tn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Lo,lastRenderedState:t},e.queue=t,t=t.dispatch=_0.bind(null,Je,t),[e.memoizedState,t]}function Oo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Je.updateQueue,e===null?(e={lastEffect:null,stores:null},Je.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Bh(){return Bt().memoizedState}function xi(t,e,n,r){var o=tn();Je.flags|=t,o.memoizedState=Oo(1|e,n,void 0,r===void 0?null:r)}function fs(t,e,n,r){var o=Bt();r=r===void 0?null:r;var i=void 0;if(rt!==null){var s=rt.memoizedState;if(i=s.destroy,r!==null&&$l(r,s.deps)){o.memoizedState=Oo(e,n,i,r);return}}Je.flags|=t,o.memoizedState=Oo(1|e,n,i,r)}function lc(t,e){return xi(8390656,8,t,e)}function Yl(t,e){return fs(2048,8,t,e)}function Vh(t,e){return fs(4,2,t,e)}function zh(t,e){return fs(4,4,t,e)}function jh(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function $h(t,e,n){return n=n!=null?n.concat([t]):null,fs(4,4,jh.bind(null,e,t),n)}function Kl(){}function Wh(t,e){var n=Bt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&$l(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function qh(t,e){var n=Bt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&$l(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Yh(t,e,n){return nr&21?(Xt(n,e)||(n=Qf(),Je.lanes|=n,rr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,It=!0),t.memoizedState=n)}function I0(t,e){var n=He;He=n!==0&&4>n?n:4,t(!0);var r=Ys.transition;Ys.transition={};try{t(!1),e()}finally{He=n,Ys.transition=r}}function Kh(){return Bt().memoizedState}function N0(t,e,n){var r=Dn(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Jh(t))Xh(e,n);else if(n=kh(t,e,n,r),n!==null){var o=Et();Yt(n,t,r,o),Zh(n,e,r)}}function _0(t,e,n){var r=Dn(t),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Jh(t))Xh(e,o);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var s=e.lastRenderedState,a=i(s,n);if(o.hasEagerState=!0,o.eagerState=a,Xt(a,s)){var u=e.interleaved;u===null?(o.next=o,Hl(e)):(o.next=u.next,u.next=o),e.interleaved=o;return}}catch{}finally{}n=kh(t,e,o,r),n!==null&&(o=Et(),Yt(n,t,r,o),Zh(n,e,r))}}function Jh(t){var e=t.alternate;return t===Je||e!==null&&e===Je}function Xh(t,e){go=$i=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Zh(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Nl(t,n)}}var Wi={readContext:Ht,useCallback:ht,useContext:ht,useEffect:ht,useImperativeHandle:ht,useInsertionEffect:ht,useLayoutEffect:ht,useMemo:ht,useReducer:ht,useRef:ht,useState:ht,useDebugValue:ht,useDeferredValue:ht,useTransition:ht,useMutableSource:ht,useSyncExternalStore:ht,useId:ht,unstable_isNewReconciler:!1},b0={readContext:Ht,useCallback:function(t,e){return tn().memoizedState=[t,e===void 0?null:e],t},useContext:Ht,useEffect:lc,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,xi(4194308,4,jh.bind(null,e,t),n)},useLayoutEffect:function(t,e){return xi(4194308,4,t,e)},useInsertionEffect:function(t,e){return xi(4,2,t,e)},useMemo:function(t,e){var n=tn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=tn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=N0.bind(null,Je,t),[r.memoizedState,t]},useRef:function(t){var e=tn();return t={current:t},e.memoizedState=t},useState:ac,useDebugValue:Kl,useDeferredValue:function(t){return tn().memoizedState=t},useTransition:function(){var t=ac(!1),e=t[0];return t=I0.bind(null,t[1]),tn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Je,o=tn();if(Ye){if(n===void 0)throw Error(he(407));n=n()}else{if(n=e(),at===null)throw Error(he(349));nr&30||Dh(r,e,n)}o.memoizedState=n;var i={value:n,getSnapshot:e};return o.queue=i,lc(Fh.bind(null,r,i,t),[t]),r.flags|=2048,Oo(9,Uh.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=tn(),e=at.identifierPrefix;if(Ye){var n=dn,r=cn;n=(r&~(1<<32-qt(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Mo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=C0++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},A0={readContext:Ht,useCallback:Wh,useContext:Ht,useEffect:Yl,useImperativeHandle:$h,useInsertionEffect:Vh,useLayoutEffect:zh,useMemo:qh,useReducer:Ks,useRef:Bh,useState:function(){return Ks(Lo)},useDebugValue:Kl,useDeferredValue:function(t){var e=Bt();return Yh(e,rt.memoizedState,t)},useTransition:function(){var t=Ks(Lo)[0],e=Bt().memoizedState;return[t,e]},useMutableSource:Lh,useSyncExternalStore:Oh,useId:Kh,unstable_isNewReconciler:!1},R0={readContext:Ht,useCallback:Wh,useContext:Ht,useEffect:Yl,useImperativeHandle:$h,useInsertionEffect:Vh,useLayoutEffect:zh,useMemo:qh,useReducer:Js,useRef:Bh,useState:function(){return Js(Lo)},useDebugValue:Kl,useDeferredValue:function(t){var e=Bt();return rt===null?e.memoizedState=t:Yh(e,rt.memoizedState,t)},useTransition:function(){var t=Js(Lo)[0],e=Bt().memoizedState;return[t,e]},useMutableSource:Lh,useSyncExternalStore:Oh,useId:Kh,unstable_isNewReconciler:!1};function jt(t,e){if(t&&t.defaultProps){e=Xe({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Ua(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Xe({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var hs={isMounted:function(t){return(t=t._reactInternals)?sr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Et(),o=Dn(t),i=fn(r,o);i.payload=e,n!=null&&(i.callback=n),e=Ln(t,i,o),e!==null&&(Yt(e,t,o,r),yi(e,t,o))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Et(),o=Dn(t),i=fn(r,o);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Ln(t,i,o),e!==null&&(Yt(e,t,o,r),yi(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Et(),r=Dn(t),o=fn(n,r);o.tag=2,e!=null&&(o.callback=e),e=Ln(t,o,r),e!==null&&(Yt(e,t,r,n),yi(e,t,r))}};function uc(t,e,n,r,o,i,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,s):e.prototype&&e.prototype.isPureReactComponent?!_o(n,r)||!_o(o,i):!0}function Qh(t,e,n){var r=!1,o=Hn,i=e.contextType;return typeof i=="object"&&i!==null?i=Ht(i):(o=_t(e)?er:yt.current,r=e.contextTypes,i=(r=r!=null)?Dr(t,o):Hn),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=hs,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=i),e}function cc(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&hs.enqueueReplaceState(e,e.state,null)}function Fa(t,e,n,r){var o=t.stateNode;o.props=n,o.state=t.memoizedState,o.refs={},Bl(t);var i=e.contextType;typeof i=="object"&&i!==null?o.context=Ht(i):(i=_t(e)?er:yt.current,o.context=Dr(t,i)),o.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Ua(t,e,i,n),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&hs.enqueueReplaceState(o,o.state,null),zi(t,n,o,r),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function Hr(t,e){try{var n="",r=e;do n+=og(r),r=r.return;while(r);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:o,digest:null}}function Xs(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Ga(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var k0=typeof WeakMap=="function"?WeakMap:Map;function ep(t,e,n){n=fn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Yi||(Yi=!0,Ka=r),Ga(t,e)},n}function tp(t,e,n){n=fn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var o=e.value;n.payload=function(){return r(o)},n.callback=function(){Ga(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Ga(t,e),typeof r!="function"&&(On===null?On=new Set([this]):On.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}function dc(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new k0;var o=new Set;r.set(e,o)}else o=r.get(e),o===void 0&&(o=new Set,r.set(e,o));o.has(n)||(o.add(n),t=$0.bind(null,t,e,n),e.then(t,t))}function fc(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function hc(t,e,n,r,o){return t.mode&1?(t.flags|=65536,t.lanes=o,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=fn(-1,1),e.tag=2,Ln(n,e,1))),n.lanes|=1),t)}var P0=vn.ReactCurrentOwner,It=!1;function xt(t,e,n,r){e.child=t===null?Rh(e,null,n,r):Fr(e,t.child,n,r)}function pc(t,e,n,r,o){n=n.render;var i=e.ref;return kr(e,o),r=Wl(t,e,n,r,i,o),n=ql(),t!==null&&!It?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,gn(t,e,o)):(Ye&&n&&Ll(e),e.flags|=1,xt(t,e,r,o),e.child)}function mc(t,e,n,r,o){if(t===null){var i=n.type;return typeof i=="function"&&!ru(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,np(t,e,i,r,o)):(t=wi(n.type,null,r,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&o)){var s=i.memoizedProps;if(n=n.compare,n=n!==null?n:_o,n(s,r)&&t.ref===e.ref)return gn(t,e,o)}return e.flags|=1,t=Un(i,r),t.ref=e.ref,t.return=e,e.child=t}function np(t,e,n,r,o){if(t!==null){var i=t.memoizedProps;if(_o(i,r)&&t.ref===e.ref)if(It=!1,e.pendingProps=r=i,(t.lanes&o)!==0)t.flags&131072&&(It=!0);else return e.lanes=t.lanes,gn(t,e,o)}return Ha(t,e,n,r,o)}function rp(t,e,n){var r=e.pendingProps,o=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},je(wr,At),At|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,je(wr,At),At|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,je(wr,At),At|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,je(wr,At),At|=r;return xt(t,e,o,n),e.child}function op(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Ha(t,e,n,r,o){var i=_t(n)?er:yt.current;return i=Dr(e,i),kr(e,o),n=Wl(t,e,n,r,i,o),r=ql(),t!==null&&!It?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,gn(t,e,o)):(Ye&&r&&Ll(e),e.flags|=1,xt(t,e,n,o),e.child)}function gc(t,e,n,r,o){if(_t(n)){var i=!0;Fi(e)}else i=!1;if(kr(e,o),e.stateNode===null)Ei(t,e),Qh(e,n,r),Fa(e,n,r,o),r=!0;else if(t===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var u=s.context,c=n.contextType;typeof c=="object"&&c!==null?c=Ht(c):(c=_t(n)?er:yt.current,c=Dr(e,c));var h=n.getDerivedStateFromProps,p=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function";p||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||u!==c)&&cc(e,s,r,c),Cn=!1;var m=e.memoizedState;s.state=m,zi(e,r,s,o),u=e.memoizedState,a!==r||m!==u||Nt.current||Cn?(typeof h=="function"&&(Ua(e,n,h,r),u=e.memoizedState),(a=Cn||uc(e,n,a,r,m,u,c))?(p||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),s.props=r,s.state=u,s.context=c,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,Ph(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:jt(e.type,a),s.props=c,p=e.pendingProps,m=s.context,u=n.contextType,typeof u=="object"&&u!==null?u=Ht(u):(u=_t(n)?er:yt.current,u=Dr(e,u));var g=n.getDerivedStateFromProps;(h=typeof g=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==p||m!==u)&&cc(e,s,r,u),Cn=!1,m=e.memoizedState,s.state=m,zi(e,r,s,o);var E=e.memoizedState;a!==p||m!==E||Nt.current||Cn?(typeof g=="function"&&(Ua(e,n,g,r),E=e.memoizedState),(c=Cn||uc(e,n,c,r,m,E,u)||!1)?(h||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,E,u),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,E,u)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=E),s.props=r,s.state=E,s.context=u,r=c):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),r=!1)}return Ba(t,e,n,r,i,o)}function Ba(t,e,n,r,o,i){op(t,e);var s=(e.flags&128)!==0;if(!r&&!s)return o&&tc(e,n,!1),gn(t,e,i);r=e.stateNode,P0.current=e;var a=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&s?(e.child=Fr(e,t.child,null,i),e.child=Fr(e,null,a,i)):xt(t,e,a,i),e.memoizedState=r.state,o&&tc(e,n,!0),e.child}function ip(t){var e=t.stateNode;e.pendingContext?ec(t,e.pendingContext,e.pendingContext!==e.context):e.context&&ec(t,e.context,!1),Vl(t,e.containerInfo)}function yc(t,e,n,r,o){return Ur(),Dl(o),e.flags|=256,xt(t,e,n,r),e.child}var Va={dehydrated:null,treeContext:null,retryLane:0};function za(t){return{baseLanes:t,cachePool:null,transitions:null}}function sp(t,e,n){var r=e.pendingProps,o=Ke.current,i=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=t!==null&&t.memoizedState===null?!1:(o&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),je(Ke,o&1),t===null)return Oa(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,t=r.fallback,i?(r=e.mode,i=e.child,s={mode:"hidden",children:s},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=s):i=gs(s,r,0,null),t=Qn(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=za(n),e.memoizedState=Va,t):Jl(e,s));if(o=t.memoizedState,o!==null&&(a=o.dehydrated,a!==null))return M0(t,e,s,r,a,o,n);if(i){i=r.fallback,s=e.mode,o=t.child,a=o.sibling;var u={mode:"hidden",children:r.children};return!(s&1)&&e.child!==o?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Un(o,u),r.subtreeFlags=o.subtreeFlags&14680064),a!==null?i=Un(a,i):(i=Qn(i,s,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,s=t.child.memoizedState,s=s===null?za(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},i.memoizedState=s,i.childLanes=t.childLanes&~n,e.memoizedState=Va,r}return i=t.child,t=i.sibling,r=Un(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Jl(t,e){return e=gs({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ti(t,e,n,r){return r!==null&&Dl(r),Fr(e,t.child,null,n),t=Jl(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function M0(t,e,n,r,o,i,s){if(n)return e.flags&256?(e.flags&=-257,r=Xs(Error(he(422))),ti(t,e,s,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,o=e.mode,r=gs({mode:"visible",children:r.children},o,0,null),i=Qn(i,o,s,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Fr(e,t.child,null,s),e.child.memoizedState=za(s),e.memoizedState=Va,i);if(!(e.mode&1))return ti(t,e,s,null);if(o.data==="$!"){if(r=o.nextSibling&&o.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(he(419)),r=Xs(i,r,void 0),ti(t,e,s,r)}if(a=(s&t.childLanes)!==0,It||a){if(r=at,r!==null){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(r.suspendedLanes|s)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,mn(t,o),Yt(r,t,o,-1))}return nu(),r=Xs(Error(he(421))),ti(t,e,s,r)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=W0.bind(null,t),o._reactRetry=e,null):(t=i.treeContext,Rt=Mn(o.nextSibling),kt=e,Ye=!0,Wt=null,t!==null&&(Ot[Dt++]=cn,Ot[Dt++]=dn,Ot[Dt++]=tr,cn=t.id,dn=t.overflow,tr=e),e=Jl(e,r.children),e.flags|=4096,e)}function vc(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Da(t.return,e,n)}function Zs(t,e,n,r,o){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o)}function ap(t,e,n){var r=e.pendingProps,o=r.revealOrder,i=r.tail;if(xt(t,e,r.children,n),r=Ke.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&vc(t,n,e);else if(t.tag===19)vc(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(je(Ke,r),!(e.mode&1))e.memoizedState=null;else switch(o){case"forwards":for(n=e.child,o=null;n!==null;)t=n.alternate,t!==null&&ji(t)===null&&(o=n),n=n.sibling;n=o,n===null?(o=e.child,e.child=null):(o=n.sibling,n.sibling=null),Zs(e,!1,o,n,i);break;case"backwards":for(n=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&ji(t)===null){e.child=o;break}t=o.sibling,o.sibling=n,n=o,o=t}Zs(e,!0,n,null,i);break;case"together":Zs(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ei(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function gn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),rr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(he(153));if(e.child!==null){for(t=e.child,n=Un(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Un(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function L0(t,e,n){switch(e.tag){case 3:ip(e),Ur();break;case 5:Mh(e);break;case 1:_t(e.type)&&Fi(e);break;case 4:Vl(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,o=e.memoizedProps.value;je(Bi,r._currentValue),r._currentValue=o;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(je(Ke,Ke.current&1),e.flags|=128,null):n&e.child.childLanes?sp(t,e,n):(je(Ke,Ke.current&1),t=gn(t,e,n),t!==null?t.sibling:null);je(Ke,Ke.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return ap(t,e,n);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),je(Ke,Ke.current),r)break;return null;case 22:case 23:return e.lanes=0,rp(t,e,n)}return gn(t,e,n)}var lp,ja,up,cp;lp=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ja=function(){};up=function(t,e,n,r){var o=t.memoizedProps;if(o!==r){t=e.stateNode,Xn(on.current);var i=null;switch(n){case"input":o=fa(t,o),r=fa(t,r),i=[];break;case"select":o=Xe({},o,{value:void 0}),r=Xe({},r,{value:void 0}),i=[];break;case"textarea":o=ma(t,o),r=ma(t,r),i=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Di)}ya(n,r);var s;n=null;for(c in o)if(!r.hasOwnProperty(c)&&o.hasOwnProperty(c)&&o[c]!=null)if(c==="style"){var a=o[c];for(s in a)a.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Eo.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in r){var u=r[c];if(a=o!=null?o[c]:void 0,r.hasOwnProperty(c)&&u!==a&&(u!=null||a!=null))if(c==="style")if(a){for(s in a)!a.hasOwnProperty(s)||u&&u.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in u)u.hasOwnProperty(s)&&a[s]!==u[s]&&(n||(n={}),n[s]=u[s])}else n||(i||(i=[]),i.push(c,n)),n=u;else c==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,a=a?a.__html:void 0,u!=null&&a!==u&&(i=i||[]).push(c,u)):c==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(c,""+u):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Eo.hasOwnProperty(c)?(u!=null&&c==="onScroll"&&We("scroll",t),i||a===u||(i=[])):(i=i||[]).push(c,u))}n&&(i=i||[]).push("style",n);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};cp=function(t,e,n,r){n!==r&&(e.flags|=4)};function to(t,e){if(!Ye)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function pt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var o=t.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags&14680064,r|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function O0(t,e,n){var r=e.pendingProps;switch(Ol(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pt(e),null;case 1:return _t(e.type)&&Ui(),pt(e),null;case 3:return r=e.stateNode,Gr(),qe(Nt),qe(yt),jl(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Qo(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Wt!==null&&(Za(Wt),Wt=null))),ja(t,e),pt(e),null;case 5:zl(e);var o=Xn(Po.current);if(n=e.type,t!==null&&e.stateNode!=null)up(t,e,n,r,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(he(166));return pt(e),null}if(t=Xn(on.current),Qo(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[nn]=e,r[Ro]=i,t=(e.mode&1)!==0,n){case"dialog":We("cancel",r),We("close",r);break;case"iframe":case"object":case"embed":We("load",r);break;case"video":case"audio":for(o=0;o<lo.length;o++)We(lo[o],r);break;case"source":We("error",r);break;case"img":case"image":case"link":We("error",r),We("load",r);break;case"details":We("toggle",r);break;case"input":_u(r,i),We("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},We("invalid",r);break;case"textarea":Au(r,i),We("invalid",r)}ya(n,i),o=null;for(var s in i)if(i.hasOwnProperty(s)){var a=i[s];s==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Zo(r.textContent,a,t),o=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Zo(r.textContent,a,t),o=["children",""+a]):Eo.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&We("scroll",r)}switch(n){case"input":jo(r),bu(r,i,!0);break;case"textarea":jo(r),Ru(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Di)}r=o,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Ff(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=s.createElement(n,{is:r.is}):(t=s.createElement(n),n==="select"&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,n),t[nn]=e,t[Ro]=r,lp(t,e,!1,!1),e.stateNode=t;e:{switch(s=va(n,r),n){case"dialog":We("cancel",t),We("close",t),o=r;break;case"iframe":case"object":case"embed":We("load",t),o=r;break;case"video":case"audio":for(o=0;o<lo.length;o++)We(lo[o],t);o=r;break;case"source":We("error",t),o=r;break;case"img":case"image":case"link":We("error",t),We("load",t),o=r;break;case"details":We("toggle",t),o=r;break;case"input":_u(t,r),o=fa(t,r),We("invalid",t);break;case"option":o=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},o=Xe({},r,{value:void 0}),We("invalid",t);break;case"textarea":Au(t,r),o=ma(t,r),We("invalid",t);break;default:o=r}ya(n,o),a=o;for(i in a)if(a.hasOwnProperty(i)){var u=a[i];i==="style"?Bf(t,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&Gf(t,u)):i==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&To(t,u):typeof u=="number"&&To(t,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Eo.hasOwnProperty(i)?u!=null&&i==="onScroll"&&We("scroll",t):u!=null&&El(t,i,u,s))}switch(n){case"input":jo(t),bu(t,r,!1);break;case"textarea":jo(t),Ru(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Gn(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?_r(t,!!r.multiple,i,!1):r.defaultValue!=null&&_r(t,!!r.multiple,r.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=Di)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return pt(e),null;case 6:if(t&&e.stateNode!=null)cp(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(he(166));if(n=Xn(Po.current),Xn(on.current),Qo(e)){if(r=e.stateNode,n=e.memoizedProps,r[nn]=e,(i=r.nodeValue!==n)&&(t=kt,t!==null))switch(t.tag){case 3:Zo(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Zo(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[nn]=e,e.stateNode=r}return pt(e),null;case 13:if(qe(Ke),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ye&&Rt!==null&&e.mode&1&&!(e.flags&128))bh(),Ur(),e.flags|=98560,i=!1;else if(i=Qo(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(he(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(he(317));i[nn]=e}else Ur(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;pt(e),i=!1}else Wt!==null&&(Za(Wt),Wt=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Ke.current&1?ot===0&&(ot=3):nu())),e.updateQueue!==null&&(e.flags|=4),pt(e),null);case 4:return Gr(),ja(t,e),t===null&&bo(e.stateNode.containerInfo),pt(e),null;case 10:return Gl(e.type._context),pt(e),null;case 17:return _t(e.type)&&Ui(),pt(e),null;case 19:if(qe(Ke),i=e.memoizedState,i===null)return pt(e),null;if(r=(e.flags&128)!==0,s=i.rendering,s===null)if(r)to(i,!1);else{if(ot!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=ji(t),s!==null){for(e.flags|=128,to(i,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,s=i.alternate,s===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,i.type=s.type,t=s.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return je(Ke,Ke.current&1|2),e.child}t=t.sibling}i.tail!==null&&Qe()>Br&&(e.flags|=128,r=!0,to(i,!1),e.lanes=4194304)}else{if(!r)if(t=ji(s),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),to(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!Ye)return pt(e),null}else 2*Qe()-i.renderingStartTime>Br&&n!==1073741824&&(e.flags|=128,r=!0,to(i,!1),e.lanes=4194304);i.isBackwards?(s.sibling=e.child,e.child=s):(n=i.last,n!==null?n.sibling=s:e.child=s,i.last=s)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Qe(),e.sibling=null,n=Ke.current,je(Ke,r?n&1|2:n&1),e):(pt(e),null);case 22:case 23:return tu(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?At&1073741824&&(pt(e),e.subtreeFlags&6&&(e.flags|=8192)):pt(e),null;case 24:return null;case 25:return null}throw Error(he(156,e.tag))}function D0(t,e){switch(Ol(e),e.tag){case 1:return _t(e.type)&&Ui(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Gr(),qe(Nt),qe(yt),jl(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return zl(e),null;case 13:if(qe(Ke),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(he(340));Ur()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return qe(Ke),null;case 4:return Gr(),null;case 10:return Gl(e.type._context),null;case 22:case 23:return tu(),null;case 24:return null;default:return null}}var ni=!1,mt=!1,U0=typeof WeakSet=="function"?WeakSet:Set,Te=null;function Sr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Ze(t,e,r)}else n.current=null}function $a(t,e,n){try{n()}catch(r){Ze(t,e,r)}}var xc=!1;function F0(t,e){if(ba=Mi,t=mh(),Ml(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var s=0,a=-1,u=-1,c=0,h=0,p=t,m=null;t:for(;;){for(var g;p!==n||o!==0&&p.nodeType!==3||(a=s+o),p!==i||r!==0&&p.nodeType!==3||(u=s+r),p.nodeType===3&&(s+=p.nodeValue.length),(g=p.firstChild)!==null;)m=p,p=g;for(;;){if(p===t)break t;if(m===n&&++c===o&&(a=s),m===i&&++h===r&&(u=s),(g=p.nextSibling)!==null)break;p=m,m=p.parentNode}p=g}n=a===-1||u===-1?null:{start:a,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(Aa={focusedElem:t,selectionRange:n},Mi=!1,Te=e;Te!==null;)if(e=Te,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Te=t;else for(;Te!==null;){e=Te;try{var E=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(E!==null){var v=E.memoizedProps,w=E.memoizedState,y=e.stateNode,x=y.getSnapshotBeforeUpdate(e.elementType===e.type?v:jt(e.type,v),w);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(he(163))}}catch(I){Ze(e,e.return,I)}if(t=e.sibling,t!==null){t.return=e.return,Te=t;break}Te=e.return}return E=xc,xc=!1,E}function yo(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&t)===t){var i=o.destroy;o.destroy=void 0,i!==void 0&&$a(e,n,i)}o=o.next}while(o!==r)}}function ps(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Wa(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function dp(t){var e=t.alternate;e!==null&&(t.alternate=null,dp(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[nn],delete e[Ro],delete e[Pa],delete e[E0],delete e[T0])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function fp(t){return t.tag===5||t.tag===3||t.tag===4}function Ec(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||fp(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function qa(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Di));else if(r!==4&&(t=t.child,t!==null))for(qa(t,e,n),t=t.sibling;t!==null;)qa(t,e,n),t=t.sibling}function Ya(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Ya(t,e,n),t=t.sibling;t!==null;)Ya(t,e,n),t=t.sibling}var ct=null,$t=!1;function Sn(t,e,n){for(n=n.child;n!==null;)hp(t,e,n),n=n.sibling}function hp(t,e,n){if(rn&&typeof rn.onCommitFiberUnmount=="function")try{rn.onCommitFiberUnmount(ss,n)}catch{}switch(n.tag){case 5:mt||Sr(n,e);case 6:var r=ct,o=$t;ct=null,Sn(t,e,n),ct=r,$t=o,ct!==null&&($t?(t=ct,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):ct.removeChild(n.stateNode));break;case 18:ct!==null&&($t?(t=ct,n=n.stateNode,t.nodeType===8?$s(t.parentNode,n):t.nodeType===1&&$s(t,n),Io(t)):$s(ct,n.stateNode));break;case 4:r=ct,o=$t,ct=n.stateNode.containerInfo,$t=!0,Sn(t,e,n),ct=r,$t=o;break;case 0:case 11:case 14:case 15:if(!mt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){o=r=r.next;do{var i=o,s=i.destroy;i=i.tag,s!==void 0&&(i&2||i&4)&&$a(n,e,s),o=o.next}while(o!==r)}Sn(t,e,n);break;case 1:if(!mt&&(Sr(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Ze(n,e,a)}Sn(t,e,n);break;case 21:Sn(t,e,n);break;case 22:n.mode&1?(mt=(r=mt)||n.memoizedState!==null,Sn(t,e,n),mt=r):Sn(t,e,n);break;default:Sn(t,e,n)}}function Tc(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new U0),e.forEach(function(r){var o=q0.bind(null,t,r);n.has(r)||(n.add(r),r.then(o,o))})}}function zt(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var o=n[r];try{var i=t,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:ct=a.stateNode,$t=!1;break e;case 3:ct=a.stateNode.containerInfo,$t=!0;break e;case 4:ct=a.stateNode.containerInfo,$t=!0;break e}a=a.return}if(ct===null)throw Error(he(160));hp(i,s,o),ct=null,$t=!1;var u=o.alternate;u!==null&&(u.return=null),o.return=null}catch(c){Ze(o,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)pp(e,t),e=e.sibling}function pp(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(zt(e,t),en(t),r&4){try{yo(3,t,t.return),ps(3,t)}catch(v){Ze(t,t.return,v)}try{yo(5,t,t.return)}catch(v){Ze(t,t.return,v)}}break;case 1:zt(e,t),en(t),r&512&&n!==null&&Sr(n,n.return);break;case 5:if(zt(e,t),en(t),r&512&&n!==null&&Sr(n,n.return),t.flags&32){var o=t.stateNode;try{To(o,"")}catch(v){Ze(t,t.return,v)}}if(r&4&&(o=t.stateNode,o!=null)){var i=t.memoizedProps,s=n!==null?n.memoizedProps:i,a=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Df(o,i),va(a,s);var c=va(a,i);for(s=0;s<u.length;s+=2){var h=u[s],p=u[s+1];h==="style"?Bf(o,p):h==="dangerouslySetInnerHTML"?Gf(o,p):h==="children"?To(o,p):El(o,h,p,c)}switch(a){case"input":ha(o,i);break;case"textarea":Uf(o,i);break;case"select":var m=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var g=i.value;g!=null?_r(o,!!i.multiple,g,!1):m!==!!i.multiple&&(i.defaultValue!=null?_r(o,!!i.multiple,i.defaultValue,!0):_r(o,!!i.multiple,i.multiple?[]:"",!1))}o[Ro]=i}catch(v){Ze(t,t.return,v)}}break;case 6:if(zt(e,t),en(t),r&4){if(t.stateNode===null)throw Error(he(162));o=t.stateNode,i=t.memoizedProps;try{o.nodeValue=i}catch(v){Ze(t,t.return,v)}}break;case 3:if(zt(e,t),en(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Io(e.containerInfo)}catch(v){Ze(t,t.return,v)}break;case 4:zt(e,t),en(t);break;case 13:zt(e,t),en(t),o=t.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(Ql=Qe())),r&4&&Tc(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(mt=(c=mt)||h,zt(e,t),mt=c):zt(e,t),en(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!h&&t.mode&1)for(Te=t,h=t.child;h!==null;){for(p=Te=h;Te!==null;){switch(m=Te,g=m.child,m.tag){case 0:case 11:case 14:case 15:yo(4,m,m.return);break;case 1:Sr(m,m.return);var E=m.stateNode;if(typeof E.componentWillUnmount=="function"){r=m,n=m.return;try{e=r,E.props=e.memoizedProps,E.state=e.memoizedState,E.componentWillUnmount()}catch(v){Ze(r,n,v)}}break;case 5:Sr(m,m.return);break;case 22:if(m.memoizedState!==null){wc(p);continue}}g!==null?(g.return=m,Te=g):wc(p)}h=h.sibling}e:for(h=null,p=t;;){if(p.tag===5){if(h===null){h=p;try{o=p.stateNode,c?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=p.stateNode,u=p.memoizedProps.style,s=u!=null&&u.hasOwnProperty("display")?u.display:null,a.style.display=Hf("display",s))}catch(v){Ze(t,t.return,v)}}}else if(p.tag===6){if(h===null)try{p.stateNode.nodeValue=c?"":p.memoizedProps}catch(v){Ze(t,t.return,v)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;h===p&&(h=null),p=p.return}h===p&&(h=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:zt(e,t),en(t),r&4&&Tc(t);break;case 21:break;default:zt(e,t),en(t)}}function en(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(fp(n)){var r=n;break e}n=n.return}throw Error(he(160))}switch(r.tag){case 5:var o=r.stateNode;r.flags&32&&(To(o,""),r.flags&=-33);var i=Ec(t);Ya(t,i,o);break;case 3:case 4:var s=r.stateNode.containerInfo,a=Ec(t);qa(t,a,s);break;default:throw Error(he(161))}}catch(u){Ze(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function G0(t,e,n){Te=t,mp(t)}function mp(t,e,n){for(var r=(t.mode&1)!==0;Te!==null;){var o=Te,i=o.child;if(o.tag===22&&r){var s=o.memoizedState!==null||ni;if(!s){var a=o.alternate,u=a!==null&&a.memoizedState!==null||mt;a=ni;var c=mt;if(ni=s,(mt=u)&&!c)for(Te=o;Te!==null;)s=Te,u=s.child,s.tag===22&&s.memoizedState!==null?Cc(o):u!==null?(u.return=s,Te=u):Cc(o);for(;i!==null;)Te=i,mp(i),i=i.sibling;Te=o,ni=a,mt=c}Sc(t)}else o.subtreeFlags&8772&&i!==null?(i.return=o,Te=i):Sc(t)}}function Sc(t){for(;Te!==null;){var e=Te;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:mt||ps(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!mt)if(n===null)r.componentDidMount();else{var o=e.elementType===e.type?n.memoizedProps:jt(e.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&sc(e,i,r);break;case 3:var s=e.updateQueue;if(s!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}sc(e,s,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var h=c.memoizedState;if(h!==null){var p=h.dehydrated;p!==null&&Io(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(he(163))}mt||e.flags&512&&Wa(e)}catch(m){Ze(e,e.return,m)}}if(e===t){Te=null;break}if(n=e.sibling,n!==null){n.return=e.return,Te=n;break}Te=e.return}}function wc(t){for(;Te!==null;){var e=Te;if(e===t){Te=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Te=n;break}Te=e.return}}function Cc(t){for(;Te!==null;){var e=Te;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ps(4,e)}catch(u){Ze(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var o=e.return;try{r.componentDidMount()}catch(u){Ze(e,o,u)}}var i=e.return;try{Wa(e)}catch(u){Ze(e,i,u)}break;case 5:var s=e.return;try{Wa(e)}catch(u){Ze(e,s,u)}}}catch(u){Ze(e,e.return,u)}if(e===t){Te=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Te=a;break}Te=e.return}}var H0=Math.ceil,qi=vn.ReactCurrentDispatcher,Xl=vn.ReactCurrentOwner,Ft=vn.ReactCurrentBatchConfig,Fe=0,at=null,tt=null,dt=0,At=0,wr=zn(0),ot=0,Do=null,rr=0,ms=0,Zl=0,vo=null,Ct=null,Ql=0,Br=1/0,an=null,Yi=!1,Ka=null,On=null,ri=!1,bn=null,Ki=0,xo=0,Ja=null,Ti=-1,Si=0;function Et(){return Fe&6?Qe():Ti!==-1?Ti:Ti=Qe()}function Dn(t){return t.mode&1?Fe&2&&dt!==0?dt&-dt:w0.transition!==null?(Si===0&&(Si=Qf()),Si):(t=He,t!==0||(t=window.event,t=t===void 0?16:sh(t.type)),t):1}function Yt(t,e,n,r){if(50<xo)throw xo=0,Ja=null,Error(he(185));Fo(t,n,r),(!(Fe&2)||t!==at)&&(t===at&&(!(Fe&2)&&(ms|=n),ot===4&&Nn(t,dt)),bt(t,r),n===1&&Fe===0&&!(e.mode&1)&&(Br=Qe()+500,ds&&jn()))}function bt(t,e){var n=t.callbackNode;wg(t,e);var r=Pi(t,t===at?dt:0);if(r===0)n!==null&&Mu(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Mu(n),e===1)t.tag===0?S0(Ic.bind(null,t)):Ih(Ic.bind(null,t)),v0(function(){!(Fe&6)&&jn()}),n=null;else{switch(eh(r)){case 1:n=Il;break;case 4:n=Xf;break;case 16:n=ki;break;case 536870912:n=Zf;break;default:n=ki}n=wp(n,gp.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function gp(t,e){if(Ti=-1,Si=0,Fe&6)throw Error(he(327));var n=t.callbackNode;if(Pr()&&t.callbackNode!==n)return null;var r=Pi(t,t===at?dt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Ji(t,r);else{e=r;var o=Fe;Fe|=2;var i=vp();(at!==t||dt!==e)&&(an=null,Br=Qe()+500,Zn(t,e));do try{z0();break}catch(a){yp(t,a)}while(!0);Fl(),qi.current=i,Fe=o,tt!==null?e=0:(at=null,dt=0,e=ot)}if(e!==0){if(e===2&&(o=wa(t),o!==0&&(r=o,e=Xa(t,o))),e===1)throw n=Do,Zn(t,0),Nn(t,r),bt(t,Qe()),n;if(e===6)Nn(t,r);else{if(o=t.current.alternate,!(r&30)&&!B0(o)&&(e=Ji(t,r),e===2&&(i=wa(t),i!==0&&(r=i,e=Xa(t,i))),e===1))throw n=Do,Zn(t,0),Nn(t,r),bt(t,Qe()),n;switch(t.finishedWork=o,t.finishedLanes=r,e){case 0:case 1:throw Error(he(345));case 2:qn(t,Ct,an);break;case 3:if(Nn(t,r),(r&130023424)===r&&(e=Ql+500-Qe(),10<e)){if(Pi(t,0)!==0)break;if(o=t.suspendedLanes,(o&r)!==r){Et(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=ka(qn.bind(null,t,Ct,an),e);break}qn(t,Ct,an);break;case 4:if(Nn(t,r),(r&4194240)===r)break;for(e=t.eventTimes,o=-1;0<r;){var s=31-qt(r);i=1<<s,s=e[s],s>o&&(o=s),r&=~i}if(r=o,r=Qe()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*H0(r/1960))-r,10<r){t.timeoutHandle=ka(qn.bind(null,t,Ct,an),r);break}qn(t,Ct,an);break;case 5:qn(t,Ct,an);break;default:throw Error(he(329))}}}return bt(t,Qe()),t.callbackNode===n?gp.bind(null,t):null}function Xa(t,e){var n=vo;return t.current.memoizedState.isDehydrated&&(Zn(t,e).flags|=256),t=Ji(t,e),t!==2&&(e=Ct,Ct=n,e!==null&&Za(e)),t}function Za(t){Ct===null?Ct=t:Ct.push.apply(Ct,t)}function B0(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var o=n[r],i=o.getSnapshot;o=o.value;try{if(!Xt(i(),o))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Nn(t,e){for(e&=~Zl,e&=~ms,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-qt(e),r=1<<n;t[n]=-1,e&=~r}}function Ic(t){if(Fe&6)throw Error(he(327));Pr();var e=Pi(t,0);if(!(e&1))return bt(t,Qe()),null;var n=Ji(t,e);if(t.tag!==0&&n===2){var r=wa(t);r!==0&&(e=r,n=Xa(t,r))}if(n===1)throw n=Do,Zn(t,0),Nn(t,e),bt(t,Qe()),n;if(n===6)throw Error(he(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,qn(t,Ct,an),bt(t,Qe()),null}function eu(t,e){var n=Fe;Fe|=1;try{return t(e)}finally{Fe=n,Fe===0&&(Br=Qe()+500,ds&&jn())}}function or(t){bn!==null&&bn.tag===0&&!(Fe&6)&&Pr();var e=Fe;Fe|=1;var n=Ft.transition,r=He;try{if(Ft.transition=null,He=1,t)return t()}finally{He=r,Ft.transition=n,Fe=e,!(Fe&6)&&jn()}}function tu(){At=wr.current,qe(wr)}function Zn(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,y0(n)),tt!==null)for(n=tt.return;n!==null;){var r=n;switch(Ol(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ui();break;case 3:Gr(),qe(Nt),qe(yt),jl();break;case 5:zl(r);break;case 4:Gr();break;case 13:qe(Ke);break;case 19:qe(Ke);break;case 10:Gl(r.type._context);break;case 22:case 23:tu()}n=n.return}if(at=t,tt=t=Un(t.current,null),dt=At=e,ot=0,Do=null,Zl=ms=rr=0,Ct=vo=null,Jn!==null){for(e=0;e<Jn.length;e++)if(n=Jn[e],r=n.interleaved,r!==null){n.interleaved=null;var o=r.next,i=n.pending;if(i!==null){var s=i.next;i.next=o,r.next=s}n.pending=r}Jn=null}return t}function yp(t,e){do{var n=tt;try{if(Fl(),vi.current=Wi,$i){for(var r=Je.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}$i=!1}if(nr=0,st=rt=Je=null,go=!1,Mo=0,Xl.current=null,n===null||n.return===null){ot=1,Do=e,tt=null;break}e:{var i=t,s=n.return,a=n,u=e;if(e=dt,a.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var c=u,h=a,p=h.tag;if(!(h.mode&1)&&(p===0||p===11||p===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var g=fc(s);if(g!==null){g.flags&=-257,hc(g,s,a,i,e),g.mode&1&&dc(i,c,e),e=g,u=c;var E=e.updateQueue;if(E===null){var v=new Set;v.add(u),e.updateQueue=v}else E.add(u);break e}else{if(!(e&1)){dc(i,c,e),nu();break e}u=Error(he(426))}}else if(Ye&&a.mode&1){var w=fc(s);if(w!==null){!(w.flags&65536)&&(w.flags|=256),hc(w,s,a,i,e),Dl(Hr(u,a));break e}}i=u=Hr(u,a),ot!==4&&(ot=2),vo===null?vo=[i]:vo.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=ep(i,u,e);ic(i,y);break e;case 1:a=u;var x=i.type,T=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(On===null||!On.has(T)))){i.flags|=65536,e&=-e,i.lanes|=e;var I=tp(i,a,e);ic(i,I);break e}}i=i.return}while(i!==null)}Ep(n)}catch(_){e=_,tt===n&&n!==null&&(tt=n=n.return);continue}break}while(!0)}function vp(){var t=qi.current;return qi.current=Wi,t===null?Wi:t}function nu(){(ot===0||ot===3||ot===2)&&(ot=4),at===null||!(rr&268435455)&&!(ms&268435455)||Nn(at,dt)}function Ji(t,e){var n=Fe;Fe|=2;var r=vp();(at!==t||dt!==e)&&(an=null,Zn(t,e));do try{V0();break}catch(o){yp(t,o)}while(!0);if(Fl(),Fe=n,qi.current=r,tt!==null)throw Error(he(261));return at=null,dt=0,ot}function V0(){for(;tt!==null;)xp(tt)}function z0(){for(;tt!==null&&!pg();)xp(tt)}function xp(t){var e=Sp(t.alternate,t,At);t.memoizedProps=t.pendingProps,e===null?Ep(t):tt=e,Xl.current=null}function Ep(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=D0(n,e),n!==null){n.flags&=32767,tt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ot=6,tt=null;return}}else if(n=O0(n,e,At),n!==null){tt=n;return}if(e=e.sibling,e!==null){tt=e;return}tt=e=t}while(e!==null);ot===0&&(ot=5)}function qn(t,e,n){var r=He,o=Ft.transition;try{Ft.transition=null,He=1,j0(t,e,n,r)}finally{Ft.transition=o,He=r}return null}function j0(t,e,n,r){do Pr();while(bn!==null);if(Fe&6)throw Error(he(327));n=t.finishedWork;var o=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(he(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(Cg(t,i),t===at&&(tt=at=null,dt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ri||(ri=!0,wp(ki,function(){return Pr(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Ft.transition,Ft.transition=null;var s=He;He=1;var a=Fe;Fe|=4,Xl.current=null,F0(t,n),pp(n,t),c0(Aa),Mi=!!ba,Aa=ba=null,t.current=n,G0(n),mg(),Fe=a,He=s,Ft.transition=i}else t.current=n;if(ri&&(ri=!1,bn=t,Ki=o),i=t.pendingLanes,i===0&&(On=null),vg(n.stateNode),bt(t,Qe()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)o=e[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(Yi)throw Yi=!1,t=Ka,Ka=null,t;return Ki&1&&t.tag!==0&&Pr(),i=t.pendingLanes,i&1?t===Ja?xo++:(xo=0,Ja=t):xo=0,jn(),null}function Pr(){if(bn!==null){var t=eh(Ki),e=Ft.transition,n=He;try{if(Ft.transition=null,He=16>t?16:t,bn===null)var r=!1;else{if(t=bn,bn=null,Ki=0,Fe&6)throw Error(he(331));var o=Fe;for(Fe|=4,Te=t.current;Te!==null;){var i=Te,s=i.child;if(Te.flags&16){var a=i.deletions;if(a!==null){for(var u=0;u<a.length;u++){var c=a[u];for(Te=c;Te!==null;){var h=Te;switch(h.tag){case 0:case 11:case 15:yo(8,h,i)}var p=h.child;if(p!==null)p.return=h,Te=p;else for(;Te!==null;){h=Te;var m=h.sibling,g=h.return;if(dp(h),h===c){Te=null;break}if(m!==null){m.return=g,Te=m;break}Te=g}}}var E=i.alternate;if(E!==null){var v=E.child;if(v!==null){E.child=null;do{var w=v.sibling;v.sibling=null,v=w}while(v!==null)}}Te=i}}if(i.subtreeFlags&2064&&s!==null)s.return=i,Te=s;else e:for(;Te!==null;){if(i=Te,i.flags&2048)switch(i.tag){case 0:case 11:case 15:yo(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,Te=y;break e}Te=i.return}}var x=t.current;for(Te=x;Te!==null;){s=Te;var T=s.child;if(s.subtreeFlags&2064&&T!==null)T.return=s,Te=T;else e:for(s=x;Te!==null;){if(a=Te,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ps(9,a)}}catch(_){Ze(a,a.return,_)}if(a===s){Te=null;break e}var I=a.sibling;if(I!==null){I.return=a.return,Te=I;break e}Te=a.return}}if(Fe=o,jn(),rn&&typeof rn.onPostCommitFiberRoot=="function")try{rn.onPostCommitFiberRoot(ss,t)}catch{}r=!0}return r}finally{He=n,Ft.transition=e}}return!1}function Nc(t,e,n){e=Hr(n,e),e=ep(t,e,1),t=Ln(t,e,1),e=Et(),t!==null&&(Fo(t,1,e),bt(t,e))}function Ze(t,e,n){if(t.tag===3)Nc(t,t,n);else for(;e!==null;){if(e.tag===3){Nc(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(On===null||!On.has(r))){t=Hr(n,t),t=tp(e,t,1),e=Ln(e,t,1),t=Et(),e!==null&&(Fo(e,1,t),bt(e,t));break}}e=e.return}}function $0(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Et(),t.pingedLanes|=t.suspendedLanes&n,at===t&&(dt&n)===n&&(ot===4||ot===3&&(dt&130023424)===dt&&500>Qe()-Ql?Zn(t,0):Zl|=n),bt(t,e)}function Tp(t,e){e===0&&(t.mode&1?(e=qo,qo<<=1,!(qo&130023424)&&(qo=4194304)):e=1);var n=Et();t=mn(t,e),t!==null&&(Fo(t,e,n),bt(t,n))}function W0(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Tp(t,n)}function q0(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,o=t.memoizedState;o!==null&&(n=o.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(he(314))}r!==null&&r.delete(e),Tp(t,n)}var Sp;Sp=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Nt.current)It=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return It=!1,L0(t,e,n);It=!!(t.flags&131072)}else It=!1,Ye&&e.flags&1048576&&Nh(e,Hi,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Ei(t,e),t=e.pendingProps;var o=Dr(e,yt.current);kr(e,n),o=Wl(null,e,r,t,o,n);var i=ql();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,_t(r)?(i=!0,Fi(e)):i=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Bl(e),o.updater=hs,e.stateNode=o,o._reactInternals=e,Fa(e,r,t,n),e=Ba(null,e,r,!0,i,n)):(e.tag=0,Ye&&i&&Ll(e),xt(null,e,o,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Ei(t,e),t=e.pendingProps,o=r._init,r=o(r._payload),e.type=r,o=e.tag=K0(r),t=jt(r,t),o){case 0:e=Ha(null,e,r,t,n);break e;case 1:e=gc(null,e,r,t,n);break e;case 11:e=pc(null,e,r,t,n);break e;case 14:e=mc(null,e,r,jt(r.type,t),n);break e}throw Error(he(306,r,""))}return e;case 0:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:jt(r,o),Ha(t,e,r,o,n);case 1:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:jt(r,o),gc(t,e,r,o,n);case 3:e:{if(ip(e),t===null)throw Error(he(387));r=e.pendingProps,i=e.memoizedState,o=i.element,Ph(t,e),zi(e,r,null,n);var s=e.memoizedState;if(r=s.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){o=Hr(Error(he(423)),e),e=yc(t,e,r,n,o);break e}else if(r!==o){o=Hr(Error(he(424)),e),e=yc(t,e,r,n,o);break e}else for(Rt=Mn(e.stateNode.containerInfo.firstChild),kt=e,Ye=!0,Wt=null,n=Rh(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ur(),r===o){e=gn(t,e,n);break e}xt(t,e,r,n)}e=e.child}return e;case 5:return Mh(e),t===null&&Oa(e),r=e.type,o=e.pendingProps,i=t!==null?t.memoizedProps:null,s=o.children,Ra(r,o)?s=null:i!==null&&Ra(r,i)&&(e.flags|=32),op(t,e),xt(t,e,s,n),e.child;case 6:return t===null&&Oa(e),null;case 13:return sp(t,e,n);case 4:return Vl(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Fr(e,null,r,n):xt(t,e,r,n),e.child;case 11:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:jt(r,o),pc(t,e,r,o,n);case 7:return xt(t,e,e.pendingProps,n),e.child;case 8:return xt(t,e,e.pendingProps.children,n),e.child;case 12:return xt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,o=e.pendingProps,i=e.memoizedProps,s=o.value,je(Bi,r._currentValue),r._currentValue=s,i!==null)if(Xt(i.value,s)){if(i.children===o.children&&!Nt.current){e=gn(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){s=i.child;for(var u=a.firstContext;u!==null;){if(u.context===r){if(i.tag===1){u=fn(-1,n&-n),u.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var h=c.pending;h===null?u.next=u:(u.next=h.next,h.next=u),c.pending=u}}i.lanes|=n,u=i.alternate,u!==null&&(u.lanes|=n),Da(i.return,n,e),a.lanes|=n;break}u=u.next}}else if(i.tag===10)s=i.type===e.type?null:i.child;else if(i.tag===18){if(s=i.return,s===null)throw Error(he(341));s.lanes|=n,a=s.alternate,a!==null&&(a.lanes|=n),Da(s,n,e),s=i.sibling}else s=i.child;if(s!==null)s.return=i;else for(s=i;s!==null;){if(s===e){s=null;break}if(i=s.sibling,i!==null){i.return=s.return,s=i;break}s=s.return}i=s}xt(t,e,o.children,n),e=e.child}return e;case 9:return o=e.type,r=e.pendingProps.children,kr(e,n),o=Ht(o),r=r(o),e.flags|=1,xt(t,e,r,n),e.child;case 14:return r=e.type,o=jt(r,e.pendingProps),o=jt(r.type,o),mc(t,e,r,o,n);case 15:return np(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:jt(r,o),Ei(t,e),e.tag=1,_t(r)?(t=!0,Fi(e)):t=!1,kr(e,n),Qh(e,r,o),Fa(e,r,o,n),Ba(null,e,r,!0,t,n);case 19:return ap(t,e,n);case 22:return rp(t,e,n)}throw Error(he(156,e.tag))};function wp(t,e){return Jf(t,e)}function Y0(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ut(t,e,n,r){return new Y0(t,e,n,r)}function ru(t){return t=t.prototype,!(!t||!t.isReactComponent)}function K0(t){if(typeof t=="function")return ru(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Sl)return 11;if(t===wl)return 14}return 2}function Un(t,e){var n=t.alternate;return n===null?(n=Ut(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function wi(t,e,n,r,o,i){var s=2;if(r=t,typeof t=="function")ru(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case hr:return Qn(n.children,o,i,e);case Tl:s=8,o|=8;break;case la:return t=Ut(12,n,e,o|2),t.elementType=la,t.lanes=i,t;case ua:return t=Ut(13,n,e,o),t.elementType=ua,t.lanes=i,t;case ca:return t=Ut(19,n,e,o),t.elementType=ca,t.lanes=i,t;case Mf:return gs(n,o,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case kf:s=10;break e;case Pf:s=9;break e;case Sl:s=11;break e;case wl:s=14;break e;case wn:s=16,r=null;break e}throw Error(he(130,t==null?t:typeof t,""))}return e=Ut(s,n,e,o),e.elementType=t,e.type=r,e.lanes=i,e}function Qn(t,e,n,r){return t=Ut(7,t,r,e),t.lanes=n,t}function gs(t,e,n,r){return t=Ut(22,t,r,e),t.elementType=Mf,t.lanes=n,t.stateNode={isHidden:!1},t}function Qs(t,e,n){return t=Ut(6,t,null,e),t.lanes=n,t}function ea(t,e,n){return e=Ut(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function J0(t,e,n,r,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ls(0),this.expirationTimes=Ls(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ls(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function ou(t,e,n,r,o,i,s,a,u){return t=new J0(t,e,n,a,u),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Ut(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bl(i),t}function X0(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fr,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Cp(t){if(!t)return Hn;t=t._reactInternals;e:{if(sr(t)!==t||t.tag!==1)throw Error(he(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(_t(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(he(171))}if(t.tag===1){var n=t.type;if(_t(n))return Ch(t,n,e)}return e}function Ip(t,e,n,r,o,i,s,a,u){return t=ou(n,r,!0,t,o,i,s,a,u),t.context=Cp(null),n=t.current,r=Et(),o=Dn(n),i=fn(r,o),i.callback=e??null,Ln(n,i,o),t.current.lanes=o,Fo(t,o,r),bt(t,r),t}function ys(t,e,n,r){var o=e.current,i=Et(),s=Dn(o);return n=Cp(n),e.context===null?e.context=n:e.pendingContext=n,e=fn(i,s),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ln(o,e,s),t!==null&&(Yt(t,o,s,i),yi(t,o,s)),s}function Xi(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function _c(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function iu(t,e){_c(t,e),(t=t.alternate)&&_c(t,e)}function Z0(){return null}var Np=typeof reportError=="function"?reportError:function(t){console.error(t)};function su(t){this._internalRoot=t}vs.prototype.render=su.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(he(409));ys(t,e,null,null)};vs.prototype.unmount=su.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;or(function(){ys(null,t,null,null)}),e[pn]=null}};function vs(t){this._internalRoot=t}vs.prototype.unstable_scheduleHydration=function(t){if(t){var e=rh();t={blockedOn:null,target:t,priority:e};for(var n=0;n<In.length&&e!==0&&e<In[n].priority;n++);In.splice(n,0,t),n===0&&ih(t)}};function au(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function xs(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function bc(){}function Q0(t,e,n,r,o){if(o){if(typeof r=="function"){var i=r;r=function(){var c=Xi(s);i.call(c)}}var s=Ip(e,r,t,0,null,!1,!1,"",bc);return t._reactRootContainer=s,t[pn]=s.current,bo(t.nodeType===8?t.parentNode:t),or(),s}for(;o=t.lastChild;)t.removeChild(o);if(typeof r=="function"){var a=r;r=function(){var c=Xi(u);a.call(c)}}var u=ou(t,0,!1,null,null,!1,!1,"",bc);return t._reactRootContainer=u,t[pn]=u.current,bo(t.nodeType===8?t.parentNode:t),or(function(){ys(e,u,n,r)}),u}function Es(t,e,n,r,o){var i=n._reactRootContainer;if(i){var s=i;if(typeof o=="function"){var a=o;o=function(){var u=Xi(s);a.call(u)}}ys(e,s,t,o)}else s=Q0(n,e,t,o,r);return Xi(s)}th=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ao(e.pendingLanes);n!==0&&(Nl(e,n|1),bt(e,Qe()),!(Fe&6)&&(Br=Qe()+500,jn()))}break;case 13:or(function(){var r=mn(t,1);if(r!==null){var o=Et();Yt(r,t,1,o)}}),iu(t,1)}};_l=function(t){if(t.tag===13){var e=mn(t,134217728);if(e!==null){var n=Et();Yt(e,t,134217728,n)}iu(t,134217728)}};nh=function(t){if(t.tag===13){var e=Dn(t),n=mn(t,e);if(n!==null){var r=Et();Yt(n,t,e,r)}iu(t,e)}};rh=function(){return He};oh=function(t,e){var n=He;try{return He=t,e()}finally{He=n}};Ea=function(t,e,n){switch(e){case"input":if(ha(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var o=cs(r);if(!o)throw Error(he(90));Of(r),ha(r,o)}}}break;case"textarea":Uf(t,n);break;case"select":e=n.value,e!=null&&_r(t,!!n.multiple,e,!1)}};jf=eu;$f=or;var ey={usingClientEntryPoint:!1,Events:[Ho,yr,cs,Vf,zf,eu]},no={findFiberByHostInstance:Kn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ty={bundleType:no.bundleType,version:no.version,rendererPackageName:no.rendererPackageName,rendererConfig:no.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:vn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Yf(t),t===null?null:t.stateNode},findFiberByHostInstance:no.findFiberByHostInstance||Z0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var oi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!oi.isDisabled&&oi.supportsFiber)try{ss=oi.inject(ty),rn=oi}catch{}}Mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ey;Mt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!au(e))throw Error(he(200));return X0(t,e,null,n)};Mt.createRoot=function(t,e){if(!au(t))throw Error(he(299));var n=!1,r="",o=Np;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=ou(t,1,!1,null,null,n,!1,r,o),t[pn]=e.current,bo(t.nodeType===8?t.parentNode:t),new su(e)};Mt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(he(188)):(t=Object.keys(t).join(","),Error(he(268,t)));return t=Yf(e),t=t===null?null:t.stateNode,t};Mt.flushSync=function(t){return or(t)};Mt.hydrate=function(t,e,n){if(!xs(e))throw Error(he(200));return Es(null,t,e,!0,n)};Mt.hydrateRoot=function(t,e,n){if(!au(t))throw Error(he(405));var r=n!=null&&n.hydratedSources||null,o=!1,i="",s=Np;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),e=Ip(e,null,t,1,n??null,o,!1,i,s),t[pn]=e.current,bo(t),r)for(t=0;t<r.length;t++)n=r[t],o=n._getVersion,o=o(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,o]:e.mutableSourceEagerHydrationData.push(n,o);return new vs(e)};Mt.render=function(t,e,n){if(!xs(e))throw Error(he(200));return Es(null,t,e,!1,n)};Mt.unmountComponentAtNode=function(t){if(!xs(t))throw Error(he(40));return t._reactRootContainer?(or(function(){Es(null,null,t,!1,function(){t._reactRootContainer=null,t[pn]=null})}),!0):!1};Mt.unstable_batchedUpdates=eu;Mt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!xs(n))throw Error(he(200));if(t==null||t._reactInternals===void 0)throw Error(he(38));return Es(t,e,n,!1,r)};Mt.version="18.3.1-next-f1338f8080-20240426";function _p(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_p)}catch(t){console.error(t)}}_p(),_f.exports=Mt;var ny=_f.exports,Ac=ny;sa.createRoot=Ac.createRoot,sa.hydrateRoot=Ac.hydrateRoot;let ii;const ry=new Uint8Array(16);function oy(){if(!ii&&(ii=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ii))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ii(ry)}const ut=[];for(let t=0;t<256;++t)ut.push((t+256).toString(16).slice(1));function iy(t,e=0){return ut[t[e+0]]+ut[t[e+1]]+ut[t[e+2]]+ut[t[e+3]]+"-"+ut[t[e+4]]+ut[t[e+5]]+"-"+ut[t[e+6]]+ut[t[e+7]]+"-"+ut[t[e+8]]+ut[t[e+9]]+"-"+ut[t[e+10]]+ut[t[e+11]]+ut[t[e+12]]+ut[t[e+13]]+ut[t[e+14]]+ut[t[e+15]]}const sy=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Rc={randomUUID:sy};function ta(t,e,n){if(Rc.randomUUID&&!t)return Rc.randomUUID();t=t||{};const r=t.random||(t.rng||oy)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,iy(r)}const ay="SintongBangtongDB",Bn="projects",lu=()=>new Promise((t,e)=>{if(typeof window>"u"||!window.indexedDB){e(new Error("IndexedDB is not supported"));return}const n=indexedDB.open(ay,1);n.onupgradeneeded=r=>{const o=r.target.result;o.objectStoreNames.contains(Bn)||o.createObjectStore(Bn)},n.onsuccess=()=>t(n.result),n.onerror=()=>e(n.error)}),cr=async(t,e)=>{try{const n=await lu();return new Promise((r,o)=>{const a=n.transaction(Bn,"readwrite").objectStore(Bn).put(e,t);a.onsuccess=()=>r(),a.onerror=()=>o(a.error)})}catch(n){console.error("IndexedDB Save Error:",n)}},Ci=async t=>{try{const e=await lu();return new Promise((n,r)=>{const s=e.transaction(Bn,"readonly").objectStore(Bn).get(t);s.onsuccess=()=>n(s.result),s.onerror=()=>r(s.error)})}catch(e){return console.error("IndexedDB Load Error:",e),null}},Cr=async t=>{try{const e=await lu();return new Promise((n,r)=>{const s=e.transaction(Bn,"readwrite").objectStore(Bn).delete(t);s.onsuccess=()=>n(),s.onerror=()=>r(s.error)})}catch(e){console.error("IndexedDB Delete Error:",e)}},bp=de.createContext(void 0),kc=`[  ]
1. :    . (  ,      )
2.   ():
   -   **()  ** . (     ).
   -       .
   -  :  ** **. (   ).
   -  : , ,   .
3.   ():
   -    .   .
   -  :  (),   /, , ,  .
   -   .`,ly=({children:t})=>{const[e,n]=de.useState(""),[r,o]=de.useState(""),[i,s]=de.useState([]),[a,u]=de.useState("webtoon"),[c,h]=de.useState("16:9"),[p,m]=de.useState([]),[g,E]=de.useState([]),[v,w]=de.useState([]),[y,x]=de.useState([]),[T,I]=de.useState(!0),[_,R]=de.useState(kc),[k,j]=de.useState(!1),[D,q]=de.useState(null),[ae,P]=de.useState(null);de.useEffect(()=>{if(i.length>0){const se=i.map(le=>`[${le.title}]
${le.content}`).join(`

`);o(se)}},[i]),de.useEffect(()=>{(async()=>{const le=localStorage.getItem("sb_api_key");le&&n(le);try{let xe=await Ci("currentProject");if(!xe){const Ie=localStorage.getItem("sb_project_data");if(Ie)try{xe=JSON.parse(Ie)}catch(Ne){console.error("Failed to parse LocalStorage data",Ne)}}xe&&(o(xe.script||""),xe.scriptSegments&&xe.scriptSegments.length>0?s(xe.scriptSegments):xe.script&&!xe.scriptSegments&&s([{id:ta(),title:" ",content:xe.script}]),u(xe.selectedStyle||"webtoon"),m(xe.scenes||[]),E(xe.characters||[]),w(xe.referenceImages||[]),x(xe.props||[]),xe.globalAspectRatio&&h(xe.globalAspectRatio),xe.globalScenePrompt&&R(xe.globalScenePrompt))}catch(xe){console.error("Load failed",xe)}finally{j(!0)}})()},[]);const W=se=>{o(se),i.length===0&&s([{id:ta(),title:" ",content:se}])},C=(se,le)=>{const xe={id:ta(),title:se,content:le};s(Ie=>[...Ie,xe])},G=se=>{s(le=>le.filter(xe=>xe.id!==se))},ce=(se,le)=>{s(xe=>xe.map(Ie=>Ie.id===se?{...Ie,content:le}:Ie))},X=()=>{s([]),o("")},J=()=>{cr("currentProject",{script:r,scriptSegments:i,selectedStyle:a,scenes:p,characters:g,referenceImages:v,props:y,globalAspectRatio:c,globalScenePrompt:_}).catch(le=>{console.warn("Failed to save to IndexedDB",le),ee("   (   )","error")})};de.useEffect(()=>{if(!k)return;const se=setTimeout(J,2e3);return()=>clearTimeout(se)},[r,i,a,p,g,v,y,c,_,k]),de.useEffect(()=>{e&&localStorage.setItem("sb_api_key",e)},[e]);const K=async()=>{o(""),s([]),m([]),E([]),w([]),x([]),R(kc),localStorage.removeItem("sb_project_data"),await Cr("currentProject"),ee(" . (  )","success")},ee=(se,le="success")=>{q({message:se,type:le})},O=()=>q(null),V=se=>P(se),fe=()=>P(null);return f.jsx(bp.Provider,{value:{apiKey:e,setApiKey:n,script:r,setScript:W,scriptSegments:i,addScriptSegment:C,removeScriptSegment:G,updateScriptSegment:ce,clearScriptSegments:X,selectedStyle:a,setSelectedStyle:u,globalAspectRatio:c,setGlobalAspectRatio:h,scenes:p,setScenes:m,characters:g,setCharacters:E,referenceImages:v,setReferenceImages:w,props:y,setProps:x,isContinuityMode:T,setIsContinuityMode:I,globalScenePrompt:_,setGlobalScenePrompt:R,saveProject:J,resetProject:K,toast:D,showToast:ee,closeToast:O,modalConfig:ae,openModal:V,closeModal:fe},children:t})},Zt=()=>{const t=de.useContext(bp);if(!t)throw new Error("useProject must be used within a ProjectProvider");return t};var uy={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let cy,dy;function fy(){return{geminiUrl:cy,vertexUrl:dy}}function hy(t,e,n,r){var o,i;if(!(t!=null&&t.baseUrl)){const s=fy();return e?(o=s.vertexUrl)!==null&&o!==void 0?o:n:(i=s.geminiUrl)!==null&&i!==void 0?i:r}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class xn{}function ve(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(r,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){const i=e[o];return i!=null?String(i):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function d(t,e,n){for(let i=0;i<e.length-1;i++){const s=e[i];if(s.endsWith("[]")){const a=s.slice(0,-2);if(!(a in t))if(Array.isArray(n))t[a]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(t[a])){const u=t[a];if(Array.isArray(n))for(let c=0;c<u.length;c++){const h=u[c];d(h,e.slice(i+1),n[c])}else for(const c of u)d(c,e.slice(i+1),n)}return}else if(s.endsWith("[0]")){const a=s.slice(0,-3);a in t||(t[a]=[{}]);const u=t[a];d(u[0],e.slice(i+1),n);return}(!t[s]||typeof t[s]!="object")&&(t[s]={}),t=t[s]}const r=e[e.length-1],o=t[r];if(o!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===o)return;if(typeof o=="object"&&typeof n=="object"&&o!==null&&n!==null)Object.assign(o,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function l(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return n;const o=e[r];if(o.endsWith("[]")){const i=o.slice(0,-2);if(i in t){const s=t[i];return Array.isArray(s)?s.map(a=>l(a,e.slice(r+1),n)):n}else return n}else t=t[o]}return t}catch(r){if(r instanceof TypeError)return n;throw r}}function py(t,e){for(const[n,r]of Object.entries(e)){const o=n.split("."),i=r.split("."),s=new Set;let a=-1;for(let u=0;u<o.length;u++)if(o[u]==="*"){a=u;break}if(a!==-1&&i.length>a)for(let u=a;u<i.length;u++){const c=i[u];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&s.add(c)}Qa(t,o,i,0,s)}}function Qa(t,e,n,r,o){if(r>=e.length||typeof t!="object"||t===null)return;const i=e[r];if(i.endsWith("[]")){const s=i.slice(0,-2),a=t;if(s in a&&Array.isArray(a[s]))for(const u of a[s])Qa(u,e,n,r+1,o)}else if(i==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const s=t,a=Object.keys(s).filter(c=>!c.startsWith("_")&&!o.has(c)),u={};for(const c of a)u[c]=s[c];for(const[c,h]of Object.entries(u)){const p=[];for(const m of n.slice(r))m==="*"?p.push(c):p.push(m);d(s,p,h)}for(const c of a)delete s[c]}}else{const s=t;i in s&&Qa(s[i],e,n,r+1,o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function uu(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function my(t){const e={},n=l(t,["operationName"]);n!=null&&d(e,["operationName"],n);const r=l(t,["resourceName"]);return r!=null&&d(e,["_url","resourceName"],r),e}function gy(t){const e={},n=l(t,["name"]);n!=null&&d(e,["name"],n);const r=l(t,["metadata"]);r!=null&&d(e,["metadata"],r);const o=l(t,["done"]);o!=null&&d(e,["done"],o);const i=l(t,["error"]);i!=null&&d(e,["error"],i);const s=l(t,["response","generateVideoResponse"]);return s!=null&&d(e,["response"],vy(s)),e}function yy(t){const e={},n=l(t,["name"]);n!=null&&d(e,["name"],n);const r=l(t,["metadata"]);r!=null&&d(e,["metadata"],r);const o=l(t,["done"]);o!=null&&d(e,["done"],o);const i=l(t,["error"]);i!=null&&d(e,["error"],i);const s=l(t,["response"]);return s!=null&&d(e,["response"],xy(s)),e}function vy(t){const e={},n=l(t,["generatedSamples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Ey(s))),d(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&d(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&d(e,["raiMediaFilteredReasons"],o),e}function xy(t){const e={},n=l(t,["videos"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Ty(s))),d(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&d(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&d(e,["raiMediaFilteredReasons"],o),e}function Ey(t){const e={},n=l(t,["video"]);return n!=null&&d(e,["video"],_y(n)),e}function Ty(t){const e={},n=l(t,["_self"]);return n!=null&&d(e,["video"],by(n)),e}function Sy(t){const e={},n=l(t,["operationName"]);return n!=null&&d(e,["_url","operationName"],n),e}function wy(t){const e={},n=l(t,["operationName"]);return n!=null&&d(e,["_url","operationName"],n),e}function Cy(t){const e={},n=l(t,["name"]);n!=null&&d(e,["name"],n);const r=l(t,["metadata"]);r!=null&&d(e,["metadata"],r);const o=l(t,["done"]);o!=null&&d(e,["done"],o);const i=l(t,["error"]);i!=null&&d(e,["error"],i);const s=l(t,["response"]);return s!=null&&d(e,["response"],Iy(s)),e}function Iy(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["parent"]);r!=null&&d(e,["parent"],r);const o=l(t,["documentName"]);return o!=null&&d(e,["documentName"],o),e}function Ap(t){const e={},n=l(t,["name"]);n!=null&&d(e,["name"],n);const r=l(t,["metadata"]);r!=null&&d(e,["metadata"],r);const o=l(t,["done"]);o!=null&&d(e,["done"],o);const i=l(t,["error"]);i!=null&&d(e,["error"],i);const s=l(t,["response"]);return s!=null&&d(e,["response"],Ny(s)),e}function Ny(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["parent"]);r!=null&&d(e,["parent"],r);const o=l(t,["documentName"]);return o!=null&&d(e,["documentName"],o),e}function _y(t){const e={},n=l(t,["uri"]);n!=null&&d(e,["uri"],n);const r=l(t,["encodedVideo"]);r!=null&&d(e,["videoBytes"],uu(r));const o=l(t,["encoding"]);return o!=null&&d(e,["mimeType"],o),e}function by(t){const e={},n=l(t,["gcsUri"]);n!=null&&d(e,["uri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&d(e,["videoBytes"],uu(r));const o=l(t,["mimeType"]);return o!=null&&d(e,["mimeType"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Pc;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Pc||(Pc={}));var Mc;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(Mc||(Mc={}));var Lc;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(Lc||(Lc={}));var An;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(An||(An={}));var Oc;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Oc||(Oc={}));var Dc;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Dc||(Dc={}));var Uc;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(Uc||(Uc={}));var Fc;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(Fc||(Fc={}));var Gc;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Gc||(Gc={}));var Hc;(function(t){t.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH",t.MINIMAL="MINIMAL"})(Hc||(Hc={}));var Bc;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(Bc||(Bc={}));var Vc;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(Vc||(Vc={}));var zc;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(zc||(zc={}));var jc;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE",t.IMAGE_RECITATION="IMAGE_RECITATION",t.IMAGE_OTHER="IMAGE_OTHER"})(jc||(jc={}));var $c;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})($c||($c={}));var Wc;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Wc||(Wc={}));var qc;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(qc||(qc={}));var Yc;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(Yc||(Yc={}));var Kc;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Kc||(Kc={}));var Zi;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Zi||(Zi={}));var Jc;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Jc||(Jc={}));var Xc;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Xc||(Xc={}));var Zc;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Zc||(Zc={}));var el;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(el||(el={}));var Qc;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Qc||(Qc={}));var ed;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",t.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(ed||(ed={}));var td;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(td||(td={}));var nd;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(nd||(nd={}));var rd;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(rd||(rd={}));var od;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(od||(od={}));var id;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(id||(id={}));var sd;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(sd||(sd={}));var ad;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(ad||(ad={}));var ld;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(ld||(ld={}));var ud;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(ud||(ud={}));var cd;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(cd||(cd={}));var dd;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(dd||(dd={}));var fd;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(fd||(fd={}));var hd;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(hd||(hd={}));var pd;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(pd||(pd={}));var md;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(md||(md={}));var gd;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(gd||(gd={}));var yd;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(yd||(yd={}));var vd;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(vd||(vd={}));var xd;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(xd||(xd={}));var Ed;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(Ed||(Ed={}));var Td;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Td||(Td={}));var Sd;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(Sd||(Sd={}));var wd;(function(t){t.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",t.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",t.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(wd||(wd={}));var Cd;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Cd||(Cd={}));var Id;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Id||(Id={}));var Nd;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Nd||(Nd={}));var _d;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(_d||(_d={}));var bd;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(bd||(bd={}));var Ad;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(Ad||(Ad={}));var Ir;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(Ir||(Ir={}));class tl{constructor(e){const n={};for(const r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class ro{get text(){var e,n,r,o,i,s,a,u;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",h=!1;const p=[];for(const m of(u=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)!==null&&u!==void 0?u:[]){for(const[g,E]of Object.entries(m))g!=="text"&&g!=="thought"&&g!=="thoughtSignature"&&(E!==null||E!==void 0)&&p.push(g);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;h=!0,c+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?c:void 0}get data(){var e,n,r,o,i,s,a,u;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const h=[];for(const p of(u=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)!==null&&u!==void 0?u:[]){for(const[m,g]of Object.entries(p))m!=="inlineData"&&(g!==null||g!==void 0)&&h.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,n,r,o,i,s,a,u;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(u=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||u===void 0?void 0:u.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,n,r,o,i,s,a,u,c;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(u=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||u===void 0?void 0:u.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((h==null?void 0:h.length)!==0)return(c=h==null?void 0:h[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,n,r,o,i,s,a,u,c;if(((o=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(u=(a=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||a===void 0?void 0:a.parts)===null||u===void 0?void 0:u.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((h==null?void 0:h.length)!==0)return(c=h==null?void 0:h[0])===null||c===void 0?void 0:c.output}}class Rd{}class kd{}class Ay{}class Ry{}class ky{}class Py{}class Pd{}class Md{}class Ld{}class My{}class Qi{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new Qi;let o;const i=e;return n?o=yy(i):o=gy(i),Object.assign(r,o),r}}class Od{}class Dd{}class Ud{}class Fd{}class Ly{}class Oy{}class Dy{}class cu{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new cu,i=Cy(e);return Object.assign(r,i),r}}class Uy{}class Fy{}class Gy{}class Gd{}class Hy{get text(){var e,n,r;let o="",i=!1;const s=[];for(const a of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[u,c]of Object.entries(a))u!=="text"&&u!=="thought"&&c!==null&&s.push(u);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;i=!0,o+=a.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?o:void 0}get data(){var e,n,r;let o="";const i=[];for(const s of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[a,u]of Object.entries(s))a!=="inlineData"&&u!==null&&i.push(a);s.inlineData&&typeof s.inlineData.data=="string"&&(o+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}}class By{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class du{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new du,i=Ap(e);return Object.assign(r,i),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ge(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Rp(t,e){const n=Ge(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function kp(t){return Array.isArray(t)?t.map(e=>es(e)):[es(t)]}function es(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function Pp(t){const e=es(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Mp(t){const e=es(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Hd(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Lp(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Hd(e)):[Hd(t)]}function nl(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function Bd(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function Vd(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function gt(t){if(t==null)throw new Error("ContentUnion is required");return nl(t)?t:{role:"user",parts:Lp(t)}}function fu(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const r=gt(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){const n=gt(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>gt(n)):[gt(e)]}function Gt(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(Bd(t)||Vd(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[gt(t)]}const e=[],n=[],r=nl(t[0]);for(const o of t){const i=nl(o);if(i!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(i)e.push(o);else{if(Bd(o)||Vd(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(o)}}return r||e.push({role:"user",parts:Lp(n)}),e}function Vy(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(An).includes(n[0].toUpperCase())?n[0].toUpperCase():An.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of n)e.anyOf.push({type:Object.values(An).includes(r.toUpperCase())?r.toUpperCase():An.TYPE_UNSPECIFIED})}}function Mr(t){const e={},n=["items"],r=["anyOf"],o=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const i=t.anyOf;i!=null&&i.length==2&&(i[0].type==="null"?(e.nullable=!0,t=i[1]):i[1].type==="null"&&(e.nullable=!0,t=i[0])),t.type instanceof Array&&Vy(t.type,e);for(const[s,a]of Object.entries(t))if(a!=null)if(s=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(An).includes(a.toUpperCase())?a.toUpperCase():An.TYPE_UNSPECIFIED}else if(n.includes(s))e[s]=Mr(a);else if(r.includes(s)){const u=[];for(const c of a){if(c.type=="null"){e.nullable=!0;continue}u.push(Mr(c))}e[s]=u}else if(o.includes(s)){const u={};for(const[c,h]of Object.entries(a))u[c]=Mr(h);e[s]=u}else{if(s==="additionalProperties")continue;e[s]=a}return e}function hu(t){return Mr(t)}function pu(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function mu(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Wr(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Mr(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Mr(e.response));return t}function qr(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function zy(t,e,n,r=1){const o=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:o?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:o?`${n}/${e}`:e}function En(t,e){if(typeof e!="string")throw new Error("name must be a string");return zy(t,e,"cachedContents")}function Op(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function $n(t){return uu(t)}function jy(t){return t!=null&&typeof t=="object"&&"name"in t}function $y(t){return t!=null&&typeof t=="object"&&"video"in t}function Wy(t){return t!=null&&typeof t=="object"&&"uri"in t}function Dp(t){var e;let n;if(jy(t)&&(n=t.name),!(Wy(t)&&(n=t.uri,n===void 0))&&!($y(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const o=n.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${n}`);n=o[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Up(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function Fp(t){for(const e of["models","tunedModels","publisherModels"])if(qy(t,e))return t[e];return[]}function qy(t,e){return t!==null&&typeof t=="object"&&e in t}function Yy(t,e={}){const n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function Ky(t,e={}){const n=[],r=new Set;for(const o of t){const i=o.name;if(r.has(i))throw new Error(`Duplicate function name ${i} found in MCP tools. Please ensure function names are unique.`);r.add(i);const s=Yy(o,e);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}function Gp(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,o=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(o>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function Jy(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Hp(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const o=n.inlinedResponses;if(!Array.isArray(o)||o.length===0)return t;let i=!1;for(const s of o){if(typeof s!="object"||s===null)continue;const u=s.response;if(typeof u!="object"||u===null)continue;if(u.embedding!==void 0){i=!0;break}}return i&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function Yr(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function Bp(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Xy(t){const e={},n=l(t,["responsesFile"]);n!=null&&d(e,["fileName"],n);const r=l(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>kv(s))),d(e,["inlinedResponses"],i)}const o=l(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["inlinedEmbedContentResponses"],i)}return e}function Zy(t){const e={},n=l(t,["predictionsFormat"]);n!=null&&d(e,["format"],n);const r=l(t,["gcsDestination","outputUriPrefix"]);r!=null&&d(e,["gcsUri"],r);const o=l(t,["bigqueryDestination","outputUri"]);return o!=null&&d(e,["bigqueryUri"],o),e}function Qy(t){const e={},n=l(t,["format"]);n!=null&&d(e,["predictionsFormat"],n);const r=l(t,["gcsUri"]);r!=null&&d(e,["gcsDestination","outputUriPrefix"],r);const o=l(t,["bigqueryUri"]);if(o!=null&&d(e,["bigqueryDestination","outputUri"],o),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(l(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Ii(t){const e={},n=l(t,["name"]);n!=null&&d(e,["name"],n);const r=l(t,["metadata","displayName"]);r!=null&&d(e,["displayName"],r);const o=l(t,["metadata","state"]);o!=null&&d(e,["state"],Bp(o));const i=l(t,["metadata","createTime"]);i!=null&&d(e,["createTime"],i);const s=l(t,["metadata","endTime"]);s!=null&&d(e,["endTime"],s);const a=l(t,["metadata","updateTime"]);a!=null&&d(e,["updateTime"],a);const u=l(t,["metadata","model"]);u!=null&&d(e,["model"],u);const c=l(t,["metadata","output"]);return c!=null&&d(e,["dest"],Xy(Hp(c))),e}function rl(t){const e={},n=l(t,["name"]);n!=null&&d(e,["name"],n);const r=l(t,["displayName"]);r!=null&&d(e,["displayName"],r);const o=l(t,["state"]);o!=null&&d(e,["state"],Bp(o));const i=l(t,["error"]);i!=null&&d(e,["error"],i);const s=l(t,["createTime"]);s!=null&&d(e,["createTime"],s);const a=l(t,["startTime"]);a!=null&&d(e,["startTime"],a);const u=l(t,["endTime"]);u!=null&&d(e,["endTime"],u);const c=l(t,["updateTime"]);c!=null&&d(e,["updateTime"],c);const h=l(t,["model"]);h!=null&&d(e,["model"],h);const p=l(t,["inputConfig"]);p!=null&&d(e,["src"],ev(p));const m=l(t,["outputConfig"]);m!=null&&d(e,["dest"],Zy(Hp(m)));const g=l(t,["completionStats"]);return g!=null&&d(e,["completionStats"],g),e}function ev(t){const e={},n=l(t,["instancesFormat"]);n!=null&&d(e,["format"],n);const r=l(t,["gcsSource","uris"]);r!=null&&d(e,["gcsUri"],r);const o=l(t,["bigquerySource","inputUri"]);return o!=null&&d(e,["bigqueryUri"],o),e}function tv(t,e){const n={};if(l(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(l(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=l(e,["fileName"]);r!=null&&d(n,["fileName"],r);const o=l(e,["inlinedRequests"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>Rv(t,s))),d(n,["requests","requests"],i)}return n}function nv(t){const e={},n=l(t,["format"]);n!=null&&d(e,["instancesFormat"],n);const r=l(t,["gcsUri"]);r!=null&&d(e,["gcsSource","uris"],r);const o=l(t,["bigqueryUri"]);if(o!=null&&d(e,["bigquerySource","inputUri"],o),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function rv(t){const e={},n=l(t,["data"]);if(n!=null&&d(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function ov(t,e){const n={},r=l(e,["name"]);return r!=null&&d(n,["_url","name"],Yr(t,r)),n}function iv(t,e){const n={},r=l(e,["name"]);return r!=null&&d(n,["_url","name"],Yr(t,r)),n}function sv(t){const e={},n=l(t,["content"]);n!=null&&d(e,["content"],n);const r=l(t,["citationMetadata"]);r!=null&&d(e,["citationMetadata"],av(r));const o=l(t,["tokenCount"]);o!=null&&d(e,["tokenCount"],o);const i=l(t,["finishReason"]);i!=null&&d(e,["finishReason"],i);const s=l(t,["avgLogprobs"]);s!=null&&d(e,["avgLogprobs"],s);const a=l(t,["groundingMetadata"]);a!=null&&d(e,["groundingMetadata"],a);const u=l(t,["index"]);u!=null&&d(e,["index"],u);const c=l(t,["logprobsResult"]);c!=null&&d(e,["logprobsResult"],c);const h=l(t,["safetyRatings"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(g=>g)),d(e,["safetyRatings"],m)}const p=l(t,["urlContextMetadata"]);return p!=null&&d(e,["urlContextMetadata"],p),e}function av(t){const e={},n=l(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),d(e,["citations"],r)}return e}function Vp(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>Fv(i))),d(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&d(e,["role"],r),e}function lv(t,e){const n={},r=l(t,["displayName"]);if(e!==void 0&&r!=null&&d(e,["batch","displayName"],r),l(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function uv(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&d(e,["displayName"],r);const o=l(t,["dest"]);return e!==void 0&&o!=null&&d(e,["outputConfig"],Qy(Jy(o))),n}function zd(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["src"]);o!=null&&d(n,["batch","inputConfig"],tv(t,Gp(t,o)));const i=l(e,["config"]);return i!=null&&lv(i,n),n}function cv(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["model"],Ge(t,r));const o=l(e,["src"]);o!=null&&d(n,["inputConfig"],nv(Gp(t,o)));const i=l(e,["config"]);return i!=null&&uv(i,n),n}function dv(t,e){const n={},r=l(t,["displayName"]);return e!==void 0&&r!=null&&d(e,["batch","displayName"],r),n}function fv(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["src"]);o!=null&&d(n,["batch","inputConfig"],xv(t,o));const i=l(e,["config"]);return i!=null&&dv(i,n),n}function hv(t,e){const n={},r=l(e,["name"]);return r!=null&&d(n,["_url","name"],Yr(t,r)),n}function pv(t,e){const n={},r=l(e,["name"]);return r!=null&&d(n,["_url","name"],Yr(t,r)),n}function mv(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["name"]);r!=null&&d(e,["name"],r);const o=l(t,["done"]);o!=null&&d(e,["done"],o);const i=l(t,["error"]);return i!=null&&d(e,["error"],i),e}function gv(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["name"]);r!=null&&d(e,["name"],r);const o=l(t,["done"]);o!=null&&d(e,["done"],o);const i=l(t,["error"]);return i!=null&&d(e,["error"],i),e}function yv(t,e){const n={},r=l(e,["contents"]);if(r!=null){let i=fu(t,r);Array.isArray(i)&&(i=i.map(s=>s)),d(n,["requests[]","request","content"],i)}const o=l(e,["config"]);return o!=null&&(d(n,["_self"],vv(o,n)),py(n,{"requests[].*":"requests[].request.*"})),n}function vv(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&d(e,["requests[]","taskType"],r);const o=l(t,["title"]);e!==void 0&&o!=null&&d(e,["requests[]","title"],o);const i=l(t,["outputDimensionality"]);if(e!==void 0&&i!=null&&d(e,["requests[]","outputDimensionality"],i),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function xv(t,e){const n={},r=l(e,["fileName"]);r!=null&&d(n,["file_name"],r);const o=l(e,["inlinedRequests"]);return o!=null&&d(n,["requests"],yv(t,o)),n}function Ev(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&d(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function Tv(t){const e={},n=l(t,["id"]);n!=null&&d(e,["id"],n);const r=l(t,["args"]);r!=null&&d(e,["args"],r);const o=l(t,["name"]);if(o!=null&&d(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Sv(t){const e={},n=l(t,["mode"]);n!=null&&d(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);if(r!=null&&d(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function wv(t,e,n){const r={},o=l(e,["systemInstruction"]);n!==void 0&&o!=null&&d(n,["systemInstruction"],Vp(gt(o)));const i=l(e,["temperature"]);i!=null&&d(r,["temperature"],i);const s=l(e,["topP"]);s!=null&&d(r,["topP"],s);const a=l(e,["topK"]);a!=null&&d(r,["topK"],a);const u=l(e,["candidateCount"]);u!=null&&d(r,["candidateCount"],u);const c=l(e,["maxOutputTokens"]);c!=null&&d(r,["maxOutputTokens"],c);const h=l(e,["stopSequences"]);h!=null&&d(r,["stopSequences"],h);const p=l(e,["responseLogprobs"]);p!=null&&d(r,["responseLogprobs"],p);const m=l(e,["logprobs"]);m!=null&&d(r,["logprobs"],m);const g=l(e,["presencePenalty"]);g!=null&&d(r,["presencePenalty"],g);const E=l(e,["frequencyPenalty"]);E!=null&&d(r,["frequencyPenalty"],E);const v=l(e,["seed"]);v!=null&&d(r,["seed"],v);const w=l(e,["responseMimeType"]);w!=null&&d(r,["responseMimeType"],w);const y=l(e,["responseSchema"]);y!=null&&d(r,["responseSchema"],hu(y));const x=l(e,["responseJsonSchema"]);if(x!=null&&d(r,["responseJsonSchema"],x),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const T=l(e,["safetySettings"]);if(n!==void 0&&T!=null){let W=T;Array.isArray(W)&&(W=W.map(C=>Gv(C))),d(n,["safetySettings"],W)}const I=l(e,["tools"]);if(n!==void 0&&I!=null){let W=qr(I);Array.isArray(W)&&(W=W.map(C=>Bv(Wr(C)))),d(n,["tools"],W)}const _=l(e,["toolConfig"]);if(n!==void 0&&_!=null&&d(n,["toolConfig"],Hv(_)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const R=l(e,["cachedContent"]);n!==void 0&&R!=null&&d(n,["cachedContent"],En(t,R));const k=l(e,["responseModalities"]);k!=null&&d(r,["responseModalities"],k);const j=l(e,["mediaResolution"]);j!=null&&d(r,["mediaResolution"],j);const D=l(e,["speechConfig"]);if(D!=null&&d(r,["speechConfig"],pu(D)),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const q=l(e,["thinkingConfig"]);q!=null&&d(r,["thinkingConfig"],q);const ae=l(e,["imageConfig"]);ae!=null&&d(r,["imageConfig"],Av(ae));const P=l(e,["enableEnhancedCivicAnswers"]);return P!=null&&d(r,["enableEnhancedCivicAnswers"],P),r}function Cv(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(c=>sv(c))),d(e,["candidates"],u)}const o=l(t,["modelVersion"]);o!=null&&d(e,["modelVersion"],o);const i=l(t,["promptFeedback"]);i!=null&&d(e,["promptFeedback"],i);const s=l(t,["responseId"]);s!=null&&d(e,["responseId"],s);const a=l(t,["usageMetadata"]);return a!=null&&d(e,["usageMetadata"],a),e}function Iv(t,e){const n={},r=l(e,["name"]);return r!=null&&d(n,["_url","name"],Yr(t,r)),n}function Nv(t,e){const n={},r=l(e,["name"]);return r!=null&&d(n,["_url","name"],Yr(t,r)),n}function _v(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&d(e,["enableWidget"],n),e}function bv(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&d(e,["timeRangeFilter"],n),e}function Av(t){const e={},n=l(t,["aspectRatio"]);n!=null&&d(e,["aspectRatio"],n);const r=l(t,["imageSize"]);if(r!=null&&d(e,["imageSize"],r),l(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(l(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Rv(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["request","model"],Ge(t,r));const o=l(e,["contents"]);if(o!=null){let a=Gt(o);Array.isArray(a)&&(a=a.map(u=>Vp(u))),d(n,["request","contents"],a)}const i=l(e,["metadata"]);i!=null&&d(n,["metadata"],i);const s=l(e,["config"]);return s!=null&&d(n,["request","generationConfig"],wv(t,s,l(n,["request"],{}))),n}function kv(t){const e={},n=l(t,["response"]);n!=null&&d(e,["response"],Cv(n));const r=l(t,["error"]);return r!=null&&d(e,["error"],r),e}function Pv(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);if(e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),l(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function Mv(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);e!==void 0&&o!=null&&d(e,["_query","pageToken"],o);const i=l(t,["filter"]);return e!==void 0&&i!=null&&d(e,["_query","filter"],i),n}function Lv(t){const e={},n=l(t,["config"]);return n!=null&&Pv(n,e),e}function Ov(t){const e={},n=l(t,["config"]);return n!=null&&Mv(n,e),e}function Dv(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);const o=l(t,["operations"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>Ii(s))),d(e,["batchJobs"],i)}return e}function Uv(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);const o=l(t,["batchPredictionJobs"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>rl(s))),d(e,["batchJobs"],i)}return e}function Fv(t){const e={},n=l(t,["mediaResolution"]);n!=null&&d(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&d(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&d(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&d(e,["fileData"],Ev(i));const s=l(t,["functionCall"]);s!=null&&d(e,["functionCall"],Tv(s));const a=l(t,["functionResponse"]);a!=null&&d(e,["functionResponse"],a);const u=l(t,["inlineData"]);u!=null&&d(e,["inlineData"],rv(u));const c=l(t,["text"]);c!=null&&d(e,["text"],c);const h=l(t,["thought"]);h!=null&&d(e,["thought"],h);const p=l(t,["thoughtSignature"]);p!=null&&d(e,["thoughtSignature"],p);const m=l(t,["videoMetadata"]);return m!=null&&d(e,["videoMetadata"],m),e}function Gv(t){const e={},n=l(t,["category"]);if(n!=null&&d(e,["category"],n),l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=l(t,["threshold"]);return r!=null&&d(e,["threshold"],r),e}function Hv(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&d(e,["functionCallingConfig"],Sv(n));const r=l(t,["retrievalConfig"]);return r!=null&&d(e,["retrievalConfig"],r),e}function Bv(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(p=>p)),d(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&d(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&d(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&d(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&d(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&d(e,["googleMaps"],_v(a));const u=l(t,["googleSearch"]);u!=null&&d(e,["googleSearch"],bv(u));const c=l(t,["urlContext"]);return c!=null&&d(e,["urlContext"],c),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var yn;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(yn||(yn={}));class ar{constructor(e,n,r,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,o)}init(e,n,r){var o,i;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=n.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(i=(o=s.config)===null||o===void 0?void 0:o.pageSize)!==null&&i!==void 0?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Vv extends xn{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new ar(yn.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)}}createInlinedGenerateContentRequest(e){const n=zd(this.apiClient,e),r=n._url,o=ve("{model}:batchGenerateContent",r),a=n.batch.inputConfig.requests,u=a.requests,c=[];for(const h of u){const p=Object.assign({},h);if(p.systemInstruction){const m=p.systemInstruction;delete p.systemInstruction;const g=p.request;g.systemInstruction=m,p.request=g}c.push(p)}return a.requests=c,delete n.config,delete n._url,delete n._query,{path:o,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const r=n?Object.assign({},n):{},o=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${o}`),r.dest===void 0){const i=this.getGcsUri(e),s=this.getBigqueryUri(e);if(i)i.endsWith(".jsonl")?r.dest=`${i.slice(0,-6)}/dest`:r.dest=`${i}_dest_${o}`;else if(s)r.dest=`${s}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=cv(this.apiClient,e);return a=ve("batchPredictionJobs",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>rl(h))}else{const c=zd(this.apiClient,e);return a=ve("{model}:batchGenerateContent",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Ii(h))}}async createEmbeddingsInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=fv(this.apiClient,e);return i=ve("{model}:asyncBatchEmbedContent",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>Ii(u))}}async get(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=Nv(this.apiClient,e);return a=ve("batchPredictionJobs/{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>rl(h))}else{const c=Iv(this.apiClient,e);return a=ve("batches/{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Ii(h))}}async cancel(e){var n,r,o,i;let s="",a={};if(this.apiClient.isVertexAI()){const u=iv(this.apiClient,e);s=ve("batchPredictionJobs/{name}:cancel",u._url),a=u._query,delete u._url,delete u._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const u=ov(this.apiClient,e);s=ve("batches/{name}:cancel",u._url),a=u._query,delete u._url,delete u._query,await this.apiClient.request({path:s,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=Ov(e);return a=ve("batchPredictionJobs",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=Uv(h),m=new Gd;return Object.assign(m,p),m})}else{const c=Lv(e);return a=ve("batches",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=Dv(h),m=new Gd;return Object.assign(m,p),m})}}async delete(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=pv(this.apiClient,e);return a=ve("batchPredictionJobs/{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>gv(h))}else{const c=hv(this.apiClient,e);return a=ve("batches/{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>mv(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zv(t){const e={},n=l(t,["data"]);if(n!=null&&d(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function jd(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>fx(i))),d(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&d(e,["role"],r),e}function jv(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&d(e,["ttl"],r);const o=l(t,["expireTime"]);e!==void 0&&o!=null&&d(e,["expireTime"],o);const i=l(t,["displayName"]);e!==void 0&&i!=null&&d(e,["displayName"],i);const s=l(t,["contents"]);if(e!==void 0&&s!=null){let h=Gt(s);Array.isArray(h)&&(h=h.map(p=>jd(p))),d(e,["contents"],h)}const a=l(t,["systemInstruction"]);e!==void 0&&a!=null&&d(e,["systemInstruction"],jd(gt(a)));const u=l(t,["tools"]);if(e!==void 0&&u!=null){let h=u;Array.isArray(h)&&(h=h.map(p=>px(p))),d(e,["tools"],h)}const c=l(t,["toolConfig"]);if(e!==void 0&&c!=null&&d(e,["toolConfig"],hx(c)),l(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function $v(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&d(e,["ttl"],r);const o=l(t,["expireTime"]);e!==void 0&&o!=null&&d(e,["expireTime"],o);const i=l(t,["displayName"]);e!==void 0&&i!=null&&d(e,["displayName"],i);const s=l(t,["contents"]);if(e!==void 0&&s!=null){let p=Gt(s);Array.isArray(p)&&(p=p.map(m=>m)),d(e,["contents"],p)}const a=l(t,["systemInstruction"]);e!==void 0&&a!=null&&d(e,["systemInstruction"],gt(a));const u=l(t,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(m=>mx(m))),d(e,["tools"],p)}const c=l(t,["toolConfig"]);e!==void 0&&c!=null&&d(e,["toolConfig"],c);const h=l(t,["kmsKeyName"]);return e!==void 0&&h!=null&&d(e,["encryption_spec","kmsKeyName"],h),n}function Wv(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["model"],Rp(t,r));const o=l(e,["config"]);return o!=null&&jv(o,n),n}function qv(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["model"],Rp(t,r));const o=l(e,["config"]);return o!=null&&$v(o,n),n}function Yv(t,e){const n={},r=l(e,["name"]);return r!=null&&d(n,["_url","name"],En(t,r)),n}function Kv(t,e){const n={},r=l(e,["name"]);return r!=null&&d(n,["_url","name"],En(t,r)),n}function Jv(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}function Xv(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}function Zv(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&d(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function Qv(t){const e={},n=l(t,["id"]);n!=null&&d(e,["id"],n);const r=l(t,["args"]);r!=null&&d(e,["args"],r);const o=l(t,["name"]);if(o!=null&&d(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function ex(t){const e={},n=l(t,["mode"]);n!=null&&d(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);if(r!=null&&d(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function tx(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&d(e,["description"],n);const r=l(t,["name"]);r!=null&&d(e,["name"],r);const o=l(t,["parameters"]);o!=null&&d(e,["parameters"],o);const i=l(t,["parametersJsonSchema"]);i!=null&&d(e,["parametersJsonSchema"],i);const s=l(t,["response"]);s!=null&&d(e,["response"],s);const a=l(t,["responseJsonSchema"]);return a!=null&&d(e,["responseJsonSchema"],a),e}function nx(t,e){const n={},r=l(e,["name"]);return r!=null&&d(n,["_url","name"],En(t,r)),n}function rx(t,e){const n={},r=l(e,["name"]);return r!=null&&d(n,["_url","name"],En(t,r)),n}function ox(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&d(e,["enableWidget"],n),e}function ix(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&d(e,["timeRangeFilter"],n),e}function sx(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),n}function ax(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),n}function lx(t){const e={},n=l(t,["config"]);return n!=null&&sx(n,e),e}function ux(t){const e={},n=l(t,["config"]);return n!=null&&ax(n,e),e}function cx(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);const o=l(t,["cachedContents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["cachedContents"],i)}return e}function dx(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);const o=l(t,["cachedContents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["cachedContents"],i)}return e}function fx(t){const e={},n=l(t,["mediaResolution"]);n!=null&&d(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&d(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&d(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&d(e,["fileData"],Zv(i));const s=l(t,["functionCall"]);s!=null&&d(e,["functionCall"],Qv(s));const a=l(t,["functionResponse"]);a!=null&&d(e,["functionResponse"],a);const u=l(t,["inlineData"]);u!=null&&d(e,["inlineData"],zv(u));const c=l(t,["text"]);c!=null&&d(e,["text"],c);const h=l(t,["thought"]);h!=null&&d(e,["thought"],h);const p=l(t,["thoughtSignature"]);p!=null&&d(e,["thoughtSignature"],p);const m=l(t,["videoMetadata"]);return m!=null&&d(e,["videoMetadata"],m),e}function hx(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&d(e,["functionCallingConfig"],ex(n));const r=l(t,["retrievalConfig"]);return r!=null&&d(e,["retrievalConfig"],r),e}function px(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(p=>p)),d(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&d(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&d(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&d(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&d(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&d(e,["googleMaps"],ox(a));const u=l(t,["googleSearch"]);u!=null&&d(e,["googleSearch"],ix(u));const c=l(t,["urlContext"]);return c!=null&&d(e,["urlContext"],c),e}function mx(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(m=>tx(m))),d(e,["functionDeclarations"],p)}const r=l(t,["retrieval"]);r!=null&&d(e,["retrieval"],r);const o=l(t,["googleSearchRetrieval"]);o!=null&&d(e,["googleSearchRetrieval"],o);const i=l(t,["computerUse"]);if(i!=null&&d(e,["computerUse"],i),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=l(t,["codeExecution"]);s!=null&&d(e,["codeExecution"],s);const a=l(t,["enterpriseWebSearch"]);a!=null&&d(e,["enterpriseWebSearch"],a);const u=l(t,["googleMaps"]);u!=null&&d(e,["googleMaps"],u);const c=l(t,["googleSearch"]);c!=null&&d(e,["googleSearch"],c);const h=l(t,["urlContext"]);return h!=null&&d(e,["urlContext"],h),e}function gx(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&d(e,["ttl"],r);const o=l(t,["expireTime"]);return e!==void 0&&o!=null&&d(e,["expireTime"],o),n}function yx(t,e){const n={},r=l(t,["ttl"]);e!==void 0&&r!=null&&d(e,["ttl"],r);const o=l(t,["expireTime"]);return e!==void 0&&o!=null&&d(e,["expireTime"],o),n}function vx(t,e){const n={},r=l(e,["name"]);r!=null&&d(n,["_url","name"],En(t,r));const o=l(e,["config"]);return o!=null&&gx(o,n),n}function xx(t,e){const n={},r=l(e,["name"]);r!=null&&d(n,["_url","name"],En(t,r));const o=l(e,["config"]);return o!=null&&yx(o,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ex extends xn{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new ar(yn.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=qv(this.apiClient,e);return a=ve("cachedContents",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const c=Wv(this.apiClient,e);return a=ve("cachedContents",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async get(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=rx(this.apiClient,e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const c=nx(this.apiClient,e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async delete(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=Kv(this.apiClient,e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=Xv(h),m=new Ud;return Object.assign(m,p),m})}else{const c=Yv(this.apiClient,e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=Jv(h),m=new Ud;return Object.assign(m,p),m})}}async update(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=xx(this.apiClient,e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const c=vx(this.apiClient,e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async listInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=ux(e);return a=ve("cachedContents",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=dx(h),m=new Fd;return Object.assign(m,p),m})}else{const c=lx(e);return a=ve("cachedContents",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=cx(h),m=new Fd;return Object.assign(m,p),m})}}}function ts(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function $d(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function _e(t){return this instanceof _e?(this.v=t,this):new _e(t)}function Kt(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(g){return function(E){return Promise.resolve(E).then(g,p)}}function a(g,E){r[g]&&(o[g]=function(v){return new Promise(function(w,y){i.push([g,v,w,y])>1||u(g,v)})},E&&(o[g]=E(o[g])))}function u(g,E){try{c(r[g](E))}catch(v){m(i[0][3],v)}}function c(g){g.value instanceof _e?Promise.resolve(g.value.v).then(h,p):m(i[0][2],g)}function h(g){u("next",g)}function p(g){u("throw",g)}function m(g,E){g(E),i.shift(),i.length&&u(i[0][0],i[0][1])}}function Jt(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof $d=="function"?$d(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=t[i]&&function(s){return new Promise(function(a,u){s=t[i](s),o(a,u,s.done,s.value)})}}function o(i,s,a,u){Promise.resolve(u).then(function(c){i({value:c,done:a})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Tx(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:zp(n)}function zp(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function Sx(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Wd(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{const o=[];let i=!0;for(;r<n&&t[r].role==="model";)o.push(t[r]),i&&!zp(t[r])&&(i=!1),r++;i?e.push(...o):e.pop()}return e}class wx{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new Cx(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Cx{constructor(e,n,r,o={},i=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=o,this.history=i,this.sendPromise=Promise.resolve(),Sx(i)}async sendMessage(e){var n;await this.sendPromise;const r=gt(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var i,s,a;const u=await o,c=(s=(i=u.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content,h=u.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let m=[];h!=null&&(m=(a=h.slice(p))!==null&&a!==void 0?a:[]);const g=c?[c]:[];this.recordHistory(r,g,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var n;await this.sendPromise;const r=gt(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});const i=await o;return this.processStreamResponse(i,r)}getHistory(e=!1){const n=e?Wd(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){return Kt(this,arguments,function*(){var o,i,s,a,u,c;const h=[];try{for(var p=!0,m=Jt(e),g;g=yield _e(m.next()),o=g.done,!o;p=!0){a=g.value,p=!1;const E=a;if(Tx(E)){const v=(c=(u=E.candidates)===null||u===void 0?void 0:u[0])===null||c===void 0?void 0:c.content;v!==void 0&&h.push(v)}yield yield _e(E)}}catch(E){i={error:E}}finally{try{!p&&!o&&(s=m.return)&&(yield _e(s.call(m)))}finally{if(i)throw i.error}}this.recordHistory(n,h)})}recordHistory(e,n,r){let o=[];n.length>0&&n.every(i=>i.role!==void 0)?o=n:o.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...Wd(r)):this.history.push(e),this.history.push(...o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ts extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Ts.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ix(t){const e={},n=l(t,["file"]);return n!=null&&d(e,["file"],n),e}function Nx(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}function _x(t){const e={},n=l(t,["name"]);return n!=null&&d(e,["_url","file"],Dp(n)),e}function bx(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}function Ax(t){const e={},n=l(t,["name"]);return n!=null&&d(e,["_url","file"],Dp(n)),e}function Rx(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),n}function kx(t){const e={},n=l(t,["config"]);return n!=null&&Rx(n,e),e}function Px(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);const o=l(t,["files"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["files"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Mx extends xn{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new ar(yn.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=kx(e);return i=ve("files",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(c=>{const h=c;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>{const c=Px(u),h=new Uy;return Object.assign(h,c),h})}}async createInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Ix(e);return i=ve("upload/v1beta/files",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const c=Nx(u),h=new Fy;return Object.assign(h,c),h})}}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Ax(e);return i=ve("files/{file}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>u)}}async delete(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=_x(e);return i=ve("files/{file}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(c=>{const h=c;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>{const c=bx(u),h=new Gy;return Object.assign(h,c),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ni(t){const e={},n=l(t,["data"]);if(n!=null&&d(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function Lx(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>Jx(i))),d(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&d(e,["role"],r),e}function Ox(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&d(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function Dx(t){const e={},n=l(t,["id"]);n!=null&&d(e,["id"],n);const r=l(t,["args"]);r!=null&&d(e,["args"],r);const o=l(t,["name"]);if(o!=null&&d(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Ux(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&d(e,["description"],n);const r=l(t,["name"]);r!=null&&d(e,["name"],r);const o=l(t,["parameters"]);o!=null&&d(e,["parameters"],o);const i=l(t,["parametersJsonSchema"]);i!=null&&d(e,["parametersJsonSchema"],i);const s=l(t,["response"]);s!=null&&d(e,["response"],s);const a=l(t,["responseJsonSchema"]);return a!=null&&d(e,["responseJsonSchema"],a),e}function Fx(t){const e={},n=l(t,["modelSelectionConfig"]);n!=null&&d(e,["modelConfig"],n);const r=l(t,["responseJsonSchema"]);r!=null&&d(e,["responseJsonSchema"],r);const o=l(t,["audioTimestamp"]);o!=null&&d(e,["audioTimestamp"],o);const i=l(t,["candidateCount"]);i!=null&&d(e,["candidateCount"],i);const s=l(t,["enableAffectiveDialog"]);s!=null&&d(e,["enableAffectiveDialog"],s);const a=l(t,["frequencyPenalty"]);a!=null&&d(e,["frequencyPenalty"],a);const u=l(t,["logprobs"]);u!=null&&d(e,["logprobs"],u);const c=l(t,["maxOutputTokens"]);c!=null&&d(e,["maxOutputTokens"],c);const h=l(t,["mediaResolution"]);h!=null&&d(e,["mediaResolution"],h);const p=l(t,["presencePenalty"]);p!=null&&d(e,["presencePenalty"],p);const m=l(t,["responseLogprobs"]);m!=null&&d(e,["responseLogprobs"],m);const g=l(t,["responseMimeType"]);g!=null&&d(e,["responseMimeType"],g);const E=l(t,["responseModalities"]);E!=null&&d(e,["responseModalities"],E);const v=l(t,["responseSchema"]);v!=null&&d(e,["responseSchema"],v);const w=l(t,["routingConfig"]);w!=null&&d(e,["routingConfig"],w);const y=l(t,["seed"]);y!=null&&d(e,["seed"],y);const x=l(t,["speechConfig"]);x!=null&&d(e,["speechConfig"],x);const T=l(t,["stopSequences"]);T!=null&&d(e,["stopSequences"],T);const I=l(t,["temperature"]);I!=null&&d(e,["temperature"],I);const _=l(t,["thinkingConfig"]);_!=null&&d(e,["thinkingConfig"],_);const R=l(t,["topK"]);R!=null&&d(e,["topK"],R);const k=l(t,["topP"]);if(k!=null&&d(e,["topP"],k),l(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Gx(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&d(e,["enableWidget"],n),e}function Hx(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&d(e,["timeRangeFilter"],n),e}function Bx(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&d(e,["setup","generationConfig"],r);const o=l(t,["responseModalities"]);e!==void 0&&o!=null&&d(e,["setup","generationConfig","responseModalities"],o);const i=l(t,["temperature"]);e!==void 0&&i!=null&&d(e,["setup","generationConfig","temperature"],i);const s=l(t,["topP"]);e!==void 0&&s!=null&&d(e,["setup","generationConfig","topP"],s);const a=l(t,["topK"]);e!==void 0&&a!=null&&d(e,["setup","generationConfig","topK"],a);const u=l(t,["maxOutputTokens"]);e!==void 0&&u!=null&&d(e,["setup","generationConfig","maxOutputTokens"],u);const c=l(t,["mediaResolution"]);e!==void 0&&c!=null&&d(e,["setup","generationConfig","mediaResolution"],c);const h=l(t,["seed"]);e!==void 0&&h!=null&&d(e,["setup","generationConfig","seed"],h);const p=l(t,["speechConfig"]);e!==void 0&&p!=null&&d(e,["setup","generationConfig","speechConfig"],mu(p));const m=l(t,["thinkingConfig"]);e!==void 0&&m!=null&&d(e,["setup","generationConfig","thinkingConfig"],m);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&d(e,["setup","generationConfig","enableAffectiveDialog"],g);const E=l(t,["systemInstruction"]);e!==void 0&&E!=null&&d(e,["setup","systemInstruction"],Lx(gt(E)));const v=l(t,["tools"]);if(e!==void 0&&v!=null){let R=qr(v);Array.isArray(R)&&(R=R.map(k=>Zx(Wr(k)))),d(e,["setup","tools"],R)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&d(e,["setup","sessionResumption"],Xx(w));const y=l(t,["inputAudioTranscription"]);e!==void 0&&y!=null&&d(e,["setup","inputAudioTranscription"],y);const x=l(t,["outputAudioTranscription"]);e!==void 0&&x!=null&&d(e,["setup","outputAudioTranscription"],x);const T=l(t,["realtimeInputConfig"]);e!==void 0&&T!=null&&d(e,["setup","realtimeInputConfig"],T);const I=l(t,["contextWindowCompression"]);e!==void 0&&I!=null&&d(e,["setup","contextWindowCompression"],I);const _=l(t,["proactivity"]);if(e!==void 0&&_!=null&&d(e,["setup","proactivity"],_),l(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function Vx(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&d(e,["setup","generationConfig"],Fx(r));const o=l(t,["responseModalities"]);e!==void 0&&o!=null&&d(e,["setup","generationConfig","responseModalities"],o);const i=l(t,["temperature"]);e!==void 0&&i!=null&&d(e,["setup","generationConfig","temperature"],i);const s=l(t,["topP"]);e!==void 0&&s!=null&&d(e,["setup","generationConfig","topP"],s);const a=l(t,["topK"]);e!==void 0&&a!=null&&d(e,["setup","generationConfig","topK"],a);const u=l(t,["maxOutputTokens"]);e!==void 0&&u!=null&&d(e,["setup","generationConfig","maxOutputTokens"],u);const c=l(t,["mediaResolution"]);e!==void 0&&c!=null&&d(e,["setup","generationConfig","mediaResolution"],c);const h=l(t,["seed"]);e!==void 0&&h!=null&&d(e,["setup","generationConfig","seed"],h);const p=l(t,["speechConfig"]);e!==void 0&&p!=null&&d(e,["setup","generationConfig","speechConfig"],mu(p));const m=l(t,["thinkingConfig"]);e!==void 0&&m!=null&&d(e,["setup","generationConfig","thinkingConfig"],m);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&d(e,["setup","generationConfig","enableAffectiveDialog"],g);const E=l(t,["systemInstruction"]);e!==void 0&&E!=null&&d(e,["setup","systemInstruction"],gt(E));const v=l(t,["tools"]);if(e!==void 0&&v!=null){let k=qr(v);Array.isArray(k)&&(k=k.map(j=>Qx(Wr(j)))),d(e,["setup","tools"],k)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&d(e,["setup","sessionResumption"],w);const y=l(t,["inputAudioTranscription"]);e!==void 0&&y!=null&&d(e,["setup","inputAudioTranscription"],y);const x=l(t,["outputAudioTranscription"]);e!==void 0&&x!=null&&d(e,["setup","outputAudioTranscription"],x);const T=l(t,["realtimeInputConfig"]);e!==void 0&&T!=null&&d(e,["setup","realtimeInputConfig"],T);const I=l(t,["contextWindowCompression"]);e!==void 0&&I!=null&&d(e,["setup","contextWindowCompression"],I);const _=l(t,["proactivity"]);e!==void 0&&_!=null&&d(e,["setup","proactivity"],_);const R=l(t,["explicitVadSignal"]);return e!==void 0&&R!=null&&d(e,["setup","explicitVadSignal"],R),n}function zx(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["setup","model"],Ge(t,r));const o=l(e,["config"]);return o!=null&&d(n,["config"],Bx(o,n)),n}function jx(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["setup","model"],Ge(t,r));const o=l(e,["config"]);return o!=null&&d(n,["config"],Vx(o,n)),n}function $x(t){const e={},n=l(t,["musicGenerationConfig"]);return n!=null&&d(e,["musicGenerationConfig"],n),e}function Wx(t){const e={},n=l(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),d(e,["weightedPrompts"],r)}return e}function qx(t){const e={},n=l(t,["media"]);if(n!=null){let c=kp(n);Array.isArray(c)&&(c=c.map(h=>Ni(h))),d(e,["mediaChunks"],c)}const r=l(t,["audio"]);r!=null&&d(e,["audio"],Ni(Mp(r)));const o=l(t,["audioStreamEnd"]);o!=null&&d(e,["audioStreamEnd"],o);const i=l(t,["video"]);i!=null&&d(e,["video"],Ni(Pp(i)));const s=l(t,["text"]);s!=null&&d(e,["text"],s);const a=l(t,["activityStart"]);a!=null&&d(e,["activityStart"],a);const u=l(t,["activityEnd"]);return u!=null&&d(e,["activityEnd"],u),e}function Yx(t){const e={},n=l(t,["media"]);if(n!=null){let c=kp(n);Array.isArray(c)&&(c=c.map(h=>h)),d(e,["mediaChunks"],c)}const r=l(t,["audio"]);r!=null&&d(e,["audio"],Mp(r));const o=l(t,["audioStreamEnd"]);o!=null&&d(e,["audioStreamEnd"],o);const i=l(t,["video"]);i!=null&&d(e,["video"],Pp(i));const s=l(t,["text"]);s!=null&&d(e,["text"],s);const a=l(t,["activityStart"]);a!=null&&d(e,["activityStart"],a);const u=l(t,["activityEnd"]);return u!=null&&d(e,["activityEnd"],u),e}function Kx(t){const e={},n=l(t,["setupComplete"]);n!=null&&d(e,["setupComplete"],n);const r=l(t,["serverContent"]);r!=null&&d(e,["serverContent"],r);const o=l(t,["toolCall"]);o!=null&&d(e,["toolCall"],o);const i=l(t,["toolCallCancellation"]);i!=null&&d(e,["toolCallCancellation"],i);const s=l(t,["usageMetadata"]);s!=null&&d(e,["usageMetadata"],eE(s));const a=l(t,["goAway"]);a!=null&&d(e,["goAway"],a);const u=l(t,["sessionResumptionUpdate"]);u!=null&&d(e,["sessionResumptionUpdate"],u);const c=l(t,["voiceActivityDetectionSignal"]);return c!=null&&d(e,["voiceActivityDetectionSignal"],c),e}function Jx(t){const e={},n=l(t,["mediaResolution"]);n!=null&&d(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&d(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&d(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&d(e,["fileData"],Ox(i));const s=l(t,["functionCall"]);s!=null&&d(e,["functionCall"],Dx(s));const a=l(t,["functionResponse"]);a!=null&&d(e,["functionResponse"],a);const u=l(t,["inlineData"]);u!=null&&d(e,["inlineData"],Ni(u));const c=l(t,["text"]);c!=null&&d(e,["text"],c);const h=l(t,["thought"]);h!=null&&d(e,["thought"],h);const p=l(t,["thoughtSignature"]);p!=null&&d(e,["thoughtSignature"],p);const m=l(t,["videoMetadata"]);return m!=null&&d(e,["videoMetadata"],m),e}function Xx(t){const e={},n=l(t,["handle"]);if(n!=null&&d(e,["handle"],n),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Zx(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(p=>p)),d(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&d(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&d(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&d(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&d(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&d(e,["googleMaps"],Gx(a));const u=l(t,["googleSearch"]);u!=null&&d(e,["googleSearch"],Hx(u));const c=l(t,["urlContext"]);return c!=null&&d(e,["urlContext"],c),e}function Qx(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(m=>Ux(m))),d(e,["functionDeclarations"],p)}const r=l(t,["retrieval"]);r!=null&&d(e,["retrieval"],r);const o=l(t,["googleSearchRetrieval"]);o!=null&&d(e,["googleSearchRetrieval"],o);const i=l(t,["computerUse"]);if(i!=null&&d(e,["computerUse"],i),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=l(t,["codeExecution"]);s!=null&&d(e,["codeExecution"],s);const a=l(t,["enterpriseWebSearch"]);a!=null&&d(e,["enterpriseWebSearch"],a);const u=l(t,["googleMaps"]);u!=null&&d(e,["googleMaps"],u);const c=l(t,["googleSearch"]);c!=null&&d(e,["googleSearch"],c);const h=l(t,["urlContext"]);return h!=null&&d(e,["urlContext"],h),e}function eE(t){const e={},n=l(t,["promptTokenCount"]);n!=null&&d(e,["promptTokenCount"],n);const r=l(t,["cachedContentTokenCount"]);r!=null&&d(e,["cachedContentTokenCount"],r);const o=l(t,["candidatesTokenCount"]);o!=null&&d(e,["responseTokenCount"],o);const i=l(t,["toolUsePromptTokenCount"]);i!=null&&d(e,["toolUsePromptTokenCount"],i);const s=l(t,["thoughtsTokenCount"]);s!=null&&d(e,["thoughtsTokenCount"],s);const a=l(t,["totalTokenCount"]);a!=null&&d(e,["totalTokenCount"],a);const u=l(t,["promptTokensDetails"]);if(u!=null){let g=u;Array.isArray(g)&&(g=g.map(E=>E)),d(e,["promptTokensDetails"],g)}const c=l(t,["cacheTokensDetails"]);if(c!=null){let g=c;Array.isArray(g)&&(g=g.map(E=>E)),d(e,["cacheTokensDetails"],g)}const h=l(t,["candidatesTokensDetails"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(E=>E)),d(e,["responseTokensDetails"],g)}const p=l(t,["toolUsePromptTokensDetails"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(E=>E)),d(e,["toolUsePromptTokensDetails"],g)}const m=l(t,["trafficType"]);return m!=null&&d(e,["trafficType"],m),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tE(t){const e={},n=l(t,["data"]);if(n!=null&&d(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function nE(t){const e={},n=l(t,["content"]);n!=null&&d(e,["content"],n);const r=l(t,["citationMetadata"]);r!=null&&d(e,["citationMetadata"],rE(r));const o=l(t,["tokenCount"]);o!=null&&d(e,["tokenCount"],o);const i=l(t,["finishReason"]);i!=null&&d(e,["finishReason"],i);const s=l(t,["avgLogprobs"]);s!=null&&d(e,["avgLogprobs"],s);const a=l(t,["groundingMetadata"]);a!=null&&d(e,["groundingMetadata"],a);const u=l(t,["index"]);u!=null&&d(e,["index"],u);const c=l(t,["logprobsResult"]);c!=null&&d(e,["logprobsResult"],c);const h=l(t,["safetyRatings"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(g=>g)),d(e,["safetyRatings"],m)}const p=l(t,["urlContextMetadata"]);return p!=null&&d(e,["urlContextMetadata"],p),e}function rE(t){const e={},n=l(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>o)),d(e,["citations"],r)}return e}function oE(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["contents"]);if(o!=null){let i=Gt(o);Array.isArray(i)&&(i=i.map(s=>s)),d(n,["contents"],i)}return n}function iE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["tokensInfo"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),d(e,["tokensInfo"],o)}return e}function sE(t){const e={},n=l(t,["values"]);n!=null&&d(e,["values"],n);const r=l(t,["statistics"]);return r!=null&&d(e,["statistics"],aE(r)),e}function aE(t){const e={},n=l(t,["truncated"]);n!=null&&d(e,["truncated"],n);const r=l(t,["token_count"]);return r!=null&&d(e,["tokenCount"],r),e}function Ss(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>gT(i))),d(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&d(e,["role"],r),e}function lE(t){const e={},n=l(t,["controlType"]);n!=null&&d(e,["controlType"],n);const r=l(t,["enableControlImageComputation"]);return r!=null&&d(e,["computeControl"],r),e}function uE(t){const e={};if(l(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(l(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(l(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function cE(t,e){const n={},r=l(t,["systemInstruction"]);e!==void 0&&r!=null&&d(e,["systemInstruction"],gt(r));const o=l(t,["tools"]);if(e!==void 0&&o!=null){let s=o;Array.isArray(s)&&(s=s.map(a=>qp(a))),d(e,["tools"],s)}const i=l(t,["generationConfig"]);return e!==void 0&&i!=null&&d(e,["generationConfig"],tT(i)),n}function dE(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["contents"]);if(o!=null){let s=Gt(o);Array.isArray(s)&&(s=s.map(a=>Ss(a))),d(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&uE(i),n}function fE(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["contents"]);if(o!=null){let s=Gt(o);Array.isArray(s)&&(s=s.map(a=>a)),d(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&cE(i,n),n}function hE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["totalTokens"]);r!=null&&d(e,["totalTokens"],r);const o=l(t,["cachedContentTokenCount"]);return o!=null&&d(e,["cachedContentTokenCount"],o),e}function pE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["totalTokens"]);return r!=null&&d(e,["totalTokens"],r),e}function mE(t,e){const n={},r=l(e,["model"]);return r!=null&&d(n,["_url","name"],Ge(t,r)),n}function gE(t,e){const n={},r=l(e,["model"]);return r!=null&&d(n,["_url","name"],Ge(t,r)),n}function yE(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}function vE(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}function xE(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&d(e,["parameters","storageUri"],r);const o=l(t,["negativePrompt"]);e!==void 0&&o!=null&&d(e,["parameters","negativePrompt"],o);const i=l(t,["numberOfImages"]);e!==void 0&&i!=null&&d(e,["parameters","sampleCount"],i);const s=l(t,["aspectRatio"]);e!==void 0&&s!=null&&d(e,["parameters","aspectRatio"],s);const a=l(t,["guidanceScale"]);e!==void 0&&a!=null&&d(e,["parameters","guidanceScale"],a);const u=l(t,["seed"]);e!==void 0&&u!=null&&d(e,["parameters","seed"],u);const c=l(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&d(e,["parameters","safetySetting"],c);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&d(e,["parameters","personGeneration"],h);const p=l(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&d(e,["parameters","includeSafetyAttributes"],p);const m=l(t,["includeRaiReason"]);e!==void 0&&m!=null&&d(e,["parameters","includeRaiReason"],m);const g=l(t,["language"]);e!==void 0&&g!=null&&d(e,["parameters","language"],g);const E=l(t,["outputMimeType"]);e!==void 0&&E!=null&&d(e,["parameters","outputOptions","mimeType"],E);const v=l(t,["outputCompressionQuality"]);e!==void 0&&v!=null&&d(e,["parameters","outputOptions","compressionQuality"],v);const w=l(t,["addWatermark"]);e!==void 0&&w!=null&&d(e,["parameters","addWatermark"],w);const y=l(t,["labels"]);e!==void 0&&y!=null&&d(e,["labels"],y);const x=l(t,["editMode"]);e!==void 0&&x!=null&&d(e,["parameters","editMode"],x);const T=l(t,["baseSteps"]);return e!==void 0&&T!=null&&d(e,["parameters","editConfig","baseSteps"],T),n}function EE(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["prompt"]);o!=null&&d(n,["instances[0]","prompt"],o);const i=l(e,["referenceImages"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>ST(u))),d(n,["instances[0]","referenceImages"],a)}const s=l(e,["config"]);return s!=null&&xE(s,n),n}function TE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>ws(i))),d(e,["generatedImages"],o)}return e}function SE(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&d(e,["requests[]","taskType"],r);const o=l(t,["title"]);e!==void 0&&o!=null&&d(e,["requests[]","title"],o);const i=l(t,["outputDimensionality"]);if(e!==void 0&&i!=null&&d(e,["requests[]","outputDimensionality"],i),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function wE(t,e){const n={},r=l(t,["taskType"]);e!==void 0&&r!=null&&d(e,["instances[]","task_type"],r);const o=l(t,["title"]);e!==void 0&&o!=null&&d(e,["instances[]","title"],o);const i=l(t,["outputDimensionality"]);e!==void 0&&i!=null&&d(e,["parameters","outputDimensionality"],i);const s=l(t,["mimeType"]);e!==void 0&&s!=null&&d(e,["instances[]","mimeType"],s);const a=l(t,["autoTruncate"]);return e!==void 0&&a!=null&&d(e,["parameters","autoTruncate"],a),n}function CE(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["contents"]);if(o!=null){let a=fu(t,o);Array.isArray(a)&&(a=a.map(u=>u)),d(n,["requests[]","content"],a)}const i=l(e,["config"]);i!=null&&SE(i,n);const s=l(e,["model"]);return s!==void 0&&d(n,["requests[]","model"],Ge(t,s)),n}function IE(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["contents"]);if(o!=null){let s=fu(t,o);Array.isArray(s)&&(s=s.map(a=>a)),d(n,["instances[]","content"],s)}const i=l(e,["config"]);return i!=null&&wE(i,n),n}function NE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["embeddings"],i)}const o=l(t,["metadata"]);return o!=null&&d(e,["metadata"],o),e}function _E(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["predictions[]","embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>sE(s))),d(e,["embeddings"],i)}const o=l(t,["metadata"]);return o!=null&&d(e,["metadata"],o),e}function bE(t){const e={},n=l(t,["endpoint"]);n!=null&&d(e,["name"],n);const r=l(t,["deployedModelId"]);return r!=null&&d(e,["deployedModelId"],r),e}function AE(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&d(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function RE(t){const e={},n=l(t,["id"]);n!=null&&d(e,["id"],n);const r=l(t,["args"]);r!=null&&d(e,["args"],r);const o=l(t,["name"]);if(o!=null&&d(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function kE(t){const e={},n=l(t,["mode"]);n!=null&&d(e,["mode"],n);const r=l(t,["allowedFunctionNames"]);if(r!=null&&d(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function PE(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=l(t,["description"]);n!=null&&d(e,["description"],n);const r=l(t,["name"]);r!=null&&d(e,["name"],r);const o=l(t,["parameters"]);o!=null&&d(e,["parameters"],o);const i=l(t,["parametersJsonSchema"]);i!=null&&d(e,["parametersJsonSchema"],i);const s=l(t,["response"]);s!=null&&d(e,["response"],s);const a=l(t,["responseJsonSchema"]);return a!=null&&d(e,["responseJsonSchema"],a),e}function ME(t,e,n){const r={},o=l(e,["systemInstruction"]);n!==void 0&&o!=null&&d(n,["systemInstruction"],Ss(gt(o)));const i=l(e,["temperature"]);i!=null&&d(r,["temperature"],i);const s=l(e,["topP"]);s!=null&&d(r,["topP"],s);const a=l(e,["topK"]);a!=null&&d(r,["topK"],a);const u=l(e,["candidateCount"]);u!=null&&d(r,["candidateCount"],u);const c=l(e,["maxOutputTokens"]);c!=null&&d(r,["maxOutputTokens"],c);const h=l(e,["stopSequences"]);h!=null&&d(r,["stopSequences"],h);const p=l(e,["responseLogprobs"]);p!=null&&d(r,["responseLogprobs"],p);const m=l(e,["logprobs"]);m!=null&&d(r,["logprobs"],m);const g=l(e,["presencePenalty"]);g!=null&&d(r,["presencePenalty"],g);const E=l(e,["frequencyPenalty"]);E!=null&&d(r,["frequencyPenalty"],E);const v=l(e,["seed"]);v!=null&&d(r,["seed"],v);const w=l(e,["responseMimeType"]);w!=null&&d(r,["responseMimeType"],w);const y=l(e,["responseSchema"]);y!=null&&d(r,["responseSchema"],hu(y));const x=l(e,["responseJsonSchema"]);if(x!=null&&d(r,["responseJsonSchema"],x),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const T=l(e,["safetySettings"]);if(n!==void 0&&T!=null){let W=T;Array.isArray(W)&&(W=W.map(C=>wT(C))),d(n,["safetySettings"],W)}const I=l(e,["tools"]);if(n!==void 0&&I!=null){let W=qr(I);Array.isArray(W)&&(W=W.map(C=>RT(Wr(C)))),d(n,["tools"],W)}const _=l(e,["toolConfig"]);if(n!==void 0&&_!=null&&d(n,["toolConfig"],AT(_)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const R=l(e,["cachedContent"]);n!==void 0&&R!=null&&d(n,["cachedContent"],En(t,R));const k=l(e,["responseModalities"]);k!=null&&d(r,["responseModalities"],k);const j=l(e,["mediaResolution"]);j!=null&&d(r,["mediaResolution"],j);const D=l(e,["speechConfig"]);if(D!=null&&d(r,["speechConfig"],pu(D)),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const q=l(e,["thinkingConfig"]);q!=null&&d(r,["thinkingConfig"],q);const ae=l(e,["imageConfig"]);ae!=null&&d(r,["imageConfig"],sT(ae));const P=l(e,["enableEnhancedCivicAnswers"]);return P!=null&&d(r,["enableEnhancedCivicAnswers"],P),r}function LE(t,e,n){const r={},o=l(e,["systemInstruction"]);n!==void 0&&o!=null&&d(n,["systemInstruction"],gt(o));const i=l(e,["temperature"]);i!=null&&d(r,["temperature"],i);const s=l(e,["topP"]);s!=null&&d(r,["topP"],s);const a=l(e,["topK"]);a!=null&&d(r,["topK"],a);const u=l(e,["candidateCount"]);u!=null&&d(r,["candidateCount"],u);const c=l(e,["maxOutputTokens"]);c!=null&&d(r,["maxOutputTokens"],c);const h=l(e,["stopSequences"]);h!=null&&d(r,["stopSequences"],h);const p=l(e,["responseLogprobs"]);p!=null&&d(r,["responseLogprobs"],p);const m=l(e,["logprobs"]);m!=null&&d(r,["logprobs"],m);const g=l(e,["presencePenalty"]);g!=null&&d(r,["presencePenalty"],g);const E=l(e,["frequencyPenalty"]);E!=null&&d(r,["frequencyPenalty"],E);const v=l(e,["seed"]);v!=null&&d(r,["seed"],v);const w=l(e,["responseMimeType"]);w!=null&&d(r,["responseMimeType"],w);const y=l(e,["responseSchema"]);y!=null&&d(r,["responseSchema"],hu(y));const x=l(e,["responseJsonSchema"]);x!=null&&d(r,["responseJsonSchema"],x);const T=l(e,["routingConfig"]);T!=null&&d(r,["routingConfig"],T);const I=l(e,["modelSelectionConfig"]);I!=null&&d(r,["modelConfig"],I);const _=l(e,["safetySettings"]);if(n!==void 0&&_!=null){let ce=_;Array.isArray(ce)&&(ce=ce.map(X=>X)),d(n,["safetySettings"],ce)}const R=l(e,["tools"]);if(n!==void 0&&R!=null){let ce=qr(R);Array.isArray(ce)&&(ce=ce.map(X=>qp(Wr(X)))),d(n,["tools"],ce)}const k=l(e,["toolConfig"]);n!==void 0&&k!=null&&d(n,["toolConfig"],k);const j=l(e,["labels"]);n!==void 0&&j!=null&&d(n,["labels"],j);const D=l(e,["cachedContent"]);n!==void 0&&D!=null&&d(n,["cachedContent"],En(t,D));const q=l(e,["responseModalities"]);q!=null&&d(r,["responseModalities"],q);const ae=l(e,["mediaResolution"]);ae!=null&&d(r,["mediaResolution"],ae);const P=l(e,["speechConfig"]);P!=null&&d(r,["speechConfig"],pu(P));const W=l(e,["audioTimestamp"]);W!=null&&d(r,["audioTimestamp"],W);const C=l(e,["thinkingConfig"]);C!=null&&d(r,["thinkingConfig"],C);const G=l(e,["imageConfig"]);if(G!=null&&d(r,["imageConfig"],aT(G)),l(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return r}function qd(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["contents"]);if(o!=null){let s=Gt(o);Array.isArray(s)&&(s=s.map(a=>Ss(a))),d(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&d(n,["generationConfig"],ME(t,i,n)),n}function Yd(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["contents"]);if(o!=null){let s=Gt(o);Array.isArray(s)&&(s=s.map(a=>a)),d(n,["contents"],s)}const i=l(e,["config"]);return i!=null&&d(n,["generationConfig"],LE(t,i,n)),n}function Kd(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(c=>nE(c))),d(e,["candidates"],u)}const o=l(t,["modelVersion"]);o!=null&&d(e,["modelVersion"],o);const i=l(t,["promptFeedback"]);i!=null&&d(e,["promptFeedback"],i);const s=l(t,["responseId"]);s!=null&&d(e,["responseId"],s);const a=l(t,["usageMetadata"]);return a!=null&&d(e,["usageMetadata"],a),e}function Jd(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(h=>h)),d(e,["candidates"],c)}const o=l(t,["createTime"]);o!=null&&d(e,["createTime"],o);const i=l(t,["modelVersion"]);i!=null&&d(e,["modelVersion"],i);const s=l(t,["promptFeedback"]);s!=null&&d(e,["promptFeedback"],s);const a=l(t,["responseId"]);a!=null&&d(e,["responseId"],a);const u=l(t,["usageMetadata"]);return u!=null&&d(e,["usageMetadata"],u),e}function OE(t,e){const n={};if(l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&d(e,["parameters","sampleCount"],r);const o=l(t,["aspectRatio"]);e!==void 0&&o!=null&&d(e,["parameters","aspectRatio"],o);const i=l(t,["guidanceScale"]);if(e!==void 0&&i!=null&&d(e,["parameters","guidanceScale"],i),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=l(t,["safetyFilterLevel"]);e!==void 0&&s!=null&&d(e,["parameters","safetySetting"],s);const a=l(t,["personGeneration"]);e!==void 0&&a!=null&&d(e,["parameters","personGeneration"],a);const u=l(t,["includeSafetyAttributes"]);e!==void 0&&u!=null&&d(e,["parameters","includeSafetyAttributes"],u);const c=l(t,["includeRaiReason"]);e!==void 0&&c!=null&&d(e,["parameters","includeRaiReason"],c);const h=l(t,["language"]);e!==void 0&&h!=null&&d(e,["parameters","language"],h);const p=l(t,["outputMimeType"]);e!==void 0&&p!=null&&d(e,["parameters","outputOptions","mimeType"],p);const m=l(t,["outputCompressionQuality"]);if(e!==void 0&&m!=null&&d(e,["parameters","outputOptions","compressionQuality"],m),l(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(l(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const g=l(t,["imageSize"]);if(e!==void 0&&g!=null&&d(e,["parameters","sampleImageSize"],g),l(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function DE(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&d(e,["parameters","storageUri"],r);const o=l(t,["negativePrompt"]);e!==void 0&&o!=null&&d(e,["parameters","negativePrompt"],o);const i=l(t,["numberOfImages"]);e!==void 0&&i!=null&&d(e,["parameters","sampleCount"],i);const s=l(t,["aspectRatio"]);e!==void 0&&s!=null&&d(e,["parameters","aspectRatio"],s);const a=l(t,["guidanceScale"]);e!==void 0&&a!=null&&d(e,["parameters","guidanceScale"],a);const u=l(t,["seed"]);e!==void 0&&u!=null&&d(e,["parameters","seed"],u);const c=l(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&d(e,["parameters","safetySetting"],c);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&d(e,["parameters","personGeneration"],h);const p=l(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&d(e,["parameters","includeSafetyAttributes"],p);const m=l(t,["includeRaiReason"]);e!==void 0&&m!=null&&d(e,["parameters","includeRaiReason"],m);const g=l(t,["language"]);e!==void 0&&g!=null&&d(e,["parameters","language"],g);const E=l(t,["outputMimeType"]);e!==void 0&&E!=null&&d(e,["parameters","outputOptions","mimeType"],E);const v=l(t,["outputCompressionQuality"]);e!==void 0&&v!=null&&d(e,["parameters","outputOptions","compressionQuality"],v);const w=l(t,["addWatermark"]);e!==void 0&&w!=null&&d(e,["parameters","addWatermark"],w);const y=l(t,["labels"]);e!==void 0&&y!=null&&d(e,["labels"],y);const x=l(t,["imageSize"]);e!==void 0&&x!=null&&d(e,["parameters","sampleImageSize"],x);const T=l(t,["enhancePrompt"]);return e!==void 0&&T!=null&&d(e,["parameters","enhancePrompt"],T),n}function UE(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["prompt"]);o!=null&&d(n,["instances[0]","prompt"],o);const i=l(e,["config"]);return i!=null&&OE(i,n),n}function FE(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["prompt"]);o!=null&&d(n,["instances[0]","prompt"],o);const i=l(e,["config"]);return i!=null&&DE(i,n),n}function GE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>XE(s))),d(e,["generatedImages"],i)}const o=l(t,["positivePromptSafetyAttributes"]);return o!=null&&d(e,["positivePromptSafetyAttributes"],$p(o)),e}function HE(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>ws(s))),d(e,["generatedImages"],i)}const o=l(t,["positivePromptSafetyAttributes"]);return o!=null&&d(e,["positivePromptSafetyAttributes"],Wp(o)),e}function BE(t,e){const n={},r=l(t,["numberOfVideos"]);if(e!==void 0&&r!=null&&d(e,["parameters","sampleCount"],r),l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=l(t,["durationSeconds"]);if(e!==void 0&&o!=null&&d(e,["parameters","durationSeconds"],o),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const i=l(t,["aspectRatio"]);e!==void 0&&i!=null&&d(e,["parameters","aspectRatio"],i);const s=l(t,["resolution"]);e!==void 0&&s!=null&&d(e,["parameters","resolution"],s);const a=l(t,["personGeneration"]);if(e!==void 0&&a!=null&&d(e,["parameters","personGeneration"],a),l(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const u=l(t,["negativePrompt"]);e!==void 0&&u!=null&&d(e,["parameters","negativePrompt"],u);const c=l(t,["enhancePrompt"]);if(e!==void 0&&c!=null&&d(e,["parameters","enhancePrompt"],c),l(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const h=l(t,["lastFrame"]);e!==void 0&&h!=null&&d(e,["instances[0]","lastFrame"],Cs(h));const p=l(t,["referenceImages"]);if(e!==void 0&&p!=null){let m=p;Array.isArray(m)&&(m=m.map(g=>zT(g))),d(e,["instances[0]","referenceImages"],m)}if(l(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(l(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function VE(t,e){const n={},r=l(t,["numberOfVideos"]);e!==void 0&&r!=null&&d(e,["parameters","sampleCount"],r);const o=l(t,["outputGcsUri"]);e!==void 0&&o!=null&&d(e,["parameters","storageUri"],o);const i=l(t,["fps"]);e!==void 0&&i!=null&&d(e,["parameters","fps"],i);const s=l(t,["durationSeconds"]);e!==void 0&&s!=null&&d(e,["parameters","durationSeconds"],s);const a=l(t,["seed"]);e!==void 0&&a!=null&&d(e,["parameters","seed"],a);const u=l(t,["aspectRatio"]);e!==void 0&&u!=null&&d(e,["parameters","aspectRatio"],u);const c=l(t,["resolution"]);e!==void 0&&c!=null&&d(e,["parameters","resolution"],c);const h=l(t,["personGeneration"]);e!==void 0&&h!=null&&d(e,["parameters","personGeneration"],h);const p=l(t,["pubsubTopic"]);e!==void 0&&p!=null&&d(e,["parameters","pubsubTopic"],p);const m=l(t,["negativePrompt"]);e!==void 0&&m!=null&&d(e,["parameters","negativePrompt"],m);const g=l(t,["enhancePrompt"]);e!==void 0&&g!=null&&d(e,["parameters","enhancePrompt"],g);const E=l(t,["generateAudio"]);e!==void 0&&E!=null&&d(e,["parameters","generateAudio"],E);const v=l(t,["lastFrame"]);e!==void 0&&v!=null&&d(e,["instances[0]","lastFrame"],Qt(v));const w=l(t,["referenceImages"]);if(e!==void 0&&w!=null){let T=w;Array.isArray(T)&&(T=T.map(I=>jT(I))),d(e,["instances[0]","referenceImages"],T)}const y=l(t,["mask"]);e!==void 0&&y!=null&&d(e,["instances[0]","mask"],VT(y));const x=l(t,["compressionQuality"]);return e!==void 0&&x!=null&&d(e,["parameters","compressionQuality"],x),n}function zE(t){const e={},n=l(t,["name"]);n!=null&&d(e,["name"],n);const r=l(t,["metadata"]);r!=null&&d(e,["metadata"],r);const o=l(t,["done"]);o!=null&&d(e,["done"],o);const i=l(t,["error"]);i!=null&&d(e,["error"],i);const s=l(t,["response","generateVideoResponse"]);return s!=null&&d(e,["response"],qE(s)),e}function jE(t){const e={},n=l(t,["name"]);n!=null&&d(e,["name"],n);const r=l(t,["metadata"]);r!=null&&d(e,["metadata"],r);const o=l(t,["done"]);o!=null&&d(e,["done"],o);const i=l(t,["error"]);i!=null&&d(e,["error"],i);const s=l(t,["response"]);return s!=null&&d(e,["response"],YE(s)),e}function $E(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["prompt"]);o!=null&&d(n,["instances[0]","prompt"],o);const i=l(e,["image"]);i!=null&&d(n,["instances[0]","image"],Cs(i));const s=l(e,["video"]);s!=null&&d(n,["instances[0]","video"],Yp(s));const a=l(e,["source"]);a!=null&&KE(a,n);const u=l(e,["config"]);return u!=null&&BE(u,n),n}function WE(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["prompt"]);o!=null&&d(n,["instances[0]","prompt"],o);const i=l(e,["image"]);i!=null&&d(n,["instances[0]","image"],Qt(i));const s=l(e,["video"]);s!=null&&d(n,["instances[0]","video"],Kp(s));const a=l(e,["source"]);a!=null&&JE(a,n);const u=l(e,["config"]);return u!=null&&VE(u,n),n}function qE(t){const e={},n=l(t,["generatedSamples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>QE(s))),d(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&d(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&d(e,["raiMediaFilteredReasons"],o),e}function YE(t){const e={},n=l(t,["videos"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>eT(s))),d(e,["generatedVideos"],i)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&d(e,["raiMediaFilteredCount"],r);const o=l(t,["raiMediaFilteredReasons"]);return o!=null&&d(e,["raiMediaFilteredReasons"],o),e}function KE(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&d(e,["instances[0]","prompt"],r);const o=l(t,["image"]);e!==void 0&&o!=null&&d(e,["instances[0]","image"],Cs(o));const i=l(t,["video"]);return e!==void 0&&i!=null&&d(e,["instances[0]","video"],Yp(i)),n}function JE(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&d(e,["instances[0]","prompt"],r);const o=l(t,["image"]);e!==void 0&&o!=null&&d(e,["instances[0]","image"],Qt(o));const i=l(t,["video"]);return e!==void 0&&i!=null&&d(e,["instances[0]","video"],Kp(i)),n}function XE(t){const e={},n=l(t,["_self"]);n!=null&&d(e,["image"],lT(n));const r=l(t,["raiFilteredReason"]);r!=null&&d(e,["raiFilteredReason"],r);const o=l(t,["_self"]);return o!=null&&d(e,["safetyAttributes"],$p(o)),e}function ws(t){const e={},n=l(t,["_self"]);n!=null&&d(e,["image"],jp(n));const r=l(t,["raiFilteredReason"]);r!=null&&d(e,["raiFilteredReason"],r);const o=l(t,["_self"]);o!=null&&d(e,["safetyAttributes"],Wp(o));const i=l(t,["prompt"]);return i!=null&&d(e,["enhancedPrompt"],i),e}function ZE(t){const e={},n=l(t,["_self"]);n!=null&&d(e,["mask"],jp(n));const r=l(t,["labels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),d(e,["labels"],o)}return e}function QE(t){const e={},n=l(t,["video"]);return n!=null&&d(e,["video"],HT(n)),e}function eT(t){const e={},n=l(t,["_self"]);return n!=null&&d(e,["video"],BT(n)),e}function tT(t){const e={},n=l(t,["modelSelectionConfig"]);n!=null&&d(e,["modelConfig"],n);const r=l(t,["responseJsonSchema"]);r!=null&&d(e,["responseJsonSchema"],r);const o=l(t,["audioTimestamp"]);o!=null&&d(e,["audioTimestamp"],o);const i=l(t,["candidateCount"]);i!=null&&d(e,["candidateCount"],i);const s=l(t,["enableAffectiveDialog"]);s!=null&&d(e,["enableAffectiveDialog"],s);const a=l(t,["frequencyPenalty"]);a!=null&&d(e,["frequencyPenalty"],a);const u=l(t,["logprobs"]);u!=null&&d(e,["logprobs"],u);const c=l(t,["maxOutputTokens"]);c!=null&&d(e,["maxOutputTokens"],c);const h=l(t,["mediaResolution"]);h!=null&&d(e,["mediaResolution"],h);const p=l(t,["presencePenalty"]);p!=null&&d(e,["presencePenalty"],p);const m=l(t,["responseLogprobs"]);m!=null&&d(e,["responseLogprobs"],m);const g=l(t,["responseMimeType"]);g!=null&&d(e,["responseMimeType"],g);const E=l(t,["responseModalities"]);E!=null&&d(e,["responseModalities"],E);const v=l(t,["responseSchema"]);v!=null&&d(e,["responseSchema"],v);const w=l(t,["routingConfig"]);w!=null&&d(e,["routingConfig"],w);const y=l(t,["seed"]);y!=null&&d(e,["seed"],y);const x=l(t,["speechConfig"]);x!=null&&d(e,["speechConfig"],x);const T=l(t,["stopSequences"]);T!=null&&d(e,["stopSequences"],T);const I=l(t,["temperature"]);I!=null&&d(e,["temperature"],I);const _=l(t,["thinkingConfig"]);_!=null&&d(e,["thinkingConfig"],_);const R=l(t,["topK"]);R!=null&&d(e,["topK"],R);const k=l(t,["topP"]);if(k!=null&&d(e,["topP"],k),l(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function nT(t,e){const n={},r=l(e,["model"]);return r!=null&&d(n,["_url","name"],Ge(t,r)),n}function rT(t,e){const n={},r=l(e,["model"]);return r!=null&&d(n,["_url","name"],Ge(t,r)),n}function oT(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&d(e,["enableWidget"],n),e}function iT(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&d(e,["timeRangeFilter"],n),e}function sT(t){const e={},n=l(t,["aspectRatio"]);n!=null&&d(e,["aspectRatio"],n);const r=l(t,["imageSize"]);if(r!=null&&d(e,["imageSize"],r),l(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(l(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function aT(t){const e={},n=l(t,["aspectRatio"]);n!=null&&d(e,["aspectRatio"],n);const r=l(t,["imageSize"]);r!=null&&d(e,["imageSize"],r);const o=l(t,["outputMimeType"]);o!=null&&d(e,["imageOutputOptions","mimeType"],o);const i=l(t,["outputCompressionQuality"]);return i!=null&&d(e,["imageOutputOptions","compressionQuality"],i),e}function lT(t){const e={},n=l(t,["bytesBase64Encoded"]);n!=null&&d(e,["imageBytes"],$n(n));const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function jp(t){const e={},n=l(t,["gcsUri"]);n!=null&&d(e,["gcsUri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&d(e,["imageBytes"],$n(r));const o=l(t,["mimeType"]);return o!=null&&d(e,["mimeType"],o),e}function Cs(t){const e={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=l(t,["imageBytes"]);n!=null&&d(e,["bytesBase64Encoded"],$n(n));const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function Qt(t){const e={},n=l(t,["gcsUri"]);n!=null&&d(e,["gcsUri"],n);const r=l(t,["imageBytes"]);r!=null&&d(e,["bytesBase64Encoded"],$n(r));const o=l(t,["mimeType"]);return o!=null&&d(e,["mimeType"],o),e}function uT(t,e,n){const r={},o=l(e,["pageSize"]);n!==void 0&&o!=null&&d(n,["_query","pageSize"],o);const i=l(e,["pageToken"]);n!==void 0&&i!=null&&d(n,["_query","pageToken"],i);const s=l(e,["filter"]);n!==void 0&&s!=null&&d(n,["_query","filter"],s);const a=l(e,["queryBase"]);return n!==void 0&&a!=null&&d(n,["_url","models_url"],Up(t,a)),r}function cT(t,e,n){const r={},o=l(e,["pageSize"]);n!==void 0&&o!=null&&d(n,["_query","pageSize"],o);const i=l(e,["pageToken"]);n!==void 0&&i!=null&&d(n,["_query","pageToken"],i);const s=l(e,["filter"]);n!==void 0&&s!=null&&d(n,["_query","filter"],s);const a=l(e,["queryBase"]);return n!==void 0&&a!=null&&d(n,["_url","models_url"],Up(t,a)),r}function dT(t,e){const n={},r=l(e,["config"]);return r!=null&&uT(t,r,n),n}function fT(t,e){const n={},r=l(e,["config"]);return r!=null&&cT(t,r,n),n}function hT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);const o=l(t,["_self"]);if(o!=null){let i=Fp(o);Array.isArray(i)&&(i=i.map(s=>ol(s))),d(e,["models"],i)}return e}function pT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);const o=l(t,["_self"]);if(o!=null){let i=Fp(o);Array.isArray(i)&&(i=i.map(s=>il(s))),d(e,["models"],i)}return e}function mT(t){const e={},n=l(t,["maskMode"]);n!=null&&d(e,["maskMode"],n);const r=l(t,["segmentationClasses"]);r!=null&&d(e,["maskClasses"],r);const o=l(t,["maskDilation"]);return o!=null&&d(e,["dilation"],o),e}function ol(t){const e={},n=l(t,["name"]);n!=null&&d(e,["name"],n);const r=l(t,["displayName"]);r!=null&&d(e,["displayName"],r);const o=l(t,["description"]);o!=null&&d(e,["description"],o);const i=l(t,["version"]);i!=null&&d(e,["version"],i);const s=l(t,["_self"]);s!=null&&d(e,["tunedModelInfo"],kT(s));const a=l(t,["inputTokenLimit"]);a!=null&&d(e,["inputTokenLimit"],a);const u=l(t,["outputTokenLimit"]);u!=null&&d(e,["outputTokenLimit"],u);const c=l(t,["supportedGenerationMethods"]);c!=null&&d(e,["supportedActions"],c);const h=l(t,["temperature"]);h!=null&&d(e,["temperature"],h);const p=l(t,["maxTemperature"]);p!=null&&d(e,["maxTemperature"],p);const m=l(t,["topP"]);m!=null&&d(e,["topP"],m);const g=l(t,["topK"]);g!=null&&d(e,["topK"],g);const E=l(t,["thinking"]);return E!=null&&d(e,["thinking"],E),e}function il(t){const e={},n=l(t,["name"]);n!=null&&d(e,["name"],n);const r=l(t,["displayName"]);r!=null&&d(e,["displayName"],r);const o=l(t,["description"]);o!=null&&d(e,["description"],o);const i=l(t,["versionId"]);i!=null&&d(e,["version"],i);const s=l(t,["deployedModels"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(m=>bE(m))),d(e,["endpoints"],p)}const a=l(t,["labels"]);a!=null&&d(e,["labels"],a);const u=l(t,["_self"]);u!=null&&d(e,["tunedModelInfo"],PT(u));const c=l(t,["defaultCheckpointId"]);c!=null&&d(e,["defaultCheckpointId"],c);const h=l(t,["checkpoints"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(m=>m)),d(e,["checkpoints"],p)}return e}function gT(t){const e={},n=l(t,["mediaResolution"]);n!=null&&d(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&d(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&d(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&d(e,["fileData"],AE(i));const s=l(t,["functionCall"]);s!=null&&d(e,["functionCall"],RE(s));const a=l(t,["functionResponse"]);a!=null&&d(e,["functionResponse"],a);const u=l(t,["inlineData"]);u!=null&&d(e,["inlineData"],tE(u));const c=l(t,["text"]);c!=null&&d(e,["text"],c);const h=l(t,["thought"]);h!=null&&d(e,["thought"],h);const p=l(t,["thoughtSignature"]);p!=null&&d(e,["thoughtSignature"],p);const m=l(t,["videoMetadata"]);return m!=null&&d(e,["videoMetadata"],m),e}function yT(t){const e={},n=l(t,["productImage"]);return n!=null&&d(e,["image"],Qt(n)),e}function vT(t,e){const n={},r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&d(e,["parameters","sampleCount"],r);const o=l(t,["baseSteps"]);e!==void 0&&o!=null&&d(e,["parameters","baseSteps"],o);const i=l(t,["outputGcsUri"]);e!==void 0&&i!=null&&d(e,["parameters","storageUri"],i);const s=l(t,["seed"]);e!==void 0&&s!=null&&d(e,["parameters","seed"],s);const a=l(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&d(e,["parameters","safetySetting"],a);const u=l(t,["personGeneration"]);e!==void 0&&u!=null&&d(e,["parameters","personGeneration"],u);const c=l(t,["addWatermark"]);e!==void 0&&c!=null&&d(e,["parameters","addWatermark"],c);const h=l(t,["outputMimeType"]);e!==void 0&&h!=null&&d(e,["parameters","outputOptions","mimeType"],h);const p=l(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&d(e,["parameters","outputOptions","compressionQuality"],p);const m=l(t,["enhancePrompt"]);e!==void 0&&m!=null&&d(e,["parameters","enhancePrompt"],m);const g=l(t,["labels"]);return e!==void 0&&g!=null&&d(e,["labels"],g),n}function xT(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["source"]);o!=null&&TT(o,n);const i=l(e,["config"]);return i!=null&&vT(i,n),n}function ET(t){const e={},n=l(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>ws(o))),d(e,["generatedImages"],r)}return e}function TT(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&d(e,["instances[0]","prompt"],r);const o=l(t,["personImage"]);e!==void 0&&o!=null&&d(e,["instances[0]","personImage","image"],Qt(o));const i=l(t,["productImages"]);if(e!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>yT(a))),d(e,["instances[0]","productImages"],s)}return n}function ST(t){const e={},n=l(t,["referenceImage"]);n!=null&&d(e,["referenceImage"],Qt(n));const r=l(t,["referenceId"]);r!=null&&d(e,["referenceId"],r);const o=l(t,["referenceType"]);o!=null&&d(e,["referenceType"],o);const i=l(t,["maskImageConfig"]);i!=null&&d(e,["maskImageConfig"],mT(i));const s=l(t,["controlImageConfig"]);s!=null&&d(e,["controlImageConfig"],lE(s));const a=l(t,["styleImageConfig"]);a!=null&&d(e,["styleImageConfig"],a);const u=l(t,["subjectImageConfig"]);return u!=null&&d(e,["subjectImageConfig"],u),e}function $p(t){const e={},n=l(t,["safetyAttributes","categories"]);n!=null&&d(e,["categories"],n);const r=l(t,["safetyAttributes","scores"]);r!=null&&d(e,["scores"],r);const o=l(t,["contentType"]);return o!=null&&d(e,["contentType"],o),e}function Wp(t){const e={},n=l(t,["safetyAttributes","categories"]);n!=null&&d(e,["categories"],n);const r=l(t,["safetyAttributes","scores"]);r!=null&&d(e,["scores"],r);const o=l(t,["contentType"]);return o!=null&&d(e,["contentType"],o),e}function wT(t){const e={},n=l(t,["category"]);if(n!=null&&d(e,["category"],n),l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=l(t,["threshold"]);return r!=null&&d(e,["threshold"],r),e}function CT(t){const e={},n=l(t,["image"]);return n!=null&&d(e,["image"],Qt(n)),e}function IT(t,e){const n={},r=l(t,["mode"]);e!==void 0&&r!=null&&d(e,["parameters","mode"],r);const o=l(t,["maxPredictions"]);e!==void 0&&o!=null&&d(e,["parameters","maxPredictions"],o);const i=l(t,["confidenceThreshold"]);e!==void 0&&i!=null&&d(e,["parameters","confidenceThreshold"],i);const s=l(t,["maskDilation"]);e!==void 0&&s!=null&&d(e,["parameters","maskDilation"],s);const a=l(t,["binaryColorThreshold"]);e!==void 0&&a!=null&&d(e,["parameters","binaryColorThreshold"],a);const u=l(t,["labels"]);return e!==void 0&&u!=null&&d(e,["labels"],u),n}function NT(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["source"]);o!=null&&bT(o,n);const i=l(e,["config"]);return i!=null&&IT(i,n),n}function _T(t){const e={},n=l(t,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(o=>ZE(o))),d(e,["generatedMasks"],r)}return e}function bT(t,e){const n={},r=l(t,["prompt"]);e!==void 0&&r!=null&&d(e,["instances[0]","prompt"],r);const o=l(t,["image"]);e!==void 0&&o!=null&&d(e,["instances[0]","image"],Qt(o));const i=l(t,["scribbleImage"]);return e!==void 0&&i!=null&&d(e,["instances[0]","scribble"],CT(i)),n}function AT(t){const e={},n=l(t,["functionCallingConfig"]);n!=null&&d(e,["functionCallingConfig"],kE(n));const r=l(t,["retrievalConfig"]);return r!=null&&d(e,["retrievalConfig"],r),e}function RT(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(p=>p)),d(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&d(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&d(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&d(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&d(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&d(e,["googleMaps"],oT(a));const u=l(t,["googleSearch"]);u!=null&&d(e,["googleSearch"],iT(u));const c=l(t,["urlContext"]);return c!=null&&d(e,["urlContext"],c),e}function qp(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(m=>PE(m))),d(e,["functionDeclarations"],p)}const r=l(t,["retrieval"]);r!=null&&d(e,["retrieval"],r);const o=l(t,["googleSearchRetrieval"]);o!=null&&d(e,["googleSearchRetrieval"],o);const i=l(t,["computerUse"]);if(i!=null&&d(e,["computerUse"],i),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=l(t,["codeExecution"]);s!=null&&d(e,["codeExecution"],s);const a=l(t,["enterpriseWebSearch"]);a!=null&&d(e,["enterpriseWebSearch"],a);const u=l(t,["googleMaps"]);u!=null&&d(e,["googleMaps"],u);const c=l(t,["googleSearch"]);c!=null&&d(e,["googleSearch"],c);const h=l(t,["urlContext"]);return h!=null&&d(e,["urlContext"],h),e}function kT(t){const e={},n=l(t,["baseModel"]);n!=null&&d(e,["baseModel"],n);const r=l(t,["createTime"]);r!=null&&d(e,["createTime"],r);const o=l(t,["updateTime"]);return o!=null&&d(e,["updateTime"],o),e}function PT(t){const e={},n=l(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&d(e,["baseModel"],n);const r=l(t,["createTime"]);r!=null&&d(e,["createTime"],r);const o=l(t,["updateTime"]);return o!=null&&d(e,["updateTime"],o),e}function MT(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&d(e,["displayName"],r);const o=l(t,["description"]);e!==void 0&&o!=null&&d(e,["description"],o);const i=l(t,["defaultCheckpointId"]);return e!==void 0&&i!=null&&d(e,["defaultCheckpointId"],i),n}function LT(t,e){const n={},r=l(t,["displayName"]);e!==void 0&&r!=null&&d(e,["displayName"],r);const o=l(t,["description"]);e!==void 0&&o!=null&&d(e,["description"],o);const i=l(t,["defaultCheckpointId"]);return e!==void 0&&i!=null&&d(e,["defaultCheckpointId"],i),n}function OT(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","name"],Ge(t,r));const o=l(e,["config"]);return o!=null&&MT(o,n),n}function DT(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["config"]);return o!=null&&LT(o,n),n}function UT(t,e){const n={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&d(e,["parameters","storageUri"],r);const o=l(t,["safetyFilterLevel"]);e!==void 0&&o!=null&&d(e,["parameters","safetySetting"],o);const i=l(t,["personGeneration"]);e!==void 0&&i!=null&&d(e,["parameters","personGeneration"],i);const s=l(t,["includeRaiReason"]);e!==void 0&&s!=null&&d(e,["parameters","includeRaiReason"],s);const a=l(t,["outputMimeType"]);e!==void 0&&a!=null&&d(e,["parameters","outputOptions","mimeType"],a);const u=l(t,["outputCompressionQuality"]);e!==void 0&&u!=null&&d(e,["parameters","outputOptions","compressionQuality"],u);const c=l(t,["enhanceInputImage"]);e!==void 0&&c!=null&&d(e,["parameters","upscaleConfig","enhanceInputImage"],c);const h=l(t,["imagePreservationFactor"]);e!==void 0&&h!=null&&d(e,["parameters","upscaleConfig","imagePreservationFactor"],h);const p=l(t,["labels"]);e!==void 0&&p!=null&&d(e,["labels"],p);const m=l(t,["numberOfImages"]);e!==void 0&&m!=null&&d(e,["parameters","sampleCount"],m);const g=l(t,["mode"]);return e!==void 0&&g!=null&&d(e,["parameters","mode"],g),n}function FT(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["_url","model"],Ge(t,r));const o=l(e,["image"]);o!=null&&d(n,["instances[0]","image"],Qt(o));const i=l(e,["upscaleFactor"]);i!=null&&d(n,["parameters","upscaleConfig","upscaleFactor"],i);const s=l(e,["config"]);return s!=null&&UT(s,n),n}function GT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>ws(i))),d(e,["generatedImages"],o)}return e}function HT(t){const e={},n=l(t,["uri"]);n!=null&&d(e,["uri"],n);const r=l(t,["encodedVideo"]);r!=null&&d(e,["videoBytes"],$n(r));const o=l(t,["encoding"]);return o!=null&&d(e,["mimeType"],o),e}function BT(t){const e={},n=l(t,["gcsUri"]);n!=null&&d(e,["uri"],n);const r=l(t,["bytesBase64Encoded"]);r!=null&&d(e,["videoBytes"],$n(r));const o=l(t,["mimeType"]);return o!=null&&d(e,["mimeType"],o),e}function VT(t){const e={},n=l(t,["image"]);n!=null&&d(e,["_self"],Qt(n));const r=l(t,["maskMode"]);return r!=null&&d(e,["maskMode"],r),e}function zT(t){const e={},n=l(t,["image"]);n!=null&&d(e,["image"],Cs(n));const r=l(t,["referenceType"]);return r!=null&&d(e,["referenceType"],r),e}function jT(t){const e={},n=l(t,["image"]);n!=null&&d(e,["image"],Qt(n));const r=l(t,["referenceType"]);return r!=null&&d(e,["referenceType"],r),e}function Yp(t){const e={},n=l(t,["uri"]);n!=null&&d(e,["uri"],n);const r=l(t,["videoBytes"]);r!=null&&d(e,["encodedVideo"],$n(r));const o=l(t,["mimeType"]);return o!=null&&d(e,["encoding"],o),e}function Kp(t){const e={},n=l(t,["uri"]);n!=null&&d(e,["gcsUri"],n);const r=l(t,["videoBytes"]);r!=null&&d(e,["bytesBase64Encoded"],$n(r));const o=l(t,["mimeType"]);return o!=null&&d(e,["mimeType"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $T(t,e){const n={},r=l(t,["displayName"]);return e!==void 0&&r!=null&&d(e,["displayName"],r),n}function WT(t){const e={},n=l(t,["config"]);return n!=null&&$T(n,e),e}function qT(t,e){const n={},r=l(t,["force"]);return e!==void 0&&r!=null&&d(e,["_query","force"],r),n}function YT(t){const e={},n=l(t,["name"]);n!=null&&d(e,["_url","name"],n);const r=l(t,["config"]);return r!=null&&qT(r,e),e}function KT(t){const e={},n=l(t,["name"]);return n!=null&&d(e,["_url","name"],n),e}function JT(t,e){const n={},r=l(t,["customMetadata"]);if(e!==void 0&&r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["customMetadata"],i)}const o=l(t,["chunkingConfig"]);return e!==void 0&&o!=null&&d(e,["chunkingConfig"],o),n}function XT(t){const e={},n=l(t,["name"]);n!=null&&d(e,["name"],n);const r=l(t,["metadata"]);r!=null&&d(e,["metadata"],r);const o=l(t,["done"]);o!=null&&d(e,["done"],o);const i=l(t,["error"]);i!=null&&d(e,["error"],i);const s=l(t,["response"]);return s!=null&&d(e,["response"],QT(s)),e}function ZT(t){const e={},n=l(t,["fileSearchStoreName"]);n!=null&&d(e,["_url","file_search_store_name"],n);const r=l(t,["fileName"]);r!=null&&d(e,["fileName"],r);const o=l(t,["config"]);return o!=null&&JT(o,e),e}function QT(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["parent"]);r!=null&&d(e,["parent"],r);const o=l(t,["documentName"]);return o!=null&&d(e,["documentName"],o),e}function eS(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),n}function tS(t){const e={},n=l(t,["config"]);return n!=null&&eS(n,e),e}function nS(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);const o=l(t,["fileSearchStores"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["fileSearchStores"],i)}return e}function Jp(t,e){const n={},r=l(t,["mimeType"]);e!==void 0&&r!=null&&d(e,["mimeType"],r);const o=l(t,["displayName"]);e!==void 0&&o!=null&&d(e,["displayName"],o);const i=l(t,["customMetadata"]);if(e!==void 0&&i!=null){let a=i;Array.isArray(a)&&(a=a.map(u=>u)),d(e,["customMetadata"],a)}const s=l(t,["chunkingConfig"]);return e!==void 0&&s!=null&&d(e,["chunkingConfig"],s),n}function rS(t){const e={},n=l(t,["fileSearchStoreName"]);n!=null&&d(e,["_url","file_search_store_name"],n);const r=l(t,["config"]);return r!=null&&Jp(r,e),e}function oS(t){const e={},n=l(t,["sdkHttpResponse"]);return n!=null&&d(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const iS="Content-Type",sS="X-Server-Timeout",aS="User-Agent",sl="x-goog-api-client",lS="1.34.0",uS=`google-genai-sdk/${lS}`,cS="v1beta1",dS="v1beta";class fS{constructor(e){var n,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const o={};this.clientOptions.vertexai?(o.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:cS,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:dS,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){const o=[this.getRequestUrlInternal(n)];return r&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,r);if(e.queryParams)for(const[s,a]of Object.entries(e.queryParams))o.searchParams.append(s,String(a));let i={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,n,o.toString(),e.abortSignal),this.unaryApiCall(o,i,e.httpMethod)}patchHttpOptions(e,n){const r=JSON.parse(JSON.stringify(e));for(const[o,i]of Object.entries(n))typeof i=="object"?r[o]=Object.assign(Object.assign({},r[o]),i):i!==void 0&&(r[o]=i);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,r);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,n,o.toString(),e.abortSignal),this.streamApiCall(o,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r,o){if(n&&n.timeout||o){const i=new AbortController,s=i.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const a=setTimeout(()=>i.abort(),n.timeout);a&&typeof a.unref=="function"&&a.unref()}o&&o.addEventListener("abort",()=>{i.abort()}),e.signal=s}return n&&n.extraBody!==null&&hS(e,n.extraBody),e.headers=await this.getHeadersInternal(n,r),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async o=>(await Xd(o),new tl(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async o=>(await Xd(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){return Kt(this,arguments,function*(){var r;const o=(r=e==null?void 0:e.body)===null||r===void 0?void 0:r.getReader(),i=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let s="";const a="data:",u=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:c,value:h}=yield _e(o.read());if(c){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const p=i.decode(h,{stream:!0});try{const E=JSON.parse(p);if("error"in E){const v=JSON.parse(JSON.stringify(E.error)),w=v.status,y=v.code,x=`got status: ${w}. ${JSON.stringify(E)}`;if(y>=400&&y<600)throw new Ts({message:x,status:y})}}catch(E){if(E.name==="ApiError")throw E}s+=p;let m=-1,g=0;for(;;){m=-1,g=0;for(const w of u){const y=s.indexOf(w);y!==-1&&(m===-1||y<m)&&(m=y,g=w.length)}if(m===-1)break;const E=s.substring(0,m);s=s.substring(m+g);const v=E.trim();if(v.startsWith(a)){const w=v.substring(a.length).trim();try{const y=new Response(w,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield _e(new tl(y))}catch(y){throw new Error(`exception parsing stream chunk ${w}. ${y}`)}}}}}finally{o.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const e={},n=uS+" "+this.clientOptions.userAgentExtra;return e[aS]=n,e[sl]=n,e[iS]="application/json",e}async getHeadersInternal(e,n){const r=new Headers;if(e&&e.headers){for(const[o,i]of Object.entries(e.headers))r.append(o,i);e.timeout&&e.timeout>0&&r.append(sS,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(e){var n;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(e,n){var r;const o={};n!=null&&(o.mimeType=n.mimeType,o.name=n.name,o.displayName=n.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);const i=this.clientOptions.uploader,s=await i.stat(e);o.sizeBytes=String(s.size);const a=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:s.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=a;const u={file:o},c=this.getFileName(e),h=ve("upload/v1beta/files",u._url),p=await this.fetchUploadUrl(h,o.sizeBytes,o.mimeType,c,u,n==null?void 0:n.httpOptions);return i.upload(e,p,this)}async uploadFileToFileSearchStore(e,n,r){var o;const i=this.clientOptions.uploader,s=await i.stat(n),a=String(s.size),u=(o=r==null?void 0:r.mimeType)!==null&&o!==void 0?o:s.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const c=`upload/v1beta/${e}:uploadToFileSearchStore`,h=this.getFileName(n),p={};r!=null&&Jp(r,p);const m=await this.fetchUploadUrl(c,a,u,h,p,r==null?void 0:r.httpOptions);return i.uploadToFileSearchStore(n,m,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,r,o,i,s){var a;let u={};s?u=s:u={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},o?{"X-Goog-Upload-File-Name":o}:{})};const c=await this.request({path:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:u});if(!c||!(c!=null&&c.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const h=(a=c==null?void 0:c.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}}async function Xd(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};const o=JSON.stringify(r);throw n>=400&&n<600?new Ts({message:o,status:n}):new Error(o)}}function hS(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const i=JSON.parse(t.body);if(typeof i=="object"&&i!==null&&!Array.isArray(i))n=i;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(i,s){const a=Object.assign({},i);for(const u in s)if(Object.prototype.hasOwnProperty.call(s,u)){const c=s[u],h=a[u];c&&typeof c=="object"&&!Array.isArray(c)&&h&&typeof h=="object"&&!Array.isArray(h)?a[u]=r(h,c):(h&&c&&typeof h!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${u}". Original type: ${typeof h}, New type: ${typeof c}. Overwriting.`),a[u]=c)}return a}const o=r(n,e);t.body=JSON.stringify(o)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pS="mcp_used/unknown";let mS=!1;function Xp(t){for(const e of t)if(gS(e)||typeof e=="object"&&"inputSchema"in e)return!0;return mS}function Zp(t){var e;const n=(e=t[sl])!==null&&e!==void 0?e:"";t[sl]=(n+` ${pS}`).trimStart()}function gS(t){return t!==null&&typeof t=="object"&&t instanceof gu}function yS(t){return Kt(this,arguments,function*(n,r=100){let o,i=0;for(;i<r;){const s=yield _e(n.listTools({cursor:o}));for(const a of s.tools)yield yield _e(a),i++;if(!s.nextCursor)break;o=s.nextCursor}})}class gu{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new gu(e,n)}async initialize(){var e,n,r,o;if(this.mcpTools.length>0)return;const i={},s=[];for(const h of this.mcpClients)try{for(var a=!0,u=(n=void 0,Jt(yS(h))),c;c=await u.next(),e=c.done,!e;a=!0){o=c.value,a=!1;const p=o;s.push(p);const m=p.name;if(i[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);i[m]=h}}catch(p){n={error:p}}finally{try{!a&&!e&&(r=u.return)&&await r.call(u)}finally{if(n)throw n.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),Ky(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const o=this.functionNameToMcpClient[r.name];let i;this.config.timeout&&(i={timeout:this.config.timeout});const s=await o.callTool({name:r.name,arguments:r.args},void 0,i);n.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function vS(t,e,n){const r=new By;let o;n.data instanceof Blob?o=JSON.parse(await n.data.text()):o=JSON.parse(n.data),Object.assign(r,o),e(r)}class xS{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const o=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),s=SS(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),u=`${o}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${a}`;let c=()=>{};const h=new Promise(T=>{c=T}),p=e.callbacks,m=function(){c({})},g=this.apiClient,E={onopen:m,onmessage:T=>{vS(g,p.onmessage,T)},onerror:(n=p==null?void 0:p.onerror)!==null&&n!==void 0?n:function(T){},onclose:(r=p==null?void 0:p.onclose)!==null&&r!==void 0?r:function(T){}},v=this.webSocketFactory.create(u,TS(s),E);v.connect(),await h;const x={setup:{model:Ge(this.apiClient,e.model)}};return v.send(JSON.stringify(x)),new ES(v,this.apiClient)}}class ES{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=Wx(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=$x(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(Ir.PLAY)}pause(){this.sendPlaybackControl(Ir.PAUSE)}stop(){this.sendPlaybackControl(Ir.STOP)}resetContext(){this.sendPlaybackControl(Ir.RESET_CONTEXT)}close(){this.conn.close()}}function TS(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function SS(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const wS="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function CS(t,e,n){const r=new Hy;let o;n.data instanceof Blob?o=await n.data.text():n.data instanceof ArrayBuffer?o=new TextDecoder().decode(n.data):o=n.data;const i=JSON.parse(o);if(t.isVertexAI()){const s=Kx(i);Object.assign(r,s)}else Object.assign(r,i);e(r)}class IS{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new xS(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,o,i,s,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const u=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let h;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&Xp(e.config.tools)&&Zp(p);const m=AS(p);if(this.apiClient.isVertexAI())h=`${u}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m,h);else{const D=this.apiClient.getApiKey();let q="BidiGenerateContent",ae="key";D!=null&&D.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),q="BidiGenerateContentConstrained",ae="access_token"),h=`${u}/ws/google.ai.generativelanguage.${c}.GenerativeService.${q}?${ae}=${D}`}let g=()=>{};const E=new Promise(D=>{g=D}),v=e.callbacks,w=function(){var D;(D=v==null?void 0:v.onopen)===null||D===void 0||D.call(v),g({})},y=this.apiClient,x={onopen:w,onmessage:D=>{CS(y,v.onmessage,D)},onerror:(n=v==null?void 0:v.onerror)!==null&&n!==void 0?n:function(D){},onclose:(r=v==null?void 0:v.onclose)!==null&&r!==void 0?r:function(D){}},T=this.webSocketFactory.create(h,bS(m),x);T.connect(),await E;let I=Ge(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&I.startsWith("publishers/")){const D=this.apiClient.getProject(),q=this.apiClient.getLocation();I=`projects/${D}/locations/${q}/`+I}let _={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Zi.AUDIO]}:e.config.responseModalities=[Zi.AUDIO]),!((i=e.config)===null||i===void 0)&&i.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const R=(a=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&a!==void 0?a:[],k=[];for(const D of R)if(this.isCallableTool(D)){const q=D;k.push(await q.tool())}else k.push(D);k.length>0&&(e.config.tools=k);const j={model:I,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?_=jx(this.apiClient,j):_=zx(this.apiClient,j),delete _.config,T.send(JSON.stringify(_)),new _S(T,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const NS={turnComplete:!0};class _S{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=Gt(n.turns),e.isVertexAI()||(r=r.map(o=>Ss(o)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const i of r){if(typeof i!="object"||i===null||!("name"in i)||!("response"in i))throw new Error(`Could not parse function response, type '${typeof i}'.`);if(!e.isVertexAI()&&!("id"in i))throw new Error(wS)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},NS),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:Yx(e)}:n={realtimeInput:qx(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function bS(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function AS(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Zd=10;function Qd(t){var e,n,r;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(const s of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(Lr(s)){o=!0;break}if(!o)return!0;const i=(r=t==null?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return i&&(i<0||!Number.isInteger(i))||i==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",i),!0):!1}function Lr(t){return"callTool"in t&&typeof t.callTool=="function"}function RS(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(o=>Lr(o)))!==null&&r!==void 0?r:!1}function ef(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((r,o)=>{if(Lr(r))return;const i=r;i.functionDeclarations&&i.functionDeclarations.length>0&&n.push(o)}),n}function tf(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class kS extends xn{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var r,o,i,s,a;const u=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!RS(n)||Qd(n.config))return await this.generateContentInternal(u);const c=ef(n);if(c.length>0){const v=c.map(w=>`tools[${w}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${v}.`)}let h,p;const m=Gt(u.contents),g=(i=(o=(r=u.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&i!==void 0?i:Zd;let E=0;for(;E<g&&(h=await this.generateContentInternal(u),!(!h.functionCalls||h.functionCalls.length===0));){const v=h.candidates[0].content,w=[];for(const y of(a=(s=n.config)===null||s===void 0?void 0:s.tools)!==null&&a!==void 0?a:[])if(Lr(y)){const T=await y.callTool(h.functionCalls);w.push(...T)}E++,p={role:"user",parts:w},u.contents=Gt(u.contents),u.contents.push(v),u.contents.push(p),tf(u.config)&&(m.push(v),m.push(p))}return tf(u.config)&&(h.automaticFunctionCallingHistory=m),h},this.generateContentStream=async n=>{var r,o,i,s,a;if(this.maybeMoveToResponseJsonSchem(n),Qd(n.config)){const p=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(p)}const u=ef(n);if(u.length>0){const p=u.map(m=>`tools[${m}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const c=(i=(o=(r=n==null?void 0:n.config)===null||r===void 0?void 0:r.toolConfig)===null||o===void 0?void 0:o.functionCallingConfig)===null||i===void 0?void 0:i.streamFunctionCallArguments,h=(a=(s=n==null?void 0:n.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(c&&!h)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var o;let i;const s=[];if(r!=null&&r.generatedImages)for(const u of r.generatedImages)u&&(u!=null&&u.safetyAttributes)&&((o=u==null?void 0:u.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?i=u==null?void 0:u.safetyAttributes:s.push(u);let a;return i?a={generatedImages:s,positivePromptSafetyAttributes:i,sdkHttpResponse:r.sdkHttpResponse}:a={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},a}),this.list=async n=>{var r;const s={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new ar(yn.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(s),s)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const o={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(o)},this.generateVideos=async n=>{var r,o,i,s,a,u;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((o=n.video)===null||o===void 0)&&o.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((s=(i=n.source)===null||i===void 0?void 0:i.video)===null||s===void 0)&&s.uri&&(!((u=(a=n.source)===null||a===void 0?void 0:a.video)===null||u===void 0)&&u.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,o;const i=(n=e.config)===null||n===void 0?void 0:n.tools;if(!i)return e;const s=await Promise.all(i.map(async u=>Lr(u)?await u.tool():u)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(a.config.tools=s,e.config&&e.config.tools&&Xp(e.config.tools)){const u=(o=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&o!==void 0?o:{};let c=Object.assign({},u);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),Zp(c),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return a}async initAfcToolsMap(e){var n,r,o;const i=new Map;for(const s of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(Lr(s)){const a=s,u=await a.tool();for(const c of(o=u.functionDeclarations)!==null&&o!==void 0?o:[]){if(!c.name)throw new Error("Function declaration name is required.");if(i.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);i.set(c.name,a)}}return i}async processAfcStream(e){var n,r,o;const i=(o=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&o!==void 0?o:Zd;let s=!1,a=0;const u=await this.initAfcToolsMap(e);return function(c,h,p){return Kt(this,arguments,function*(){for(var m,g,E,v,w,y;a<i;){s&&(a++,s=!1);const _=yield _e(c.processParamsMaybeAddMcpUsage(p)),R=yield _e(c.generateContentStreamInternal(_)),k=[],j=[];try{for(var x=!0,T=(g=void 0,Jt(R)),I;I=yield _e(T.next()),m=I.done,!m;x=!0){v=I.value,x=!1;const D=v;if(yield yield _e(D),D.candidates&&(!((w=D.candidates[0])===null||w===void 0)&&w.content)){j.push(D.candidates[0].content);for(const q of(y=D.candidates[0].content.parts)!==null&&y!==void 0?y:[])if(a<i&&q.functionCall){if(!q.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(q.functionCall.name)){const ae=yield _e(h.get(q.functionCall.name).callTool([q.functionCall]));k.push(...ae)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${q.functionCall.name}`)}}}}catch(D){g={error:D}}finally{try{!x&&!m&&(E=T.return)&&(yield _e(E.call(T)))}finally{if(g)throw g.error}}if(k.length>0){s=!0;const D=new ro;D.candidates=[{content:{role:"user",parts:k}}],yield yield _e(D);const q=[];q.push(...j),q.push({role:"user",parts:k});const ae=Gt(p.contents).concat(q);p.contents=ae}else break}})}(this,u,e)}async generateContentInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=Yd(this.apiClient,e);return a=ve("{model}:generateContent",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=Jd(h),m=new ro;return Object.assign(m,p),m})}else{const c=qd(this.apiClient,e);return a=ve("{model}:generateContent",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=Kd(h),m=new ro;return Object.assign(m,p),m})}}async generateContentStreamInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=Yd(this.apiClient,e);return a=ve("{model}:streamGenerateContent?alt=sse",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.requestStream({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(p){return Kt(this,arguments,function*(){var m,g,E,v;try{for(var w=!0,y=Jt(p),x;x=yield _e(y.next()),m=x.done,!m;w=!0){v=x.value,w=!1;const T=v,I=Jd(yield _e(T.json()));I.sdkHttpResponse={headers:T.headers};const _=new ro;Object.assign(_,I),yield yield _e(_)}}catch(T){g={error:T}}finally{try{!w&&!m&&(E=y.return)&&(yield _e(E.call(y)))}finally{if(g)throw g.error}}})})}else{const c=qd(this.apiClient,e);return a=ve("{model}:streamGenerateContent?alt=sse",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.requestStream({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(p){return Kt(this,arguments,function*(){var m,g,E,v;try{for(var w=!0,y=Jt(p),x;x=yield _e(y.next()),m=x.done,!m;w=!0){v=x.value,w=!1;const T=v,I=Kd(yield _e(T.json()));I.sdkHttpResponse={headers:T.headers};const _=new ro;Object.assign(_,I),yield yield _e(_)}}catch(T){g={error:T}}finally{try{!w&&!m&&(E=y.return)&&(yield _e(E.call(y)))}finally{if(g)throw g.error}}})})}}async embedContent(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=IE(this.apiClient,e);return a=ve("{model}:predict",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=_E(h),m=new Rd;return Object.assign(m,p),m})}else{const c=CE(this.apiClient,e);return a=ve("{model}:batchEmbedContents",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=NE(h),m=new Rd;return Object.assign(m,p),m})}}async generateImagesInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=FE(this.apiClient,e);return a=ve("{model}:predict",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=HE(h),m=new kd;return Object.assign(m,p),m})}else{const c=UE(this.apiClient,e);return a=ve("{model}:predict",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=GE(h),m=new kd;return Object.assign(m,p),m})}}async editImageInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=EE(this.apiClient,e);return i=ve("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(c=>{const h=c;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>{const c=TE(u),h=new Ay;return Object.assign(h,c),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=FT(this.apiClient,e);return i=ve("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(c=>{const h=c;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>{const c=GT(u),h=new Ry;return Object.assign(h,c),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=xT(this.apiClient,e);return i=ve("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const c=ET(u),h=new ky;return Object.assign(h,c),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=NT(this.apiClient,e);return i=ve("{model}:predict",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const c=_T(u),h=new Py;return Object.assign(h,c),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=rT(this.apiClient,e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>il(h))}else{const c=nT(this.apiClient,e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>ol(h))}}async listInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=fT(this.apiClient,e);return a=ve("{models_url}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=pT(h),m=new Pd;return Object.assign(m,p),m})}else{const c=dT(this.apiClient,e);return a=ve("{models_url}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=hT(h),m=new Pd;return Object.assign(m,p),m})}}async update(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=DT(this.apiClient,e);return a=ve("{model}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>il(h))}else{const c=OT(this.apiClient,e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>ol(h))}}async delete(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=gE(this.apiClient,e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=vE(h),m=new Md;return Object.assign(m,p),m})}else{const c=mE(this.apiClient,e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=yE(h),m=new Md;return Object.assign(m,p),m})}}async countTokens(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=fE(this.apiClient,e);return a=ve("{model}:countTokens",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=pE(h),m=new Ld;return Object.assign(m,p),m})}else{const c=dE(this.apiClient,e);return a=ve("{model}:countTokens",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=hE(h),m=new Ld;return Object.assign(m,p),m})}}async computeTokens(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=oE(this.apiClient,e);return i=ve("{model}:computeTokens",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(c=>{const h=c;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>{const c=iE(u),h=new My;return Object.assign(h,c),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=WE(this.apiClient,e);return a=ve("{model}:predictLongRunning",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>{const p=jE(h),m=new Qi;return Object.assign(m,p),m})}else{const c=$E(this.apiClient,e);return a=ve("{model}:predictLongRunning",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const p=zE(h),m=new Qi;return Object.assign(m,p),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class PS extends xn{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=n.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async get(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=n.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=wy(e);return a=ve("{operationName}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s}else{const c=Sy(e);return a=ve("{operationName}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s}}async fetchPredictVideosOperationInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=my(e);return i=ve("{resourceName}:fetchPredictOperation",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function MS(t){const e={},n=l(t,["data"]);if(n!=null&&d(e,["data"],n),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function LS(t){const e={},n=l(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(i=>zS(i))),d(e,["parts"],o)}const r=l(t,["role"]);return r!=null&&d(e,["role"],r),e}function OS(t,e,n){const r={},o=l(e,["expireTime"]);n!==void 0&&o!=null&&d(n,["expireTime"],o);const i=l(e,["newSessionExpireTime"]);n!==void 0&&i!=null&&d(n,["newSessionExpireTime"],i);const s=l(e,["uses"]);n!==void 0&&s!=null&&d(n,["uses"],s);const a=l(e,["liveConnectConstraints"]);n!==void 0&&a!=null&&d(n,["bidiGenerateContentSetup"],VS(t,a));const u=l(e,["lockAdditionalFields"]);return n!==void 0&&u!=null&&d(n,["fieldMask"],u),r}function DS(t,e){const n={},r=l(e,["config"]);return r!=null&&d(n,["config"],OS(t,r,n)),n}function US(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=l(t,["fileUri"]);n!=null&&d(e,["fileUri"],n);const r=l(t,["mimeType"]);return r!=null&&d(e,["mimeType"],r),e}function FS(t){const e={},n=l(t,["id"]);n!=null&&d(e,["id"],n);const r=l(t,["args"]);r!=null&&d(e,["args"],r);const o=l(t,["name"]);if(o!=null&&d(e,["name"],o),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function GS(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=l(t,["enableWidget"]);return n!=null&&d(e,["enableWidget"],n),e}function HS(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=l(t,["timeRangeFilter"]);return n!=null&&d(e,["timeRangeFilter"],n),e}function BS(t,e){const n={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&d(e,["setup","generationConfig"],r);const o=l(t,["responseModalities"]);e!==void 0&&o!=null&&d(e,["setup","generationConfig","responseModalities"],o);const i=l(t,["temperature"]);e!==void 0&&i!=null&&d(e,["setup","generationConfig","temperature"],i);const s=l(t,["topP"]);e!==void 0&&s!=null&&d(e,["setup","generationConfig","topP"],s);const a=l(t,["topK"]);e!==void 0&&a!=null&&d(e,["setup","generationConfig","topK"],a);const u=l(t,["maxOutputTokens"]);e!==void 0&&u!=null&&d(e,["setup","generationConfig","maxOutputTokens"],u);const c=l(t,["mediaResolution"]);e!==void 0&&c!=null&&d(e,["setup","generationConfig","mediaResolution"],c);const h=l(t,["seed"]);e!==void 0&&h!=null&&d(e,["setup","generationConfig","seed"],h);const p=l(t,["speechConfig"]);e!==void 0&&p!=null&&d(e,["setup","generationConfig","speechConfig"],mu(p));const m=l(t,["thinkingConfig"]);e!==void 0&&m!=null&&d(e,["setup","generationConfig","thinkingConfig"],m);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&d(e,["setup","generationConfig","enableAffectiveDialog"],g);const E=l(t,["systemInstruction"]);e!==void 0&&E!=null&&d(e,["setup","systemInstruction"],LS(gt(E)));const v=l(t,["tools"]);if(e!==void 0&&v!=null){let R=qr(v);Array.isArray(R)&&(R=R.map(k=>$S(Wr(k)))),d(e,["setup","tools"],R)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&d(e,["setup","sessionResumption"],jS(w));const y=l(t,["inputAudioTranscription"]);e!==void 0&&y!=null&&d(e,["setup","inputAudioTranscription"],y);const x=l(t,["outputAudioTranscription"]);e!==void 0&&x!=null&&d(e,["setup","outputAudioTranscription"],x);const T=l(t,["realtimeInputConfig"]);e!==void 0&&T!=null&&d(e,["setup","realtimeInputConfig"],T);const I=l(t,["contextWindowCompression"]);e!==void 0&&I!=null&&d(e,["setup","contextWindowCompression"],I);const _=l(t,["proactivity"]);if(e!==void 0&&_!=null&&d(e,["setup","proactivity"],_),l(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function VS(t,e){const n={},r=l(e,["model"]);r!=null&&d(n,["setup","model"],Ge(t,r));const o=l(e,["config"]);return o!=null&&d(n,["config"],BS(o,n)),n}function zS(t){const e={},n=l(t,["mediaResolution"]);n!=null&&d(e,["mediaResolution"],n);const r=l(t,["codeExecutionResult"]);r!=null&&d(e,["codeExecutionResult"],r);const o=l(t,["executableCode"]);o!=null&&d(e,["executableCode"],o);const i=l(t,["fileData"]);i!=null&&d(e,["fileData"],US(i));const s=l(t,["functionCall"]);s!=null&&d(e,["functionCall"],FS(s));const a=l(t,["functionResponse"]);a!=null&&d(e,["functionResponse"],a);const u=l(t,["inlineData"]);u!=null&&d(e,["inlineData"],MS(u));const c=l(t,["text"]);c!=null&&d(e,["text"],c);const h=l(t,["thought"]);h!=null&&d(e,["thought"],h);const p=l(t,["thoughtSignature"]);p!=null&&d(e,["thoughtSignature"],p);const m=l(t,["videoMetadata"]);return m!=null&&d(e,["videoMetadata"],m),e}function jS(t){const e={},n=l(t,["handle"]);if(n!=null&&d(e,["handle"],n),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function $S(t){const e={},n=l(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(p=>p)),d(e,["functionDeclarations"],h)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&d(e,["googleSearchRetrieval"],r);const o=l(t,["computerUse"]);o!=null&&d(e,["computerUse"],o);const i=l(t,["fileSearch"]);i!=null&&d(e,["fileSearch"],i);const s=l(t,["codeExecution"]);if(s!=null&&d(e,["codeExecution"],s),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=l(t,["googleMaps"]);a!=null&&d(e,["googleMaps"],GS(a));const u=l(t,["googleSearch"]);u!=null&&d(e,["googleSearch"],HS(u));const c=l(t,["urlContext"]);return c!=null&&d(e,["urlContext"],c),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function WS(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const o=Object.keys(r).map(i=>`${n}.${i}`);e.push(...o)}else e.push(n)}return e.join(",")}function qS(t,e){let n=null;const r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const i=r.setup;typeof i=="object"&&i!==null?(t.bidiGenerateContentSetup=i,n=i):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;const o=t.fieldMask;if(n){const i=WS(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)i?t.fieldMask=i:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let a=[];o.length>0&&(a=o.map(c=>s.includes(c)?`generationConfig.${c}`:c));const u=[];i&&u.push(i),a.length>0&&u.push(...a),u.length>0?t.fieldMask=u.join(","):delete t.fieldMask}else delete t.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?t.fieldMask=o.join(","):delete t.fieldMask;return t}class YS extends xn{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const a=DS(this.apiClient,e);i=ve("auth_tokens",a._url),s=a._query,delete a.config,delete a._url,delete a._query;const u=qS(a,e.config);return o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),o.then(c=>c)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function KS(t,e){const n={},r=l(t,["force"]);return e!==void 0&&r!=null&&d(e,["_query","force"],r),n}function JS(t){const e={},n=l(t,["name"]);n!=null&&d(e,["_url","name"],n);const r=l(t,["config"]);return r!=null&&KS(r,e),e}function XS(t){const e={},n=l(t,["name"]);return n!=null&&d(e,["_url","name"],n),e}function ZS(t,e){const n={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&d(e,["_query","pageSize"],r);const o=l(t,["pageToken"]);return e!==void 0&&o!=null&&d(e,["_query","pageToken"],o),n}function QS(t){const e={},n=l(t,["parent"]);n!=null&&d(e,["_url","parent"],n);const r=l(t,["config"]);return r!=null&&ZS(r,e),e}function ew(t){const e={},n=l(t,["sdkHttpResponse"]);n!=null&&d(e,["sdkHttpResponse"],n);const r=l(t,["nextPageToken"]);r!=null&&d(e,["nextPageToken"],r);const o=l(t,["documents"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(s=>s)),d(e,["documents"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tw extends xn{constructor(e){super(),this.apiClient=e,this.list=async n=>new ar(yn.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=XS(e);return i=ve("{name}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>u)}}async delete(e){var n,r;let o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=JS(e);o=ve("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=QS(e);return i=ve("{parent}/documents",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const c=ew(u),h=new Ly;return Object.assign(h,c),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nw extends xn{constructor(e,n=new tw(e)){super(),this.apiClient=e,this.documents=n,this.list=async(r={})=>new ar(yn.PAGED_ITEM_FILE_SEARCH_STORES,o=>this.listInternal(o),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=WT(e);return i=ve("fileSearchStores",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>u)}}async get(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=KT(e);return i=ve("{name}",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>u)}}async delete(e){var n,r;let o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=YT(e);o=ve("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=tS(e);return i=ve("fileSearchStores",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const c=nS(u),h=new Oy;return Object.assign(h,c),h})}}async uploadToFileSearchStoreInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=rS(e);return i=ve("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const c=oS(u),h=new Dy;return Object.assign(h,c),h})}}async importFile(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=ZT(e);return i=ve("{file_search_store_name}:importFile",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const c=XT(u),h=new cu;return Object.assign(h,c),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Qp=function(){const{crypto:t}=globalThis;if(t!=null&&t.randomUUID)return Qp=t.randomUUID.bind(t),t.randomUUID();const e=new Uint8Array(1),n=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))};const rw=()=>Qp();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function al(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}const ll=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){const e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Vt extends Error{}class Tt extends Vt{constructor(e,n,r,o){super(`${Tt.makeMessage(e,n,r)}`),this.status=e,this.headers=o,this.error=n}static makeMessage(e,n,r){const o=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,n,r,o){if(!e||!o)return new Is({message:r,cause:ll(n)});const i=n;return e===400?new tm(e,i,r,o):e===401?new nm(e,i,r,o):e===403?new rm(e,i,r,o):e===404?new om(e,i,r,o):e===409?new im(e,i,r,o):e===422?new sm(e,i,r,o):e===429?new am(e,i,r,o):e>=500?new lm(e,i,r,o):new Tt(e,i,r,o)}}class ul extends Tt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Is extends Tt{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class em extends Is{constructor({message:e}={}){super({message:e??"Request timed out."})}}class tm extends Tt{}class nm extends Tt{}class rm extends Tt{}class om extends Tt{}class im extends Tt{}class sm extends Tt{}class am extends Tt{}class lm extends Tt{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ow=/^[a-z][a-z0-9+.-]*:/i,iw=t=>ow.test(t);let cl=t=>(cl=Array.isArray,cl(t));const sw=cl;let aw=sw;const nf=aw;function lw(t){if(!t)return!0;for(const e in t)return!1;return!0}function uw(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const cw=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Vt(`${t} must be an integer`);if(e<0)throw new Vt(`${t} must be a positive integer`);return e},dw=t=>{try{return JSON.parse(t)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fw=t=>new Promise(e=>setTimeout(e,t));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const dr="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hw(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const pw=()=>{var t,e,n,r,o;const i=hw();if(i==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":dr,"X-Stainless-OS":of(Deno.build.os),"X-Stainless-Arch":rf(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(t=Deno.version)===null||t===void 0?void 0:t.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":dr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(i==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":dr,"X-Stainless-OS":of((n=globalThis.process.platform)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Arch":rf((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(o=globalThis.process.version)!==null&&o!==void 0?o:"unknown"};const s=mw();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":dr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":dr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function mw(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const o=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:e,version:`${o}.${i}.${s}`}}}return null}const rf=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",of=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let si;const gw=()=>si??(si=pw());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function yw(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function um(...t){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function vw(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return um({start(){},async pull(n){const{done:r,value:o}=await e.next();r?n.close():n.enqueue(o)},async cancel(){var n;await((n=e.return)===null||n===void 0?void 0:n.call(e))}})}function cm(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function xw(t){var e,n;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((n=(e=t[Symbol.asyncIterator]()).return)===null||n===void 0?void 0:n.call(e));return}const r=t.getReader(),o=r.cancel();r.releaseLock(),await o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ew=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const dm=()=>{var t;if(typeof File>"u"){const{process:e}=globalThis,n=typeof((t=e==null?void 0:e.versions)===null||t===void 0?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function na(t,e,n){return dm(),new File(t,e??"unknown_file",n)}function Tw(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}const Sw=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const fm=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",ww=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&fm(t),Cw=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function Iw(t,e,n){if(dm(),t=await t,ww(t))return t instanceof File?t:na([await t.arrayBuffer()],t.name);if(Cw(t)){const o=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),na(await dl(o),e,n)}const r=await dl(t);if(e||(e=Tw(t)),!(n!=null&&n.type)){const o=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof o=="string"&&(n=Object.assign(Object.assign({},n),{type:o}))}return na(r,e,n)}async function dl(t){var e,n,r,o,i;let s=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)s.push(t);else if(fm(t))s.push(t instanceof Blob?t:await t.arrayBuffer());else if(Sw(t))try{for(var a=!0,u=Jt(t),c;c=await u.next(),e=c.done,!e;a=!0){o=c.value,a=!1;const h=o;s.push(...await dl(h))}}catch(h){n={error:h}}finally{try{!a&&!e&&(r=u.return)&&await r.call(u)}finally{if(n)throw n.error}}else{const h=(i=t==null?void 0:t.constructor)===null||i===void 0?void 0:i.name;throw new Error(`Unexpected data type: ${typeof t}${h?`; constructor: ${h}`:""}${Nw(t)}`)}return s}function Nw(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class hm{constructor(e){this._client=e}}hm._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pm(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const sf=Object.freeze(Object.create(null)),_w=(t=pm)=>function(n,...r){if(n.length===1)return n[0];let o=!1;const i=[],s=n.reduce((h,p,m)=>{var g,E,v;/[?#]/.test(p)&&(o=!0);const w=r[m];let y=(o?encodeURIComponent:t)(""+w);return m!==r.length&&(w==null||typeof w=="object"&&w.toString===((v=Object.getPrototypeOf((E=Object.getPrototypeOf((g=w.hasOwnProperty)!==null&&g!==void 0?g:sf))!==null&&E!==void 0?E:sf))===null||v===void 0?void 0:v.toString))&&(y=w+"",i.push({start:h.length+p.length,length:y.length,error:`Value of type ${Object.prototype.toString.call(w).slice(8,-1)} is not a valid path parameter`})),h+p+(m===r.length?"":y)},""),a=s.split(/[?#]/,1)[0],u=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=u.exec(a))!==null;)i.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(i.sort((h,p)=>h.start-p.start),i.length>0){let h=0;const p=i.reduce((m,g)=>{const E=" ".repeat(g.start-h),v="^".repeat(g.length);return h=g.start+g.length,m+E+v},"");throw new Vt(`Path parameters result in path with invalid segments:
${i.map(m=>m.error).join(`
`)}
${s}
${p}`)}return s},ai=_w(pm);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mm extends hm{create(e,n){var r;const{api_version:o=this._client.apiVersion}=e,i=ts(e,["api_version"]);if("model"in i&&"agent_config"in i)throw new Vt("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new Vt("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(ai`/${o}/interactions`,Object.assign(Object.assign({body:i},n),{stream:(r=e.stream)!==null&&r!==void 0?r:!1}))}delete(e,n={},r){const{api_version:o=this._client.apiVersion}=n??{};return this._client.delete(ai`/${o}/interactions/${e}`,r)}cancel(e,n={},r){const{api_version:o=this._client.apiVersion}=n??{};return this._client.post(ai`/${o}/interactions/${e}/cancel`,r)}get(e,n={},r){var o;const i=n??{},{api_version:s=this._client.apiVersion}=i,a=ts(i,["api_version"]);return this._client.get(ai`/${s}/interactions/${e}`,Object.assign(Object.assign({query:a},r),{stream:(o=n==null?void 0:n.stream)!==null&&o!==void 0?o:!1}))}}mm._key=Object.freeze(["interactions"]);class gm extends mm{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function bw(t){let e=0;for(const o of t)e+=o.length;const n=new Uint8Array(e);let r=0;for(const o of t)n.set(o,r),r+=o.length;return n}let li;function yu(t){let e;return(li??(e=new globalThis.TextEncoder,li=e.encode.bind(e)))(t)}let ui;function af(t){let e;return(ui??(e=new globalThis.TextDecoder,ui=e.decode.bind(e)))(t)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ns{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?yu(e):e;this.buffer=bw([this.buffer,n]);const r=[];let o;for(;(o=Aw(this.buffer,this.carriageReturnIndex))!=null;){if(o.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=o.index;continue}if(this.carriageReturnIndex!=null&&(o.index!==this.carriageReturnIndex+1||o.carriage)){r.push(af(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const i=this.carriageReturnIndex!==null?o.preceding-1:o.preceding,s=af(this.buffer.subarray(0,i));r.push(s),this.buffer=this.buffer.subarray(o.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}}Ns.NEWLINE_CHARS=new Set([`
`,"\r"]);Ns.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Aw(t,e){for(let o=e??0;o<t.length;o++){if(t[o]===10)return{preceding:o,index:o+1,carriage:!1};if(t[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function Rw(t){for(let r=0;r<t.length-1;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ns={off:0,error:200,warn:300,info:400,debug:500},lf=(t,e,n)=>{if(t){if(uw(ns,t))return t;vt(n).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(ns))}`)}};function uo(){}function ci(t,e,n){return!e||ns[t]>ns[n]?uo:e[t].bind(e)}const kw={error:uo,warn:uo,info:uo,debug:uo};let uf=new WeakMap;function vt(t){var e;const n=t.logger,r=(e=t.logLevel)!==null&&e!==void 0?e:"off";if(!n)return kw;const o=uf.get(n);if(o&&o[0]===r)return o[1];const i={error:ci("error",n,r),warn:ci("warn",n,r),info:ci("info",n,r),debug:ci("debug",n,r)};return uf.set(n,[r,i]),i}const Yn=t=>(t.options&&(t.options=Object.assign({},t.options),delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,n])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Nr{constructor(e,n,r){this.iterator=e,this.controller=n,this.client=r}static fromSSEResponse(e,n,r){let o=!1;const i=r?vt(r):console;function s(){return Kt(this,arguments,function*(){var u,c,h,p;if(o)throw new Vt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let m=!1;try{try{for(var g=!0,E=Jt(Pw(e,n)),v;v=yield _e(E.next()),u=v.done,!u;g=!0){p=v.value,g=!1;const w=p;if(!m)if(w.data.startsWith("[DONE]")){m=!0;continue}else try{yield yield _e(JSON.parse(w.data))}catch(y){throw i.error("Could not parse message into JSON:",w.data),i.error("From chunk:",w.raw),y}}}catch(w){c={error:w}}finally{try{!g&&!u&&(h=E.return)&&(yield _e(h.call(E)))}finally{if(c)throw c.error}}m=!0}catch(w){if(al(w))return yield _e(void 0);throw w}finally{m||n.abort()}})}return new Nr(s,n,r)}static fromReadableStream(e,n,r){let o=!1;function i(){return Kt(this,arguments,function*(){var u,c,h,p;const m=new Ns,g=cm(e);try{for(var E=!0,v=Jt(g),w;w=yield _e(v.next()),u=w.done,!u;E=!0){p=w.value,E=!1;const y=p;for(const x of m.decode(y))yield yield _e(x)}}catch(y){c={error:y}}finally{try{!E&&!u&&(h=v.return)&&(yield _e(h.call(v)))}finally{if(c)throw c.error}}for(const y of m.flush())yield yield _e(y)})}function s(){return Kt(this,arguments,function*(){var u,c,h,p;if(o)throw new Vt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");o=!0;let m=!1;try{try{for(var g=!0,E=Jt(i()),v;v=yield _e(E.next()),u=v.done,!u;g=!0){p=v.value,g=!1;const w=p;m||w&&(yield yield _e(JSON.parse(w)))}}catch(w){c={error:w}}finally{try{!g&&!u&&(h=E.return)&&(yield _e(h.call(E)))}finally{if(c)throw c.error}}m=!0}catch(w){if(al(w))return yield _e(void 0);throw w}finally{m||n.abort()}})}return new Nr(s,n,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),o=i=>({next:()=>{if(i.length===0){const s=r.next();e.push(s),n.push(s)}return i.shift()}});return[new Nr(()=>o(e),this.controller,this.client),new Nr(()=>o(n),this.controller,this.client)]}toReadableStream(){const e=this;let n;return um({async start(){n=e[Symbol.asyncIterator]()},async pull(r){try{const{value:o,done:i}=await n.next();if(i)return r.close();const s=yu(JSON.stringify(o)+`
`);r.enqueue(s)}catch(o){r.error(o)}},async cancel(){var r;await((r=n.return)===null||r===void 0?void 0:r.call(n))}})}}function Pw(t,e){return Kt(this,arguments,function*(){var r,o,i,s;if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Vt("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Vt("Attempted to iterate over a response with no body");const a=new Lw,u=new Ns,c=cm(t.body);try{for(var h=!0,p=Jt(Mw(c)),m;m=yield _e(p.next()),r=m.done,!r;h=!0){s=m.value,h=!1;const g=s;for(const E of u.decode(g)){const v=a.decode(E);v&&(yield yield _e(v))}}}catch(g){o={error:g}}finally{try{!h&&!r&&(i=p.return)&&(yield _e(i.call(p)))}finally{if(o)throw o.error}}for(const g of u.flush()){const E=a.decode(g);E&&(yield yield _e(E))}})}function Mw(t){return Kt(this,arguments,function*(){var n,r,o,i;let s=new Uint8Array;try{for(var a=!0,u=Jt(t),c;c=yield _e(u.next()),n=c.done,!n;a=!0){i=c.value,a=!1;const h=i;if(h==null)continue;const p=h instanceof ArrayBuffer?new Uint8Array(h):typeof h=="string"?yu(h):h;let m=new Uint8Array(s.length+p.length);m.set(s),m.set(p,s.length),s=m;let g;for(;(g=Rw(s))!==-1;)yield yield _e(s.slice(0,g)),s=s.slice(g)}}catch(h){r={error:h}}finally{try{!a&&!n&&(o=u.return)&&(yield _e(o.call(u)))}finally{if(r)throw r.error}}s.length>0&&(yield yield _e(s))})}class Lw{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,o]=Ow(e,":");return o.startsWith(" ")&&(o=o.substring(1)),n==="event"?this.event=o:n==="data"&&this.data.push(o),null}}function Ow(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function Dw(t,e){const{response:n,requestLogID:r,retryOfRequestLogID:o,startTime:i}=e,s=await(async()=>{var a;if(e.options.stream)return vt(t).debug("response",n.status,n.url,n.headers,n.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(n,e.controller,t):Nr.fromSSEResponse(n,e.controller,t);if(n.status===204)return null;if(e.options.__binaryResponse)return n;const u=n.headers.get("content-type"),c=(a=u==null?void 0:u.split(";")[0])===null||a===void 0?void 0:a.trim();return(c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))?await n.json():await n.text()})();return vt(t).debug(`[${r}] response parsed`,Yn({retryOfRequestLogID:o,url:n.url,status:n.status,body:s,durationMs:Date.now()-i})),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vu extends Promise{constructor(e,n,r=Dw){super(o=>{o(null)}),this.responsePromise=n,this.parseResponse=r,this.client=e}_thenUnwrap(e){return new vu(this.client,this.responsePromise,async(n,r)=>e(await this.parseResponse(n,r),r))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ym=Symbol("brand.privateNullableHeaders");function*Uw(t){if(!t)return;if(ym in t){const{values:r,nulls:o}=t;yield*r.entries();for(const i of o)yield[i,null];return}let e=!1,n;t instanceof Headers?n=t.entries():nf(t)?n=t:(e=!0,n=Object.entries(t??{}));for(let r of n){const o=r[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");const i=nf(r[1])?r[1]:[r[1]];let s=!1;for(const a of i)a!==void 0&&(e&&!s&&(s=!0,yield[o,null]),yield[o,a])}}const oo=t=>{const e=new Headers,n=new Set;for(const r of t){const o=new Set;for(const[i,s]of Uw(r)){const a=i.toLowerCase();o.has(a)||(e.delete(i),o.add(a)),s===null?(e.delete(i),n.add(a)):(e.append(i,s),n.delete(a))}}return{[ym]:!0,values:e,nulls:n}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ra=t=>{var e,n,r,o,i,s;if(typeof globalThis.process<"u")return(r=(n=(e=uy)===null||e===void 0?void 0:e[t])===null||n===void 0?void 0:n.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(s=(i=(o=globalThis.Deno.env)===null||o===void 0?void 0:o.get)===null||i===void 0?void 0:i.call(o,t))===null||s===void 0?void 0:s.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var vm;class _s{constructor(e){var n,r,o,i,s,a,u,{baseURL:c=ra("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:h=(n=ra("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:p="v1beta"}=e,m=ts(e,["baseURL","apiKey","apiVersion"]);const g=Object.assign(Object.assign({apiKey:h,apiVersion:p},m),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=g.baseURL,this.timeout=(r=g.timeout)!==null&&r!==void 0?r:_s.DEFAULT_TIMEOUT,this.logger=(o=g.logger)!==null&&o!==void 0?o:console;const E="warn";this.logLevel=E,this.logLevel=(s=(i=lf(g.logLevel,"ClientOptions.logLevel",this))!==null&&i!==void 0?i:lf(ra("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&s!==void 0?s:E,this.fetchOptions=g.fetchOptions,this.maxRetries=(a=g.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(u=g.fetch)!==null&&u!==void 0?u:yw(),this.encoder=Ew,this._options=g,this.apiKey=h,this.apiVersion=p,this.clientAdapter=g.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:n}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const n=oo([e.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return oo([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return oo([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new Vt(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${dr}`}defaultIdempotencyKey(){return`stainless-node-retry-${rw()}`}makeStatusError(e,n,r,o){return Tt.generate(e,n,r,o)}buildURL(e,n,r){const o=!this.baseURLOverridden()&&r||this.baseURL,i=iw(e)?new URL(e):new URL(o+(o.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return lw(s)||(n=Object.assign(Object.assign({},s),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(i.search=this.stringifyQuery(n)),i.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const n=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(e,{url:n,options:r}){}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(o=>Object.assign({method:e,path:n},o)))}request(e,n=null){return new vu(this,this.makeRequest(e,n,void 0))}async makeRequest(e,n,r){var o,i,s;const a=await e,u=(o=a.maxRetries)!==null&&o!==void 0?o:this.maxRetries;n==null&&(n=u),await this.prepareOptions(a);const{req:c,url:h,timeout:p}=await this.buildRequest(a,{retryCount:u-n});await this.prepareRequest(c,{url:h,options:a});const m="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),g=r===void 0?"":`, retryOf: ${r}`,E=Date.now();if(vt(this).debug(`[${m}] sending request`,Yn({retryOfRequestLogID:r,method:a.method,url:h,options:a,headers:c.headers})),!((i=a.signal)===null||i===void 0)&&i.aborted)throw new ul;const v=new AbortController,w=await this.fetchWithTimeout(h,c,p,v).catch(ll),y=Date.now();if(w instanceof globalThis.Error){const T=`retrying, ${n} attempts remaining`;if(!((s=a.signal)===null||s===void 0)&&s.aborted)throw new ul;const I=al(w)||/timed? ?out/i.test(String(w)+("cause"in w?String(w.cause):""));if(n)return vt(this).info(`[${m}] connection ${I?"timed out":"failed"} - ${T}`),vt(this).debug(`[${m}] connection ${I?"timed out":"failed"} (${T})`,Yn({retryOfRequestLogID:r,url:h,durationMs:y-E,message:w.message})),this.retryRequest(a,n,r??m);throw vt(this).info(`[${m}] connection ${I?"timed out":"failed"} - error; no more retries left`),vt(this).debug(`[${m}] connection ${I?"timed out":"failed"} (error; no more retries left)`,Yn({retryOfRequestLogID:r,url:h,durationMs:y-E,message:w.message})),I?new em:new Is({cause:w})}const x=`[${m}${g}] ${c.method} ${h} ${w.ok?"succeeded":"failed"} with status ${w.status} in ${y-E}ms`;if(!w.ok){const T=await this.shouldRetry(w);if(n&&T){const D=`retrying, ${n} attempts remaining`;return await xw(w.body),vt(this).info(`${x} - ${D}`),vt(this).debug(`[${m}] response error (${D})`,Yn({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:y-E})),this.retryRequest(a,n,r??m,w.headers)}const I=T?"error; no more retries left":"error; not retryable";vt(this).info(`${x} - ${I}`);const _=await w.text().catch(D=>ll(D).message),R=dw(_),k=R?void 0:_;throw vt(this).debug(`[${m}] response error (${I})`,Yn({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,message:k,durationMs:Date.now()-E})),this.makeStatusError(w.status,R,k,w.headers)}return vt(this).info(x),vt(this).debug(`[${m}] response start`,Yn({retryOfRequestLogID:r,url:w.url,status:w.status,headers:w.headers,durationMs:y-E})),{response:w,options:a,controller:v,requestLogID:m,retryOfRequestLogID:r,startTime:E}}async fetchWithTimeout(e,n,r,o){const i=n||{},{signal:s,method:a}=i,u=ts(i,["signal","method"]);s&&s.addEventListener("abort",()=>o.abort());const c=setTimeout(()=>o.abort(),r),h=globalThis.ReadableStream&&u.body instanceof globalThis.ReadableStream||typeof u.body=="object"&&u.body!==null&&Symbol.asyncIterator in u.body,p=Object.assign(Object.assign(Object.assign({signal:o.signal},h?{duplex:"half"}:{}),{method:"GET"}),u);a&&(p.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,p)}finally{clearTimeout(c)}}async shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r,o){var i;let s;const a=o==null?void 0:o.get("retry-after-ms");if(a){const c=parseFloat(a);Number.isNaN(c)||(s=c)}const u=o==null?void 0:o.get("retry-after");if(u&&!s){const c=parseFloat(u);Number.isNaN(c)?s=Date.parse(u)-Date.now():s=c*1e3}if(!(s&&0<=s&&s<60*1e3)){const c=(i=e.maxRetries)!==null&&i!==void 0?i:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,c)}return await fw(s),this.makeRequest(e,n-1,r)}calculateDefaultRetryTimeoutMillis(e,n){const i=n-e,s=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return s*a*1e3}async buildRequest(e,{retryCount:n=0}={}){var r,o,i;const s=Object.assign({},e),{method:a,path:u,query:c,defaultBaseURL:h}=s,p=this.buildURL(u,c,h);"timeout"in s&&cw("timeout",s.timeout),s.timeout=(r=s.timeout)!==null&&r!==void 0?r:this.timeout;const{bodyHeaders:m,body:g}=this.buildBody({options:s}),E=await this.buildHeaders({options:e,method:a,bodyHeaders:m,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:E},s.signal&&{signal:s.signal}),globalThis.ReadableStream&&g instanceof globalThis.ReadableStream&&{duplex:"half"}),g&&{body:g}),(o=this.fetchOptions)!==null&&o!==void 0?o:{}),(i=s.fetchOptions)!==null&&i!==void 0?i:{}),url:p,timeout:s.timeout}}async buildHeaders({options:e,method:n,bodyHeaders:r,retryCount:o}){let i={};this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const s=await this.authHeaders(e);let a=oo([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(o)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),gw()),this._options.defaultHeaders,r,e.headers,s]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:n}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=oo([n]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:vw(e)}:this.encoder({body:e,headers:r})}}_s.DEFAULT_TIMEOUT=6e4;class lt extends _s{constructor(){super(...arguments),this.interactions=new gm(this)}}vm=lt;lt.GeminiNextGenAPIClient=vm;lt.GeminiNextGenAPIClientError=Vt;lt.APIError=Tt;lt.APIConnectionError=Is;lt.APIConnectionTimeoutError=em;lt.APIUserAbortError=ul;lt.NotFoundError=om;lt.ConflictError=im;lt.RateLimitError=am;lt.BadRequestError=tm;lt.AuthenticationError=nm;lt.InternalServerError=lm;lt.PermissionDeniedError=rm;lt.UnprocessableEntityError=sm;lt.toFile=Iw;lt.Interactions=gm;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Fw(t,e){const n={},r=l(t,["name"]);return r!=null&&d(n,["_url","name"],r),n}function Gw(t,e){const n={},r=l(t,["name"]);return r!=null&&d(n,["_url","name"],r),n}function Hw(t,e){const n={},r=l(t,["sdkHttpResponse"]);return r!=null&&d(n,["sdkHttpResponse"],r),n}function Bw(t,e){const n={},r=l(t,["sdkHttpResponse"]);return r!=null&&d(n,["sdkHttpResponse"],r),n}function Vw(t,e,n){const r={};if(l(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const o=l(t,["tunedModelDisplayName"]);if(e!==void 0&&o!=null&&d(e,["displayName"],o),l(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=l(t,["epochCount"]);e!==void 0&&i!=null&&d(e,["tuningTask","hyperparameters","epochCount"],i);const s=l(t,["learningRateMultiplier"]);if(s!=null&&d(r,["tuningTask","hyperparameters","learningRateMultiplier"],s),l(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(l(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(l(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const a=l(t,["batchSize"]);e!==void 0&&a!=null&&d(e,["tuningTask","hyperparameters","batchSize"],a);const u=l(t,["learningRate"]);if(e!==void 0&&u!=null&&d(e,["tuningTask","hyperparameters","learningRate"],u),l(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(l(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function zw(t,e,n){const r={};let o=l(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const g=l(t,["validationDataset"]);e!==void 0&&g!=null&&d(e,["supervisedTuningSpec"],cf(g))}else if(o==="PREFERENCE_TUNING"){const g=l(t,["validationDataset"]);e!==void 0&&g!=null&&d(e,["preferenceOptimizationSpec"],cf(g))}const i=l(t,["tunedModelDisplayName"]);e!==void 0&&i!=null&&d(e,["tunedModelDisplayName"],i);const s=l(t,["description"]);e!==void 0&&s!=null&&d(e,["description"],s);let a=l(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const g=l(t,["epochCount"]);e!==void 0&&g!=null&&d(e,["supervisedTuningSpec","hyperParameters","epochCount"],g)}else if(a==="PREFERENCE_TUNING"){const g=l(t,["epochCount"]);e!==void 0&&g!=null&&d(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],g)}let u=l(n,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const g=l(t,["learningRateMultiplier"]);e!==void 0&&g!=null&&d(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],g)}else if(u==="PREFERENCE_TUNING"){const g=l(t,["learningRateMultiplier"]);e!==void 0&&g!=null&&d(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],g)}let c=l(n,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const g=l(t,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&d(e,["supervisedTuningSpec","exportLastCheckpointOnly"],g)}else if(c==="PREFERENCE_TUNING"){const g=l(t,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&d(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],g)}let h=l(n,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const g=l(t,["adapterSize"]);e!==void 0&&g!=null&&d(e,["supervisedTuningSpec","hyperParameters","adapterSize"],g)}else if(h==="PREFERENCE_TUNING"){const g=l(t,["adapterSize"]);e!==void 0&&g!=null&&d(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],g)}if(l(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(l(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=l(t,["labels"]);e!==void 0&&p!=null&&d(e,["labels"],p);const m=l(t,["beta"]);return e!==void 0&&m!=null&&d(e,["preferenceOptimizationSpec","hyperParameters","beta"],m),r}function jw(t,e){const n={},r=l(t,["baseModel"]);r!=null&&d(n,["baseModel"],r);const o=l(t,["preTunedModel"]);o!=null&&d(n,["preTunedModel"],o);const i=l(t,["trainingDataset"]);i!=null&&tC(i);const s=l(t,["config"]);return s!=null&&Vw(s,n),n}function $w(t,e){const n={},r=l(t,["baseModel"]);r!=null&&d(n,["baseModel"],r);const o=l(t,["preTunedModel"]);o!=null&&d(n,["preTunedModel"],o);const i=l(t,["trainingDataset"]);i!=null&&nC(i,n,e);const s=l(t,["config"]);return s!=null&&zw(s,n,e),n}function Ww(t,e){const n={},r=l(t,["name"]);return r!=null&&d(n,["_url","name"],r),n}function qw(t,e){const n={},r=l(t,["name"]);return r!=null&&d(n,["_url","name"],r),n}function Yw(t,e,n){const r={},o=l(t,["pageSize"]);e!==void 0&&o!=null&&d(e,["_query","pageSize"],o);const i=l(t,["pageToken"]);e!==void 0&&i!=null&&d(e,["_query","pageToken"],i);const s=l(t,["filter"]);return e!==void 0&&s!=null&&d(e,["_query","filter"],s),r}function Kw(t,e,n){const r={},o=l(t,["pageSize"]);e!==void 0&&o!=null&&d(e,["_query","pageSize"],o);const i=l(t,["pageToken"]);e!==void 0&&i!=null&&d(e,["_query","pageToken"],i);const s=l(t,["filter"]);return e!==void 0&&s!=null&&d(e,["_query","filter"],s),r}function Jw(t,e){const n={},r=l(t,["config"]);return r!=null&&Yw(r,n),n}function Xw(t,e){const n={},r=l(t,["config"]);return r!=null&&Kw(r,n),n}function Zw(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);const o=l(t,["nextPageToken"]);o!=null&&d(n,["nextPageToken"],o);const i=l(t,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>xm(a))),d(n,["tuningJobs"],s)}return n}function Qw(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);const o=l(t,["nextPageToken"]);o!=null&&d(n,["nextPageToken"],o);const i=l(t,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(a=>fl(a))),d(n,["tuningJobs"],s)}return n}function eC(t,e){const n={},r=l(t,["name"]);r!=null&&d(n,["model"],r);const o=l(t,["name"]);return o!=null&&d(n,["endpoint"],o),n}function tC(t,e){const n={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=l(t,["examples"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),d(n,["examples","examples"],o)}return n}function nC(t,e,n){const r={};let o=l(n,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const s=l(t,["gcsUri"]);e!==void 0&&s!=null&&d(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(o==="PREFERENCE_TUNING"){const s=l(t,["gcsUri"]);e!==void 0&&s!=null&&d(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}let i=l(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const s=l(t,["vertexDatasetResource"]);e!==void 0&&s!=null&&d(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(i==="PREFERENCE_TUNING"){const s=l(t,["vertexDatasetResource"]);e!==void 0&&s!=null&&d(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}if(l(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function xm(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);const o=l(t,["name"]);o!=null&&d(n,["name"],o);const i=l(t,["state"]);i!=null&&d(n,["state"],Op(i));const s=l(t,["createTime"]);s!=null&&d(n,["createTime"],s);const a=l(t,["tuningTask","startTime"]);a!=null&&d(n,["startTime"],a);const u=l(t,["tuningTask","completeTime"]);u!=null&&d(n,["endTime"],u);const c=l(t,["updateTime"]);c!=null&&d(n,["updateTime"],c);const h=l(t,["description"]);h!=null&&d(n,["description"],h);const p=l(t,["baseModel"]);p!=null&&d(n,["baseModel"],p);const m=l(t,["_self"]);return m!=null&&d(n,["tunedModel"],eC(m)),n}function fl(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);const o=l(t,["name"]);o!=null&&d(n,["name"],o);const i=l(t,["state"]);i!=null&&d(n,["state"],Op(i));const s=l(t,["createTime"]);s!=null&&d(n,["createTime"],s);const a=l(t,["startTime"]);a!=null&&d(n,["startTime"],a);const u=l(t,["endTime"]);u!=null&&d(n,["endTime"],u);const c=l(t,["updateTime"]);c!=null&&d(n,["updateTime"],c);const h=l(t,["error"]);h!=null&&d(n,["error"],h);const p=l(t,["description"]);p!=null&&d(n,["description"],p);const m=l(t,["baseModel"]);m!=null&&d(n,["baseModel"],m);const g=l(t,["tunedModel"]);g!=null&&d(n,["tunedModel"],g);const E=l(t,["preTunedModel"]);E!=null&&d(n,["preTunedModel"],E);const v=l(t,["supervisedTuningSpec"]);v!=null&&d(n,["supervisedTuningSpec"],v);const w=l(t,["preferenceOptimizationSpec"]);w!=null&&d(n,["preferenceOptimizationSpec"],w);const y=l(t,["tuningDataStats"]);y!=null&&d(n,["tuningDataStats"],y);const x=l(t,["encryptionSpec"]);x!=null&&d(n,["encryptionSpec"],x);const T=l(t,["partnerModelTuningSpec"]);T!=null&&d(n,["partnerModelTuningSpec"],T);const I=l(t,["customBaseModel"]);I!=null&&d(n,["customBaseModel"],I);const _=l(t,["experiment"]);_!=null&&d(n,["experiment"],_);const R=l(t,["labels"]);R!=null&&d(n,["labels"],R);const k=l(t,["outputUri"]);k!=null&&d(n,["outputUri"],k);const j=l(t,["pipelineJob"]);j!=null&&d(n,["pipelineJob"],j);const D=l(t,["serviceAccount"]);D!=null&&d(n,["serviceAccount"],D);const q=l(t,["tunedModelDisplayName"]);q!=null&&d(n,["tunedModelDisplayName"],q);const ae=l(t,["veoTuningSpec"]);return ae!=null&&d(n,["veoTuningSpec"],ae),n}function rC(t,e){const n={},r=l(t,["sdkHttpResponse"]);r!=null&&d(n,["sdkHttpResponse"],r);const o=l(t,["name"]);o!=null&&d(n,["name"],o);const i=l(t,["metadata"]);i!=null&&d(n,["metadata"],i);const s=l(t,["done"]);s!=null&&d(n,["done"],s);const a=l(t,["error"]);return a!=null&&d(n,["error"],a),n}function cf(t,e){const n={},r=l(t,["gcsUri"]);r!=null&&d(n,["validationDatasetUri"],r);const o=l(t,["vertexDatasetResource"]);return o!=null&&d(n,["validationDatasetUri"],o),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class oC extends xn{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new ar(yn.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.get=async n=>await this.getInternal(n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const o={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(o.checkpointId=n.config.preTunedModelCheckpointId);const i=Object.assign(Object.assign({},n),{preTunedModel:o});return i.baseModel=void 0,await this.tuneInternal(i)}else{const o=Object.assign({},n);return await this.tuneInternal(o)}else{const o=Object.assign({},n),i=await this.tuneMldevInternal(o);let s="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?s=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(s=i.name.split("/operations/")[0]),{name:s,state:el.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=qw(e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>fl(h))}else{const c=Ww(e);return a=ve("{name}",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>xm(h))}}async listInternal(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=Xw(e);return a=ve("tuningJobs",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=Qw(h),m=new Od;return Object.assign(m,p),m})}else{const c=Jw(e);return a=ve("tunedModels",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=Zw(h),m=new Od;return Object.assign(m,p),m})}}async cancel(e){var n,r,o,i;let s,a="",u={};if(this.apiClient.isVertexAI()){const c=Gw(e);return a=ve("{name}:cancel",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=Bw(h),m=new Dd;return Object.assign(m,p),m})}else{const c=Fw(e);return a=ve("{name}:cancel",c._url),u=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const p=Hw(h),m=new Dd;return Object.assign(m,p),m})}}async tuneInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI()){const a=$w(e,e);return i=ve("tuningJobs",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(c=>{const h=c;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>fl(u))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let o,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=jw(e);return i=ve("tunedModels",a._url),s=a._query,delete a._url,delete a._query,o=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(c=>{const h=c;return h.sdkHttpResponse={headers:u.headers},h})),o.then(u=>rC(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class iC{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const sC=1024*1024*8,aC=3,lC=1e3,uC=2,rs="x-goog-upload-status";async function cC(t,e,n){var r;const o=await Em(t,e,n),i=await(o==null?void 0:o.json());if(((r=o==null?void 0:o.headers)===null||r===void 0?void 0:r[rs])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return i.file}async function dC(t,e,n){var r;const o=await Em(t,e,n),i=await(o==null?void 0:o.json());if(((r=o==null?void 0:o.headers)===null||r===void 0?void 0:r[rs])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const s=Ap(i),a=new du;return Object.assign(a,s),a}async function Em(t,e,n){var r,o;let i=0,s=0,a=new tl(new Response),u="upload";for(i=t.size;s<i;){const c=Math.min(sC,i-s),h=t.slice(s,s+c);s+c>=i&&(u+=", finalize");let p=0,m=lC;for(;p<aC&&(a=await n.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(s),"Content-Length":String(c)}}}),!(!((r=a==null?void 0:a.headers)===null||r===void 0)&&r[rs]));)p++,await hC(m),m=m*uC;if(s+=c,((o=a==null?void 0:a.headers)===null||o===void 0?void 0:o[rs])!=="active")break;if(i<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function fC(t){return{size:t.size,type:t.type}}function hC(t){return new Promise(e=>setTimeout(e,t))}class pC{async upload(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await cC(e,n,r)}async uploadToFileSearchStore(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await dC(e,n,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await fC(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mC{create(e,n,r){return new gC(e,n,r)}}class gC{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const df="x-goog-api-key";class yC{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(df)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(df,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vC="gl-node/";class xC{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const n=new lt({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=n.interactions,this._interactions}constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const r=hy(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const o=new yC(this.apiKey);this.apiClient=new fS({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:vC+"web",uploader:new pC,downloader:new iC}),this.models=new kS(this.apiClient),this.live=new IS(this.apiClient,o,new mC),this.batches=new Vv(this.apiClient),this.chats=new wx(this.models,this.apiClient),this.caches=new Ex(this.apiClient),this.files=new Mx(this.apiClient),this.operations=new PS(this.apiClient),this.authTokens=new YS(this.apiClient),this.tunings=new oC(this.apiClient),this.fileSearchStores=new nw(this.apiClient)}}const Vr={webtoon:{name:"  ",desc:"   +    ( )",prompt:"Premium Korean Historical Webtoon Style, High Quality 2D Digital Art, Crisp Line Art (Outlines), Cel Shading, Smooth Coloring, Beautiful Characters (Sparkling eyes, delicate features, pale skin, soft blush), Fusion Hanbok, Vibrant and Pastel tones, Webtoon Cover Art aesthetic, Sharp focus, No photorealism, Manhwa style"},animation:{name:"  ",desc:" ,  ",prompt:"2D cell animation style, Korean folklore atmosphere, flat shading, clean lines, Studio Ghibli inspired but Korean Joseon aesthetics"},inkwash:{name:"  (Modern)",desc:"   +   ",prompt:"Modern Korean emotional watercolor illustration, beautiful and handsome characters with modern aesthetic faces (sharp jawline, large expressive eyes, delicate features), soft transparent watercolor texture, ink spreading effect, dreamy and romantic atmosphere, detailed character design, NOT old traditional folk art style, NOT round ugly faces, pastel tones, artistic masterpiece"},fantasy:{name:"  ()",desc:"    ",prompt:"Premium Korean Web Novel Illustration, Masterpiece Digital Art, Soft Painterly Texture, Smooth Brushwork, Beautiful Anime-influenced Characters, Dreamy Fantasy Atmosphere, Vibrant Pastel Colors, 2D Art, Not Photorealistic, Not 3D Render, No Real Life Texture, No Camera Noise"}},it=t=>{if(!t)throw new Error("API   .   'API  '    .");return new xC({apiKey:t})},Tn=t=>{try{const e=t.indexOf("["),n=t.lastIndexOf("]");let r=t;if(e!==-1&&n!==-1&&n>e)r=t.substring(e,n+1);else{const o=t.indexOf("{"),i=t.lastIndexOf("}");o!==-1&&i!==-1&&i>o&&(r=t.substring(o,i+1))}return r=r.replace(/```json\s*/g,"").replace(/```\s*/g,""),JSON.parse(r)}catch(e){throw console.error("JSON Parse Error:",e,"Raw Text:",t),new Error("AI    . (JSON  )")}},Tm=t=>{if(!t)return t;const e=t.trim(),n=e.match(/^(.*)\((.+)\)\s*$/);return n?n[1].trim().replace(/\s+/g," "):e},Sm=t=>{const e=String((t==null?void 0:t.message)||""),n=String(t||"");return n.includes('"code":500')||n.includes("Internal error encountered")||e.includes('"code":500')||e.includes("Internal error encountered")},wm=async(t,e,n,r=2)=>{let o=null;for(let i=0;i<=r;i++)try{return await t.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:e},config:{imageConfig:n}})}catch(s){if(o=s,!Sm(s)||i===r)throw o;const a=500*(i+1);await new Promise(u=>setTimeout(u,a))}throw o},EC=`
  [HISTORICAL VERIFICATION STANDARDS - PASSIVE CONSTRAINTS]
  * USE THIS ONLY TO VALIDATE EXISTING ELEMENTS.
  * DO NOT GENERATE THESE ITEMS UNLESS EXPLICITLY REQUESTED IN THE SCRIPT.

  1. ONDOL STRUCTURE (CRITICAL): 
     - Kitchen (Bu-eok) MUST be attached to the Main Room (An-bang). NO OUTDOOR ISLAND KITCHENS.
     - Kitchen floor is LOWER (dirt). Room floor is RAISED (wood/stone).
  2. DOORS & WINDOWS:
     - ROOM DOORS: White rice paper (Changhoji) on wooden lattice.
     - KITCHEN DOORS: Rough solid wood planks. NO PAPER.
  3. ROOF & WALLS:
     - Commoner: Mud walls + Rounded Straw Roof (Choga).
     - Noble: Plaster walls + Black Tile Roof (Giwa).
`,TC=`
  [HISTORICAL COSTUME VERIFICATION - DEFAULT STANDARDS]
  * These are general Joseon Dynasty standards. 
  * Use them to VALIDATE logic, but DO NOT OVERRIDE specific character designs in the script.
  * IF THE SCRIPT IS SILENT, assume these defaults.
  * IF THE SCRIPT SPECIFIES OTHERWISE (e.g. "Short hair"), FOLLOW THE SCRIPT.

  1. SHOES:
     - Jipsin (Straw shoes): Flat soles, covering the toes. Not slippers.
     - Indoors: NO SHOES. White socks (Beoseon) only.
  2. CLOTHING:
     - Hanbok Skirt (Chima): **MUST BE FLOOR LENGTH**. Cover the ankles and feet. Only the toe of the shoes should be visible.
     - Sleeves: Curved (Baerae).
  3. HAIR (DEFAULT STYLES):
     - Men (Married): Sangtu (Topknot) + Headband (Manggeon).
     - Men (Unmarried): Long braided hair (Daenggi).
     - Women (Married): Low Bun (Jjok-jin) with Binyeo (Hairpin).
     - Women (Unmarried): Long braided hair.
     - **NOTE**: Modern hairstyles (Bob, Perm) are RARE but allowed if script demands.
  
  4. **[CRITICAL] UNDRESSED STATE (SEE-THROUGH RAMIE)**:
     - When prompt says "Remove Jeogori", "Undressed", "Sleeping", "Transparent":
       - **ITEM**: **"Moshi-Jeoksam" (White Ramie Summer Shirt)**.
       - **TRANSPARENCY**: The fabric is **EXTREMELY SHEER / SEE-THROUGH**.
       - **VISUAL EFFECT**:
         1. **SKIN TONE**: The **flesh tone** of Shoulders, Arms, and **Upper Chest (Cleavage)** MUST be clearly visible through the white fabric.
         2. **UNDER-LAYER**: The **White Chest Band (Mal-gi)** wrapping the breasts is visible **BENEATH** the sheer shirt.
         3. **RIBBON (Goreum)**: Even the chest ribbon is **TRANSPARENT WHITE RAMIE**.
       - **SILHOUETTE**: A white misty veil over the skin. Not opaque.

  5. **NOBLEMEN (SEONBI/YANGBAN) COLORS**:
     - **INNER LAYERS**: The Inner Jacket (Sok-jeogori) and Pants (Baji) MUST BE **PURE WHITE**.
     - **OUTER ROBE**: Can be colored, but the pants visible underneath MUST be White.
     - **NEVER** generate colored pants for Noblemen.
`,SC=`
  [HISTORICAL SITTING ETIQUETTE & POSTURE RULES]
  * STRICTLY FOLLOW Social Hierarchy and Situation.
  
  1. **DEFAULT POSTURE (FLOOR SITTING)**:
     - **Yangban (Nobles/Elders)**: Sit **CROSS-LEGGED** (Yangban-dari / Agura). 
       - NEVER kneel unless in front of the King or in deep apology.
     - **Commoners/Subordinates/Children**: 
       - If informal/relaxed: Cross-legged.
       - If formal/polite (e.g., in front of Father/Master): **KNEELING** (Mureup-kkul-gi).
  
  2. **HIERARCHICAL CONTEXT (CRITICAL)**:
     - **Father vs Son**: 
       - **FATHER**: Sits **CROSS-LEGGED** (Comfortable authority).
       - **SON**: Sits **KNEELING** (Respectful attention).
       - **NEVER**: Father kneeling before Son. (Unless Father is begging for forgiveness).
     - **Master vs Servant**:
       - Master: Cross-legged.
       - Servant: Standing (head bowed) OR Kneeling on floor.
  
  3. **GENDER SPECIFICS**:
     - **Women (Noble/Commoner)**: Generally sit with knees bent to side (comfortable) or Kneeling (formal). Avoid wide cross-legged spread (considered masculine/rude in formal settings, but okay for Grandma/Ajumma in market).
`,wC=`
  NEGATIVE PROMPT: **LOOKING AT CAMERA**, **EYE CONTACT**, posing for photo, selfie, modern items, electricity, cars, concrete, western clothes, beds, chairs, glass windows, paved roads, Japanese style shoes (Geta/Zori), curled toe shoes, pointed shoes, elf shoes, Chinese queues, text, watermark, speech bubble, dirty face (unless specified), messy hair (unless specified), short skirt, showing legs, modernized hanbok, 3d render, plastic skin, western lingerie, nipples, genitals, modern bra, thick clothes, winter clothes.
`,Cm=`
  CONTEXT: Korea, Joseon Dynasty (19th Century).
  ${EC}
  ${TC}
  ${SC}
  ${wC}
`,Im=async(t,e)=>{const n=it(t),r=e.match(/^data:(.+);base64,(.+)$/);if(!r)return"Imported image";const o=`
    Analyze this character image for a CONTINUITY SHEET.
    
    [CRITICAL INSTRUCTION]
    Describe specific visual traits that MUST be preserved in future drawings.
    
    1. **HEADWEAR**: Exact type (Gat, Nambawi, None) and color.
    2. **HAIR**: Exact style (Topknot, Braid, Bun) and hairline.
    3. **CLOTHING**: 
       - Top (Jeogori) Color & Pattern.
       - Bottom (Baji/Chima) Color.
       - Outer (Dopo/Jangot) Color.
    4. **FACE**: Eye shape, facial hair (beard/mustache), distinct features.
    
    Output a single paragraph. Be extremely precise about COLORS.
  `;try{return(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:r[1],data:r[2]}},{text:o}]}})).text||"Imported Character Reference"}catch(i){return console.error("Vision Analysis Failed",i),"Imported Character Reference (Analysis Failed)"}},CC=async(t,e,n)=>{const r=it(t),o=`
      You are a storyboard director. SPLIT this scene into ${n} sequential cuts.
      ORIGINAL: "${e.scriptSegment}" (${e.location})
      
      RULES:
      1. Break the action/dialogue logically.
      2. Keep the same Location/Time.
      3. Create specific visual descriptions for each cut.
      
      OUTPUT JSON:
      [ { "location": "Location (Keep Korean)", "timeOfDay": "Time (Keep Korean)", "scriptSegment": "Script Content (Keep Korean)", "description": "Visual Description (English)" }, ... ]

      [LANGUAGE RULES]
      1. **scriptSegment**: MUST BE KOREAN. Copy the exact lines from the original script. DO NOT TRANSLATE.
      2. **location** & **timeOfDay**: MUST BE KOREAN (e.g., "", "").
      3. **description**: MUST BE ENGLISH (Visual instructions for Image AI).
      
      [CRITICAL INSTRUCTION - NO CHARACTER APPEARANCE]
      - **ABSOLUTELY NO PHYSICAL DESCRIPTIONS**: Do NOT describe hair (style, color, length, accessories like Binyeo), clothes, or face.
      - **HISTORICAL RULE**: Do NOT apply \`JOSEON_COSTUME_RULES\` (like mandatory Binyeo) to this description. It creates conflicts with Character Reference Images.
      - **FILTERING RULE**: If the script describes appearance (e.g., "She fixed her binyeo"), IGNORE the object details. Just describe the action ("She touches her head").
      - **REASON**: Describing appearance here causes CONFLICTS with the Reference Image (e.g., generating "Short hair with Binyeo" which is impossible).
      - **BAD**: "A woman with bobbed hair and a binyeo is crying."
      - **GOOD**: "A woman is crying."

      [DYNAMIC ACTING & CONTINUITY]
      - **INTENSITY**: Use strong verbs. "Dragging", "Screaming", "Collapsing", "Struggling".
      - **CONTINUITY**: If a character is tied/bound in the previous cut, THEY MUST REMAIN TIED unless explicitly untied.
      - **EXAMPLE**: "Character A is being dragged by a rope tied around their torso." (If applicable).
    `;try{const i=await r.models.generateContent({model:"gemini-2.5-flash",contents:o,config:{responseMimeType:"application/json"}});if(i.text){const s=Tn(i.text);if(Array.isArray(s))return s.map((a,u)=>({id:`${e.id}-split-${Date.now()}-${u}`,sceneNumber:0,location:a.location||e.location,timeOfDay:a.timeOfDay||e.timeOfDay,scriptSegment:a.scriptSegment,description:a.description,aspectRatio:e.aspectRatio,casting:e.casting}))}return[e]}catch(i){throw console.error(i),new Error("  ")}},Nm=async(t,e,n=[],r=[],o=30)=>{const i=it(t),s=r.length>0?r.map(c=>`- Name: "${c.name}" (ID: ${c.id}) / Desc: ${c.visualGuide||c.description||"No desc"} / Age: ${c.age||"Unknown"}`).join(`
`):"No registered characters yet.",u=`
    Analyze this Korean script for a Webtoon/Animation storyboard.
    ${n.length>0?`EXISTING LOCATIONS: ${n.map(c=>`${c.location} (${c.description})`).join("; ")}`:""}

    [CHARACTER MATCHING RULE - STRICT CLOSED LIST]
    You have a list of REGISTERED CHARACTERS:
    ${s}
    
    1. **CLOSED WORLD ASSUMPTION**: You can ONLY cast characters that appear in the list above.
    2. **NO NEW NAMES**: Do NOT invent new names like "Villager A" or "Soldier" if they are not in the list.
    3. **NO AD-HOC VARIANTS**: 
       - If the list contains "Gildong" and "Gildong (Corrupt)", you MAY choose "Gildong (Corrupt)" if the script supports it.
       - **CRITICAL**: If the list ONLY contains "Gildong", and the script describes him as corrupt, you MUST output "Gildong". DO NOT output "Gildong (Corrupt)".
       - **NEVER** add brackets or modifiers that are not explicitly in the registered list.
    4. **EXACT STRING MATCH**: Your output 'characterNames' must match the registered names EXACTLY.
    
    TASK: Break down the script into SCENES based on NARRATIVE BEATS.
    Target Count: Generate EXACTLY ${o} scenes.
    
    [STRICT COUNT RULE]
    - THE USER WANTS EXACTLY ${o} SCENES.
    - DO NOT GENERATE MORE THAN ${o}.
    - DO NOT GENERATE LESS THAN ${o}.
    - YOU MUST ADJUST THE PACING to fit this exact number.
      - If you have too many scenes, MERGE them.
      - If you have too few scenes, SPLIT them.
    
    [MINIMUM COUNT REQUIREMENT]
    - TARGET: ${o} SCENES.
    - DO NOT SUMMARIZE the story. This is a DETAILED STORYBOARD.
    
    [CRITICAL CONTEXT AWARENESS RULE - NEVER LOSE THE FLOW]
    - **THE PROBLEM**: If you split a scene and it only has one line of dialogue (e.g., "Stop!"), the Image AI will not know *why* they are shouting.
    - **THE SOLUTION**: You MUST inject the **NARRATIVE CONTEXT** into the description.
    - **CONTEXT INHERITANCE**: Always look at the PREVIOUS scenes.
      - If they were running in the previous scene -> In this dialogue scene, describe them "panting and sweating".
      - If they were fighting -> Describe them "holding a weapon, glaring".
    - **NO EMPTY DESCRIPTIONS**: 
      - **BAD**: "Gildong says hello." (Context lost)
      - **GOOD**: "Gildong, standing amidst the ruins of the burning house, looks at the enemy with tears in his eyes and shouts." (Context preserved)
    - **VISUAL STORYTELLING**: Even if the script is just text, you must visualize the *Atmosphere* and *Emotion*.

    [SCENE MERGING RULE - DETAILED SPLIT]
    - **SPLIT AGGRESSIVELY**: If there is ANY change in camera angle, emotion, or action, CREATE A NEW SCENE.
    - **DIALOGUE PING-PONG**: For important conversations, use the "Shot-Reverse Shot" technique. (Scene A: Speaker 1 -> Scene B: Speaker 2 -> Scene C: Speaker 1).
    - **ACTION BEATS**: Break down actions. "He walks to the door" -> Scene 1: Stands up. Scene 2: Walks. Scene 3: Reaches for handle.
    - **GOAL**: We need a RICH visual flow, not a summary.
    
    [NARRATION / LANDSCAPE / ENDING SCENES - MUST NOT SKIP]
    - **NARRATION-ONLY LINES** (no characters speaking, e.g. " ,     "):
      - Treat these as FULL SCENES with **NO CHARACTERS** and a STRONG LANDSCAPE description.
      - Set "characterNames": [] and focus on environment, time-of-day, and mood.
    - **TIME SKIP / DAY CHANGE** (e.g. " ", " ", " "):
      - MUST create at least one TRANSITION SCENE that visually shows the new time and place.
      - Use smoke, fog, sunrise, sunset, village lights, etc., if implied by the narration.
    - **FINAL NARRATION / MORAL / EPILOGUE**:
      - The last 1~2 scenes MUST cover the **final lines of the script**, even if they are purely moral narration.
      - Do NOT end the storyboard early just because the targetCount is reached.
      - If you are running out of scene slots, MERGE LESS IMPORTANT MIDDLE BEATS, but ALWAYS keep an explicit final scene for the ending narration.
    - **SCRIPT COVERAGE RULE**:
      - From the first line to the last line (including moral/epilogue), there must be a continuous sequence of scenes.
      - Do NOT drop narration paragraphs that describe important atmosphere or transitions.
    
    [FINAL CHECK]
    - Did you cover the WHOLE script?
    - Did you skip any important actions?
    - If you only have under 20 scenes for a long script, YOU FAILED. Go back and split them more detailedly.
    
    OUTPUT JSON:
    [{ "sceneNumber": 1, "location": "Location (KOREAN)", "scriptSegment": "Original Script Text (KOREAN)", "description": "Visual Description for AI Prompt (ENGLISH)", "timeOfDay": "Day/Night (KOREAN)", "characterNames": ["Name1", "Name2"] }]
    
    [IMPORTANT LANGUAGE RULES]
    1. **scriptSegment**: MUST BE KOREAN. Copy exact lines from script. DO NOT TRANSLATE.
    2. **location**: MUST BE KOREAN (e.g., "", "", "").
    3. **timeOfDay**: MUST BE KOREAN (e.g., "", "", "", "").
    4. **characterNames**: LIST OF KOREAN NAMES FROM THE REGISTERED LIST ONLY.
       - **FORMAT**: Must match the registered name EXACTLY (e.g. "", " ()").
       - **CRITICAL**: List ONLY characters PHYSICALLY PRESENT in the scene.
       - **SPEAKER IDENTIFICATION**: If the script uses tags like '[Name]' or 'Name:', trust these tags to identify the speaker. The speaker is ALWAYS present.
       - **INCLUDE**: The Speaker AND the Listener(s).
       - **EXCLUDE**: Do NOT list characters who are merely MENTIONED in dialogue but are NOT present.
       - **EXAMPLE**: If Father talks to Son about Uncle, list ["Father", "Son"]. (Uncle is NOT there).
       - **EXAMPLE 2**: If Deuk-su speaks to Dal-yi, list ["", ""].
       - **EXAMPLE 3**: If Arang is tortured, list [""] and describe the tortured appearance ONLY in "description".
    5. **description**: MUST BE ENGLISH (Visual instructions for Image AI).
       - **STYLE GOAL**: **CINEMATIC & DRAMATIC**. Write it like a movie scene description, not a simple sentence.
       - **CONTEXT IS KING**: 
         - **NEVER** just describe the action of speaking.
         - **ALWAYS** describe the **Environment + Physical State + Emotional Vibe**.
         - **Example**: Instead of "He asks a question", write "In the dark rainy alley, he grabs the collar of the suspect and screams with rain dripping down his face."
       - **LIGHTING & ATMOSPHERE**: ALWAYS specify lighting (e.g., "Dim candlelight casting long shadows", "Harsh sunlight", "Cold blue moonlight").
       - **CAMERA**: Suggest angles if relevant (e.g., "Low angle looking up", "Over the shoulder").
       - **CONTENT RULE**: Describe ONLY the Environment (Weather, Lighting, Props) and Character ACTIONS/EMOTIONS.
       - **INTERACTION MANDATE (CRITICAL)**: 
         - If multiple characters are present, explicitly state "Looking at each other" or "Looking at [Name]".
         - **NEVER** imply they are posing for a photo.
         - For conversations, prefer over-the-shoulder, side profile, or diagonal compositions where characters face each other, not the camera.
       - **ACTING MANDATE (DYNAMIC & DRAMATIC)**: 
         - **INTENSITY**: Do not use boring words like "standing" or "sitting". Use "Slumping", "Collapsing", "Lunging", "Trembling".
         - **FACIAL EXPRESSIONS**: Specify the EXACT muscle movement. "Gritting teeth", "Eyes wide in terror", "Tears streaming down", "Veins popping".
         - **ACTION**: If the scene is dramatic, describe the MOTION. "Being dragged by a rope", "Falling to knees", "Pointing a finger accusingly".
         - **BAD**: "He looks sad."
         - **GOOD**: "He falls to his knees, wailing with his head on the ground."
         - **FIGHT / CONFRONTATION STAGING**:
           - If two sides (hero vs enemy, man vs tiger, archer vs target) are facing off, describe them facing each other or diagonally across the space, NOT standing in a line looking toward the camera.
           - Ensure the active motion is clear: one side attacking, the other reacting (dodging, being hit, falling), not both frozen like a posed photo.
       - **CONTINUITY OF PHYSICAL STATE (CRITICAL)**:
         - **BOUND/CAPTIVE**: If a character is described as TIED (rope/Poseungjul) or CAPTURED, **KEEP THEM TIED** in the description until the script explicitly says "untied" or "released".
         - **INJURY/DIRT**: If they were beaten or fell in mud, **KEEP THEM INJURED/DIRTY** in subsequent scenes.
         - **EXAMPLE**: "Old man Park, still tied with the red rope, stumbles forward."
       - **STRICT PROHIBITION (CRITICAL)**:
         - **ABSOLUTELY NO PHYSICAL DESCRIPTIONS**: Do NOT describe hair (style, color, length), clothes (hanbok, color, type), face (beard, makeup), or accessories (binyeo, hat).
         - **NO HALLUCINATIONS**: Do NOT infer or add details not explicitly written in the script. If the script says "She enters", DO NOT write "She enters opening the wooden door". Just "She enters".
         - **FILTERING RULE**: Even if the script says "Her long hair fluttered", YOU MUST ONLY WRITE "She turns her head". IGNORE the hair description.
         - **BAD**: "A woman with a binyeo in her short hair looks back."
         - **GOOD**: "A woman looks back with a sad expression."

    SCRIPT:
    ${e.substring(0,3e4)}
  `;try{const c=await i.models.generateContent({model:"gemini-2.5-flash",contents:u,config:{responseMimeType:"application/json"}});if(c.text){const h=Tn(c.text);if(Array.isArray(h))return h.map((p,m)=>{const g={mainIds:[],subIds:[]},E=Array.isArray(p.characterNames)?p.characterNames:[],v=[];return E.forEach(w=>{const y=w.trim();let x=r.find(T=>T.name===y);if(!x){const T=r.filter(I=>y.includes(I.name)||I.name.includes(y));T.length>0&&(x=T[0])}x&&(g.mainIds.includes(x.id)||g.mainIds.push(x.id),v.includes(x.name)||v.push(x.name))}),g.mainIds.length>3&&(g.mainIds=g.mainIds.slice(0,3),g.subIds=[]),{id:`scene-${Date.now()}-${m}`,...p,characterNames:v,casting:g}})}return[]}catch(c){throw console.error(c),new Error("  .  .")}},_m=async(t,e,n,r=[])=>{const o=it(t),i=`
    You are a Casting Director for a High-Budget Visual Production.
    Extract characters from the script and define their Visual Appearance with EXTREME DETAIL.
    
    OUTPUT JSON:
    [{ "name": "Name (KOREAN)", "visualGuide": "Korean Desc", "age": "20", "gender": "Male", "description": "English visual prompt" }]

    [LANGUAGE RULES]
    1. **name**: Keep in KOREAN (e.g., "").
    2. **visualGuide**: Korean description for the user (Summary).
    3. **description**: English visual description for AI. **THIS MUST BE HIGHLY DETAILED.**

    [CRITICAL RULE: VISUAL DETAIL]
    - Even if the script is vague, **YOU MUST HALLUCINATE DETAILED VISUALS** suitable for a Character Sheet.
    - **MANDATORY FIELDS TO INCLUDE IN DESCRIPTION**:
      - **Face**: Eye shape, nose, facial hair, scars, makeup (e.g., "Sharp hawk eyes", "Thick beard", "Pale skin with red lips").
      - **Hair**: Specific style, texture, accessories (e.g., "Messy topknot with loose strands", "Silky long black hair with jade hairpin").
      - **Clothing**: Fabric, colors, patterns, condition (e.g., "Silk red Jeogori with gold embroidery", "Tattered hemp clothes stained with dirt").
      - **Vibe**: Personality reflected in appearance (e.g., "Arrogant sneer", "Gentle and warm smile").
    - **DO NOT** write simple descriptions like "A man in Hanbok".
    - **WRITE**: "A middle-aged man with a thin mustache, wearing a dark blue silk Gat and a light blue Dopo, looking stern and authoritative."

    [CRITICAL RULE: SINGLE NAME, DESCRIPTION HANDLES STATE]
    - **ALWAYS USE A SINGLE BASE NAME** for each person (e.g., "").
    - **DO NOT** create separate entries like " ()", " ( )".
    - If the script shows torture, disguise, age change, or promotion, DESCRIBE IT ONLY INSIDE "description" and "visualGuide".
      - Example 1: Name: "", description explains that he is now wearing noble clothes instead of servant rags.
      - Example 2: Name: "", description explains "as a child" or "as an adult".
      - Example 3: Name: "", description explains that she is cross-dressed as a man.
      - Example 4: Name: "", description explains human vs fox form in detail.
    - The USER will manually create multiple reference images (e.g., " 1", " 2") if needed. You must NOT encode state in the name.

    SCRIPT:
    ${e.substring(0,3e4)}
    - **DESCRIPTION**: The description must reflect the NEW state (e.g., "Nine-tailed fox with white fur" instead of "Beautiful woman").
    - **BASE CHARACTER**: Treat them as unique entries so the user can assign different reference images to them.

    SCRIPT:
    ${e.substring(0,15e3)}...
  `;try{const s=await o.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json"}});if(s.text){const a=Tn(s.text);if(Array.isArray(a))return a.map((u,c)=>{const h=Tm(u.name||"");return{id:`char-${Date.now()}-${c}`,...u,name:h,hasDialogue:!0,chromaKeyColor:"green",actions:[]}})}return[]}catch(s){return console.error(s),[]}},IC=async(t,e)=>{const n=it(t),r=`
    Analyze the script and EXTRACT IMPORTANT PROPS (Objects) that need visual consistency.
    
    [CRITICAL CRITERIA FOR EXTRACTION]
    1. **RECURRING & SIGNIFICANT**: Objects that appear multiple times or play a key role (Evidence, Weapon, Unique Accessory).
    2. **VISUAL IMPORTANCE**: Items that need to look the SAME in every scene (e.g., "The King's Seal", "The Jade Ring", "The Bloody Dagger").
    3. **IGNORE GENERIC ITEMS**: Do NOT extract common items like "a bowl", "a table", "a stone" unless they are unique (e.g., "The Golden Bowl").
    
    [OUTPUT FORMAT - JSON]
    [
      { 
        "name": "Prop Name (Korean)", 
        "description": "Detailed Visual Description (Material, Color, Shape, Vibe) in English", 
        "type": "One of: 'object', 'evidence', 'vehicle', 'animal'" 
      }
    ]

    SCRIPT:
    ${e.substring(0,3e4)}
  `;try{const o=await n.models.generateContent({model:"gemini-2.5-flash",contents:r,config:{responseMimeType:"application/json"}});if(o.text){const i=Tn(o.text);if(Array.isArray(i))return i.map(s=>({id:`prop-auto-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:s.name,description:s.description,type:s.type||"object",imageUrl:""}))}return[]}catch(o){throw console.error(o),new Error("  ")}},NC=async(t,e,n,r,o,i="auto")=>{const s=it(t),a=n.map(g=>`[CHARACTER: ${Tm(g.name)}] (ID: ${g.id}) Gender: ${g.gender}, Age: ${g.age}, Desc: ${g.description}`).join(`
`),u=r?r.map(g=>`[PROP: ${g.name}] (ID: ${g.id}) ${g.description}`).join(`
`):"",c=o?`[GLOBAL RULES] ${o}`:"",h={auto:`
      [THEME: AI AUTO-ANALYSIS (BEST FIT)]
      - **TASK**: Analyze the script and DETERMINE THE BEST GENRE/TONE (Mystery, Comedy, Tragedy, etc.) yourself.
      - **GOAL**: Choose the theme that will generate the MOST CURIOSITY and VIEWS.
      - **EXECUTION**: Apply the rules of the chosen genre (e.g., if you choose Comedy, use wide angles; if Horror, use shadows).
      - **IMPORTANT**: Do not be generic. Pick a SPECIFIC angle (e.g., "Deep Tragedy" or "Slapstick Comedy") and stick to it.
    `,mystery:`
      [THEME: MYSTERY & THRILLER]
      - **MOOD**: Dark, Suspenseful, Uneasy.
      - **FOCUS**: Secrets, Shadows, Unseen threats.
      - **ENDING**: The protagonist opens a "Forbidden Box" or sees something shocking. CUT before revealing what it is.
      - **LIGHTING**: High contrast (Chiaroscuro), Moonlight, Flickering candles.
    `,comedy:`
      [THEME: SATIRE & COMEDY (B-Class Humor)]
      - **MOOD**: Absurd, Exaggerated, Ironic.
      - **FOCUS**: "WTF Moments", Stupid decisions, Slapstick consequences.
      - **ENDING**: A ridiculous situation freezes frame. The protagonist realizes they messed up big time.
      - **VISUALS**: Bright colors, wide angles (fisheye effect), funny facial expressions.
    `,destiny:`
      [THEME: EPIC DESTINY]
      - **MOOD**: Grand, Mythical, Serious.
      - **FOCUS**: Prophecies, Birth secrets, Royal bloodlines.
      - **ENDING**: A moment of realization or acceptance of a great burden. The "Hero's Journey" begins.
      - **VISUALS**: Cinematic wide shots, God rays, Slow motion, Golden/Warm tones.
    `,tragedy:`
      [THEME: SADNESS & HAN (Deep Sorrow)]
      - **MOOD**: Melancholic, Heartbreaking, Lonely.
      - **FOCUS**: Loss, Separation, Unjust suffering.
      - **ENDING**: The protagonist screams in silence or tears fall in slow motion. Focus on the emotional pain.
      - **VISUALS**: Desaturated colors, Rain, Snow, Cold/Blue tones, Close-ups on tears.
    `,revenge:`
      [THEME: REVENGE & PASSION]
      - **MOOD**: Intense, Violent, Burning.
      - **FOCUS**: Betrayal, Anger, Preparation for the kill.
      - **ENDING**: The protagonist eyes burn with vengeance. They hold a weapon. CUT before the strike.
      - **VISUALS**: High contrast, Red accents (blood/fire), Sharp focus, Dutch angles.
    `,despair:`
      [THEME: POVERTY & DESPAIR (Realism)]
      - **MOOD**: Gritty, Dirty, Hopeless.
      - **FOCUS**: Hunger, Cold, Cruelty of the world.
      - **ENDING**: The protagonist hits rock bottom. A look of total emptiness.
      - **VISUALS**: Dirty textures, Earthy tones, Handheld camera (shaky), Raw realism.
    `},p=h[i]||h.mystery,m=`
    Act as a PD for a viral 'Mystery/Folktale' YouTube channel.
    Create a 5-shot "HOOKING TEASER" sequence based on the selected theme.

    [VISUAL CONSISTENCY BIBLE]
    You MUST adhere to these character and prop designs strictly.
    ${a}
    ${u}
    ${c}
    ${Cm}

    ${p}

    [CRITICAL RULE: NO SPOILERS & NO RESOLUTION]
    - **ABSOLUTE PROHIBITION**: Do NOT reveal the "Secret Identity" or "Final Twist" in the opening.
    - **NO KEY CHARACTERS**: Do NOT show the "Answer" character (e.g., The King, The Real Father). If the goal is to meet the King, do NOT show the King. Show the *Gatekeeper* or the *Obstacle* instead.
    - **AMBIGUOUS LOCATION**: Do not make it obvious where it is (e.g., "Is this the Palace or a Prison?"). Keep the background focused on the *conflict*, not the landmark.
    - **Example**: A girl holding a knife. Is she in front of the King? We don't know. We only see the knife and the soldiers blocking her. **The King is NOT in the frame.**
    - **HIDE THE ANSWER**: The audience must NOT know *who* she really is yet. They should only see a "desperate girl fighting against the world".
    - **CUT BEFORE THE TRUTH**: Stop the scene *right before* the secret is revealed.

    [CRITICAL MISSION: FIND THE "INCITING INCIDENT" AND DRAMATIZE IT]
    Every story, no matter the genre, has a "Spark" (Inciting Incident) that starts the fire.
    Your job is to **find that spark and pour gasoline on it** according to the THEME.
    
    1. **SCAN FOR CONFLICT**:
       - Look for the moment matching the theme (e.g., Absurdity for Comedy, Loss for Tragedy).
       - It could be a physical threat, a social humiliation, a shocking discovery, or a heartbreaking loss.
       - **Ignore the "Setup" and "Resolution". Go straight for the "Problem".**
    
    2. **DRAMATIZE THE MOMENT (Make it Cinematic)**:
       - Even if the text says "He was sad", you must visualize it as "He screams at the rain".
       - Even if the text says "She was scared", you must visualize it as "Her hands tremble as she hides under the floorboards".
       - **Translate "Text Description" into "Visual Action".**

    [BANGTONG ULTRA HOOKING RULE - NON NEGOTIABLE]
    - The 5 shots together must feel like an intense 30~40 second teaser.
    - The viewer should naturally react with thoughts like:
      "  ?", " ", "  ?", " ?", "  ?"
    - Among all possible events, always choose the one that is the most:
      1) Visually shocking or uncanny,
      2) Emotionally extreme (rage, despair, terror, obsession),
      3) Morally or situationally ambiguous (the viewer cannot immediately judge who is right/wrong).
    - Do NOT base the hook on calm exposition, polite conversation, or simple daily life.
    - Even in comedy or satire, the situation itself must be sharp and provocative, not just lightly funny.
    
    [NOT A SIMPLE "HIGHLIGHT" OF THE SCRIPT]
    - Do NOT just pick a paragraph and illustrate it 1:1 as written.
    - Your job is to CREATE a new hooking situation INSPIRED by the script.
    - You may:
      - Compress several moments into one intensified situation,
      - Foreshadow later events with symbolic images,
      - Emphasize a single gesture or object far more than the original text.
    - You MUST stay faithful to characters, relationships, and basic facts of the script,
      but you are allowed to exaggerate, stylize, and rearrange details to maximize curiosity.
    - Think like a teaser PD, NOT a documentary reenactment director.
    
    // Theme strategy is already injected above via selectedThemeInstruction
    
    [CRITICAL INSTRUCTION: SPATIAL CONTINUITY & SINGLE EVENT FOCUS]
    - **DO NOT MAKE A "TRAILER MONTAGE"**: Do not jump between different times or disconnected places to summarize the plot.
    - **ONE CONTINUOUS EVENT**: The 5 shots must depict **A SINGLE, UNBROKEN SEQUENCE OF ACTIONS** happening in **ONE LOCATION** (or immediately connected spaces like Room -> Yard).
    - **REAL-TIME FLOW**: Shot 1 leads directly to Shot 2. No time jumps.
    - **GOAL**: Do not explain the story. Create **CURIOSITY**. Show a specific, weird, or intense moment that makes the viewer ask "Why??".
    - **LOCATION LOCK**: If Shot 1 is in the "Master's Room", Shot 5 should still be in/near the "Master's Room". Do not suddenly cut to a "Marketplace".

    [NARRATIVE ARC (The "Universal Cliffhanger" Formula)]
       - Shot 1 (Trigger): The conflict begins (e.g., The threat appears).
       - Shot 2 (Escalation): The situation gets worse (No escape).
       - Shot 3 (Desperation): The protagonist realizes there is no way out.
       - Shot 4 (Decision): The protagonist makes a "Fatal Decision" or "Last Resort".
       - **Shot 5 (The CLIFFHANGER)**: **The moment of "Irreversible Action"**.
         - **RULE**: Stop exactly **1 second before the result/consequence**.
         - If they jump: Show the leap, NOT the landing.
         - If they stab: Show the blade touching the skin, NOT the blood.
         - If they scream: Show the open mouth, NOT the silence after.
         - **BLACK OUT** at the peak of tension.

    [KEYFRAME VS VIDEO RULE]
    - The opening sequence image is a KEYFRAME that happens right BEFORE the main incident of the scene.
    - The "visualPrompt" must describe the PRE-EVENT moment, not the aftermath.
    - NEVER describe the character as "already captured", "already stabbed", "already burned", "already dead" in the visualPrompt.
    - If the event is "being caught in a net while picking a herb on a cliff", then:
      - visualPrompt: focus on the moment just before or at the very start of the trap (e.g., she reaches for the herb, the net is just beginning to fall above her head).
      - Do NOT describe her as already tangled in the net or being dragged away.
    - Always freeze the frame at the last safe instant before the irreversible action. The consequence must be implied, never fully shown, in the visualPrompt.

    [EXAMPLES OF HOOKING LOGIC]
    - If the story is about revenge: Show the cruel moment the protagonist is kicked out in the rain, crying blood tears.
    - If the story is about a slave: Show the pain/torture of the slave market, then end with the rich man saying "I will buy him."
    - **Goal**: Show the SUFFERING, CONFLICT, or SHOCKING REVEAL.
    
    [VEO VIDEO PROMPT RULES - CINEMATIC JSON FORMAT]
    Instead of a simple string, generate a structured 'videoPrompt' JSON object for professional control.
    
    [ACTING & EYE CONTACT RULES - ABSOLUTE PRIORITY]
    1. **NO EYE CONTACT WITH CAMERA**: 
       - The character MUST NOT look at the viewer/lens.
       - **PENALTY**: If the character looks at the camera, the image is ruined.
    
    2. **IMMERSIVE ACTING GUIDE**:
       - **Focus on the Scene**: The character must be completely absorbed in the situation.
       - **Dialogue**: Look at the *Other Person* (or empty space where they would be). **NEVER** look at the camera while talking.
       - **Action**: Look at the *Object* in hand or the *Destination* of movement.
       - **Emotion**: If sad, look down or away. If angry, glare at the target. If thinking, look into the distance.
       - **Interaction**: If there is another character, LOCK EYES with them.
    
    3. **CANDID FEEL**: Capture the moment as an invisible observer. The character should be unaware of the camera's existence.

    [OUTPUT FORMAT]
    OUTPUT JSON: 
    [
      { 
        "sequenceNumber": 1, 
        "title": "Shot Title (Korean)", 
        "visualPrompt": "Detailed visual description for Image Gen (KOREAN). Must include '[NO EYE CONTACT]' instruction and MUST depict the moment just BEFORE the main incident (pre-event keyframe), not the aftermath.", 
        "characterIds": ["char_id"], 
        "propIds": ["prop_id"],
        "videoPrompt": {
            "subject": {
                 "action": "NARRATIVE EVENT: Describe the story action clearly (e.g., 'Woman falls on knees and screams', 'Man draws sword aggressively'). Do NOT just say 'standing'.",
                 "emotion": "Facial expression and mood",
                 "dialogue": "EXTRACT dialogue. IF TOO LONG, SUMMARIZE to be spoken within 6 seconds. Keep it KOREAN.",
                 "speaker_info": {
                     "gender": "Male/Female",
                     "age": "Child/Young Adult/Middle Aged/Elderly",
                     "voice_tone": "e.g., Deep, High, Raspy, Soft, Commanding"
                 }
             },
             "cinematography": {
                 "camera_motion": "e.g., 'Fast zoom in to eyes', 'Handheld chaos', 'Slow tracking shot'",
                 "lighting": "e.g., 'Moonlight through paper door', 'Flickering candlelight', 'Stormy grey light'",
                 "lens": "e.g., '35mm wide', '85mm portrait', 'Macro close-up'"
             },
             "transition": {
                 "type": "morph",
                 "timing": "Late transition at 7s",
                 "description": "Describe the visual change into the next shot (Image B)"
             },
             "ambience": "e.g., 'Rain falling heavily', 'Dust rising from ground', 'Smoke filling the air'"
         }
       }
     ]
     
    [CONSTRAINT]
     - "visualPrompt": MUST BE KOREAN. Detailed. **APPEND " (    )" at the end.** Also, it MUST describe the moment just BEFORE the irreversible action (1 second before the result), not the aftermath (no " ", " ", " " states).
     - "videoPrompt": MUST BE A JSON OBJECT (as shown above), written in ENGLISH (except for 'dialogue').
     - **CRITICAL**: The 'action' field must describe a STORY MOMENT, not just passive movement. The described moment must START from the pre-event state that matches the visualPrompt, then evolve toward the consequence, but never open with "already captured/already dead" as the initial frame.
     - **CASTING RULE**: In "characterIds", include ONLY characters PHYSICALLY VISIBLE in the shot. Do NOT include characters mentioned in the title/text but not shown.
     - **SPEAKER INFO**: Fill 'speaker_info' based on the character speaking. If no one speaks, set dialogue to "" and speaker_info to null.
    
    SOURCE TEXT:
    ${e.substring(0,5e4)}
  `;try{const g=await s.models.generateContent({model:"gemini-2.5-flash",contents:m,config:{responseMimeType:"application/json"}});if(g.text){const E=Tn(g.text);if(Array.isArray(E))return E.map(v=>({id:`open-${Date.now()}-${v.sequenceNumber}`,...v}))}return[]}catch(g){throw console.error(g),new Error("  ")}},_C=async(t,e,n,r="auto")=>{const o=it(t),i=n.map(a=>`[CHARACTER: ${a.name}] ${a.description}`).join(`
`),s=`
    Act as a YouTube Thumbnail Artist.
    Analyze the script and selected theme (${r}) to create ONE IMPACTFUL THUMBNAIL CONCEPT.

    SCRIPT:
    ${e.substring(0,3e4)}

    CHARACTERS:
    ${i}

    TASK:
    1. Identify the SINGLE MOST HOOKING MOMENT in the script (the moment that would make the viewer say " ?  ?").
    2. **CHARACTER-CENTRIC COMPOSITION (FACE + UPPER BODY + ACTION)**:
       - **MUST INCLUDE CHARACTERS**: Folk tales (Yadam) rely on characters. Do not just show objects.
       - Prefer 2 characters in strong tension (giver vs receiver, victim vs predator, sinner vs witness), but 1 character + monster/object of desire/forbidden thing is also allowed.
       - **SHOW UPPER BODY**: The main character's face, eyes, and hands must be clearly visible (at least head-to-waist framing). Do NOT draw only hands or a tiny full body far away.
       - **DYNAMIC**: Show the tension between them (e.g., A person accepting raw meat from a beast, A man threatening a woman, A tragic farewell).
       - **EXTRAS**: If the scene is a market or palace, include blurred extras in the background for scale.
       - **CASTING**: Prefer using names from the CHARACTERS list above if they match. However, if a key character (e.g., 'Villager', 'Tiger', 'Ghost') is crucial for the hook but not in the list, **YOU MUST INCLUDE THEM**. Do not force a wrong character just to match the list.
    3. **METHOD ACTING (BANGTONG STYLE)**:
       - **EXPRESSION IS KING**: The characters must have INTENSE, DRAMATIC EXPRESSIONS (terror, obsession, greed, despair).
       - **NO DEAD EYES**: Eyes must be alive with desire, fear, anger, or sorrow.
       - **ACTIVE POSING**: Do not just stand. Show concrete action (kneeling and receiving meat, biting raw flesh, pulling someone back from danger, hiding a bloody object).
    4. **HOOKING BACKGROUND & OBJECT**:
       - Always include the key threat or hook object: monster/animal (tiger, ghost, demon), weapon, bloody meat, coffin, rope, grave, etc.
       - Never draw "just a person with a surprised face" on empty background.
       - The environment (cave, forest, palace room) must support the tension and make the situation clear.
    5. **COMPOSITION (STRICT RIGHT ALIGNMENT)**:
       - **LEFT 60%**: PURE BLACK / DARK VOID. No light, no objects.
       - **RIGHT 40%**: Character Area.
       - **PLACEMENT**: The character MUST be pushed to the **EXTREME RIGHT**.
       - **FACE LOCATION**: The face MUST be in the Right 1/3 of the frame.
       - **NO CENTERING**: Do not place the character in the center.
       - **SEAMLESS BLEND**: The character's left side should fade into the darkness.
       - **LIGHTING**: Use SIDE LIGHTING from the right. The left side of the face should be in shadow.
    6. **STYLE**: High contrast, saturated colors, 'Netflix Thriller' thumbnail style. Match the '${r}' theme.

    OUTPUT JSON:
     {
         "title": "    (MUST BE KOREAN,  ,   , 20 )",
         "composition": "EXTREME RIGHT ALIGNMENT: Subject on Right 40%, Left 60% Pure Black (Linear Gradient). No Vignette.",
         "action": "Hyper-specific visual description of the MOST HOOKING MOMENT (English). Describe place, threat/object, and concrete body actions (e.g., ' kneels in a dark cave, accepting a strange piece of meat from a massive tiger while her hands tremble'). You MUST clearly state who is who using the actual Korean character names from the script (e.g., '', ''), not generic 'a man' or 'a woman'. Avoid graphic gore: no explicit open wounds, no dismemberment, no torture devices, and no detailed blood on faces or bodies. Focus on fear, tension, and expressions instead of explicit injury.",
         "characters": [
            { 
                "name": "Character Name (Korean)", 
                "action": "Specific pose/expression for this character (English)",
                "appearance": "Detailed visual description of the character's face, clothing, and age based on the script context (English). e.g. 'An old man with a long white beard wearing a tattered hanbok', 'A young woman with pale skin and messy hair'."
            }
         ]
     }
    `;try{const a=await o.models.generateContent({model:"gemini-2.5-flash",contents:s,config:{responseMimeType:"application/json"}});if(a.text){const u=Tn(a.text),c=h=>{let p=Array.isArray(h.characters)?h.characters:[];return(!p||p.length===0)&&n.length>0&&(p=n.slice(0,Math.min(2,n.length)).map(g=>({name:g.name,action:"      ."}))),h.characters=p,h};return Array.isArray(u)?c(u[0]||{}):c(u)}throw new Error("No response text")}catch(a){throw console.error(a),new Error("  ")}},os=async(t,e,n,r="16:9",o="background",i,s,a,u,c,h,p)=>{var X,J,K;const m=it(t),g=Vr[n].prompt;let v={aspectRatio:r||"16:9"},w=e;if(e&&/[-]/.test(e)&&(w=await Fn(m,e)),p&&p.length>0&&Array.isArray(i)&&i.length>0){const ee=p.map((O,V)=>`${O} (MATCH WITH PROVIDED REFERENCE IMAGE #${V+1})`).join(", ");ee&&(w+=`
[CHARACTER MATCHING: ${ee}]`)}let y=s||"";s&&/[-]/.test(s)&&(y=await Fn(m,s)),c&&/[-]/.test(c)&&await Fn(m,c);const x=`
    [ROLE] You are the "Continuity Supervisor" for a high-budget Korean Historical Drama.
    [ABSOLUTE CASTING RULE]
    - **DRAW ONLY** the characters explicitly listed in the "[FOCUS SUBJECT]" section of the prompt.
    - If the script mentions other characters (talking/listening) but they are NOT in "[FOCUS SUBJECT]", **DO NOT DRAW THEM**.
    - If only ONE character is listed, it must be a **SOLO SHOT**.
    
    [YOUR MISSION]
    1. **CONSISTENCY IS GOD**: 
       - If a Character Reference is provided, the character MUST look exactly like it.
       - If a Background Reference is provided, the room/environment MUST look exactly like it.
    2. **ACTING DIRECTOR**: Natural acting, candid shots.
    3. **HISTORICAL POLICE**: Enforce Joseon Dynasty rules.
  `,T=y?`
    [USER COMMAND - TOP PRIORITY OVERRIDE]
    The user is making a FINAL REVISION REQUEST for this scene.
    User says: "${y}".
    
    [EXECUTION RULES]
    1. This USER COMMAND has HIGHER PRIORITY than any previous style, continuity, or costume rules in this prompt.
    2. If the user asks to change clothing, hair, pose, camera angle, acting, or composition, YOU MUST OBEY even if it conflicts with previous instructions or the reference image.
    3. Ignore the Character/Background Reference constraints ONLY for the specific items the user wants to change. Keep the FACE and IDENTITY the same.
    4. If there is any conflict between this USER COMMAND and earlier rules, ALWAYS FOLLOW THE USER COMMAND (except for safety policy).
    5. Do not repeat the previous version. Produce a NEW image that clearly reflects the requested changes.
  `:"";let I="";const _=Array.isArray(i)?i:i?[i]:[];_.length>0&&(o==="character"||o==="cinematic")&&(I=`
        [VISUAL ANCHOR - CHARACTERS]
        The provided images (tagged as Character Refs) are the **MASTER REFERENCES**.
        
        - **MATCHING RULE**: The prompt explicitly tags characters with "(MATCH WITH PROVIDED REFERENCE IMAGE #N)".
        - **EXECUTION**: You MUST map the Nth provided image to that specific character.
          (e.g., "Reference Image #1" -> First image in the list, "Reference Image #2" -> Second image).
        
        - **HAIR**: Copy the reference hairstyles EXACTLY.
        - **CLOTHES**: Copy colors, layers, and patterns EXACTLY.
        - **EXCEPTIONS**: 
          1. **SHOES**: If the scene is INDOORS (Room/Maru), **REMOVE SHOES** (Show Socks/Beoseon) even if the reference has shoes.
          2. **HATS**: If the scene is INDOORS, **REMOVE OUTDOOR HATS** (Gat/Satgat) unless it's a specific indoor hat.
        - **FACE**: Copy facial features.
        - **BACKGROUND EXCLUSION**: IGNORE any background elements (walls, furniture, landscapes) visible in the Character Reference Images. Use them ONLY for Character Design.
      `);let R="";a&&(R=`
        [VISUAL MASTER - BACKGROUND & STYLE]
        The provided image is the **BACKGROUND REFERENCE**.
        1. **ARCHITECTURE & ATMOSPHERE**: Copy the room structure, furniture, lighting, and textures EXACTLY.
        2. **ADAPT FRAMING**: 
           - IF a specific Camera Shot (e.g., Waist Shot) is requested in the prompt, YOU MUST ZOOM IN/OUT within this environment.
           - DO NOT just copy the reference's framing if it conflicts with the [CAMERA] instruction.
           - Example: If Reference is Wide Room but Prompt is "Waist Shot", draw the character from waist up with the blurred room background behind them.
      `);let k="";u&&u.length>0&&(k=`
        [VISUAL ANCHOR - PROPS/OBJECTS]
        The provided additional images are IMPORTANT OBJECTS (Props) that must appear in the scene.
        1. **INTEGRATION**: Include these objects in the scene naturally as described in the script.
        2. **APPEARANCE**: Maintain their visual appearance (color, shape, details) as shown in the reference images.
        3. **INTERACTION**: If the character is interacting with them (holding, looking at), ensure realistic interaction.
      `);const j=`
    [ACTING & EYE CONTACT RULES - ABSOLUTE PRIORITY]
    1. **NO EYE CONTACT WITH CAMERA**: 
       - The character MUST NOT look at the viewer/lens.
       - This is a movie scene, NOT a portrait photo.
       - **PENALTY**: If the character looks at the camera, the image is ruined.
    
    2. **IMMERSIVE ACTING GUIDE (METHOD ACTING)**:
       - **DIRECTOR'S NOTE**: "Cut! Don't look at the lens! Feel the emotion!"
        - **Focus on the Scene**: The character must be completely absorbed in the situation.
        - **Dialogue**: Look at the *Other Person* (or empty space where they would be). **NEVER** look at the camera while talking.
        - **Action**: Look at the *Object* in hand or the *Destination* of movement.
        - **Emotion**: If sad, look down or away. If angry, glare at the target. If thinking, look into the distance.
        - **Interaction**: If there is another character, LOCK EYES with them.
        - **NATURAL MOVEMENT**: Avoid stiff poses. Capture the "moment in between" actions.
        - It is OK if some characters are seen only from the back or side, as long as the acting and relationship between characters are clear.
        - You may show the main character from behind looking toward the landscape, enemy, or destination if it strengthens the storytelling.
    
    3. **CANDID FEEL**: Capture the moment as an invisible observer. The character should be unaware of the camera's existence.
  `,D=`
    [POSTURE & POSE RULES]
    1. **DEFAULT POSE**:
       - IF Location is OUTDOOR (Yard, Street, Forest): **MUST BE STANDING** unless script explicitly says "Sitting".
       - IF Location is INDOOR: Follow script context.
    2. **FRAMING VS POSE**:
       - **DO NOT CHANGE THE POSE** to fit the camera frame.
       - If "Waist Shot" is requested, **CROP THE IMAGE**. DO NOT make the character sit to hide their legs.
       - If the character is Standing, keep them Standing and just show the upper body.
  `,q=`
    [SPATIAL REALISM & LENS]
    1. **DO NOT SHRINK THE ROOM**: The room must remain spacious. Do not make the walls close in on the characters.
    2. **DEPTH**: Use "Depth of Field" or "Bokeh" for Close-ups/Waist Shots to separate character from background.
    3. **LENS PREFERENCE (ZOOM IN)**:
       - **DEFAULT TO TIGHT SHOTS**: Unless "Full Shot" is explicitly requested, prefer **Waist Shot** or **Bust Shot**.
       - **AVOID WIDE ANGLE**: Wide angles make characters look small and distant. Use Telephoto (85mm+) to pull them close.
       - **EMOTION FOCUS**: The face and acting are more important than the shoes.
    4. **LENS**:
       - For Waist/Bust Shots: Use **85mm or 100mm Telephoto Lens**. (Flattens features, blurs background, keeps room scale natural).
       - Avoid Wide Angle (distorts face, makes room look small/curved) unless "Full Shot" is requested.
  `,ae=`
    [STRICT ADHERENCE TO SCRIPT]
    - **NO HALLUCINATION**: Do NOT add any details, objects, or actions that are NOT explicitly mentioned in the user's prompt/script.
    - **ONLY WHAT IS WRITTEN**: If the script does not describe it, do not generate it.

    [HANBOK CLOTHING RULE - STRICT]
    - **DEFAULT**: Character MUST wear the FULL HANBOK set as shown in the Reference Image.
    - **NO UNDRESSING**: Do NOT remove layers unless the script EXPLICITLY says "Undress" or "Remove Clothes".
    - **SLEEPING/LYING DOWN**: Even when sleeping or lying down, **KEEP THE CLOTHES ON**. Do not change into sleepwear/underwear automatically.
    - **NO TRANSPARENCY**: The skirt (Chima) and Jacket (Jeogori) are **SOLID OPAQUE FABRIC**. DO NOT make them see-through.
    - **SKIRT LENGTH (CRITICAL)**:
       - Women's Skirt (Chima) MUST be **FLOOR LENGTH**.
       - It must cover the Ankles and part of the Shoes.
       - **NEVER** generate short skirts (knee-length or calf-length).
       - **NEGATIVE PROMPT**: Short skirt, Mini skirt, Modern Hanbok skirt, Calf length skirt, Visible ankles.
    - **NEGATIVE PROMPT**: See-through clothes, Transparent fabric, Lingerie, Underwear only, Modern sleepwear, Nudity.
    
    [SPECIAL EXCEPTION: IF USER EXPLICITLY REQUESTS "UNDRESS/UNDERWEAR/SOKJEOKSAM"]
    - Only IF the prompt specifically asks for "Sokjeoksam" or "Underwear":
      1. Top (Jeogori) can be white/sheer.
      2. **BOTTOM (CHIMA) MUST BE SOLID OPAQUE**: The skirt must NEVER be transparent. It must cover the legs completely and solidly.
      3. **NO NUDITY**: No sensitive body parts visible.
  `;let P="",W="";e.includes("[CAMERA]")&&(e.includes("Waist Shot")||e.includes("ws")?W=`
            [ABSOLUTE FRAMING RULE: WAIST SHOT] 
            1. **ZOOM / CROP**: The framing MUST be a **CLOSE-UP from Head to Waist**.
            2. **FILL THE SCREEN**: The Character's Head and Torso MUST FILL the vertical space of the 16:9 frame.
            3. **CUT OFF**: The bottom of the frame MUST CUT OFF at the Belt/Waist line. **DO NOT SHOW LEGS**.
            4. **HEIGHT DIFFERENCE**: If characters have different heights, **CROP TO THE SHORTER PERSON'S WAIST**. Ensure the shorter person's head is fully visible.
            5. **POSTURE**: **SITTING IS ALLOWED**. If sitting, the camera zooms in to the upper body only.
            6. **NEGATIVE PROMPT**: Full body, Distant shot, Small character, Showing legs, Showing shoes.
            7. **BACKGROUND PRIORITY**: **LOW**. The Character Framing is PRIORITIZED over showing the background location (e.g. Maru/Room). It is okay if the background is cropped or blurry. DO NOT ZOOM OUT to show the architecture.
            8. **MANDATORY**: IF the generated image shows the character's KNEES or FEET, IT IS A FAILURE. REGENERATE closer.
          `:e.includes("Bust Shot")||e.includes("bs")||e.includes("Close Up")||e.includes("cu")?W=`
            [ABSOLUTE FRAMING RULE: BUST SHOT / CLOSE UP] 
            1. **EXTREME ZOOM**: The framing is TIGHT on the Face and Shoulders.
            2. **FILL THE SCREEN**: The Face and Shoulders MUST DOMINATE the frame (80% of screen).
            3. **CUT OFF**: The bottom of the frame MUST CUT OFF at the Chest/Armpits. **DO NOT SHOW WAIST**.
            4. **HEIGHT DIFFERENCE**: If characters have different heights, **CROP TO THE SHORTER PERSON'S CHEST**. Ensure the shorter person's face is fully visible.
            5. **POSTURE**: **SITTING IS ALLOWED**. Even if sitting, we only see the face.
            6. **NEGATIVE PROMPT**: Waist, Stomach, Belt, Hands (unless gesture), Full body, Distant shot.
            7. **BACKGROUND PRIORITY**: **LOW**. The Character Framing is PRIORITIZED over showing the background location (e.g. Maru/Room). It is okay if the background is cropped or blurry. DO NOT ZOOM OUT to show the architecture.
            8. **OVER-THE-SHOULDER RULE**: If the prompt specifies "Speaker" or "OTS", **CROP TO THE SPEAKER**. The Listener (shoulder) is just a framing device and can be cut off or blurred. Focus on the Speaker's face/bust.
            9. **MANDATORY**: IF the generated image shows the character's WAIST or BELT, IT IS A FAILURE. REGENERATE closer.
          `:e.includes("Knee Shot")||e.includes("mls")?W=`
            [ABSOLUTE FRAMING RULE: KNEE SHOT (Medium Long)] 
            1. **ZOOM**: The framing is from Head to Knees.
            2. **FILL THE SCREEN**: The Character (Head to Knees) MUST FILL the vertical space.
            3. **CUT OFF**: The bottom of the frame MUST CUT OFF at the Knees/Thighs. **DO NOT SHOW FEET**.
            4. **POSTURE**: **SITTING IS ALLOWED**. If sitting, show the character from Head to Knees.
            5. **NEGATIVE PROMPT**: Feet, Shoes, Ground at feet, Full body, Distant shot.
            6. **BACKGROUND PRIORITY**: **LOW**. The Character Framing is PRIORITIZED over showing the background location (e.g. Maru/Room).
               - Match the background perspective to the **CHARACTER'S EYE/KNEE LEVEL**.
               - It is okay if the background is cropped or blurry. **DO NOT ZOOM OUT** just to show the floor or roof.
            7. **MANDATORY**: IF the generated image shows the character's SHOES, IT IS A FAILURE. REGENERATE closer.
          `:(e.includes("Full Shot")||e.includes("full"))&&(W=`
            [ABSOLUTE FRAMING RULE: FULL SHOT]
            1. **WIDE ANGLE**: Show the ENTIRE BODY from Head to Toe.
            2. **SPACE**: Leave some space above the head and below the feet.
            3. **POSTURE**: **SITTING IS ALLOWED**. Show the full pose including legs and feet.
            4. **NEGATIVE PROMPT**: Cut off feet, Cut off head, Close up, Waist shot.
            5. **MANDATORY**: IF the generated image cuts off the FEET or HEAD, IT IS A FAILURE. ZOOM OUT.
          `));let C="";h&&(C=`
        [VISUAL ANCHOR - MASTER SCENE LOCATION & CHARACTERS]
        The provided first image is the **ACTUAL FILM SET** and **ACTORS**.
        
        [CRITICAL SPATIAL RULES - 3D WORLD EXTENSION]
        1. **IMMUTABLE WORLD**: The walls, floor, furniture, lighting, and atmosphere are **FIXED REALITY**.
        2. **CAMERA WORK ONLY**: You are a cameraman inside this specific room. You can ONLY change the Camera Angle, Lens, and Distance.
        3. **EXTEND THE SPACE**: 
           - Treat the image as a viewport into a full 3D room.
           - If the camera rotates to show a part NOT visible in the reference, **INFER** the environment based on the visible parts.
           - **CONTINUITY**: The unseen wall must match the style of the seen wall. The floor pattern must continue.
           - **DO NOT** invent a completely different style for the unseen areas.
        4. **PERSPECTIVE SHIFT**:
           - If prompt says "Side View", show THIS SAME ROOM from the side.
           - If prompt says "Reverse Shot", show the other side of THIS SAME ROOM.
           
        [CHARACTER CONSISTENCY & ACTING PRIORITY]
        1. **IDENTITY (KEEP)**: The characters MUST look like the same people (Same Face, Same Hair, Same Clothes).
        2. **ACTING (CHANGE - CRITICAL)**: 
           - **DO NOT COPY THE POSE** from the reference image.
           - You MUST change the Pose, Gesture, and Facial Expression to match the NEW PROMPT.
           - If the prompt says "Surprised", they MUST look surprised, even if the reference image is "Calm".
           - **DYNAMIC MOVEMENT**: The character is ALIVE. Make them move!
           - **FAILURE CONDITION**: If the output looks exactly like the reference image with no change in acting, IT IS A FAILURE.
      `),P=`
    [SYSTEM INSTRUCTION: IMAGE EDITING & FRAMING MODE]
    ${C}
    ${W}
    
    [ORIGINAL SCENE CONTEXT]
    ${x}
    ${g}
    ${Cm}
    ${ae}
    
    [INDOOR ETIQUETTE RULE - AUTOMATIC DETECTION]
    - IF the scene is INDOORS (Room, Maru, Daecheng, Naesil):
      1. **NO SHOES ON FEET**: Character MUST be barefoot or wearing white socks (Beoseon).
      2. **SHOES LOCATION**: **The shoes are left OUTSIDE on the ground (shoe stone).**
         - **CRITICAL**: DO NOT draw shoes next to the character. DO NOT draw shoes on the wooden floor/mat.
         - The shoes are NOT in the frame.
      3. **NO OUTDOOR HATS**: Remove Gat, Satgat, Paeraengi. Allowed: Tanggeon, Jeongjagwan, Manggeon, Binyeo.
      4. **NEGATIVE PROMPT**: Shoes inside, Boots inside, Sandals inside, Gat inside, Satgat inside, Shoes on floor, Shoes next to person.
  
    ${I}
    ${R}
    ${k}
    ${T}
    ${j}
    ${D}

    [SCENE GENERATION PROMPT]
    ${w}
    
    ${q}
    
    [FINAL CHECK]
    - DID YOU CROP THE IMAGE AS REQUESTED?
    - Is the framing correct (Waist/Bust/CloseUp)?
    - Is the background consistent with the Master Image?
  `;const ce=[];if(a&&!h){const ee=a.match(/^data:(.+);base64,(.+)$/);ee&&ce.push({inlineData:{mimeType:ee[1],data:ee[2]}})}if(h){const ee=h.match(/^data:(.+);base64,(.+)$/);ee&&ce.push({inlineData:{mimeType:ee[1],data:ee[2]}})}_.length>0&&(o==="character"||o==="cinematic")&&_.forEach(ee=>{const O=ee.match(/^data:(.+);base64,(.+)$/);O&&ce.push({inlineData:{mimeType:O[1],data:O[2]}})}),u&&u.length>0&&u.forEach(ee=>{const O=ee.match(/^data:(.+);base64,(.+)$/);O&&ce.push({inlineData:{mimeType:O[1],data:O[2]}})}),ce.push({text:P});try{const ee=await wm(m,ce,v);for(const O of((K=(J=(X=ee.candidates)==null?void 0:X[0])==null?void 0:J.content)==null?void 0:K.parts)||[])if(O.inlineData)return`data:${O.inlineData.mimeType};base64,${O.inlineData.data}`;throw new Error("  .")}catch(ee){console.error(ee);const O=String((ee==null?void 0:ee.message)||"");if(Sm(ee))try{return await bC(t,e,n,r,o,i,a,u)}catch(fe){console.error("Fallback image generation failed",fe)}throw O.includes("SAFETY")?new Error("  :   ."):new Error("    .")}},bC=async(t,e,n,r="16:9",o="background",i,s,a)=>{var y,x,T;const u=it(t),c=Vr[n].prompt,p={aspectRatio:r||"16:9"};let m=e;e&&/[-]/.test(e)&&(m=await Fn(u,e));const g=Array.isArray(i)?i:i?[i]:[],E=`
    ${c}
    ${m}
  `,v=[];if(s){const I=s.match(/^data:(.+);base64,(.+)$/);I&&v.push({inlineData:{mimeType:I[1],data:I[2]}})}g.length>0&&(o==="character"||o==="cinematic")&&g.forEach(I=>{const _=I.match(/^data:(.+);base64,(.+)$/);_&&v.push({inlineData:{mimeType:_[1],data:_[2]}})}),a&&a.length>0&&a.forEach(I=>{const _=I.match(/^data:(.+);base64,(.+)$/);_&&v.push({inlineData:{mimeType:_[1],data:_[2]}})}),v.push({text:E});const w=await wm(u,v,p);for(const I of((T=(x=(y=w.candidates)==null?void 0:y[0])==null?void 0:x.content)==null?void 0:T.parts)||[])if(I.inlineData)return`data:${I.inlineData.mimeType};base64,${I.inlineData.data}`;throw new Error("  .")},Fn=async(t,e)=>{var n;if(!e||!/[-]/.test(e))return e;try{return((n=(await t.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:`Translate the following Korean text to English for an image generation prompt. Keep it concise and descriptive. Text: "${e}"`}]}})).text)==null?void 0:n.trim())||e}catch(r){return console.error("Translation failed, using original text:",r),e}},AC=async(t,e,n,r,o)=>{var c,h,p,m;const i=it(t),s=await Fn(i,n);let u=`
    ${Vr[r].prompt}
    CONTEXT: Korea, Joseon Dynasty.
    TASK: Generate a high-quality visual reference for a specific OBJECT/PROP.
    
    OBJECT NAME: ${e}
    VISUAL DESCRIPTION: ${s}
    
    [RULES]
    1. Single Object isolated on a clean, simple background (or solid color).
    2. Focus on the object details.
    3. Historical accuracy for Joseon Dynasty.
    4. NO text, NO watermarks, NO user interface elements.
    5. High resolution, clear definition.
  `;o&&(u+=`
      [REFERENCE IMAGE PROVIDED]
      - Use the provided image as a strict visual reference for SHAPE, COLOR, and MATERIAL.
      - Copy the structure and design of the object in the reference image.
      - Apply the Joseon Dynasty context if necessary, but keep the core look from the reference.
      `);try{const g=[];if(o){const v=o.match(/^data:(.+);base64,(.+)$/);v&&g.push({inlineData:{mimeType:v[1],data:v[2]}})}g.push({text:u});const E=await i.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:g},config:{imageConfig:{aspectRatio:"1:1"}}});for(const v of((p=(h=(c=E.candidates)==null?void 0:c[0])==null?void 0:h.content)==null?void 0:p.parts)||[])if(v.inlineData)return`data:${v.inlineData.mimeType};base64,${v.inlineData.data}`;throw new Error("  .")}catch(g){throw console.error(g),(m=g.message)!=null&&m.includes("SAFETY")?new Error("  :   ."):new Error("     .")}},RC=async(t,e,n,r,o,i)=>{var R,k,j,D,q,ae,P,W,C,G,ce,X,J,K,ee;const s=it(t),a={...e};for(const O in a)typeof a[O]=="string"&&(a[O]=await Fn(s,a[O]));const u=await Fn(s,r||""),c=Vr[n].prompt,h=Object.entries(a).map(([O,V])=>V?`${O}: ${V}`:"").filter(Boolean).join(`
- `),p=(R=e.backgroundColor)!=null&&R.includes("Green")?"Solid Green Screen (#00FF00)":"Solid Background";let m="";["Peasant","Commoner","Slave","Servant","Beggar","Bandit","Farm","Rough"].some(O=>{var V;return(V=a.class)==null?void 0:V.toLowerCase().includes(O.toLowerCase())})?m=`
      [CLASS RESTRICTION: LOWER CLASS / COMMONER]
      - **FABRIC**: MUST be Rough Cotton, Hemp, or Linen. **ABSOLUTELY NO SILK**.
      - **TEXTURE**: Coarse texture, matte finish. **NO SHINY SATIN**.
      - **COLORS**: White, Off-white, Beige, Brown, Faded colors. **NO VIBRANT GOLD/RED/BLUE**.
      - **DECORATION**: **NO EMBROIDERY**, NO Gold patterns, NO Dragon designs.
      - **CLOTHES**: Simple Jeogori and Baji. **NO DOPO (Nobleman Robe)**, **NO GAT (Nobleman Hat)** unless specified.
      - **VIBE**: Modest, humble, hardworking, or rough. NOT wealthy or noble.
      `:["Seonbi","Scholar","Yangban","Noble","Official"].some(fe=>{var se;return(se=a.class)==null?void 0:se.toLowerCase().includes(fe.toLowerCase())})&&(m=`
          [CLASS RESTRICTION: SEONBI / YANGBAN (NOBLE SCHOLAR)]
          - **INNER WEAR (Sok-jeogori)**: MUST BE PURE WHITE.
            - The collar and inner layers visible at the neck MUST BE WHITE.
          - **PANTS (Baji)**: MUST BE PURE WHITE.
            - Even if the outer robe (Dopo) is colored (Blue, Pink, Jade), the PANTS sticking out at the bottom MUST BE WHITE.
            - **ABSOLUTELY NO COLORED PANTS**.
          - **SOCKS (Beoseon)**: MUST BE WHITE.
          - **OUTER ROBE (Dopo)**: Can be colored (Jade, Blue, Grey, Pink, etc) or White.
          - **NEGATIVE PROMPT**: Colored pants, Patterned pants, Black pants, Red pants, Blue pants (unless official uniform), Colored inner collar.
          `),(k=a.gender)!=null&&k.toLowerCase().includes("male")||((j=a.gender)==null||j.includes("")),(D=a.gender)!=null&&D.toLowerCase().includes("boy")||(q=a.gender)!=null&&q.toLowerCase().includes("child")||((ae=a.gender)==null||ae.toLowerCase().includes("kid")),a.hair&&a.hair!=="None"&&a.hair.length>5,(P=a.hair)!=null&&P.includes("Half-tied Long Hair"),(W=a.hair)!=null&&W.includes("Shaggy Dog Hair")||(C=a.hair)!=null&&C.includes("Deobeok")||(G=a.hair)!=null&&G.includes("Gakseori");const v=u?`
  [USER RESTRICTIONS - ABSOLUTE PRIORITY]
  DO NOT DRAW: ${u}.
  If the user says "No Hairpin", REMOVE ALL HAIRPINS.
  If the user says "No Hat", REMOVE ALL HATS.
  `:"";let w="";const y=(ce=a.gender)==null?void 0:ce.match(/(\d+)\s*year\s*old/i);if(y){const O=parseInt(y[1]);w=`
     [AGE CONTROL: ${O} YEARS OLD]
     - The character MUST look exactly ${O} years old.
     `,O<12?w+=`- VISUALS: Childlike proportions, round face, soft features, short stature.
`:O<20?w+=`- VISUALS: Youthful teenager, fresh skin, no wrinkles.
`:O>=60?w+=`- VISUALS: Visible WRINKLES, aged skin texture, grey/white hair (unless dyed), wise/tired eyes.
- DO NOT make them look like a young K-pop star with grey hair. They must have OLD SKIN.
`:O>=40&&(w+=`- VISUALS: Mature adult, slight laugh lines, confident bearing. Not a 20-year-old.
`)}const x=a.top==="None"&&a.bottom==="None";let T="";x&&(m="",T=`
      [PURE ANIMAL / SPIRIT MODE]
      - **NO CLOTHES**: The character is a pure animal or nature spirit in its true form.
      - **BODY**: Full animal body (if animal race) or nude/covered in fur/elements (if spirit).
      - **POSE**: Natural animal pose (Quadruped / Four legs on ground) if it is an animal (Tiger, Dog, Cow, etc).
      - **REMOVE HANBOK**: Do NOT draw any Hanbok, Jeogori, or Hats.
      - **NEGATIVE PROMPT**: Clothes, Fabric, Hat, Shoes, Human items, Standing on two legs, Anthropomorphic, Human-like pose, Hands.
      `);let I="";if(o){const O=i||{face:!0,hair:!0,clothes:!0,headwear:!0,shoes:!0},V=[];O.face?V.push("- **FACE (COPY)**: Clone the facial features, age, and vibe from the reference image."):V.push("- **FACE (NEW)**: **DO NOT COPY THE FACE**. Create a NEW original face based on the prompt text."),O.hair?V.push("- **HAIR (COPY)**: Copy the hairstyle, length, and texture from the reference."):V.push("- **HAIR (NEW)**: Ignore the reference hair. Follow the text description."),O.headwear?V.push("- **HEADWEAR (COPY)**: Copy the hat or headpiece from the reference."):V.push("- **HEADWEAR (NEW)**: Ignore the reference hat. Follow the text description."),O.clothes?V.push("- **CLOTHING (COPY)**: Copy the outfit style, layers, and fabric from the reference."):V.push("- **CLOTHING (NEW)**: Ignore the reference outfit. Follow the text description."),O.shoes?V.push("- **SHOES (COPY)**: Copy the shoes from the reference (UNLESS text explicitly says otherwise)."):V.push("- **SHOES (NEW)**: Ignore the reference shoes. Follow the text description."),I=`
      [CRITICAL: REFERENCE IMAGE GUIDANCE - SELECTIVE CLONING]
      The user provided a reference image. Follow these SELECTIVE rules strictly:
      ${V.join(`
`)}
      `}const _=`
    Generate a Character Reference Sheet (Front View).
    
    [ART STYLE]
    ${c}
    
    [CHARACTER DESIGN]
    ${h}
    ${m}
    ${T}
    
    [CLOTHING CUSTOMIZATION PRIORITY]
    - **IF 'extraDetails' or 'clothingColor' mentions specific sleeve lengths (e.g., 'short sleeve', 'half sleeve')**:
      - YOU MUST OBEY THE CUSTOM SLEEVE LENGTH.
      - OVERRIDE historical defaults.
      - "Half-sleeve Dopo" -> Draw a LONG ROBE (Coat).
        - **LENGTH**: Must reach BELOW THE KNEES. It is a COAT, not a shirt.
        - **SLEEVES**: **EXTREMELY SHORT CAP SLEEVES**.
          - They should just barely cover the shoulder joint.
          - Ends exactly at the shoulder-armpit line.
          - Just slightly longer than a sleeveless vest.
      - **FIT INSTRUCTION**: The sleeve opening must be **LOOSE ENOUGH** to comfortably fit the inner wear (Jeogori) without squeezing. It should NOT be tight/elastic, but also NOT excessively fluttering like a flag. Just a clean, wide cut.
      - **MUST HAVE WAIST CORD (SuldAe)**: The robe must be tied at the waist with a cord or sash.
      - **LAYERED LOOK**: Show the inner long-sleeved shirt (Jeogori) under the short outer sleeves if applicable, or bare arms if "Summer/Muscular".
      - "Vest" -> No sleeves.

    [BACKGROUND]
    ${p}
    
    ${I}

    [COMPOSITION]
    - Full body shot or Knee-up shot.
    - Neutral lighting.
    - Clean background for easy masking.
    - **High Quality, Detailed Face and Costume.**
    
    [QUALITY STANDARDS]
    - **Resolution**: 8k, Ultra High Definition.
    - **Detail**: Intricate details on Hanbok embroidery, hair texture, and skin.
    - **Style**: Adhere strictly to the [ART STYLE] defined above.
    
    ${v}
    ${w}
  `;try{const O=[];if(o){const fe=o.match(/^data:(.+);base64,(.+)$/);fe&&O.push({inlineData:{mimeType:fe[1],data:fe[2]}})}O.push({text:_});const V=await s.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:O},config:{imageConfig:{aspectRatio:"9:16"}}});for(const fe of((K=(J=(X=V.candidates)==null?void 0:X[0])==null?void 0:J.content)==null?void 0:K.parts)||[])if(fe.inlineData)return`data:${fe.inlineData.mimeType};base64,${fe.inlineData.data}`;throw new Error("  .")}catch(O){throw(ee=O.message)!=null&&ee.includes("SAFETY")?new Error("  ."):new Error("  .")}},kC=async(t,e,n)=>{const r=it(t),o=`
      Analyze the character "${e}" from the script context below.
      Extract visual details for a character design sheet.
      
      [CRITICAL: STATIC PORTRAIT RULE]
      - **IGNORE ACTIONS**: If the script says "He is running", "She is eating", "Covering face with fan" -> IGNORE IT.
      - **EXTRACT ONLY**: Physical appearance, Clothing, Hairstyle, Age, Social Class.
      - **NEVER** include temporary states like "Hand on face", "Mouth open", "Crying", "Running".
      - **GOAL**: Create a neutral "ID Photo" or "Character Sheet" description.

      [GENDER INFERENCE RULES]
      - **NAME HINTS**: '' (Grandma) -> Female, '' (Grandpa) -> Male, '' (Lady) -> Female, '' (Young Master) -> Male.
      - **AMBIGUOUS TERMS**: '' (Nochin) -> Usually means 'Elderly Mother' (Female) in folktales, but check context. If called "Father", then Male.
      - **CONTEXT**: If called "She", "Her", "Mother", "Sister" -> Female.
      - **DEFAULT**: If unsure, infer from social role (e.g. 'Gisaeng' -> Female, 'General' -> Male).

      [DEFAULT STYLE RULES - IF NOT MENTIONED IN SCRIPT]
      - **HAIR (MALE ADULT)**: If script doesn't specify hair, DEFAULT to "Sangtu (Topknot)".
      - **CLASS SPECIFIC (CRITICAL)**:
         - **Yangban (Nobleman)**: MUST have "Sangtu".
         - **Commoner/Peasant**: MUST have "Sangtu".
         - **Note**: Only Criminals, Beggars, or Wild Men have loose hair. Normal men wear Sangtu.
      - **HAIR (FEMALE ADULT)**: If script doesn't specify hair, DEFAULT to "Binyeo Bun (Jjok-jin)".
      - **HAIR (CHILD)**: Braided Hair (Daenggi).
      
      OUTPUT JSON:
      {
        "age": "Estimated Age (Number)",
        "gender": "Male or Female",
        "class": "Social Class (e.g., Yangban, Peasant, King)",
        "hair": "Hairstyle description",
        "headwear": "Hat/Headwear (e.g., Gat, None, Bamboo Hat)",
        "visualGuide": "Korean summary of appearance",
        "clothingColor": "Color of clothes if mentioned"
      }
      
      SCRIPT CONTEXT:
      ${n}
    `;try{const i=await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:o}]},config:{responseMimeType:"application/json"}});return Tn(i.text||"{}")}catch(i){return console.error("Character analysis failed",i),null}},PC=async(t,e,n="green")=>{var u,c,h;const r=it(t),o=e.match(/^data:(.+);base64,(.+)$/);if(!o)throw new Error("Invalid image format");const a=`
    Change the background of this image to a solid flat ${n==="green"?"Green Screen":"Solid White"} (${n==="green"?"#00FF00":"#FFFFFF"}).
    [CRITICAL RULES]
    1. **KEEP FOREGROUND EXACTLY THE SAME**: Do not change the character's face, clothes, or pose. Only change the environment behind them.
    2. The background must be a single solid color for chroma keying.
    3. High quality edges.
  `;try{const p=await r.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:o[1],data:o[2]}},{text:a}]}});for(const m of((h=(c=(u=p.candidates)==null?void 0:u[0])==null?void 0:c.content)==null?void 0:h.parts)||[])if(m.inlineData)return`data:${m.inlineData.mimeType};base64,${m.inlineData.data}`;throw new Error("  .")}catch(p){throw console.error("Bg Edit Failed",p),new Error("    .")}},MC=async(t,e)=>{var i,s,a;const n=it(t),r=e.match(/^data:(.+);base64,(.+)$/);if(!r)throw new Error("Invalid image format");const o=`
    Remove the person/character from this image completely.
    [TASK]
    1. Identify the character in the foreground.
    2. Erase the character.
    3. Inpaint (Fill) the empty space with the background texture and objects to match the surrounding environment perfectly.
    4. The result should be an empty room/landscape with NO PEOPLE.
    5. Maintain the original lighting, style, and camera angle.
  `;try{const u=await n.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:r[1],data:r[2]}},{text:o}]}});for(const c of((a=(s=(i=u.candidates)==null?void 0:i[0])==null?void 0:s.content)==null?void 0:a.parts)||[])if(c.inlineData)return`data:${c.inlineData.mimeType};base64,${c.inlineData.data}`;throw new Error("  .")}catch(u){throw console.error("Remove Char Failed",u),new Error("    .")}},LC=async(t,e,n)=>{var a,u,c;const r=it(t),o=await Fn(r,n),i=e.match(/^data:(.+);base64,(.+)$/);if(!i)throw new Error("Invalid image format");const s=`
    Modify this image based on the user's instruction.
    USER INSTRUCTION: "${o}"
    
    [RULES]
    1. Apply the change STRICTLY to the requested area.
    2. Keep the rest of the image (Face, Identity, Pose, Background) EXACTLY THE SAME unless the instruction asks to change it.
    3. High quality inpainting. Seamless blending.
    
    Example: 
    - If instruction is "Remove the hairpin", remove only the hairpin and reconstruct the hair.
    - If instruction is "Close eyes", change only the eyes.
  `;try{const h=await r.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:i[1],data:i[2]}},{text:s}]}});for(const p of((c=(u=(a=h.candidates)==null?void 0:a[0])==null?void 0:u.content)==null?void 0:c.parts)||[])if(p.inlineData)return`data:${p.inlineData.mimeType};base64,${p.inlineData.data}`;throw new Error(" .")}catch(h){throw console.error("Magic Edit Failed",h),new Error("   .")}},OC=async(t,e)=>{var o;const n=it(t),r=`
          .
       ,      "   "  .
     
     [ ]
         " ", " ", "" , AI        .
     
     [ ]
     1. ** / **: (: (99 ), (), ,  )
     2. **   **: (:   -  ,  /   -  )
     3. **  /**: (:    ,    )
     4. **  **: (: , ,      )

     [ ]
     - **  .** (     .)
     -   ( ,  ) "  "   .
     -    .
     
     SCRIPT:
     ${e.substring(0,3e4)}
   `;try{return((o=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:r}]}})).text)==null?void 0:o.trim())||""}catch(i){throw console.error("Global context analysis failed",i),new Error("  ")}},DC=async(t,e)=>{const n=it(t),r=`
       1000  **   **.
      ,          **   50** .

    [ ]
    ${e.substring(0,5e4)}

    [  - " "]
    1. ** 50**: 50    . (  )
    2. **  - "   " ()**:
        - **    .**          .
        - **   '  '   .**

        - ** A (  /  )**:      ?  "  OO , ..."
        - ** B ( /)**:       ?  "OO   , ..."
        - ** C ( /)**:        ?  "   ,   "
        - ** D ( )**:       ?  "  ,    "
        - ** E ( )**:     ?  "  ,    "

    [   (  )]
     - "   5    " (     )
     - "    , ..." (    )
     - "   ,     " ( )
     - "    ,    " ( )
     - "  ,    " (/ )
     - "   ,    ..." (/)
     - "   ,    !" (   /)
     - "  ,   ..." ( /)

    3. **  **:
       - /: "...", " "
       - : "  ?", " ?"
       - /: "  ", "  "
    4. ** **:    15 .
    5. ** **:           .

    [ ]
    **JSON   .**
    : ["1", "2", ..., "50"]
  `;try{const i=(await n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:r}]},config:{responseMimeType:"application/json"}})).text||"[]",s=Tn(i);return Array.isArray(s)?s:typeof s=="object"&&Array.isArray(s.titles)?s.titles:[]}catch(o){throw console.error("Massive hooking title generation failed",o),new Error("  : "+o.message)}},UC=async(t,e,n)=>{var i;const r=it(t),o=`
        .
     (Shot)  **   (Caption)** 1 .

    [ ]
    - : ${e}
    -  : ${n}

    [ ]
    1. ****: 15   .
    2. ****: , , ,    " ".
    3. ****:    1 . ( )
    
    :
    - " ,   "
    - "   "
    - "     "
  `;try{return((i=(await r.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:o}]}})).text)==null?void 0:i.trim())||""}catch(s){throw console.error("Trailer caption generation failed",s),new Error("  ")}},FC=async(t,e,n,r="auto")=>{const o=it(t),i=e.map(h=>`[Scene ${h.sequenceNumber}] ${h.title}: ${h.visualPrompt}`).join(`
`),s={auto:"",fast_exciting:`
      [STYLE]: Korean Traditional Folk, Pungmul, Madangnori (Pure Gugak).
      [INSTRUMENTS]: Korean hand gong (Kkwaenggwari, metallic, bright, fast attack), Korean hourglass drum (Janggu, rhythmic percussion, drum roll, sharp stick sound), Barrel drum (Buk, resonant, heartbeat, bass drum), Korean gong (Jing, deep, long decay, brassy), Korean oboe (Taepyeongso, piercing, high-pitched, loud).
      [TEMPO]: Fast & Energetic (Hwimori, Jajinmori), Excited, Bouncy, Rhythmic.
      [VOCAL]: Playful, Energetic, Spoken-style, Narrative, With Chuimsae (Eol-su, Jihwaja).
      [MIXING]: Rich and well-blended sound, warm spatial mixing, energetic percussion.
      [NOTE]: **NO WESTERN INSTRUMENTS**. No Guitar, No Brass. Pure Korean sound.
      [NOTE]: The lyrics MUST be in **Jeolla-do or Chungcheong-do Dialect (Saturi)**. Use spoken word style like Pansori Aniri.
              Examples: ",  !", ",   !", ", !".
    `,sad_sorrowful:`
      [STYLE]: Sad Sagueuk Ballad, Cinematic, Emotional Gugak.
      [INSTRUMENTS]: Korean fiddle (Haegeum, two-stringed, grainy, sorrowful, violin-like), Korean bass fiddle (Ajaeng, bowed zither, mellow, deep, cello-like), Korean bamboo flute (Daegeum, breathy, wind sound), Korean zither (Gayageum, plucked, clear).
      [TEMPO]: Slow, Flowing, Rubato, Melancholic.
      [VOCAL]: Soft Female Vocals, Breathy, Sorrowful, Tearful, Lyrical.
      [MIXING]: Soft resonance, emotional reverb, intimate, grainy texture.
    `,faint_hazy:`
      [STYLE]: Dreamy Sagueuk, Ambient, Ethereal Gugak.
      [INSTRUMENTS]: Korean bamboo flute (Daegeum, breathy, air sound), Small bamboo flute (Sogeum, clear, high-pitched), Korean mouth organ (Saenghwang, mysterious chords), Korean zither (Gayageum, plucked, soft).
      [TEMPO]: Slow, Floating, Non-rhythmic, Mystical.
      [VOCAL]: Whispering, Echoing, Mysterious, Faint.
      [MIXING]: Ethereal reverb, wide spatial mixing, dreamy atmosphere.
    `,slow_mystery:`
      [STYLE]: Korean Traditional Noir, Suspense, Dark Gugak.
      [INSTRUMENTS]: Korean bass zither (Geomungo, percussive strings, deep resonance, heavy), Korean gong (Jing, dark resonance, slow decay), Barrel drum (Buk, deep thud), Korean bass fiddle (Ajaeng, low friction sound).
      [TEMPO]: Slow tension, Heartbeat rhythm, Heavy, Suspenseful.
      [VOCAL]: Low male vocal, Spoken word, Warning tone, Monologue-style.
      [MIXING]: Dark ambience, deep bass resonance, tension.
    `,medium_story:`
      [STYLE]: Korean Folk Storytelling, Mid-tempo Gugak.
      [INSTRUMENTS]: Barrel drum (Buk, resonant), Korean hourglass drum (Janggu, rhythmic), Korean bamboo flute (Daegeum, breathy), Korean zither (Gayageum, plucked, clear).
      [TEMPO]: Medium, Walking pace, Rhythmic (Gutgeori), (90-110 BPM).
      [VOCAL]: Clear narration, Minyo style, Storytelling, Conversational, With Chuimsae.
      [MIXING]: Clear vocal focus, balanced ensemble.
      [NOTE]: Use a storytelling tone (Taryeong) with occasional Chuimsae. Dialect (Saturi) is preferred for humor.
    `,grand_epic:`
      [STYLE]: Epic Sagueuk Orchestra, War Movie OST (Pure Gugak Version).
      [INSTRUMENTS]: Korean oboe (Taepyeongso, piercing, loud), Massive Barrel Drum Ensemble (Buk, thunderous, epic), Korean gong (Jing, metallic resonance), Korean double reed pipe (Piri, strong, nasal, loud), Korean hand gong (Kkwaenggwari, accent).
      [TEMPO]: Dynamic, Marching, Grandiose, Powerful.
      [VOCAL]: Grand Chorus, Chanting, Heroic, Powerful, Theatrical.
      [MIXING]: Massive sound, wide dynamic range, cinematic impact.
      [NOTE]: **NO WESTERN BRASS/STRINGS**. Create epicness with massive Korean drum ensemble and piercing wind instruments.
    `},a={auto:"Analyze the sequence and choose the most fitting Sagueuk (Korean Historical Drama) OST style using ONLY Korean traditional instruments.",mystery:`
      [STYLE]: Korean Traditional Noir, Sagueuk OST, Cinematic.
      [INSTRUMENTS]: Korean bass zither (Geomungo, percussive strings), Korean gong (Jing, dark resonance), Korean bamboo flute (Daegeum, breathy).
      [TEMPO]: Slow tension, Heartbeat rhythm, Slow-burn.
      [VOCAL]: Whispering, Low male vocal, Minimal Vocals.
      [MIXING]: Dark ambience, deep resonance.
    `,comedy:`
      [STYLE]: Korean Folk Pop, Madangnori, Upbeat OST.
      [INSTRUMENTS]: Korean hand gong (Kkwaenggwari, metallic), Korean hourglass drum (Janggu, rhythmic), Korean oboe (Taepyeongso, piercing).
      [TEMPO]: Fast Tempo, Bouncy, Rhythmic, Marching.
      [VOCAL]: Playful, Storytelling, Pansori style narration, Spoken-style.
      [MIXING]: Bright, clear, energetic.
    `,destiny:`
      [STYLE]: Epic Sagueuk Orchestra, Cinematic, Grandiose.
      [INSTRUMENTS]: Korean bamboo flute (Daegeum, breathy), Massive Barrel Drum Ensemble (Buk), Korean double reed pipe (Piri).
      [TEMPO]: Slow build-up to Fast, Dynamic, Marching.
      [VOCAL]: Grand Chorus, Chanting, Heroic Vocals.
      [MIXING]: Wide, cinematic, majestic.
    `,tragedy:`
      [STYLE]: Sad Sagueuk Ballad, Cinematic, OST.
      [INSTRUMENTS]: Korean fiddle (Haegeum, grainy, sorrowful), Korean bass fiddle (Ajaeng, mellow), Korean zither (Gayageum, plucked).
      [TEMPO]: Slow, Flowing, Rubato.
      [VOCAL]: Soft Female Vocals, Emotional, Breathy, Sorrowful.
      [MIXING]: Intimate, emotional reverb.
    `,revenge:`
      [STYLE]: Intense Gugak, Cinematic, Driving.
      [INSTRUMENTS]: Korean bass zither (Geomungo, aggressive, percussive), Barrel drum (Buk, deep), Korean oboe (Taepyeongso, piercing).
      [TEMPO]: Fast Paced, Aggressive, Driving rhythm.
      [VOCAL]: Gritty, Powerful, Spoken-style.
      [MIXING]: Sharp, punchy, intense.
    `,despair:`
      [STYLE]: Minimalist Sagueuk, Cinematic, Ambient.
      [INSTRUMENTS]: Korean bass fiddle (Ajaeng, sorrowful, bowed), Korean bamboo flute (Daegeum, breathy), Wind Sound.
      [TEMPO]: Very Slow, Dragging, Stillness.
      [VOCAL]: Spoken word, Low humming, Mournful.
      [MIXING]: Empty space, cold atmosphere.
    `};let u="";r!=="auto"&&s[r]?u=s[r]:u=a[n]||a.auto;const c=`
    You are a professional Music Director and Lyricist for a Korean Historical Drama (Sagueuk).
    Create a **40-second Background Music (OST) prompt** for the following 5-shot opening sequence.

    [GOAL]
    The music must **SUPPORT** the video, not overpower it. It should set the perfect atmosphere.
    The lyrics should be poetic and abstract, enhancing the mood without narrating every detail.
    For 'fast_exciting', 'comedy', or 'medium_story' styles:
      - **TONE**: Use **Satire & Humor (Haehak)**.
      - **STYLE**: Use **Spoken Word / Monologue (Pansori Aniri)** style.
      - **DIALECT**: Use **Korean Dialect (Saturi)** like "", "", "~", "~".
      - **CONTENT**: Directly address the situation with wit. NOT poetic descriptions.
      - Example: "     !"

    [SEQUENCE STORY]
    ${i}

    [MUSIC STYLE GUIDE]
    ${u}

    [TASK]
    1. **Title**: A catchy, poetic title for the song (Korean).
    2. **Style of Music (English)**: A single string of English tags for Suno AI.
       - **CRITICAL**: COPY the full instrument descriptions including adjectives (e.g., "Korean hand gong, metallic, bright"). DO NOT shorten to just "Kkwaenggwari".
       - **COMBINE**: Genre + Full Instrument Descriptions + Tempo + Vocal Style + Mixing Keywords.
       - **FORMAT**: Comma-separated tags.
       - **MUST INCLUDE**: "Cinematic", "OST", "Background Music", "No Intro", "Immediate Start".
    3. **Style of Music (Korean)**: A single string of Korean tags for Suno AI.
       - **COMBINE ALL ELEMENTS**: Genre + Instruments + Tempo + Vocal Style in Korean.
       - **IMPORTANT**: For "No Intro", use English "No Intro" even in the Korean string as it works better.
       - **FORMAT**: Comma-separated tags (e.g., "   OST, , , ,  , ,  , No Intro").
    4. **Lyrics**: Korean lyrics structured for ~30 seconds (Total 40s).
       - **CRITICAL RULE 0 (NO PRELUDE)**: The song must start singing IMMEDIATELY.
       - **CRITICAL RULE 4 (LENGTH LIMIT)**: **ABSOLUTE MAXIMUM 6 LINES TOTAL**. 
         - The song is very short. Do not write a full song.
         - **Recommended Structure**: 
           [Verse] (2 lines)
           [Chorus] (2-3 lines)
           [Outro] (1 line)
       - **CRITICAL RULE 1 (NO NAMES)**: NEVER use specific character names. Use pronouns or metaphors.
       - **CRITICAL RULE 2 (NO SPOILERS)**: Do NOT describe specific plot events literally. Focus on *Atmosphere* and *Emotion*.
       - **CRITICAL RULE 3 (SUPPORTIVE)**: The lyrics should feel like a part of the soundtrack, not a separate pop song.

    [OUTPUT JSON FORMAT]
    {
      "title": "Song Title",
      "style_en": "Style Tags (English)",
      "style_ko": "Style Tags (Korean)",
      "lyrics": "[Verse]
Line 1
Line 2...

[Chorus]
Line 3..."
    }
  `;try{const p=(await o.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:c}]},config:{responseMimeType:"application/json"}})).text||"{}";return Tn(p)}catch(h){throw console.error("Suno lyrics generation failed",h),new Error("  ")}},ze={gender:[{label:"",value:"Male"},{label:"",value:"Female"}],class:[{label:" ()",value:"Seonbi (Joseon Scholar), noble, silk robes"},{label:"/",value:"Bandit, rough appearance, wild, animal skins"},{label:"/",value:"King of Joseon, Red Royal Robe (Gonryongpo)"},{label:"/",value:"Queen of Joseon, Royal ceremonial dress"},{label:"/",value:"General, Warrior, Military uniform (Cheollik)"},{label:"/",value:"Merchant, Peddler, carrying bundle on back"},{label:"",value:"Buddhist Monk, grey robes"},{label:"/",value:"Peasant, Commoner, White hemp clothes"},{label:"",value:"Gisaeng, colorful Hanbok, artistic"},{label:"",value:"Shaman (Mudang), colorful ritual clothing"},{label:"/",value:"Magistrate (Sato), Official uniform"},{label:"",value:"Grim Reaper (Jeoseung Saja), Black Hanbok, Black Gat"},{label:"/",value:"Mother figure, modest Hanbok"},{label:"/",value:"Father figure, traditional Hanbok"}],race:[{label:"",value:"Human"},{label:"",value:"Dokkaebi (Korean Goblin), holding club"},{label:"",value:"Gumiho (Nine-tailed Fox)"},{label:"",value:"Virgin Ghost (Cheonyeo Gwishin), white Sobok, messy hair"},{label:" ()",value:"Tiger Spirit, anthropomorphic"},{label:" (/)",value:"Dragon King (Turtle spirit)"},{label:" ()",value:"Animal"}],hair:[{label:" ( )",value:"Sangtu (Topknot) with Manggeon headband"},{label:" ()",value:"Daenggi-meori (Long Braid)"},{label:"  ()",value:"Half-tied hair with Manggeon ( )"},{label:" (//)",value:"Half-tied Long Hair (Ban-mukkeum), top half tied back, bottom half loose flowing down, long straight hair"},{label:" (/)",value:"Half-tied hair (No Manggeon), wild style"},{label:"  (/)",value:"Short Bob Hair (Danbal), rough cut"},{label:" (/)",value:"Shaggy Dog Hair (Gakseori Style), messy shoulder-length hair, tied with a thin string (Not headband) across forehead to keep hair off face, rough texture"},{label:"   ()",value:"Binyeo Bun (Low bun with silver hairpin)"},{label:"  ()",value:"Grey hair Sangtu (Topknot)"},{label:"   ()",value:"Grey hair Binyeo Bun"},{label:"  ()",value:"Gisaeng Gache (Large ornate wig)"},{label:"/ ",value:"Court Lady Gache (Rounded wig)"},{label:" ()",value:"Daesu-meori (Royal ceremonial wig with gold)"},{label:"  (/)",value:"Loose long black hair"},{label:" ()",value:"Wild messy hair"}],headwear:[{label:" ",value:"None"},{label:" (  )",value:"Gat (Black translucent horsehair hat)"},{label:" ()",value:"Jeongjagwan (Indoor scholar hat)"},{label:" ()",value:"Paeraengi (Bamboo hat)"},{label:" ()",value:"Jeonrip (Military hat with peacock feather)"},{label:" ()",value:"Ikseongwan (King black cap)"},{label:" ()",value:"Samo (Official black cap with wings)"},{label:" ( )",value:"Jokduri (Wedding headpiece)"},{label:" ()",value:"Jeonmo (Wide hat with butterfly decorations)"},{label:" ()",value:"Satgat (Conical straw hat)"},{label:" ()",value:"Nambawi (Winter cap)"}],outer:[{label:"  ()",value:"None"},{label:"  ( )",value:"Half-sleeve Dopo (Long Coat, Knee-length, Cap Sleeves just covering shoulders, slightly longer than Vest)"},{label:" (/)",value:"Dopo (Scholar Robe with wide sleeves, tied with waist cord)"},{label:"",value:"Durumagi (Overcoat)"},{label:" ()",value:"Cheollik (Military Robe with pleated skirt)"},{label:"/",value:"Kwaeja (Long Vest)"},{label:" ( )",value:"Jangot (Coat worn over head)"},{label:"/ ()",value:"Hwarot/Wonsam (Ceremonial Robe)"},{label:" ()",value:"Sobok (White mourning clothes)"}],top:[{label:" ",value:"Jeogori (Traditional Jacket, curved sleeves)"},{label:" ",value:"Samhwejang Jeogori (Colorful cuffs and collar)"},{label:" ",value:"Saekdong Jeogori (Striped sleeves)"},{label:" ( )",value:"Jeoksam (Hemp shirt)"},{label:"  (/)",value:"None"}],bottom:[{label:"  ()",value:"Baji (Wide trousers tied at ankles)"},{label:"  ()",value:"Chima (Full volume Floor-length skirt, covering ankles and feet, showing only toe of shoes)"},{label:" ()",value:"Seuran-chima (Floor-length Skirt with gold leaf pattern, covering ankles)"},{label:" ( )",value:"Short Chima (Working class)"},{label:"  (/)",value:"None"}],shoes:[{label:" ( )",value:"Jipsin (Simple woven straw shoes, flat sole, covering toes, rounded front)"},{label:" ()",value:"Taasahye (Leather shoes with patterns)"},{label:" ( )",value:"Mokhwa (Black velvet boots)"},{label:" ()",value:"Kkot-sin (Flower embroidered shoes)"},{label:"",value:"Barefoot"}],accessories:[{label:"",value:"None"},{label:" ()",value:"Gombangdae (Long pipe)"},{label:"",value:"Foldable Fan"},{label:" ()",value:"Hwando (Korean Sword)"},{label:" ()",value:"Cloth Bundle/Backpack (Bojim)"},{label:"",value:"Bokjumeoni (Lucky pouch)"},{label:"",value:"Norigae (Pendant)"},{label:"",value:"Eunjangdo (Silver knife)"},{label:"",value:"Wooden Walking Stick"}],bg:[{label:"  (Green)",value:"Green Screen"},{label:"  (Blue)",value:"Blue Screen"},{label:" ",value:"Solid White"},{label:" ",value:"Solid Black"}]},GC=({onClose:t,initialName:e="",initialDesign:n,initialAge:r="30",initialReferenceImage:o,editCharacterId:i})=>{const{apiKey:s,selectedStyle:a,setReferenceImages:u,setCharacters:c,showToast:h,characters:p,script:m,scriptSegments:g}=Zt(),[E,v]=de.useState(e),[w,y]=de.useState(r),[x,T]=de.useState(""),[I,_]=de.useState([]),[R,k]=de.useState(!1),[j,D]=de.useState(!1),[q,ae]=de.useState({});de.useEffect(()=>{try{const z=localStorage.getItem("sintong_custom_options");z&&ae(JSON.parse(z))}catch(z){console.error("Failed to load custom options",z)}},[]);const P=(z,$)=>{const A=window.prompt(`[${$}]    :
(:  , ,   )`);if(!A||!A.trim())return;const b=A.trim();ae(U=>{const Q=U[z]||[];if(Q.some(Y=>Y.value===b))return h("  .","warning"),U;const ne={...U,[z]:[...Q,{label:b+" ( )",value:b}]};return localStorage.setItem("sintong_custom_options",JSON.stringify(ne)),ne}),Ue(z,b),h(`'${b}'  .`,"success")},W=(z,$)=>{var A,b;window.confirm("   ?")&&(ae(U=>{const ne=(U[z]||[]).filter(te=>te.value!==$),Y={...U,[z]:ne};return localStorage.setItem("sintong_custom_options",JSON.stringify(Y)),Y}),G[z]===$&&Ue(z,((b=(A=ze[z])==null?void 0:A[0])==null?void 0:b.value)||"None"),h(" .","success"))},C=()=>{window.confirm(`       ?
(   )`)&&(ae({}),localStorage.removeItem("sintong_custom_options"),ce(z=>{const $={...z},A={bg:"backgroundColor"};return Object.keys(ze).forEach(b=>{const U=A[b]||b,Q=ze[b].map(Y=>Y.value),ne=$[U];ne&&!Q.includes(ne)&&($[U]=ze[b][0].value)}),$}),h("    .","success"))},[G,ce]=de.useState({gender:(n==null?void 0:n.gender)||ze.gender[0].value,class:(n==null?void 0:n.class)||ze.class[0].value,race:(n==null?void 0:n.race)||ze.race[0].value,hair:(n==null?void 0:n.hair)||ze.hair[0].value,headwear:(n==null?void 0:n.headwear)||ze.headwear[0].value,outer:(n==null?void 0:n.outer)||ze.outer[0].value,top:(n==null?void 0:n.top)||ze.top[0].value,bottom:(n==null?void 0:n.bottom)||ze.bottom[0].value,shoes:(n==null?void 0:n.shoes)||ze.shoes[0].value,accessories:(n==null?void 0:n.accessories)||ze.accessories[0].value,clothingColor:(n==null?void 0:n.clothingColor)||"",backgroundColor:ze.bg[0].value,extraDetails:(n==null?void 0:n.extraDetails)||""}),[X,J]=de.useState(!1),[K,ee]=de.useState(!1),[O,V]=de.useState(o||null),[fe,se]=de.useState(null),[le,xe]=de.useState({face:!0,hair:!0,clothes:!0,headwear:!0,shoes:!0});de.useEffect(()=>{o&&(se(o),V(o),xe({face:!0,hair:!0,clothes:!0,headwear:!0,shoes:!0}))},[o]);const[Ie,Ne]=de.useState([]);de.useEffect(()=>{const z=p.map(te=>te.name),$=m+g.map(te=>te.content).join(`
`),A=/[\[]([^\]]+)[\]]|([-]{2,4})[\s]*[:]/g,b=new Set,U=["","","","","","","","","","","","","","Scene","Chapter","Prologue","Epilogue","Time","Place"];let Q,ne=0;for(;(Q=A.exec($))!==null&&(ne++,!(ne>5e3));){const te=Q[1]||Q[2];te&&te.length<10&&(U.some(ue=>te.includes(ue))||/\d/.test(te)||b.add(te))}const Y=Array.from(new Set([...z,...Array.from(b)]));_(Y.filter(te=>!U.includes(te)))},[p,m,g]);const ke=async z=>{if(!s)return h("API  .","warning");v(z),k(!0),h(`${z}    ...`,"success");try{const $=m+g.map(Q=>Q.content).join(`
`),A=$.indexOf(z),b=A!==-1?$.substring(Math.max(0,A-1e3),Math.min($.length,A+1e3)):$.substring(0,2e3),U=await kC(s,z,b);if(U){y(U.age);const Q={Peasant:"/",Commoner:"/",Farmer:"/",Noble:" ()",Scholar:" ()",Yangban:" ()",King:"/",Royal:"/",Queen:"/",General:"/",Warrior:"/",Soldier:"/",Merchant:"/",Peddler:"/",Monk:"","Buddhist Monk":"",Gisaeng:"",Shaman:"",Magistrate:"/",Official:"/","Grim Reaper":"",Mother:"/",Father:"/",Bandit:"/",Thief:"/","Not mentioned":"/"},ne={Topknot:" ( )",Sangtu:" ( )",Braid:" ()",Daenggi:" ()",Bun:"   ()",Binyeo:"   ()","Half-tied Long":" (//)","Young Master":" (//)",Doryeong:" (//)",Short:"  (/)",Bob:"  (/)",Messy:" (/)",Grey:"  ()",White:"  ()",Gache:"  ()",Loose:"  (/)",Wild:" ()","Not mentioned":" ( )"},Y={None:" ","No hat":" ",Gat:" (  )",Hat:" (  )","Bamboo Hat":" ()",Paeraengi:" ()",Satgat:" ()","Straw Hat":" ()",Jeonrip:" ()",Ikseongwan:" ()",Samo:" ()",Jokduri:" ( )",Jeonmo:" ()","Winter Cap":" ()",Nambawi:" ()","Not mentioned":" "},te=(ie,ue)=>{if(!ie)return"";if(ue[ie])return ue[ie];const Ee=ie.toLowerCase(),Le=Object.keys(ue).find(Be=>Be.toLowerCase()===Ee);if(Le)return ue[Le];const be=Object.keys(ue).find(Be=>Ee.includes(Be.toLowerCase()));return be?ue[be]:ie};ce(ie=>{let ue=U.gender||ie.gender;(U.gender==="Female"||U.gender==="Woman"||U.gender==="Girl")&&(ue="Female"),(U.gender==="Male"||U.gender==="Man"||U.gender==="Boy")&&(ue="Male");let Ee=ie.bottom;return ue==="Female"&&(!ie.bottom||ie.bottom.includes("Baji"))?Ee="Chima (Full volume Floor-length skirt, covering ankles and feet, showing only toe of shoes)":ue==="Male"&&(!ie.bottom||ie.bottom.includes("Chima"))&&(Ee="Baji (Wide trousers tied at ankles)"),{...ie,gender:ue,class:te(U.class,Q)||U.class||ie.class,hair:te(U.hair,ne)||U.hair||ie.hair,headwear:te(U.headwear,Y)||U.headwear||ie.headwear,bottom:Ee,extraDetails:U.visualGuide||"",clothingColor:U.clothingColor||""}}),h(`${z}  ! (  )`,"success")}}catch($){console.error($),h("  .  .","error")}finally{k(!1)}},Ue=(z,$)=>{ce(A=>({...A,[z]:$}))};de.useEffect(()=>{j&&ce(z=>({...z,hair:"None",headwear:"None",outer:"None",top:"None",bottom:"None",shoes:"Barefoot",accessories:"None"}))},[j]);const De=z=>{var A;const $=(A=z.target.files)==null?void 0:A[0];if($){const b=new FileReader;b.onloadend=()=>{se(b.result)},b.readAsDataURL($)}},nt=async()=>{if(O&&E&&s){ee(!0),h("      ...","success");try{let z=`${G.gender}, ${G.class}, ${G.hair}, ${G.clothingColor}`;try{z=await Im(s,O)}catch(U){console.error("AI Analysis failed during save",U),h("AI  .   .","warning")}const $=Date.now().toString(),A=`ref-${$}`,b={id:A,name:E,imageUrl:O,description:z,design:{...G}};u(U=>[...U,b]),c(U=>{const Q=ie=>ie.replace(/[\s\[\]\(\):]/g,""),ne=Q(E);let Y=-1;if(i&&(Y=U.findIndex(ie=>ie.id===i)),Y===-1&&(Y=U.findIndex(ie=>Q(ie.name)===ne)),Y!==-1){const ie=[...U],ue=ie[Y];return ie[Y]={...ue,name:E,description:z,visualGuide:`${G.class} (${G.gender}, ${w})`,age:w,gender:G.gender,referenceImageId:A,suggestedDesign:{...G}},ie}const te={id:$,name:E,description:z,visualGuide:`${G.class} (${G.gender}, ${w})`,age:w,gender:G.gender,hasDialogue:!0,chromaKeyColor:"green",actions:[],referenceImageId:A,suggestedDesign:{...G}};return[...U,te]}),h(`${E}  ! (  )`,"success"),t()}catch(z){console.error(z),h("   .","error")}finally{ee(!1)}}else s||h("API   AI    .","warning")},et=async()=>{if(!E.trim())return h("  ","warning");if(!w.trim())return h(" ","warning");if(!s)return h("API  ","warning");J(!0);try{const z={...G,gender:`${w} year old ${G.gender}`};let $=fe,A=le;O&&!fe&&($=O,A={face:!0,hair:!0,clothes:!1,headwear:!1,shoes:!1},h("    ...","success")),i&&o&&!fe&&!O&&($=o,A={face:!0,hair:!1,clothes:!1,headwear:!1,shoes:!1},h("    .","success"));const b=await RC(s,z,a,x,$||void 0,A);V(b),Ne(U=>[b,...U]),h(" .   .","success")}catch(z){h(z.message,"error")}finally{J(!1)}},S=(z,$,A)=>{const b=q[$]||[],U=[...A,...b],Q=G[$]&&!U.some(te=>te.value===G[$]),ne=["hair","headwear","outer","top","bottom","shoes","accessories"].includes($),Y=j&&ne;return f.jsxs("div",{className:`flex flex-col gap-1 ${Y?"opacity-50 pointer-events-none":""}`,children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold",children:z}),!Y&&f.jsxs("button",{onClick:()=>P($,z),className:"text-[10px] bg-slate-700 hover:bg-indigo-600 text-indigo-300 hover:text-white px-2 py-0.5 rounded transition-colors border border-slate-600 hover:border-indigo-500",title:"   ",children:[f.jsx("i",{className:"fas fa-plus"}),"  "]})]}),f.jsxs("select",{value:Y?"None":G[$],onChange:te=>{const ie=te.target.value;ie!=="__DELETE_CUSTOM__"&&Ue($,ie)},disabled:Y,className:`bg-slate-700 border rounded p-2 text-sm text-white focus:ring-indigo-500 ${Q?"border-yellow-500 text-yellow-300 font-bold":"border-slate-600"}`,children:[Q&&!Y&&f.jsxs("option",{value:G[$],children:[" ",G[$]," (AI )"]}),f.jsx("optgroup",{label:" ",children:A.map((te,ie)=>f.jsx("option",{value:te.value,children:te.label},`default-${ie}`))}),b.length>0&&f.jsx("optgroup",{label:"   (   )",children:b.map((te,ie)=>f.jsxs("option",{value:te.value,children:[" ",te.label]},`custom-${ie}`))})]}),b.some(te=>te.value===G[$])&&f.jsxs("button",{onClick:()=>W($,G[$]),className:"mt-1 text-xs text-red-400 hover:text-red-300 flex items-center gap-1 self-end",children:[f.jsx("i",{className:"fas fa-trash"}),"   "]})]})};return f.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-fade-in overflow-hidden",children:f.jsxs("div",{className:"bg-slate-800 w-full max-w-6xl h-[90vh] rounded-2xl border border-slate-600 shadow-2xl flex flex-col md:flex-row overflow-hidden",children:[f.jsxs("div",{className:"w-full md:w-1/2 p-6 overflow-y-auto border-r border-slate-700 custom-scrollbar bg-slate-800 z-10",children:[f.jsxs("div",{className:"flex justify-between items-center mb-6",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-user-edit text-indigo-400"}),"   "]}),f.jsxs("div",{className:"flex gap-2",children:[Object.keys(q).length>0&&f.jsxs("button",{onClick:C,className:"text-xs bg-red-900/50 hover:bg-red-800 text-red-200 px-3 py-1 rounded border border-red-700 transition-colors flex items-center gap-1",title:"    ",children:[f.jsx("i",{className:"fas fa-undo"})," "]}),f.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white",children:f.jsx("i",{className:"fas fa-times text-xl"})})]})]}),I.length>0&&f.jsxs("div",{className:"mb-6",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold mb-2 block",children:"   (  )"}),f.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(z=>f.jsxs("button",{onClick:()=>ke(z),disabled:R,className:`px-3 py-1.5 rounded-full text-xs font-bold border transition-all ${E===z?"bg-indigo-600 text-white border-indigo-500":"bg-slate-700 text-slate-300 border-slate-600 hover:bg-slate-600"}`,children:[z,E===z&&R&&f.jsx("i",{className:"fas fa-spinner fa-spin ml-2"})]},z))})]}),n&&f.jsxs("div",{className:"mb-4 bg-indigo-900/40 border border-indigo-500/50 p-3 rounded-lg flex items-center gap-3",children:[f.jsx("i",{className:"fas fa-robot text-indigo-300 text-xl"}),f.jsxs("div",{children:[f.jsx("p",{className:"text-indigo-200 text-sm font-bold",children:"AI   "}),f.jsx("p",{className:"text-xs text-indigo-400",children:"   , ,   ."})]})]}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-sm font-bold text-slate-300 block mb-2",children:" "}),f.jsx("input",{type:"text",value:E,onChange:z=>v(z.target.value),placeholder:": , ",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white focus:ring-indigo-500 font-bold text-lg"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"col-span-2 flex gap-4",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"1. "}),f.jsx("select",{value:G.gender,onChange:z=>Ue("gender",z.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white",children:ze.gender.map((z,$)=>f.jsx("option",{value:z.value,children:z.label},$))})]}),f.jsxs("div",{className:"flex-1",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:" ( )"}),f.jsx("input",{type:"number",value:w,onChange:z=>y(z.target.value),placeholder:": 60",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white"})]})]}),S("2. /","class",ze.class),f.jsxs("div",{className:"flex flex-col gap-1",children:[S("3. ","race",ze.race),["","","","","","","Animal"].some(z=>G.race.includes(z))&&f.jsxs("div",{className:"mt-2 p-3 bg-slate-700/80 rounded-lg border border-amber-500/50",children:[f.jsxs("p",{className:"text-xs text-amber-400 font-bold mb-2 flex items-center gap-1",children:[f.jsx("i",{className:"fas fa-paw"}),"   ()"]}),f.jsxs("div",{className:"flex gap-4",children:[f.jsxs("label",{className:`flex items-center gap-2 cursor-pointer p-2 rounded transition-all ${j?"bg-slate-800 text-slate-400 hover:bg-slate-600":"bg-indigo-600 text-white ring-2 ring-indigo-400"}`,children:[f.jsx("input",{type:"radio",name:"animalMode",checked:!j,onChange:()=>D(!1),className:"hidden"}),f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsx("span",{className:"text-sm font-bold",children:" ()"}),f.jsx("span",{className:"text-[10px] opacity-70",children:"  "})]})]}),f.jsxs("label",{className:`flex items-center gap-2 cursor-pointer p-2 rounded transition-all ${j?"bg-amber-600 text-white ring-2 ring-amber-400":"bg-slate-800 text-slate-400 hover:bg-slate-600"}`,children:[f.jsx("input",{type:"radio",name:"animalMode",checked:j,onChange:()=>D(!0),className:"hidden"}),f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsx("span",{className:"text-sm font-bold",children:" /"}),f.jsx("span",{className:"text-[10px] opacity-70",children:"  ()"})]})]})]})]})]}),S("4.  ","hair",ze.hair),S("5. /","headwear",ze.headwear),S("6. ","outer",ze.outer),S("7. ","top",ze.top),S("8. ","bottom",ze.bottom),S("9. ","shoes",ze.shoes),S("10. /","accessories",ze.accessories)]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold",children:"11.   ( )"}),f.jsx("input",{type:"text",value:G.clothingColor,onChange:z=>Ue("clothingColor",z.target.value),placeholder:":    ,  ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white"})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold",children:"12.   (:  )"}),f.jsx("input",{type:"text",value:G.facialFeatures||"",onChange:z=>Ue("facialFeatures",z.target.value),placeholder:":  , , ,  , ...",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-yellow-500"})]}),f.jsxs("div",{className:"space-y-2 bg-indigo-900/20 p-3 rounded border border-indigo-500/30",children:[f.jsxs("label",{className:"text-xs text-indigo-300 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-plus-circle"}),"   /  ()"]}),f.jsx("textarea",{value:G.extraDetails,onChange:z=>Ue("extraDetails",z.target.value),placeholder:":    ,  ,  ,  ...",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white h-16 focus:ring-indigo-500 resize-none"})]}),f.jsxs("div",{className:"space-y-2 bg-red-900/10 p-3 rounded border border-red-500/30",children:[f.jsxs("label",{className:"text-xs text-red-400 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-ban"}),"  /  (  )"]}),f.jsx("input",{type:"text",value:x,onChange:z=>T(z.target.value),placeholder:": , ,  , , , ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-red-500 placeholder-slate-500"}),f.jsxs("p",{className:"text-[10px] text-slate-400",children:[" AI ",f.jsx("strong",{children:'"   !"'}),"  ."]})]}),f.jsxs("div",{className:"space-y-2 bg-indigo-900/20 p-3 rounded border border-indigo-500/30",children:[f.jsxs("label",{className:"text-xs text-indigo-300 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-image"}),"    (/ )"]}),f.jsxs("div",{className:"flex flex-col gap-3",children:[f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs("label",{className:"cursor-pointer bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded border border-slate-600 flex items-center gap-2 text-sm",children:[f.jsx("i",{className:"fas fa-upload"}),"  ",f.jsx("input",{type:"file",accept:"image/*",onChange:De,className:"hidden"})]}),fe&&f.jsxs("div",{className:"relative h-16 w-16 bg-black rounded border border-slate-600 overflow-hidden group",children:[f.jsx("img",{src:fe,alt:"Reference",className:"h-full w-full object-cover"}),f.jsx("div",{className:"absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center",children:f.jsx("button",{onClick:()=>{se(null),xe({face:!0,hair:!0,clothes:!0,headwear:!0,shoes:!0})},className:"text-red-400 hover:text-red-300 transition-colors p-2",children:f.jsx("i",{className:"fas fa-trash text-2xl"})})})]})]}),fe&&f.jsxs("div",{className:"flex flex-col gap-2 bg-slate-800 p-3 rounded border border-slate-700",children:[f.jsxs("p",{className:"text-xs text-slate-400 font-bold flex items-center gap-1",children:[f.jsx("i",{className:"fas fa-check-double text-indigo-400"}),"   "]}),f.jsxs("div",{className:"grid grid-cols-2 gap-y-2 gap-x-4",children:[f.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-700/50 p-1 rounded transition-colors",children:[f.jsx("input",{type:"checkbox",checked:le.face,onChange:z=>xe($=>({...$,face:z.target.checked})),className:"w-4 h-4 text-indigo-600 bg-slate-700 border-slate-500 rounded focus:ring-indigo-500"}),f.jsx("span",{className:"text-xs text-white",children:" (Face)"})]}),f.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-700/50 p-1 rounded transition-colors",children:[f.jsx("input",{type:"checkbox",checked:le.hair,onChange:z=>xe($=>({...$,hair:z.target.checked})),className:"w-4 h-4 text-indigo-600 bg-slate-700 border-slate-500 rounded focus:ring-indigo-500"}),f.jsx("span",{className:"text-xs text-white",children:" (Hair)"})]}),f.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-700/50 p-1 rounded transition-colors",children:[f.jsx("input",{type:"checkbox",checked:le.clothes,onChange:z=>xe($=>({...$,clothes:z.target.checked})),className:"w-4 h-4 text-indigo-600 bg-slate-700 border-slate-500 rounded focus:ring-indigo-500"}),f.jsx("span",{className:"text-xs text-white",children:" (Clothes)"})]}),f.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-700/50 p-1 rounded transition-colors",children:[f.jsx("input",{type:"checkbox",checked:le.headwear,onChange:z=>xe($=>({...$,headwear:z.target.checked})),className:"w-4 h-4 text-indigo-600 bg-slate-700 border-slate-500 rounded focus:ring-indigo-500"}),f.jsx("span",{className:"text-xs text-white",children:" (Hat)"})]}),f.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-slate-700/50 p-1 rounded transition-colors",children:[f.jsx("input",{type:"checkbox",checked:le.shoes,onChange:z=>xe($=>({...$,shoes:z.target.checked})),className:"w-4 h-4 text-indigo-600 bg-slate-700 border-slate-500 rounded focus:ring-indigo-500"}),f.jsx("span",{className:"text-xs text-white",children:" (Shoes)"})]})]})]})]}),f.jsx("p",{className:"text-[10px] text-slate-400 mt-1",children:"      ."})]}),S("13.  ()","backgroundColor",ze.bg),f.jsxs("button",{onClick:et,disabled:X,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 mt-4",children:[X?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-paint-brush"}),"  "]})]})]}),f.jsxs("div",{className:"w-full md:w-1/2 bg-black flex flex-col relative h-full",children:[f.jsxs("div",{className:"p-4 flex-grow flex flex-col items-center justify-center overflow-hidden",children:[f.jsx("h3",{className:"text-slate-500 font-bold mb-4 absolute top-6 left-6",children:""}),f.jsxs("div",{className:"w-full max-w-sm aspect-[9/16] bg-slate-900 rounded-lg overflow-hidden border border-slate-700 flex items-center justify-center mb-4 relative shadow-2xl",children:[O?f.jsx("img",{src:O,alt:"Preview",className:"w-full h-full object-contain"}):f.jsxs("div",{className:"text-center text-slate-600",children:[f.jsx("i",{className:"fas fa-user-circle text-6xl mb-4 opacity-50"}),f.jsxs("p",{children:["  ",f.jsx("br",{}),"  ."]})]}),X&&f.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center backdrop-blur-sm",children:f.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-indigo-500"})})]}),O&&f.jsxs("div",{className:"flex gap-4 w-full max-w-sm",children:[f.jsxs("button",{onClick:nt,className:"flex-1 bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg font-bold shadow-lg transform hover:scale-105 transition-all",children:[f.jsx("i",{className:"fas fa-check-circle mr-2"})," ",K?"   ...":i?"  ":"   ()"]}),f.jsx("a",{href:O,download:`${E}_reference.png`,className:"bg-slate-800 hover:bg-slate-700 text-white px-4 py-3 rounded-lg border border-slate-600",children:f.jsx("i",{className:"fas fa-download"})})]})]}),f.jsxs("div",{className:"bg-slate-900 border-t border-slate-700 p-4 h-48 flex-shrink-0 flex flex-col",children:[f.jsxs("p",{className:"text-xs text-slate-400 mb-2 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-history text-indigo-400"}),"     (",Ie.length,")",f.jsx("span",{className:"text-[10px] font-normal text-slate-500 ml-auto",children:" "})]}),Ie.length===0?f.jsx("div",{className:"flex-grow flex items-center justify-center text-slate-600 text-xs border border-dashed border-slate-700 rounded-lg",children:"   ."}):f.jsx("div",{className:"flex gap-3 overflow-x-auto overflow-y-hidden pb-2 custom-scrollbar px-1 h-full items-center",children:Ie.map((z,$)=>f.jsx("div",{onClick:()=>V(z),className:`flex-shrink-0 w-20 h-28 rounded-lg overflow-hidden cursor-pointer border-2 transition-all hover:scale-105 shadow-lg ${O===z?"border-indigo-500 ring-2 ring-indigo-500/50 scale-105":"border-slate-700 hover:border-slate-500 opacity-70 hover:opacity-100"}`,children:f.jsx("img",{src:z,alt:`History ${$}`,className:"w-full h-full object-cover"})},$))})]})]})]})})},ur={types:[{label:" ",value:"Object"},{label:"/ ",value:"Evidence"},{label:" (/ )",value:"Weapon"},{label:" (/ )",value:"Accessory"},{label:"/ ",value:"Furniture"}],materials:[{label:" (Wood)",value:"Wooden"},{label:"/ (Metal)",value:"Metal, Iron, Steel"},{label:" (Gold)",value:"Gold"},{label:" (Silver)",value:"Silver"},{label:" (Jade)",value:"Jade"},{label:"/ (Fabric)",value:"Fabric, Silk, Cotton"},{label:" (Paper)",value:"Paper"},{label:" (Ceramic)",value:"Ceramic, Porcelain"},{label:" (Stone)",value:"Stone"}],colors:[{label:"/",value:"Natural"},{label:" (Red)",value:"Red"},{label:" (Blue)",value:"Blue"},{label:" (Black)",value:"Black"},{label:" (White)",value:"White"},{label:" (Gold)",value:"Gold"},{label:" (Silver)",value:"Silver"},{label:" (Green)",value:"Green"}]},HC=({onClose:t,initialName:e="",initialDescription:n="",initialType:r=""})=>{const{apiKey:o,selectedStyle:i,setProps:s,showToast:a}=Zt(),[u,c]=de.useState(e),h=C=>{if(!C)return ur.types[0].value;const G=ur.types.find(ce=>ce.value.toLowerCase()===C.toLowerCase());return G?G.value:ur.types[0].value},[p,m]=de.useState(h(r)),[g,E]=de.useState(""),[v,w]=de.useState(""),[y,x]=de.useState(n),[T,I]=de.useState(!1),[_,R]=de.useState(null),[k,j]=de.useState(null),[D,q]=de.useState([]),ae=C=>{var X;const G=(X=C.target.files)==null?void 0:X[0];if(!G)return;if(G.size>5*1024*1024){a("  5MB  .","warning");return}const ce=new FileReader;ce.onloadend=()=>{j(ce.result)},ce.readAsDataURL(G)},P=async()=>{if(!u.trim())return a("  ","warning");if(!y.trim()&&!k)return a("     .","warning");if(!o)return a("API  ","warning");I(!0);try{let C=`Type: ${p}.
`;v&&(C+=`Color: ${v}.
`),g&&(C+=`Material: ${g}.
`),C+=`Details: ${y}`;const G=await AC(o,u,C,i,k||void 0);R(G),q(ce=>[G,...ce]),a(" .   .","success")}catch(C){a(C.message,"error")}finally{I(!1)}},W=()=>{if(!_||!u)return;const C=`${v} ${g} ${u}. ${y}`,G={id:`prop-builder-${Date.now()}`,name:u,imageUrl:_,description:C,type:"object"};s(ce=>{const X=ce.findIndex(J=>J.name===u&&!J.imageUrl);if(X!==-1){const J=[...ce];return J[X]={...J[X],...G,id:ce[X].id},J}return[...ce,G]}),a(`'${u}'  !`,"success"),t()};return f.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-fade-in overflow-hidden",children:f.jsxs("div",{className:"bg-slate-800 w-full max-w-6xl h-[90vh] rounded-2xl border border-slate-600 shadow-2xl flex flex-col md:flex-row overflow-hidden",children:[f.jsxs("div",{className:"w-full md:w-1/2 p-6 overflow-y-auto border-r border-slate-700 custom-scrollbar bg-slate-800 z-10",children:[f.jsxs("div",{className:"flex justify-between items-center mb-6",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-cube text-amber-500"}),"   "]}),f.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white",children:f.jsx("i",{className:"fas fa-times text-xl"})})]}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-sm font-bold text-slate-300 block mb-2",children:" "}),f.jsx("input",{type:"text",value:u,onChange:C=>c(C.target.value),placeholder:": , , ",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white focus:ring-amber-500 font-bold text-lg"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"col-span-2",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"1.  "}),f.jsx("select",{value:p,onChange:C=>m(C.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-amber-500",children:ur.types.map((C,G)=>f.jsx("option",{value:C.value,children:C.label},G))})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"2.  (Color)"}),f.jsx("input",{type:"text",value:v,onChange:C=>w(C.target.value),placeholder:": , ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-amber-500",list:"color-options"}),f.jsx("datalist",{id:"color-options",children:ur.colors.map((C,G)=>f.jsx("option",{value:C.label},G))})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold mb-1 block",children:"3.  (Material)"}),f.jsx("input",{type:"text",value:g,onChange:C=>E(C.target.value),placeholder:": , , ",className:"w-full bg-slate-700 border border-slate-600 rounded p-2 text-sm text-white focus:ring-amber-500",list:"material-options"}),f.jsx("datalist",{id:"material-options",children:ur.materials.map((C,G)=>f.jsx("option",{value:C.label},G))})]})]}),f.jsxs("div",{className:"space-y-2 bg-slate-900/50 p-3 rounded border border-slate-700",children:[f.jsxs("label",{className:"text-xs text-amber-400 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-pen"}),"    (, )"]}),f.jsx("textarea",{value:y,onChange:C=>x(C.target.value),placeholder:":     ,     .   .",className:"w-full bg-slate-800 border border-slate-600 rounded p-2 text-sm text-white h-24 focus:ring-amber-500 resize-none"})]}),f.jsxs("div",{className:"space-y-2 bg-amber-900/20 p-3 rounded border border-amber-500/30",children:[f.jsxs("label",{className:"text-xs text-amber-300 font-bold flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-image"}),"    (/ )"]}),f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs("label",{className:"cursor-pointer bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded border border-slate-600 flex items-center gap-2 text-sm transition-colors",children:[f.jsx("i",{className:"fas fa-upload"}),"  ",f.jsx("input",{type:"file",accept:"image/*",onChange:ae,className:"hidden"})]}),k&&f.jsxs("div",{className:"relative h-16 w-16 bg-black rounded border border-slate-600 overflow-hidden group",children:[f.jsx("img",{src:k,alt:"Reference",className:"h-full w-full object-cover"}),f.jsx("button",{onClick:()=>j(null),className:"absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center text-red-400",children:f.jsx("i",{className:"fas fa-trash"})})]})]}),f.jsx("p",{className:"text-[10px] text-slate-400",children:"   AI       ."})]}),f.jsxs("button",{onClick:P,disabled:T,className:"w-full bg-amber-600 hover:bg-amber-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 mt-4 transition-all hover:shadow-amber-500/20",children:[T?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-paint-brush"})," "]})]})]}),f.jsxs("div",{className:"w-full md:w-1/2 bg-black/50 p-6 flex flex-col relative",children:[f.jsx("div",{className:"flex-grow flex items-center justify-center relative bg-[url('/grid.png')]",children:_?f.jsxs("div",{className:"relative w-full max-w-md aspect-square shadow-2xl rounded-lg overflow-hidden border-2 border-slate-700 group",children:[f.jsx("img",{src:_,alt:"Preview",className:"w-full h-full object-contain bg-[#202020]"}),f.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 p-4 transform translate-y-full group-hover:translate-y-0 transition-transform",children:f.jsxs("button",{onClick:W,className:"w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg font-bold shadow-lg",children:[f.jsx("i",{className:"fas fa-check mr-2"}),"   "]})})]}):f.jsxs("div",{className:"text-center text-slate-500",children:[f.jsx("i",{className:"fas fa-cube text-6xl mb-4 opacity-20"}),f.jsx("p",{className:"text-lg",children:"  '' ."})]})}),D.length>0&&f.jsx("div",{className:"h-24 border-t border-slate-700 bg-slate-900/80 p-2 flex gap-2 overflow-x-auto custom-scrollbar mt-4",children:D.map((C,G)=>f.jsx("div",{onClick:()=>R(C),className:`aspect-square h-full rounded cursor-pointer border-2 overflow-hidden flex-shrink-0 ${_===C?"border-amber-500":"border-transparent opacity-50 hover:opacity-100"}`,children:f.jsx("img",{src:C,alt:`History ${G}`,className:"w-full h-full object-cover"})},G))})]})]})})},BC=({id:t,style:e,selected:n,onSelect:r})=>f.jsxs("div",{onClick:()=>r(t),className:`cursor-pointer rounded-xl p-4 border-2 transition-all h-full flex flex-col gap-2 relative overflow-hidden ${n?"border-indigo-500 bg-indigo-900/30 ring-2 ring-indigo-500/50":"border-slate-700 bg-slate-800 hover:border-slate-500"}`,children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("span",{className:`text-lg font-bold ${n?"text-indigo-300":"text-slate-200"}`,children:e.name}),n&&f.jsx("i",{className:"fas fa-check-circle text-indigo-400 text-xl"})]}),f.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:e.desc})]}),VC=({selected:t,onChange:e})=>{const n=[{id:"16:9",label:" (16:9)",icon:"fa-tv"},{id:"9:16",label:" (9:16)",icon:"fa-mobile-alt"},{id:"1:1",label:" (1:1)",icon:"fa-square"}];return f.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(r=>f.jsxs("button",{onClick:()=>e(r.id),className:`px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-2 border transition-all ${t===r.id?"bg-indigo-600 text-white border-indigo-500 shadow-md":"bg-slate-800 text-slate-400 border-slate-700 hover:bg-slate-700"}`,children:[f.jsx("i",{className:`fas ${r.icon}`}),r.label]},r.id))})},zC=({onAnalyze:t,isAnalyzing:e})=>{var te,ie,ue,Ee,Le,be,Be;const{apiKey:n,script:r,scriptSegments:o,addScriptSegment:i,removeScriptSegment:s,clearScriptSegments:a,selectedStyle:u,setSelectedStyle:c,globalAspectRatio:h,setGlobalAspectRatio:p,isContinuityMode:m,setIsContinuityMode:g,referenceImages:E,setReferenceImages:v,characters:w,setCharacters:y,scenes:x,setScenes:T,props:I,setProps:_,showToast:R,openModal:k}=Zt(),[j,D]=de.useState(!1),[q,ae]=de.useState(null),P=re=>{const me=w.find(L=>L.id===re);me&&(E.find(L=>L.id===me.referenceImageId),ae(re),D(!0))},[W,C]=de.useState(!1),[G,ce]=de.useState(null),[X,J]=de.useState(null),[K,ee]=de.useState(""),[O,V]=de.useState(""),fe=de.useRef(null),se=de.useRef(null),le=()=>{const re=new Map;return x.forEach(me=>{var N,H;[...((N=me.casting)==null?void 0:N.mainIds)||[],...((H=me.casting)==null?void 0:H.subIds)||[]].forEach(M=>{const F=w.find(pe=>pe.id===M);if(!F||!F.name)return;const Z=F.name,B=re.get(Z)||0;re.set(Z,B+1)})}),Array.from(re.entries()).filter(([,me])=>me>0).map(([me,L])=>({name:me,count:L})).sort((me,L)=>me.name.localeCompare(L.name,"ko-KR"))},xe=re=>{re&&k({type:"confirm",title:"  ",message:`'${re}'     ?
(//   .)`,confirmText:" ",onConfirm:()=>{const me=x.map(L=>{const N=L.casting||{mainIds:[],subIds:[],propIds:[]},H=(N.mainIds||[]).filter(Z=>{const B=w.find(pe=>pe.id===Z);return!B||B.name!==re}),M=(N.subIds||[]).filter(Z=>{const B=w.find(pe=>pe.id===Z);return!B||B.name!==re}),F=L.focusId&&(()=>{const Z=w.find(B=>B.id===L.focusId);if(!Z||Z.name!==re)return L.focusId})();return{...L,casting:{...N,mainIds:H,subIds:M},focusId:F}});T(me),R(`'${re}'    .`,"success")}})},Ie=le(),Ne=(re,me,L)=>{re.preventDefault(),re.stopPropagation(),k({type:"confirm",title:"  ",message:`'${L}'    ?
(   .)`,onConfirm:()=>{v(N=>N.filter(H=>H.id!==me)),y(N=>N.filter(H=>H.referenceImageId!==me)),T(N=>N.map(H=>{if(!H.casting)return H;const M=w.find(F=>F.referenceImageId===me);return M?{...H,casting:{mainIds:H.casting.mainIds.filter(F=>F!==M.id),subIds:H.casting.subIds.filter(F=>F!==M.id),propIds:H.casting.propIds},focusId:H.focusId===M.id?void 0:H.focusId}:H})),R("   .","success")}})},ke=()=>{fe.current&&(fe.current.value="",fe.current.click())},Ue=re=>{var N;const me=(N=re.target.files)==null?void 0:N[0];if(!me)return;if(me.size>5*1024*1024){R("   5MB  .","warning");return}const L=new FileReader;L.onload=async H=>{var F;const M=(F=H.target)==null?void 0:F.result;M&&k({type:"prompt",title:"  ",message:"    (: )",confirmText:": AI ",onConfirm:async Z=>{if(Z&&Z.trim()){const B=Z.trim();let pe="Imported external character. (Auto-analysis failed)";if(n){R("AI    ...","success");try{pe=await Im(n,M)}catch(ye){console.error(ye),R(" .  .","error"),pe=" .       ."}}k({type:"textarea",title:`${B} /  ()`,message:`AI  . 
      ** **. 
 , ,     !`,defaultValue:pe,confirmText:"  (  )",onConfirm:ye=>{const Se=ye||pe;v(Ce=>[...Ce,{id:`ref-upload-${Date.now()}`,name:B,imageUrl:M,description:Se}]),y(Ce=>{const Oe=Ce.findIndex(Ae=>Ae.name===B);if(Oe!==-1){const Ae=[...Ce];return Ae[Oe]={...Ae[Oe],description:Se,visualGuide:"   ( )"},Ae}return[...Ce,{id:`char-manual-${Date.now()}`,name:B,description:Se,visualGuide:"   ( )",age:"",gender:"",hasDialogue:!0,chromaKeyColor:"green",actions:[]}]}),R(`'${B}'   !`,"success")}})}}})},L.onerror=()=>{R("   .","error")},L.readAsDataURL(me)},De=()=>{se.current&&(se.current.value="",se.current.click())},nt=re=>{var N;const me=(N=re.target.files)==null?void 0:N[0];if(!me)return;if(me.size>5*1024*1024){R("   5MB  .","warning");return}const L=new FileReader;L.onload=async H=>{var F;const M=(F=H.target)==null?void 0:F.result;M&&k({type:"prompt",title:"/  ",message:"    (: ,   )",confirmText:"",onConfirm:Z=>{if(Z&&Z.trim()){const B=Z.trim();k({type:"textarea",title:`${B}  `,message:`     .
(AI      .)`,defaultValue:"  , ,  ...",confirmText:"",onConfirm:pe=>{_(ye=>[...ye,{id:`prop-upload-${Date.now()}`,name:B,imageUrl:M,description:pe||" ",type:"object"}]),R(`'${B}'  !`,"success")}})}}})},L.readAsDataURL(me)},et=re=>{if(!n){R("API  .","warning");return}ce(re||null),C(!0)},S=async()=>{if(!n)return R("API  .","warning");if(!r&&o.length===0)return R("  .","warning");R("    ...","success");try{const re=r+`
`+o.map(L=>L.content).join(`
`),me=await IC(n,re);if(me.length>0){const L=me.filter(N=>!I.some(H=>H.name===N.name));if(L.length===0){R("   . ( )","warning");return}k({type:"confirm",title:` ${L.length} `,message:`  :

${L.map(N=>`- ${N.name}: ${N.description.substring(0,30)}...`).join(`
`)}

  ? (     )`,confirmText:" ",onConfirm:()=>{_(N=>[...N,...L]),R(`${L.length}   . ''    .`,"success")}})}else R("   .","warning")}catch(re){console.error(re),R("  : "+re.message,"error")}},z=(re,me,L)=>{re.preventDefault(),re.stopPropagation(),k({type:"confirm",title:" ",message:`'${L}'  ?`,onConfirm:()=>{_(N=>N.filter(H=>H.id!==me)),R(".","success")}})},$=()=>{k({type:"confirm",title:"  ",message:"  () ?",confirmText:"",onConfirm:()=>a()})},A=()=>{if(!K.trim()){R(" .","warning");return}const re=O.trim()||`Chapter ${o.length+1}`;i(re,K),ee(""),V(""),R(`${re} !`,"success")},b=(re,me)=>{navigator.clipboard.writeText(re),R(`'${me}'  .`,"success")},U=()=>{if(o.length===0)return;const re=o.map(me=>`[${me.title}]
${me.content}`).join(`

`);navigator.clipboard.writeText(re),R("  .","success")},[Q,ne]=de.useState(30),Y=async()=>{if(!n)return R("API  .","warning");let re=r+`
`+o.map(me=>me.content).join(`
`);if(m&&o.length>0){const me=o[o.length-1];re=me.content,R(`  :  (${me.title||"Untitled"}) .`,"success")}if(!re.trim())return R(" .","warning");t(),R("  ...","success");try{const me=await _m(n,re,[],w);y(B=>{const pe=new Set(B.map(Ce=>Ce.name)),ye=new Set(B.map(Ce=>Ce.id)),Se=me.filter(Ce=>!(pe.has(Ce.name)||ye.has(Ce.id)||B.some(Ae=>Ae.name.length<2?!1:!!(Ce.name.includes(Ae.name)||Ae.name.includes(Ce.name)))));return[...B,...Se]});const L=[...w],N=new Set(L.map(B=>B.name)),H=new Set(L.map(B=>B.id)),M=me.filter(B=>!N.has(B.name)&&!H.has(B.id)),F=[...L,...M],Z=await Nm(n,re,x,F,Q);Z.length===0?R("    .     .","warning"):(T(Z),R(`  ${Z.length}  .`,"success"))}catch(me){console.error(me),R("   : "+me.message,"error")}};return f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"fixed bottom-4 left-4 z-[9999] flex flex-col gap-2",children:[f.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"bg-slate-700/80 hover:bg-slate-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm transition-all border border-slate-500",title:" ",children:f.jsx("i",{className:"fas fa-arrow-up"})}),f.jsx("button",{onClick:()=>window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),className:"bg-slate-700/80 hover:bg-slate-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm transition-all border border-slate-500",title:" ",children:f.jsx("i",{className:"fas fa-arrow-down"})})]}),f.jsxs("div",{className:"space-y-10 animate-fade-in",children:[f.jsxs("section",{className:"space-y-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("span",{className:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-sm",children:"1"}),"  ( )"]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("input",{type:"file",ref:fe,onChange:Ue,accept:"image/*",className:"hidden"}),f.jsxs("button",{onClick:ke,className:"bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 border border-slate-600",children:[f.jsx("i",{className:"fas fa-upload"}),"   "]}),f.jsxs("button",{onClick:()=>D(!0),className:"bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 shadow-lg",children:[f.jsx("i",{className:"fas fa-plus"}),"  "]})]})]}),E.length===0?f.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 border-dashed rounded-xl p-6 text-center text-slate-500",children:[f.jsx("i",{className:"fas fa-users text-4xl mb-3 opacity-30"}),f.jsx("p",{children:"   ."})]}):f.jsx("div",{className:"flex gap-4 overflow-x-auto pt-2 pb-4 custom-scrollbar px-1",children:E.map(re=>f.jsxs("div",{className:"min-w-[180px] w-48 bg-slate-800 rounded-lg border border-slate-700 p-3 relative group hover:border-indigo-500 transition-colors",children:[f.jsx("button",{onClick:me=>Ne(me,re.id,re.name),className:"absolute top-2 right-2 bg-red-600 hover:bg-red-500 text-white w-7 h-7 rounded-full flex items-center justify-center shadow-lg z-20 opacity-0 group-hover:opacity-100 transition-opacity",title:"",children:f.jsx("i",{className:"fas fa-times text-xs"})}),f.jsxs("div",{className:"aspect-[9/16] bg-black rounded overflow-hidden mb-2 relative cursor-zoom-in",onClick:()=>J({url:re.imageUrl,title:re.name}),children:[f.jsx("img",{src:re.imageUrl,alt:re.name,className:"w-full h-full object-cover hover:scale-110 transition-transform duration-300"}),f.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:f.jsx("i",{className:"fas fa-search-plus text-white opacity-0 group-hover:opacity-100 text-2xl drop-shadow-lg transform scale-50 group-hover:scale-100 transition-all"})})]}),f.jsx("p",{className:"font-bold text-center text-white text-base truncate mb-2",children:re.name}),f.jsxs("div",{className:"flex gap-2 justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:[f.jsx("button",{onClick:me=>{me.stopPropagation();const L=w.find(N=>N.referenceImageId===re.id);if(L)P(L.id);else{const N=w.find(H=>H.name===re.name);N?P(N.id):R("    (/ ) .","warning")}},className:"bg-yellow-600 hover:bg-yellow-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg",title:"  (/)",children:f.jsx("i",{className:"fas fa-edit text-xs"})}),f.jsx("button",{onClick:me=>{me.stopPropagation(),k({type:"alert",title:`${re.name} AI  `,message:re.description||"  .",confirmText:"",showCopyButton:!0,onConfirm:()=>{}})},className:"bg-green-600 hover:bg-green-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg",title:"AI   ",children:f.jsx("i",{className:"fas fa-file-alt text-xs"})}),f.jsx("button",{onClick:me=>{me.stopPropagation(),fe.current&&ke()},className:"bg-indigo-600 hover:bg-indigo-500 text-white w-8 h-8 rounded-full flex items-center justify-center shadow-lg",title:" /",children:f.jsx("i",{className:"fas fa-sync-alt text-xs"})})]})]},re.id))})]}),f.jsxs("section",{className:"space-y-4",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("span",{className:"w-8 h-8 rounded-full bg-amber-600 flex items-center justify-center text-sm",children:"1.5"}),"  ( /)"]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("input",{type:"file",ref:se,onChange:nt,accept:"image/*",className:"hidden"}),f.jsxs("button",{onClick:De,className:"bg-slate-700 hover:bg-slate-600 text-slate-200 px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 border border-slate-600",children:[f.jsx("i",{className:"fas fa-upload"}),"   "]}),f.jsxs("button",{onClick:S,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 shadow-lg",children:[f.jsx("i",{className:"fas fa-magic"}),"   "]}),f.jsxs("button",{onClick:()=>et(),className:"bg-amber-600 hover:bg-amber-500 text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 shadow-lg",children:[f.jsx("i",{className:"fas fa-cube"}),"  "]})]})]}),I.length===0?f.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 border-dashed rounded-xl p-6 text-center text-slate-500",children:[f.jsx("i",{className:"fas fa-box-open text-4xl mb-3 opacity-30"}),f.jsx("p",{children:"   . (: , ,   )"})]}):f.jsx("div",{className:"flex gap-4 overflow-x-auto pt-2 pb-4 custom-scrollbar px-1",children:I.map(re=>f.jsxs("div",{className:"min-w-[100px] w-28 bg-slate-800 rounded-lg border border-slate-700 p-2 relative group hover:border-amber-500 transition-colors",children:[re.imageUrl?f.jsxs("div",{className:"aspect-square bg-black rounded overflow-hidden mb-2 relative cursor-zoom-in",onClick:()=>J({url:re.imageUrl,title:re.name}),children:[f.jsx("img",{src:re.imageUrl,alt:re.name,className:"w-full h-full object-cover hover:scale-110 transition-transform duration-300"}),f.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:f.jsx("i",{className:"fas fa-search-plus text-white opacity-0 group-hover:opacity-100 text-lg drop-shadow-lg transform scale-50 group-hover:scale-100 transition-all"})})]}):f.jsxs("button",{onClick:()=>et(re.id),className:"aspect-square w-full bg-slate-700 rounded mb-2 flex flex-col items-center justify-center gap-1 hover:bg-slate-600 transition-colors border border-dashed border-slate-500",title:" ",children:[f.jsx("i",{className:"fas fa-magic text-amber-500 text-xl"}),f.jsx("span",{className:"text-[10px] text-slate-400",children:" "})]}),f.jsx("p",{className:"font-bold text-center text-white text-xs truncate",children:re.name}),f.jsx("button",{onClick:me=>z(me,re.id,re.name),className:"absolute top-1 right-1 bg-red-600 hover:bg-red-500 text-white w-6 h-6 rounded-full flex items-center justify-center shadow-lg z-20 transition-transform active:scale-95",title:"",children:f.jsx("i",{className:"fas fa-times text-xs"})})]},re.id))})]}),f.jsxs("section",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("span",{className:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-sm",children:"2"}),"  ( )"]}),f.jsxs("div",{className:"text-slate-400 text-sm",children:["  : ",f.jsx("span",{className:"text-indigo-400 font-bold",children:r.length}),"  / ",o.length," "]})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[f.jsxs("div",{className:"bg-slate-800 p-5 rounded-xl border border-slate-700 shadow-lg flex flex-col h-full",children:[f.jsxs("div",{className:"mb-4",children:[f.jsx("label",{className:"text-xs text-slate-400 font-bold block mb-1",children:"  ()"}),f.jsx("input",{type:"text",value:O,onChange:re=>V(re.target.value),placeholder:`Chapter ${o.length+1}`,className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-white focus:ring-indigo-500 text-sm"})]}),f.jsx("label",{className:"text-xs text-slate-400 font-bold block mb-1",children:" "}),f.jsx("textarea",{value:K,onChange:re=>ee(re.target.value),placeholder:"    . (:    ...)",className:"w-full flex-grow min-h-[200px] bg-slate-900 text-base p-4 rounded-lg border border-slate-700 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 text-slate-100 placeholder-slate-500 resize-none mb-4"}),f.jsxs("button",{onClick:A,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-lg font-bold shadow-lg flex items-center justify-center gap-2 transition-all",children:[f.jsx("i",{className:"fas fa-plus-circle"}),"  "]})]}),f.jsxs("div",{className:"bg-slate-900/50 p-5 rounded-xl border border-slate-700 h-full flex flex-col",children:[f.jsxs("div",{className:"flex justify-between items-center mb-4",children:[f.jsxs("h3",{className:"text-lg font-bold text-slate-200",children:[f.jsx("i",{className:"fas fa-list-ol mr-2 text-indigo-400"}),"  "]}),f.jsxs("div",{className:"flex gap-2",children:[o.length>0&&f.jsxs("button",{onClick:U,className:"text-xs text-green-400 hover:text-green-300 underline mr-2",children:[f.jsx("i",{className:"fas fa-copy mr-1"})," "]}),o.length>0&&f.jsx("button",{onClick:$,className:"text-xs text-red-400 hover:text-red-300 underline",children:" "})]})]}),Ie.length>0&&f.jsxs("div",{className:"bg-slate-900/60 border border-slate-700 rounded-lg p-3 mb-3",children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsxs("span",{className:"text-[11px] font-bold text-slate-200 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-user-slash text-slate-400"}),"     "]}),f.jsx("span",{className:"text-[10px] text-slate-500",children:"      /  ."})]}),f.jsx("div",{className:"flex flex-wrap gap-2",children:Ie.map(re=>f.jsxs("button",{onClick:()=>xe(re.name),className:"flex items-center gap-2 text-[11px] px-2.5 py-1.5 rounded-full bg-slate-800 hover:bg-red-800 text-slate-200 border border-slate-600 hover:border-red-500 transition-colors",children:[f.jsx("span",{className:"font-bold",children:re.name}),f.jsxs("span",{className:"text-[10px] text-slate-400",children:["x",re.count]}),f.jsx("i",{className:"fas fa-times text-red-300 text-[9px]"})]},re.name))})]}),f.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-3 pr-2",style:{maxHeight:"400px"},children:o.length===0?f.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-600 opacity-50",children:[f.jsx("i",{className:"fas fa-book-open text-5xl mb-3"}),f.jsxs("p",{children:["  ",f.jsx("br",{}),"'' ."]})]}):o.map((re,me)=>f.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-600 relative group hover:border-indigo-500 transition-colors",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-xs font-bold text-indigo-300 bg-indigo-900/50 px-2 py-0.5 rounded uppercase",children:re.title||`Chapter ${me+1}`}),f.jsx("button",{onClick:()=>b(re.content,re.title||`Chapter ${me+1}`),className:"text-slate-500 hover:text-green-400 p-1 transition-colors",title:" ",children:f.jsx("i",{className:"fas fa-copy"})})]}),f.jsx("button",{onClick:()=>s(re.id),className:"text-slate-500 hover:text-red-500 p-1",children:f.jsx("i",{className:"fas fa-trash-alt"})})]}),f.jsx("p",{className:"text-sm text-slate-300 line-clamp-3",children:re.content})]},re.id))})]})]})]}),f.jsxs("section",{className:"space-y-4",children:[f.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("span",{className:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-sm",children:"3"}),""]}),f.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700 mb-4",children:[f.jsxs("div",{className:"mb-2 font-bold text-slate-300 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-crop-alt"}),"  "]}),f.jsx(VC,{selected:h,onChange:p})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.keys(Vr).map(re=>f.jsx(BC,{id:re,style:Vr[re],selected:u===re,onSelect:c},re))})]}),f.jsxs("div",{className:"flex flex-col items-center gap-4 pt-8",children:[f.jsxs("label",{className:"flex items-center gap-3 bg-slate-800 px-6 py-3 rounded-full border border-slate-600 cursor-pointer hover:bg-slate-750 select-none",children:[f.jsx("input",{type:"checkbox",checked:m,onChange:re=>g(re.target.checked),className:"w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300"}),f.jsx("span",{className:"text-lg font-bold text-indigo-300",children:"  "}),f.jsx("span",{className:"text-xs text-slate-400 border-l border-slate-600 pl-3",children:"      ."})]}),o.length===0&&f.jsx("p",{className:"text-red-400 text-sm font-bold animate-pulse",children:"   !"}),f.jsxs("div",{className:"flex items-center gap-3 bg-slate-800 px-6 py-2 rounded-lg border border-slate-600 mb-2",children:[f.jsx("label",{className:"text-slate-300 font-bold text-sm",children:"  :"}),f.jsx("input",{type:"number",value:Q,onChange:re=>ne(Number(re.target.value)),className:"bg-slate-900 text-white border border-slate-600 rounded px-2 py-1 w-20 text-center font-bold focus:ring-indigo-500",min:5,max:100}),f.jsx("span",{className:"text-xs text-slate-500",children:"( 5 ~  100)"})]}),f.jsxs("button",{onClick:Y,disabled:e||o.length===0,className:"bg-indigo-600 hover:bg-indigo-500 text-white text-xl font-bold px-12 py-5 rounded-full shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-3 w-full max-w-lg justify-center",children:[e?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-magic"}),e?" ...":"   /  "]})]}),X&&f.jsx("div",{className:"fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",onClick:()=>J(null),children:f.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh] flex flex-col items-center",children:[f.jsx("img",{src:X.url,alt:X.title,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl border border-slate-700",onClick:re=>re.stopPropagation()}),f.jsx("p",{className:"text-white font-bold text-xl mt-4 drop-shadow-md",children:X.title}),f.jsx("button",{onClick:()=>J(null),className:"absolute -top-12 right-0 text-slate-400 hover:text-white transition-colors",children:f.jsx("i",{className:"fas fa-times text-4xl"})})]})}),j&&f.jsx(GC,{onClose:()=>{D(!1),ae(null)},initialName:q?(te=w.find(re=>re.id===q))==null?void 0:te.name:"",initialDesign:q?(ie=w.find(re=>re.id===q))==null?void 0:ie.suggestedDesign:void 0,initialAge:q?(ue=w.find(re=>re.id===q))==null?void 0:ue.age:"30",initialReferenceImage:q?(Ee=E.find(re=>{var me;return re.id===((me=w.find(L=>L.id===q))==null?void 0:me.referenceImageId)}))==null?void 0:Ee.imageUrl:void 0,editCharacterId:q||void 0}),W&&f.jsx(HC,{onClose:()=>{C(!1),ce(null)},initialName:G?(Le=I.find(re=>re.id===G))==null?void 0:Le.name:"",initialDescription:G?(be=I.find(re=>re.id===G))==null?void 0:be.description:"",initialType:G?(Be=I.find(re=>re.id===G))==null?void 0:Be.type:""})]})]})};function di(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var bm={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,o,i){function s(c,h){if(!o[c]){if(!r[c]){var p=typeof di=="function"&&di;if(!h&&p)return p(c,!0);if(a)return a(c,!0);var m=new Error("Cannot find module '"+c+"'");throw m.code="MODULE_NOT_FOUND",m}var g=o[c]={exports:{}};r[c][0].call(g.exports,function(E){var v=r[c][1][E];return s(v||E)},g,g.exports,n,r,o,i)}return o[c].exports}for(var a=typeof di=="function"&&di,u=0;u<i.length;u++)s(i[u]);return s}({1:[function(n,r,o){var i=n("./utils"),s=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(u){for(var c,h,p,m,g,E,v,w=[],y=0,x=u.length,T=x,I=i.getTypeOf(u)!=="string";y<u.length;)T=x-y,p=I?(c=u[y++],h=y<x?u[y++]:0,y<x?u[y++]:0):(c=u.charCodeAt(y++),h=y<x?u.charCodeAt(y++):0,y<x?u.charCodeAt(y++):0),m=c>>2,g=(3&c)<<4|h>>4,E=1<T?(15&h)<<2|p>>6:64,v=2<T?63&p:64,w.push(a.charAt(m)+a.charAt(g)+a.charAt(E)+a.charAt(v));return w.join("")},o.decode=function(u){var c,h,p,m,g,E,v=0,w=0,y="data:";if(u.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var x,T=3*(u=u.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(u.charAt(u.length-1)===a.charAt(64)&&T--,u.charAt(u.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=s.uint8array?new Uint8Array(0|T):new Array(0|T);v<u.length;)c=a.indexOf(u.charAt(v++))<<2|(m=a.indexOf(u.charAt(v++)))>>4,h=(15&m)<<4|(g=a.indexOf(u.charAt(v++)))>>2,p=(3&g)<<6|(E=a.indexOf(u.charAt(v++))),x[w++]=c,g!==64&&(x[w++]=h),E!==64&&(x[w++]=p);return x}},{"./support":30,"./utils":32}],2:[function(n,r,o){var i=n("./external"),s=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),u=n("./stream/DataLengthProbe");function c(h,p,m,g,E){this.compressedSize=h,this.uncompressedSize=p,this.crc32=m,this.compression=g,this.compressedContent=E}c.prototype={getContentWorker:function(){var h=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new u("data_length")),p=this;return h.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,p,m){return h.pipe(new a).pipe(new u("uncompressedSize")).pipe(p.compressWorker(m)).pipe(new u("compressedSize")).withStreamInfo("compression",p)},r.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,o){var i=n("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},o.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,o){var i=n("./utils"),s=function(){for(var a,u=[],c=0;c<256;c++){a=c;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;u[c]=a}return u}();r.exports=function(a,u){return a!==void 0&&a.length?i.getTypeOf(a)!=="string"?function(c,h,p,m){var g=s,E=m+p;c^=-1;for(var v=m;v<E;v++)c=c>>>8^g[255&(c^h[v])];return-1^c}(0|u,a,a.length,0):function(c,h,p,m){var g=s,E=m+p;c^=-1;for(var v=m;v<E;v++)c=c>>>8^g[255&(c^h.charCodeAt(v))];return-1^c}(0|u,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(n,r,o){var i=null;i=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:i}},{lie:37}],7:[function(n,r,o){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=n("pako"),a=n("./utils"),u=n("./stream/GenericWorker"),c=i?"uint8array":"array";function h(p,m){u.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=m,this.meta={}}o.magic="\b\0",a.inherits(h,u),h.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,p.data),!1)},h.prototype.flush=function(){u.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(m){p.push({data:m,meta:p.meta})}},o.compressWorker=function(p){return new h("Deflate",p)},o.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,o){function i(g,E){var v,w="";for(v=0;v<E;v++)w+=String.fromCharCode(255&g),g>>>=8;return w}function s(g,E,v,w,y,x){var T,I,_=g.file,R=g.compression,k=x!==c.utf8encode,j=a.transformTo("string",x(_.name)),D=a.transformTo("string",c.utf8encode(_.name)),q=_.comment,ae=a.transformTo("string",x(q)),P=a.transformTo("string",c.utf8encode(q)),W=D.length!==_.name.length,C=P.length!==q.length,G="",ce="",X="",J=_.dir,K=_.date,ee={crc32:0,compressedSize:0,uncompressedSize:0};E&&!v||(ee.crc32=g.crc32,ee.compressedSize=g.compressedSize,ee.uncompressedSize=g.uncompressedSize);var O=0;E&&(O|=8),k||!W&&!C||(O|=2048);var V=0,fe=0;J&&(V|=16),y==="UNIX"?(fe=798,V|=function(le,xe){var Ie=le;return le||(Ie=xe?16893:33204),(65535&Ie)<<16}(_.unixPermissions,J)):(fe=20,V|=function(le){return 63&(le||0)}(_.dosPermissions)),T=K.getUTCHours(),T<<=6,T|=K.getUTCMinutes(),T<<=5,T|=K.getUTCSeconds()/2,I=K.getUTCFullYear()-1980,I<<=4,I|=K.getUTCMonth()+1,I<<=5,I|=K.getUTCDate(),W&&(ce=i(1,1)+i(h(j),4)+D,G+="up"+i(ce.length,2)+ce),C&&(X=i(1,1)+i(h(ae),4)+P,G+="uc"+i(X.length,2)+X);var se="";return se+=`
\0`,se+=i(O,2),se+=R.magic,se+=i(T,2),se+=i(I,2),se+=i(ee.crc32,4),se+=i(ee.compressedSize,4),se+=i(ee.uncompressedSize,4),se+=i(j.length,2),se+=i(G.length,2),{fileRecord:p.LOCAL_FILE_HEADER+se+j+G,dirRecord:p.CENTRAL_FILE_HEADER+i(fe,2)+se+i(ae.length,2)+"\0\0\0\0"+i(V,4)+i(w,4)+j+G+ae}}var a=n("../utils"),u=n("../stream/GenericWorker"),c=n("../utf8"),h=n("../crc32"),p=n("../signature");function m(g,E,v,w){u.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=E,this.zipPlatform=v,this.encodeFileName=w,this.streamFiles=g,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(m,u),m.prototype.push=function(g){var E=g.meta.percent||0,v=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(g):(this.bytesWritten+=g.data.length,u.prototype.push.call(this,{data:g.data,meta:{currentFile:this.currentFile,percent:v?(E+100*(v-w-1))/v:100}}))},m.prototype.openedSource=function(g){this.currentSourceOffset=this.bytesWritten,this.currentFile=g.file.name;var E=this.streamFiles&&!g.file.dir;if(E){var v=s(g,E,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:v.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(g){this.accumulate=!1;var E=this.streamFiles&&!g.file.dir,v=s(g,E,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(v.dirRecord),E)this.push({data:function(w){return p.DATA_DESCRIPTOR+i(w.crc32,4)+i(w.compressedSize,4)+i(w.uncompressedSize,4)}(g),meta:{percent:100}});else for(this.push({data:v.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var g=this.bytesWritten,E=0;E<this.dirRecords.length;E++)this.push({data:this.dirRecords[E],meta:{percent:100}});var v=this.bytesWritten-g,w=function(y,x,T,I,_){var R=a.transformTo("string",_(I));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(y,2)+i(y,2)+i(x,4)+i(T,4)+i(R.length,2)+R}(this.dirRecords.length,v,g,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(g){this._sources.push(g);var E=this;return g.on("data",function(v){E.processChunk(v)}),g.on("end",function(){E.closedSource(E.previous.streamInfo),E._sources.length?E.prepareNextSource():E.end()}),g.on("error",function(v){E.error(v)}),this},m.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(g){var E=this._sources;if(!u.prototype.error.call(this,g))return!1;for(var v=0;v<E.length;v++)try{E[v].error(g)}catch{}return!0},m.prototype.lock=function(){u.prototype.lock.call(this);for(var g=this._sources,E=0;E<g.length;E++)g[E].lock()},r.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,o){var i=n("../compressions"),s=n("./ZipFileWorker");o.generateWorker=function(a,u,c){var h=new s(u.streamFiles,c,u.platform,u.encodeFileName),p=0;try{a.forEach(function(m,g){p++;var E=function(x,T){var I=x||T,_=i[I];if(!_)throw new Error(I+" is not a valid compression method !");return _}(g.options.compression,u.compression),v=g.options.compressionOptions||u.compressionOptions||{},w=g.dir,y=g.date;g._compressWorker(E,v).withStreamInfo("file",{name:m,dir:w,date:y,comment:g.comment||"",unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions}).pipe(h)}),h.entriesCount=p}catch(m){h.error(m)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,o){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var a in this)typeof this[a]!="function"&&(s[a]=this[a]);return s}}(i.prototype=n("./object")).loadAsync=n("./load"),i.support=n("./support"),i.defaults=n("./defaults"),i.version="3.10.1",i.loadAsync=function(s,a){return new i().loadAsync(s,a)},i.external=n("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,o){var i=n("./utils"),s=n("./external"),a=n("./utf8"),u=n("./zipEntries"),c=n("./stream/Crc32Probe"),h=n("./nodejsUtils");function p(m){return new s.Promise(function(g,E){var v=m.decompressed.getContentWorker().pipe(new c);v.on("error",function(w){E(w)}).on("end",function(){v.streamInfo.crc32!==m.decompressed.crc32?E(new Error("Corrupted zip : CRC32 mismatch")):g()}).resume()})}r.exports=function(m,g){var E=this;return g=i.extend(g||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(m)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",m,!0,g.optimizedBinaryString,g.base64).then(function(v){var w=new u(g);return w.load(v),w}).then(function(v){var w=[s.Promise.resolve(v)],y=v.files;if(g.checkCRC32)for(var x=0;x<y.length;x++)w.push(p(y[x]));return s.Promise.all(w)}).then(function(v){for(var w=v.shift(),y=w.files,x=0;x<y.length;x++){var T=y[x],I=T.fileNameStr,_=i.resolve(T.fileNameStr);E.file(_,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:g.createFolders}),T.dir||(E.file(_).unsafeOriginalName=I)}return w.zipComment.length&&(E.comment=w.zipComment),E})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,o){var i=n("../utils"),s=n("../stream/GenericWorker");function a(u,c){s.call(this,"Nodejs stream input adapter for "+u),this._upstreamEnded=!1,this._bindStream(c)}i.inherits(a,s),a.prototype._bindStream=function(u){var c=this;(this._stream=u).pause(),u.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,o){var i=n("readable-stream").Readable;function s(a,u,c){i.call(this,u),this._helper=a;var h=this;a.on("data",function(p,m){h.push(p)||h._helper.pause(),c&&c(m)}).on("error",function(p){h.emit("error",p)}).on("end",function(){h.push(null)})}n("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(n,r,o){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(n,r,o){function i(_,R,k){var j,D=a.getTypeOf(R),q=a.extend(k||{},h);q.date=q.date||new Date,q.compression!==null&&(q.compression=q.compression.toUpperCase()),typeof q.unixPermissions=="string"&&(q.unixPermissions=parseInt(q.unixPermissions,8)),q.unixPermissions&&16384&q.unixPermissions&&(q.dir=!0),q.dosPermissions&&16&q.dosPermissions&&(q.dir=!0),q.dir&&(_=y(_)),q.createFolders&&(j=w(_))&&x.call(this,j,!0);var ae=D==="string"&&q.binary===!1&&q.base64===!1;k&&k.binary!==void 0||(q.binary=!ae),(R instanceof p&&R.uncompressedSize===0||q.dir||!R||R.length===0)&&(q.base64=!1,q.binary=!0,R="",q.compression="STORE",D="string");var P=null;P=R instanceof p||R instanceof u?R:E.isNode&&E.isStream(R)?new v(_,R):a.prepareContent(_,R,q.binary,q.optimizedBinaryString,q.base64);var W=new m(_,P,q);this.files[_]=W}var s=n("./utf8"),a=n("./utils"),u=n("./stream/GenericWorker"),c=n("./stream/StreamHelper"),h=n("./defaults"),p=n("./compressedObject"),m=n("./zipObject"),g=n("./generate"),E=n("./nodejsUtils"),v=n("./nodejs/NodejsStreamInputAdapter"),w=function(_){_.slice(-1)==="/"&&(_=_.substring(0,_.length-1));var R=_.lastIndexOf("/");return 0<R?_.substring(0,R):""},y=function(_){return _.slice(-1)!=="/"&&(_+="/"),_},x=function(_,R){return R=R!==void 0?R:h.createFolders,_=y(_),this.files[_]||i.call(this,_,null,{dir:!0,createFolders:R}),this.files[_]};function T(_){return Object.prototype.toString.call(_)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(_){var R,k,j;for(R in this.files)j=this.files[R],(k=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&_(k,j)},filter:function(_){var R=[];return this.forEach(function(k,j){_(k,j)&&R.push(j)}),R},file:function(_,R,k){if(arguments.length!==1)return _=this.root+_,i.call(this,_,R,k),this;if(T(_)){var j=_;return this.filter(function(q,ae){return!ae.dir&&j.test(q)})}var D=this.files[this.root+_];return D&&!D.dir?D:null},folder:function(_){if(!_)return this;if(T(_))return this.filter(function(D,q){return q.dir&&_.test(D)});var R=this.root+_,k=x.call(this,R),j=this.clone();return j.root=k.name,j},remove:function(_){_=this.root+_;var R=this.files[_];if(R||(_.slice(-1)!=="/"&&(_+="/"),R=this.files[_]),R&&!R.dir)delete this.files[_];else for(var k=this.filter(function(D,q){return q.name.slice(0,_.length)===_}),j=0;j<k.length;j++)delete this.files[k[j].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(_){var R,k={};try{if((k=a.extend(_||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");a.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var j=k.comment||this.comment||"";R=g.generateWorker(this,k,j)}catch(D){(R=new u("error")).error(D)}return new c(R,k.type||"string",k.mimeType)},generateAsync:function(_,R){return this.generateInternalStream(_).accumulate(R)},generateNodeStream:function(_,R){return(_=_||{}).type||(_.type="nodebuffer"),this.generateInternalStream(_).toNodejsStream(R)}};r.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,o){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,o){var i=n("./DataReader");function s(a){i.call(this,a);for(var u=0;u<this.data.length;u++)a[u]=255&a[u]}n("../utils").inherits(s,i),s.prototype.byteAt=function(a){return this.data[this.zero+a]},s.prototype.lastIndexOfSignature=function(a){for(var u=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),p=a.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===u&&this.data[m+1]===c&&this.data[m+2]===h&&this.data[m+3]===p)return m-this.zero;return-1},s.prototype.readAndCheckSignature=function(a){var u=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),p=a.charCodeAt(3),m=this.readData(4);return u===m[0]&&c===m[1]&&h===m[2]&&p===m[3]},s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(n,r,o){var i=n("../utils");function s(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var u,c=0;for(this.checkOffset(a),u=this.index+a-1;u>=this.index;u--)c=(c<<8)+this.byteAt(u);return this.index+=a,c},readString:function(a){return i.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=s},{"../utils":32}],19:[function(n,r,o){var i=n("./Uint8ArrayReader");function s(a){i.call(this,a)}n("../utils").inherits(s,i),s.prototype.readData=function(a){this.checkOffset(a);var u=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,o){var i=n("./DataReader");function s(a){i.call(this,a)}n("../utils").inherits(s,i),s.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},s.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},s.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},s.prototype.readData=function(a){this.checkOffset(a);var u=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(n,r,o){var i=n("./ArrayReader");function s(a){i.call(this,a)}n("../utils").inherits(s,i),s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,u},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,o){var i=n("../utils"),s=n("../support"),a=n("./ArrayReader"),u=n("./StringReader"),c=n("./NodeBufferReader"),h=n("./Uint8ArrayReader");r.exports=function(p){var m=i.getTypeOf(p);return i.checkSupport(m),m!=="string"||s.uint8array?m==="nodebuffer"?new c(p):s.uint8array?new h(i.transformTo("uint8array",p)):new a(i.transformTo("array",p)):new u(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,o){var i=n("./GenericWorker"),s=n("../utils");function a(u){i.call(this,"ConvertWorker to "+u),this.destType=u}s.inherits(a,i),a.prototype.processChunk=function(u){this.push({data:s.transformTo(this.destType,u.data),meta:u.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,o){var i=n("./GenericWorker"),s=n("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,i),a.prototype.processChunk=function(u){this.streamInfo.crc32=s(u.data,this.streamInfo.crc32||0),this.push(u)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,o){var i=n("../utils"),s=n("./GenericWorker");function a(u){s.call(this,"DataLengthProbe for "+u),this.propName=u,this.withStreamInfo(u,0)}i.inherits(a,s),a.prototype.processChunk=function(u){if(u){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+u.data.length}s.prototype.processChunk.call(this,u)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,o){var i=n("../utils"),s=n("./GenericWorker");function a(u){s.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=i.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}i.inherits(a,s),a.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,c);break;case"uint8array":u=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":u=this.data.slice(this.index,c)}return this.index=c,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,o){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,a){return this._listeners[s].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,a){if(this._listeners[s])for(var u=0;u<this._listeners[s].length;u++)this._listeners[s][u].call(this,a)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var a=this;return s.on("data",function(u){a.processChunk(u)}),s.on("end",function(){a.end()}),s.on("error",function(u){a.error(u)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,a){return this.extraStreamInfo[s]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},r.exports=i},{}],29:[function(n,r,o){var i=n("../utils"),s=n("./ConvertWorker"),a=n("./GenericWorker"),u=n("../base64"),c=n("../support"),h=n("../external"),p=null;if(c.nodestream)try{p=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(E,v){return new h.Promise(function(w,y){var x=[],T=E._internalType,I=E._outputType,_=E._mimeType;E.on("data",function(R,k){x.push(R),v&&v(k)}).on("error",function(R){x=[],y(R)}).on("end",function(){try{var R=function(k,j,D){switch(k){case"blob":return i.newBlob(i.transformTo("arraybuffer",j),D);case"base64":return u.encode(j);default:return i.transformTo(k,j)}}(I,function(k,j){var D,q=0,ae=null,P=0;for(D=0;D<j.length;D++)P+=j[D].length;switch(k){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for(ae=new Uint8Array(P),D=0;D<j.length;D++)ae.set(j[D],q),q+=j[D].length;return ae;case"nodebuffer":return Buffer.concat(j);default:throw new Error("concat : unsupported type '"+k+"'")}}(T,x),_);w(R)}catch(k){y(k)}x=[]}).resume()})}function g(E,v,w){var y=v;switch(v){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=v,this._mimeType=w,i.checkSupport(y),this._worker=E.pipe(new s(y)),E.lock()}catch(x){this._worker=new a("error"),this._worker.error(x)}}g.prototype={accumulate:function(E){return m(this,E)},on:function(E,v){var w=this;return E==="data"?this._worker.on(E,function(y){v.call(w,y.data,y.meta)}):this._worker.on(E,function(){i.delay(v,arguments,w)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(E){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},E)}},r.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var i=new ArrayBuffer(0);try{o.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),o.blob=s.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!n("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,o){for(var i=n("./utils"),s=n("./support"),a=n("./nodejsUtils"),u=n("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function p(){u.call(this,"utf-8 decode"),this.leftOver=null}function m(){u.call(this,"utf-8 encode")}o.utf8encode=function(g){return s.nodebuffer?a.newBufferFrom(g,"utf-8"):function(E){var v,w,y,x,T,I=E.length,_=0;for(x=0;x<I;x++)(64512&(w=E.charCodeAt(x)))==55296&&x+1<I&&(64512&(y=E.charCodeAt(x+1)))==56320&&(w=65536+(w-55296<<10)+(y-56320),x++),_+=w<128?1:w<2048?2:w<65536?3:4;for(v=s.uint8array?new Uint8Array(_):new Array(_),x=T=0;T<_;x++)(64512&(w=E.charCodeAt(x)))==55296&&x+1<I&&(64512&(y=E.charCodeAt(x+1)))==56320&&(w=65536+(w-55296<<10)+(y-56320),x++),w<128?v[T++]=w:(w<2048?v[T++]=192|w>>>6:(w<65536?v[T++]=224|w>>>12:(v[T++]=240|w>>>18,v[T++]=128|w>>>12&63),v[T++]=128|w>>>6&63),v[T++]=128|63&w);return v}(g)},o.utf8decode=function(g){return s.nodebuffer?i.transformTo("nodebuffer",g).toString("utf-8"):function(E){var v,w,y,x,T=E.length,I=new Array(2*T);for(v=w=0;v<T;)if((y=E[v++])<128)I[w++]=y;else if(4<(x=c[y]))I[w++]=65533,v+=x-1;else{for(y&=x===2?31:x===3?15:7;1<x&&v<T;)y=y<<6|63&E[v++],x--;1<x?I[w++]=65533:y<65536?I[w++]=y:(y-=65536,I[w++]=55296|y>>10&1023,I[w++]=56320|1023&y)}return I.length!==w&&(I.subarray?I=I.subarray(0,w):I.length=w),i.applyFromCharCode(I)}(g=i.transformTo(s.uint8array?"uint8array":"array",g))},i.inherits(p,u),p.prototype.processChunk=function(g){var E=i.transformTo(s.uint8array?"uint8array":"array",g.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var v=E;(E=new Uint8Array(v.length+this.leftOver.length)).set(this.leftOver,0),E.set(v,this.leftOver.length)}else E=this.leftOver.concat(E);this.leftOver=null}var w=function(x,T){var I;for((T=T||x.length)>x.length&&(T=x.length),I=T-1;0<=I&&(192&x[I])==128;)I--;return I<0||I===0?T:I+c[x[I]]>T?I:T}(E),y=E;w!==E.length&&(s.uint8array?(y=E.subarray(0,w),this.leftOver=E.subarray(w,E.length)):(y=E.slice(0,w),this.leftOver=E.slice(w,E.length))),this.push({data:o.utf8decode(y),meta:g.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=p,i.inherits(m,u),m.prototype.processChunk=function(g){this.push({data:o.utf8encode(g.data),meta:g.meta})},o.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,o){var i=n("./support"),s=n("./base64"),a=n("./nodejsUtils"),u=n("./external");function c(v){return v}function h(v,w){for(var y=0;y<v.length;++y)w[y]=255&v.charCodeAt(y);return w}n("setimmediate"),o.newBlob=function(v,w){o.checkSupport("blob");try{return new Blob([v],{type:w})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(v),y.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(v,w,y){var x=[],T=0,I=v.length;if(I<=y)return String.fromCharCode.apply(null,v);for(;T<I;)w==="array"||w==="nodebuffer"?x.push(String.fromCharCode.apply(null,v.slice(T,Math.min(T+y,I)))):x.push(String.fromCharCode.apply(null,v.subarray(T,Math.min(T+y,I)))),T+=y;return x.join("")},stringifyByChar:function(v){for(var w="",y=0;y<v.length;y++)w+=String.fromCharCode(v[y]);return w},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function m(v){var w=65536,y=o.getTypeOf(v),x=!0;if(y==="uint8array"?x=p.applyCanBeUsed.uint8array:y==="nodebuffer"&&(x=p.applyCanBeUsed.nodebuffer),x)for(;1<w;)try{return p.stringifyByChunk(v,y,w)}catch{w=Math.floor(w/2)}return p.stringifyByChar(v)}function g(v,w){for(var y=0;y<v.length;y++)w[y]=v[y];return w}o.applyFromCharCode=m;var E={};E.string={string:c,array:function(v){return h(v,new Array(v.length))},arraybuffer:function(v){return E.string.uint8array(v).buffer},uint8array:function(v){return h(v,new Uint8Array(v.length))},nodebuffer:function(v){return h(v,a.allocBuffer(v.length))}},E.array={string:m,array:c,arraybuffer:function(v){return new Uint8Array(v).buffer},uint8array:function(v){return new Uint8Array(v)},nodebuffer:function(v){return a.newBufferFrom(v)}},E.arraybuffer={string:function(v){return m(new Uint8Array(v))},array:function(v){return g(new Uint8Array(v),new Array(v.byteLength))},arraybuffer:c,uint8array:function(v){return new Uint8Array(v)},nodebuffer:function(v){return a.newBufferFrom(new Uint8Array(v))}},E.uint8array={string:m,array:function(v){return g(v,new Array(v.length))},arraybuffer:function(v){return v.buffer},uint8array:c,nodebuffer:function(v){return a.newBufferFrom(v)}},E.nodebuffer={string:m,array:function(v){return g(v,new Array(v.length))},arraybuffer:function(v){return E.nodebuffer.uint8array(v).buffer},uint8array:function(v){return g(v,new Uint8Array(v.length))},nodebuffer:c},o.transformTo=function(v,w){if(w=w||"",!v)return w;o.checkSupport(v);var y=o.getTypeOf(w);return E[y][v](w)},o.resolve=function(v){for(var w=v.split("/"),y=[],x=0;x<w.length;x++){var T=w[x];T==="."||T===""&&x!==0&&x!==w.length-1||(T===".."?y.pop():y.push(T))}return y.join("/")},o.getTypeOf=function(v){return typeof v=="string"?"string":Object.prototype.toString.call(v)==="[object Array]"?"array":i.nodebuffer&&a.isBuffer(v)?"nodebuffer":i.uint8array&&v instanceof Uint8Array?"uint8array":i.arraybuffer&&v instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(v){if(!i[v.toLowerCase()])throw new Error(v+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(v){var w,y,x="";for(y=0;y<(v||"").length;y++)x+="\\x"+((w=v.charCodeAt(y))<16?"0":"")+w.toString(16).toUpperCase();return x},o.delay=function(v,w,y){setImmediate(function(){v.apply(y||null,w||[])})},o.inherits=function(v,w){function y(){}y.prototype=w.prototype,v.prototype=new y},o.extend=function(){var v,w,y={};for(v=0;v<arguments.length;v++)for(w in arguments[v])Object.prototype.hasOwnProperty.call(arguments[v],w)&&y[w]===void 0&&(y[w]=arguments[v][w]);return y},o.prepareContent=function(v,w,y,x,T){return u.Promise.resolve(w).then(function(I){return i.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new u.Promise(function(_,R){var k=new FileReader;k.onload=function(j){_(j.target.result)},k.onerror=function(j){R(j.target.error)},k.readAsArrayBuffer(I)}):I}).then(function(I){var _=o.getTypeOf(I);return _?(_==="arraybuffer"?I=o.transformTo("uint8array",I):_==="string"&&(T?I=s.decode(I):y&&x!==!0&&(I=function(R){return h(R,i.uint8array?new Uint8Array(R.length):new Array(R.length))}(I))),I):u.Promise.reject(new Error("Can't read the data of '"+v+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,o){var i=n("./reader/readerFor"),s=n("./utils"),a=n("./signature"),u=n("./zipEntry"),c=n("./support");function h(p){this.files=[],this.loadOptions=p}h.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(m)+", expected "+s.pretty(p)+")")}},isSignature:function(p,m){var g=this.reader.index;this.reader.setIndex(p);var E=this.reader.readString(4)===m;return this.reader.setIndex(g),E},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),m=c.uint8array?"uint8array":"array",g=s.transformTo(m,p);this.zipComment=this.loadOptions.decodeFileName(g)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,m,g,E=this.zip64EndOfCentralSize-44;0<E;)p=this.reader.readInt(2),m=this.reader.readInt(4),g=this.reader.readData(m),this.zip64ExtensibleData[p]={id:p,length:m,value:g}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,m;for(p=0;p<this.files.length;p++)m=this.files[p],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(p=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var m=p;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var g=this.centralDirOffset+this.centralDirSize;this.zip64&&(g+=20,g+=12+this.zip64EndOfCentralSize);var E=m-g;if(0<E)this.isSignature(m,a.CENTRAL_FILE_HEADER)||(this.reader.zero=E);else if(E<0)throw new Error("Corrupted zip: missing "+Math.abs(E)+" bytes.")},prepareReader:function(p){this.reader=i(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,o){var i=n("./reader/readerFor"),s=n("./utils"),a=n("./compressedObject"),u=n("./crc32"),c=n("./utf8"),h=n("./compressions"),p=n("./support");function m(g,E){this.options=g,this.loadOptions=E}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(g){var E,v;if(g.skip(22),this.fileNameLength=g.readInt(2),v=g.readInt(2),this.fileName=g.readData(this.fileNameLength),g.skip(v),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((E=function(w){for(var y in h)if(Object.prototype.hasOwnProperty.call(h,y)&&h[y].magic===w)return h[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,E,g.readData(this.compressedSize))},readCentralPart:function(g){this.versionMadeBy=g.readInt(2),g.skip(2),this.bitFlag=g.readInt(2),this.compressionMethod=g.readString(2),this.date=g.readDate(),this.crc32=g.readInt(4),this.compressedSize=g.readInt(4),this.uncompressedSize=g.readInt(4);var E=g.readInt(2);if(this.extraFieldsLength=g.readInt(2),this.fileCommentLength=g.readInt(2),this.diskNumberStart=g.readInt(2),this.internalFileAttributes=g.readInt(2),this.externalFileAttributes=g.readInt(4),this.localHeaderOffset=g.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");g.skip(E),this.readExtraFields(g),this.parseZIP64ExtraField(g),this.fileComment=g.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var g=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),g==0&&(this.dosPermissions=63&this.externalFileAttributes),g==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var g=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=g.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=g.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=g.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=g.readInt(4))}},readExtraFields:function(g){var E,v,w,y=g.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});g.index+4<y;)E=g.readInt(2),v=g.readInt(2),w=g.readData(v),this.extraFields[E]={id:E,length:v,value:w};g.setIndex(y)},handleUTF8:function(){var g=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var E=this.findExtraFieldUnicodePath();if(E!==null)this.fileNameStr=E;else{var v=s.transformTo(g,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(v)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var y=s.transformTo(g,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var g=this.extraFields[28789];if(g){var E=i(g.value);return E.readInt(1)!==1||u(this.fileName)!==E.readInt(4)?null:c.utf8decode(E.readData(g.length-5))}return null},findExtraFieldUnicodeComment:function(){var g=this.extraFields[25461];if(g){var E=i(g.value);return E.readInt(1)!==1||u(this.fileComment)!==E.readInt(4)?null:c.utf8decode(E.readData(g.length-5))}return null}},r.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,o){function i(E,v,w){this.name=E,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=v,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var s=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),u=n("./utf8"),c=n("./compressedObject"),h=n("./stream/GenericWorker");i.prototype={internalStream:function(E){var v=null,w="string";try{if(!E)throw new Error("No output type specified.");var y=(w=E.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),v=this._decompressWorker();var x=!this._dataBinary;x&&!y&&(v=v.pipe(new u.Utf8EncodeWorker)),!x&&y&&(v=v.pipe(new u.Utf8DecodeWorker))}catch(T){(v=new h("error")).error(T)}return new s(v,w,"")},async:function(E,v){return this.internalStream(E).accumulate(v)},nodeStream:function(E,v){return this.internalStream(E||"nodebuffer").toNodejsStream(v)},_compressWorker:function(E,v){if(this._data instanceof c&&this._data.compression.magic===E.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new u.Utf8EncodeWorker)),c.createWorkerFrom(w,E,v)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},g=0;g<p.length;g++)i.prototype[p[g]]=m;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,o){(function(i){var s,a,u=i.MutationObserver||i.WebKitMutationObserver;if(u){var c=0,h=new u(E),p=i.document.createTextNode("");h.observe(p,{characterData:!0}),s=function(){p.data=c=++c%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var v=i.document.createElement("script");v.onreadystatechange=function(){E(),v.onreadystatechange=null,v.parentNode.removeChild(v),v=null},i.document.documentElement.appendChild(v)}:function(){setTimeout(E,0)};else{var m=new i.MessageChannel;m.port1.onmessage=E,s=function(){m.port2.postMessage(0)}}var g=[];function E(){var v,w;a=!0;for(var y=g.length;y;){for(w=g,g=[],v=-1;++v<y;)w[v]();y=g.length}a=!1}r.exports=function(v){g.push(v)!==1||a||s()}}).call(this,typeof un<"u"?un:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,o){var i=n("immediate");function s(){}var a={},u=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function p(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,y!==s&&v(this,y)}function m(y,x,T){this.promise=y,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function g(y,x,T){i(function(){var I;try{I=x(T)}catch(_){return a.reject(y,_)}I===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,I)})}function E(y){var x=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof x=="function")return function(){x.apply(y,arguments)}}function v(y,x){var T=!1;function I(k){T||(T=!0,a.reject(y,k))}function _(k){T||(T=!0,a.resolve(y,k))}var R=w(function(){x(_,I)});R.status==="error"&&I(R.value)}function w(y,x){var T={};try{T.value=y(x),T.status="success"}catch(I){T.status="error",T.value=I}return T}(r.exports=p).prototype.finally=function(y){if(typeof y!="function")return this;var x=this.constructor;return this.then(function(T){return x.resolve(y()).then(function(){return T})},function(T){return x.resolve(y()).then(function(){throw T})})},p.prototype.catch=function(y){return this.then(null,y)},p.prototype.then=function(y,x){if(typeof y!="function"&&this.state===c||typeof x!="function"&&this.state===u)return this;var T=new this.constructor(s);return this.state!==h?g(T,this.state===c?y:x,this.outcome):this.queue.push(new m(T,y,x)),T},m.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},m.prototype.otherCallFulfilled=function(y){g(this.promise,this.onFulfilled,y)},m.prototype.callRejected=function(y){a.reject(this.promise,y)},m.prototype.otherCallRejected=function(y){g(this.promise,this.onRejected,y)},a.resolve=function(y,x){var T=w(E,x);if(T.status==="error")return a.reject(y,T.value);var I=T.value;if(I)v(y,I);else{y.state=c,y.outcome=x;for(var _=-1,R=y.queue.length;++_<R;)y.queue[_].callFulfilled(x)}return y},a.reject=function(y,x){y.state=u,y.outcome=x;for(var T=-1,I=y.queue.length;++T<I;)y.queue[T].callRejected(x);return y},p.resolve=function(y){return y instanceof this?y:a.resolve(new this(s),y)},p.reject=function(y){var x=new this(s);return a.reject(x,y)},p.all=function(y){var x=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,I=!1;if(!T)return this.resolve([]);for(var _=new Array(T),R=0,k=-1,j=new this(s);++k<T;)D(y[k],k);return j;function D(q,ae){x.resolve(q).then(function(P){_[ae]=P,++R!==T||I||(I=!0,a.resolve(j,_))},function(P){I||(I=!0,a.reject(j,P))})}},p.race=function(y){var x=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,I=!1;if(!T)return this.resolve([]);for(var _=-1,R=new this(s);++_<T;)k=y[_],x.resolve(k).then(function(j){I||(I=!0,a.resolve(R,j))},function(j){I||(I=!0,a.reject(R,j))});var k;return R}},{immediate:36}],38:[function(n,r,o){var i={};(0,n("./lib/utils/common").assign)(i,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,o){var i=n("./zlib/deflate"),s=n("./utils/common"),a=n("./utils/strings"),u=n("./zlib/messages"),c=n("./zlib/zstream"),h=Object.prototype.toString,p=0,m=-1,g=0,E=8;function v(y){if(!(this instanceof v))return new v(y);this.options=s.assign({level:m,method:E,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},y||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var T=i.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(T!==p)throw new Error(u[T]);if(x.header&&i.deflateSetHeader(this.strm,x.header),x.dictionary){var I;if(I=typeof x.dictionary=="string"?a.string2buf(x.dictionary):h.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(T=i.deflateSetDictionary(this.strm,I))!==p)throw new Error(u[T]);this._dict_set=!0}}function w(y,x){var T=new v(x);if(T.push(y,!0),T.err)throw T.msg||u[T.err];return T.result}v.prototype.push=function(y,x){var T,I,_=this.strm,R=this.options.chunkSize;if(this.ended)return!1;I=x===~~x?x:x===!0?4:0,typeof y=="string"?_.input=a.string2buf(y):h.call(y)==="[object ArrayBuffer]"?_.input=new Uint8Array(y):_.input=y,_.next_in=0,_.avail_in=_.input.length;do{if(_.avail_out===0&&(_.output=new s.Buf8(R),_.next_out=0,_.avail_out=R),(T=i.deflate(_,I))!==1&&T!==p)return this.onEnd(T),!(this.ended=!0);_.avail_out!==0&&(_.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(s.shrinkBuf(_.output,_.next_out))):this.onData(s.shrinkBuf(_.output,_.next_out)))}while((0<_.avail_in||_.avail_out===0)&&T!==1);return I===4?(T=i.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===p):I!==2||(this.onEnd(p),!(_.avail_out=0))},v.prototype.onData=function(y){this.chunks.push(y)},v.prototype.onEnd=function(y){y===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},o.Deflate=v,o.deflate=w,o.deflateRaw=function(y,x){return(x=x||{}).raw=!0,w(y,x)},o.gzip=function(y,x){return(x=x||{}).gzip=!0,w(y,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,o){var i=n("./zlib/inflate"),s=n("./utils/common"),a=n("./utils/strings"),u=n("./zlib/constants"),c=n("./zlib/messages"),h=n("./zlib/zstream"),p=n("./zlib/gzheader"),m=Object.prototype.toString;function g(v){if(!(this instanceof g))return new g(v);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},v||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||v&&v.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var y=i.inflateInit2(this.strm,w.windowBits);if(y!==u.Z_OK)throw new Error(c[y]);this.header=new p,i.inflateGetHeader(this.strm,this.header)}function E(v,w){var y=new g(w);if(y.push(v,!0),y.err)throw y.msg||c[y.err];return y.result}g.prototype.push=function(v,w){var y,x,T,I,_,R,k=this.strm,j=this.options.chunkSize,D=this.options.dictionary,q=!1;if(this.ended)return!1;x=w===~~w?w:w===!0?u.Z_FINISH:u.Z_NO_FLUSH,typeof v=="string"?k.input=a.binstring2buf(v):m.call(v)==="[object ArrayBuffer]"?k.input=new Uint8Array(v):k.input=v,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new s.Buf8(j),k.next_out=0,k.avail_out=j),(y=i.inflate(k,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&D&&(R=typeof D=="string"?a.string2buf(D):m.call(D)==="[object ArrayBuffer]"?new Uint8Array(D):D,y=i.inflateSetDictionary(this.strm,R)),y===u.Z_BUF_ERROR&&q===!0&&(y=u.Z_OK,q=!1),y!==u.Z_STREAM_END&&y!==u.Z_OK)return this.onEnd(y),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&y!==u.Z_STREAM_END&&(k.avail_in!==0||x!==u.Z_FINISH&&x!==u.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(k.output,k.next_out),I=k.next_out-T,_=a.buf2string(k.output,T),k.next_out=I,k.avail_out=j-I,I&&s.arraySet(k.output,k.output,T,I,0),this.onData(_)):this.onData(s.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(q=!0)}while((0<k.avail_in||k.avail_out===0)&&y!==u.Z_STREAM_END);return y===u.Z_STREAM_END&&(x=u.Z_FINISH),x===u.Z_FINISH?(y=i.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===u.Z_OK):x!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),!(k.avail_out=0))},g.prototype.onData=function(v){this.chunks.push(v)},g.prototype.onEnd=function(v){v===u.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},o.Inflate=g,o.inflate=E,o.inflateRaw=function(v,w){return(w=w||{}).raw=!0,E(v,w)},o.ungzip=E},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,o){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(u){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var p in h)h.hasOwnProperty(p)&&(u[p]=h[p])}}return u},o.shrinkBuf=function(u,c){return u.length===c?u:u.subarray?u.subarray(0,c):(u.length=c,u)};var s={arraySet:function(u,c,h,p,m){if(c.subarray&&u.subarray)u.set(c.subarray(h,h+p),m);else for(var g=0;g<p;g++)u[m+g]=c[h+g]},flattenChunks:function(u){var c,h,p,m,g,E;for(c=p=0,h=u.length;c<h;c++)p+=u[c].length;for(E=new Uint8Array(p),c=m=0,h=u.length;c<h;c++)g=u[c],E.set(g,m),m+=g.length;return E}},a={arraySet:function(u,c,h,p,m){for(var g=0;g<p;g++)u[m+g]=c[h+g]},flattenChunks:function(u){return[].concat.apply([],u)}};o.setTyped=function(u){u?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,s)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,a))},o.setTyped(i)},{}],42:[function(n,r,o){var i=n("./common"),s=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var u=new i.Buf8(256),c=0;c<256;c++)u[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(p,m){if(m<65537&&(p.subarray&&a||!p.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(p,m));for(var g="",E=0;E<m;E++)g+=String.fromCharCode(p[E]);return g}u[254]=u[254]=1,o.string2buf=function(p){var m,g,E,v,w,y=p.length,x=0;for(v=0;v<y;v++)(64512&(g=p.charCodeAt(v)))==55296&&v+1<y&&(64512&(E=p.charCodeAt(v+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),v++),x+=g<128?1:g<2048?2:g<65536?3:4;for(m=new i.Buf8(x),v=w=0;w<x;v++)(64512&(g=p.charCodeAt(v)))==55296&&v+1<y&&(64512&(E=p.charCodeAt(v+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),v++),g<128?m[w++]=g:(g<2048?m[w++]=192|g>>>6:(g<65536?m[w++]=224|g>>>12:(m[w++]=240|g>>>18,m[w++]=128|g>>>12&63),m[w++]=128|g>>>6&63),m[w++]=128|63&g);return m},o.buf2binstring=function(p){return h(p,p.length)},o.binstring2buf=function(p){for(var m=new i.Buf8(p.length),g=0,E=m.length;g<E;g++)m[g]=p.charCodeAt(g);return m},o.buf2string=function(p,m){var g,E,v,w,y=m||p.length,x=new Array(2*y);for(g=E=0;g<y;)if((v=p[g++])<128)x[E++]=v;else if(4<(w=u[v]))x[E++]=65533,g+=w-1;else{for(v&=w===2?31:w===3?15:7;1<w&&g<y;)v=v<<6|63&p[g++],w--;1<w?x[E++]=65533:v<65536?x[E++]=v:(v-=65536,x[E++]=55296|v>>10&1023,x[E++]=56320|1023&v)}return h(x,E)},o.utf8border=function(p,m){var g;for((m=m||p.length)>p.length&&(m=p.length),g=m-1;0<=g&&(192&p[g])==128;)g--;return g<0||g===0?m:g+u[p[g]]>m?g:m}},{"./common":41}],43:[function(n,r,o){r.exports=function(i,s,a,u){for(var c=65535&i|0,h=i>>>16&65535|0,p=0;a!==0;){for(a-=p=2e3<a?2e3:a;h=h+(c=c+s[u++]|0)|0,--p;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(n,r,o){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,o){var i=function(){for(var s,a=[],u=0;u<256;u++){s=u;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;a[u]=s}return a}();r.exports=function(s,a,u,c){var h=i,p=c+u;s^=-1;for(var m=c;m<p;m++)s=s>>>8^h[255&(s^a[m])];return-1^s}},{}],46:[function(n,r,o){var i,s=n("../utils/common"),a=n("./trees"),u=n("./adler32"),c=n("./crc32"),h=n("./messages"),p=0,m=4,g=0,E=-2,v=-1,w=4,y=2,x=8,T=9,I=286,_=30,R=19,k=2*I+1,j=15,D=3,q=258,ae=q+D+1,P=42,W=113,C=1,G=2,ce=3,X=4;function J(S,z){return S.msg=h[z],z}function K(S){return(S<<1)-(4<S?9:0)}function ee(S){for(var z=S.length;0<=--z;)S[z]=0}function O(S){var z=S.state,$=z.pending;$>S.avail_out&&($=S.avail_out),$!==0&&(s.arraySet(S.output,z.pending_buf,z.pending_out,$,S.next_out),S.next_out+=$,z.pending_out+=$,S.total_out+=$,S.avail_out-=$,z.pending-=$,z.pending===0&&(z.pending_out=0))}function V(S,z){a._tr_flush_block(S,0<=S.block_start?S.block_start:-1,S.strstart-S.block_start,z),S.block_start=S.strstart,O(S.strm)}function fe(S,z){S.pending_buf[S.pending++]=z}function se(S,z){S.pending_buf[S.pending++]=z>>>8&255,S.pending_buf[S.pending++]=255&z}function le(S,z){var $,A,b=S.max_chain_length,U=S.strstart,Q=S.prev_length,ne=S.nice_match,Y=S.strstart>S.w_size-ae?S.strstart-(S.w_size-ae):0,te=S.window,ie=S.w_mask,ue=S.prev,Ee=S.strstart+q,Le=te[U+Q-1],be=te[U+Q];S.prev_length>=S.good_match&&(b>>=2),ne>S.lookahead&&(ne=S.lookahead);do if(te[($=z)+Q]===be&&te[$+Q-1]===Le&&te[$]===te[U]&&te[++$]===te[U+1]){U+=2,$++;do;while(te[++U]===te[++$]&&te[++U]===te[++$]&&te[++U]===te[++$]&&te[++U]===te[++$]&&te[++U]===te[++$]&&te[++U]===te[++$]&&te[++U]===te[++$]&&te[++U]===te[++$]&&U<Ee);if(A=q-(Ee-U),U=Ee-q,Q<A){if(S.match_start=z,ne<=(Q=A))break;Le=te[U+Q-1],be=te[U+Q]}}while((z=ue[z&ie])>Y&&--b!=0);return Q<=S.lookahead?Q:S.lookahead}function xe(S){var z,$,A,b,U,Q,ne,Y,te,ie,ue=S.w_size;do{if(b=S.window_size-S.lookahead-S.strstart,S.strstart>=ue+(ue-ae)){for(s.arraySet(S.window,S.window,ue,ue,0),S.match_start-=ue,S.strstart-=ue,S.block_start-=ue,z=$=S.hash_size;A=S.head[--z],S.head[z]=ue<=A?A-ue:0,--$;);for(z=$=ue;A=S.prev[--z],S.prev[z]=ue<=A?A-ue:0,--$;);b+=ue}if(S.strm.avail_in===0)break;if(Q=S.strm,ne=S.window,Y=S.strstart+S.lookahead,te=b,ie=void 0,ie=Q.avail_in,te<ie&&(ie=te),$=ie===0?0:(Q.avail_in-=ie,s.arraySet(ne,Q.input,Q.next_in,ie,Y),Q.state.wrap===1?Q.adler=u(Q.adler,ne,ie,Y):Q.state.wrap===2&&(Q.adler=c(Q.adler,ne,ie,Y)),Q.next_in+=ie,Q.total_in+=ie,ie),S.lookahead+=$,S.lookahead+S.insert>=D)for(U=S.strstart-S.insert,S.ins_h=S.window[U],S.ins_h=(S.ins_h<<S.hash_shift^S.window[U+1])&S.hash_mask;S.insert&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[U+D-1])&S.hash_mask,S.prev[U&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=U,U++,S.insert--,!(S.lookahead+S.insert<D)););}while(S.lookahead<ae&&S.strm.avail_in!==0)}function Ie(S,z){for(var $,A;;){if(S.lookahead<ae){if(xe(S),S.lookahead<ae&&z===p)return C;if(S.lookahead===0)break}if($=0,S.lookahead>=D&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+D-1])&S.hash_mask,$=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),$!==0&&S.strstart-$<=S.w_size-ae&&(S.match_length=le(S,$)),S.match_length>=D)if(A=a._tr_tally(S,S.strstart-S.match_start,S.match_length-D),S.lookahead-=S.match_length,S.match_length<=S.max_lazy_match&&S.lookahead>=D){for(S.match_length--;S.strstart++,S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+D-1])&S.hash_mask,$=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart,--S.match_length!=0;);S.strstart++}else S.strstart+=S.match_length,S.match_length=0,S.ins_h=S.window[S.strstart],S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+1])&S.hash_mask;else A=a._tr_tally(S,0,S.window[S.strstart]),S.lookahead--,S.strstart++;if(A&&(V(S,!1),S.strm.avail_out===0))return C}return S.insert=S.strstart<D-1?S.strstart:D-1,z===m?(V(S,!0),S.strm.avail_out===0?ce:X):S.last_lit&&(V(S,!1),S.strm.avail_out===0)?C:G}function Ne(S,z){for(var $,A,b;;){if(S.lookahead<ae){if(xe(S),S.lookahead<ae&&z===p)return C;if(S.lookahead===0)break}if($=0,S.lookahead>=D&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+D-1])&S.hash_mask,$=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),S.prev_length=S.match_length,S.prev_match=S.match_start,S.match_length=D-1,$!==0&&S.prev_length<S.max_lazy_match&&S.strstart-$<=S.w_size-ae&&(S.match_length=le(S,$),S.match_length<=5&&(S.strategy===1||S.match_length===D&&4096<S.strstart-S.match_start)&&(S.match_length=D-1)),S.prev_length>=D&&S.match_length<=S.prev_length){for(b=S.strstart+S.lookahead-D,A=a._tr_tally(S,S.strstart-1-S.prev_match,S.prev_length-D),S.lookahead-=S.prev_length-1,S.prev_length-=2;++S.strstart<=b&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+D-1])&S.hash_mask,$=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),--S.prev_length!=0;);if(S.match_available=0,S.match_length=D-1,S.strstart++,A&&(V(S,!1),S.strm.avail_out===0))return C}else if(S.match_available){if((A=a._tr_tally(S,0,S.window[S.strstart-1]))&&V(S,!1),S.strstart++,S.lookahead--,S.strm.avail_out===0)return C}else S.match_available=1,S.strstart++,S.lookahead--}return S.match_available&&(A=a._tr_tally(S,0,S.window[S.strstart-1]),S.match_available=0),S.insert=S.strstart<D-1?S.strstart:D-1,z===m?(V(S,!0),S.strm.avail_out===0?ce:X):S.last_lit&&(V(S,!1),S.strm.avail_out===0)?C:G}function ke(S,z,$,A,b){this.good_length=S,this.max_lazy=z,this.nice_length=$,this.max_chain=A,this.func=b}function Ue(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*k),this.dyn_dtree=new s.Buf16(2*(2*_+1)),this.bl_tree=new s.Buf16(2*(2*R+1)),ee(this.dyn_ltree),ee(this.dyn_dtree),ee(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(j+1),this.heap=new s.Buf16(2*I+1),ee(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*I+1),ee(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function De(S){var z;return S&&S.state?(S.total_in=S.total_out=0,S.data_type=y,(z=S.state).pending=0,z.pending_out=0,z.wrap<0&&(z.wrap=-z.wrap),z.status=z.wrap?P:W,S.adler=z.wrap===2?0:1,z.last_flush=p,a._tr_init(z),g):J(S,E)}function nt(S){var z=De(S);return z===g&&function($){$.window_size=2*$.w_size,ee($.head),$.max_lazy_match=i[$.level].max_lazy,$.good_match=i[$.level].good_length,$.nice_match=i[$.level].nice_length,$.max_chain_length=i[$.level].max_chain,$.strstart=0,$.block_start=0,$.lookahead=0,$.insert=0,$.match_length=$.prev_length=D-1,$.match_available=0,$.ins_h=0}(S.state),z}function et(S,z,$,A,b,U){if(!S)return E;var Q=1;if(z===v&&(z=6),A<0?(Q=0,A=-A):15<A&&(Q=2,A-=16),b<1||T<b||$!==x||A<8||15<A||z<0||9<z||U<0||w<U)return J(S,E);A===8&&(A=9);var ne=new Ue;return(S.state=ne).strm=S,ne.wrap=Q,ne.gzhead=null,ne.w_bits=A,ne.w_size=1<<ne.w_bits,ne.w_mask=ne.w_size-1,ne.hash_bits=b+7,ne.hash_size=1<<ne.hash_bits,ne.hash_mask=ne.hash_size-1,ne.hash_shift=~~((ne.hash_bits+D-1)/D),ne.window=new s.Buf8(2*ne.w_size),ne.head=new s.Buf16(ne.hash_size),ne.prev=new s.Buf16(ne.w_size),ne.lit_bufsize=1<<b+6,ne.pending_buf_size=4*ne.lit_bufsize,ne.pending_buf=new s.Buf8(ne.pending_buf_size),ne.d_buf=1*ne.lit_bufsize,ne.l_buf=3*ne.lit_bufsize,ne.level=z,ne.strategy=U,ne.method=$,nt(S)}i=[new ke(0,0,0,0,function(S,z){var $=65535;for($>S.pending_buf_size-5&&($=S.pending_buf_size-5);;){if(S.lookahead<=1){if(xe(S),S.lookahead===0&&z===p)return C;if(S.lookahead===0)break}S.strstart+=S.lookahead,S.lookahead=0;var A=S.block_start+$;if((S.strstart===0||S.strstart>=A)&&(S.lookahead=S.strstart-A,S.strstart=A,V(S,!1),S.strm.avail_out===0)||S.strstart-S.block_start>=S.w_size-ae&&(V(S,!1),S.strm.avail_out===0))return C}return S.insert=0,z===m?(V(S,!0),S.strm.avail_out===0?ce:X):(S.strstart>S.block_start&&(V(S,!1),S.strm.avail_out),C)}),new ke(4,4,8,4,Ie),new ke(4,5,16,8,Ie),new ke(4,6,32,32,Ie),new ke(4,4,16,16,Ne),new ke(8,16,32,32,Ne),new ke(8,16,128,128,Ne),new ke(8,32,128,256,Ne),new ke(32,128,258,1024,Ne),new ke(32,258,258,4096,Ne)],o.deflateInit=function(S,z){return et(S,z,x,15,8,0)},o.deflateInit2=et,o.deflateReset=nt,o.deflateResetKeep=De,o.deflateSetHeader=function(S,z){return S&&S.state?S.state.wrap!==2?E:(S.state.gzhead=z,g):E},o.deflate=function(S,z){var $,A,b,U;if(!S||!S.state||5<z||z<0)return S?J(S,E):E;if(A=S.state,!S.output||!S.input&&S.avail_in!==0||A.status===666&&z!==m)return J(S,S.avail_out===0?-5:E);if(A.strm=S,$=A.last_flush,A.last_flush=z,A.status===P)if(A.wrap===2)S.adler=0,fe(A,31),fe(A,139),fe(A,8),A.gzhead?(fe(A,(A.gzhead.text?1:0)+(A.gzhead.hcrc?2:0)+(A.gzhead.extra?4:0)+(A.gzhead.name?8:0)+(A.gzhead.comment?16:0)),fe(A,255&A.gzhead.time),fe(A,A.gzhead.time>>8&255),fe(A,A.gzhead.time>>16&255),fe(A,A.gzhead.time>>24&255),fe(A,A.level===9?2:2<=A.strategy||A.level<2?4:0),fe(A,255&A.gzhead.os),A.gzhead.extra&&A.gzhead.extra.length&&(fe(A,255&A.gzhead.extra.length),fe(A,A.gzhead.extra.length>>8&255)),A.gzhead.hcrc&&(S.adler=c(S.adler,A.pending_buf,A.pending,0)),A.gzindex=0,A.status=69):(fe(A,0),fe(A,0),fe(A,0),fe(A,0),fe(A,0),fe(A,A.level===9?2:2<=A.strategy||A.level<2?4:0),fe(A,3),A.status=W);else{var Q=x+(A.w_bits-8<<4)<<8;Q|=(2<=A.strategy||A.level<2?0:A.level<6?1:A.level===6?2:3)<<6,A.strstart!==0&&(Q|=32),Q+=31-Q%31,A.status=W,se(A,Q),A.strstart!==0&&(se(A,S.adler>>>16),se(A,65535&S.adler)),S.adler=1}if(A.status===69)if(A.gzhead.extra){for(b=A.pending;A.gzindex<(65535&A.gzhead.extra.length)&&(A.pending!==A.pending_buf_size||(A.gzhead.hcrc&&A.pending>b&&(S.adler=c(S.adler,A.pending_buf,A.pending-b,b)),O(S),b=A.pending,A.pending!==A.pending_buf_size));)fe(A,255&A.gzhead.extra[A.gzindex]),A.gzindex++;A.gzhead.hcrc&&A.pending>b&&(S.adler=c(S.adler,A.pending_buf,A.pending-b,b)),A.gzindex===A.gzhead.extra.length&&(A.gzindex=0,A.status=73)}else A.status=73;if(A.status===73)if(A.gzhead.name){b=A.pending;do{if(A.pending===A.pending_buf_size&&(A.gzhead.hcrc&&A.pending>b&&(S.adler=c(S.adler,A.pending_buf,A.pending-b,b)),O(S),b=A.pending,A.pending===A.pending_buf_size)){U=1;break}U=A.gzindex<A.gzhead.name.length?255&A.gzhead.name.charCodeAt(A.gzindex++):0,fe(A,U)}while(U!==0);A.gzhead.hcrc&&A.pending>b&&(S.adler=c(S.adler,A.pending_buf,A.pending-b,b)),U===0&&(A.gzindex=0,A.status=91)}else A.status=91;if(A.status===91)if(A.gzhead.comment){b=A.pending;do{if(A.pending===A.pending_buf_size&&(A.gzhead.hcrc&&A.pending>b&&(S.adler=c(S.adler,A.pending_buf,A.pending-b,b)),O(S),b=A.pending,A.pending===A.pending_buf_size)){U=1;break}U=A.gzindex<A.gzhead.comment.length?255&A.gzhead.comment.charCodeAt(A.gzindex++):0,fe(A,U)}while(U!==0);A.gzhead.hcrc&&A.pending>b&&(S.adler=c(S.adler,A.pending_buf,A.pending-b,b)),U===0&&(A.status=103)}else A.status=103;if(A.status===103&&(A.gzhead.hcrc?(A.pending+2>A.pending_buf_size&&O(S),A.pending+2<=A.pending_buf_size&&(fe(A,255&S.adler),fe(A,S.adler>>8&255),S.adler=0,A.status=W)):A.status=W),A.pending!==0){if(O(S),S.avail_out===0)return A.last_flush=-1,g}else if(S.avail_in===0&&K(z)<=K($)&&z!==m)return J(S,-5);if(A.status===666&&S.avail_in!==0)return J(S,-5);if(S.avail_in!==0||A.lookahead!==0||z!==p&&A.status!==666){var ne=A.strategy===2?function(Y,te){for(var ie;;){if(Y.lookahead===0&&(xe(Y),Y.lookahead===0)){if(te===p)return C;break}if(Y.match_length=0,ie=a._tr_tally(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++,ie&&(V(Y,!1),Y.strm.avail_out===0))return C}return Y.insert=0,te===m?(V(Y,!0),Y.strm.avail_out===0?ce:X):Y.last_lit&&(V(Y,!1),Y.strm.avail_out===0)?C:G}(A,z):A.strategy===3?function(Y,te){for(var ie,ue,Ee,Le,be=Y.window;;){if(Y.lookahead<=q){if(xe(Y),Y.lookahead<=q&&te===p)return C;if(Y.lookahead===0)break}if(Y.match_length=0,Y.lookahead>=D&&0<Y.strstart&&(ue=be[Ee=Y.strstart-1])===be[++Ee]&&ue===be[++Ee]&&ue===be[++Ee]){Le=Y.strstart+q;do;while(ue===be[++Ee]&&ue===be[++Ee]&&ue===be[++Ee]&&ue===be[++Ee]&&ue===be[++Ee]&&ue===be[++Ee]&&ue===be[++Ee]&&ue===be[++Ee]&&Ee<Le);Y.match_length=q-(Le-Ee),Y.match_length>Y.lookahead&&(Y.match_length=Y.lookahead)}if(Y.match_length>=D?(ie=a._tr_tally(Y,1,Y.match_length-D),Y.lookahead-=Y.match_length,Y.strstart+=Y.match_length,Y.match_length=0):(ie=a._tr_tally(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++),ie&&(V(Y,!1),Y.strm.avail_out===0))return C}return Y.insert=0,te===m?(V(Y,!0),Y.strm.avail_out===0?ce:X):Y.last_lit&&(V(Y,!1),Y.strm.avail_out===0)?C:G}(A,z):i[A.level].func(A,z);if(ne!==ce&&ne!==X||(A.status=666),ne===C||ne===ce)return S.avail_out===0&&(A.last_flush=-1),g;if(ne===G&&(z===1?a._tr_align(A):z!==5&&(a._tr_stored_block(A,0,0,!1),z===3&&(ee(A.head),A.lookahead===0&&(A.strstart=0,A.block_start=0,A.insert=0))),O(S),S.avail_out===0))return A.last_flush=-1,g}return z!==m?g:A.wrap<=0?1:(A.wrap===2?(fe(A,255&S.adler),fe(A,S.adler>>8&255),fe(A,S.adler>>16&255),fe(A,S.adler>>24&255),fe(A,255&S.total_in),fe(A,S.total_in>>8&255),fe(A,S.total_in>>16&255),fe(A,S.total_in>>24&255)):(se(A,S.adler>>>16),se(A,65535&S.adler)),O(S),0<A.wrap&&(A.wrap=-A.wrap),A.pending!==0?g:1)},o.deflateEnd=function(S){var z;return S&&S.state?(z=S.state.status)!==P&&z!==69&&z!==73&&z!==91&&z!==103&&z!==W&&z!==666?J(S,E):(S.state=null,z===W?J(S,-3):g):E},o.deflateSetDictionary=function(S,z){var $,A,b,U,Q,ne,Y,te,ie=z.length;if(!S||!S.state||(U=($=S.state).wrap)===2||U===1&&$.status!==P||$.lookahead)return E;for(U===1&&(S.adler=u(S.adler,z,ie,0)),$.wrap=0,ie>=$.w_size&&(U===0&&(ee($.head),$.strstart=0,$.block_start=0,$.insert=0),te=new s.Buf8($.w_size),s.arraySet(te,z,ie-$.w_size,$.w_size,0),z=te,ie=$.w_size),Q=S.avail_in,ne=S.next_in,Y=S.input,S.avail_in=ie,S.next_in=0,S.input=z,xe($);$.lookahead>=D;){for(A=$.strstart,b=$.lookahead-(D-1);$.ins_h=($.ins_h<<$.hash_shift^$.window[A+D-1])&$.hash_mask,$.prev[A&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=A,A++,--b;);$.strstart=A,$.lookahead=D-1,xe($)}return $.strstart+=$.lookahead,$.block_start=$.strstart,$.insert=$.lookahead,$.lookahead=0,$.match_length=$.prev_length=D-1,$.match_available=0,S.next_in=ne,S.input=Y,S.avail_in=Q,$.wrap=U,g},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,o){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,o){r.exports=function(i,s){var a,u,c,h,p,m,g,E,v,w,y,x,T,I,_,R,k,j,D,q,ae,P,W,C,G;a=i.state,u=i.next_in,C=i.input,c=u+(i.avail_in-5),h=i.next_out,G=i.output,p=h-(s-i.avail_out),m=h+(i.avail_out-257),g=a.dmax,E=a.wsize,v=a.whave,w=a.wnext,y=a.window,x=a.hold,T=a.bits,I=a.lencode,_=a.distcode,R=(1<<a.lenbits)-1,k=(1<<a.distbits)-1;e:do{T<15&&(x+=C[u++]<<T,T+=8,x+=C[u++]<<T,T+=8),j=I[x&R];t:for(;;){if(x>>>=D=j>>>24,T-=D,(D=j>>>16&255)===0)G[h++]=65535&j;else{if(!(16&D)){if(!(64&D)){j=I[(65535&j)+(x&(1<<D)-1)];continue t}if(32&D){a.mode=12;break e}i.msg="invalid literal/length code",a.mode=30;break e}q=65535&j,(D&=15)&&(T<D&&(x+=C[u++]<<T,T+=8),q+=x&(1<<D)-1,x>>>=D,T-=D),T<15&&(x+=C[u++]<<T,T+=8,x+=C[u++]<<T,T+=8),j=_[x&k];n:for(;;){if(x>>>=D=j>>>24,T-=D,!(16&(D=j>>>16&255))){if(!(64&D)){j=_[(65535&j)+(x&(1<<D)-1)];continue n}i.msg="invalid distance code",a.mode=30;break e}if(ae=65535&j,T<(D&=15)&&(x+=C[u++]<<T,(T+=8)<D&&(x+=C[u++]<<T,T+=8)),g<(ae+=x&(1<<D)-1)){i.msg="invalid distance too far back",a.mode=30;break e}if(x>>>=D,T-=D,(D=h-p)<ae){if(v<(D=ae-D)&&a.sane){i.msg="invalid distance too far back",a.mode=30;break e}if(W=y,(P=0)===w){if(P+=E-D,D<q){for(q-=D;G[h++]=y[P++],--D;);P=h-ae,W=G}}else if(w<D){if(P+=E+w-D,(D-=w)<q){for(q-=D;G[h++]=y[P++],--D;);if(P=0,w<q){for(q-=D=w;G[h++]=y[P++],--D;);P=h-ae,W=G}}}else if(P+=w-D,D<q){for(q-=D;G[h++]=y[P++],--D;);P=h-ae,W=G}for(;2<q;)G[h++]=W[P++],G[h++]=W[P++],G[h++]=W[P++],q-=3;q&&(G[h++]=W[P++],1<q&&(G[h++]=W[P++]))}else{for(P=h-ae;G[h++]=G[P++],G[h++]=G[P++],G[h++]=G[P++],2<(q-=3););q&&(G[h++]=G[P++],1<q&&(G[h++]=G[P++]))}break}}break}}while(u<c&&h<m);u-=q=T>>3,x&=(1<<(T-=q<<3))-1,i.next_in=u,i.next_out=h,i.avail_in=u<c?c-u+5:5-(u-c),i.avail_out=h<m?m-h+257:257-(h-m),a.hold=x,a.bits=T}},{}],49:[function(n,r,o){var i=n("../utils/common"),s=n("./adler32"),a=n("./crc32"),u=n("./inffast"),c=n("./inftrees"),h=1,p=2,m=0,g=-2,E=1,v=852,w=592;function y(P){return(P>>>24&255)+(P>>>8&65280)+((65280&P)<<8)+((255&P)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(P){var W;return P&&P.state?(W=P.state,P.total_in=P.total_out=W.total=0,P.msg="",W.wrap&&(P.adler=1&W.wrap),W.mode=E,W.last=0,W.havedict=0,W.dmax=32768,W.head=null,W.hold=0,W.bits=0,W.lencode=W.lendyn=new i.Buf32(v),W.distcode=W.distdyn=new i.Buf32(w),W.sane=1,W.back=-1,m):g}function I(P){var W;return P&&P.state?((W=P.state).wsize=0,W.whave=0,W.wnext=0,T(P)):g}function _(P,W){var C,G;return P&&P.state?(G=P.state,W<0?(C=0,W=-W):(C=1+(W>>4),W<48&&(W&=15)),W&&(W<8||15<W)?g:(G.window!==null&&G.wbits!==W&&(G.window=null),G.wrap=C,G.wbits=W,I(P))):g}function R(P,W){var C,G;return P?(G=new x,(P.state=G).window=null,(C=_(P,W))!==m&&(P.state=null),C):g}var k,j,D=!0;function q(P){if(D){var W;for(k=new i.Buf32(512),j=new i.Buf32(32),W=0;W<144;)P.lens[W++]=8;for(;W<256;)P.lens[W++]=9;for(;W<280;)P.lens[W++]=7;for(;W<288;)P.lens[W++]=8;for(c(h,P.lens,0,288,k,0,P.work,{bits:9}),W=0;W<32;)P.lens[W++]=5;c(p,P.lens,0,32,j,0,P.work,{bits:5}),D=!1}P.lencode=k,P.lenbits=9,P.distcode=j,P.distbits=5}function ae(P,W,C,G){var ce,X=P.state;return X.window===null&&(X.wsize=1<<X.wbits,X.wnext=0,X.whave=0,X.window=new i.Buf8(X.wsize)),G>=X.wsize?(i.arraySet(X.window,W,C-X.wsize,X.wsize,0),X.wnext=0,X.whave=X.wsize):(G<(ce=X.wsize-X.wnext)&&(ce=G),i.arraySet(X.window,W,C-G,ce,X.wnext),(G-=ce)?(i.arraySet(X.window,W,C-G,G,0),X.wnext=G,X.whave=X.wsize):(X.wnext+=ce,X.wnext===X.wsize&&(X.wnext=0),X.whave<X.wsize&&(X.whave+=ce))),0}o.inflateReset=I,o.inflateReset2=_,o.inflateResetKeep=T,o.inflateInit=function(P){return R(P,15)},o.inflateInit2=R,o.inflate=function(P,W){var C,G,ce,X,J,K,ee,O,V,fe,se,le,xe,Ie,Ne,ke,Ue,De,nt,et,S,z,$,A,b=0,U=new i.Buf8(4),Q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!P||!P.state||!P.output||!P.input&&P.avail_in!==0)return g;(C=P.state).mode===12&&(C.mode=13),J=P.next_out,ce=P.output,ee=P.avail_out,X=P.next_in,G=P.input,K=P.avail_in,O=C.hold,V=C.bits,fe=K,se=ee,z=m;e:for(;;)switch(C.mode){case E:if(C.wrap===0){C.mode=13;break}for(;V<16;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}if(2&C.wrap&&O===35615){U[C.check=0]=255&O,U[1]=O>>>8&255,C.check=a(C.check,U,2,0),V=O=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&O)<<8)+(O>>8))%31){P.msg="incorrect header check",C.mode=30;break}if((15&O)!=8){P.msg="unknown compression method",C.mode=30;break}if(V-=4,S=8+(15&(O>>>=4)),C.wbits===0)C.wbits=S;else if(S>C.wbits){P.msg="invalid window size",C.mode=30;break}C.dmax=1<<S,P.adler=C.check=1,C.mode=512&O?10:12,V=O=0;break;case 2:for(;V<16;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}if(C.flags=O,(255&C.flags)!=8){P.msg="unknown compression method",C.mode=30;break}if(57344&C.flags){P.msg="unknown header flags set",C.mode=30;break}C.head&&(C.head.text=O>>8&1),512&C.flags&&(U[0]=255&O,U[1]=O>>>8&255,C.check=a(C.check,U,2,0)),V=O=0,C.mode=3;case 3:for(;V<32;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}C.head&&(C.head.time=O),512&C.flags&&(U[0]=255&O,U[1]=O>>>8&255,U[2]=O>>>16&255,U[3]=O>>>24&255,C.check=a(C.check,U,4,0)),V=O=0,C.mode=4;case 4:for(;V<16;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}C.head&&(C.head.xflags=255&O,C.head.os=O>>8),512&C.flags&&(U[0]=255&O,U[1]=O>>>8&255,C.check=a(C.check,U,2,0)),V=O=0,C.mode=5;case 5:if(1024&C.flags){for(;V<16;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}C.length=O,C.head&&(C.head.extra_len=O),512&C.flags&&(U[0]=255&O,U[1]=O>>>8&255,C.check=a(C.check,U,2,0)),V=O=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(K<(le=C.length)&&(le=K),le&&(C.head&&(S=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Array(C.head.extra_len)),i.arraySet(C.head.extra,G,X,le,S)),512&C.flags&&(C.check=a(C.check,G,le,X)),K-=le,X+=le,C.length-=le),C.length))break e;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(K===0)break e;for(le=0;S=G[X+le++],C.head&&S&&C.length<65536&&(C.head.name+=String.fromCharCode(S)),S&&le<K;);if(512&C.flags&&(C.check=a(C.check,G,le,X)),K-=le,X+=le,S)break e}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(K===0)break e;for(le=0;S=G[X+le++],C.head&&S&&C.length<65536&&(C.head.comment+=String.fromCharCode(S)),S&&le<K;);if(512&C.flags&&(C.check=a(C.check,G,le,X)),K-=le,X+=le,S)break e}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;V<16;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}if(O!==(65535&C.check)){P.msg="header crc mismatch",C.mode=30;break}V=O=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),P.adler=C.check=0,C.mode=12;break;case 10:for(;V<32;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}P.adler=C.check=y(O),V=O=0,C.mode=11;case 11:if(C.havedict===0)return P.next_out=J,P.avail_out=ee,P.next_in=X,P.avail_in=K,C.hold=O,C.bits=V,2;P.adler=C.check=1,C.mode=12;case 12:if(W===5||W===6)break e;case 13:if(C.last){O>>>=7&V,V-=7&V,C.mode=27;break}for(;V<3;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}switch(C.last=1&O,V-=1,3&(O>>>=1)){case 0:C.mode=14;break;case 1:if(q(C),C.mode=20,W!==6)break;O>>>=2,V-=2;break e;case 2:C.mode=17;break;case 3:P.msg="invalid block type",C.mode=30}O>>>=2,V-=2;break;case 14:for(O>>>=7&V,V-=7&V;V<32;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}if((65535&O)!=(O>>>16^65535)){P.msg="invalid stored block lengths",C.mode=30;break}if(C.length=65535&O,V=O=0,C.mode=15,W===6)break e;case 15:C.mode=16;case 16:if(le=C.length){if(K<le&&(le=K),ee<le&&(le=ee),le===0)break e;i.arraySet(ce,G,X,le,J),K-=le,X+=le,ee-=le,J+=le,C.length-=le;break}C.mode=12;break;case 17:for(;V<14;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}if(C.nlen=257+(31&O),O>>>=5,V-=5,C.ndist=1+(31&O),O>>>=5,V-=5,C.ncode=4+(15&O),O>>>=4,V-=4,286<C.nlen||30<C.ndist){P.msg="too many length or distance symbols",C.mode=30;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;V<3;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}C.lens[Q[C.have++]]=7&O,O>>>=3,V-=3}for(;C.have<19;)C.lens[Q[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,$={bits:C.lenbits},z=c(0,C.lens,0,19,C.lencode,0,C.work,$),C.lenbits=$.bits,z){P.msg="invalid code lengths set",C.mode=30;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;ke=(b=C.lencode[O&(1<<C.lenbits)-1])>>>16&255,Ue=65535&b,!((Ne=b>>>24)<=V);){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}if(Ue<16)O>>>=Ne,V-=Ne,C.lens[C.have++]=Ue;else{if(Ue===16){for(A=Ne+2;V<A;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}if(O>>>=Ne,V-=Ne,C.have===0){P.msg="invalid bit length repeat",C.mode=30;break}S=C.lens[C.have-1],le=3+(3&O),O>>>=2,V-=2}else if(Ue===17){for(A=Ne+3;V<A;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}V-=Ne,S=0,le=3+(7&(O>>>=Ne)),O>>>=3,V-=3}else{for(A=Ne+7;V<A;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}V-=Ne,S=0,le=11+(127&(O>>>=Ne)),O>>>=7,V-=7}if(C.have+le>C.nlen+C.ndist){P.msg="invalid bit length repeat",C.mode=30;break}for(;le--;)C.lens[C.have++]=S}}if(C.mode===30)break;if(C.lens[256]===0){P.msg="invalid code -- missing end-of-block",C.mode=30;break}if(C.lenbits=9,$={bits:C.lenbits},z=c(h,C.lens,0,C.nlen,C.lencode,0,C.work,$),C.lenbits=$.bits,z){P.msg="invalid literal/lengths set",C.mode=30;break}if(C.distbits=6,C.distcode=C.distdyn,$={bits:C.distbits},z=c(p,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,$),C.distbits=$.bits,z){P.msg="invalid distances set",C.mode=30;break}if(C.mode=20,W===6)break e;case 20:C.mode=21;case 21:if(6<=K&&258<=ee){P.next_out=J,P.avail_out=ee,P.next_in=X,P.avail_in=K,C.hold=O,C.bits=V,u(P,se),J=P.next_out,ce=P.output,ee=P.avail_out,X=P.next_in,G=P.input,K=P.avail_in,O=C.hold,V=C.bits,C.mode===12&&(C.back=-1);break}for(C.back=0;ke=(b=C.lencode[O&(1<<C.lenbits)-1])>>>16&255,Ue=65535&b,!((Ne=b>>>24)<=V);){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}if(ke&&!(240&ke)){for(De=Ne,nt=ke,et=Ue;ke=(b=C.lencode[et+((O&(1<<De+nt)-1)>>De)])>>>16&255,Ue=65535&b,!(De+(Ne=b>>>24)<=V);){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}O>>>=De,V-=De,C.back+=De}if(O>>>=Ne,V-=Ne,C.back+=Ne,C.length=Ue,ke===0){C.mode=26;break}if(32&ke){C.back=-1,C.mode=12;break}if(64&ke){P.msg="invalid literal/length code",C.mode=30;break}C.extra=15&ke,C.mode=22;case 22:if(C.extra){for(A=C.extra;V<A;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}C.length+=O&(1<<C.extra)-1,O>>>=C.extra,V-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;ke=(b=C.distcode[O&(1<<C.distbits)-1])>>>16&255,Ue=65535&b,!((Ne=b>>>24)<=V);){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}if(!(240&ke)){for(De=Ne,nt=ke,et=Ue;ke=(b=C.distcode[et+((O&(1<<De+nt)-1)>>De)])>>>16&255,Ue=65535&b,!(De+(Ne=b>>>24)<=V);){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}O>>>=De,V-=De,C.back+=De}if(O>>>=Ne,V-=Ne,C.back+=Ne,64&ke){P.msg="invalid distance code",C.mode=30;break}C.offset=Ue,C.extra=15&ke,C.mode=24;case 24:if(C.extra){for(A=C.extra;V<A;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}C.offset+=O&(1<<C.extra)-1,O>>>=C.extra,V-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){P.msg="invalid distance too far back",C.mode=30;break}C.mode=25;case 25:if(ee===0)break e;if(le=se-ee,C.offset>le){if((le=C.offset-le)>C.whave&&C.sane){P.msg="invalid distance too far back",C.mode=30;break}xe=le>C.wnext?(le-=C.wnext,C.wsize-le):C.wnext-le,le>C.length&&(le=C.length),Ie=C.window}else Ie=ce,xe=J-C.offset,le=C.length;for(ee<le&&(le=ee),ee-=le,C.length-=le;ce[J++]=Ie[xe++],--le;);C.length===0&&(C.mode=21);break;case 26:if(ee===0)break e;ce[J++]=C.length,ee--,C.mode=21;break;case 27:if(C.wrap){for(;V<32;){if(K===0)break e;K--,O|=G[X++]<<V,V+=8}if(se-=ee,P.total_out+=se,C.total+=se,se&&(P.adler=C.check=C.flags?a(C.check,ce,se,J-se):s(C.check,ce,se,J-se)),se=ee,(C.flags?O:y(O))!==C.check){P.msg="incorrect data check",C.mode=30;break}V=O=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;V<32;){if(K===0)break e;K--,O+=G[X++]<<V,V+=8}if(O!==(4294967295&C.total)){P.msg="incorrect length check",C.mode=30;break}V=O=0}C.mode=29;case 29:z=1;break e;case 30:z=-3;break e;case 31:return-4;case 32:default:return g}return P.next_out=J,P.avail_out=ee,P.next_in=X,P.avail_in=K,C.hold=O,C.bits=V,(C.wsize||se!==P.avail_out&&C.mode<30&&(C.mode<27||W!==4))&&ae(P,P.output,P.next_out,se-P.avail_out)?(C.mode=31,-4):(fe-=P.avail_in,se-=P.avail_out,P.total_in+=fe,P.total_out+=se,C.total+=se,C.wrap&&se&&(P.adler=C.check=C.flags?a(C.check,ce,se,P.next_out-se):s(C.check,ce,se,P.next_out-se)),P.data_type=C.bits+(C.last?64:0)+(C.mode===12?128:0)+(C.mode===20||C.mode===15?256:0),(fe==0&&se===0||W===4)&&z===m&&(z=-5),z)},o.inflateEnd=function(P){if(!P||!P.state)return g;var W=P.state;return W.window&&(W.window=null),P.state=null,m},o.inflateGetHeader=function(P,W){var C;return P&&P.state&&2&(C=P.state).wrap?((C.head=W).done=!1,m):g},o.inflateSetDictionary=function(P,W){var C,G=W.length;return P&&P.state?(C=P.state).wrap!==0&&C.mode!==11?g:C.mode===11&&s(1,W,G,0)!==C.check?-3:ae(P,W,G,G)?(C.mode=31,-4):(C.havedict=1,m):g},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,o){var i=n("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(h,p,m,g,E,v,w,y){var x,T,I,_,R,k,j,D,q,ae=y.bits,P=0,W=0,C=0,G=0,ce=0,X=0,J=0,K=0,ee=0,O=0,V=null,fe=0,se=new i.Buf16(16),le=new i.Buf16(16),xe=null,Ie=0;for(P=0;P<=15;P++)se[P]=0;for(W=0;W<g;W++)se[p[m+W]]++;for(ce=ae,G=15;1<=G&&se[G]===0;G--);if(G<ce&&(ce=G),G===0)return E[v++]=20971520,E[v++]=20971520,y.bits=1,0;for(C=1;C<G&&se[C]===0;C++);for(ce<C&&(ce=C),P=K=1;P<=15;P++)if(K<<=1,(K-=se[P])<0)return-1;if(0<K&&(h===0||G!==1))return-1;for(le[1]=0,P=1;P<15;P++)le[P+1]=le[P]+se[P];for(W=0;W<g;W++)p[m+W]!==0&&(w[le[p[m+W]]++]=W);if(k=h===0?(V=xe=w,19):h===1?(V=s,fe-=257,xe=a,Ie-=257,256):(V=u,xe=c,-1),P=C,R=v,J=W=O=0,I=-1,_=(ee=1<<(X=ce))-1,h===1&&852<ee||h===2&&592<ee)return 1;for(;;){for(j=P-J,q=w[W]<k?(D=0,w[W]):w[W]>k?(D=xe[Ie+w[W]],V[fe+w[W]]):(D=96,0),x=1<<P-J,C=T=1<<X;E[R+(O>>J)+(T-=x)]=j<<24|D<<16|q|0,T!==0;);for(x=1<<P-1;O&x;)x>>=1;if(x!==0?(O&=x-1,O+=x):O=0,W++,--se[P]==0){if(P===G)break;P=p[m+w[W]]}if(ce<P&&(O&_)!==I){for(J===0&&(J=ce),R+=C,K=1<<(X=P-J);X+J<G&&!((K-=se[X+J])<=0);)X++,K<<=1;if(ee+=1<<X,h===1&&852<ee||h===2&&592<ee)return 1;E[I=O&_]=ce<<24|X<<16|R-v|0}}return O!==0&&(E[R+O]=P-J<<24|64<<16|0),y.bits=ce,0}},{"../utils/common":41}],51:[function(n,r,o){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,o){var i=n("../utils/common"),s=0,a=1;function u(b){for(var U=b.length;0<=--U;)b[U]=0}var c=0,h=29,p=256,m=p+1+h,g=30,E=19,v=2*m+1,w=15,y=16,x=7,T=256,I=16,_=17,R=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ae=new Array(2*(m+2));u(ae);var P=new Array(2*g);u(P);var W=new Array(512);u(W);var C=new Array(256);u(C);var G=new Array(h);u(G);var ce,X,J,K=new Array(g);function ee(b,U,Q,ne,Y){this.static_tree=b,this.extra_bits=U,this.extra_base=Q,this.elems=ne,this.max_length=Y,this.has_stree=b&&b.length}function O(b,U){this.dyn_tree=b,this.max_code=0,this.stat_desc=U}function V(b){return b<256?W[b]:W[256+(b>>>7)]}function fe(b,U){b.pending_buf[b.pending++]=255&U,b.pending_buf[b.pending++]=U>>>8&255}function se(b,U,Q){b.bi_valid>y-Q?(b.bi_buf|=U<<b.bi_valid&65535,fe(b,b.bi_buf),b.bi_buf=U>>y-b.bi_valid,b.bi_valid+=Q-y):(b.bi_buf|=U<<b.bi_valid&65535,b.bi_valid+=Q)}function le(b,U,Q){se(b,Q[2*U],Q[2*U+1])}function xe(b,U){for(var Q=0;Q|=1&b,b>>>=1,Q<<=1,0<--U;);return Q>>>1}function Ie(b,U,Q){var ne,Y,te=new Array(w+1),ie=0;for(ne=1;ne<=w;ne++)te[ne]=ie=ie+Q[ne-1]<<1;for(Y=0;Y<=U;Y++){var ue=b[2*Y+1];ue!==0&&(b[2*Y]=xe(te[ue]++,ue))}}function Ne(b){var U;for(U=0;U<m;U++)b.dyn_ltree[2*U]=0;for(U=0;U<g;U++)b.dyn_dtree[2*U]=0;for(U=0;U<E;U++)b.bl_tree[2*U]=0;b.dyn_ltree[2*T]=1,b.opt_len=b.static_len=0,b.last_lit=b.matches=0}function ke(b){8<b.bi_valid?fe(b,b.bi_buf):0<b.bi_valid&&(b.pending_buf[b.pending++]=b.bi_buf),b.bi_buf=0,b.bi_valid=0}function Ue(b,U,Q,ne){var Y=2*U,te=2*Q;return b[Y]<b[te]||b[Y]===b[te]&&ne[U]<=ne[Q]}function De(b,U,Q){for(var ne=b.heap[Q],Y=Q<<1;Y<=b.heap_len&&(Y<b.heap_len&&Ue(U,b.heap[Y+1],b.heap[Y],b.depth)&&Y++,!Ue(U,ne,b.heap[Y],b.depth));)b.heap[Q]=b.heap[Y],Q=Y,Y<<=1;b.heap[Q]=ne}function nt(b,U,Q){var ne,Y,te,ie,ue=0;if(b.last_lit!==0)for(;ne=b.pending_buf[b.d_buf+2*ue]<<8|b.pending_buf[b.d_buf+2*ue+1],Y=b.pending_buf[b.l_buf+ue],ue++,ne===0?le(b,Y,U):(le(b,(te=C[Y])+p+1,U),(ie=k[te])!==0&&se(b,Y-=G[te],ie),le(b,te=V(--ne),Q),(ie=j[te])!==0&&se(b,ne-=K[te],ie)),ue<b.last_lit;);le(b,T,U)}function et(b,U){var Q,ne,Y,te=U.dyn_tree,ie=U.stat_desc.static_tree,ue=U.stat_desc.has_stree,Ee=U.stat_desc.elems,Le=-1;for(b.heap_len=0,b.heap_max=v,Q=0;Q<Ee;Q++)te[2*Q]!==0?(b.heap[++b.heap_len]=Le=Q,b.depth[Q]=0):te[2*Q+1]=0;for(;b.heap_len<2;)te[2*(Y=b.heap[++b.heap_len]=Le<2?++Le:0)]=1,b.depth[Y]=0,b.opt_len--,ue&&(b.static_len-=ie[2*Y+1]);for(U.max_code=Le,Q=b.heap_len>>1;1<=Q;Q--)De(b,te,Q);for(Y=Ee;Q=b.heap[1],b.heap[1]=b.heap[b.heap_len--],De(b,te,1),ne=b.heap[1],b.heap[--b.heap_max]=Q,b.heap[--b.heap_max]=ne,te[2*Y]=te[2*Q]+te[2*ne],b.depth[Y]=(b.depth[Q]>=b.depth[ne]?b.depth[Q]:b.depth[ne])+1,te[2*Q+1]=te[2*ne+1]=Y,b.heap[1]=Y++,De(b,te,1),2<=b.heap_len;);b.heap[--b.heap_max]=b.heap[1],function(be,Be){var re,me,L,N,H,M,F=Be.dyn_tree,Z=Be.max_code,B=Be.stat_desc.static_tree,pe=Be.stat_desc.has_stree,ye=Be.stat_desc.extra_bits,Se=Be.stat_desc.extra_base,Ce=Be.stat_desc.max_length,Oe=0;for(N=0;N<=w;N++)be.bl_count[N]=0;for(F[2*be.heap[be.heap_max]+1]=0,re=be.heap_max+1;re<v;re++)Ce<(N=F[2*F[2*(me=be.heap[re])+1]+1]+1)&&(N=Ce,Oe++),F[2*me+1]=N,Z<me||(be.bl_count[N]++,H=0,Se<=me&&(H=ye[me-Se]),M=F[2*me],be.opt_len+=M*(N+H),pe&&(be.static_len+=M*(B[2*me+1]+H)));if(Oe!==0){do{for(N=Ce-1;be.bl_count[N]===0;)N--;be.bl_count[N]--,be.bl_count[N+1]+=2,be.bl_count[Ce]--,Oe-=2}while(0<Oe);for(N=Ce;N!==0;N--)for(me=be.bl_count[N];me!==0;)Z<(L=be.heap[--re])||(F[2*L+1]!==N&&(be.opt_len+=(N-F[2*L+1])*F[2*L],F[2*L+1]=N),me--)}}(b,U),Ie(te,Le,b.bl_count)}function S(b,U,Q){var ne,Y,te=-1,ie=U[1],ue=0,Ee=7,Le=4;for(ie===0&&(Ee=138,Le=3),U[2*(Q+1)+1]=65535,ne=0;ne<=Q;ne++)Y=ie,ie=U[2*(ne+1)+1],++ue<Ee&&Y===ie||(ue<Le?b.bl_tree[2*Y]+=ue:Y!==0?(Y!==te&&b.bl_tree[2*Y]++,b.bl_tree[2*I]++):ue<=10?b.bl_tree[2*_]++:b.bl_tree[2*R]++,te=Y,Le=(ue=0)===ie?(Ee=138,3):Y===ie?(Ee=6,3):(Ee=7,4))}function z(b,U,Q){var ne,Y,te=-1,ie=U[1],ue=0,Ee=7,Le=4;for(ie===0&&(Ee=138,Le=3),ne=0;ne<=Q;ne++)if(Y=ie,ie=U[2*(ne+1)+1],!(++ue<Ee&&Y===ie)){if(ue<Le)for(;le(b,Y,b.bl_tree),--ue!=0;);else Y!==0?(Y!==te&&(le(b,Y,b.bl_tree),ue--),le(b,I,b.bl_tree),se(b,ue-3,2)):ue<=10?(le(b,_,b.bl_tree),se(b,ue-3,3)):(le(b,R,b.bl_tree),se(b,ue-11,7));te=Y,Le=(ue=0)===ie?(Ee=138,3):Y===ie?(Ee=6,3):(Ee=7,4)}}u(K);var $=!1;function A(b,U,Q,ne){se(b,(c<<1)+(ne?1:0),3),function(Y,te,ie,ue){ke(Y),fe(Y,ie),fe(Y,~ie),i.arraySet(Y.pending_buf,Y.window,te,ie,Y.pending),Y.pending+=ie}(b,U,Q)}o._tr_init=function(b){$||(function(){var U,Q,ne,Y,te,ie=new Array(w+1);for(Y=ne=0;Y<h-1;Y++)for(G[Y]=ne,U=0;U<1<<k[Y];U++)C[ne++]=Y;for(C[ne-1]=Y,Y=te=0;Y<16;Y++)for(K[Y]=te,U=0;U<1<<j[Y];U++)W[te++]=Y;for(te>>=7;Y<g;Y++)for(K[Y]=te<<7,U=0;U<1<<j[Y]-7;U++)W[256+te++]=Y;for(Q=0;Q<=w;Q++)ie[Q]=0;for(U=0;U<=143;)ae[2*U+1]=8,U++,ie[8]++;for(;U<=255;)ae[2*U+1]=9,U++,ie[9]++;for(;U<=279;)ae[2*U+1]=7,U++,ie[7]++;for(;U<=287;)ae[2*U+1]=8,U++,ie[8]++;for(Ie(ae,m+1,ie),U=0;U<g;U++)P[2*U+1]=5,P[2*U]=xe(U,5);ce=new ee(ae,k,p+1,m,w),X=new ee(P,j,0,g,w),J=new ee(new Array(0),D,0,E,x)}(),$=!0),b.l_desc=new O(b.dyn_ltree,ce),b.d_desc=new O(b.dyn_dtree,X),b.bl_desc=new O(b.bl_tree,J),b.bi_buf=0,b.bi_valid=0,Ne(b)},o._tr_stored_block=A,o._tr_flush_block=function(b,U,Q,ne){var Y,te,ie=0;0<b.level?(b.strm.data_type===2&&(b.strm.data_type=function(ue){var Ee,Le=4093624447;for(Ee=0;Ee<=31;Ee++,Le>>>=1)if(1&Le&&ue.dyn_ltree[2*Ee]!==0)return s;if(ue.dyn_ltree[18]!==0||ue.dyn_ltree[20]!==0||ue.dyn_ltree[26]!==0)return a;for(Ee=32;Ee<p;Ee++)if(ue.dyn_ltree[2*Ee]!==0)return a;return s}(b)),et(b,b.l_desc),et(b,b.d_desc),ie=function(ue){var Ee;for(S(ue,ue.dyn_ltree,ue.l_desc.max_code),S(ue,ue.dyn_dtree,ue.d_desc.max_code),et(ue,ue.bl_desc),Ee=E-1;3<=Ee&&ue.bl_tree[2*q[Ee]+1]===0;Ee--);return ue.opt_len+=3*(Ee+1)+5+5+4,Ee}(b),Y=b.opt_len+3+7>>>3,(te=b.static_len+3+7>>>3)<=Y&&(Y=te)):Y=te=Q+5,Q+4<=Y&&U!==-1?A(b,U,Q,ne):b.strategy===4||te===Y?(se(b,2+(ne?1:0),3),nt(b,ae,P)):(se(b,4+(ne?1:0),3),function(ue,Ee,Le,be){var Be;for(se(ue,Ee-257,5),se(ue,Le-1,5),se(ue,be-4,4),Be=0;Be<be;Be++)se(ue,ue.bl_tree[2*q[Be]+1],3);z(ue,ue.dyn_ltree,Ee-1),z(ue,ue.dyn_dtree,Le-1)}(b,b.l_desc.max_code+1,b.d_desc.max_code+1,ie+1),nt(b,b.dyn_ltree,b.dyn_dtree)),Ne(b),ne&&ke(b)},o._tr_tally=function(b,U,Q){return b.pending_buf[b.d_buf+2*b.last_lit]=U>>>8&255,b.pending_buf[b.d_buf+2*b.last_lit+1]=255&U,b.pending_buf[b.l_buf+b.last_lit]=255&Q,b.last_lit++,U===0?b.dyn_ltree[2*Q]++:(b.matches++,U--,b.dyn_ltree[2*(C[Q]+p+1)]++,b.dyn_dtree[2*V(U)]++),b.last_lit===b.lit_bufsize-1},o._tr_align=function(b){se(b,2,3),le(b,T,ae),function(U){U.bi_valid===16?(fe(U,U.bi_buf),U.bi_buf=0,U.bi_valid=0):8<=U.bi_valid&&(U.pending_buf[U.pending++]=255&U.bi_buf,U.bi_buf>>=8,U.bi_valid-=8)}(b)}},{"../utils/common":41}],53:[function(n,r,o){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,o){(function(i){(function(s,a){if(!s.setImmediate){var u,c,h,p,m=1,g={},E=!1,v=s.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(s);w=w&&w.setTimeout?w:s,u={}.toString.call(s.process)==="[object process]"?function(I){process.nextTick(function(){x(I)})}:function(){if(s.postMessage&&!s.importScripts){var I=!0,_=s.onmessage;return s.onmessage=function(){I=!1},s.postMessage("","*"),s.onmessage=_,I}}()?(p="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",T,!1):s.attachEvent("onmessage",T),function(I){s.postMessage(p+I,"*")}):s.MessageChannel?((h=new MessageChannel).port1.onmessage=function(I){x(I.data)},function(I){h.port2.postMessage(I)}):v&&"onreadystatechange"in v.createElement("script")?(c=v.documentElement,function(I){var _=v.createElement("script");_.onreadystatechange=function(){x(I),_.onreadystatechange=null,c.removeChild(_),_=null},c.appendChild(_)}):function(I){setTimeout(x,0,I)},w.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var _=new Array(arguments.length-1),R=0;R<_.length;R++)_[R]=arguments[R+1];var k={callback:I,args:_};return g[m]=k,u(m),m++},w.clearImmediate=y}function y(I){delete g[I]}function x(I){if(E)setTimeout(x,0,I);else{var _=g[I];if(_){E=!0;try{(function(R){var k=R.callback,j=R.args;switch(j.length){case 0:k();break;case 1:k(j[0]);break;case 2:k(j[0],j[1]);break;case 3:k(j[0],j[1],j[2]);break;default:k.apply(a,j)}})(_)}finally{y(I),E=!1}}}}function T(I){I.source===s&&typeof I.data=="string"&&I.data.indexOf(p)===0&&x(+I.data.slice(p.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof un<"u"?un:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(bm);var jC=bm.exports;const hl=pf(jC);var Am={exports:{}};(function(t,e){(function(n,r){r()})(un,function(){function n(c,h){return typeof h>"u"?h={autoBom:!1}:typeof h!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),h={autoBom:!h}),h.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c}function r(c,h,p){var m=new XMLHttpRequest;m.open("GET",c),m.responseType="blob",m.onload=function(){u(m.response,h,p)},m.onerror=function(){console.error("could not download file")},m.send()}function o(c){var h=new XMLHttpRequest;h.open("HEAD",c,!1);try{h.send()}catch{}return 200<=h.status&&299>=h.status}function i(c){try{c.dispatchEvent(new MouseEvent("click"))}catch{var h=document.createEvent("MouseEvents");h.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),c.dispatchEvent(h)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof un=="object"&&un.global===un?un:void 0,a=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(c,h,p){var m=s.URL||s.webkitURL,g=document.createElement("a");h=h||c.name||"download",g.download=h,g.rel="noopener",typeof c=="string"?(g.href=c,g.origin===location.origin?i(g):o(g.href)?r(c,h,p):i(g,g.target="_blank")):(g.href=m.createObjectURL(c),setTimeout(function(){m.revokeObjectURL(g.href)},4e4),setTimeout(function(){i(g)},0))}:"msSaveOrOpenBlob"in navigator?function(c,h,p){if(h=h||c.name||"download",typeof c!="string")navigator.msSaveOrOpenBlob(n(c,p),h);else if(o(c))r(c,h,p);else{var m=document.createElement("a");m.href=c,m.target="_blank",setTimeout(function(){i(m)})}}:function(c,h,p,m){if(m=m||open("","_blank"),m&&(m.document.title=m.document.body.innerText="downloading..."),typeof c=="string")return r(c,h,p);var g=c.type==="application/octet-stream",E=/constructor/i.test(s.HTMLElement)||s.safari,v=/CriOS\/[\d]+/.test(navigator.userAgent);if((v||g&&E||a)&&typeof FileReader<"u"){var w=new FileReader;w.onloadend=function(){var T=w.result;T=v?T:T.replace(/^data:[^;]*;/,"data:attachment/file;"),m?m.location.href=T:location=T,m=null},w.readAsDataURL(c)}else{var y=s.URL||s.webkitURL,x=y.createObjectURL(c);m?m.location=x:location.href=x,m=null,setTimeout(function(){y.revokeObjectURL(x)},4e4)}});s.saveAs=u.saveAs=u,t.exports=u})})(Am);var _i=Am.exports;const ff=[{value:"background",label:"  ( )"},{value:"full",label:"  ()"},{value:"mls",label:"  ( )"},{value:"ws",label:"  ( , )"},{value:"bs",label:"  ( )"},{value:"cu",label:" ()"}],$C=t=>{switch(t){case"mls":return"[CAMERA] Knee Shot (Medium Long)";case"ws":return"[CAMERA] Waist Shot";case"bs":return"[CAMERA] Bust Shot";case"full":return"[CAMERA] Full Shot";case"cu":return"[CAMERA] Close Up";default:return""}},WC=(t,e)=>{if(!t)return"";const n=t.split(`
`),r=[],o=["","","","  ","Guideline","Instruction","","","","Season","Weather","Lighting","Atmosphere","Mood","Tone"," ","Special Space","","Overall"],i=e.replace(/[^\w\s-]/g,"").split(/\s+/).filter(a=>a.length>1);let s=!1;for(let a=0;a<n.length;a++){const u=n[a].trim();if(!u)continue;if(u.startsWith("#")||u.startsWith("*")&&u.includes("**")||u.startsWith("-")&&u.includes("**")){const h=o.some(m=>u.includes(m)),p=i.some(m=>u.includes(m))||u.includes(e);h||p?(s=!1,r.push(u)):u.includes("**")||u.startsWith("###")?s=!0:(s=!1,r.push(u))}else s||r.push(u)}return r.join(`
`)},qC=(t,e,n,r)=>{const o=h=>h.replace(/[\s\[\]\(\):]/g,"").toLowerCase(),i=o(t),s=r.filter(h=>{if(h.autoMatchDisabled)return!1;const p=o(h.name);return p.includes(i)||i.includes(p)});if(s.length===0)return;if(s.length===1)return s[0];let a=s[0],u=-1;const c=(e+" "+n).toLowerCase();return s.forEach(h=>{let p=0;const m=h.name.match(/\((.*?)\)/);if(m){const E=m[1].toLowerCase();c.includes(E)?p+=10:p-=5}["","","","","","","blood","wound","tied","rope","prison","child","young","old","adult"].forEach(E=>{var v;(((v=h.description)==null?void 0:v.toLowerCase())||"").includes(E)&&c.includes(E)&&(p+=2)}),p>u&&(u=p,a=h)}),a},hf=(t,e)=>{const n=o=>o.replace(/[\s\[\]\(\):]/g,"").toLowerCase(),r=n(t);return e.filter(o=>{if(o.autoMatchDisabled)return!1;const i=n(o.name);return i.includes(r)||r.includes(i)})},YC=({onNext:t,isNextLoading:e})=>{const{scenes:n,setScenes:r,characters:o,setCharacters:i,referenceImages:s,apiKey:a,selectedStyle:u,globalAspectRatio:c,setGlobalAspectRatio:h,showToast:p,openModal:m,globalScenePrompt:g,setGlobalScenePrompt:E,props:v,script:w}=Zt(),[y,x]=de.useState({}),[T,I]=de.useState(!1),[_,R]=de.useState({}),[k,j]=de.useState({}),[D,q]=de.useState(!0),[ae,P]=de.useState(!1),[W,C]=de.useState({}),[G,ce]=de.useState({}),[X,J]=de.useState([]),K=de.useRef(null),[ee,O]=de.useState(null),V=N=>{i(H=>H.map(M=>M.id!==N?M:{...M,autoMatchDisabled:!M.autoMatchDisabled}))},fe=N=>N.replace(/[\s\[\]\(\):]/g,""),se=()=>{m({type:"confirm",title:"  ",message:`         .
(       .)`,confirmText:"",onConfirm:()=>{const N=n.map(H=>{var F;let M={mainIds:[],subIds:[],propIds:((F=H.casting)==null?void 0:F.propIds)||[],focusId:void 0};return H.characterNames&&H.characterNames.length>0&&H.characterNames.forEach(Z=>{hf(Z,o).forEach(pe=>{M.mainIds.includes(pe.id)||M.mainIds.length<3&&M.mainIds.push(pe.id)})}),{...H,casting:M}});r(N),p("      .","success")}})};de.useEffect(()=>{let N=!1;const H=n.map(M=>{var B,pe,ye,Se;let F={mainIds:((B=M.casting)==null?void 0:B.mainIds)||[],subIds:((pe=M.casting)==null?void 0:pe.subIds)||[],propIds:(ye=M.casting)==null?void 0:ye.propIds,focusId:(Se=M.casting)==null?void 0:Se.focusId},Z=!1;if(M.characterNames&&M.characterNames.length>0&&M.characterNames.forEach(Ce=>{if(hf(Ce,o).some(ge=>F.mainIds.includes(ge.id)))return;const oe=qC(Ce,M.scriptSegment,M.description,o);if(oe){const ge=F.mainIds||[];!ge.includes(oe.id)&&ge.length<3&&(F.mainIds=[...ge,oe.id],Z=!0)}}),Z)return N=!0,{...M,casting:F};if(!M.casting&&o.length>0){const Ce=fe(M.scriptSegment),Oe=fe(M.description),oe=o.filter(Pe=>{const we=fe(Pe.name);return Ce.includes(we)||Oe.includes(we)}).slice(0,3).map(Pe=>Pe.id),ge=[],$e=(v?v.filter(Pe=>{const we=fe(Pe.name);return Ce.includes(we)||Oe.includes(we)}):[]).map(Pe=>Pe.id);return N=!0,{...M,casting:{mainIds:oe,subIds:ge,propIds:$e}}}return M});N&&r(H)},[o.length,v==null?void 0:v.length,n.length]);const le=()=>{J(N=>[...N,n])},xe=()=>{if(X.length===0)return;const N=X[X.length-1];r(N),J(H=>H.slice(0,-1)),p("  .","success")},Ie=(N,H)=>{const M=n.find(ye=>ye.id===N);if(!M)return"";const F=n.findIndex(ye=>ye.id===N);F>0&&n[F-1];const Z=M.casting||{mainIds:[],subIds:[]};let B="";B+=`[ ROLE: WORLD-CLASS FILM DIRECTOR & CINEMATOGRAPHER ]
`,B+=`- **PERSONA**: You are the legendary director of this historical drama. Your eye for composition, lighting, and acting is unmatched.
`,B+=`- **GOAL**: Create a "Masterpiece" frame. No boring shots. Treat this as a high-budget movie production.
`,B+=`- **SET CONTINUITY (CRITICAL)**: This is a real 3D set. Imagine the parts of the room/location NOT visible in the frame. Ensure spatial logic allows for seamless editing with previous/next shots.
`;const pe=n.findIndex(ye=>ye.id===N);if(pe>0){const ye=n[pe-1];ye.location===M.location&&(B+=`
[PREVIOUS SCENE CONTEXT]
`,B+=`- **Last Action**: ${ye.description.substring(0,100)}...
`,ye.timeOfDay===M.timeOfDay?B+=`- **INSTRUCTION**: Same location/time. MAINTAIN lighting/atmosphere.
`:B+=`- **INSTRUCTION**: Same location but TIME CHANGED (${ye.timeOfDay} -> ${M.timeOfDay}). CHANGE lighting.
`)}if(g&&g.trim()){B+=`
[ MANDATORY BACKGROUND & PROP CONSISTENCY RULES ]
`,B+=`(These rules are ABSOLUTE. Prioritize them over generic descriptions.)
`;const ye=WC(g,M.location);B+=`${ye}

`}if(B+=`[SCENE INFO]
Location: ${M.location}
Time: ${M.timeOfDay}
`,H==="background"?B+=`Mood/Weather: ${M.description}
`:B+=`Action/Context: ${M.description}
`,H==="background")B+=`
[INSTRUCTION]
NO PEOPLE. EMPTY BACKGROUND ONLY.
Focus on architecture and atmosphere.`;else{if(B+=`
${$C(H)}
`,Z.mainIds.length>0){const ye=Z.mainIds.map(oe=>o.find(ge=>ge.id===oe)).filter(Boolean),Se=ye.filter(oe=>{const ge=((oe==null?void 0:oe.description)||"").toLowerCase();return ge.includes("daenggi")||ge.includes("half-tied")||ge.includes("danbal")||ge.includes("deobeok")||ge.includes("shaggy")});Se.length>0&&(B+=`
[HAIR-BASED HAT RULE]
`,Se.forEach(oe=>{B+=`- **CHARACTER ${oe==null?void 0:oe.name}**: Has specific hairstyle (Daenggi/Half-tied/Shaggy). **MUST NOT WEAR A GAT** (Hat). Show the hair clearly.
`}),Se.length===ye.length&&(B+=`- **NEGATIVE PROMPT**: Gat, Wide Brim Hat, Satgat.
`)),B+=`
[FOCUS SUBJECT - MAIN CHARACTERS]
`,!!M.focusId?B+=`TOTAL CHARACTERS: 1 (Active Speaker) + Blurred Foreground Element (Listener)
`:(B+=`FOREGROUND MAIN CHARACTERS: ${Z.mainIds.length} named characters listed below MUST appear clearly.
`,Z.mainIds.length===2&&(B+=`[COMPOSITION: TWO SHOT]
- Show both characters in the frame.
- Equal importance/focus on both.
`));let Oe=0;const Ae=Z.mainIds.map(oe=>{const ge=o.find($e=>$e.id===oe),Re=ge?s.find($e=>$e.name===ge.name):null;return Re!=null&&Re.imageUrl&&Oe++,{id:oe,hasRef:!!(Re!=null&&Re.imageUrl),refIndex:Re!=null&&Re.imageUrl?Oe:0}});if(Z.mainIds.forEach(oe=>{var Re,$e;const ge=o.find(Pe=>Pe.id===oe);if(ge){const Pe=Ae.find(bs=>bs.id===oe),we=s.find(bs=>bs.name===ge.name),Ve=we?we.description:ge.visualGuide||ge.description,sn=M.focusId===oe,xu=!!M.focusId,Eu=Pe!=null&&Pe.hasRef?`(MATCH WITH PROVIDED REFERENCE IMAGE #${Pe.refIndex})`:"(No Reference Image)";B+=`
 CHARACTER: ${ge.name} ${sn?"( PRIMARY FOCUS - SPEAKER)":""} ${Eu}
`,xu&&!sn?(B+=`  - ROLE: **LISTENER** (Foreground Framing Element)
`,B+=`  - IDENTITY: ${ge.name} (Shoulder/Back View). ${Eu}
`,B+=`  - APPEARANCE: ${Ve}
`,(Re=we==null?void 0:we.design)!=null&&Re.clothingColor&&(B+=`  - CLOTHING COLOR: ${we.design.clothingColor}
`),B+=`  - INSTRUCTION: **PUSH TO THE EDGE**. Show ONLY the back of the shoulder/head on the extreme edge of the frame.
`,B+=`  - **SIZE**: The Listener MUST NOT block the view. They should take up less than 15% of the frame width.
`,B+=`  - **BLUR**: Heavily blur this character (Bokeh).
`):(B+=`  - APPEARANCE: ${Ve} (STRICTLY FOLLOW THIS)
`,($e=we==null?void 0:we.design)!=null&&$e.clothingColor&&(B+=`  - CLOTHING: ${we.design.clothingColor}
`),xu&&sn?B+=`  - ROLE: **ACTIVE SPEAKER** (Camera Focus on this person).
`:B+=`  - ROLE: Main Actor
`)}}),Z.mainIds.length===2&&!M.focusId)B+=`
    [COMPOSITION: TWO SHOT]
    - **SHOW BOTH CHARACTERS**: The frame MUST contain BOTH characters listed above.
    - **EQUAL PRESENCE**: Do NOT crop out the second character.
    - **Framing**: Medium Shot or Full Shot (Knee-up or Waist-up).
    `;else if(Z.mainIds.length===1||M.focusId&&Z.mainIds.length>0)if(B+=`
    [SOLO/OTS SHOT & ANGLE INSTRUCTION]
    `,M.focusId){const oe=n.findIndex(Re=>Re.id===N);let ge=!1;if(oe>0){const Re=n[oe-1];Re.focusId&&Re.focusId!==M.focusId&&(ge=!0)}B+=`
    - **CAMERA FOCUS**: Focus SHARPLY on the Active Speaker.
    - **COMPOSITION**: Dirty Single Shot / Tight Over-the-Shoulder.
    - **LISTENER POSITION**: The Listener is TOO BIG. **MOVE THEM OUT OF THE FRAME**.
    - **VISIBILITY**: Show ONLY a sliver of the Listener's shoulder/head on the edge.
    - **RATIO**: Speaker (85% of frame) vs Listener (15% of frame).
    - **EYE CONTACT**: Speaker looks at the Listener (Not at Camera).
    `,ge?B+=`
    [SPATIAL INVERSION RULE - CRITICAL]
    - The camera has rotated 180 degrees.
    - **VISUAL NEGATION**: Any furniture/objects visible behind the characters in the PREVIOUS shot (e.g., Folding Screen, High Chair) MUST BE BEHIND THE CAMERA now.
    - **CURRENT BACKGROUND**: Show the OPPOSITE wall.
      - **STRUCTURE**: If the previous shot showed the Main Seat/Folding Screen, this shot MUST show Doors/Windows/Courtyard View.
      - **ASYMMETRY**: The two sides of the room are NOT symmetrical. One side is solid (wall/screen), the other is open (doors/windows).
    - **LIGHTING/TONE**: Keep the same color palette and lighting atmosphere, but change the geometry/objects completely.
    `:B+=`
    - **NEGATIVE PROMPT**: Third person, extra characters, crowd, listener facing camera, listener blocking view.
    `}else B+=`
    - **DRAW ONLY THE SINGLE CHARACTER LISTED ABOVE**.
    - If the script implies dialogue with another person, **DO NOT DRAW THE LISTENER**.
    - **ANGLE**: The character should look 15-30 degrees to the side (talking to someone off-screen).
    - **EYE CONTACT**: DO NOT look at the camera. Look at the invisible listener.
    - **COMPOSITION**: Place the character slightly off-center (Rule of Thirds) to leave space for the "invisible" listener.
                       `}Z.propIds&&Z.propIds.length>0&&(B+=`
[IMPORTANT PROPS/OBJECTS]
`,Z.propIds.forEach(ye=>{const Se=v==null?void 0:v.find(Ce=>Ce.id===ye);Se&&(B+=` PROP: ${Se.name}
`,B+=`  - APPEARANCE: ${Se.description}
`,B+=`  - NOTE: Must be visible and look exactly as described.
`)})),B+=`
[BACKGROUND PEOPLE & EXTRAS]
`,B+=`- In addition to the named main/supporting characters, you MAY add anonymous background figures that match the location (e.g., guards, commoners, servants, townspeople).
`,B+=`- Extras should share appropriate Joseon-era clothing for their social class, but their faces and identities MUST be different from the named cast.
`,B+=`- Keep extras slightly smaller or softer in focus so they support the scene without stealing attention from the main characters.
`,Z.subIds.length>0&&(B+=`- The following supporting characters are ALSO part of the cast and must be visually consistent:
`,Z.subIds.forEach(ye=>{const Se=o.find(Ce=>Ce.id===ye);if(Se){const Ce=s.find(Ae=>Ae.name===Se.name),Oe=Ce?Ce.description:Se.description;B+=`   ${Se.name}: ${Oe}
`}}))}return j(ye=>({...ye,[N]:B})),B},Ne=(N,H)=>{R(M=>({...M,[N]:H})),Ie(N,H)},ke=(N,H)=>{r(M=>M.map(F=>{if(F.id===N){const Z=F.focusId===H?void 0:H;return{...F,focusId:Z}}return F}))},Ue=()=>{const N=[...o],H=new Map;return N.forEach(M=>{const F=H.get(M.name);F?!F.referenceImageId&&M.referenceImageId&&H.set(M.name,M):H.set(M.name,M)}),Array.from(H.values())},De=(N,H,M,F)=>{r(Z=>Z.map(B=>{if(B.id!==N)return B;const pe=B.casting||{mainIds:[],subIds:[],propIds:[]};let ye=[...pe.mainIds],Se=[...pe.subIds],Ce=[...pe.propIds||[]],Oe=B.focusId;const Ae=o.find(ge=>ge.id===M),oe=Ae?Ae.name:"";if(F==="remove")H==="main"&&(ye=ye.filter(ge=>ge!==M),Oe===M&&(Oe=void 0)),H==="sub"&&(Se=Se.filter(ge=>ge!==M)),H==="prop"&&(Ce=Ce.filter(ge=>ge!==M));else{if((H==="main"||H==="sub")&&oe&&(ye.some(Re=>{var $e;return(($e=o.find(Pe=>Pe.id===Re))==null?void 0:$e.name)===oe})||Se.some(Re=>{var $e;return(($e=o.find(Pe=>Pe.id===Re))==null?void 0:$e.name)===oe})))return p(`'${oe}'    . ( )`,"warning"),B;if(H==="main"){if(ye.length>=3)return p("  3.","warning"),B;ye.includes(M)||ye.push(M),Se=Se.filter(ge=>ge!==M)}else if(H==="sub"){if(Se.length>=3)return p("  3.","warning"),B;Se.includes(M)||Se.push(M),ye=ye.filter(ge=>ge!==M)}else if(H==="prop"){if(Ce.length>=3)return p("  3.","warning"),B;Ce.includes(M)||Ce.push(M)}}return{...B,casting:{mainIds:ye,subIds:Se,propIds:Ce},focusId:Oe}}))},nt=(N,H)=>{var M;m({type:"textarea",title:`SCENE ${(M=n.find(F=>F.id===N))==null?void 0:M.sceneNumber}  `,message:`      .
(          .)`,defaultValue:H,confirmText:" ",onConfirm:F=>{j(Z=>({...Z,[N]:F||""}))}})},et=N=>{var F;const H=(F=N.target.files)==null?void 0:F[0];if(!H||!ee)return;const M=new FileReader;M.onload=Z=>{var pe;const B=(pe=Z.target)==null?void 0:pe.result;B&&(r(ye=>ye.map(Se=>Se.id===ee?{...Se,backgroundRefUrl:B}:Se)),p("   .","success"),O(null))},M.readAsDataURL(H)},S=N=>{if(N===0)return p("  .","warning");const H=n[N];let M=null;for(let F=N-1;F>=0;F--)if(n[F].location===H.location&&n[F].generatedImageUrl){M=n[F].generatedImageUrl;break}!M&&n[N-1].generatedImageUrl&&(M=n[N-1].generatedImageUrl),M?(r(F=>F.map((Z,B)=>B===N?{...Z,backgroundRefUrl:M}:Z)),p("   !","success")):p("      .","warning")},z=N=>{m({type:"confirm",title:"   ",message:`     ?
(  .)`,confirmText:"",onConfirm:()=>{r(H=>H.map(M=>{if(M.id===N){const F={...M};return delete F.backgroundRefUrl,F}return M})),p("   .","success")}})},$=async()=>{if(!w)return p("  .","warning");if(!a)return p("API  .","warning");P(!0),p("      ...","success");try{const N=await OC(a,w);E(N),p("  .   .","success")}catch(N){p(N.message,"error")}finally{P(!1)}},A=async()=>{window.confirm(`   ?
(   ,    .)`)&&(r([]),x({}),R({}),j({}),C({}),ce({}),J([]),i(N=>N.map(H=>({...H,actions:[]}))),await Cr("bangtong-scenes"),localStorage.removeItem("bangtong-scenes"),p("    . (/ )","success"))},b=async N=>{var F,Z;let H=k[N];const M=_[N]||"background";if(H||(H=Ie(N,M)),!H){p(" ","error");return}x(B=>({...B,[N]:!0}));try{const B=n.find(Pe=>Pe.id===N),pe=(B==null?void 0:B.aspectRatio)||c||"16:9";let ye=[],Se=[];M!=="background"&&((F=B==null?void 0:B.casting)!=null&&F.mainIds)&&B.casting.mainIds.length>0&&B.casting.mainIds.forEach(Pe=>{const we=o.find(Ve=>Ve.id===Pe);if(we){const Ve=s.find(sn=>sn.name===we.name);Ve!=null&&Ve.imageUrl&&(ye.push(Ve.imageUrl),Se.push(we.name))}});const Ce=W[N]||"",Ae=!!(B!=null&&B.focusId)||B==null?void 0:B.backgroundRefUrl;let oe=[];(Z=B==null?void 0:B.casting)!=null&&Z.propIds&&B.casting.propIds.length>0&&B.casting.propIds.forEach(Pe=>{const we=v==null?void 0:v.find(Ve=>Ve.id===Pe);we&&we.imageUrl&&oe.push(we.imageUrl)});let ge,Re=B==null?void 0:B.masterFullShotUrl;if(!Re){const Pe=n.findIndex(we=>we.id===N);for(let we=Pe-1;we>=0;we--)if(n[we].location===(B==null?void 0:B.location)&&n[we].timeOfDay===(B==null?void 0:B.timeOfDay)&&n[we].masterFullShotUrl){Re=n[we].masterFullShotUrl;break}}M==="full"?ge=B==null?void 0:B.generatedImageUrl:ge=Re||(B==null?void 0:B.generatedImageUrl);const $e=await os(a,H,u,pe,M==="background"?"background":"cinematic",ye,Ce,Ae,oe,g,ge,Se);r(Pe=>Pe.map(we=>{if(we.id===N){const Ve=we.imageHistory?[$e,...we.imageHistory]:[$e];!we.imageHistory&&we.generatedImageUrl&&Ve.push(we.generatedImageUrl);const sn=M==="full"?$e:we.masterFullShotUrl;return{...we,generatedImageUrl:$e,masterFullShotUrl:sn,imageHistory:Ve,aspectRatio:pe}}return we})),setTimeout(()=>{const Pe=document.getElementById(`scene-card-${N}`);Pe&&Pe.scrollIntoView({behavior:"smooth",block:"center"})},100),T||p(" !","success")}catch(B){T||p(B.message,"error")}finally{x(B=>({...B,[N]:!1}))}},U=async(N,H)=>{const M=n.find(F=>F.id===N);if(!(!(M!=null&&M.generatedImageUrl)||!H)){x(F=>({...F,[N]:!0})),p("  ...","success");try{const F=await LC(a,M.generatedImageUrl,H);r(Z=>Z.map(B=>{if(B.id===N){const pe=[F,...B.imageHistory||[]];return{...B,generatedImageUrl:F,imageHistory:pe}}return B})),p(" !","success")}catch(F){p(F.message,"error")}finally{x(F=>({...F,[N]:!1}))}}},Q=async(N,H)=>{if(!a)return p("API  .","warning");le();const M=n.findIndex(Z=>Z.id===N);if(M===-1)return;const F=n[M];ce(Z=>({...Z,[N]:!0})),p(` ${H}  ... (  )`,"success");try{const Z=await CC(a,F,H),B=[...n];B.splice(M,1,...Z);const pe=B.map((ye,Se)=>({...ye,sceneNumber:Se+1}));r(pe),p(`! ${F.sceneNumber}  ${H} .`,"success")}catch(Z){p(Z.message,"error")}finally{ce(Z=>({...Z,[N]:!1}))}},ne=N=>{var pe,ye,Se,Ce;if(N===0)return;le();const H=n[N-1],M=n[N],F={mainIds:[...new Set([...((pe=H.casting)==null?void 0:pe.mainIds)||[],...((ye=M.casting)==null?void 0:ye.mainIds)||[]])],subIds:[...new Set([...((Se=H.casting)==null?void 0:Se.subIds)||[],...((Ce=M.casting)==null?void 0:Ce.subIds)||[]])]},Z={...H,scriptSegment:`${H.scriptSegment}
${M.scriptSegment}`,description:`${H.description} ${M.description}`,casting:F},B=[...n];B.splice(N-1,2,Z),r(B.map((Oe,Ae)=>({...Oe,sceneNumber:Ae+1}))),p(`${N+1} ${N}  .`,"success")},Y=N=>{N!==n.length-1&&ne(N+1)},te=async()=>{const N=n.filter(F=>F.generatedImageUrl);if(N.length===0)return p("   .","warning");const H=new hl;let M=0;p(`${N.length}   ...`,"success");try{const F=N.map(async Z=>{if(Z.generatedImageUrl)try{const pe=`${Z.sceneNumber.toString().padStart(2,"0")}_Scene_${Z.sceneNumber}.png`,Se=await(await fetch(Z.generatedImageUrl)).blob();H.file(pe,Se),M++}catch(B){console.error(`Failed to fetch image for scene ${Z.sceneNumber}`,B)}});if(await Promise.all(F),M>0){const Z=await H.generateAsync({type:"blob"});_i.saveAs(Z,"Sintong_Scenes.zip"),p("   .","success")}else p("   .","error")}catch(F){console.error("Zip generation failed",F),p("     .","error")}},[ie,ue]=de.useState(null),Ee=async()=>{if(!a)return p("API  .","warning");const N=n.filter(H=>!H.generatedImageUrl);if(N.length===0)return p("    .","warning");m({type:"confirm",title:"  (  )",message:` ${N.length}   .

[ ]
1. :   (//   )
2. :    
3. :  (${c}) 

:       .`,confirmText:"   ",onConfirm:async()=>{var F,Z;I(!0),ue({current:0,total:N.length,startTime:Date.now()}),p("    ... (3 )","success");const H=["full","mls","ws","bs","cu"];let M=0;for(let B=0;B<N.length;B++){const pe=N[B];ue({current:B+1,total:N.length,startTime:Date.now()});try{const ye=H[Math.floor(Math.random()*H.length)];R(Pe=>({...Pe,[pe.id]:ye}));const Se=Ie(pe.id,ye),Ce=pe.aspectRatio||c||"16:9";let Oe=[];ye!=="background"&&((F=pe==null?void 0:pe.casting)!=null&&F.mainIds)&&pe.casting.mainIds.length>0&&pe.casting.mainIds.forEach(Pe=>{const we=o.find(Ve=>Ve.id===Pe);if(we){const Ve=s.find(sn=>sn.name===we.name);Ve!=null&&Ve.imageUrl&&Oe.push(Ve.imageUrl)}});const Ae=W[pe.id]||"",ge=!!(pe!=null&&pe.focusId)||pe==null?void 0:pe.backgroundRefUrl;let Re=[];(Z=pe==null?void 0:pe.casting)!=null&&Z.propIds&&pe.casting.propIds.length>0&&pe.casting.propIds.forEach(Pe=>{const we=v==null?void 0:v.find(Ve=>Ve.id===Pe);we&&we.imageUrl&&Re.push(we.imageUrl)});const $e=await os(a,Se||"Scene",u,Ce,"cinematic",Oe,Ae,ge,Re,g);r(Pe=>Pe.map(we=>{if(we.id===pe.id){const Ve=we.imageHistory?[$e,...we.imageHistory]:[$e];return!we.imageHistory&&we.generatedImageUrl&&Ve.push(we.generatedImageUrl),{...we,generatedImageUrl:$e,imageHistory:Ve,aspectRatio:Ce}}return we})),M++}catch(ye){console.error(`Failed scene ${pe.sceneNumber}`,ye)}B<N.length-1&&await new Promise(ye=>setTimeout(ye,3e3))}I(!1),ue(null),p(`  ! (${M}/${N.length} )`,"success")}})},Le=(N,H)=>{const M=document.createElement("a");M.href=N,M.download=H,M.click()},be=(N,H)=>{r(M=>M.map(F=>F.id===N?{...F,generatedImageUrl:H}:F))},Be=async N=>{const H=n.find(M=>M.id===N);if(H!=null&&H.generatedImageUrl){if(!a)return p("API  .","warning");m({type:"confirm",title:"  ",message:"   ,  () ?",confirmText:"",onConfirm:async()=>{x(M=>({...M,[N]:!0}));try{const M=await PC(a,H.generatedImageUrl);r(F=>F.map(Z=>{if(Z.id===N){const B=[M,...Z.imageHistory||[]];return{...Z,generatedImageUrl:M,imageHistory:B}}return Z})),p(" .","success")}catch(M){p(M.message,"error")}finally{x(M=>({...M,[N]:!1}))}}})}},re=async N=>{const H=n.find(M=>M.id===N);if(H!=null&&H.generatedImageUrl){if(!a)return p("API  .","warning");m({type:"confirm",title:"  ( )",message:`     ?
(    )`,confirmText:" ",onConfirm:async()=>{x(M=>({...M,[N]:!0}));try{const M=await MC(a,H.generatedImageUrl);r(F=>F.map(Z=>{if(Z.id===N){const B=[M,...Z.imageHistory||[]];return{...Z,generatedImageUrl:M,imageHistory:B}}return Z})),p(" .","success")}catch(M){p(M.message,"error")}finally{x(M=>({...M,[N]:!1}))}}})}},me=(N,H)=>{r(M=>M.map(F=>F.id===N?{...F,aspectRatio:H}:F)),p(`   ${H} .`,"success")},L=()=>{if(!T||!ie)return null;const N=Math.round(ie.current/ie.total*100),H=Math.floor((Date.now()-ie.startTime)/1e3),M=F=>{const Z=Math.floor(F/60),B=F%60;return`${Z}:${B.toString().padStart(2,"0")}`};return f.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:f.jsxs("div",{className:"bg-white rounded-xl p-8 max-w-md w-full shadow-2xl text-center space-y-6 animate-pulse-slow",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx("h3",{className:"text-2xl font-bold text-indigo-700",children:"   ..."}),f.jsx("p",{className:"text-gray-500",children:" .   ."})]}),f.jsxs("div",{className:"relative pt-1",children:[f.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[f.jsx("div",{children:f.jsx("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-indigo-600 bg-indigo-200",children:"Progress"})}),f.jsx("div",{className:"text-right",children:f.jsxs("span",{className:"text-xs font-semibold inline-block text-indigo-600",children:[N,"% (",ie.current," / ",ie.total,")"]})})]}),f.jsx("div",{className:"overflow-hidden h-4 mb-4 text-xs flex rounded bg-indigo-100",children:f.jsx("div",{style:{width:`${N}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-indigo-600 transition-all duration-500 ease-out"})})]}),f.jsx("div",{className:"flex justify-center text-sm bg-gray-50 p-4 rounded-lg",children:f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsx("span",{className:"text-gray-400",children:" "}),f.jsx("span",{className:"font-mono font-bold text-gray-700",children:M(H)})]})}),f.jsx("button",{onClick:()=>{confirm("?        .")&&window.location.reload()},className:"text-red-400 hover:text-red-600 text-sm underline decoration-red-300",children:"  "})]})})};return f.jsxs(f.Fragment,{children:[L(),f.jsxs("div",{className:"fixed bottom-4 left-4 z-[9999] flex flex-col gap-2",children:[f.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"bg-slate-700/80 hover:bg-slate-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm transition-all border border-slate-500",title:" ",children:f.jsx("i",{className:"fas fa-arrow-up"})}),f.jsx("button",{onClick:()=>window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),className:"bg-slate-700/80 hover:bg-slate-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm transition-all border border-slate-500",title:" ",children:f.jsx("i",{className:"fas fa-arrow-down"})})]}),f.jsxs("div",{className:"space-y-6 animate-fade-in",children:[f.jsx("input",{type:"file",ref:K,onChange:et,accept:"image/*",className:"hidden"}),f.jsxs("div",{className:"flex flex-col xl:flex-row justify-between items-center bg-slate-800 p-6 rounded-xl border border-slate-700 gap-4",children:[f.jsxs("div",{children:[f.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["   (",n.length,")"]}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("span",{className:"text-sm text-slate-400",children:"  :"}),f.jsxs("select",{value:c,onChange:N=>h(N.target.value),className:"bg-slate-900 border border-slate-600 rounded px-2 py-1 text-sm font-bold text-indigo-300 focus:ring-2 focus:ring-indigo-500",children:[f.jsx("option",{value:"16:9",children:"16:9 ()"}),f.jsx("option",{value:"9:16",children:"9:16 (/)"}),f.jsx("option",{value:"1:1",children:"1:1 ()"}),f.jsx("option",{value:"4:3",children:"4:3 ()"}),f.jsx("option",{value:"3:4",children:"3:4 ()"})]})]})]}),f.jsxs("div",{className:"flex gap-3 items-center",children:[X.length>0&&f.jsxs("button",{onClick:xe,className:"px-4 py-3 rounded-lg font-bold bg-slate-700 hover:bg-slate-600 text-slate-200 border border-slate-600 flex items-center gap-2",title:" / ",children:[f.jsx("i",{className:"fas fa-undo"}),"  "]}),f.jsxs("button",{onClick:A,className:"px-5 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2 border transition-all bg-red-900/50 hover:bg-red-800 text-red-200 border-red-700/50",title:"   (  )",children:[f.jsx("i",{className:"fas fa-trash-alt"}),"  "]}),f.jsxs("button",{onClick:se,className:"px-5 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2 border transition-all bg-blue-900/50 hover:bg-blue-800 text-blue-200 border-blue-700/50",title:"        ",children:[f.jsx("i",{className:"fas fa-sync-alt"}),"  "]}),f.jsxs("button",{onClick:Ee,disabled:T||e,className:`px-5 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2 border transition-all ${T?"bg-yellow-700 text-yellow-100 border-yellow-600 animate-pulse":"bg-slate-700 hover:bg-slate-600 text-slate-200 border-slate-600"}`,children:[T?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-layer-group"}),T?" ...":"   "]}),f.jsxs("button",{onClick:te,disabled:T,className:"px-5 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2 border transition-all bg-indigo-700 hover:bg-indigo-600 text-white border-indigo-500",title:"     ",children:[f.jsx("i",{className:"fas fa-file-archive"}),"  "]}),f.jsxs("button",{onClick:t,disabled:e||T,className:"bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-lg font-bold shadow-lg flex items-center gap-2",children:[e?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-arrow-right"})," () "]})]})]}),f.jsxs("div",{className:"bg-slate-900/60 border border-slate-700 rounded-xl p-4 mb-4",children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsxs("h3",{className:"text-sm font-bold text-slate-200 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-users-cog text-slate-400"}),"    "]}),f.jsx("span",{className:"text-[10px] text-slate-500",children:"       ."})]}),f.jsx("div",{className:"flex flex-wrap gap-2",children:o.filter(N=>N.referenceImageId).map(N=>f.jsxs("button",{onClick:()=>V(N.id),className:`flex items-center gap-2 text-[11px] px-3 py-1.5 rounded-full border transition-colors ${N.autoMatchDisabled?"bg-slate-800 border-slate-600 text-slate-400":"bg-emerald-700 border-emerald-400 text-white"}`,children:[f.jsx("span",{className:"font-bold",children:N.name}),f.jsx("span",{className:"text-[10px]",children:N.autoMatchDisabled?"  ":"  "})]},N.id))})]}),f.jsxs("div",{className:"bg-indigo-900/30 border border-indigo-500/50 rounded-xl p-6 shadow-lg",children:[f.jsxs("div",{className:"flex justify-between items-center mb-4 cursor-pointer",onClick:()=>q(!D),children:[f.jsxs("h3",{className:"text-lg font-bold text-indigo-200 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-globe-asia"})," []  / "]}),f.jsx("i",{className:`fas fa-chevron-${D?"up":"down"} text-indigo-400`})]}),D&&f.jsxs("div",{className:"animate-fade-in",children:[f.jsxs("p",{className:"text-sm text-slate-400 mb-2",children:["  ",f.jsx("strong",{children:"  "}),'. "   ", "  ", "    "  AI     .']}),f.jsx("div",{className:"flex justify-end mb-2",children:f.jsxs("button",{onClick:$,disabled:ae,className:"text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded flex items-center gap-2 border border-indigo-400 shadow-sm",children:[ae?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-magic"}),"   /"]})}),f.jsx("textarea",{value:g,onChange:N=>E(N.target.value),placeholder:":      .      .          .",className:"w-full h-32 bg-slate-800 border border-slate-600 rounded-lg p-3 text-sm text-white focus:ring-2 focus:ring-indigo-500 resize-none leading-relaxed"}),f.jsx("div",{className:"flex justify-end mt-2",children:f.jsxs("button",{onClick:()=>{n.forEach(N=>Ie(N.id,_[N.id]||"background")),p("     . ( )","success")},className:"text-xs bg-indigo-700 hover:bg-indigo-600 text-white px-3 py-1.5 rounded flex items-center gap-1",children:[f.jsx("i",{className:"fas fa-sync-alt"}),"   "]})})]})]}),f.jsx("div",{className:"space-y-12",children:n.map((N,H)=>{var M,F,Z,B,pe,ye,Se,Ce,Oe,Ae;return f.jsxs("div",{id:`scene-card-${N.id}`,className:"bg-slate-800 rounded-2xl overflow-hidden border border-slate-700 shadow-xl",children:[f.jsxs("div",{className:"bg-slate-900/50 p-6 border-b border-slate-700",children:[f.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-3",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsxs("span",{className:"bg-indigo-600 text-white px-3 py-1 rounded text-sm font-bold whitespace-nowrap",children:["SCENE ",N.sceneNumber]}),f.jsx("h3",{className:"text-xl md:text-2xl font-bold text-white truncate max-w-[200px] md:max-w-md",children:N.location}),f.jsx("span",{className:"text-slate-400 text-sm border border-slate-600 px-2 py-0.5 rounded-full whitespace-nowrap",children:N.timeOfDay})]}),f.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[f.jsxs("div",{className:"flex items-center gap-1 bg-slate-800 rounded-lg p-1 border border-slate-600",children:[f.jsxs("span",{className:"text-[10px] text-slate-400 px-2 font-bold uppercase",children:[f.jsx("i",{className:"fas fa-link mr-1"}),""]}),f.jsx("button",{onClick:()=>ne(H),disabled:H===0,className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"   (     )",children:f.jsx("i",{className:"fas fa-arrow-up"})}),f.jsx("button",{onClick:()=>Y(H),disabled:H===n.length-1,className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"   (     )",children:f.jsx("i",{className:"fas fa-arrow-down"})})]}),f.jsxs("div",{className:"flex items-center gap-1 bg-slate-800 rounded-lg p-1 border border-slate-600",children:[f.jsxs("span",{className:"text-[10px] text-slate-400 px-2 font-bold uppercase",children:[f.jsx("i",{className:"fas fa-cut mr-1"}),""]}),f.jsx("button",{onClick:()=>Q(N.id,2),disabled:G[N.id],className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors",title:"     2 ",children:"2"}),f.jsx("button",{onClick:()=>Q(N.id,3),disabled:G[N.id],className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors",title:"     3 ",children:"3"})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-xs text-slate-500",children:":"}),f.jsxs("select",{value:N.aspectRatio||c,onChange:oe=>me(N.id,oe.target.value),className:"bg-slate-800 text-xs text-slate-300 border border-slate-600 rounded px-1 py-1",children:[f.jsx("option",{value:"16:9",children:"16:9"}),f.jsx("option",{value:"9:16",children:"9:16"}),f.jsx("option",{value:"1:1",children:"1:1"}),f.jsx("option",{value:"4:3",children:"4:3"}),f.jsx("option",{value:"3:4",children:"3:4"})]})]})]})]}),G[N.id]&&f.jsxs("div",{className:"mb-4 bg-indigo-900/30 border border-indigo-500/30 text-indigo-300 px-4 py-2 rounded text-sm flex items-center gap-3 animate-pulse",children:[f.jsx("i",{className:"fas fa-spinner fa-spin"}),f.jsx("span",{children:"AI      ..."})]}),f.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-600/50",children:[f.jsxs("p",{className:"text-indigo-300 text-sm font-bold mb-1",children:[f.jsx("i",{className:"fas fa-quote-left mr-2"})," "]}),f.jsx("p",{className:"text-lg text-slate-200",children:N.scriptSegment})]})]}),f.jsx("div",{className:"p-6",children:f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[f.jsxs("div",{className:"lg:col-span-2 flex flex-col gap-4",children:[f.jsxs("div",{className:"relative w-full bg-black rounded-lg overflow-hidden border border-slate-700 flex items-center justify-center transition-all",style:{width:"100%",aspectRatio:(N.aspectRatio||c).replace(":","/")},children:[N.generatedImageUrl?f.jsx("img",{src:N.generatedImageUrl,alt:"Background",className:"w-full h-full object-contain"}):f.jsxs("div",{className:"text-slate-600 flex flex-col items-center",children:[f.jsx("i",{className:"fas fa-image text-6xl mb-4 opacity-30"}),f.jsx("span",{children:" "})]}),y[N.id]&&f.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center backdrop-blur-sm",children:f.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-indigo-500"})}),_[N.id]&&_[N.id]!=="background"&&f.jsx("div",{className:"absolute top-4 right-4 bg-black/80 text-white text-xs px-2 py-1 rounded border border-white/30 backdrop-blur-md",children:(M=ff.find(oe=>oe.value===_[N.id]))==null?void 0:M.label}),N.backgroundRefUrl&&f.jsxs("div",{className:"absolute bottom-4 left-4 bg-blue-900/80 text-white text-xs px-2 py-1 rounded border border-blue-500 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-layer-group"}),"    ( )"]})]}),N.imageHistory&&N.imageHistory.length>0&&f.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 custom-scrollbar",children:N.imageHistory.map((oe,ge)=>f.jsx("div",{onClick:()=>be(N.id,oe),className:`flex-shrink-0 w-16 h-16 rounded cursor-pointer border-2 transition-all hover:scale-105 ${N.generatedImageUrl===oe?"border-indigo-500 ring-1":"border-slate-700 opacity-60"}`,children:f.jsx("img",{src:oe,alt:"History",className:"w-full h-full object-cover"})},ge))}),N.generatedImageUrl&&f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:()=>Le(N.generatedImageUrl,`scene_${N.sceneNumber}.png`),className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white px-4 py-3 rounded-lg font-bold border border-slate-600 flex items-center justify-center gap-2",children:[f.jsx("i",{className:"fas fa-download"})," "]}),_[N.id]!=="background"&&f.jsxs(f.Fragment,{children:[f.jsxs("button",{onClick:()=>Be(N.id),className:"flex-1 bg-green-900/50 hover:bg-green-800/80 text-green-300 hover:text-white px-4 py-3 rounded-lg font-bold border border-green-700/50 flex items-center justify-center gap-2",title:"    ",children:[f.jsx("i",{className:"fas fa-magic"}),"  "]}),f.jsxs("button",{onClick:()=>re(N.id),className:"flex-1 bg-slate-700 hover:bg-red-900/50 text-slate-300 hover:text-red-300 px-4 py-3 rounded-lg font-bold border border-slate-600 hover:border-red-700 flex items-center justify-center gap-2",title:"    ",children:[f.jsx("i",{className:"fas fa-user-slash"}),"  "]})]})]}),N.generatedImageUrl&&f.jsxs("div",{className:"mt-2 bg-purple-900/20 border border-purple-500/30 p-4 rounded-lg",children:[f.jsxs("label",{className:"text-sm font-bold text-purple-300 block mb-2",children:[f.jsx("i",{className:"fas fa-magic mr-2"}),"  (   )"]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("input",{type:"text",id:`fix-input-${N.id}`,placeholder:":   ,   ",className:"flex-1 bg-slate-900 border border-purple-500/50 rounded-lg px-4 py-3 text-white focus:border-purple-400 focus:ring-1 focus:ring-purple-400 placeholder-slate-500",onKeyDown:oe=>{if(oe.key==="Enter"){const ge=oe.currentTarget.value;ge&&U(N.id,ge)}}}),f.jsx("button",{onClick:()=>{const oe=document.getElementById(`fix-input-${N.id}`);oe&&oe.value&&U(N.id,oe.value)},disabled:y[N.id],className:"bg-purple-600 hover:bg-purple-500 text-white px-6 py-3 rounded-lg font-bold shadow-lg whitespace-nowrap",children:y[N.id]?f.jsx("i",{className:"fas fa-spinner fa-spin"}):" "})]}),f.jsx("p",{className:"text-xs text-purple-400/70 mt-2 ml-1",children:"* 3     .     ."})]})]}),f.jsxs("div",{className:"lg:col-span-1 flex flex-col gap-4",children:[f.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-700",children:[f.jsxs("label",{className:"text-xs font-bold text-slate-400 mb-2 block uppercase",children:[f.jsx("i",{className:"fas fa-camera mr-1"}),"   ( )"]}),f.jsx("div",{className:"flex gap-2 flex-wrap",children:ff.map(oe=>f.jsx("button",{onClick:()=>Ne(N.id,oe.value),className:`px-3 py-2 rounded text-xs font-bold border transition-all ${_[N.id]===oe.value||!_[N.id]&&oe.value==="background"?"bg-indigo-600 text-white border-indigo-500":"bg-slate-800 text-slate-400 border-slate-600 hover:bg-slate-700"}`,children:oe.label},oe.value))})]}),_[N.id]!=="background"&&f.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-700",children:[f.jsxs("h4",{className:"text-sm font-bold text-white mb-3 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-users-cog text-yellow-500"}),"  "]}),f.jsxs("div",{className:"mb-4",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsx("label",{className:"text-xs font-bold text-indigo-400",children:"  (Foreground)"}),f.jsxs("select",{className:"bg-slate-800 text-xs text-white border border-slate-600 rounded px-2 py-1 w-24",onChange:oe=>{oe.target.value&&De(N.id,"main",oe.target.value,"add"),oe.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),Ue().map(oe=>f.jsx("option",{value:oe.id,children:oe.name},oe.id))]})]}),f.jsxs("div",{className:"flex flex-col gap-2 min-h-[30px]",children:[(Z=(F=N.casting)==null?void 0:F.mainIds)==null?void 0:Z.map(oe=>{const ge=o.find($e=>$e.id===oe),Re=N.focusId===oe;return ge?f.jsxs("div",{className:`flex items-center justify-between p-2 rounded-lg border ${Re?"bg-indigo-900/80 border-indigo-400":"bg-slate-800 border-slate-700"}`,children:[f.jsx("div",{className:"flex items-center gap-2",children:f.jsx("span",{className:`text-xs font-bold ${Re?"text-white":"text-slate-300"}`,children:ge.name})}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs("button",{onClick:()=>ke(N.id,oe),className:`text-[10px] px-2 py-0.5 rounded border ${Re?"bg-indigo-500 text-white border-indigo-400":"bg-slate-700 text-slate-400 border-slate-600 hover:bg-slate-600"}`,title:Re?"   ( )":"    ",children:[f.jsx("i",{className:`fas ${Re?"fa-video":"fa-video-slash"} mr-1`}),Re?"ON":"OFF"]}),f.jsx("button",{onClick:()=>De(N.id,"main",oe,"remove"),className:"text-slate-500 hover:text-red-400",children:f.jsx("i",{className:"fas fa-times"})})]})]},oe):null}),(!((B=N.casting)!=null&&B.mainIds)||N.casting.mainIds.length===0)&&f.jsx("span",{className:"text-xs text-slate-600",children:" "}),((pe=N.casting)==null?void 0:pe.mainIds)&&N.casting.mainIds.length>=2&&!N.focusId&&f.jsxs("div",{className:"mt-2 bg-slate-900/50 p-2 rounded border border-slate-600",children:[f.jsxs("p",{className:"text-[10px] text-slate-300 mb-1",children:[f.jsx("i",{className:"fas fa-video mr-1"})," ",f.jsx("strong",{children:"  "})]}),f.jsxs("ul",{className:"text-[10px] text-slate-400 space-y-1 list-disc pl-3",children:[f.jsxs("li",{children:[f.jsx("strong",{children:"():"}),"  [ON]      . (    )"]}),f.jsxs("li",{children:[f.jsx("strong",{children:"/OTS:"}),"   ",f.jsx("span",{className:"text-indigo-400 font-bold",children:"[ON]"}),",     ."]})]})]})]})]}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsx("label",{className:"text-xs font-bold text-slate-400",children:" (Background)"}),f.jsxs("select",{className:"bg-slate-800 text-xs text-white border border-slate-600 rounded px-2 py-1 w-24",onChange:oe=>{oe.target.value&&De(N.id,"sub",oe.target.value,"add"),oe.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),Ue().map(oe=>f.jsx("option",{value:oe.id,children:oe.name},oe.id))]})]}),f.jsx("div",{className:"flex gap-2 flex-wrap min-h-[30px]",children:(Se=(ye=N.casting)==null?void 0:ye.subIds)==null?void 0:Se.map(oe=>{const ge=o.find(Re=>Re.id===oe);return ge?f.jsxs("div",{className:"bg-slate-700 text-slate-300 text-xs px-2 py-1 rounded-full flex items-center gap-1 border border-slate-600",children:[f.jsx("span",{children:ge.name}),f.jsx("button",{onClick:()=>De(N.id,"sub",oe,"remove"),className:"hover:text-red-300",children:f.jsx("i",{className:"fas fa-times"})})]},oe):null})})]}),f.jsxs("div",{className:"mt-4 border-t border-slate-800 pt-4",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsx("label",{className:"text-xs font-bold text-green-400",children:"   (Props)"}),f.jsxs("select",{className:"bg-slate-800 text-xs text-white border border-slate-600 rounded px-2 py-1 w-24",onChange:oe=>{oe.target.value&&De(N.id,"prop",oe.target.value,"add"),oe.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),v&&v.map(oe=>f.jsx("option",{value:oe.id,children:oe.name},oe.id))]})]}),f.jsxs("div",{className:"flex gap-2 flex-wrap min-h-[30px]",children:[(Oe=(Ce=N.casting)==null?void 0:Ce.propIds)==null?void 0:Oe.map(oe=>{const ge=v==null?void 0:v.find(Re=>Re.id===oe);return ge?f.jsxs("div",{className:"bg-green-700 text-green-100 text-xs px-2 py-1 rounded-full flex items-center gap-1 shadow-sm",children:[f.jsx("span",{children:ge.name}),f.jsx("button",{onClick:()=>De(N.id,"prop",oe,"remove"),className:"hover:text-red-300",children:f.jsx("i",{className:"fas fa-times"})})]},oe):null}),(!((Ae=N.casting)!=null&&Ae.propIds)||N.casting.propIds.length===0)&&f.jsx("span",{className:"text-xs text-slate-600",children:" "})]})]})]}),f.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-700",children:[f.jsxs("label",{className:"text-xs font-bold text-blue-400 mb-2 block uppercase flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-image"}),"   ( )"]}),N.backgroundRefUrl?f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"w-full h-20 bg-black rounded border border-blue-500 overflow-hidden mb-2 relative",children:[f.jsx("img",{src:N.backgroundRefUrl,alt:"Background Ref",className:"w-full h-full object-cover opacity-70"}),f.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold text-white bg-black/50 text-center leading-tight",children:["  ",f.jsx("br",{}),"(/ )"]})]}),f.jsxs("button",{onClick:()=>z(N.id),className:"relative z-20 w-full text-xs text-white bg-red-800 hover:bg-red-600 border border-red-500 rounded py-3 transition-colors font-bold cursor-pointer shadow-md",children:[f.jsx("i",{className:"fas fa-trash-alt mr-1"}),"    ()"]})]}):f.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[f.jsxs("button",{onClick:()=>S(H),className:"bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs py-2 px-1 rounded border border-slate-600 flex flex-col items-center gap-1",title:"    ",children:[f.jsx("i",{className:"fas fa-arrow-left"}),"  "]}),f.jsxs("button",{onClick:()=>{var oe;O(N.id),(oe=K.current)==null||oe.click()},className:"bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs py-2 px-1 rounded border border-slate-600 flex flex-col items-center gap-1",title:"PC  ",children:[f.jsx("i",{className:"fas fa-upload"}),"  "]})]}),f.jsxs("p",{className:"text-[10px] text-slate-500 mt-2 leading-tight",children:["*      ",f.jsx("strong",{children:"()"}),"  ."]})]}),f.jsxs("div",{className:"flex-grow flex flex-col gap-2",children:[f.jsxs("div",{className:"flex justify-between items-end",children:[f.jsxs("label",{className:"text-xs font-bold text-green-400 uppercase",children:[f.jsx("i",{className:"fas fa-terminal mr-1"})," AI  "]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:()=>nt(N.id,k[N.id]||""),className:"text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-2 py-1 rounded border border-indigo-500 transition-colors shadow-sm",children:[f.jsx("i",{className:"fas fa-expand-arrows-alt mr-1"}),"  "]}),f.jsx("button",{onClick:()=>{Ie(N.id,_[N.id]||"background"),p("   .","success")},className:"text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded border border-slate-600 transition-colors",title:"    ",children:f.jsx("i",{className:"fas fa-sync-alt"})})]})]}),f.jsx("textarea",{value:k[N.id]||"",onChange:oe=>j(ge=>({...ge,[N.id]:oe.target.value})),onDoubleClick:()=>nt(N.id,k[N.id]||""),placeholder:"       .",className:"w-full h-24 bg-black/30 border border-slate-600 rounded-lg p-3 text-xs text-slate-300 font-mono focus:ring-1 focus:ring-green-500 focus:border-green-500 resize-none leading-relaxed cursor-text"})]}),f.jsxs("div",{className:"bg-red-900/20 border border-red-500/30 p-4 rounded-lg mt-auto",children:[f.jsxs("label",{className:"text-sm font-bold text-red-400 block mb-2",children:[f.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),"    (  )"]}),f.jsx("input",{type:"text",value:W[N.id]||"",onChange:oe=>C(ge=>({...ge,[N.id]:oe.target.value})),placeholder:":   ,  ,  ",className:"w-full bg-slate-900 border border-red-500/50 rounded-lg px-4 py-3 text-white focus:border-red-500 focus:ring-1 focus:ring-red-500 placeholder-slate-500"})]}),f.jsxs("button",{onClick:()=>b(N.id),disabled:y[N.id]||T,className:`w-full py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all ${_[N.id]&&_[N.id]!=="background"?"bg-indigo-600 hover:bg-indigo-500 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-200"}`,children:[y[N.id]?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-magic"}),N.generatedImageUrl?"   ":"  (Generate)"]})]})]})})]},N.id)})})]})]})},oa=t=>{const e=t.match(/^(.*)\(/);return e?e[1].trim():t.trim()},KC=()=>{const{script:t,characters:e,referenceImages:n,apiKey:r,selectedStyle:o,globalAspectRatio:i,showToast:s,props:a,scriptSegments:u,globalScenePrompt:c,openModal:h}=Zt(),[p,m]=de.useState("ALL"),[g,E]=de.useState("auto"),[v,w]=de.useState("auto"),[y,x]=de.useState(!1),[T,I]=de.useState([]),[_,R]=de.useState({}),[k,j]=de.useState([]),[D,q]=de.useState([]),[ae,P]=de.useState(!1),[W,C]=de.useState("16:9"),[G,ce]=de.useState(null),[X,J]=de.useState(!1),[K,ee]=de.useState(null),[O,V]=de.useState(!1),[fe,se]=de.useState(null);de.useEffect(()=>{(async()=>{if(typeof window<"u"){const N=localStorage.getItem("bangtong-opening-sequence");if(N)try{const F=JSON.parse(N);Array.isArray(F)&&F.length>0&&(await cr("bangtong-opening-sequence",F),I(F)),localStorage.removeItem("bangtong-opening-sequence")}catch{}else{const F=await Ci("bangtong-opening-sequence");F&&I(F)}const H=localStorage.getItem("bangtong-hooking-texts");if(H)try{const F=JSON.parse(H);Array.isArray(F)&&F.length>0&&(await cr("bangtong-hooking-texts",F),j(F)),localStorage.removeItem("bangtong-hooking-texts")}catch{}else{const F=await Ci("bangtong-hooking-texts");F&&j(F)}const M=await Ci("bangtong-thumbnail-data");M&&(M.characters&&Array.isArray(M.characters)?ce(M):(console.log("Old thumbnail data format detected. Clearing."),await Cr("bangtong-thumbnail-data"),ce(null)))}})()},[]),de.useEffect(()=>{T.length>0&&cr("bangtong-opening-sequence",T)},[T]),de.useEffect(()=>{k.length>0?cr("bangtong-hooking-texts",k):Cr("bangtong-hooking-texts")},[k]),de.useEffect(()=>{G&&cr("bangtong-thumbnail-data",G)},[G]);const le=async()=>{window.confirm(`   ?
(  .)`)&&(I([]),await Cr("bangtong-opening-sequence"),localStorage.removeItem("bangtong-opening-sequence"),s("  .","success"))},xe=async()=>{if(!t)return s(" .","warning");if(!r)return s("API  .","warning");J(!0);try{let L=t;if(typeof p<"u"&&p!=="ALL"&&typeof u<"u"){const M=u.find(F=>F.id===p);M&&(L=M.content)}const N=await _C(r,L,e,g),H=N.characters.map(M=>({name:M.name,action:M.action,appearance:M.appearance||""}));ce({title:N.title,composition:N.composition,action:N.action,characters:H}),s("  !","success")}catch(L){s(L.message,"error")}finally{J(!1)}},Ie=(L,N)=>{ce(H=>H?{...H,[L]:N}:null)},Ne=()=>{G&&h({type:"textarea",title:"  ",message:"      .",defaultValue:G.action||"",onConfirm:L=>Ie("action",L||""),confirmText:"",showCopyButton:!0})},ke=L=>{const N=e.find(H=>H.id===L);!N||!G||ce(H=>H?H.characters.some(M=>M.name===N.name)?H:{...H,characters:[...H.characters,{name:N.name,action:"Standing",appearance:N.description}]}:null)},Ue=(L,N,H)=>{ce(M=>{if(!M)return null;const F=[...M.characters];return F[L]={...F[L],[N]:H},{...M,characters:F}})},De=L=>{ce(N=>{if(!N)return null;const H=N.characters.filter((M,F)=>F!==L);return{...N,characters:H}})},nt=L=>{if(!G)return;const N=G.characters[L];h({type:"textarea",title:`${N.name}  `,message:`${N.name}   .
(/    )`,defaultValue:N.appearance||"",onConfirm:H=>Ue(L,"appearance",H||""),confirmText:"",showCopyButton:!0})},et=async()=>{if(G){J(!0);try{const L=G.characters.map(B=>{const pe=e.find(Se=>Se.name===B.name);if(!pe||!pe.referenceImageId)return null;const ye=n.find(Se=>Se.id===pe.referenceImageId);return ye?{name:B.name,imageUrl:ye.imageUrl}:null}).filter(B=>B!==null),N=L.map(B=>B.imageUrl),H=L.map(B=>B.name),M=G.characters.map(B=>` CHARACTER: ${B.name}
  - ACTION: ${B.action}
  - APPEARANCE: ${B.appearance||"(Follow Reference Image)"}`).join(`
`),F=`
        [YOUTUBE THUMBNAIL COMPOSITION - ABSOLUTE RULE]
        - EXTREME RIGHT PLACEMENT: The main character MUST be positioned on the FAR RIGHT side (Right 40% of the screen).
        - LEFT 60% EMPTY: The left side MUST be dark/shadow/void. ABSOLUTELY NO FACES OR BODIES ON THE LEFT SIDE.
        - NO CENTERING: The character MUST NOT be in the center. Push them to the right edge.
        - FACE POSITION: The character's face must be located in the RIGHT THIRD of the image.
        - GRADIENT STYLE: LINEAR GRADIENT ONLY. The shadow must flow horizontally from Left (Black) to Right.
        - ABSOLUTE PROHIBITION: NO RADIAL GRADIENT, NO VIGNETTE, NO OVAL SHADOW. The left side must be uniformly black from top to bottom.
        - CLEANLINESS: PURE BLACK means #000000. NO Dust, NO Noise, NO White Specks, NO Stars, NO Texture on the left side.
        
        [BANGTONG ULTRA HOOKING THUMBNAIL]
        - GOAL: In one single frame, make the viewer think:
          "  ?", ", ", " ?", "  ?"
        - FOCUS: Choose the most psychologically intense and emotionally extreme moment from the planned scene, without showing graphic injury or gore.
        - ACTING:
          - Characters must show maximum emotion (rage, terror, despair, obsession).
          - No neutral or casual poses. Capture the moment just BEFORE the irreversible action, focusing on faces, hands, and posture rather than visible wounds.
          - NO ONE looks at the camera. They look at each other, at the threat, or at the object.
        - COMPOSITION:
          - Use close-up or medium close-up framing. The main character's face and upper body (head to chest or waist) must be clearly visible. Do not crop to only hands.
          - If there are two characters, show strong physical or emotional tension between them (pulling, grabbing, pushing, begging, threatening).
          - If there is only one character, use body language and facial expression to show intense inner conflict.
        - CONTENT SAFETY:
          - Do NOT depict explicit torture devices, dismemberment, or detailed blood splashes on the body or face.
          - You may imply danger or violence through expressions, shadows, and composition, but keep visible injury mild and non-graphic.
        - AMBIGUITY:
          - Do NOT explain everything. Hide the cause or result so the viewer feels curiosity and unease.
        
        [AI PLANNED COMPOSITION]
        ${G.composition}
        
        [SCENE ACTION]
        ${G.action}

        [CHARACTERS]
        ${M}

        - LIGHTING: High contrast, dramatic lighting.
        - NEGATIVE PROMPT: PHOTOREALISTIC, REALISTIC, 3D RENDER, MOVIE PHOTO, Radial gradient, Oval shadow, Vignette, Spotlight, Centered composition, Character in center, Face in center, Text, Font, Letter, Alphabet, Number, Logo, UI, Watermark, Split screen, Vertical line, White line, Border, Divider, White corner, Light leak, Dust, Particles, Noise, White dots, Stars, Grain, Specks.
        `,Z=await os(r,F,o,"16:9","cinematic",[],void 0,void 0,void 0,void 0,void 0,[]);ce(B=>B?{...B,imageUrl:Z,imageHistory:[Z,...B.imageHistory||[]]}:null),s("  !","success")}catch(L){s(L.message,"error")}finally{J(!1)}}},S=(L,N,H)=>{I(M=>M.map(F=>{if(F.id!==L)return F;let Z=[...F.propIds||[]];return H==="add"?Z.includes(N)||Z.push(N):Z=Z.filter(B=>B!==N),{...F,propIds:Z}}))},z=(L,N,H)=>{I(M=>M.map(F=>{if(F.id!==L)return F;let Z=[...F.characterIds||[]];return H==="add"?Z.includes(N)||Z.push(N):Z=Z.filter(B=>B!==N),{...F,characterIds:Z}}))},$=()=>{const L=new Map;return e.forEach(N=>{const H=oa(N.name),M=H||N.name,F=L.get(M);if(!F)L.set(M,{id:N.id,name:H});else{const Z=e.find(ye=>ye.id===F.id),B=!!(Z!=null&&Z.referenceImageId),pe=!!N.referenceImageId;!B&&pe&&L.set(M,{id:N.id,name:H})}}),Array.from(L.values())},A=(L,N)=>{I(H=>H.map(M=>M.id===L?{...M,visualPrompt:N}:M))},b=(L,N)=>{I(H=>H.map(M=>M.id===L?{...M,generatedImageUrl:N}:M)),s(" .","success")},U=async()=>{if(!t)return s(" .","warning");if(!r)return s("API  .","warning");x(!0);try{let L=t;if(typeof p<"u"&&p!=="ALL"&&typeof u<"u"){const H=u.find(M=>M.id===p);H&&(L=H.content)}const N=await NC(r,L,e,a,c,g);I(N),s("/  !","success")}catch(L){s(L.message,"error")}finally{x(!1)}},Q=async L=>{var N,H;R(M=>({...M,[L.id]:!0}));try{const M=((N=L.propIds)==null?void 0:N.map(Ae=>{var oe;return(oe=a.find(ge=>ge.id===Ae))==null?void 0:oe.imageUrl}).filter(Boolean))||[],F=((H=L.characterIds)==null?void 0:H.map(Ae=>{const oe=e.find(Re=>Re.id===Ae);if(!oe||!oe.referenceImageId)return null;const ge=n.find(Re=>Re.id===oe.referenceImageId);return ge?{name:oa(oe.name),imageUrl:ge.imageUrl,description:ge.description}:null}).filter(Ae=>Ae!==null))||[],Z=F.map(Ae=>Ae.imageUrl),B=F.map(Ae=>Ae.name),pe=F.map(Ae=>` CHARACTER: ${Ae.name}
  - BASE APPEARANCE: ${Ae.description}`).join(`
`),ye=`
        [GLOBAL PRODUCTION RULES]
        ${c||""}
        
        [CHARACTER REFERENCE]
        ${pe}
        (NOTE: Follow the Base Appearance, unless the Scene Action explicitly describes a different age or state like 'Young', 'Childhood', etc.)
        
        [SCENE ACTION & CAMERA]
        ${L.visualPrompt}
      `,Se=T.find(Ae=>Ae.sequenceNumber===L.sequenceNumber-1),Ce=Se==null?void 0:Se.generatedImageUrl,Oe=await os(r,ye,o,i,"cinematic",Z,void 0,void 0,M,void 0,Ce,B);I(Ae=>Ae.map(oe=>{if(oe.id!==L.id)return oe;let ge=[...oe.imageHistory||[]];return oe.generatedImageUrl&&!ge.includes(oe.generatedImageUrl)&&ge.push(oe.generatedImageUrl),ge.includes(Oe)||ge.push(Oe),{...oe,generatedImageUrl:Oe,imageHistory:ge}})),s(`${L.sequenceNumber}   `,"success")}catch(M){s(M.message,"error")}finally{R(M=>({...M,[L.id]:!1}))}},ne=(L,N)=>{const H=document.createElement("a");H.href=L,H.download=N,H.click()},Y=async()=>{const L=T.filter(M=>M.generatedImageUrl);if(L.length===0)return s("   .","warning");const N=new hl;let H=0;s(`${L.length}   ...`,"success");try{const M=L.map(async F=>{if(F.generatedImageUrl)try{const B=`${F.sequenceNumber.toString().padStart(2,"0")}_Opening_${F.sequenceNumber}.png`,ye=await(await fetch(F.generatedImageUrl)).blob();N.file(B,ye),H++}catch(Z){console.error(`Failed to fetch image for shot ${F.sequenceNumber}`,Z)}});if(await Promise.all(M),H>0){const F=await N.generateAsync({type:"blob"});_i.saveAs(F,"Bangtong_Opening.zip"),s("   .","success")}else s("   .","error")}catch(M){console.error("Zip generation failed",M),s("     .","error")}},te=async()=>{const L=T.filter(H=>H.videoPrompt);if(L.length===0)return s("   .","warning");const N=new hl;L.forEach(H=>{const F=`${H.sequenceNumber.toString().padStart(2,"0")}_VeoPrompt_${H.sequenceNumber}.txt`,Z=typeof H.videoPrompt=="object"?JSON.stringify(H.videoPrompt,null,2):H.videoPrompt;N.file(F,Z||"")});try{const H=await N.generateAsync({type:"blob"});_i.saveAs(H,"Bangtong_VeoPrompts.zip"),s("   .","success")}catch(H){console.error("Zip generation failed",H),s("     .","error")}},ie=async L=>{R(N=>({...N,[L.id]:!0}));try{const N=await UC(r,L.title,L.visualPrompt);I(H=>H.map(M=>M.id===L.id?{...M,trailerCaption:N}:M)),s("  !","success")}catch(N){s(N.message,"error")}finally{R(N=>({...N,[L.id]:!1}))}},ue=async()=>{if(!t)return s(" .","warning");if(!r)return s("API  .","warning");P(!0),q([]);try{const L=await DC(r,t);j(L),s(`  ${L.length} !`,"success")}catch(L){s(L.message,"error")}finally{P(!1)}},Ee=L=>{q(N=>N.includes(L)?N.filter(H=>H!==L):[...N,L])},Le=()=>{if(D.length===0)return s("  .","warning");const L=D.join(`
`),N=new Blob([L],{type:"text/plain;charset=utf-8"});_i.saveAs(N,"selected_hooking_texts.txt"),s(`${D.length}    .`,"success")},be=async()=>{if(T.length===0)return s("   .","warning");if(!r)return s("API  .","warning");V(!0);try{const L=await FC(r,T,g,v);ee(L),s("Suno  !","success")}catch(L){s(L.message,"error")}finally{V(!1)}},Be=L=>{navigator.clipboard.writeText(L),s("!","success")},re=(L,N)=>{I(H=>H.map(M=>{if(M.id!==L)return M;const F=typeof M.videoPrompt=="string"?JSON.parse(M.videoPrompt):{...M.videoPrompt};return N==="remove"?(F!=null&&F.subject&&(F.subject.dialogue=""),s(" .","success")):N==="restore"&&(F!=null&&F.subject&&(F.subject.dialogue="EXTRACT dialogue. IF TOO LONG, SUMMARIZE to be spoken within 6 seconds. Keep it KOREAN.",F.subject.speaker_info||(F.subject.speaker_info={gender:"Male/Female",age:"Child/Young/Adult/Elderly",voice_tone:"e.g. Deep, High, Soft"})),s("   . ( )","success")),{...M,videoPrompt:F}}))},me=L=>{h({type:"textarea",title:"  ",message:"  . (   )",defaultValue:L.visualPrompt,onConfirm:N=>A(L.id,N||""),confirmText:"",showCopyButton:!0})};return f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"fixed bottom-4 left-4 z-[9999] flex flex-col gap-2",children:[f.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"bg-slate-700/80 hover:bg-slate-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm transition-all border border-slate-500",title:" ",children:f.jsx("i",{className:"fas fa-arrow-up"})}),f.jsx("button",{onClick:()=>window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),className:"bg-slate-700/80 hover:bg-slate-600 text-white p-3 rounded-full shadow-lg backdrop-blur-sm transition-all border border-slate-500",title:" ",children:f.jsx("i",{className:"fas fa-arrow-down"})})]}),f.jsxs("div",{className:"space-y-8 animate-fade-in pb-20",children:[f.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center bg-slate-800 p-8 rounded-2xl border border-slate-700 shadow-xl relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500"}),f.jsxs("div",{className:"z-10 mb-4 md:mb-0",children:[f.jsxs("h2",{className:"text-3xl font-extrabold text-white mb-2 flex items-center gap-3",children:[f.jsx("i",{className:"fas fa-film text-red-500"}),"  (  )"]}),f.jsxs("p",{className:"text-slate-400 mb-4",children:["   ",f.jsx("span",{className:"text-red-400 font-bold",children:"5 (Hooking) "})," ."]}),f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700 w-fit",children:[f.jsx("span",{className:"text-xs font-bold text-slate-400 px-2",children:" :"}),f.jsxs("select",{value:p,onChange:L=>m(L.target.value),className:"bg-slate-800 text-white text-sm border border-slate-600 rounded px-3 py-1.5 focus:ring-2 focus:ring-red-500 outline-none",children:[f.jsx("option",{value:"ALL",children:"  (AI  )"}),u.map((L,N)=>f.jsxs("option",{value:L.id,children:[N+1,". ",L.title]},L.id))]})]}),f.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700 w-fit",children:[f.jsx("span",{className:"text-xs font-bold text-slate-400 px-2",children:" :"}),f.jsxs("select",{value:g,onChange:L=>E(L.target.value),className:"bg-slate-800 text-white text-sm border border-slate-600 rounded px-3 py-1.5 focus:ring-2 focus:ring-red-500 outline-none min-w-[150px]",children:[f.jsx("option",{value:"auto",children:" AI  ( )"}),f.jsx("option",{value:"mystery",children:" /"}),f.jsx("option",{value:"comedy",children:" / (B )"}),f.jsx("option",{value:"destiny",children:"   ( )"}),f.jsx("option",{value:"tragedy",children:"  / ()"}),f.jsx("option",{value:"revenge",children:" / ()"}),f.jsx("option",{value:"despair",children:"  /"})]})]})]})]}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("button",{onClick:le,className:"bg-slate-700 hover:bg-slate-600 text-slate-300 hover:text-white px-4 py-4 rounded-full font-bold text-lg shadow-lg transition-all",title:" ",children:f.jsx("i",{className:"fas fa-trash-alt"})}),f.jsx("button",{onClick:Y,className:"bg-green-700 hover:bg-green-600 text-slate-200 hover:text-white px-4 py-4 rounded-full font-bold text-lg shadow-lg transition-all",title:"   (ZIP)",children:f.jsx("i",{className:"fas fa-download"})}),f.jsx("button",{onClick:te,className:"bg-teal-700 hover:bg-teal-600 text-slate-200 hover:text-white px-4 py-4 rounded-full font-bold text-lg shadow-lg transition-all",title:"   (ZIP)",children:f.jsx("i",{className:"fas fa-file-code"})}),f.jsxs("button",{onClick:U,disabled:y,className:"bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-500 hover:to-orange-500 text-white px-8 py-4 rounded-full font-bold text-lg shadow-lg shadow-red-900/50 flex items-center gap-3 transition-all transform hover:scale-105",children:[y?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-magic"}),"   (AI)"]})]})]}),T.length>0&&f.jsxs("div",{className:"space-y-0",children:[T.map((L,N)=>{var H,M;return f.jsxs("div",{className:"relative pl-8 md:pl-12 py-6 group",children:[f.jsx("div",{className:"absolute left-4 md:left-6 top-0 bottom-0 w-0.5 bg-slate-700 group-last:bottom-auto group-last:h-1/2"}),f.jsx("div",{className:"absolute left-2 md:left-4 top-12 w-4 h-4 md:w-5 md:h-5 rounded-full bg-slate-900 border-4 border-indigo-500 z-10 shadow-lg shadow-indigo-500/50"}),f.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-700 overflow-hidden hover:border-indigo-500 transition-colors",children:[f.jsxs("div",{className:"flex flex-col md:flex-row",children:[f.jsxs("div",{className:"w-full md:w-3/4 bg-black relative min-h-[500px] flex items-center justify-center border-r border-slate-800",children:[L.generatedImageUrl?f.jsx("img",{src:L.generatedImageUrl,alt:L.title,className:"w-full h-full object-cover"}):f.jsxs("div",{className:"text-center p-6",children:[f.jsx("i",{className:"fas fa-clapperboard text-4xl text-slate-700 mb-3"}),f.jsx("p",{className:"text-slate-500 text-sm",children:"  "})]}),f.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-3",children:[f.jsxs("button",{onClick:()=>Q(L),disabled:_[L.id],className:"bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-2 rounded-full font-bold shadow-lg flex items-center gap-2",children:[_[L.id]?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-paint-brush"}),L.generatedImageUrl?"  ":" "]}),L.generatedImageUrl&&f.jsx("button",{onClick:()=>se(L.generatedImageUrl),className:"bg-slate-700/80 hover:bg-slate-600 text-white p-3 rounded-full font-bold shadow-lg backdrop-blur-sm transition-transform hover:scale-110",title:" ",children:f.jsx("i",{className:"fas fa-search-plus"})}),L.generatedImageUrl&&f.jsxs("button",{onClick:()=>ne(L.generatedImageUrl,`opening_shot_${L.sequenceNumber}.png`),className:"bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-full font-bold shadow-lg flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-download"})," "]})]})]}),f.jsx("div",{className:"w-full md:w-1/4 p-4 flex flex-col justify-between overflow-y-auto h-[500px] scrollbar-thin",children:f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center justify-between mb-3",children:[f.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[f.jsxs("span",{className:"text-indigo-400",children:["#",L.sequenceNumber]})," ",L.title]}),N<T.length-1&&f.jsxs("span",{className:"text-xs bg-slate-800 text-slate-400 px-2 py-1 rounded border border-slate-700",children:["   ",f.jsx("i",{className:"fas fa-arrow-down ml-1"})]})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-1",children:[f.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase",children:[f.jsx("i",{className:"fas fa-image mr-1"}),"    ()"]}),f.jsxs("button",{onClick:()=>me(L),className:"text-xs text-indigo-400 hover:text-white",children:[f.jsx("i",{className:"fas fa-expand-alt"}),"  "]})]}),f.jsx("textarea",{value:L.visualPrompt,onChange:F=>A(L.id,F.target.value),className:"w-full bg-slate-900 text-sm text-slate-300 border border-slate-600 rounded p-2 h-20 focus:ring-2 focus:ring-indigo-500 outline-none resize-none"})]}),f.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("p",{className:"text-xs font-bold text-green-500 uppercase",children:[f.jsx("i",{className:"fas fa-user mr-1"}),"   (Casting)"]}),f.jsxs("select",{className:"bg-slate-900 text-xs text-slate-300 border border-slate-600 rounded px-2 py-1 max-w-[120px]",onChange:F=>{F.target.value&&z(L.id,F.target.value,"add"),F.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),$().map(F=>f.jsx("option",{value:F.id,children:F.name},F.id))]})]}),f.jsxs("div",{className:"flex gap-2 flex-wrap min-h-[24px]",children:[(H=L.characterIds)==null?void 0:H.map(F=>{const Z=e==null?void 0:e.find(B=>B.id===F);return Z?f.jsxs("div",{className:"bg-green-900/50 text-green-200 border border-green-700/50 text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[f.jsx("span",{children:oa(Z.name)}),f.jsx("button",{onClick:()=>z(L.id,F,"remove"),className:"hover:text-green-100",children:f.jsx("i",{className:"fas fa-times"})})]},F):null}),(!L.characterIds||L.characterIds.length===0)&&f.jsx("span",{className:"text-xs text-slate-600",children:"  "})]})]}),f.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("p",{className:"text-xs font-bold text-amber-500 uppercase",children:[f.jsx("i",{className:"fas fa-cube mr-1"}),"   (Props)"]}),f.jsxs("select",{className:"bg-slate-900 text-xs text-slate-300 border border-slate-600 rounded px-2 py-1 max-w-[120px]",onChange:F=>{F.target.value&&S(L.id,F.target.value,"add"),F.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),a&&a.map(F=>f.jsx("option",{value:F.id,children:F.name},F.id))]})]}),f.jsxs("div",{className:"flex gap-2 flex-wrap min-h-[24px]",children:[(M=L.propIds)==null?void 0:M.map(F=>{const Z=a==null?void 0:a.find(B=>B.id===F);return Z?f.jsxs("div",{className:"bg-amber-900/50 text-amber-200 border border-amber-700/50 text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[f.jsx("span",{children:Z.name}),f.jsx("button",{onClick:()=>S(L.id,F,"remove"),className:"hover:text-red-300",children:f.jsx("i",{className:"fas fa-times"})})]},F):null}),(!L.propIds||L.propIds.length===0)&&f.jsx("span",{className:"text-xs text-slate-600",children:"  "})]})]}),f.jsxs("div",{className:"bg-indigo-900/20 p-3 rounded-lg border border-indigo-500/30",children:[f.jsxs("div",{className:"flex justify-between items-center mb-1",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs("p",{className:"text-xs font-bold text-indigo-300 uppercase",children:[f.jsx("i",{className:"fas fa-video mr-1"})," Veo   (JSON)"]}),(()=>{var B;const F=typeof L.videoPrompt=="string"?JSON.parse(L.videoPrompt):L.videoPrompt;return((B=F==null?void 0:F.subject)==null?void 0:B.dialogue)&&F.subject.dialogue.length>0&&!F.subject.dialogue.startsWith("EXTRACT")?f.jsxs("span",{className:"bg-green-600 text-white text-[10px] px-1.5 py-0.5 rounded-full animate-pulse",children:[f.jsx("i",{className:"fas fa-comment-dots mr-1"})," "]}):null})()]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:()=>re(L.id,"restore"),className:"text-xs text-green-400 hover:text-green-300",title:"  ()",children:[f.jsx("i",{className:"fas fa-microphone"})," "]}),f.jsxs("button",{onClick:()=>re(L.id,"remove"),className:"text-xs text-red-400 hover:text-red-300",title:"  ( )",children:[f.jsx("i",{className:"fas fa-microphone-slash"})," "]}),f.jsxs("button",{onClick:()=>{const F=typeof L.videoPrompt=="object"?JSON.stringify(L.videoPrompt,null,2):L.videoPrompt;navigator.clipboard.writeText(F),s("JSON ","success")},className:"text-xs text-indigo-400 hover:text-white",children:[f.jsx("i",{className:"fas fa-copy"})," "]})]})]}),f.jsx("pre",{className:"text-[10px] text-indigo-200 font-mono bg-black/30 p-2 rounded overflow-x-auto whitespace-pre-wrap max-h-[150px]",children:typeof L.videoPrompt=="object"?JSON.stringify(L.videoPrompt,null,2):L.videoPrompt}),f.jsx("p",{className:"text-[10px] text-indigo-400/70 mt-2",children:"* Veo 'Advanced Mode'  JSON     ."})]}),f.jsxs("div",{className:"bg-purple-900/20 p-3 rounded-lg border border-purple-500/30",children:[f.jsx("div",{className:"flex justify-between items-center mb-2",children:f.jsxs("p",{className:"text-xs font-bold text-purple-300 uppercase",children:[f.jsx("i",{className:"fas fa-closed-captioning mr-1"}),"   (Trailer Caption)"]})}),f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsxs("button",{onClick:()=>ie(L),disabled:_[L.id],className:"bg-purple-600 hover:bg-purple-500 text-white text-xs px-3 py-2 rounded-lg font-bold shadow-lg flex items-center justify-center gap-2 transition-colors w-full",children:[_[L.id]?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-magic"}),"  (AI)"]}),L.trailerCaption&&f.jsxs("div",{className:"bg-slate-900/80 p-2 rounded border border-purple-500/50 flex justify-between items-center gap-2",children:[f.jsxs("span",{className:"text-sm text-white font-serif italic",children:['"',L.trailerCaption,'"']}),f.jsx("button",{onClick:()=>{navigator.clipboard.writeText(L.trailerCaption||""),s("","success")},className:"text-purple-400 hover:text-white shrink-0",title:"",children:f.jsx("i",{className:"fas fa-copy"})})]})]})]})]})]})})]}),L.imageHistory&&L.imageHistory.length>0&&f.jsxs("div",{className:"w-full bg-slate-950/50 border-t border-slate-800 p-3",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx("i",{className:"fas fa-history text-slate-500 text-xs"}),f.jsxs("p",{className:"text-xs font-bold text-slate-400 uppercase",children:[" (",L.imageHistory.length,")"]})]}),f.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent",children:L.imageHistory.map((F,Z)=>f.jsxs("div",{onClick:()=>b(L.id,F),className:`relative w-20 h-20 shrink-0 rounded-lg overflow-hidden cursor-pointer border-2 transition-all group/hist ${L.generatedImageUrl===F?"border-indigo-500 opacity-100 ring-2 ring-indigo-500/50":"border-slate-700 opacity-60 hover:opacity-100 hover:border-slate-500"}`,children:[f.jsx("img",{src:F,alt:`History ${Z}`,className:"w-full h-full object-cover"}),L.generatedImageUrl===F&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-indigo-900/40 backdrop-blur-[1px]",children:f.jsx("i",{className:"fas fa-check-circle text-white text-xl shadow-sm"})}),f.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover/hist:bg-black/20 transition-colors"})]},Z))})]})]})]},L.id)}),f.jsx("div",{className:"pl-8 md:pl-12 pb-8",children:f.jsx("div",{className:"bg-slate-800/50 border border-slate-700 border-dashed rounded-xl p-4 text-center",children:f.jsxs("p",{className:"text-slate-400 text-sm",children:[f.jsx("i",{className:"fas fa-check-circle text-green-500 mr-2"})," 5   (Cliffhanger).      ."]})})}),f.jsx("div",{className:"pl-8 md:pl-12 pb-8",children:f.jsxs("div",{className:"bg-gradient-to-r from-slate-900 to-slate-800 rounded-xl border border-slate-700 p-6 relative overflow-hidden",children:[f.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-blue-500"}),f.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4",children:[f.jsxs("div",{children:[f.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-music text-blue-400"}),"    (Suno AI)"]}),f.jsxs("p",{className:"text-slate-400 text-sm mt-1 mb-3",children:[" (",g,")    ",f.jsx("span",{className:"text-blue-300",children:"  "})," ."]}),f.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700 w-fit",children:[f.jsx("span",{className:"text-xs font-bold text-slate-400 px-2",children:" :"}),f.jsxs("select",{value:v,onChange:L=>w(L.target.value),className:"bg-slate-800 text-white text-sm border border-slate-600 rounded px-3 py-1.5 focus:ring-2 focus:ring-blue-500 outline-none min-w-[150px]",children:[f.jsx("option",{value:"auto",children:"   ()"}),f.jsx("option",{value:"fast_exciting",children:" / ()"}),f.jsx("option",{value:"sad_sorrowful",children:" / ()"}),f.jsx("option",{value:"faint_hazy",children:" / ()"}),f.jsx("option",{value:"slow_mystery",children:" / ()"}),f.jsx("option",{value:"medium_story",children:" / ()"}),f.jsx("option",{value:"grand_epic",children:" / ()"})]})]})]}),f.jsxs("div",{className:"flex gap-2",children:[K&&f.jsx("button",{onClick:()=>{confirm("  ?")&&ee(null)},className:"bg-red-900/50 hover:bg-red-800 text-red-200 px-4 py-2.5 rounded-lg font-bold shadow-lg transition-all whitespace-nowrap border border-red-700/50",title:" ",children:f.jsx("i",{className:"fas fa-trash-alt"})}),f.jsxs("button",{onClick:be,disabled:O,className:"bg-blue-600 hover:bg-blue-500 text-white px-5 py-2.5 rounded-lg font-bold shadow-lg flex items-center gap-2 transition-all whitespace-nowrap",children:[O?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-microphone-alt"}),K?"  ":"Suno  "]})]})]}),K&&f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-slate-950/50 rounded-lg p-6 border border-slate-800",children:[f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Song Title"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("input",{readOnly:!0,value:K.title,className:"bg-slate-900 text-white text-lg font-bold border border-slate-700 rounded px-3 py-2 w-full focus:ring-1 focus:ring-blue-500 outline-none"}),f.jsx("button",{onClick:()=>Be(K.title),className:"bg-slate-800 hover:bg-slate-700 text-slate-300 p-3 rounded border border-slate-700",children:f.jsx("i",{className:"fas fa-copy"})})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Style of Music (English - Recommended)"}),f.jsxs("div",{className:"relative",children:[f.jsx("textarea",{readOnly:!0,value:K.style_en,className:"bg-slate-900 text-blue-300 text-sm border border-slate-700 rounded p-3 w-full h-20 resize-none focus:ring-1 focus:ring-blue-500 outline-none"}),f.jsx("button",{onClick:()=>Be(K.style_en),className:"absolute top-2 right-2 text-slate-500 hover:text-white bg-slate-800/80 p-1.5 rounded",children:f.jsx("i",{className:"fas fa-copy"})})]}),f.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"* Suno    ."})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Style of Music (Korean - Experimental)"}),f.jsxs("div",{className:"relative",children:[f.jsx("textarea",{readOnly:!0,value:K.style_ko,className:"bg-slate-900 text-green-300 text-sm border border-slate-700 rounded p-3 w-full h-20 resize-none focus:ring-1 focus:ring-green-500 outline-none"}),f.jsx("button",{onClick:()=>Be(K.style_ko),className:"absolute top-2 right-2 text-slate-500 hover:text-white bg-slate-800/80 p-1.5 rounded",children:f.jsx("i",{className:"fas fa-copy"})})]}),f.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"*  . (     )"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Lyrics (~40s)"}),f.jsxs("div",{className:"relative",children:[f.jsx("textarea",{readOnly:!0,value:K.lyrics,className:"bg-slate-900 text-slate-300 text-sm border border-slate-700 rounded p-3 w-full h-48 resize-none focus:ring-1 focus:ring-blue-500 outline-none font-mono leading-relaxed"}),f.jsx("button",{onClick:()=>Be(K.lyrics),className:"absolute top-2 right-2 text-slate-500 hover:text-white bg-slate-800/80 p-1.5 rounded",children:f.jsx("i",{className:"fas fa-copy"})})]}),f.jsx("p",{className:"text-xs text-slate-500 mt-1",children:'* Suno "Lyrics"  .'})]})]})]})})]}),T.length===0&&!y&&f.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-slate-600",children:[f.jsx("i",{className:"fas fa-film text-6xl mb-4 opacity-20"}),f.jsx("p",{className:"text-lg",children:"    ."})]}),f.jsxs("div",{className:"border-t border-slate-700 pt-10 mt-10",children:[f.jsx("div",{className:"bg-slate-900 rounded-xl p-6 border border-slate-700 mb-10",children:f.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[f.jsxs("div",{className:"w-full md:w-1/4 space-y-4",children:[f.jsxs("h4",{className:"text-lg font-bold text-white flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-image text-purple-400"}),"  "]}),G?f.jsxs("div",{className:"space-y-3 animate-fade-in",children:[f.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-600 space-y-2",children:[f.jsx("p",{className:"text-xs text-purple-300 font-bold mb-1",children:"  ()"}),f.jsx("div",{className:"w-full bg-slate-900 text-sm text-slate-100 border border-slate-600 rounded px-2 py-1 min-h-[32px] flex items-center",children:f.jsx("span",{className:"truncate",children:G.title||"AI      ."})}),f.jsx("p",{className:"text-[10px] text-slate-500",children:")  ,   ,   ,   "})]}),f.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-600 space-y-2",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("p",{className:"text-xs text-slate-400 font-bold",children:" "}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsxs("button",{onClick:()=>{G.action&&(navigator.clipboard.writeText(G.action),s("  ","success"))},className:"text-[10px] bg-slate-700 hover:bg-slate-600 text-slate-200 px-2 py-0.5 rounded",children:[f.jsx("i",{className:"fas fa-copy mr-1"}),""]}),f.jsxs("button",{onClick:Ne,className:"text-[10px] bg-indigo-600 hover:bg-indigo-500 text-white px-2 py-0.5 rounded",children:[f.jsx("i",{className:"fas fa-expand-alt mr-1"})," "]})]})]}),f.jsx("textarea",{className:"w-full bg-slate-900 text-[10px] text-slate-200 border border-slate-600 rounded px-2 py-1 h-24 leading-tight resize-none",value:G.action,onChange:L=>Ie("action",L.target.value),onDoubleClick:Ne})]}),f.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-600 space-y-2",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsxs("p",{className:"text-xs text-green-500 font-bold uppercase",children:[f.jsx("i",{className:"fas fa-users mr-1"}),"  "]}),f.jsxs("select",{className:"bg-slate-900 text-[10px] text-slate-300 border border-slate-600 rounded px-1 py-0.5 max-w-[80px]",onChange:L=>{L.target.value&&ke(L.target.value),L.target.value=""},children:[f.jsx("option",{value:"",children:"+ "}),e&&e.filter(L=>L.referenceImageId).map(L=>f.jsx("option",{value:L.id,children:L.name},L.id))]})]}),f.jsx("p",{className:"text-[10px] text-slate-500 leading-tight",children:"* / .  ."}),f.jsx("div",{className:"space-y-1.5 max-h-[200px] overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-slate-700",children:G.characters&&G.characters.map((L,N)=>f.jsxs("div",{className:"bg-slate-900 p-2 rounded border border-slate-700 relative group flex items-center justify-between",children:[f.jsxs("div",{className:"flex-1 min-w-0 mr-2",children:[f.jsxs("div",{className:"flex items-center gap-1.5",children:[f.jsx("span",{className:"text-sm font-bold text-white truncate",children:L.name}),f.jsx("span",{className:"text-[10px] text-slate-400 truncate max-w-[80px]",children:L.action})]}),f.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[f.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${L.appearance?"bg-green-500":"bg-slate-600"}`}),f.jsx("span",{className:"text-[10px] text-slate-500 truncate",children:L.appearance?" ":"  ()"})]})]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx("button",{onClick:()=>nt(N),className:"bg-indigo-600 hover:bg-indigo-500 text-white p-1.5 rounded text-xs",title:"  ",children:f.jsx("i",{className:"fas fa-edit"})}),f.jsx("button",{onClick:()=>De(N),className:"bg-slate-800 hover:bg-red-900/50 text-slate-500 hover:text-red-400 p-1.5 rounded text-xs",title:"",children:f.jsx("i",{className:"fas fa-times"})})]})]},N))}),(!G.characters||G.characters.length===0)&&f.jsx("p",{className:"text-[10px] text-slate-500 text-center py-2",children:" "})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:et,disabled:X,className:"flex-1 bg-pink-600 hover:bg-pink-500 text-white px-3 py-2 rounded-lg font-bold shadow-lg flex items-center justify-center gap-1 text-sm",children:[X?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-paint-brush"}),""]}),f.jsx("button",{onClick:()=>{confirm("  ?")&&(ce(null),Cr("bangtong-thumbnail-data"))},className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-3 py-2 rounded-lg text-sm",title:"",children:f.jsx("i",{className:"fas fa-trash-alt"})})]})]}):f.jsxs("div",{className:"space-y-2",children:[f.jsx("p",{className:"text-slate-400 text-sm",children:"     ."}),f.jsxs("button",{onClick:xe,disabled:X,className:"w-full bg-purple-600 hover:bg-purple-500 text-white px-4 py-3 rounded-lg font-bold shadow-lg flex items-center justify-center gap-2",children:[X?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-brain"}),"1. "]})]})]}),f.jsx("div",{className:"w-full md:w-3/4 bg-black rounded-lg border border-slate-800 flex flex-col items-center justify-center min-h-[400px] relative overflow-hidden group aspect-video",children:G!=null&&G.imageUrl?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"relative w-full h-full flex items-center justify-center overflow-hidden",children:[f.jsx("img",{src:G.imageUrl,alt:"Thumbnail",className:"w-full h-full object-contain"}),f.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-3",children:[f.jsx("button",{onClick:()=>se(G.imageUrl),className:"bg-slate-700 hover:bg-slate-600 text-white p-3 rounded-full",children:f.jsx("i",{className:"fas fa-search-plus"})}),f.jsxs("button",{onClick:()=>ne(G.imageUrl,"thumbnail.png"),className:"bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-full font-bold",children:[f.jsx("i",{className:"fas fa-download"})," "]})]})]}),G.imageHistory&&G.imageHistory.length>0&&f.jsxs("div",{className:"w-full bg-slate-950/50 border-t border-slate-800 p-2",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1 px-1",children:[f.jsx("i",{className:"fas fa-history text-slate-500 text-[10px]"}),f.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:""})]}),f.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent px-1",children:G.imageHistory.map((L,N)=>f.jsx("div",{onClick:()=>ce(H=>H?{...H,imageUrl:L}:null),className:`relative w-16 h-9 shrink-0 rounded overflow-hidden cursor-pointer border transition-all group/hist ${G.imageUrl===L?"border-pink-500 opacity-100":"border-slate-700 opacity-60 hover:opacity-100"}`,children:f.jsx("img",{src:L,alt:`Thumb History ${N}`,className:"w-full h-full object-cover"})},N))})]})]}):f.jsxs("div",{className:"text-center text-slate-600",children:[f.jsx("i",{className:"fas fa-image text-4xl mb-2"}),f.jsx("p",{children:"  "})]})})]})}),f.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6",children:[f.jsxs("div",{children:[f.jsxs("h3",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-bolt text-yellow-400"}),"    "]}),f.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"        50 ."}),D.length>0&&f.jsxs("p",{className:"text-green-400 text-sm font-bold mt-2",children:[f.jsx("i",{className:"fas fa-check-circle mr-1"})," ",D.length," "]})]}),f.jsxs("div",{className:"flex gap-2",children:[k.length>0&&f.jsxs(f.Fragment,{children:[f.jsxs("button",{onClick:Le,disabled:D.length===0,className:`px-4 py-3 rounded-full font-bold shadow-lg transition-all flex items-center gap-2 ${D.length>0?"bg-green-600 hover:bg-green-500 text-white":"bg-slate-700 text-slate-500 cursor-not-allowed"}`,title:"  ",children:[f.jsx("i",{className:"fas fa-file-download"}),"  "]}),f.jsx("button",{onClick:()=>{window.confirm("    ?")&&(j([]),q([]))},className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-4 py-3 rounded-full font-bold shadow-lg transition-all",title:"  ",children:f.jsx("i",{className:"fas fa-trash-alt"})})]}),f.jsxs("button",{onClick:ue,disabled:ae,className:"bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white px-6 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 transition-all",children:[ae?f.jsx("i",{className:"fas fa-spinner fa-spin"}):f.jsx("i",{className:"fas fa-list-ol"}),"  50 "]})]})]}),k.length>0&&f.jsx("div",{className:"bg-slate-900 rounded-xl p-6 border border-slate-700 max-h-[500px] overflow-y-auto",children:f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:k.map((L,N)=>{const H=D.includes(L);return f.jsxs("div",{onClick:()=>Ee(L),className:`p-3 rounded-lg border cursor-pointer transition-all flex justify-between items-center group relative
                                    ${H?"bg-green-900/30 border-green-500 shadow-[0_0_10px_rgba(34,197,94,0.3)]":"bg-slate-800 border-slate-700 hover:border-yellow-500 hover:bg-slate-700"}
                                `,children:[f.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[f.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center shrink-0 transition-colors ${H?"bg-green-500 border-green-500":"border-slate-500 bg-transparent"}`,children:H&&f.jsx("i",{className:"fas fa-check text-white text-xs"})}),f.jsx("span",{className:`font-medium truncate ${H?"text-green-200":"text-slate-200"}`,children:L})]}),f.jsx("button",{onClick:M=>{M.stopPropagation(),Be(L)},className:"text-slate-500 hover:text-white p-2 z-10",title:"",children:f.jsx("i",{className:"fas fa-copy"})})]},N)})})})]}),fe&&f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4 animate-fade-in",onClick:()=>se(null),children:f.jsxs("div",{className:"relative max-w-full max-h-full",children:[f.jsx("img",{src:fe,alt:"Preview",className:"max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl"}),f.jsx("button",{className:"absolute top-4 right-4 bg-black/50 hover:bg-black/80 text-white p-2 rounded-full transition-colors",onClick:()=>se(null),children:f.jsx("i",{className:"fas fa-times text-xl"})})]})})]})]})},JC=()=>{const{toast:t,closeToast:e}=Zt();if(!t)return null;const n={success:"bg-green-600",error:"bg-red-600",warning:"bg-yellow-600"};return f.jsxs("div",{className:`fixed bottom-6 left-1/2 transform -translate-x-1/2 ${n[t.type]} text-white px-6 py-3 rounded-full shadow-2xl z-[100] flex items-center gap-3 animate-fade-in-up cursor-pointer`,onClick:e,children:[f.jsx("i",{className:`fas ${t.type==="success"?"fa-check-circle":t.type==="warning"?"fa-exclamation-triangle":"fa-times-circle"}`}),f.jsx("span",{className:"font-medium",children:t.message})]})},XC=()=>{const{modalConfig:t,closeModal:e,showToast:n}=Zt(),[r,o]=de.useState("");if(de.useEffect(()=>{t&&o(t.defaultValue||"")},[t]),!t)return null;const i=()=>{t.onConfirm(r),e(),o("")},s=()=>{e(),o("")},a=async()=>{try{const u=typeof t.message=="string"?t.message:t.defaultValue||"";await navigator.clipboard.writeText(u),n(" .","success")}catch(u){console.error(u),n(" .","error")}};return f.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fade-in",children:f.jsxs("div",{className:`bg-slate-800 border border-slate-600 rounded-xl shadow-2xl w-full p-6 relative ${t.type==="textarea"?"max-w-4xl":"max-w-lg"}`,children:[f.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:t.title}),f.jsx("div",{className:"text-slate-300 mb-4 whitespace-pre-wrap leading-relaxed text-sm max-h-[60vh] overflow-y-auto custom-scrollbar",children:t.message}),t.type==="prompt"&&f.jsx("input",{autoFocus:!0,type:"text",className:"w-full bg-slate-900 border border-slate-700 rounded p-3 text-white mb-6 focus:ring-2 focus:ring-indigo-500 placeholder-slate-500",placeholder:" ",value:r,onChange:u=>o(u.target.value),onKeyDown:u=>{u.key==="Enter"&&i()}}),t.type==="textarea"&&f.jsx("textarea",{autoFocus:!0,className:"w-full h-[60vh] bg-slate-900 border border-slate-700 rounded p-4 text-white mb-6 focus:ring-2 focus:ring-indigo-500 placeholder-slate-500 text-sm leading-relaxed custom-scrollbar font-mono",placeholder:"  ",value:r,onChange:u=>o(u.target.value)}),f.jsxs("div",{className:"flex justify-end gap-3 items-center",children:[t.showCopyButton&&f.jsxs("button",{onClick:a,className:"mr-auto px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-indigo-300 font-bold transition-colors border border-slate-600 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-copy"})," "]}),f.jsx("button",{onClick:s,className:"px-4 py-2 rounded-lg text-slate-300 hover:bg-slate-700 font-medium transition-colors",children:t.cancelText||""}),f.jsx("button",{onClick:i,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-2 rounded-lg font-bold transition-all shadow-lg hover:shadow-indigo-500/30",children:t.confirmText||""})]})]})})},ZC=({onOpenApiKey:t})=>{const{apiKey:e}=Zt();return f.jsxs("header",{className:"bg-slate-900 border-b border-slate-700 p-4 flex items-center justify-between sticky top-0 z-50 shadow-md",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center text-white text-xl font-bold shadow-lg",children:""}),f.jsxs("h1",{className:"text-2xl font-bold text-white tracking-wide",children:["  ",f.jsx("span",{className:"text-xs text-slate-500 font-normal ml-2",children:"Ver 2.0 (Joseon Ed.)"})]})]}),f.jsxs("div",{className:"flex items-center gap-3",children:[e&&f.jsxs("div",{className:"hidden md:flex items-center gap-2 bg-slate-800 px-3 py-1.5 rounded-full border border-slate-600 mr-2",children:[f.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse"}),f.jsx("span",{className:"text-xs text-slate-300 font-medium",children:""})]}),f.jsxs("button",{onClick:t,className:"bg-slate-800 hover:bg-slate-700 text-slate-200 px-4 py-2 rounded-lg border border-slate-600 flex items-center gap-2 transition-all text-sm font-medium",children:[f.jsx("i",{className:`fas fa-key ${e?"text-green-500":"text-yellow-500"}`}),e?"API  ":"API  "]})]})]})},ia=({active:t,label:e,icon:n,onClick:r,disabled:o})=>f.jsxs("button",{onClick:r,disabled:o,className:`flex-1 py-4 text-lg font-bold flex items-center justify-center gap-3 transition-all ${t?"bg-indigo-600 text-white shadow-inner border-b-4 border-indigo-800":"bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white border-b-4 border-slate-900"} ${o?"opacity-50 cursor-not-allowed":""}`,children:[f.jsx("i",{className:`fas ${n} text-xl`}),e]}),QC=({isOpen:t,onClose:e})=>{const{apiKey:n,setApiKey:r,showToast:o}=Zt(),[i,s]=de.useState(n);return t?f.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[150] flex items-center justify-center p-4 animate-fade-in",children:f.jsxs("div",{className:"bg-slate-800 w-full max-w-md p-8 rounded-2xl border border-slate-600 shadow-2xl relative",children:[f.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-slate-400 hover:text-white",children:f.jsx("i",{className:"fas fa-times text-xl"})}),f.jsxs("h3",{className:"text-2xl font-bold text-white mb-4 flex items-center gap-2",children:[f.jsx("i",{className:"fas fa-key text-yellow-500"})," API  "]}),f.jsx("p",{className:"text-slate-300 mb-6 text-sm",children:"Google AI Studio  Gemini API Key ."}),f.jsx("input",{type:"password",value:i,onChange:a=>s(a.target.value),placeholder:"AIzaSy...",className:"w-full bg-slate-900 border border-slate-700 rounded-lg p-4 text-white focus:ring-2 focus:ring-indigo-500 mb-6 font-mono"}),f.jsx("button",{onClick:()=>{i?(r(i),e(),o(".","success")):o(" .","warning")},className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg",children:"  "}),f.jsx("div",{className:"mt-6 pt-4 border-t border-slate-700 text-center",children:f.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noreferrer",className:"text-indigo-400 text-sm",children:"API  "})})]})}):null},eI=()=>{const{characters:t,props:e,referenceImages:n,showToast:r}=Zt(),[o,i]=de.useState(!1),[s,a]=de.useState("char"),u=If.useMemo(()=>n.map(c=>({id:c.id,name:c.name,description:c.description,imageUrl:c.imageUrl,isRef:!0})),[n]);return f.jsxs("div",{className:`fixed right-0 top-32 bottom-0 z-[250] flex transition-transform duration-300 ${o?"translate-x-0":"translate-x-[320px]"}`,children:[f.jsx("button",{onClick:()=>i(!o),className:"h-14 w-8 bg-slate-800 border-l border-t border-b border-slate-600 rounded-l-lg flex items-center justify-center self-center shadow-lg hover:bg-slate-700 transition-colors",title:o?" ":" ",children:f.jsx("i",{className:`fas fa-chevron-${o?"right":"left"} text-slate-400`})}),f.jsxs("div",{className:"w-80 bg-slate-900 border-l border-slate-700 shadow-2xl p-4 flex flex-col h-full",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4 shrink-0",children:[f.jsxs("button",{onClick:()=>a("char"),className:`flex-1 py-2 rounded text-xs font-bold ${s==="char"?"bg-indigo-600 text-white":"bg-slate-800 text-slate-400"}`,children:[f.jsx("i",{className:"fas fa-user mr-1"})," "]}),f.jsxs("button",{onClick:()=>a("prop"),className:`flex-1 py-2 rounded text-xs font-bold ${s==="prop"?"bg-amber-600 text-white":"bg-slate-800 text-slate-400"}`,children:[f.jsx("i",{className:"fas fa-cube mr-1"})," "]})]}),f.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-3",children:s==="char"?u.length===0?f.jsx("p",{className:"text-slate-500 text-center text-xs py-10",children:"  ."}):u.map(c=>f.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[c.imageUrl&&f.jsx("div",{className:"w-8 h-8 rounded bg-black overflow-hidden shrink-0",children:f.jsx("img",{src:c.imageUrl,alt:c.name,className:"w-full h-full object-cover"})}),f.jsx("span",{className:"text-white font-bold text-sm truncate",children:c.name})]}),f.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(c.description||""),r(`${c.name}  !`,"success")},className:"text-xs bg-slate-700 hover:bg-indigo-600 text-slate-300 hover:text-white px-2 py-1 rounded transition-colors shrink-0",children:[f.jsx("i",{className:"fas fa-copy mr-1"})," "]})]}),f.jsx("p",{className:"text-xs text-slate-400 line-clamp-3 leading-relaxed bg-slate-900 p-2 rounded",children:c.description||" "})]},c.id)):e.length===0?f.jsx("p",{className:"text-slate-500 text-center text-xs py-10",children:"  ."}):e.map(c=>f.jsxs("div",{className:"bg-slate-800 p-3 rounded border border-slate-700",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:"w-8 h-8 rounded bg-black overflow-hidden shrink-0",children:f.jsx("img",{src:c.imageUrl,alt:c.name,className:"w-full h-full object-cover"})}),f.jsx("span",{className:"text-white font-bold text-sm",children:c.name})]}),f.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(c.description||""),r(`${c.name}  !`,"success")},className:"text-xs bg-slate-700 hover:bg-amber-600 text-slate-300 hover:text-white px-2 py-1 rounded transition-colors",children:[f.jsx("i",{className:"fas fa-copy mr-1"})," "]})]}),f.jsx("p",{className:"text-xs text-slate-400 line-clamp-3 leading-relaxed bg-slate-900 p-2 rounded",children:c.description||" "})]},c.id))})]})]})},tI=()=>{const{apiKey:t,script:e,scriptSegments:n,scenes:r,characters:o,setScenes:i,setCharacters:s,isContinuityMode:a,showToast:u,resetProject:c,openModal:h}=Zt(),[p,m]=de.useState("script"),[g,E]=de.useState(!1),[v,w]=de.useState(!1),y=async()=>{if(!t)return E(!0);if(!e.trim()&&n.length===0)return u(" !","warning");w(!0);try{let T=e,I=e;a?n.length>0&&(T=n[n.length-1].content,u(`  :  (${n[n.length-1].title})   .`,"success")):u("  :     .","success"),u("1/2: (Scene)   ...","success");const R=(await Nm(t,T,[])).map((ae,P)=>({...ae,id:`scene-${Date.now()}-${P}`}));u("2/2:     ...","success");const j=await _m(t,I,R,a?o:[]);let D=[...j];if(a){const ae=new Set(o.map(W=>W.name)),P=[...o];j.forEach(W=>{P.some(C=>C.name===W.name)||P.push(W)}),D=P}const q=R.map(ae=>{const P=ae.characterNames||[],W=J=>J.replace(/[\s\[\]\(\):]/g,""),C=new Map;D.forEach(J=>{const K=W(J.name);if(!P.some(V=>{const fe=W(V);return fe===K||fe.includes(K)||K.includes(fe)}))return;const O=C.get(K);if(!O)C.set(K,J);else{const V=!!O.referenceImageId,fe=!!J.referenceImageId;!V&&fe&&C.set(K,J)}});const G=Array.from(C.values()).map(J=>J.id),ce=G.slice(0,3),X=G.slice(3,6);return{...ae,casting:{mainIds:ce,subIds:X,propIds:[]}}});a?(i(q),s(ae=>{const P=[...ae];return j.forEach(W=>{const C=P.findIndex(G=>G.name===W.name);C===-1?P.push(W):P[C]={...P[C],description:W.description,visualGuide:W.visualGuide,age:W.age,gender:W.gender}}),P})):(i(q),s(j)),m("sintong"),u(` !  ${q.length} .`,"success")}catch(T){u(T.message,"error")}finally{w(!1)}},x=()=>{h({type:"confirm",title:" ",message:`     ?
    .`,confirmText:"",cancelText:"",onConfirm:()=>c()})};return f.jsxs("div",{className:"min-h-screen bg-[#0f172a] text-slate-200 font-sans selection:bg-indigo-500 selection:text-white pb-20",children:[f.jsx(ZC,{onOpenApiKey:()=>E(!0)}),f.jsxs("div",{className:"flex border-b border-slate-700 sticky top-[72px] z-40 bg-[#0f172a]",children:[f.jsx(ia,{active:p==="script",onClick:()=>m("script"),label:"1. /",icon:"fa-file-alt"}),f.jsx(ia,{active:p==="opening",onClick:()=>m("opening"),label:"2.  ()",icon:"fa-film"}),f.jsx(ia,{active:p==="sintong",onClick:()=>m("sintong"),label:"3.  ( )",icon:"fa-layer-group"})]}),f.jsxs("main",{className:"max-w-6xl mx-auto p-6 min-h-[calc(100vh-140px)]",children:[p==="script"&&f.jsx(zC,{onAnalyze:y,isAnalyzing:v}),p==="opening"&&f.jsx(KC,{}),p==="sintong"&&f.jsx(YC,{onNext:()=>{},isNextLoading:!1})]}),f.jsx(eI,{}),f.jsx("div",{className:"fixed bottom-6 right-6 z-40",children:f.jsxs("button",{onClick:x,className:"bg-red-900/80 hover:bg-red-900 text-red-200 px-4 py-2 rounded-full text-xs border border-red-700 backdrop-blur",children:[f.jsx("i",{className:"fas fa-trash mr-1"}),"  "]})}),f.jsx(XC,{}),f.jsx(JC,{}),f.jsx(QC,{isOpen:g,onClose:()=>E(!1)})]})},nI=()=>f.jsx(ly,{children:f.jsx(tI,{})}),Rm=document.getElementById("root");if(!Rm)throw new Error("Could not find root element to mount to");const rI=sa.createRoot(Rm);rI.render(f.jsx(If.StrictMode,{children:f.jsx(nI,{})}));
