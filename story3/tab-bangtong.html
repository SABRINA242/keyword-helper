<div class="app-main app-main-vertical">
  <section class="panel">
    <h2>방통이 · 썸네일 문구 생성</h2>
    <p class="helper-text">
      대본/설정 탭에 저장된 전체 대본을 기준으로, 3~4줄 구조의 유튜브 썸네일 문구 후보를 20개 생성합니다.
      인물 두 명의 관계 축과 동사를 중심으로 여러 각도의 문구를 만듭니다.
    </p>
    <div class="bang-relation-section">
      <h3 class="bang-section-title">1단계 · 썸네일 관계 축 선택</h3>
      <p class="helper-text">
        이번 썸네일에서 강조할 인물 관계를 먼저 고릅니다. 선택한 관계 축만 기준으로 썸네일 문구를 만듭니다.
      </p>
      <div class="bang-relation-add-row">
        <input
          id="bangRelationAddInput"
          class="text-input bang-relation-add-input"
          type="text"
          placeholder="예: 시어머니 VS 며느리"
        />
        <button id="bangRelationAddButton" class="secondary-button small-button">
          구도 추가
        </button>
      </div>
      <p class="helper-text">
        필요하다면, 구도 태그를 조금 더 구체적으로 적어도 됩니다.
        <br />
        예: 쫓겨난 며느리 VS 쫓아낸 시어머니
      </p>
      <div id="bangRelationList" class="bang-relation-grid"></div>
    </div>
    <div class="bang-thumbnail-top-row">
      <div class="bang-thumbnail-top-left">
        <button id="bangGenerateThumbnailButton" class="primary-button">
          2단계 · 선택한 관계로 썸네일 20개 기획하기
        </button>
        <button id="bangResetButton" class="secondary-button small-button">
          방통이 초기화
        </button>
      </div>
      <button id="bangCopyThumbnailAllButton" class="secondary-button small-button">
        썸네일 문구 전체 복사
      </button>
    </div>
    <div class="bang-strategy-section">
      <h3 class="bang-section-title">선택한 구도의 핵심 한 줄 메모 (선택)</h3>
      <p class="helper-text">
        AI에게 이 이야기의 진짜 포인트를 한 줄로 알려주면, 더 정확한 썸네일이 나옵니다.
        <br />
        예: 시어머니는 못돼서가 아니라, 며느리를 살리려고 독한 마음으로 쫓아낸 것이다.
      </p>
      <textarea
        id="bangThumbnailStrategyInput"
        class="text-area"
        rows="3"
        placeholder="예: 쫓겨난 며느리와 쫓아낸 시어머니 구도로, 사실은 며느리를 살리려고 내쫓은 이야기라는 포인트를 살려서 썸네일을 만들어줘."
      ></textarea>
    </div>
    <p id="bangThumbnailStatus" class="helper-text"></p>
    <div id="bangThumbnailCardList" class="bang-thumbnail-grid"></div>

    <div class="bang-editor-section">
      <h3 class="bang-section-title">3단계 · 썸네일 제작 스튜디오</h3>
      <p class="helper-text">
        선택한 문구로 실제 썸네일을 만듭니다. 이미지를 넣고 텍스트를 꾸며보세요.
      </p>

      <div class="bang-editor-container">
        <!-- Left: Canvas Area -->
        <div class="bang-canvas-area">
           <div class="bang-canvas-wrapper">
              <canvas id="thumbnailCanvas" width="1280" height="720"></canvas>
              <button id="openLargeViewBtn" class="canvas-overlay-btn" title="크게 보기">🔍</button>
           </div>
           
           <div class="control-row mt-2">
              <span class="sub-label">좌측 그라데이션 범위 (0 = 없음)</span>
              <input type="range" id="gradientWidthInput" min="0" max="100" value="60" class="range-input full-width">
           </div>
           
           <div class="control-row mt-1">
              <span class="sub-label">하단 그라데이션 높이 (0 = 없음)</span>
              <input type="range" id="gradientHeightInput" min="0" max="100" value="0" class="range-input full-width">
           </div>

           <div class="bang-canvas-controls">
              <input type="file" id="bgImageInput" accept="image/*" style="display: none;">
              <button id="uploadBgButton" class="secondary-button small-button">배경 이미지 업로드</button>
              <button id="downloadThumbnailButton" class="primary-button small-button">썸네일 다운로드</button>
           </div>
        </div>

        <!-- Large View Modal -->
        <div id="largeViewModal" class="modal-overlay hidden">
           <div class="modal-content large-view-modal">
              <div class="modal-header">
                 <h3>썸네일 미리보기</h3>
                 <button id="closeLargeViewBtn" class="close-button">✕</button>
              </div>
              <div class="modal-body">
                 <img id="largeViewImage" src="" alt="Large Preview" style="width: 100%; height: auto; border-radius: 8px;">
              </div>
           </div>
        </div>

        <!-- Right: Controls -->
        <div class="bang-controls-area">
           <!-- Text Layers List -->
           <div class="control-group">
              <label class="control-label">텍스트 레이어 <span class="sub-text">(Shift+Enter로 줄바꿈 시 분리)</span></label>
              <div id="textLayerList" class="text-layer-list">
                 <!-- Text layers will be injected here -->
              </div>
              <button id="addTextLayerButton" class="secondary-button small-button full-width mt-2">+ 텍스트 추가</button>
           </div>
           
           <!-- Selected Layer Properties (Contextual) -->
           <div id="layerPropertiesPanel" class="layer-properties hidden">
              <div class="layer-properties-header flex-row space-between">
                <label class="control-label highlight-text">선택된 텍스트 속성</label>
                <label class="checkbox-label font-sm" style="margin-bottom:0; cursor:pointer;">
                   <input type="checkbox" id="applyAllLayersCheckbox"> 전체 적용
                </label>
              </div>
              
              <div class="control-row">
                 <textarea id="layerTextInput" rows="2" class="text-input font-sm"></textarea>
              </div>

              <div class="control-row flex-row mt-2">
                 <div class="flex-1">
                    <span class="sub-label">폰트 굵기</span>
                    <select id="fontWeightSelect" class="text-input">
                       <option value="900">매우 굵게 (900)</option>
                       <option value="700" selected>굵게 (700)</option>
                       <option value="400">보통 (400)</option>
                       <option value="100">얇게 (100)</option>
                    </select>
                 </div>
                 <div class="w-80">
                    <span class="sub-label">크기</span>
                    <input type="number" id="fontSizeInput" class="text-input" value="60">
                 </div>
              </div>

              <div class="control-row">
                 <span class="sub-label">폰트</span>
                 <div class="flex-row">
                    <select id="fontFamilySelect" class="text-input flex-1">
                       <option value="Pretendard, sans-serif">기본 (Pretendard)</option>
                       <option value="'Noto Serif KR', serif">바탕 (Noto Serif)</option>
                       <option value="'Noto Sans KR', sans-serif">고딕 (Noto Sans)</option>
                       <option value="'GungSeo', serif">궁서체</option>
                       <option value="'Black Han Sans', sans-serif">검은고딕</option>
                       <option value="Impact, sans-serif">Impact</option>
                    </select>
                    <button id="toggleFontFavoriteBtn" class="secondary-button small-button" title="즐겨찾기">★</button>
                 </div>
                 <div class="mt-2">
                    <button id="scanLocalFontBtn" class="secondary-button small-button full-width">내 컴퓨터 설치된 폰트 스캔하기</button>
                    <!-- Fallback for file upload -->
                    <button id="loadLocalFontBtn" class="secondary-button small-button full-width mt-1" style="display:none; font-size:0.75rem;">(또는 폰트 파일 직접 선택)</button>
                    <input type="file" id="localFontInput" accept=".ttf,.otf,.woff,.woff2" style="display:none">
                 </div>
              </div>

              <div class="control-row flex-row mt-2">
                 <div class="flex-1">
                    <span class="sub-label">글자색</span>
                    <div class="color-picker-wrapper">
                        <input type="color" id="textColorInput" value="#ffffff">
                    </div>
                 </div>
                 <div class="flex-1">
                    <span class="sub-label">테두리색</span>
                    <div class="color-picker-wrapper">
                        <input type="color" id="strokeColorInput" value="#000000">
                    </div>
                 </div>
                 <div class="w-60">
                     <span class="sub-label">두께</span>
                     <input type="number" id="strokeWidthInput" class="text-input" value="4">
                 </div>
              </div>

              <div class="control-row flex-row mt-2">
                 <div class="flex-1">
                    <span class="sub-label">자간</span>
                    <input type="number" id="letterSpacingInput" class="text-input" value="0" step="1">
                 </div>
                 <div class="flex-1">
                    <span class="sub-label">세로크기(%)</span>
                    <input type="number" id="scaleYInput" class="text-input" value="100" step="5">
                 </div>
              </div>
              
              <div class="control-row flex-row mt-2">
                  <div class="flex-1">
                    <span class="sub-label">X 위치</span>
                    <input type="number" id="posXInput" class="text-input" value="50">
                  </div>
                  <div class="flex-1">
                    <span class="sub-label">Y 위치</span>
                    <input type="number" id="posYInput" class="text-input" value="100">
                  </div>
              </div>

              <button id="deleteLayerButton" class="danger-button small-button full-width mt-3">삭제</button>
           </div>
        </div>
      </div>
    </div>
  </section>
</div>
